(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function T1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ob={exports:{}},Ph={},Lb={exports:{}},Ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qc=Symbol.for("react.element"),S1=Symbol.for("react.portal"),C1=Symbol.for("react.fragment"),N1=Symbol.for("react.strict_mode"),A1=Symbol.for("react.profiler"),R1=Symbol.for("react.provider"),P1=Symbol.for("react.context"),k1=Symbol.for("react.forward_ref"),j1=Symbol.for("react.suspense"),D1=Symbol.for("react.memo"),O1=Symbol.for("react.lazy"),L_=Symbol.iterator;function L1(t){return t===null||typeof t!="object"?null:(t=L_&&t[L_]||t["@@iterator"],typeof t=="function"?t:null)}var Vb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Mb=Object.assign,Fb={};function Wa(t,e,n){this.props=t,this.context=e,this.refs=Fb,this.updater=n||Vb}Wa.prototype.isReactComponent={};Wa.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Wa.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Ub(){}Ub.prototype=Wa.prototype;function Cg(t,e,n){this.props=t,this.context=e,this.refs=Fb,this.updater=n||Vb}var Ng=Cg.prototype=new Ub;Ng.constructor=Cg;Mb(Ng,Wa.prototype);Ng.isPureReactComponent=!0;var V_=Array.isArray,$b=Object.prototype.hasOwnProperty,Ag={current:null},Bb={key:!0,ref:!0,__self:!0,__source:!0};function zb(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)$b.call(e,r)&&!Bb.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:qc,type:t,key:i,ref:o,props:s,_owner:Ag.current}}function V1(t,e){return{$$typeof:qc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Rg(t){return typeof t=="object"&&t!==null&&t.$$typeof===qc}function M1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var M_=/\/+/g;function Gf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?M1(""+t.key):e.toString(36)}function ed(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case qc:case S1:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Gf(o,0):r,V_(s)?(n="",t!=null&&(n=t.replace(M_,"$&/")+"/"),ed(s,e,n,"",function(d){return d})):s!=null&&(Rg(s)&&(s=V1(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(M_,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",V_(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Gf(i,l);o+=ed(i,e,n,c,s)}else if(c=L1(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Gf(i,l++),o+=ed(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Iu(t,e,n){if(t==null)return t;var r=[],s=0;return ed(t,r,"","",function(i){return e.call(n,i,s++)}),r}function F1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Sn={current:null},td={transition:null},U1={ReactCurrentDispatcher:Sn,ReactCurrentBatchConfig:td,ReactCurrentOwner:Ag};function qb(){throw Error("act(...) is not supported in production builds of React.")}Ue.Children={map:Iu,forEach:function(t,e,n){Iu(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Iu(t,function(){e++}),e},toArray:function(t){return Iu(t,function(e){return e})||[]},only:function(t){if(!Rg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ue.Component=Wa;Ue.Fragment=C1;Ue.Profiler=A1;Ue.PureComponent=Cg;Ue.StrictMode=N1;Ue.Suspense=j1;Ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U1;Ue.act=qb;Ue.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Mb({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Ag.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)$b.call(e,c)&&!Bb.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:qc,type:t.type,key:s,ref:i,props:r,_owner:o}};Ue.createContext=function(t){return t={$$typeof:P1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:R1,_context:t},t.Consumer=t};Ue.createElement=zb;Ue.createFactory=function(t){var e=zb.bind(null,t);return e.type=t,e};Ue.createRef=function(){return{current:null}};Ue.forwardRef=function(t){return{$$typeof:k1,render:t}};Ue.isValidElement=Rg;Ue.lazy=function(t){return{$$typeof:O1,_payload:{_status:-1,_result:t},_init:F1}};Ue.memo=function(t,e){return{$$typeof:D1,type:t,compare:e===void 0?null:e}};Ue.startTransition=function(t){var e=td.transition;td.transition={};try{t()}finally{td.transition=e}};Ue.unstable_act=qb;Ue.useCallback=function(t,e){return Sn.current.useCallback(t,e)};Ue.useContext=function(t){return Sn.current.useContext(t)};Ue.useDebugValue=function(){};Ue.useDeferredValue=function(t){return Sn.current.useDeferredValue(t)};Ue.useEffect=function(t,e){return Sn.current.useEffect(t,e)};Ue.useId=function(){return Sn.current.useId()};Ue.useImperativeHandle=function(t,e,n){return Sn.current.useImperativeHandle(t,e,n)};Ue.useInsertionEffect=function(t,e){return Sn.current.useInsertionEffect(t,e)};Ue.useLayoutEffect=function(t,e){return Sn.current.useLayoutEffect(t,e)};Ue.useMemo=function(t,e){return Sn.current.useMemo(t,e)};Ue.useReducer=function(t,e,n){return Sn.current.useReducer(t,e,n)};Ue.useRef=function(t){return Sn.current.useRef(t)};Ue.useState=function(t){return Sn.current.useState(t)};Ue.useSyncExternalStore=function(t,e,n){return Sn.current.useSyncExternalStore(t,e,n)};Ue.useTransition=function(){return Sn.current.useTransition()};Ue.version="18.3.1";Lb.exports=Ue;var S=Lb.exports;const Pg=T1(S);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $1=S,B1=Symbol.for("react.element"),z1=Symbol.for("react.fragment"),q1=Object.prototype.hasOwnProperty,H1=$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,W1={key:!0,ref:!0,__self:!0,__source:!0};function Hb(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)q1.call(e,r)&&!W1.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:B1,type:t,key:i,ref:o,props:s,_owner:H1.current}}Ph.Fragment=z1;Ph.jsx=Hb;Ph.jsxs=Hb;Ob.exports=Ph;var a=Ob.exports,Wb={exports:{}},Yn={},Gb={exports:{}},Kb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(re,fe){var ve=re.length;re.push(fe);e:for(;0<ve;){var ke=ve-1>>>1,We=re[ke];if(0<s(We,fe))re[ke]=fe,re[ve]=We,ve=ke;else break e}}function n(re){return re.length===0?null:re[0]}function r(re){if(re.length===0)return null;var fe=re[0],ve=re.pop();if(ve!==fe){re[0]=ve;e:for(var ke=0,We=re.length,It=We>>>1;ke<It;){var U=2*(ke+1)-1,ie=re[U],pe=U+1,Ne=re[pe];if(0>s(ie,ve))pe<We&&0>s(Ne,ie)?(re[ke]=Ne,re[pe]=ve,ke=pe):(re[ke]=ie,re[U]=ve,ke=U);else if(pe<We&&0>s(Ne,ve))re[ke]=Ne,re[pe]=ve,ke=pe;else break e}}return fe}function s(re,fe){var ve=re.sortIndex-fe.sortIndex;return ve!==0?ve:re.id-fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],f=1,h=null,m=3,v=!1,R=!1,N=!1,C=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(re){for(var fe=n(d);fe!==null;){if(fe.callback===null)r(d);else if(fe.startTime<=re)r(d),fe.sortIndex=fe.expirationTime,e(c,fe);else break;fe=n(d)}}function I(re){if(N=!1,E(re),!R)if(n(c)!==null)R=!0,_t(M);else{var fe=n(d);fe!==null&&kt(I,fe.startTime-re)}}function M(re,fe){R=!1,N&&(N=!1,y(x),x=-1),v=!0;var ve=m;try{for(E(fe),h=n(c);h!==null&&(!(h.expirationTime>fe)||re&&!D());){var ke=h.callback;if(typeof ke=="function"){h.callback=null,m=h.priorityLevel;var We=ke(h.expirationTime<=fe);fe=t.unstable_now(),typeof We=="function"?h.callback=We:h===n(c)&&r(c),E(fe)}else r(c);h=n(c)}if(h!==null)var It=!0;else{var U=n(d);U!==null&&kt(I,U.startTime-fe),It=!1}return It}finally{h=null,m=ve,v=!1}}var $=!1,b=null,x=-1,_=5,P=-1;function D(){return!(t.unstable_now()-P<_)}function j(){if(b!==null){var re=t.unstable_now();P=re;var fe=!0;try{fe=b(!0,re)}finally{fe?k():($=!1,b=null)}}else $=!1}var k;if(typeof w=="function")k=function(){w(j)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,He=Y.port2;Y.port1.onmessage=j,k=function(){He.postMessage(null)}}else k=function(){C(j,0)};function _t(re){b=re,$||($=!0,k())}function kt(re,fe){x=C(function(){re(t.unstable_now())},fe)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(re){re.callback=null},t.unstable_continueExecution=function(){R||v||(R=!0,_t(M))},t.unstable_forceFrameRate=function(re){0>re||125<re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<re?Math.floor(1e3/re):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(re){switch(m){case 1:case 2:case 3:var fe=3;break;default:fe=m}var ve=m;m=fe;try{return re()}finally{m=ve}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(re,fe){switch(re){case 1:case 2:case 3:case 4:case 5:break;default:re=3}var ve=m;m=re;try{return fe()}finally{m=ve}},t.unstable_scheduleCallback=function(re,fe,ve){var ke=t.unstable_now();switch(typeof ve=="object"&&ve!==null?(ve=ve.delay,ve=typeof ve=="number"&&0<ve?ke+ve:ke):ve=ke,re){case 1:var We=-1;break;case 2:We=250;break;case 5:We=1073741823;break;case 4:We=1e4;break;default:We=5e3}return We=ve+We,re={id:f++,callback:fe,priorityLevel:re,startTime:ve,expirationTime:We,sortIndex:-1},ve>ke?(re.sortIndex=ve,e(d,re),n(c)===null&&re===n(d)&&(N?(y(x),x=-1):N=!0,kt(I,ve-ke))):(re.sortIndex=We,e(c,re),R||v||(R=!0,_t(M))),re},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(re){var fe=m;return function(){var ve=m;m=fe;try{return re.apply(this,arguments)}finally{m=ve}}}})(Kb);Gb.exports=Kb;var G1=Gb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K1=S,Kn=G1;function Z(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Qb=new Set,uc={};function To(t,e){Ta(t,e),Ta(t+"Capture",e)}function Ta(t,e){for(uc[t]=e,t=0;t<e.length;t++)Qb.add(e[t])}var ps=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xp=Object.prototype.hasOwnProperty,Q1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,F_={},U_={};function Y1(t){return Xp.call(U_,t)?!0:Xp.call(F_,t)?!1:Q1.test(t)?U_[t]=!0:(F_[t]=!0,!1)}function X1(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function J1(t,e,n,r){if(e===null||typeof e>"u"||X1(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Cn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var sn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){sn[t]=new Cn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];sn[e]=new Cn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){sn[t]=new Cn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){sn[t]=new Cn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){sn[t]=new Cn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){sn[t]=new Cn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){sn[t]=new Cn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){sn[t]=new Cn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){sn[t]=new Cn(t,5,!1,t.toLowerCase(),null,!1,!1)});var kg=/[\-:]([a-z])/g;function jg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(kg,jg);sn[e]=new Cn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(kg,jg);sn[e]=new Cn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(kg,jg);sn[e]=new Cn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){sn[t]=new Cn(t,1,!1,t.toLowerCase(),null,!1,!1)});sn.xlinkHref=new Cn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){sn[t]=new Cn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Dg(t,e,n,r){var s=sn.hasOwnProperty(e)?sn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(J1(e,n,s,r)&&(n=null),r||s===null?Y1(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Is=K1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Tu=Symbol.for("react.element"),Zo=Symbol.for("react.portal"),ea=Symbol.for("react.fragment"),Og=Symbol.for("react.strict_mode"),Jp=Symbol.for("react.profiler"),Yb=Symbol.for("react.provider"),Xb=Symbol.for("react.context"),Lg=Symbol.for("react.forward_ref"),Zp=Symbol.for("react.suspense"),em=Symbol.for("react.suspense_list"),Vg=Symbol.for("react.memo"),Fs=Symbol.for("react.lazy"),Jb=Symbol.for("react.offscreen"),$_=Symbol.iterator;function ml(t){return t===null||typeof t!="object"?null:(t=$_&&t[$_]||t["@@iterator"],typeof t=="function"?t:null)}var bt=Object.assign,Kf;function kl(t){if(Kf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Kf=e&&e[1]||""}return`
`+Kf+t}var Qf=!1;function Yf(t,e){if(!t||Qf)return"";Qf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{Qf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?kl(t):""}function Z1(t){switch(t.tag){case 5:return kl(t.type);case 16:return kl("Lazy");case 13:return kl("Suspense");case 19:return kl("SuspenseList");case 0:case 2:case 15:return t=Yf(t.type,!1),t;case 11:return t=Yf(t.type.render,!1),t;case 1:return t=Yf(t.type,!0),t;default:return""}}function tm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ea:return"Fragment";case Zo:return"Portal";case Jp:return"Profiler";case Og:return"StrictMode";case Zp:return"Suspense";case em:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Xb:return(t.displayName||"Context")+".Consumer";case Yb:return(t._context.displayName||"Context")+".Provider";case Lg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Vg:return e=t.displayName||null,e!==null?e:tm(t.type)||"Memo";case Fs:e=t._payload,t=t._init;try{return tm(t(e))}catch{}}return null}function eA(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tm(e);case 8:return e===Og?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function fi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Zb(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function tA(t){var e=Zb(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Su(t){t._valueTracker||(t._valueTracker=tA(t))}function eI(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Zb(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Rd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function nm(t,e){var n=e.checked;return bt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function B_(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=fi(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function tI(t,e){e=e.checked,e!=null&&Dg(t,"checked",e,!1)}function rm(t,e){tI(t,e);var n=fi(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?sm(t,e.type,n):e.hasOwnProperty("defaultValue")&&sm(t,e.type,fi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function z_(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function sm(t,e,n){(e!=="number"||Rd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var jl=Array.isArray;function ha(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+fi(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function im(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Z(91));return bt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function q_(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Z(92));if(jl(n)){if(1<n.length)throw Error(Z(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:fi(n)}}function nI(t,e){var n=fi(e.value),r=fi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function H_(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function rI(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function om(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?rI(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Cu,sI=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Cu=Cu||document.createElement("div"),Cu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Cu.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function dc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Hl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nA=["Webkit","ms","Moz","O"];Object.keys(Hl).forEach(function(t){nA.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Hl[e]=Hl[t]})});function iI(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Hl.hasOwnProperty(t)&&Hl[t]?(""+e).trim():e+"px"}function oI(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=iI(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var rA=bt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function am(t,e){if(e){if(rA[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Z(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Z(62))}}function lm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cm=null;function Mg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var um=null,fa=null,pa=null;function W_(t){if(t=Gc(t)){if(typeof um!="function")throw Error(Z(280));var e=t.stateNode;e&&(e=Lh(e),um(t.stateNode,t.type,e))}}function aI(t){fa?pa?pa.push(t):pa=[t]:fa=t}function lI(){if(fa){var t=fa,e=pa;if(pa=fa=null,W_(t),e)for(t=0;t<e.length;t++)W_(e[t])}}function cI(t,e){return t(e)}function uI(){}var Xf=!1;function dI(t,e,n){if(Xf)return t(e,n);Xf=!0;try{return cI(t,e,n)}finally{Xf=!1,(fa!==null||pa!==null)&&(uI(),lI())}}function hc(t,e){var n=t.stateNode;if(n===null)return null;var r=Lh(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Z(231,e,typeof n));return n}var dm=!1;if(ps)try{var gl={};Object.defineProperty(gl,"passive",{get:function(){dm=!0}}),window.addEventListener("test",gl,gl),window.removeEventListener("test",gl,gl)}catch{dm=!1}function sA(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(f){this.onError(f)}}var Wl=!1,Pd=null,kd=!1,hm=null,iA={onError:function(t){Wl=!0,Pd=t}};function oA(t,e,n,r,s,i,o,l,c){Wl=!1,Pd=null,sA.apply(iA,arguments)}function aA(t,e,n,r,s,i,o,l,c){if(oA.apply(this,arguments),Wl){if(Wl){var d=Pd;Wl=!1,Pd=null}else throw Error(Z(198));kd||(kd=!0,hm=d)}}function So(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function hI(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function G_(t){if(So(t)!==t)throw Error(Z(188))}function lA(t){var e=t.alternate;if(!e){if(e=So(t),e===null)throw Error(Z(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return G_(s),t;if(i===r)return G_(s),e;i=i.sibling}throw Error(Z(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(Z(189))}}if(n.alternate!==r)throw Error(Z(190))}if(n.tag!==3)throw Error(Z(188));return n.stateNode.current===n?t:e}function fI(t){return t=lA(t),t!==null?pI(t):null}function pI(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=pI(t);if(e!==null)return e;t=t.sibling}return null}var mI=Kn.unstable_scheduleCallback,K_=Kn.unstable_cancelCallback,cA=Kn.unstable_shouldYield,uA=Kn.unstable_requestPaint,Pt=Kn.unstable_now,dA=Kn.unstable_getCurrentPriorityLevel,Fg=Kn.unstable_ImmediatePriority,gI=Kn.unstable_UserBlockingPriority,jd=Kn.unstable_NormalPriority,hA=Kn.unstable_LowPriority,yI=Kn.unstable_IdlePriority,kh=null,Gr=null;function fA(t){if(Gr&&typeof Gr.onCommitFiberRoot=="function")try{Gr.onCommitFiberRoot(kh,t,void 0,(t.current.flags&128)===128)}catch{}}var br=Math.clz32?Math.clz32:gA,pA=Math.log,mA=Math.LN2;function gA(t){return t>>>=0,t===0?32:31-(pA(t)/mA|0)|0}var Nu=64,Au=4194304;function Dl(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Dd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=Dl(l):(i&=o,i!==0&&(r=Dl(i)))}else o=n&~s,o!==0?r=Dl(o):i!==0&&(r=Dl(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-br(e),s=1<<n,r|=t[n],e&=~s;return r}function yA(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vA(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-br(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=yA(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function fm(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function vI(){var t=Nu;return Nu<<=1,!(Nu&4194240)&&(Nu=64),t}function Jf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Hc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-br(e),t[e]=n}function _A(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-br(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Ug(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-br(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var it=0;function _I(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var wI,$g,xI,EI,bI,pm=!1,Ru=[],Zs=null,ei=null,ti=null,fc=new Map,pc=new Map,$s=[],wA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Q_(t,e){switch(t){case"focusin":case"focusout":Zs=null;break;case"dragenter":case"dragleave":ei=null;break;case"mouseover":case"mouseout":ti=null;break;case"pointerover":case"pointerout":fc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":pc.delete(e.pointerId)}}function yl(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Gc(e),e!==null&&$g(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function xA(t,e,n,r,s){switch(e){case"focusin":return Zs=yl(Zs,t,e,n,r,s),!0;case"dragenter":return ei=yl(ei,t,e,n,r,s),!0;case"mouseover":return ti=yl(ti,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return fc.set(i,yl(fc.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,pc.set(i,yl(pc.get(i)||null,t,e,n,r,s)),!0}return!1}function II(t){var e=Wi(t.target);if(e!==null){var n=So(e);if(n!==null){if(e=n.tag,e===13){if(e=hI(n),e!==null){t.blockedOn=e,bI(t.priority,function(){xI(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function nd(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=mm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);cm=r,n.target.dispatchEvent(r),cm=null}else return e=Gc(n),e!==null&&$g(e),t.blockedOn=n,!1;e.shift()}return!0}function Y_(t,e,n){nd(t)&&n.delete(e)}function EA(){pm=!1,Zs!==null&&nd(Zs)&&(Zs=null),ei!==null&&nd(ei)&&(ei=null),ti!==null&&nd(ti)&&(ti=null),fc.forEach(Y_),pc.forEach(Y_)}function vl(t,e){t.blockedOn===e&&(t.blockedOn=null,pm||(pm=!0,Kn.unstable_scheduleCallback(Kn.unstable_NormalPriority,EA)))}function mc(t){function e(s){return vl(s,t)}if(0<Ru.length){vl(Ru[0],t);for(var n=1;n<Ru.length;n++){var r=Ru[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Zs!==null&&vl(Zs,t),ei!==null&&vl(ei,t),ti!==null&&vl(ti,t),fc.forEach(e),pc.forEach(e),n=0;n<$s.length;n++)r=$s[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<$s.length&&(n=$s[0],n.blockedOn===null);)II(n),n.blockedOn===null&&$s.shift()}var ma=Is.ReactCurrentBatchConfig,Od=!0;function bA(t,e,n,r){var s=it,i=ma.transition;ma.transition=null;try{it=1,Bg(t,e,n,r)}finally{it=s,ma.transition=i}}function IA(t,e,n,r){var s=it,i=ma.transition;ma.transition=null;try{it=4,Bg(t,e,n,r)}finally{it=s,ma.transition=i}}function Bg(t,e,n,r){if(Od){var s=mm(t,e,n,r);if(s===null)lp(t,e,r,Ld,n),Q_(t,r);else if(xA(s,t,e,n,r))r.stopPropagation();else if(Q_(t,r),e&4&&-1<wA.indexOf(t)){for(;s!==null;){var i=Gc(s);if(i!==null&&wI(i),i=mm(t,e,n,r),i===null&&lp(t,e,r,Ld,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else lp(t,e,r,null,n)}}var Ld=null;function mm(t,e,n,r){if(Ld=null,t=Mg(r),t=Wi(t),t!==null)if(e=So(t),e===null)t=null;else if(n=e.tag,n===13){if(t=hI(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ld=t,null}function TI(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dA()){case Fg:return 1;case gI:return 4;case jd:case hA:return 16;case yI:return 536870912;default:return 16}default:return 16}}var Ys=null,zg=null,rd=null;function SI(){if(rd)return rd;var t,e=zg,n=e.length,r,s="value"in Ys?Ys.value:Ys.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return rd=s.slice(t,1<r?1-r:void 0)}function sd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Pu(){return!0}function X_(){return!1}function Xn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Pu:X_,this.isPropagationStopped=X_,this}return bt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Pu)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Pu)},persist:function(){},isPersistent:Pu}),e}var Ga={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qg=Xn(Ga),Wc=bt({},Ga,{view:0,detail:0}),TA=Xn(Wc),Zf,ep,_l,jh=bt({},Wc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==_l&&(_l&&t.type==="mousemove"?(Zf=t.screenX-_l.screenX,ep=t.screenY-_l.screenY):ep=Zf=0,_l=t),Zf)},movementY:function(t){return"movementY"in t?t.movementY:ep}}),J_=Xn(jh),SA=bt({},jh,{dataTransfer:0}),CA=Xn(SA),NA=bt({},Wc,{relatedTarget:0}),tp=Xn(NA),AA=bt({},Ga,{animationName:0,elapsedTime:0,pseudoElement:0}),RA=Xn(AA),PA=bt({},Ga,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),kA=Xn(PA),jA=bt({},Ga,{data:0}),Z_=Xn(jA),DA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},OA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},LA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VA(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=LA[t])?!!e[t]:!1}function Hg(){return VA}var MA=bt({},Wc,{key:function(t){if(t.key){var e=DA[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=sd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?OA[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hg,charCode:function(t){return t.type==="keypress"?sd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?sd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),FA=Xn(MA),UA=bt({},jh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ew=Xn(UA),$A=bt({},Wc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hg}),BA=Xn($A),zA=bt({},Ga,{propertyName:0,elapsedTime:0,pseudoElement:0}),qA=Xn(zA),HA=bt({},jh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),WA=Xn(HA),GA=[9,13,27,32],Wg=ps&&"CompositionEvent"in window,Gl=null;ps&&"documentMode"in document&&(Gl=document.documentMode);var KA=ps&&"TextEvent"in window&&!Gl,CI=ps&&(!Wg||Gl&&8<Gl&&11>=Gl),tw=" ",nw=!1;function NI(t,e){switch(t){case"keyup":return GA.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function AI(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ta=!1;function QA(t,e){switch(t){case"compositionend":return AI(e);case"keypress":return e.which!==32?null:(nw=!0,tw);case"textInput":return t=e.data,t===tw&&nw?null:t;default:return null}}function YA(t,e){if(ta)return t==="compositionend"||!Wg&&NI(t,e)?(t=SI(),rd=zg=Ys=null,ta=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return CI&&e.locale!=="ko"?null:e.data;default:return null}}var XA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rw(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!XA[t.type]:e==="textarea"}function RI(t,e,n,r){aI(r),e=Vd(e,"onChange"),0<e.length&&(n=new qg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Kl=null,gc=null;function JA(t){$I(t,0)}function Dh(t){var e=sa(t);if(eI(e))return t}function ZA(t,e){if(t==="change")return e}var PI=!1;if(ps){var np;if(ps){var rp="oninput"in document;if(!rp){var sw=document.createElement("div");sw.setAttribute("oninput","return;"),rp=typeof sw.oninput=="function"}np=rp}else np=!1;PI=np&&(!document.documentMode||9<document.documentMode)}function iw(){Kl&&(Kl.detachEvent("onpropertychange",kI),gc=Kl=null)}function kI(t){if(t.propertyName==="value"&&Dh(gc)){var e=[];RI(e,gc,t,Mg(t)),dI(JA,e)}}function eR(t,e,n){t==="focusin"?(iw(),Kl=e,gc=n,Kl.attachEvent("onpropertychange",kI)):t==="focusout"&&iw()}function tR(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Dh(gc)}function nR(t,e){if(t==="click")return Dh(e)}function rR(t,e){if(t==="input"||t==="change")return Dh(e)}function sR(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Sr=typeof Object.is=="function"?Object.is:sR;function yc(t,e){if(Sr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Xp.call(e,s)||!Sr(t[s],e[s]))return!1}return!0}function ow(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function aw(t,e){var n=ow(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ow(n)}}function jI(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?jI(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function DI(){for(var t=window,e=Rd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Rd(t.document)}return e}function Gg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function iR(t){var e=DI(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&jI(n.ownerDocument.documentElement,n)){if(r!==null&&Gg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=aw(n,i);var o=aw(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var oR=ps&&"documentMode"in document&&11>=document.documentMode,na=null,gm=null,Ql=null,ym=!1;function lw(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ym||na==null||na!==Rd(r)||(r=na,"selectionStart"in r&&Gg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ql&&yc(Ql,r)||(Ql=r,r=Vd(gm,"onSelect"),0<r.length&&(e=new qg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=na)))}function ku(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ra={animationend:ku("Animation","AnimationEnd"),animationiteration:ku("Animation","AnimationIteration"),animationstart:ku("Animation","AnimationStart"),transitionend:ku("Transition","TransitionEnd")},sp={},OI={};ps&&(OI=document.createElement("div").style,"AnimationEvent"in window||(delete ra.animationend.animation,delete ra.animationiteration.animation,delete ra.animationstart.animation),"TransitionEvent"in window||delete ra.transitionend.transition);function Oh(t){if(sp[t])return sp[t];if(!ra[t])return t;var e=ra[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in OI)return sp[t]=e[n];return t}var LI=Oh("animationend"),VI=Oh("animationiteration"),MI=Oh("animationstart"),FI=Oh("transitionend"),UI=new Map,cw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wi(t,e){UI.set(t,e),To(e,[t])}for(var ip=0;ip<cw.length;ip++){var op=cw[ip],aR=op.toLowerCase(),lR=op[0].toUpperCase()+op.slice(1);wi(aR,"on"+lR)}wi(LI,"onAnimationEnd");wi(VI,"onAnimationIteration");wi(MI,"onAnimationStart");wi("dblclick","onDoubleClick");wi("focusin","onFocus");wi("focusout","onBlur");wi(FI,"onTransitionEnd");Ta("onMouseEnter",["mouseout","mouseover"]);Ta("onMouseLeave",["mouseout","mouseover"]);Ta("onPointerEnter",["pointerout","pointerover"]);Ta("onPointerLeave",["pointerout","pointerover"]);To("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));To("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));To("onBeforeInput",["compositionend","keypress","textInput","paste"]);To("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));To("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));To("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ol="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cR=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ol));function uw(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,aA(r,e,void 0,t),t.currentTarget=null}function $I(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;uw(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;uw(s,l,d),i=c}}}if(kd)throw t=hm,kd=!1,hm=null,t}function ft(t,e){var n=e[Em];n===void 0&&(n=e[Em]=new Set);var r=t+"__bubble";n.has(r)||(BI(e,t,2,!1),n.add(r))}function ap(t,e,n){var r=0;e&&(r|=4),BI(n,t,r,e)}var ju="_reactListening"+Math.random().toString(36).slice(2);function vc(t){if(!t[ju]){t[ju]=!0,Qb.forEach(function(n){n!=="selectionchange"&&(cR.has(n)||ap(n,!1,t),ap(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ju]||(e[ju]=!0,ap("selectionchange",!1,e))}}function BI(t,e,n,r){switch(TI(e)){case 1:var s=bA;break;case 4:s=IA;break;default:s=Bg}n=s.bind(null,e,n,t),s=void 0,!dm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function lp(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=Wi(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}dI(function(){var d=i,f=Mg(n),h=[];e:{var m=UI.get(t);if(m!==void 0){var v=qg,R=t;switch(t){case"keypress":if(sd(n)===0)break e;case"keydown":case"keyup":v=FA;break;case"focusin":R="focus",v=tp;break;case"focusout":R="blur",v=tp;break;case"beforeblur":case"afterblur":v=tp;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":v=J_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":v=CA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":v=BA;break;case LI:case VI:case MI:v=RA;break;case FI:v=qA;break;case"scroll":v=TA;break;case"wheel":v=WA;break;case"copy":case"cut":case"paste":v=kA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":v=ew}var N=(e&4)!==0,C=!N&&t==="scroll",y=N?m!==null?m+"Capture":null:m;N=[];for(var w=d,E;w!==null;){E=w;var I=E.stateNode;if(E.tag===5&&I!==null&&(E=I,y!==null&&(I=hc(w,y),I!=null&&N.push(_c(w,I,E)))),C)break;w=w.return}0<N.length&&(m=new v(m,R,null,n,f),h.push({event:m,listeners:N}))}}if(!(e&7)){e:{if(m=t==="mouseover"||t==="pointerover",v=t==="mouseout"||t==="pointerout",m&&n!==cm&&(R=n.relatedTarget||n.fromElement)&&(Wi(R)||R[ms]))break e;if((v||m)&&(m=f.window===f?f:(m=f.ownerDocument)?m.defaultView||m.parentWindow:window,v?(R=n.relatedTarget||n.toElement,v=d,R=R?Wi(R):null,R!==null&&(C=So(R),R!==C||R.tag!==5&&R.tag!==6)&&(R=null)):(v=null,R=d),v!==R)){if(N=J_,I="onMouseLeave",y="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(N=ew,I="onPointerLeave",y="onPointerEnter",w="pointer"),C=v==null?m:sa(v),E=R==null?m:sa(R),m=new N(I,w+"leave",v,n,f),m.target=C,m.relatedTarget=E,I=null,Wi(f)===d&&(N=new N(y,w+"enter",R,n,f),N.target=E,N.relatedTarget=C,I=N),C=I,v&&R)t:{for(N=v,y=R,w=0,E=N;E;E=Oo(E))w++;for(E=0,I=y;I;I=Oo(I))E++;for(;0<w-E;)N=Oo(N),w--;for(;0<E-w;)y=Oo(y),E--;for(;w--;){if(N===y||y!==null&&N===y.alternate)break t;N=Oo(N),y=Oo(y)}N=null}else N=null;v!==null&&dw(h,m,v,N,!1),R!==null&&C!==null&&dw(h,C,R,N,!0)}}e:{if(m=d?sa(d):window,v=m.nodeName&&m.nodeName.toLowerCase(),v==="select"||v==="input"&&m.type==="file")var M=ZA;else if(rw(m))if(PI)M=rR;else{M=tR;var $=eR}else(v=m.nodeName)&&v.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(M=nR);if(M&&(M=M(t,d))){RI(h,M,n,f);break e}$&&$(t,m,d),t==="focusout"&&($=m._wrapperState)&&$.controlled&&m.type==="number"&&sm(m,"number",m.value)}switch($=d?sa(d):window,t){case"focusin":(rw($)||$.contentEditable==="true")&&(na=$,gm=d,Ql=null);break;case"focusout":Ql=gm=na=null;break;case"mousedown":ym=!0;break;case"contextmenu":case"mouseup":case"dragend":ym=!1,lw(h,n,f);break;case"selectionchange":if(oR)break;case"keydown":case"keyup":lw(h,n,f)}var b;if(Wg)e:{switch(t){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else ta?NI(t,n)&&(x="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(x="onCompositionStart");x&&(CI&&n.locale!=="ko"&&(ta||x!=="onCompositionStart"?x==="onCompositionEnd"&&ta&&(b=SI()):(Ys=f,zg="value"in Ys?Ys.value:Ys.textContent,ta=!0)),$=Vd(d,x),0<$.length&&(x=new Z_(x,t,null,n,f),h.push({event:x,listeners:$}),b?x.data=b:(b=AI(n),b!==null&&(x.data=b)))),(b=KA?QA(t,n):YA(t,n))&&(d=Vd(d,"onBeforeInput"),0<d.length&&(f=new Z_("onBeforeInput","beforeinput",null,n,f),h.push({event:f,listeners:d}),f.data=b))}$I(h,e)})}function _c(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Vd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=hc(t,n),i!=null&&r.unshift(_c(t,i,s)),i=hc(t,e),i!=null&&r.push(_c(t,i,s))),t=t.return}return r}function Oo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function dw(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=hc(n,i),c!=null&&o.unshift(_c(n,c,l))):s||(c=hc(n,i),c!=null&&o.push(_c(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var uR=/\r\n?/g,dR=/\u0000|\uFFFD/g;function hw(t){return(typeof t=="string"?t:""+t).replace(uR,`
`).replace(dR,"")}function Du(t,e,n){if(e=hw(e),hw(t)!==e&&n)throw Error(Z(425))}function Md(){}var vm=null,_m=null;function wm(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xm=typeof setTimeout=="function"?setTimeout:void 0,hR=typeof clearTimeout=="function"?clearTimeout:void 0,fw=typeof Promise=="function"?Promise:void 0,fR=typeof queueMicrotask=="function"?queueMicrotask:typeof fw<"u"?function(t){return fw.resolve(null).then(t).catch(pR)}:xm;function pR(t){setTimeout(function(){throw t})}function cp(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),mc(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);mc(e)}function ni(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function pw(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ka=Math.random().toString(36).slice(2),zr="__reactFiber$"+Ka,wc="__reactProps$"+Ka,ms="__reactContainer$"+Ka,Em="__reactEvents$"+Ka,mR="__reactListeners$"+Ka,gR="__reactHandles$"+Ka;function Wi(t){var e=t[zr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ms]||n[zr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=pw(t);t!==null;){if(n=t[zr])return n;t=pw(t)}return e}t=n,n=t.parentNode}return null}function Gc(t){return t=t[zr]||t[ms],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function sa(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Z(33))}function Lh(t){return t[wc]||null}var bm=[],ia=-1;function xi(t){return{current:t}}function pt(t){0>ia||(t.current=bm[ia],bm[ia]=null,ia--)}function ut(t,e){ia++,bm[ia]=t.current,t.current=e}var pi={},gn=xi(pi),Dn=xi(!1),io=pi;function Sa(t,e){var n=t.type.contextTypes;if(!n)return pi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function On(t){return t=t.childContextTypes,t!=null}function Fd(){pt(Dn),pt(gn)}function mw(t,e,n){if(gn.current!==pi)throw Error(Z(168));ut(gn,e),ut(Dn,n)}function zI(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Z(108,eA(t)||"Unknown",s));return bt({},n,r)}function Ud(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||pi,io=gn.current,ut(gn,t),ut(Dn,Dn.current),!0}function gw(t,e,n){var r=t.stateNode;if(!r)throw Error(Z(169));n?(t=zI(t,e,io),r.__reactInternalMemoizedMergedChildContext=t,pt(Dn),pt(gn),ut(gn,t)):pt(Dn),ut(Dn,n)}var is=null,Vh=!1,up=!1;function qI(t){is===null?is=[t]:is.push(t)}function yR(t){Vh=!0,qI(t)}function Ei(){if(!up&&is!==null){up=!0;var t=0,e=it;try{var n=is;for(it=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}is=null,Vh=!1}catch(s){throw is!==null&&(is=is.slice(t+1)),mI(Fg,Ei),s}finally{it=e,up=!1}}return null}var oa=[],aa=0,$d=null,Bd=0,tr=[],nr=0,oo=null,os=1,as="";function Li(t,e){oa[aa++]=Bd,oa[aa++]=$d,$d=t,Bd=e}function HI(t,e,n){tr[nr++]=os,tr[nr++]=as,tr[nr++]=oo,oo=t;var r=os;t=as;var s=32-br(r)-1;r&=~(1<<s),n+=1;var i=32-br(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,os=1<<32-br(e)+s|n<<s|r,as=i+t}else os=1<<i|n<<s|r,as=t}function Kg(t){t.return!==null&&(Li(t,1),HI(t,1,0))}function Qg(t){for(;t===$d;)$d=oa[--aa],oa[aa]=null,Bd=oa[--aa],oa[aa]=null;for(;t===oo;)oo=tr[--nr],tr[nr]=null,as=tr[--nr],tr[nr]=null,os=tr[--nr],tr[nr]=null}var Wn=null,qn=null,gt=!1,xr=null;function WI(t,e){var n=ir(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function yw(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Wn=t,qn=ni(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Wn=t,qn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=oo!==null?{id:os,overflow:as}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ir(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Wn=t,qn=null,!0):!1;default:return!1}}function Im(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Tm(t){if(gt){var e=qn;if(e){var n=e;if(!yw(t,e)){if(Im(t))throw Error(Z(418));e=ni(n.nextSibling);var r=Wn;e&&yw(t,e)?WI(r,n):(t.flags=t.flags&-4097|2,gt=!1,Wn=t)}}else{if(Im(t))throw Error(Z(418));t.flags=t.flags&-4097|2,gt=!1,Wn=t}}}function vw(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Wn=t}function Ou(t){if(t!==Wn)return!1;if(!gt)return vw(t),gt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!wm(t.type,t.memoizedProps)),e&&(e=qn)){if(Im(t))throw GI(),Error(Z(418));for(;e;)WI(t,e),e=ni(e.nextSibling)}if(vw(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Z(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){qn=ni(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}qn=null}}else qn=Wn?ni(t.stateNode.nextSibling):null;return!0}function GI(){for(var t=qn;t;)t=ni(t.nextSibling)}function Ca(){qn=Wn=null,gt=!1}function Yg(t){xr===null?xr=[t]:xr.push(t)}var vR=Is.ReactCurrentBatchConfig;function wl(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Z(309));var r=n.stateNode}if(!r)throw Error(Z(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(Z(284));if(!n._owner)throw Error(Z(290,t))}return t}function Lu(t,e){throw t=Object.prototype.toString.call(e),Error(Z(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function _w(t){var e=t._init;return e(t._payload)}function KI(t){function e(y,w){if(t){var E=y.deletions;E===null?(y.deletions=[w],y.flags|=16):E.push(w)}}function n(y,w){if(!t)return null;for(;w!==null;)e(y,w),w=w.sibling;return null}function r(y,w){for(y=new Map;w!==null;)w.key!==null?y.set(w.key,w):y.set(w.index,w),w=w.sibling;return y}function s(y,w){return y=oi(y,w),y.index=0,y.sibling=null,y}function i(y,w,E){return y.index=E,t?(E=y.alternate,E!==null?(E=E.index,E<w?(y.flags|=2,w):E):(y.flags|=2,w)):(y.flags|=1048576,w)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function l(y,w,E,I){return w===null||w.tag!==6?(w=yp(E,y.mode,I),w.return=y,w):(w=s(w,E),w.return=y,w)}function c(y,w,E,I){var M=E.type;return M===ea?f(y,w,E.props.children,I,E.key):w!==null&&(w.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Fs&&_w(M)===w.type)?(I=s(w,E.props),I.ref=wl(y,w,E),I.return=y,I):(I=dd(E.type,E.key,E.props,null,y.mode,I),I.ref=wl(y,w,E),I.return=y,I)}function d(y,w,E,I){return w===null||w.tag!==4||w.stateNode.containerInfo!==E.containerInfo||w.stateNode.implementation!==E.implementation?(w=vp(E,y.mode,I),w.return=y,w):(w=s(w,E.children||[]),w.return=y,w)}function f(y,w,E,I,M){return w===null||w.tag!==7?(w=Ji(E,y.mode,I,M),w.return=y,w):(w=s(w,E),w.return=y,w)}function h(y,w,E){if(typeof w=="string"&&w!==""||typeof w=="number")return w=yp(""+w,y.mode,E),w.return=y,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Tu:return E=dd(w.type,w.key,w.props,null,y.mode,E),E.ref=wl(y,null,w),E.return=y,E;case Zo:return w=vp(w,y.mode,E),w.return=y,w;case Fs:var I=w._init;return h(y,I(w._payload),E)}if(jl(w)||ml(w))return w=Ji(w,y.mode,E,null),w.return=y,w;Lu(y,w)}return null}function m(y,w,E,I){var M=w!==null?w.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return M!==null?null:l(y,w,""+E,I);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Tu:return E.key===M?c(y,w,E,I):null;case Zo:return E.key===M?d(y,w,E,I):null;case Fs:return M=E._init,m(y,w,M(E._payload),I)}if(jl(E)||ml(E))return M!==null?null:f(y,w,E,I,null);Lu(y,E)}return null}function v(y,w,E,I,M){if(typeof I=="string"&&I!==""||typeof I=="number")return y=y.get(E)||null,l(w,y,""+I,M);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Tu:return y=y.get(I.key===null?E:I.key)||null,c(w,y,I,M);case Zo:return y=y.get(I.key===null?E:I.key)||null,d(w,y,I,M);case Fs:var $=I._init;return v(y,w,E,$(I._payload),M)}if(jl(I)||ml(I))return y=y.get(E)||null,f(w,y,I,M,null);Lu(w,I)}return null}function R(y,w,E,I){for(var M=null,$=null,b=w,x=w=0,_=null;b!==null&&x<E.length;x++){b.index>x?(_=b,b=null):_=b.sibling;var P=m(y,b,E[x],I);if(P===null){b===null&&(b=_);break}t&&b&&P.alternate===null&&e(y,b),w=i(P,w,x),$===null?M=P:$.sibling=P,$=P,b=_}if(x===E.length)return n(y,b),gt&&Li(y,x),M;if(b===null){for(;x<E.length;x++)b=h(y,E[x],I),b!==null&&(w=i(b,w,x),$===null?M=b:$.sibling=b,$=b);return gt&&Li(y,x),M}for(b=r(y,b);x<E.length;x++)_=v(b,y,x,E[x],I),_!==null&&(t&&_.alternate!==null&&b.delete(_.key===null?x:_.key),w=i(_,w,x),$===null?M=_:$.sibling=_,$=_);return t&&b.forEach(function(D){return e(y,D)}),gt&&Li(y,x),M}function N(y,w,E,I){var M=ml(E);if(typeof M!="function")throw Error(Z(150));if(E=M.call(E),E==null)throw Error(Z(151));for(var $=M=null,b=w,x=w=0,_=null,P=E.next();b!==null&&!P.done;x++,P=E.next()){b.index>x?(_=b,b=null):_=b.sibling;var D=m(y,b,P.value,I);if(D===null){b===null&&(b=_);break}t&&b&&D.alternate===null&&e(y,b),w=i(D,w,x),$===null?M=D:$.sibling=D,$=D,b=_}if(P.done)return n(y,b),gt&&Li(y,x),M;if(b===null){for(;!P.done;x++,P=E.next())P=h(y,P.value,I),P!==null&&(w=i(P,w,x),$===null?M=P:$.sibling=P,$=P);return gt&&Li(y,x),M}for(b=r(y,b);!P.done;x++,P=E.next())P=v(b,y,x,P.value,I),P!==null&&(t&&P.alternate!==null&&b.delete(P.key===null?x:P.key),w=i(P,w,x),$===null?M=P:$.sibling=P,$=P);return t&&b.forEach(function(j){return e(y,j)}),gt&&Li(y,x),M}function C(y,w,E,I){if(typeof E=="object"&&E!==null&&E.type===ea&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case Tu:e:{for(var M=E.key,$=w;$!==null;){if($.key===M){if(M=E.type,M===ea){if($.tag===7){n(y,$.sibling),w=s($,E.props.children),w.return=y,y=w;break e}}else if($.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===Fs&&_w(M)===$.type){n(y,$.sibling),w=s($,E.props),w.ref=wl(y,$,E),w.return=y,y=w;break e}n(y,$);break}else e(y,$);$=$.sibling}E.type===ea?(w=Ji(E.props.children,y.mode,I,E.key),w.return=y,y=w):(I=dd(E.type,E.key,E.props,null,y.mode,I),I.ref=wl(y,w,E),I.return=y,y=I)}return o(y);case Zo:e:{for($=E.key;w!==null;){if(w.key===$)if(w.tag===4&&w.stateNode.containerInfo===E.containerInfo&&w.stateNode.implementation===E.implementation){n(y,w.sibling),w=s(w,E.children||[]),w.return=y,y=w;break e}else{n(y,w);break}else e(y,w);w=w.sibling}w=vp(E,y.mode,I),w.return=y,y=w}return o(y);case Fs:return $=E._init,C(y,w,$(E._payload),I)}if(jl(E))return R(y,w,E,I);if(ml(E))return N(y,w,E,I);Lu(y,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,w!==null&&w.tag===6?(n(y,w.sibling),w=s(w,E),w.return=y,y=w):(n(y,w),w=yp(E,y.mode,I),w.return=y,y=w),o(y)):n(y,w)}return C}var Na=KI(!0),QI=KI(!1),zd=xi(null),qd=null,la=null,Xg=null;function Jg(){Xg=la=qd=null}function Zg(t){var e=zd.current;pt(zd),t._currentValue=e}function Sm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ga(t,e){qd=t,Xg=la=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(kn=!0),t.firstContext=null)}function cr(t){var e=t._currentValue;if(Xg!==t)if(t={context:t,memoizedValue:e,next:null},la===null){if(qd===null)throw Error(Z(308));la=t,qd.dependencies={lanes:0,firstContext:t}}else la=la.next=t;return e}var Gi=null;function ey(t){Gi===null?Gi=[t]:Gi.push(t)}function YI(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,ey(e)):(n.next=s.next,s.next=n),e.interleaved=n,gs(t,r)}function gs(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Us=!1;function ty(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function XI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ds(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ri(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Qe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,gs(t,n)}return s=r.interleaved,s===null?(e.next=e,ey(r)):(e.next=s.next,s.next=e),r.interleaved=e,gs(t,n)}function id(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ug(t,n)}}function ww(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Hd(t,e,n,r){var s=t.updateQueue;Us=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var f=t.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==o&&(l===null?f.firstBaseUpdate=d:l.next=d,f.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,f=d=c=null,l=i;do{var m=l.lane,v=l.eventTime;if((r&m)===m){f!==null&&(f=f.next={eventTime:v,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var R=t,N=l;switch(m=e,v=n,N.tag){case 1:if(R=N.payload,typeof R=="function"){h=R.call(v,h,m);break e}h=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=N.payload,m=typeof R=="function"?R.call(v,h,m):R,m==null)break e;h=bt({},h,m);break e;case 2:Us=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,m=s.effects,m===null?s.effects=[l]:m.push(l))}else v={eventTime:v,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(d=f=v,c=h):f=f.next=v,o|=m;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;m=l,l=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(!0);if(f===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=f,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);lo|=o,t.lanes=o,t.memoizedState=h}}function xw(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Z(191,s));s.call(r)}}}var Kc={},Kr=xi(Kc),xc=xi(Kc),Ec=xi(Kc);function Ki(t){if(t===Kc)throw Error(Z(174));return t}function ny(t,e){switch(ut(Ec,e),ut(xc,t),ut(Kr,Kc),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:om(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=om(e,t)}pt(Kr),ut(Kr,e)}function Aa(){pt(Kr),pt(xc),pt(Ec)}function JI(t){Ki(Ec.current);var e=Ki(Kr.current),n=om(e,t.type);e!==n&&(ut(xc,t),ut(Kr,n))}function ry(t){xc.current===t&&(pt(Kr),pt(xc))}var wt=xi(0);function Wd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var dp=[];function sy(){for(var t=0;t<dp.length;t++)dp[t]._workInProgressVersionPrimary=null;dp.length=0}var od=Is.ReactCurrentDispatcher,hp=Is.ReactCurrentBatchConfig,ao=0,Et=null,Bt=null,Xt=null,Gd=!1,Yl=!1,bc=0,_R=0;function on(){throw Error(Z(321))}function iy(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Sr(t[n],e[n]))return!1;return!0}function oy(t,e,n,r,s,i){if(ao=i,Et=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,od.current=t===null||t.memoizedState===null?bR:IR,t=n(r,s),Yl){i=0;do{if(Yl=!1,bc=0,25<=i)throw Error(Z(301));i+=1,Xt=Bt=null,e.updateQueue=null,od.current=TR,t=n(r,s)}while(Yl)}if(od.current=Kd,e=Bt!==null&&Bt.next!==null,ao=0,Xt=Bt=Et=null,Gd=!1,e)throw Error(Z(300));return t}function ay(){var t=bc!==0;return bc=0,t}function $r(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?Et.memoizedState=Xt=t:Xt=Xt.next=t,Xt}function ur(){if(Bt===null){var t=Et.alternate;t=t!==null?t.memoizedState:null}else t=Bt.next;var e=Xt===null?Et.memoizedState:Xt.next;if(e!==null)Xt=e,Bt=t;else{if(t===null)throw Error(Z(310));Bt=t,t={memoizedState:Bt.memoizedState,baseState:Bt.baseState,baseQueue:Bt.baseQueue,queue:Bt.queue,next:null},Xt===null?Et.memoizedState=Xt=t:Xt=Xt.next=t}return Xt}function Ic(t,e){return typeof e=="function"?e(t):e}function fp(t){var e=ur(),n=e.queue;if(n===null)throw Error(Z(311));n.lastRenderedReducer=t;var r=Bt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var f=d.lane;if((ao&f)===f)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var h={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,Et.lanes|=f,lo|=f}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,Sr(r,e.memoizedState)||(kn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Et.lanes|=i,lo|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function pp(t){var e=ur(),n=e.queue;if(n===null)throw Error(Z(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);Sr(i,e.memoizedState)||(kn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function ZI(){}function e0(t,e){var n=Et,r=ur(),s=e(),i=!Sr(r.memoizedState,s);if(i&&(r.memoizedState=s,kn=!0),r=r.queue,ly(r0.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Xt!==null&&Xt.memoizedState.tag&1){if(n.flags|=2048,Tc(9,n0.bind(null,n,r,s,e),void 0,null),Jt===null)throw Error(Z(349));ao&30||t0(n,e,s)}return s}function t0(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Et.updateQueue,e===null?(e={lastEffect:null,stores:null},Et.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function n0(t,e,n,r){e.value=n,e.getSnapshot=r,s0(e)&&i0(t)}function r0(t,e,n){return n(function(){s0(e)&&i0(t)})}function s0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Sr(t,n)}catch{return!0}}function i0(t){var e=gs(t,1);e!==null&&Ir(e,t,1,-1)}function Ew(t){var e=$r();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ic,lastRenderedState:t},e.queue=t,t=t.dispatch=ER.bind(null,Et,t),[e.memoizedState,t]}function Tc(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Et.updateQueue,e===null?(e={lastEffect:null,stores:null},Et.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function o0(){return ur().memoizedState}function ad(t,e,n,r){var s=$r();Et.flags|=t,s.memoizedState=Tc(1|e,n,void 0,r===void 0?null:r)}function Mh(t,e,n,r){var s=ur();r=r===void 0?null:r;var i=void 0;if(Bt!==null){var o=Bt.memoizedState;if(i=o.destroy,r!==null&&iy(r,o.deps)){s.memoizedState=Tc(e,n,i,r);return}}Et.flags|=t,s.memoizedState=Tc(1|e,n,i,r)}function bw(t,e){return ad(8390656,8,t,e)}function ly(t,e){return Mh(2048,8,t,e)}function a0(t,e){return Mh(4,2,t,e)}function l0(t,e){return Mh(4,4,t,e)}function c0(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function u0(t,e,n){return n=n!=null?n.concat([t]):null,Mh(4,4,c0.bind(null,e,t),n)}function cy(){}function d0(t,e){var n=ur();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&iy(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function h0(t,e){var n=ur();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&iy(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function f0(t,e,n){return ao&21?(Sr(n,e)||(n=vI(),Et.lanes|=n,lo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,kn=!0),t.memoizedState=n)}function wR(t,e){var n=it;it=n!==0&&4>n?n:4,t(!0);var r=hp.transition;hp.transition={};try{t(!1),e()}finally{it=n,hp.transition=r}}function p0(){return ur().memoizedState}function xR(t,e,n){var r=ii(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},m0(t))g0(e,n);else if(n=YI(t,e,n,r),n!==null){var s=bn();Ir(n,t,r,s),y0(n,e,r)}}function ER(t,e,n){var r=ii(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(m0(t))g0(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,Sr(l,o)){var c=e.interleaved;c===null?(s.next=s,ey(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=YI(t,e,s,r),n!==null&&(s=bn(),Ir(n,t,r,s),y0(n,e,r))}}function m0(t){var e=t.alternate;return t===Et||e!==null&&e===Et}function g0(t,e){Yl=Gd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function y0(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ug(t,n)}}var Kd={readContext:cr,useCallback:on,useContext:on,useEffect:on,useImperativeHandle:on,useInsertionEffect:on,useLayoutEffect:on,useMemo:on,useReducer:on,useRef:on,useState:on,useDebugValue:on,useDeferredValue:on,useTransition:on,useMutableSource:on,useSyncExternalStore:on,useId:on,unstable_isNewReconciler:!1},bR={readContext:cr,useCallback:function(t,e){return $r().memoizedState=[t,e===void 0?null:e],t},useContext:cr,useEffect:bw,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ad(4194308,4,c0.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ad(4194308,4,t,e)},useInsertionEffect:function(t,e){return ad(4,2,t,e)},useMemo:function(t,e){var n=$r();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=$r();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=xR.bind(null,Et,t),[r.memoizedState,t]},useRef:function(t){var e=$r();return t={current:t},e.memoizedState=t},useState:Ew,useDebugValue:cy,useDeferredValue:function(t){return $r().memoizedState=t},useTransition:function(){var t=Ew(!1),e=t[0];return t=wR.bind(null,t[1]),$r().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Et,s=$r();if(gt){if(n===void 0)throw Error(Z(407));n=n()}else{if(n=e(),Jt===null)throw Error(Z(349));ao&30||t0(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,bw(r0.bind(null,r,i,t),[t]),r.flags|=2048,Tc(9,n0.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=$r(),e=Jt.identifierPrefix;if(gt){var n=as,r=os;n=(r&~(1<<32-br(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=bc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=_R++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},IR={readContext:cr,useCallback:d0,useContext:cr,useEffect:ly,useImperativeHandle:u0,useInsertionEffect:a0,useLayoutEffect:l0,useMemo:h0,useReducer:fp,useRef:o0,useState:function(){return fp(Ic)},useDebugValue:cy,useDeferredValue:function(t){var e=ur();return f0(e,Bt.memoizedState,t)},useTransition:function(){var t=fp(Ic)[0],e=ur().memoizedState;return[t,e]},useMutableSource:ZI,useSyncExternalStore:e0,useId:p0,unstable_isNewReconciler:!1},TR={readContext:cr,useCallback:d0,useContext:cr,useEffect:ly,useImperativeHandle:u0,useInsertionEffect:a0,useLayoutEffect:l0,useMemo:h0,useReducer:pp,useRef:o0,useState:function(){return pp(Ic)},useDebugValue:cy,useDeferredValue:function(t){var e=ur();return Bt===null?e.memoizedState=t:f0(e,Bt.memoizedState,t)},useTransition:function(){var t=pp(Ic)[0],e=ur().memoizedState;return[t,e]},useMutableSource:ZI,useSyncExternalStore:e0,useId:p0,unstable_isNewReconciler:!1};function vr(t,e){if(t&&t.defaultProps){e=bt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Cm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:bt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Fh={isMounted:function(t){return(t=t._reactInternals)?So(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=bn(),s=ii(t),i=ds(r,s);i.payload=e,n!=null&&(i.callback=n),e=ri(t,i,s),e!==null&&(Ir(e,t,s,r),id(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=bn(),s=ii(t),i=ds(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ri(t,i,s),e!==null&&(Ir(e,t,s,r),id(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=bn(),r=ii(t),s=ds(n,r);s.tag=2,e!=null&&(s.callback=e),e=ri(t,s,r),e!==null&&(Ir(e,t,r,n),id(e,t,r))}};function Iw(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!yc(n,r)||!yc(s,i):!0}function v0(t,e,n){var r=!1,s=pi,i=e.contextType;return typeof i=="object"&&i!==null?i=cr(i):(s=On(e)?io:gn.current,r=e.contextTypes,i=(r=r!=null)?Sa(t,s):pi),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Fh,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Tw(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Fh.enqueueReplaceState(e,e.state,null)}function Nm(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},ty(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=cr(i):(i=On(e)?io:gn.current,s.context=Sa(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Cm(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Fh.enqueueReplaceState(s,s.state,null),Hd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ra(t,e){try{var n="",r=e;do n+=Z1(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function mp(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Am(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var SR=typeof WeakMap=="function"?WeakMap:Map;function _0(t,e,n){n=ds(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Yd||(Yd=!0,Fm=r),Am(t,e)},n}function w0(t,e,n){n=ds(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Am(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Am(t,e),typeof r!="function"&&(si===null?si=new Set([this]):si.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Sw(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new SR;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=UR.bind(null,t,e,n),e.then(t,t))}function Cw(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Nw(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ds(-1,1),e.tag=2,ri(n,e,1))),n.lanes|=1),t)}var CR=Is.ReactCurrentOwner,kn=!1;function _n(t,e,n,r){e.child=t===null?QI(e,null,n,r):Na(e,t.child,n,r)}function Aw(t,e,n,r,s){n=n.render;var i=e.ref;return ga(e,s),r=oy(t,e,n,r,i,s),n=ay(),t!==null&&!kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,ys(t,e,s)):(gt&&n&&Kg(e),e.flags|=1,_n(t,e,r,s),e.child)}function Rw(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!yy(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,x0(t,e,i,r,s)):(t=dd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:yc,n(o,r)&&t.ref===e.ref)return ys(t,e,s)}return e.flags|=1,t=oi(i,r),t.ref=e.ref,t.return=e,e.child=t}function x0(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(yc(i,r)&&t.ref===e.ref)if(kn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(kn=!0);else return e.lanes=t.lanes,ys(t,e,s)}return Rm(t,e,n,r,s)}function E0(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ut(ua,$n),$n|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ut(ua,$n),$n|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,ut(ua,$n),$n|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,ut(ua,$n),$n|=r;return _n(t,e,s,n),e.child}function b0(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Rm(t,e,n,r,s){var i=On(n)?io:gn.current;return i=Sa(e,i),ga(e,s),n=oy(t,e,n,r,i,s),r=ay(),t!==null&&!kn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,ys(t,e,s)):(gt&&r&&Kg(e),e.flags|=1,_n(t,e,n,s),e.child)}function Pw(t,e,n,r,s){if(On(n)){var i=!0;Ud(e)}else i=!1;if(ga(e,s),e.stateNode===null)ld(t,e),v0(e,n,r),Nm(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=cr(d):(d=On(n)?io:gn.current,d=Sa(e,d));var f=n.getDerivedStateFromProps,h=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Tw(e,o,r,d),Us=!1;var m=e.memoizedState;o.state=m,Hd(e,r,o,s),c=e.memoizedState,l!==r||m!==c||Dn.current||Us?(typeof f=="function"&&(Cm(e,n,f,r),c=e.memoizedState),(l=Us||Iw(e,n,l,r,m,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,XI(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:vr(e.type,l),o.props=d,h=e.pendingProps,m=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=cr(c):(c=On(n)?io:gn.current,c=Sa(e,c));var v=n.getDerivedStateFromProps;(f=typeof v=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||m!==c)&&Tw(e,o,r,c),Us=!1,m=e.memoizedState,o.state=m,Hd(e,r,o,s);var R=e.memoizedState;l!==h||m!==R||Dn.current||Us?(typeof v=="function"&&(Cm(e,n,v,r),R=e.memoizedState),(d=Us||Iw(e,n,d,r,m,R,c)||!1)?(f||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,R,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,R,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=R),o.props=r,o.state=R,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),r=!1)}return Pm(t,e,n,r,i,s)}function Pm(t,e,n,r,s,i){b0(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&gw(e,n,!1),ys(t,e,i);r=e.stateNode,CR.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Na(e,t.child,null,i),e.child=Na(e,null,l,i)):_n(t,e,l,i),e.memoizedState=r.state,s&&gw(e,n,!0),e.child}function I0(t){var e=t.stateNode;e.pendingContext?mw(t,e.pendingContext,e.pendingContext!==e.context):e.context&&mw(t,e.context,!1),ny(t,e.containerInfo)}function kw(t,e,n,r,s){return Ca(),Yg(s),e.flags|=256,_n(t,e,n,r),e.child}var km={dehydrated:null,treeContext:null,retryLane:0};function jm(t){return{baseLanes:t,cachePool:null,transitions:null}}function T0(t,e,n){var r=e.pendingProps,s=wt.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),ut(wt,s&1),t===null)return Tm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Bh(o,r,0,null),t=Ji(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=jm(n),e.memoizedState=km,t):uy(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return NR(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=oi(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=oi(l,i):(i=Ji(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?jm(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=km,r}return i=t.child,t=i.sibling,r=oi(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function uy(t,e){return e=Bh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Vu(t,e,n,r){return r!==null&&Yg(r),Na(e,t.child,null,n),t=uy(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function NR(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=mp(Error(Z(422))),Vu(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Bh({mode:"visible",children:r.children},s,0,null),i=Ji(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Na(e,t.child,null,o),e.child.memoizedState=jm(o),e.memoizedState=km,i);if(!(e.mode&1))return Vu(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(Z(419)),r=mp(i,r,void 0),Vu(t,e,o,r)}if(l=(o&t.childLanes)!==0,kn||l){if(r=Jt,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,gs(t,s),Ir(r,t,s,-1))}return gy(),r=mp(Error(Z(421))),Vu(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=$R.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,qn=ni(s.nextSibling),Wn=e,gt=!0,xr=null,t!==null&&(tr[nr++]=os,tr[nr++]=as,tr[nr++]=oo,os=t.id,as=t.overflow,oo=e),e=uy(e,r.children),e.flags|=4096,e)}function jw(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Sm(t.return,e,n)}function gp(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function S0(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(_n(t,e,r.children,n),r=wt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&jw(t,n,e);else if(t.tag===19)jw(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ut(wt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Wd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),gp(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Wd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}gp(e,!0,n,null,i);break;case"together":gp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ld(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ys(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),lo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Z(153));if(e.child!==null){for(t=e.child,n=oi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=oi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function AR(t,e,n){switch(e.tag){case 3:I0(e),Ca();break;case 5:JI(e);break;case 1:On(e.type)&&Ud(e);break;case 4:ny(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;ut(zd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ut(wt,wt.current&1),e.flags|=128,null):n&e.child.childLanes?T0(t,e,n):(ut(wt,wt.current&1),t=ys(t,e,n),t!==null?t.sibling:null);ut(wt,wt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return S0(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ut(wt,wt.current),r)break;return null;case 22:case 23:return e.lanes=0,E0(t,e,n)}return ys(t,e,n)}var C0,Dm,N0,A0;C0=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Dm=function(){};N0=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Ki(Kr.current);var i=null;switch(n){case"input":s=nm(t,s),r=nm(t,r),i=[];break;case"select":s=bt({},s,{value:void 0}),r=bt({},r,{value:void 0}),i=[];break;case"textarea":s=im(t,s),r=im(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Md)}am(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(uc.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(uc.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&ft("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};A0=function(t,e,n,r){n!==r&&(e.flags|=4)};function xl(t,e){if(!gt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function an(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function RR(t,e,n){var r=e.pendingProps;switch(Qg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return an(e),null;case 1:return On(e.type)&&Fd(),an(e),null;case 3:return r=e.stateNode,Aa(),pt(Dn),pt(gn),sy(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Ou(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xr!==null&&(Bm(xr),xr=null))),Dm(t,e),an(e),null;case 5:ry(e);var s=Ki(Ec.current);if(n=e.type,t!==null&&e.stateNode!=null)N0(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Z(166));return an(e),null}if(t=Ki(Kr.current),Ou(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[zr]=e,r[wc]=i,t=(e.mode&1)!==0,n){case"dialog":ft("cancel",r),ft("close",r);break;case"iframe":case"object":case"embed":ft("load",r);break;case"video":case"audio":for(s=0;s<Ol.length;s++)ft(Ol[s],r);break;case"source":ft("error",r);break;case"img":case"image":case"link":ft("error",r),ft("load",r);break;case"details":ft("toggle",r);break;case"input":B_(r,i),ft("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},ft("invalid",r);break;case"textarea":q_(r,i),ft("invalid",r)}am(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Du(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Du(r.textContent,l,t),s=["children",""+l]):uc.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&ft("scroll",r)}switch(n){case"input":Su(r),z_(r,i,!0);break;case"textarea":Su(r),H_(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Md)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=rI(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[zr]=e,t[wc]=r,C0(t,e,!1,!1),e.stateNode=t;e:{switch(o=lm(n,r),n){case"dialog":ft("cancel",t),ft("close",t),s=r;break;case"iframe":case"object":case"embed":ft("load",t),s=r;break;case"video":case"audio":for(s=0;s<Ol.length;s++)ft(Ol[s],t);s=r;break;case"source":ft("error",t),s=r;break;case"img":case"image":case"link":ft("error",t),ft("load",t),s=r;break;case"details":ft("toggle",t),s=r;break;case"input":B_(t,r),s=nm(t,r),ft("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=bt({},r,{value:void 0}),ft("invalid",t);break;case"textarea":q_(t,r),s=im(t,r),ft("invalid",t);break;default:s=r}am(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?oI(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&sI(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&dc(t,c):typeof c=="number"&&dc(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(uc.hasOwnProperty(i)?c!=null&&i==="onScroll"&&ft("scroll",t):c!=null&&Dg(t,i,c,o))}switch(n){case"input":Su(t),z_(t,r,!1);break;case"textarea":Su(t),H_(t);break;case"option":r.value!=null&&t.setAttribute("value",""+fi(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ha(t,!!r.multiple,i,!1):r.defaultValue!=null&&ha(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Md)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return an(e),null;case 6:if(t&&e.stateNode!=null)A0(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Z(166));if(n=Ki(Ec.current),Ki(Kr.current),Ou(e)){if(r=e.stateNode,n=e.memoizedProps,r[zr]=e,(i=r.nodeValue!==n)&&(t=Wn,t!==null))switch(t.tag){case 3:Du(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Du(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[zr]=e,e.stateNode=r}return an(e),null;case 13:if(pt(wt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(gt&&qn!==null&&e.mode&1&&!(e.flags&128))GI(),Ca(),e.flags|=98560,i=!1;else if(i=Ou(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Z(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Z(317));i[zr]=e}else Ca(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;an(e),i=!1}else xr!==null&&(Bm(xr),xr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||wt.current&1?zt===0&&(zt=3):gy())),e.updateQueue!==null&&(e.flags|=4),an(e),null);case 4:return Aa(),Dm(t,e),t===null&&vc(e.stateNode.containerInfo),an(e),null;case 10:return Zg(e.type._context),an(e),null;case 17:return On(e.type)&&Fd(),an(e),null;case 19:if(pt(wt),i=e.memoizedState,i===null)return an(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)xl(i,!1);else{if(zt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Wd(t),o!==null){for(e.flags|=128,xl(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ut(wt,wt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Pt()>Pa&&(e.flags|=128,r=!0,xl(i,!1),e.lanes=4194304)}else{if(!r)if(t=Wd(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),xl(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!gt)return an(e),null}else 2*Pt()-i.renderingStartTime>Pa&&n!==1073741824&&(e.flags|=128,r=!0,xl(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Pt(),e.sibling=null,n=wt.current,ut(wt,r?n&1|2:n&1),e):(an(e),null);case 22:case 23:return my(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?$n&1073741824&&(an(e),e.subtreeFlags&6&&(e.flags|=8192)):an(e),null;case 24:return null;case 25:return null}throw Error(Z(156,e.tag))}function PR(t,e){switch(Qg(e),e.tag){case 1:return On(e.type)&&Fd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Aa(),pt(Dn),pt(gn),sy(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ry(e),null;case 13:if(pt(wt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Z(340));Ca()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return pt(wt),null;case 4:return Aa(),null;case 10:return Zg(e.type._context),null;case 22:case 23:return my(),null;case 24:return null;default:return null}}var Mu=!1,un=!1,kR=typeof WeakSet=="function"?WeakSet:Set,de=null;function ca(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){St(t,e,r)}else n.current=null}function Om(t,e,n){try{n()}catch(r){St(t,e,r)}}var Dw=!1;function jR(t,e){if(vm=Od,t=DI(),Gg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,f=0,h=t,m=null;t:for(;;){for(var v;h!==n||s!==0&&h.nodeType!==3||(l=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(v=h.firstChild)!==null;)m=h,h=v;for(;;){if(h===t)break t;if(m===n&&++d===s&&(l=o),m===i&&++f===r&&(c=o),(v=h.nextSibling)!==null)break;h=m,m=h.parentNode}h=v}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(_m={focusedElem:t,selectionRange:n},Od=!1,de=e;de!==null;)if(e=de,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,de=t;else for(;de!==null;){e=de;try{var R=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var N=R.memoizedProps,C=R.memoizedState,y=e.stateNode,w=y.getSnapshotBeforeUpdate(e.elementType===e.type?N:vr(e.type,N),C);y.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch(I){St(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,de=t;break}de=e.return}return R=Dw,Dw=!1,R}function Xl(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Om(e,n,i)}s=s.next}while(s!==r)}}function Uh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Lm(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function R0(t){var e=t.alternate;e!==null&&(t.alternate=null,R0(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[zr],delete e[wc],delete e[Em],delete e[mR],delete e[gR])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function P0(t){return t.tag===5||t.tag===3||t.tag===4}function Ow(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||P0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Vm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Md));else if(r!==4&&(t=t.child,t!==null))for(Vm(t,e,n),t=t.sibling;t!==null;)Vm(t,e,n),t=t.sibling}function Mm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Mm(t,e,n),t=t.sibling;t!==null;)Mm(t,e,n),t=t.sibling}var en=null,_r=!1;function js(t,e,n){for(n=n.child;n!==null;)k0(t,e,n),n=n.sibling}function k0(t,e,n){if(Gr&&typeof Gr.onCommitFiberUnmount=="function")try{Gr.onCommitFiberUnmount(kh,n)}catch{}switch(n.tag){case 5:un||ca(n,e);case 6:var r=en,s=_r;en=null,js(t,e,n),en=r,_r=s,en!==null&&(_r?(t=en,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):en.removeChild(n.stateNode));break;case 18:en!==null&&(_r?(t=en,n=n.stateNode,t.nodeType===8?cp(t.parentNode,n):t.nodeType===1&&cp(t,n),mc(t)):cp(en,n.stateNode));break;case 4:r=en,s=_r,en=n.stateNode.containerInfo,_r=!0,js(t,e,n),en=r,_r=s;break;case 0:case 11:case 14:case 15:if(!un&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Om(n,e,o),s=s.next}while(s!==r)}js(t,e,n);break;case 1:if(!un&&(ca(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){St(n,e,l)}js(t,e,n);break;case 21:js(t,e,n);break;case 22:n.mode&1?(un=(r=un)||n.memoizedState!==null,js(t,e,n),un=r):js(t,e,n);break;default:js(t,e,n)}}function Lw(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new kR),e.forEach(function(r){var s=BR.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function gr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:en=l.stateNode,_r=!1;break e;case 3:en=l.stateNode.containerInfo,_r=!0;break e;case 4:en=l.stateNode.containerInfo,_r=!0;break e}l=l.return}if(en===null)throw Error(Z(160));k0(i,o,s),en=null,_r=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){St(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)j0(e,t),e=e.sibling}function j0(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(gr(e,t),Mr(t),r&4){try{Xl(3,t,t.return),Uh(3,t)}catch(N){St(t,t.return,N)}try{Xl(5,t,t.return)}catch(N){St(t,t.return,N)}}break;case 1:gr(e,t),Mr(t),r&512&&n!==null&&ca(n,n.return);break;case 5:if(gr(e,t),Mr(t),r&512&&n!==null&&ca(n,n.return),t.flags&32){var s=t.stateNode;try{dc(s,"")}catch(N){St(t,t.return,N)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&tI(s,i),lm(l,o);var d=lm(l,i);for(o=0;o<c.length;o+=2){var f=c[o],h=c[o+1];f==="style"?oI(s,h):f==="dangerouslySetInnerHTML"?sI(s,h):f==="children"?dc(s,h):Dg(s,f,h,d)}switch(l){case"input":rm(s,i);break;case"textarea":nI(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var v=i.value;v!=null?ha(s,!!i.multiple,v,!1):m!==!!i.multiple&&(i.defaultValue!=null?ha(s,!!i.multiple,i.defaultValue,!0):ha(s,!!i.multiple,i.multiple?[]:"",!1))}s[wc]=i}catch(N){St(t,t.return,N)}}break;case 6:if(gr(e,t),Mr(t),r&4){if(t.stateNode===null)throw Error(Z(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(N){St(t,t.return,N)}}break;case 3:if(gr(e,t),Mr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{mc(e.containerInfo)}catch(N){St(t,t.return,N)}break;case 4:gr(e,t),Mr(t);break;case 13:gr(e,t),Mr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(fy=Pt())),r&4&&Lw(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(un=(d=un)||f,gr(e,t),un=d):gr(e,t),Mr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!f&&t.mode&1)for(de=t,f=t.child;f!==null;){for(h=de=f;de!==null;){switch(m=de,v=m.child,m.tag){case 0:case 11:case 14:case 15:Xl(4,m,m.return);break;case 1:ca(m,m.return);var R=m.stateNode;if(typeof R.componentWillUnmount=="function"){r=m,n=m.return;try{e=r,R.props=e.memoizedProps,R.state=e.memoizedState,R.componentWillUnmount()}catch(N){St(r,n,N)}}break;case 5:ca(m,m.return);break;case 22:if(m.memoizedState!==null){Mw(h);continue}}v!==null?(v.return=m,de=v):Mw(h)}f=f.sibling}e:for(f=null,h=t;;){if(h.tag===5){if(f===null){f=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=iI("display",o))}catch(N){St(t,t.return,N)}}}else if(h.tag===6){if(f===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(N){St(t,t.return,N)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;f===h&&(f=null),h=h.return}f===h&&(f=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gr(e,t),Mr(t),r&4&&Lw(t);break;case 21:break;default:gr(e,t),Mr(t)}}function Mr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(P0(n)){var r=n;break e}n=n.return}throw Error(Z(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(dc(s,""),r.flags&=-33);var i=Ow(t);Mm(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Ow(t);Vm(t,l,o);break;default:throw Error(Z(161))}}catch(c){St(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function DR(t,e,n){de=t,D0(t)}function D0(t,e,n){for(var r=(t.mode&1)!==0;de!==null;){var s=de,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Mu;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||un;l=Mu;var d=un;if(Mu=o,(un=c)&&!d)for(de=s;de!==null;)o=de,c=o.child,o.tag===22&&o.memoizedState!==null?Fw(s):c!==null?(c.return=o,de=c):Fw(s);for(;i!==null;)de=i,D0(i),i=i.sibling;de=s,Mu=l,un=d}Vw(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,de=i):Vw(t)}}function Vw(t){for(;de!==null;){var e=de;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:un||Uh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!un)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:vr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&xw(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}xw(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var h=f.dehydrated;h!==null&&mc(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}un||e.flags&512&&Lm(e)}catch(m){St(e,e.return,m)}}if(e===t){de=null;break}if(n=e.sibling,n!==null){n.return=e.return,de=n;break}de=e.return}}function Mw(t){for(;de!==null;){var e=de;if(e===t){de=null;break}var n=e.sibling;if(n!==null){n.return=e.return,de=n;break}de=e.return}}function Fw(t){for(;de!==null;){var e=de;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Uh(4,e)}catch(c){St(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){St(e,s,c)}}var i=e.return;try{Lm(e)}catch(c){St(e,i,c)}break;case 5:var o=e.return;try{Lm(e)}catch(c){St(e,o,c)}}}catch(c){St(e,e.return,c)}if(e===t){de=null;break}var l=e.sibling;if(l!==null){l.return=e.return,de=l;break}de=e.return}}var OR=Math.ceil,Qd=Is.ReactCurrentDispatcher,dy=Is.ReactCurrentOwner,ar=Is.ReactCurrentBatchConfig,Qe=0,Jt=null,Mt=null,rn=0,$n=0,ua=xi(0),zt=0,Sc=null,lo=0,$h=0,hy=0,Jl=null,Rn=null,fy=0,Pa=1/0,ss=null,Yd=!1,Fm=null,si=null,Fu=!1,Xs=null,Xd=0,Zl=0,Um=null,cd=-1,ud=0;function bn(){return Qe&6?Pt():cd!==-1?cd:cd=Pt()}function ii(t){return t.mode&1?Qe&2&&rn!==0?rn&-rn:vR.transition!==null?(ud===0&&(ud=vI()),ud):(t=it,t!==0||(t=window.event,t=t===void 0?16:TI(t.type)),t):1}function Ir(t,e,n,r){if(50<Zl)throw Zl=0,Um=null,Error(Z(185));Hc(t,n,r),(!(Qe&2)||t!==Jt)&&(t===Jt&&(!(Qe&2)&&($h|=n),zt===4&&Bs(t,rn)),Ln(t,r),n===1&&Qe===0&&!(e.mode&1)&&(Pa=Pt()+500,Vh&&Ei()))}function Ln(t,e){var n=t.callbackNode;vA(t,e);var r=Dd(t,t===Jt?rn:0);if(r===0)n!==null&&K_(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&K_(n),e===1)t.tag===0?yR(Uw.bind(null,t)):qI(Uw.bind(null,t)),fR(function(){!(Qe&6)&&Ei()}),n=null;else{switch(_I(r)){case 1:n=Fg;break;case 4:n=gI;break;case 16:n=jd;break;case 536870912:n=yI;break;default:n=jd}n=B0(n,O0.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function O0(t,e){if(cd=-1,ud=0,Qe&6)throw Error(Z(327));var n=t.callbackNode;if(ya()&&t.callbackNode!==n)return null;var r=Dd(t,t===Jt?rn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Jd(t,r);else{e=r;var s=Qe;Qe|=2;var i=V0();(Jt!==t||rn!==e)&&(ss=null,Pa=Pt()+500,Xi(t,e));do try{MR();break}catch(l){L0(t,l)}while(!0);Jg(),Qd.current=i,Qe=s,Mt!==null?e=0:(Jt=null,rn=0,e=zt)}if(e!==0){if(e===2&&(s=fm(t),s!==0&&(r=s,e=$m(t,s))),e===1)throw n=Sc,Xi(t,0),Bs(t,r),Ln(t,Pt()),n;if(e===6)Bs(t,r);else{if(s=t.current.alternate,!(r&30)&&!LR(s)&&(e=Jd(t,r),e===2&&(i=fm(t),i!==0&&(r=i,e=$m(t,i))),e===1))throw n=Sc,Xi(t,0),Bs(t,r),Ln(t,Pt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Z(345));case 2:Vi(t,Rn,ss);break;case 3:if(Bs(t,r),(r&130023424)===r&&(e=fy+500-Pt(),10<e)){if(Dd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){bn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=xm(Vi.bind(null,t,Rn,ss),e);break}Vi(t,Rn,ss);break;case 4:if(Bs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-br(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Pt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*OR(r/1960))-r,10<r){t.timeoutHandle=xm(Vi.bind(null,t,Rn,ss),r);break}Vi(t,Rn,ss);break;case 5:Vi(t,Rn,ss);break;default:throw Error(Z(329))}}}return Ln(t,Pt()),t.callbackNode===n?O0.bind(null,t):null}function $m(t,e){var n=Jl;return t.current.memoizedState.isDehydrated&&(Xi(t,e).flags|=256),t=Jd(t,e),t!==2&&(e=Rn,Rn=n,e!==null&&Bm(e)),t}function Bm(t){Rn===null?Rn=t:Rn.push.apply(Rn,t)}function LR(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Sr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Bs(t,e){for(e&=~hy,e&=~$h,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-br(e),r=1<<n;t[n]=-1,e&=~r}}function Uw(t){if(Qe&6)throw Error(Z(327));ya();var e=Dd(t,0);if(!(e&1))return Ln(t,Pt()),null;var n=Jd(t,e);if(t.tag!==0&&n===2){var r=fm(t);r!==0&&(e=r,n=$m(t,r))}if(n===1)throw n=Sc,Xi(t,0),Bs(t,e),Ln(t,Pt()),n;if(n===6)throw Error(Z(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Vi(t,Rn,ss),Ln(t,Pt()),null}function py(t,e){var n=Qe;Qe|=1;try{return t(e)}finally{Qe=n,Qe===0&&(Pa=Pt()+500,Vh&&Ei())}}function co(t){Xs!==null&&Xs.tag===0&&!(Qe&6)&&ya();var e=Qe;Qe|=1;var n=ar.transition,r=it;try{if(ar.transition=null,it=1,t)return t()}finally{it=r,ar.transition=n,Qe=e,!(Qe&6)&&Ei()}}function my(){$n=ua.current,pt(ua)}function Xi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,hR(n)),Mt!==null)for(n=Mt.return;n!==null;){var r=n;switch(Qg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Fd();break;case 3:Aa(),pt(Dn),pt(gn),sy();break;case 5:ry(r);break;case 4:Aa();break;case 13:pt(wt);break;case 19:pt(wt);break;case 10:Zg(r.type._context);break;case 22:case 23:my()}n=n.return}if(Jt=t,Mt=t=oi(t.current,null),rn=$n=e,zt=0,Sc=null,hy=$h=lo=0,Rn=Jl=null,Gi!==null){for(e=0;e<Gi.length;e++)if(n=Gi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Gi=null}return t}function L0(t,e){do{var n=Mt;try{if(Jg(),od.current=Kd,Gd){for(var r=Et.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Gd=!1}if(ao=0,Xt=Bt=Et=null,Yl=!1,bc=0,dy.current=null,n===null||n.return===null){zt=1,Sc=e,Mt=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=rn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,f=l,h=f.tag;if(!(f.mode&1)&&(h===0||h===11||h===15)){var m=f.alternate;m?(f.updateQueue=m.updateQueue,f.memoizedState=m.memoizedState,f.lanes=m.lanes):(f.updateQueue=null,f.memoizedState=null)}var v=Cw(o);if(v!==null){v.flags&=-257,Nw(v,o,l,i,e),v.mode&1&&Sw(i,d,e),e=v,c=d;var R=e.updateQueue;if(R===null){var N=new Set;N.add(c),e.updateQueue=N}else R.add(c);break e}else{if(!(e&1)){Sw(i,d,e),gy();break e}c=Error(Z(426))}}else if(gt&&l.mode&1){var C=Cw(o);if(C!==null){!(C.flags&65536)&&(C.flags|=256),Nw(C,o,l,i,e),Yg(Ra(c,l));break e}}i=c=Ra(c,l),zt!==4&&(zt=2),Jl===null?Jl=[i]:Jl.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=_0(i,c,e);ww(i,y);break e;case 1:l=c;var w=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof w.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(si===null||!si.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var I=w0(i,l,e);ww(i,I);break e}}i=i.return}while(i!==null)}F0(n)}catch(M){e=M,Mt===n&&n!==null&&(Mt=n=n.return);continue}break}while(!0)}function V0(){var t=Qd.current;return Qd.current=Kd,t===null?Kd:t}function gy(){(zt===0||zt===3||zt===2)&&(zt=4),Jt===null||!(lo&268435455)&&!($h&268435455)||Bs(Jt,rn)}function Jd(t,e){var n=Qe;Qe|=2;var r=V0();(Jt!==t||rn!==e)&&(ss=null,Xi(t,e));do try{VR();break}catch(s){L0(t,s)}while(!0);if(Jg(),Qe=n,Qd.current=r,Mt!==null)throw Error(Z(261));return Jt=null,rn=0,zt}function VR(){for(;Mt!==null;)M0(Mt)}function MR(){for(;Mt!==null&&!cA();)M0(Mt)}function M0(t){var e=$0(t.alternate,t,$n);t.memoizedProps=t.pendingProps,e===null?F0(t):Mt=e,dy.current=null}function F0(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=PR(n,e),n!==null){n.flags&=32767,Mt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{zt=6,Mt=null;return}}else if(n=RR(n,e,$n),n!==null){Mt=n;return}if(e=e.sibling,e!==null){Mt=e;return}Mt=e=t}while(e!==null);zt===0&&(zt=5)}function Vi(t,e,n){var r=it,s=ar.transition;try{ar.transition=null,it=1,FR(t,e,n,r)}finally{ar.transition=s,it=r}return null}function FR(t,e,n,r){do ya();while(Xs!==null);if(Qe&6)throw Error(Z(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Z(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(_A(t,i),t===Jt&&(Mt=Jt=null,rn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Fu||(Fu=!0,B0(jd,function(){return ya(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=ar.transition,ar.transition=null;var o=it;it=1;var l=Qe;Qe|=4,dy.current=null,jR(t,n),j0(n,t),iR(_m),Od=!!vm,_m=vm=null,t.current=n,DR(n),uA(),Qe=l,it=o,ar.transition=i}else t.current=n;if(Fu&&(Fu=!1,Xs=t,Xd=s),i=t.pendingLanes,i===0&&(si=null),fA(n.stateNode),Ln(t,Pt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Yd)throw Yd=!1,t=Fm,Fm=null,t;return Xd&1&&t.tag!==0&&ya(),i=t.pendingLanes,i&1?t===Um?Zl++:(Zl=0,Um=t):Zl=0,Ei(),null}function ya(){if(Xs!==null){var t=_I(Xd),e=ar.transition,n=it;try{if(ar.transition=null,it=16>t?16:t,Xs===null)var r=!1;else{if(t=Xs,Xs=null,Xd=0,Qe&6)throw Error(Z(331));var s=Qe;for(Qe|=4,de=t.current;de!==null;){var i=de,o=i.child;if(de.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(de=d;de!==null;){var f=de;switch(f.tag){case 0:case 11:case 15:Xl(8,f,i)}var h=f.child;if(h!==null)h.return=f,de=h;else for(;de!==null;){f=de;var m=f.sibling,v=f.return;if(R0(f),f===d){de=null;break}if(m!==null){m.return=v,de=m;break}de=v}}}var R=i.alternate;if(R!==null){var N=R.child;if(N!==null){R.child=null;do{var C=N.sibling;N.sibling=null,N=C}while(N!==null)}}de=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,de=o;else e:for(;de!==null;){if(i=de,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Xl(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,de=y;break e}de=i.return}}var w=t.current;for(de=w;de!==null;){o=de;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,de=E;else e:for(o=w;de!==null;){if(l=de,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Uh(9,l)}}catch(M){St(l,l.return,M)}if(l===o){de=null;break e}var I=l.sibling;if(I!==null){I.return=l.return,de=I;break e}de=l.return}}if(Qe=s,Ei(),Gr&&typeof Gr.onPostCommitFiberRoot=="function")try{Gr.onPostCommitFiberRoot(kh,t)}catch{}r=!0}return r}finally{it=n,ar.transition=e}}return!1}function $w(t,e,n){e=Ra(n,e),e=_0(t,e,1),t=ri(t,e,1),e=bn(),t!==null&&(Hc(t,1,e),Ln(t,e))}function St(t,e,n){if(t.tag===3)$w(t,t,n);else for(;e!==null;){if(e.tag===3){$w(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(si===null||!si.has(r))){t=Ra(n,t),t=w0(e,t,1),e=ri(e,t,1),t=bn(),e!==null&&(Hc(e,1,t),Ln(e,t));break}}e=e.return}}function UR(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=bn(),t.pingedLanes|=t.suspendedLanes&n,Jt===t&&(rn&n)===n&&(zt===4||zt===3&&(rn&130023424)===rn&&500>Pt()-fy?Xi(t,0):hy|=n),Ln(t,e)}function U0(t,e){e===0&&(t.mode&1?(e=Au,Au<<=1,!(Au&130023424)&&(Au=4194304)):e=1);var n=bn();t=gs(t,e),t!==null&&(Hc(t,e,n),Ln(t,n))}function $R(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),U0(t,n)}function BR(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Z(314))}r!==null&&r.delete(e),U0(t,n)}var $0;$0=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Dn.current)kn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return kn=!1,AR(t,e,n);kn=!!(t.flags&131072)}else kn=!1,gt&&e.flags&1048576&&HI(e,Bd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ld(t,e),t=e.pendingProps;var s=Sa(e,gn.current);ga(e,n),s=oy(null,e,r,t,s,n);var i=ay();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,On(r)?(i=!0,Ud(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,ty(e),s.updater=Fh,e.stateNode=s,s._reactInternals=e,Nm(e,r,t,n),e=Pm(null,e,r,!0,i,n)):(e.tag=0,gt&&i&&Kg(e),_n(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ld(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=qR(r),t=vr(r,t),s){case 0:e=Rm(null,e,r,t,n);break e;case 1:e=Pw(null,e,r,t,n);break e;case 11:e=Aw(null,e,r,t,n);break e;case 14:e=Rw(null,e,r,vr(r.type,t),n);break e}throw Error(Z(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vr(r,s),Rm(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vr(r,s),Pw(t,e,r,s,n);case 3:e:{if(I0(e),t===null)throw Error(Z(387));r=e.pendingProps,i=e.memoizedState,s=i.element,XI(t,e),Hd(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ra(Error(Z(423)),e),e=kw(t,e,r,n,s);break e}else if(r!==s){s=Ra(Error(Z(424)),e),e=kw(t,e,r,n,s);break e}else for(qn=ni(e.stateNode.containerInfo.firstChild),Wn=e,gt=!0,xr=null,n=QI(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ca(),r===s){e=ys(t,e,n);break e}_n(t,e,r,n)}e=e.child}return e;case 5:return JI(e),t===null&&Tm(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,wm(r,s)?o=null:i!==null&&wm(r,i)&&(e.flags|=32),b0(t,e),_n(t,e,o,n),e.child;case 6:return t===null&&Tm(e),null;case 13:return T0(t,e,n);case 4:return ny(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Na(e,null,r,n):_n(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vr(r,s),Aw(t,e,r,s,n);case 7:return _n(t,e,e.pendingProps,n),e.child;case 8:return _n(t,e,e.pendingProps.children,n),e.child;case 12:return _n(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,ut(zd,r._currentValue),r._currentValue=o,i!==null)if(Sr(i.value,o)){if(i.children===s.children&&!Dn.current){e=ys(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=ds(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?c.next=c:(c.next=f.next,f.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Sm(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Z(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Sm(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}_n(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,ga(e,n),s=cr(s),r=r(s),e.flags|=1,_n(t,e,r,n),e.child;case 14:return r=e.type,s=vr(r,e.pendingProps),s=vr(r.type,s),Rw(t,e,r,s,n);case 15:return x0(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vr(r,s),ld(t,e),e.tag=1,On(r)?(t=!0,Ud(e)):t=!1,ga(e,n),v0(e,r,s),Nm(e,r,s,n),Pm(null,e,r,!0,t,n);case 19:return S0(t,e,n);case 22:return E0(t,e,n)}throw Error(Z(156,e.tag))};function B0(t,e){return mI(t,e)}function zR(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ir(t,e,n,r){return new zR(t,e,n,r)}function yy(t){return t=t.prototype,!(!t||!t.isReactComponent)}function qR(t){if(typeof t=="function")return yy(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Lg)return 11;if(t===Vg)return 14}return 2}function oi(t,e){var n=t.alternate;return n===null?(n=ir(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function dd(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")yy(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case ea:return Ji(n.children,s,i,e);case Og:o=8,s|=8;break;case Jp:return t=ir(12,n,e,s|2),t.elementType=Jp,t.lanes=i,t;case Zp:return t=ir(13,n,e,s),t.elementType=Zp,t.lanes=i,t;case em:return t=ir(19,n,e,s),t.elementType=em,t.lanes=i,t;case Jb:return Bh(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Yb:o=10;break e;case Xb:o=9;break e;case Lg:o=11;break e;case Vg:o=14;break e;case Fs:o=16,r=null;break e}throw Error(Z(130,t==null?t:typeof t,""))}return e=ir(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Ji(t,e,n,r){return t=ir(7,t,r,e),t.lanes=n,t}function Bh(t,e,n,r){return t=ir(22,t,r,e),t.elementType=Jb,t.lanes=n,t.stateNode={isHidden:!1},t}function yp(t,e,n){return t=ir(6,t,null,e),t.lanes=n,t}function vp(t,e,n){return e=ir(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function HR(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Jf(0),this.expirationTimes=Jf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Jf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function vy(t,e,n,r,s,i,o,l,c){return t=new HR(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ir(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ty(i),t}function WR(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Zo,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function z0(t){if(!t)return pi;t=t._reactInternals;e:{if(So(t)!==t||t.tag!==1)throw Error(Z(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(On(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Z(171))}if(t.tag===1){var n=t.type;if(On(n))return zI(t,n,e)}return e}function q0(t,e,n,r,s,i,o,l,c){return t=vy(n,r,!0,t,s,i,o,l,c),t.context=z0(null),n=t.current,r=bn(),s=ii(n),i=ds(r,s),i.callback=e??null,ri(n,i,s),t.current.lanes=s,Hc(t,s,r),Ln(t,r),t}function zh(t,e,n,r){var s=e.current,i=bn(),o=ii(s);return n=z0(n),e.context===null?e.context=n:e.pendingContext=n,e=ds(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ri(s,e,o),t!==null&&(Ir(t,s,o,i),id(t,s,o)),o}function Zd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Bw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function _y(t,e){Bw(t,e),(t=t.alternate)&&Bw(t,e)}function GR(){return null}var H0=typeof reportError=="function"?reportError:function(t){console.error(t)};function wy(t){this._internalRoot=t}qh.prototype.render=wy.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Z(409));zh(t,e,null,null)};qh.prototype.unmount=wy.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;co(function(){zh(null,t,null,null)}),e[ms]=null}};function qh(t){this._internalRoot=t}qh.prototype.unstable_scheduleHydration=function(t){if(t){var e=EI();t={blockedOn:null,target:t,priority:e};for(var n=0;n<$s.length&&e!==0&&e<$s[n].priority;n++);$s.splice(n,0,t),n===0&&II(t)}};function xy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Hh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function zw(){}function KR(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Zd(o);i.call(d)}}var o=q0(e,r,t,0,null,!1,!1,"",zw);return t._reactRootContainer=o,t[ms]=o.current,vc(t.nodeType===8?t.parentNode:t),co(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Zd(c);l.call(d)}}var c=vy(t,0,!1,null,null,!1,!1,"",zw);return t._reactRootContainer=c,t[ms]=c.current,vc(t.nodeType===8?t.parentNode:t),co(function(){zh(e,c,n,r)}),c}function Wh(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=Zd(o);l.call(c)}}zh(e,o,t,s)}else o=KR(n,e,t,s,r);return Zd(o)}wI=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Dl(e.pendingLanes);n!==0&&(Ug(e,n|1),Ln(e,Pt()),!(Qe&6)&&(Pa=Pt()+500,Ei()))}break;case 13:co(function(){var r=gs(t,1);if(r!==null){var s=bn();Ir(r,t,1,s)}}),_y(t,1)}};$g=function(t){if(t.tag===13){var e=gs(t,134217728);if(e!==null){var n=bn();Ir(e,t,134217728,n)}_y(t,134217728)}};xI=function(t){if(t.tag===13){var e=ii(t),n=gs(t,e);if(n!==null){var r=bn();Ir(n,t,e,r)}_y(t,e)}};EI=function(){return it};bI=function(t,e){var n=it;try{return it=t,e()}finally{it=n}};um=function(t,e,n){switch(e){case"input":if(rm(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Lh(r);if(!s)throw Error(Z(90));eI(r),rm(r,s)}}}break;case"textarea":nI(t,n);break;case"select":e=n.value,e!=null&&ha(t,!!n.multiple,e,!1)}};cI=py;uI=co;var QR={usingClientEntryPoint:!1,Events:[Gc,sa,Lh,aI,lI,py]},El={findFiberByHostInstance:Wi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},YR={bundleType:El.bundleType,version:El.version,rendererPackageName:El.rendererPackageName,rendererConfig:El.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Is.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=fI(t),t===null?null:t.stateNode},findFiberByHostInstance:El.findFiberByHostInstance||GR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Uu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Uu.isDisabled&&Uu.supportsFiber)try{kh=Uu.inject(YR),Gr=Uu}catch{}}Yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=QR;Yn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xy(e))throw Error(Z(200));return WR(t,e,null,n)};Yn.createRoot=function(t,e){if(!xy(t))throw Error(Z(299));var n=!1,r="",s=H0;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=vy(t,1,!1,null,null,n,!1,r,s),t[ms]=e.current,vc(t.nodeType===8?t.parentNode:t),new wy(e)};Yn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Z(188)):(t=Object.keys(t).join(","),Error(Z(268,t)));return t=fI(e),t=t===null?null:t.stateNode,t};Yn.flushSync=function(t){return co(t)};Yn.hydrate=function(t,e,n){if(!Hh(e))throw Error(Z(200));return Wh(null,t,e,!0,n)};Yn.hydrateRoot=function(t,e,n){if(!xy(t))throw Error(Z(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=H0;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=q0(e,null,t,1,n??null,s,!1,i,o),t[ms]=e.current,vc(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new qh(e)};Yn.render=function(t,e,n){if(!Hh(e))throw Error(Z(200));return Wh(null,t,e,!1,n)};Yn.unmountComponentAtNode=function(t){if(!Hh(t))throw Error(Z(40));return t._reactRootContainer?(co(function(){Wh(null,null,t,!1,function(){t._reactRootContainer=null,t[ms]=null})}),!0):!1};Yn.unstable_batchedUpdates=py;Yn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Hh(n))throw Error(Z(200));if(t==null||t._reactInternals===void 0)throw Error(Z(38));return Wh(t,e,n,!1,r)};Yn.version="18.3.1-next-f1338f8080-20240426";function W0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(W0)}catch(t){console.error(t)}}W0(),Wb.exports=Yn;var XR=Wb.exports,G0,qw=XR;G0=qw.createRoot,qw.hydrateRoot;/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Hw="popstate";function JR(t={}){function e(r,s){let{pathname:i,search:o,hash:l}=r.location;return zm("",{pathname:i,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Cc(s)}return eP(e,n,null,t)}function yt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function dr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function ZR(){return Math.random().toString(36).substring(2,10)}function Ww(t,e){return{usr:t.state,key:t.key,idx:e}}function zm(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Qa(e):e,state:n,key:e&&e.key||r||ZR()}}function Cc({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Qa(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function eP(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,l="POP",c=null,d=f();d==null&&(d=0,o.replaceState({...o.state,idx:d},""));function f(){return(o.state||{idx:null}).idx}function h(){l="POP";let C=f(),y=C==null?null:C-d;d=C,c&&c({action:l,location:N.location,delta:y})}function m(C,y){l="PUSH";let w=zm(N.location,C,y);d=f()+1;let E=Ww(w,d),I=N.createHref(w);try{o.pushState(E,"",I)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;s.location.assign(I)}i&&c&&c({action:l,location:N.location,delta:1})}function v(C,y){l="REPLACE";let w=zm(N.location,C,y);d=f();let E=Ww(w,d),I=N.createHref(w);o.replaceState(E,"",I),i&&c&&c({action:l,location:N.location,delta:0})}function R(C){return tP(C)}let N={get action(){return l},get location(){return t(s,o)},listen(C){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(Hw,h),c=C,()=>{s.removeEventListener(Hw,h),c=null}},createHref(C){return e(s,C)},createURL:R,encodeLocation(C){let y=R(C);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:m,replace:v,go(C){return o.go(C)}};return N}function tP(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),yt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Cc(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function K0(t,e,n="/"){return nP(t,e,n,!1)}function nP(t,e,n,r){let s=typeof e=="string"?Qa(e):e,i=vs(s.pathname||"/",n);if(i==null)return null;let o=Q0(t);rP(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=pP(i);l=hP(o[c],d,r)}return l}function Q0(t,e=[],n=[],r="",s=!1){let i=(o,l,c=s,d)=>{let f={relativePath:d===void 0?o.path||"":d,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(r)&&c)return;yt(f.relativePath.startsWith(r),`Absolute route path "${f.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(r.length)}let h=hs([r,f.relativePath]),m=n.concat(f);o.children&&o.children.length>0&&(yt(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),Q0(o.children,e,m,h,c)),!(o.path==null&&!o.index)&&e.push({path:h,score:uP(h,o.index),routesMeta:m})};return t.forEach((o,l)=>{var c;if(o.path===""||!((c=o.path)!=null&&c.includes("?")))i(o,l);else for(let d of Y0(o.path))i(o,l,!0,d)}),e}function Y0(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=Y0(r.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...o),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function rP(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:dP(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var sP=/^:[\w-]+$/,iP=3,oP=2,aP=1,lP=10,cP=-2,Gw=t=>t==="*";function uP(t,e){let n=t.split("/"),r=n.length;return n.some(Gw)&&(r+=cP),e&&(r+=oP),n.filter(s=>!Gw(s)).reduce((s,i)=>s+(sP.test(i)?iP:i===""?aP:lP),r)}function dP(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function hP(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",h=eh({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},f),m=c.route;if(!h&&d&&n&&!r[r.length-1].route.index&&(h=eh({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},f)),!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:hs([i,h.pathname]),pathnameBase:_P(hs([i,h.pathnameBase])),route:m}),h.pathnameBase!=="/"&&(i=hs([i,h.pathnameBase]))}return o}function eh(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=fP(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,{paramName:f,isOptional:h},m)=>{if(f==="*"){let R=l[m]||"";o=i.slice(0,i.length-R.length).replace(/(.)\/+$/,"$1")}const v=l[m];return h&&!v?d[f]=void 0:d[f]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:t}}function fP(t,e=!1,n=!0){dr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function pP(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return dr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function vs(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var mP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gP=t=>mP.test(t);function yP(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Qa(t):t,i;if(n)if(gP(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),dr(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=Kw(n.substring(1),"/"):i=Kw(n,e)}else i=e;return{pathname:i,search:wP(r),hash:xP(s)}}function Kw(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function _p(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function vP(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Ey(t){let e=vP(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function by(t,e,n,r=!1){let s;typeof t=="string"?s=Qa(t):(s={...t},yt(!s.pathname||!s.pathname.includes("?"),_p("?","pathname","search",s)),yt(!s.pathname||!s.pathname.includes("#"),_p("#","pathname","hash",s)),yt(!s.search||!s.search.includes("#"),_p("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,l;if(o==null)l=n;else{let h=e.length-1;if(!r&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),h-=1;s.pathname=m.join("/")}l=h>=0?e[h]:"/"}let c=yP(s,l),d=o&&o!=="/"&&o.endsWith("/"),f=(i||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||f)&&(c.pathname+="/"),c}var hs=t=>t.join("/").replace(/\/\/+/g,"/"),_P=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),wP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,xP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function EP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var X0=["POST","PUT","PATCH","DELETE"];new Set(X0);var bP=["GET",...X0];new Set(bP);var Ya=S.createContext(null);Ya.displayName="DataRouter";var Gh=S.createContext(null);Gh.displayName="DataRouterState";S.createContext(!1);var J0=S.createContext({isTransitioning:!1});J0.displayName="ViewTransition";var IP=S.createContext(new Map);IP.displayName="Fetchers";var TP=S.createContext(null);TP.displayName="Await";var Rr=S.createContext(null);Rr.displayName="Navigation";var Qc=S.createContext(null);Qc.displayName="Location";var Pr=S.createContext({outlet:null,matches:[],isDataRoute:!1});Pr.displayName="Route";var Iy=S.createContext(null);Iy.displayName="RouteError";function SP(t,{relative:e}={}){yt(Xa(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=S.useContext(Rr),{hash:s,pathname:i,search:o}=Yc(t,{relative:e}),l=i;return n!=="/"&&(l=i==="/"?n:hs([n,i])),r.createHref({pathname:l,search:o,hash:s})}function Xa(){return S.useContext(Qc)!=null}function yn(){return yt(Xa(),"useLocation() may be used only in the context of a <Router> component."),S.useContext(Qc).location}var Z0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function eT(t){S.useContext(Rr).static||S.useLayoutEffect(t)}function kr(){let{isDataRoute:t}=S.useContext(Pr);return t?UP():CP()}function CP(){yt(Xa(),"useNavigate() may be used only in the context of a <Router> component.");let t=S.useContext(Ya),{basename:e,navigator:n}=S.useContext(Rr),{matches:r}=S.useContext(Pr),{pathname:s}=yn(),i=JSON.stringify(Ey(r)),o=S.useRef(!1);return eT(()=>{o.current=!0}),S.useCallback((c,d={})=>{if(dr(o.current,Z0),!o.current)return;if(typeof c=="number"){n.go(c);return}let f=by(c,JSON.parse(i),s,d.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:hs([e,f.pathname])),(d.replace?n.replace:n.push)(f,d.state,d)},[e,n,i,s,t])}S.createContext(null);function NP(){let{matches:t}=S.useContext(Pr),e=t[t.length-1];return e?e.params:{}}function Yc(t,{relative:e}={}){let{matches:n}=S.useContext(Pr),{pathname:r}=yn(),s=JSON.stringify(Ey(n));return S.useMemo(()=>by(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function AP(t,e){return tT(t,e)}function tT(t,e,n,r,s){var w;yt(Xa(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=S.useContext(Rr),{matches:o}=S.useContext(Pr),l=o[o.length-1],c=l?l.params:{},d=l?l.pathname:"/",f=l?l.pathnameBase:"/",h=l&&l.route;{let E=h&&h.path||"";nT(d,!h||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let m=yn(),v;if(e){let E=typeof e=="string"?Qa(e):e;yt(f==="/"||((w=E.pathname)==null?void 0:w.startsWith(f)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${E.pathname}" was given in the \`location\` prop.`),v=E}else v=m;let R=v.pathname||"/",N=R;if(f!=="/"){let E=f.replace(/^\//,"").split("/");N="/"+R.replace(/^\//,"").split("/").slice(E.length).join("/")}let C=K0(t,{pathname:N});dr(h||C!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),dr(C==null||C[C.length-1].route.element!==void 0||C[C.length-1].route.Component!==void 0||C[C.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let y=DP(C&&C.map(E=>Object.assign({},E,{params:Object.assign({},c,E.params),pathname:hs([f,i.encodeLocation?i.encodeLocation(E.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?f:hs([f,i.encodeLocation?i.encodeLocation(E.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathnameBase])})),o,n,r,s);return e&&y?S.createElement(Qc.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},y):y}function RP(){let t=FP(),e=EP(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=S.createElement(S.Fragment,null,S.createElement("p",null," Hey developer "),S.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",S.createElement("code",{style:i},"ErrorBoundary")," or"," ",S.createElement("code",{style:i},"errorElement")," prop on your route.")),S.createElement(S.Fragment,null,S.createElement("h2",null,"Unexpected Application Error!"),S.createElement("h3",{style:{fontStyle:"italic"}},e),n?S.createElement("pre",{style:s},n):null,o)}var PP=S.createElement(RP,null),kP=class extends S.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?S.createElement(Pr.Provider,{value:this.props.routeContext},S.createElement(Iy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function jP({routeContext:t,match:e,children:n}){let r=S.useContext(Ya);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),S.createElement(Pr.Provider,{value:t},n)}function DP(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let f=i.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);yt(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,f+1))}let l=!1,c=-1;if(n)for(let f=0;f<i.length;f++){let h=i[f];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=f),h.route.id){let{loaderData:m,errors:v}=n,R=h.route.loader&&!m.hasOwnProperty(h.route.id)&&(!v||v[h.route.id]===void 0);if(h.route.lazy||R){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}let d=n&&r?(f,h)=>{var m,v;r(f,{location:n.location,params:((v=(m=n.matches)==null?void 0:m[0])==null?void 0:v.params)??{},errorInfo:h})}:void 0;return i.reduceRight((f,h,m)=>{let v,R=!1,N=null,C=null;n&&(v=o&&h.route.id?o[h.route.id]:void 0,N=h.route.errorElement||PP,l&&(c<0&&m===0?(nT("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),R=!0,C=null):c===m&&(R=!0,C=h.route.hydrateFallbackElement||null)));let y=e.concat(i.slice(0,m+1)),w=()=>{let E;return v?E=N:R?E=C:h.route.Component?E=S.createElement(h.route.Component,null):h.route.element?E=h.route.element:E=f,S.createElement(jP,{match:h,routeContext:{outlet:f,matches:y,isDataRoute:n!=null},children:E})};return n&&(h.route.ErrorBoundary||h.route.errorElement||m===0)?S.createElement(kP,{location:n.location,revalidation:n.revalidation,component:N,error:v,children:w(),routeContext:{outlet:null,matches:y,isDataRoute:!0},onError:d}):w()},null)}function Ty(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function OP(t){let e=S.useContext(Ya);return yt(e,Ty(t)),e}function LP(t){let e=S.useContext(Gh);return yt(e,Ty(t)),e}function VP(t){let e=S.useContext(Pr);return yt(e,Ty(t)),e}function Sy(t){let e=VP(t),n=e.matches[e.matches.length-1];return yt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function MP(){return Sy("useRouteId")}function FP(){var r;let t=S.useContext(Iy),e=LP("useRouteError"),n=Sy("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function UP(){let{router:t}=OP("useNavigate"),e=Sy("useNavigate"),n=S.useRef(!1);return eT(()=>{n.current=!0}),S.useCallback(async(s,i={})=>{dr(n.current,Z0),n.current&&(typeof s=="number"?t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var Qw={};function nT(t,e,n){!e&&!Qw[t]&&(Qw[t]=!0,dr(!1,n))}S.memo($P);function $P({routes:t,future:e,state:n,unstable_onError:r}){return tT(t,void 0,n,r,e)}function th({to:t,replace:e,state:n,relative:r}){yt(Xa(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=S.useContext(Rr);dr(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=S.useContext(Pr),{pathname:o}=yn(),l=kr(),c=by(t,Ey(i),o,r==="path"),d=JSON.stringify(c);return S.useEffect(()=>{l(JSON.parse(d),{replace:e,state:n,relative:r})},[l,d,r,e,n]),null}function Go(t){yt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function BP({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1}){yt(!Xa(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),l=S.useMemo(()=>({basename:o,navigator:s,static:i,future:{}}),[o,s,i]);typeof n=="string"&&(n=Qa(n));let{pathname:c="/",search:d="",hash:f="",state:h=null,key:m="default"}=n,v=S.useMemo(()=>{let R=vs(c,o);return R==null?null:{location:{pathname:R,search:d,hash:f,state:h,key:m},navigationType:r}},[o,c,d,f,h,m,r]);return dr(v!=null,`<Router basename="${o}"> is not able to match the URL "${c}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:S.createElement(Rr.Provider,{value:l},S.createElement(Qc.Provider,{children:e,value:v}))}function zP({children:t,location:e}){return AP(qm(t),e)}function qm(t,e=[]){let n=[];return S.Children.forEach(t,(r,s)=>{if(!S.isValidElement(r))return;let i=[...e,s];if(r.type===S.Fragment){n.push.apply(n,qm(r.props.children,i));return}yt(r.type===Go,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),yt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=qm(r.props.children,i)),n.push(o)}),n}var hd="get",fd="application/x-www-form-urlencoded";function Kh(t){return t!=null&&typeof t.tagName=="string"}function qP(t){return Kh(t)&&t.tagName.toLowerCase()==="button"}function HP(t){return Kh(t)&&t.tagName.toLowerCase()==="form"}function WP(t){return Kh(t)&&t.tagName.toLowerCase()==="input"}function GP(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function KP(t,e){return t.button===0&&(!e||e==="_self")&&!GP(t)}var $u=null;function QP(){if($u===null)try{new FormData(document.createElement("form"),0),$u=!1}catch{$u=!0}return $u}var YP=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function wp(t){return t!=null&&!YP.has(t)?(dr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${fd}"`),null):t}function XP(t,e){let n,r,s,i,o;if(HP(t)){let l=t.getAttribute("action");r=l?vs(l,e):null,n=t.getAttribute("method")||hd,s=wp(t.getAttribute("enctype"))||fd,i=new FormData(t)}else if(qP(t)||WP(t)&&(t.type==="submit"||t.type==="image")){let l=t.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||l.getAttribute("action");if(r=c?vs(c,e):null,n=t.getAttribute("formmethod")||l.getAttribute("method")||hd,s=wp(t.getAttribute("formenctype"))||wp(l.getAttribute("enctype"))||fd,i=new FormData(l,t),!QP()){let{name:d,type:f,value:h}=t;if(f==="image"){let m=d?`${d}.`:"";i.append(`${m}x`,"0"),i.append(`${m}y`,"0")}else d&&i.append(d,h)}}else{if(Kh(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=hd,r=null,s=fd,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Cy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function JP(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&vs(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function ZP(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ek(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function tk(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await ZP(i,n);return o.links?o.links():[]}return[]}));return ik(r.flat(1).filter(ek).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Yw(t,e,n,r,s,i){let o=(c,d)=>n[d]?c.route.id!==n[d].route.id:!0,l=(c,d)=>{var f;return n[d].pathname!==c.pathname||((f=n[d].route.path)==null?void 0:f.endsWith("*"))&&n[d].params["*"]!==c.params["*"]};return i==="assets"?e.filter((c,d)=>o(c,d)||l(c,d)):i==="data"?e.filter((c,d)=>{var h;let f=r.routes[c.route.id];if(!f||!f.hasLoader)return!1;if(o(c,d)||l(c,d))return!0;if(c.route.shouldRevalidate){let m=c.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((h=n[0])==null?void 0:h.params)||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function nk(t,e,{includeHydrateFallback:n}={}){return rk(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function rk(t){return[...new Set(t)]}function sk(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function ik(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let i=JSON.stringify(sk(s));return n.has(i)||(n.add(i),r.push({key:i,link:s})),r},[])}function rT(){let t=S.useContext(Ya);return Cy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function ok(){let t=S.useContext(Gh);return Cy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Ny=S.createContext(void 0);Ny.displayName="FrameworkContext";function sT(){let t=S.useContext(Ny);return Cy(t,"You must render this element inside a <HydratedRouter> element"),t}function ak(t,e){let n=S.useContext(Ny),[r,s]=S.useState(!1),[i,o]=S.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:d,onMouseLeave:f,onTouchStart:h}=e,m=S.useRef(null);S.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let N=y=>{y.forEach(w=>{o(w.isIntersecting)})},C=new IntersectionObserver(N,{threshold:.5});return m.current&&C.observe(m.current),()=>{C.disconnect()}}},[t]),S.useEffect(()=>{if(r){let N=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(N)}}},[r]);let v=()=>{s(!0)},R=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,m,{}]:[i,m,{onFocus:bl(l,v),onBlur:bl(c,R),onMouseEnter:bl(d,v),onMouseLeave:bl(f,R),onTouchStart:bl(h,v)}]:[!1,m,{}]}function bl(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function lk({page:t,...e}){let{router:n}=rT(),r=S.useMemo(()=>K0(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?S.createElement(uk,{page:t,matches:r,...e}):null}function ck(t){let{manifest:e,routeModules:n}=sT(),[r,s]=S.useState([]);return S.useEffect(()=>{let i=!1;return tk(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function uk({page:t,matches:e,...n}){let r=yn(),{manifest:s,routeModules:i}=sT(),{basename:o}=rT(),{loaderData:l,matches:c}=ok(),d=S.useMemo(()=>Yw(t,e,c,s,r,"data"),[t,e,c,s,r]),f=S.useMemo(()=>Yw(t,e,c,s,r,"assets"),[t,e,c,s,r]),h=S.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let R=new Set,N=!1;if(e.forEach(y=>{var E;let w=s.routes[y.route.id];!w||!w.hasLoader||(!d.some(I=>I.route.id===y.route.id)&&y.route.id in l&&((E=i[y.route.id])!=null&&E.shouldRevalidate)||w.hasClientLoader?N=!0:R.add(y.route.id))}),R.size===0)return[];let C=JP(t,o,"data");return N&&R.size>0&&C.searchParams.set("_routes",e.filter(y=>R.has(y.route.id)).map(y=>y.route.id).join(",")),[C.pathname+C.search]},[o,l,r,s,d,e,t,i]),m=S.useMemo(()=>nk(f,s),[f,s]),v=ck(f);return S.createElement(S.Fragment,null,h.map(R=>S.createElement("link",{key:R,rel:"prefetch",as:"fetch",href:R,...n})),m.map(R=>S.createElement("link",{key:R,rel:"modulepreload",href:R,...n})),v.map(({key:R,link:N})=>S.createElement("link",{key:R,nonce:n.nonce,...N})))}function dk(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var iT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{iT&&(window.__reactRouterVersion="7.9.6")}catch{}function hk({basename:t,children:e,window:n}){let r=S.useRef();r.current==null&&(r.current=JR({window:n,v5Compat:!0}));let s=r.current,[i,o]=S.useState({action:s.action,location:s.location}),l=S.useCallback(c=>{S.startTransition(()=>o(c))},[o]);return S.useLayoutEffect(()=>s.listen(l),[s,l]),S.createElement(BP,{basename:t,children:e,location:i.location,navigationType:i.action,navigator:s})}var oT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,aT=S.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:l,target:c,to:d,preventScrollReset:f,viewTransition:h,...m},v){let{basename:R}=S.useContext(Rr),N=typeof d=="string"&&oT.test(d),C,y=!1;if(typeof d=="string"&&N&&(C=d,iT))try{let _=new URL(window.location.href),P=d.startsWith("//")?new URL(_.protocol+d):new URL(d),D=vs(P.pathname,R);P.origin===_.origin&&D!=null?d=D+P.search+P.hash:y=!0}catch{dr(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let w=SP(d,{relative:s}),[E,I,M]=ak(r,m),$=mk(d,{replace:o,state:l,target:c,preventScrollReset:f,relative:s,viewTransition:h});function b(_){e&&e(_),_.defaultPrevented||$(_)}let x=S.createElement("a",{...m,...M,href:C||w,onClick:y||i?e:b,ref:dk(v,I),target:c,"data-discover":!N&&n==="render"?"true":void 0});return E&&!N?S.createElement(S.Fragment,null,x,S.createElement(lk,{page:w})):x});aT.displayName="Link";var Ko=S.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:l,children:c,...d},f){let h=Yc(o,{relative:d.relative}),m=yn(),v=S.useContext(Gh),{navigator:R,basename:N}=S.useContext(Rr),C=v!=null&&wk(h)&&l===!0,y=R.encodeLocation?R.encodeLocation(h).pathname:h.pathname,w=m.pathname,E=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;n||(w=w.toLowerCase(),E=E?E.toLowerCase():null,y=y.toLowerCase()),E&&N&&(E=vs(E,N)||E);const I=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let M=w===y||!s&&w.startsWith(y)&&w.charAt(I)==="/",$=E!=null&&(E===y||!s&&E.startsWith(y)&&E.charAt(y.length)==="/"),b={isActive:M,isPending:$,isTransitioning:C},x=M?e:void 0,_;typeof r=="function"?_=r(b):_=[r,M?"active":null,$?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let P=typeof i=="function"?i(b):i;return S.createElement(aT,{...d,"aria-current":x,className:_,ref:f,style:P,to:o,viewTransition:l},typeof c=="function"?c(b):c)});Ko.displayName="NavLink";var fk=S.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=hd,action:l,onSubmit:c,relative:d,preventScrollReset:f,viewTransition:h,...m},v)=>{let R=vk(),N=_k(l,{relative:d}),C=o.toLowerCase()==="get"?"get":"post",y=typeof l=="string"&&oT.test(l),w=E=>{if(c&&c(E),E.defaultPrevented)return;E.preventDefault();let I=E.nativeEvent.submitter,M=(I==null?void 0:I.getAttribute("formmethod"))||o;R(I||E.currentTarget,{fetcherKey:e,method:M,navigate:n,replace:s,state:i,relative:d,preventScrollReset:f,viewTransition:h})};return S.createElement("form",{ref:v,method:C,action:N,onSubmit:r?c:w,...m,"data-discover":!y&&t==="render"?"true":void 0})});fk.displayName="Form";function pk(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lT(t){let e=S.useContext(Ya);return yt(e,pk(t)),e}function mk(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let l=kr(),c=yn(),d=Yc(t,{relative:i});return S.useCallback(f=>{if(KP(f,e)){f.preventDefault();let h=n!==void 0?n:Cc(c)===Cc(d);l(t,{replace:h,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[c,l,d,n,r,e,t,s,i,o])}var gk=0,yk=()=>`__${String(++gk)}__`;function vk(){let{router:t}=lT("useSubmit"),{basename:e}=S.useContext(Rr),n=MP();return S.useCallback(async(r,s={})=>{let{action:i,method:o,encType:l,formData:c,body:d}=XP(r,e);if(s.navigate===!1){let f=s.fetcherKey||yk();await t.fetch(f,n,s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||o,formEncType:s.encType||l,flushSync:s.flushSync})}else await t.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||o,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:n,flushSync:s.flushSync,viewTransition:s.viewTransition})},[t,e,n])}function _k(t,{relative:e}={}){let{basename:n}=S.useContext(Rr),r=S.useContext(Pr);yt(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Yc(t||".",{relative:e})},o=yn();if(t==null){i.search=o.search;let l=new URLSearchParams(i.search),c=l.getAll("index");if(c.some(f=>f==="")){l.delete("index"),c.filter(h=>h).forEach(h=>l.append("index",h));let f=l.toString();i.search=f?`?${f}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:hs([n,i.pathname])),Cc(i)}function wk(t,{relative:e}={}){let n=S.useContext(J0);yt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=lT("useViewTransitionState"),s=Yc(t,{relative:e});if(!n.isTransitioning)return!1;let i=vs(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=vs(n.nextLocation.pathname,r)||n.nextLocation.pathname;return eh(s.pathname,o)!=null||eh(s.pathname,i)!=null}const xk=()=>{};var Xw={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cT=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Ek=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},uT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,f=i>>2,h=(i&3)<<4|l>>4;let m=(l&15)<<2|d>>6,v=d&63;c||(v=64,o||(m=64)),r.push(n[f],n[h],n[m],n[v])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(cT(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Ek(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||h==null)throw new bk;const m=i<<2|l>>4;if(r.push(m),d!==64){const v=l<<4&240|d>>2;if(r.push(v),h!==64){const R=d<<6&192|h;r.push(R)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class bk extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ik=function(t){const e=cT(t);return uT.encodeByteArray(e,!0)},nh=function(t){return Ik(t).replace(/\./g,"")},dT=function(t){try{return uT.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hT(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tk=()=>hT().__FIREBASE_DEFAULTS__,Sk=()=>{if(typeof process>"u"||typeof Xw>"u")return;const t=Xw.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Ck=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&dT(t[1]);return e&&JSON.parse(e)},Qh=()=>{try{return xk()||Tk()||Sk()||Ck()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},fT=t=>{var e,n;return(n=(e=Qh())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},pT=t=>{const e=fT(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},mT=()=>{var t;return(t=Qh())==null?void 0:t.config},gT=t=>{var e;return(e=Qh())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nk{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bi(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ay(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yT(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[nh(JSON.stringify(n)),nh(JSON.stringify(o)),""].join(".")}const ec={};function Ak(){const t={prod:[],emulator:[]};for(const e of Object.keys(ec))ec[e]?t.emulator.push(e):t.prod.push(e);return t}function Rk(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Jw=!1;function Ry(t,e){if(typeof window>"u"||typeof document>"u"||!bi(window.location.host)||ec[t]===e||ec[t]||Jw)return;ec[t]=e;function n(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=Ak().prod.length>0;function o(){const m=document.getElementById(r);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,v){m.setAttribute("width","24"),m.setAttribute("id",v),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function d(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{Jw=!0,o()},m}function f(m,v){m.setAttribute("id",v),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function h(){const m=Rk(r),v=n("text"),R=document.getElementById(v)||document.createElement("span"),N=n("learnmore"),C=document.getElementById(N)||document.createElement("a"),y=n("preprendIcon"),w=document.getElementById(y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const E=m.element;l(E),f(C,N);const I=d();c(w,y),E.append(w,R,C,I),document.body.appendChild(E)}i?(R.innerText="Preview backend disconnected.",w.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(w.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,R.innerText="Preview backend running in this workspace."),R.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Pk(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qt())}function vT(){var e;const t=(e=Qh())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function kk(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function _T(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function jk(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Dk(){const t=qt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function wT(){return!vT()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function xT(){return!vT()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Py(){try{return typeof indexedDB=="object"}catch{return!1}}function ET(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}function Ok(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk="FirebaseError";class fr extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Lk,Object.setPrototypeOf(this,fr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Co.prototype.create)}}class Co{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?Vk(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new fr(s,l,r)}}function Vk(t,e){return t.replace(Mk,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Mk=/\{\$([^}]+)}/g;function Fk(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function _s(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(Zw(i)&&Zw(o)){if(!_s(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Zw(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xc(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ll(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Vl(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function Uk(t,e){const n=new $k(t,e);return n.subscribe.bind(n)}class $k{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Bk(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=xp),s.error===void 0&&(s.error=xp),s.complete===void 0&&(s.complete=xp);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Bk(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function xp(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zk=1e3,qk=2,Hk=4*60*60*1e3,Wk=.5;function ex(t,e=zk,n=qk){const r=e*Math.pow(n,t),s=Math.round(Wk*r*(Math.random()-.5)*2);return Math.min(Hk,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tt(t){return t&&t._delegate?t._delegate:t}class hr{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new Nk;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Qk(e))try{this.getOrInitializeService({instanceIdentifier:Mi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Mi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Mi){return this.instances.has(e)}getOptions(e=Mi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Kk(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Mi){return this.component?this.component.multipleInstances?e:Mi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Kk(t){return t===Mi?void 0:t}function Qk(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Gk(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $e;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})($e||($e={}));const Xk={debug:$e.DEBUG,verbose:$e.VERBOSE,info:$e.INFO,warn:$e.WARN,error:$e.ERROR,silent:$e.SILENT},Jk=$e.INFO,Zk={[$e.DEBUG]:"log",[$e.VERBOSE]:"log",[$e.INFO]:"info",[$e.WARN]:"warn",[$e.ERROR]:"error"},ej=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=Zk[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Yh{constructor(e){this.name=e,this._logLevel=Jk,this._logHandler=ej,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $e))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Xk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$e.DEBUG,...e),this._logHandler(this,$e.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$e.VERBOSE,...e),this._logHandler(this,$e.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$e.INFO,...e),this._logHandler(this,$e.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$e.WARN,...e),this._logHandler(this,$e.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$e.ERROR,...e),this._logHandler(this,$e.ERROR,...e)}}const tj=(t,e)=>e.some(n=>t instanceof n);let tx,nx;function nj(){return tx||(tx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function rj(){return nx||(nx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const bT=new WeakMap,Hm=new WeakMap,IT=new WeakMap,Ep=new WeakMap,ky=new WeakMap;function sj(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(ai(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&bT.set(n,t)}).catch(()=>{}),ky.set(e,t),e}function ij(t){if(Hm.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});Hm.set(t,e)}let Wm={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Hm.get(t);if(e==="objectStoreNames")return t.objectStoreNames||IT.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ai(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function oj(t){Wm=t(Wm)}function aj(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(bp(this),e,...n);return IT.set(r,e.sort?e.sort():[e]),ai(r)}:rj().includes(t)?function(...e){return t.apply(bp(this),e),ai(bT.get(this))}:function(...e){return ai(t.apply(bp(this),e))}}function lj(t){return typeof t=="function"?aj(t):(t instanceof IDBTransaction&&ij(t),tj(t,nj())?new Proxy(t,Wm):t)}function ai(t){if(t instanceof IDBRequest)return sj(t);if(Ep.has(t))return Ep.get(t);const e=lj(t);return e!==t&&(Ep.set(t,e),ky.set(e,t)),e}const bp=t=>ky.get(t);function TT(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=ai(o);return r&&o.addEventListener("upgradeneeded",c=>{r(ai(o.result),c.oldVersion,c.newVersion,ai(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const cj=["get","getKey","getAll","getAllKeys","count"],uj=["put","add","delete","clear"],Ip=new Map;function rx(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ip.get(e))return Ip.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=uj.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||cj.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return Ip.set(e,i),i}oj(t=>({...t,get:(e,n,r)=>rx(e,n)||t.get(e,n,r),has:(e,n)=>!!rx(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dj{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(hj(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function hj(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Gm="@firebase/app",sx="0.14.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ws=new Yh("@firebase/app"),fj="@firebase/app-compat",pj="@firebase/analytics-compat",mj="@firebase/analytics",gj="@firebase/app-check-compat",yj="@firebase/app-check",vj="@firebase/auth",_j="@firebase/auth-compat",wj="@firebase/database",xj="@firebase/data-connect",Ej="@firebase/database-compat",bj="@firebase/functions",Ij="@firebase/functions-compat",Tj="@firebase/installations",Sj="@firebase/installations-compat",Cj="@firebase/messaging",Nj="@firebase/messaging-compat",Aj="@firebase/performance",Rj="@firebase/performance-compat",Pj="@firebase/remote-config",kj="@firebase/remote-config-compat",jj="@firebase/storage",Dj="@firebase/storage-compat",Oj="@firebase/firestore",Lj="@firebase/ai",Vj="@firebase/firestore-compat",Mj="firebase",Fj="12.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Km="[DEFAULT]",Uj={[Gm]:"fire-core",[fj]:"fire-core-compat",[mj]:"fire-analytics",[pj]:"fire-analytics-compat",[yj]:"fire-app-check",[gj]:"fire-app-check-compat",[vj]:"fire-auth",[_j]:"fire-auth-compat",[wj]:"fire-rtdb",[xj]:"fire-data-connect",[Ej]:"fire-rtdb-compat",[bj]:"fire-fn",[Ij]:"fire-fn-compat",[Tj]:"fire-iid",[Sj]:"fire-iid-compat",[Cj]:"fire-fcm",[Nj]:"fire-fcm-compat",[Aj]:"fire-perf",[Rj]:"fire-perf-compat",[Pj]:"fire-rc",[kj]:"fire-rc-compat",[jj]:"fire-gcs",[Dj]:"fire-gcs-compat",[Oj]:"fire-fst",[Vj]:"fire-fst-compat",[Lj]:"fire-vertex","fire-js":"fire-js",[Mj]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rh=new Map,$j=new Map,Qm=new Map;function ix(t,e){try{t.container.addComponent(e)}catch(n){ws.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Cr(t){const e=t.name;if(Qm.has(e))return ws.debug(`There were multiple attempts to register component ${e}.`),!1;Qm.set(e,t);for(const n of rh.values())ix(n,t);for(const n of $j.values())ix(n,t);return!0}function Ii(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function rr(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bj={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},li=new Co("app","Firebase",Bj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zj{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new hr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw li.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const No=Fj;function jy(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Km,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw li.create("bad-app-name",{appName:String(s)});if(n||(n=mT()),!n)throw li.create("no-options");const i=rh.get(s);if(i){if(_s(n,i.options)&&_s(r,i.config))return i;throw li.create("duplicate-app",{appName:s})}const o=new Yk(s);for(const c of Qm.values())o.addComponent(c);const l=new zj(n,r,o);return rh.set(s,l),l}function Xh(t=Km){const e=rh.get(t);if(!e&&t===Km&&mT())return jy();if(!e)throw li.create("no-app",{appName:t});return e}function Vn(t,e,n){let r=Uj[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ws.warn(o.join(" "));return}Cr(new hr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qj="firebase-heartbeat-database",Hj=1,Nc="firebase-heartbeat-store";let Tp=null;function ST(){return Tp||(Tp=TT(qj,Hj,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Nc)}catch(n){console.warn(n)}}}}).catch(t=>{throw li.create("idb-open",{originalErrorMessage:t.message})})),Tp}async function Wj(t){try{const n=(await ST()).transaction(Nc),r=await n.objectStore(Nc).get(CT(t));return await n.done,r}catch(e){if(e instanceof fr)ws.warn(e.message);else{const n=li.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ws.warn(n.message)}}}async function ox(t,e){try{const r=(await ST()).transaction(Nc,"readwrite");await r.objectStore(Nc).put(e,CT(t)),await r.done}catch(n){if(n instanceof fr)ws.warn(n.message);else{const r=li.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ws.warn(r.message)}}}function CT(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gj=1024,Kj=30;class Qj{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Xj(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=ax();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>Kj){const o=Jj(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ws.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=ax(),{heartbeatsToSend:r,unsentEntries:s}=Yj(this._heartbeatsCache.heartbeats),i=nh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ws.warn(n),""}}}function ax(){return new Date().toISOString().substring(0,10)}function Yj(t,e=Gj){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),lx(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),lx(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Xj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Py()?ET().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Wj(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ox(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return ox(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function lx(t){return nh(JSON.stringify({version:2,heartbeats:t})).length}function Jj(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zj(t){Cr(new hr("platform-logger",e=>new dj(e),"PRIVATE")),Cr(new hr("heartbeat",e=>new Qj(e),"PRIVATE")),Vn(Gm,sx,t),Vn(Gm,sx,"esm2020"),Vn("fire-js","")}Zj("");var eD="firebase",tD="12.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Vn(eD,tD,"app");function NT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const nD=NT,AT=new Co("auth","Firebase",NT());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sh=new Yh("@firebase/auth");function rD(t,...e){sh.logLevel<=$e.WARN&&sh.warn(`Auth (${No}): ${t}`,...e)}function pd(t,...e){sh.logLevel<=$e.ERROR&&sh.error(`Auth (${No}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(t,...e){throw Dy(t,...e)}function Qr(t,...e){return Dy(t,...e)}function RT(t,e,n){const r={...nD(),[e]:n};return new Co("auth","Firebase",r).create(e,{appName:t.name})}function ci(t){return RT(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Dy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return AT.create(t,...e)}function Te(t,e,...n){if(!t)throw Dy(e,...n)}function ls(t){const e="INTERNAL ASSERTION FAILED: "+t;throw pd(e),new Error(e)}function xs(t,e){t||ls(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ym(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function sD(){return cx()==="http:"||cx()==="https:"}function cx(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(sD()||_T()||"connection"in navigator)?navigator.onLine:!0}function oD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,n){this.shortDelay=e,this.longDelay=n,xs(n>e,"Short delay should be less than long delay!"),this.isMobile=Pk()||jk()}get(){return iD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oy(t,e){xs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PT{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ls("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ls("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ls("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],cD=new Jc(3e4,6e4);function Ao(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ti(t,e,n,r,s={}){return kT(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=Xc({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return kk()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&bi(t.emulatorConfig.host)&&(d.credentials="include"),PT.fetch()(await jT(t,t.config.apiHost,n,l),d)})}async function kT(t,e,n){t._canInitEmulator=!1;const r={...aD,...e};try{const s=new dD(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Bu(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Bu(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Bu(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Bu(t,"user-disabled",o);const f=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw RT(t,f,d);Nr(t,f)}}catch(s){if(s instanceof fr)throw s;Nr(t,"network-request-failed",{message:String(s)})}}async function Jh(t,e,n,r,s={}){const i=await Ti(t,e,n,r,s);return"mfaPendingCredential"in i&&Nr(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function jT(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?Oy(t.config,s):`${t.config.apiScheme}://${s}`;return lD.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function uD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class dD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Qr(this.auth,"network-request-failed")),cD.get())})}}function Bu(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Qr(t,e,r);return s.customData._tokenResponse=n,s}function ux(t){return t!==void 0&&t.enterprise!==void 0}class hD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return uD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function fD(t,e){return Ti(t,"GET","/v2/recaptchaConfig",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pD(t,e){return Ti(t,"POST","/v1/accounts:delete",e)}async function ih(t,e){return Ti(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function mD(t,e=!1){const n=tt(t),r=await n.getIdToken(e),s=Ly(r);Te(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:tc(Sp(s.auth_time)),issuedAtTime:tc(Sp(s.iat)),expirationTime:tc(Sp(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Sp(t){return Number(t)*1e3}function Ly(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return pd("JWT malformed, contained fewer than 3 sections"),null;try{const s=dT(n);return s?JSON.parse(s):(pd("Failed to decode base64 JWT payload"),null)}catch(s){return pd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function dx(t){const e=Ly(t);return Te(e,"internal-error"),Te(typeof e.exp<"u","internal-error"),Te(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ac(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof fr&&gD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function gD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=tc(this.lastLoginAt),this.creationTime=tc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oh(t){var h;const e=t.auth,n=await t.getIdToken(),r=await Ac(t,ih(e,{idToken:n}));Te(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?DT(s.providerUserInfo):[],o=_D(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Xm(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,f)}async function vD(t){const e=tt(t);await oh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _D(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function DT(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wD(t,e){const n=await kT(t,{},async()=>{const r=Xc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await jT(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&bi(t.emulatorConfig.host)&&(c.credentials="include"),PT.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function xD(t,e){return Ti(t,"POST","/v2/accounts:revokeToken",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Te(e.idToken,"internal-error"),Te(typeof e.idToken<"u","internal-error"),Te(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):dx(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Te(e.length!==0,"internal-error");const n=dx(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Te(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await wD(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new va;return r&&(Te(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Te(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Te(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new va,this.toJSON())}_performRefresh(){return ls("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ds(t,e){Te(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Er{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new yD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Xm(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Ac(this,this.stsTokenManager.getToken(this.auth,e));return Te(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return mD(this,e)}reload(){return vD(this)}_assign(e){this!==e&&(Te(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Er({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Te(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await oh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(rr(this.auth.app))return Promise.reject(ci(this.auth));const e=await this.getIdToken();return await Ac(this,pD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,f=n.lastLoginAt??void 0,{uid:h,emailVerified:m,isAnonymous:v,providerData:R,stsTokenManager:N}=n;Te(h&&N,e,"internal-error");const C=va.fromJSON(this.name,N);Te(typeof h=="string",e,"internal-error"),Ds(r,e.name),Ds(s,e.name),Te(typeof m=="boolean",e,"internal-error"),Te(typeof v=="boolean",e,"internal-error"),Ds(i,e.name),Ds(o,e.name),Ds(l,e.name),Ds(c,e.name),Ds(d,e.name),Ds(f,e.name);const y=new Er({uid:h,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:v,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:C,createdAt:d,lastLoginAt:f});return R&&Array.isArray(R)&&(y.providerData=R.map(w=>({...w}))),c&&(y._redirectEventId=c),y}static async _fromIdTokenResponse(e,n,r=!1){const s=new va;s.updateFromServerResponse(n);const i=new Er({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await oh(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Te(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?DT(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new va;l.updateFromIdToken(r);const c=new Er({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Xm(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hx=new Map;function cs(t){xs(t instanceof Function,"Expected a class definition");let e=hx.get(t);return e?(xs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,hx.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}OT.type="NONE";const fx=OT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function md(t,e,n){return`firebase:${t}:${e}:${n}`}class _a{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=md(this.userKey,s.apiKey,i),this.fullPersistenceKey=md("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await ih(this.auth,{idToken:e}).catch(()=>{});return n?Er._fromGetAccountInfoResponse(this.auth,n,e):null}return Er._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new _a(cs(fx),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||cs(fx);const o=md(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const f=await d._get(o);if(f){let h;if(typeof f=="string"){const m=await ih(e,{idToken:f}).catch(()=>{});if(!m)break;h=await Er._fromGetAccountInfoResponse(e,m,f)}else h=Er._fromJSON(e,f);d!==i&&(l=h),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new _a(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new _a(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function px(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(FT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(LT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if($T(e))return"Blackberry";if(BT(e))return"Webos";if(VT(e))return"Safari";if((e.includes("chrome/")||MT(e))&&!e.includes("edge/"))return"Chrome";if(UT(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function LT(t=qt()){return/firefox\//i.test(t)}function VT(t=qt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function MT(t=qt()){return/crios\//i.test(t)}function FT(t=qt()){return/iemobile/i.test(t)}function UT(t=qt()){return/android/i.test(t)}function $T(t=qt()){return/blackberry/i.test(t)}function BT(t=qt()){return/webos/i.test(t)}function Vy(t=qt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function ED(t=qt()){var e;return Vy(t)&&!!((e=window.navigator)!=null&&e.standalone)}function bD(){return Dk()&&document.documentMode===10}function zT(t=qt()){return Vy(t)||UT(t)||BT(t)||$T(t)||/windows phone/i.test(t)||FT(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qT(t,e=[]){let n;switch(t){case"Browser":n=px(qt());break;case"Worker":n=`${px(qt())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${No}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TD(t,e={}){return Ti(t,"GET","/v2/passwordPolicy",Ao(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SD=6;class CD{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??SD,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new mx(this),this.idTokenSubscription=new mx(this),this.beforeStateQueue=new ID(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=AT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=cs(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await _a.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await ih(this,{idToken:e}),r=await Er._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(rr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Te(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await oh(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=oD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(rr(this.app))return Promise.reject(ci(this));const n=e?tt(e):null;return n&&Te(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Te(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return rr(this.app)?Promise.reject(ci(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return rr(this.app)?Promise.reject(ci(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(cs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await TD(this),n=new CD(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Co("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await xD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&cs(e)||this._popupRedirectResolver;Te(n,this,"argument-error"),this.redirectPersistenceManager=await _a.create(this,[cs(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Te(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Te(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(rr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&rD(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Ja(t){return tt(t)}class mx{constructor(e){this.auth=e,this.observer=null,this.addObserver=Uk(n=>this.observer=n)}get next(){return Te(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function AD(t){Zh=t}function HT(t){return Zh.loadJS(t)}function RD(){return Zh.recaptchaEnterpriseScript}function PD(){return Zh.gapiScript}function kD(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class jD{constructor(){this.enterprise=new DD}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class DD{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const OD="recaptcha-enterprise",WT="NO_RECAPTCHA";class LD{constructor(e){this.type=OD,this.auth=Ja(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{fD(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new hD(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;ux(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(WT)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new jD().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&ux(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=RD();c.length!==0&&(c+=l),HT(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function gx(t,e,n,r=!1,s=!1){const i=new LD(t);let o;if(s)o=WT;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function yx(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await gx(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await gx(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VD(t,e){const n=Ii(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(_s(i,e??{}))return s;Nr(s,"already-initialized")}return n.initialize({options:e})}function MD(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(cs);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function FD(t,e,n){const r=Ja(t);Te(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=GT(e),{host:o,port:l}=UD(e),c=l===null?"":`:${l}`,d={url:`${i}//${o}${c}/`},f=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Te(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Te(_s(d,r.config.emulator)&&_s(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,bi(o)?(Ay(`${i}//${o}${c}`),Ry("Auth",!0)):$D()}function GT(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function UD(t){const e=GT(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:vx(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:vx(o)}}}function vx(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function $D(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return ls("not implemented")}_getIdTokenResponse(e){return ls("not implemented")}_linkToIdToken(e,n){return ls("not implemented")}_getReauthenticationResolver(e){return ls("not implemented")}}async function BD(t,e){return Ti(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zD(t,e){return Jh(t,"POST","/v1/accounts:signInWithPassword",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qD(t,e){return Jh(t,"POST","/v1/accounts:signInWithEmailLink",Ao(t,e))}async function HD(t,e){return Jh(t,"POST","/v1/accounts:signInWithEmailLink",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc extends My{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Rc(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Rc(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yx(e,n,"signInWithPassword",zD);case"emailLink":return qD(e,{email:this._email,oobCode:this._password});default:Nr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yx(e,r,"signUpPassword",BD);case"emailLink":return HD(e,{idToken:n,email:this._email,oobCode:this._password});default:Nr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wa(t,e){return Jh(t,"POST","/v1/accounts:signInWithIdp",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WD="http://localhost";class uo extends My{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new uo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Nr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new uo(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return wa(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,wa(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,wa(e,n)}buildRequest(){const e={requestUri:WD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Xc(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GD(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function KD(t){const e=Ll(Vl(t)).link,n=e?Ll(Vl(e)).deep_link_id:null,r=Ll(Vl(t)).deep_link_id;return(r?Ll(Vl(r)).link:null)||r||n||e||t}class Fy{constructor(e){const n=Ll(Vl(e)),r=n.apiKey??null,s=n.oobCode??null,i=GD(n.mode??null);Te(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=KD(e);try{return new Fy(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Za{constructor(){this.providerId=Za.PROVIDER_ID}static credential(e,n){return Rc._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Fy.parseLink(n);return Te(r,"argument-error"),Rc._fromEmailAndCode(e,r.code,r.tenantId)}}Za.PROVIDER_ID="password";Za.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Za.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc extends KT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs extends Zc{constructor(){super("facebook.com")}static credential(e){return uo._fromParams({providerId:zs.PROVIDER_ID,signInMethod:zs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zs.credentialFromTaggedObject(e)}static credentialFromError(e){return zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return zs.credential(e.oauthAccessToken)}catch{return null}}}zs.FACEBOOK_SIGN_IN_METHOD="facebook.com";zs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs extends Zc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return uo._fromParams({providerId:qs.PROVIDER_ID,signInMethod:qs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return qs.credentialFromTaggedObject(e)}static credentialFromError(e){return qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return qs.credential(n,r)}catch{return null}}}qs.GOOGLE_SIGN_IN_METHOD="google.com";qs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs extends Zc{constructor(){super("github.com")}static credential(e){return uo._fromParams({providerId:Hs.PROVIDER_ID,signInMethod:Hs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Hs.credentialFromTaggedObject(e)}static credentialFromError(e){return Hs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Hs.credential(e.oauthAccessToken)}catch{return null}}}Hs.GITHUB_SIGN_IN_METHOD="github.com";Hs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws extends Zc{constructor(){super("twitter.com")}static credential(e,n){return uo._fromParams({providerId:Ws.PROVIDER_ID,signInMethod:Ws.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Ws.credentialFromTaggedObject(e)}static credentialFromError(e){return Ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Ws.credential(n,r)}catch{return null}}}Ws.TWITTER_SIGN_IN_METHOD="twitter.com";Ws.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Er._fromIdTokenResponse(e,r,s),o=_x(r);return new ka({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=_x(r);return new ka({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function _x(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ah extends fr{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ah.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new ah(e,n,r,s)}}function QT(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ah._fromErrorAndOperation(t,i,e,r):i})}async function QD(t,e,n=!1){const r=await Ac(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ka._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YD(t,e,n=!1){const{auth:r}=t;if(rr(r.app))return Promise.reject(ci(r));const s="reauthenticate";try{const i=await Ac(t,QT(r,s,e,t),n);Te(i.idToken,r,"internal-error");const o=Ly(i.idToken);Te(o,r,"internal-error");const{sub:l}=o;return Te(t.uid===l,r,"user-mismatch"),ka._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Nr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YT(t,e,n=!1){if(rr(t.app))return Promise.reject(ci(t));const r="signIn",s=await QT(t,r,e),i=await ka._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function XD(t,e){return YT(Ja(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JD(t){const e=Ja(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function ZD(t,e,n){return rr(t.app)?Promise.reject(ci(t)):XD(tt(t),Za.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&JD(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(t,e){return tt(t).setPersistence(e)}function t2(t,e,n,r){return tt(t).onIdTokenChanged(e,n,r)}function n2(t,e,n){return tt(t).beforeAuthStateChanged(e,n)}function Uy(t,e,n,r){return tt(t).onAuthStateChanged(e,n,r)}function r2(t){return tt(t).signOut()}const lh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(lh,"1"),this.storage.removeItem(lh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s2=1e3,i2=10;class JT extends XT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=zT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);bD()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,i2):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},s2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}JT.type="LOCAL";const ZT=JT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eS extends XT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}eS.type="SESSION";const tS=eS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ef{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new ef(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await o2(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ef.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $y(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=$y("",20);s.port1.start();const f=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const m=h;if(m.data.eventId===d)switch(m.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(m.data.response);break;default:clearTimeout(f),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yr(){return window}function l2(t){Yr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nS(){return typeof Yr().WorkerGlobalScope<"u"&&typeof Yr().importScripts=="function"}async function c2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function u2(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function d2(){return nS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rS="firebaseLocalStorageDb",h2=1,ch="firebaseLocalStorage",sS="fbase_key";class eu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function tf(t,e){return t.transaction([ch],e?"readwrite":"readonly").objectStore(ch)}function f2(){const t=indexedDB.deleteDatabase(rS);return new eu(t).toPromise()}function Jm(){const t=indexedDB.open(rS,h2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(ch,{keyPath:sS})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(ch)?e(r):(r.close(),await f2(),e(await Jm()))})})}async function wx(t,e,n){const r=tf(t,!0).put({[sS]:e,value:n});return new eu(r).toPromise()}async function p2(t,e){const n=tf(t,!1).get(e),r=await new eu(n).toPromise();return r===void 0?null:r.value}function xx(t,e){const n=tf(t,!0).delete(e);return new eu(n).toPromise()}const m2=800,g2=3;class iS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Jm(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>g2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return nS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ef._getInstance(d2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await c2(),!this.activeServiceWorker)return;this.sender=new a2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||u2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Jm();return await wx(e,lh,"1"),await xx(e,lh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>wx(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>p2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>xx(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=tf(s,!1).getAll();return new eu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),m2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}iS.type="LOCAL";const y2=iS;new Jc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v2(t,e){return e?cs(e):(Te(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By extends My{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return wa(e,this._buildIdpRequest())}_linkToIdToken(e,n){return wa(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return wa(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function _2(t){return YT(t.auth,new By(t),t.bypassAuthState)}function w2(t){const{auth:e,user:n}=t;return Te(n,e,"internal-error"),YD(n,new By(t),t.bypassAuthState)}async function x2(t){const{auth:e,user:n}=t;return Te(n,e,"internal-error"),QD(n,new By(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return _2;case"linkViaPopup":case"linkViaRedirect":return x2;case"reauthViaPopup":case"reauthViaRedirect":return w2;default:Nr(this.auth,"internal-error")}}resolve(e){xs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){xs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E2=new Jc(2e3,1e4);class da extends oS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,da.currentPopupAction&&da.currentPopupAction.cancel(),da.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Te(e,this.auth,"internal-error"),e}async onExecution(){xs(this.filter.length===1,"Popup operations only handle one event");const e=$y();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Qr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Qr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,da.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,E2.get())};e()}}da.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b2="pendingRedirect",gd=new Map;class I2 extends oS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=gd.get(this.auth._key());if(!e){try{const r=await T2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}gd.set(this.auth._key(),e)}return this.bypassAuthState||gd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function T2(t,e){const n=N2(e),r=C2(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function S2(t,e){gd.set(t._key(),e)}function C2(t){return cs(t._redirectPersistence)}function N2(t){return md(b2,t.config.apiKey,t.name)}async function A2(t,e,n=!1){if(rr(t.app))return Promise.reject(ci(t));const r=Ja(t),s=v2(r,e),o=await new I2(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R2=10*60*1e3;class P2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!k2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!aS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Qr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=R2&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ex(e))}saveEventToCache(e){this.cachedEventUids.add(Ex(e)),this.lastProcessedEventTime=Date.now()}}function Ex(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function aS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function k2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return aS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j2(t,e={}){return Ti(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,O2=/^https?/;async function L2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await j2(t);for(const n of e)try{if(V2(n))return}catch{}Nr(t,"unauthorized-domain")}function V2(t){const e=Ym(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!O2.test(n))return!1;if(D2.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M2=new Jc(3e4,6e4);function bx(){const t=Yr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function F2(t){return new Promise((e,n)=>{var s,i,o;function r(){bx(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{bx(),n(Qr(t,"network-request-failed"))},timeout:M2.get()})}if((i=(s=Yr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Yr().gapi)!=null&&o.load)r();else{const l=kD("iframefcb");return Yr()[l]=()=>{gapi.load?r():n(Qr(t,"network-request-failed"))},HT(`${PD()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw yd=null,e})}let yd=null;function U2(t){return yd=yd||F2(t),yd}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $2=new Jc(5e3,15e3),B2="__/auth/iframe",z2="emulator/auth/iframe",q2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},H2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function W2(t){const e=t.config;Te(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Oy(e,z2):`https://${t.config.authDomain}/${B2}`,r={apiKey:e.apiKey,appName:t.name,v:No},s=H2.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Xc(r).slice(1)}`}async function G2(t){const e=await U2(t),n=Yr().gapi;return Te(n,t,"internal-error"),e.open({where:document.body,url:W2(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:q2,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Qr(t,"network-request-failed"),l=Yr().setTimeout(()=>{i(o)},$2.get());function c(){Yr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Q2=500,Y2=600,X2="_blank",J2="http://localhost";class Ix{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Z2(t,e,n,r=Q2,s=Y2){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...K2,width:r.toString(),height:s.toString(),top:i,left:o},d=qt().toLowerCase();n&&(l=MT(d)?X2:n),LT(d)&&(e=e||J2,c.scrollbars="yes");const f=Object.entries(c).reduce((m,[v,R])=>`${m}${v}=${R},`,"");if(ED(d)&&l!=="_self")return eO(e||"",l),new Ix(null);const h=window.open(e||"",l,f);Te(h,t,"popup-blocked");try{h.focus()}catch{}return new Ix(h)}function eO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tO="__/auth/handler",nO="emulator/auth/handler",rO=encodeURIComponent("fac");async function Tx(t,e,n,r,s,i){Te(t.config.authDomain,t,"auth-domain-config-required"),Te(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:No,eventId:s};if(e instanceof KT){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Fk(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,h]of Object.entries({}))o[f]=h}if(e instanceof Zc){const f=e.getScopes().filter(h=>h!=="");f.length>0&&(o.scopes=f.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const c=await t._getAppCheckToken(),d=c?`#${rO}=${encodeURIComponent(c)}`:"";return`${sO(t)}?${Xc(l).slice(1)}${d}`}function sO({config:t}){return t.emulator?Oy(t,nO):`https://${t.authDomain}/${tO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cp="webStorageSupport";class iO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tS,this._completeRedirectFn=A2,this._overrideRedirectResult=S2}async _openPopup(e,n,r,s){var o;xs((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await Tx(e,n,r,Ym(),s);return Z2(e,i,$y())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Tx(e,n,r,Ym(),s);return l2(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(xs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await G2(e),r=new P2(e);return n.register("authEvent",s=>(Te(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Cp,{type:Cp},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Cp];i!==void 0&&n(!!i),Nr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=L2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return zT()||VT()||Vy()}}const oO=iO;var Sx="@firebase/auth",Cx="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Te(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function cO(t){Cr(new hr("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Te(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qT(t)},d=new ND(r,s,i,c);return MD(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Cr(new hr("auth-internal",e=>{const n=Ja(e.getProvider("auth").getImmediate());return(r=>new aO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Vn(Sx,Cx,lO(t)),Vn(Sx,Cx,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uO=5*60,dO=gT("authIdTokenMaxAge")||uO;let Nx=null;const hO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>dO)return;const s=n==null?void 0:n.token;Nx!==s&&(Nx=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function lS(t=Xh()){const e=Ii(t,"auth");if(e.isInitialized())return e.getImmediate();const n=VD(t,{popupRedirectResolver:oO,persistence:[y2,ZT,tS]}),r=gT("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=hO(i.toString());n2(n,o,()=>o(n.currentUser)),t2(n,l=>o(l))}}const s=fT("auth");return s&&FD(n,`http://${s}`),n}function fO(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}AD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Qr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",fO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});cO("Browser");var Ax=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ui,cS;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(b,x){function _(){}_.prototype=x.prototype,b.F=x.prototype,b.prototype=new _,b.prototype.constructor=b,b.D=function(P,D,j){for(var k=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)k[Y-2]=arguments[Y];return x.prototype[D].apply(P,k)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(b,x,_){_||(_=0);const P=Array(16);if(typeof x=="string")for(var D=0;D<16;++D)P[D]=x.charCodeAt(_++)|x.charCodeAt(_++)<<8|x.charCodeAt(_++)<<16|x.charCodeAt(_++)<<24;else for(D=0;D<16;++D)P[D]=x[_++]|x[_++]<<8|x[_++]<<16|x[_++]<<24;x=b.g[0],_=b.g[1],D=b.g[2];let j=b.g[3],k;k=x+(j^_&(D^j))+P[0]+3614090360&4294967295,x=_+(k<<7&4294967295|k>>>25),k=j+(D^x&(_^D))+P[1]+3905402710&4294967295,j=x+(k<<12&4294967295|k>>>20),k=D+(_^j&(x^_))+P[2]+606105819&4294967295,D=j+(k<<17&4294967295|k>>>15),k=_+(x^D&(j^x))+P[3]+3250441966&4294967295,_=D+(k<<22&4294967295|k>>>10),k=x+(j^_&(D^j))+P[4]+4118548399&4294967295,x=_+(k<<7&4294967295|k>>>25),k=j+(D^x&(_^D))+P[5]+1200080426&4294967295,j=x+(k<<12&4294967295|k>>>20),k=D+(_^j&(x^_))+P[6]+2821735955&4294967295,D=j+(k<<17&4294967295|k>>>15),k=_+(x^D&(j^x))+P[7]+4249261313&4294967295,_=D+(k<<22&4294967295|k>>>10),k=x+(j^_&(D^j))+P[8]+1770035416&4294967295,x=_+(k<<7&4294967295|k>>>25),k=j+(D^x&(_^D))+P[9]+2336552879&4294967295,j=x+(k<<12&4294967295|k>>>20),k=D+(_^j&(x^_))+P[10]+4294925233&4294967295,D=j+(k<<17&4294967295|k>>>15),k=_+(x^D&(j^x))+P[11]+2304563134&4294967295,_=D+(k<<22&4294967295|k>>>10),k=x+(j^_&(D^j))+P[12]+1804603682&4294967295,x=_+(k<<7&4294967295|k>>>25),k=j+(D^x&(_^D))+P[13]+4254626195&4294967295,j=x+(k<<12&4294967295|k>>>20),k=D+(_^j&(x^_))+P[14]+2792965006&4294967295,D=j+(k<<17&4294967295|k>>>15),k=_+(x^D&(j^x))+P[15]+1236535329&4294967295,_=D+(k<<22&4294967295|k>>>10),k=x+(D^j&(_^D))+P[1]+4129170786&4294967295,x=_+(k<<5&4294967295|k>>>27),k=j+(_^D&(x^_))+P[6]+3225465664&4294967295,j=x+(k<<9&4294967295|k>>>23),k=D+(x^_&(j^x))+P[11]+643717713&4294967295,D=j+(k<<14&4294967295|k>>>18),k=_+(j^x&(D^j))+P[0]+3921069994&4294967295,_=D+(k<<20&4294967295|k>>>12),k=x+(D^j&(_^D))+P[5]+3593408605&4294967295,x=_+(k<<5&4294967295|k>>>27),k=j+(_^D&(x^_))+P[10]+38016083&4294967295,j=x+(k<<9&4294967295|k>>>23),k=D+(x^_&(j^x))+P[15]+3634488961&4294967295,D=j+(k<<14&4294967295|k>>>18),k=_+(j^x&(D^j))+P[4]+3889429448&4294967295,_=D+(k<<20&4294967295|k>>>12),k=x+(D^j&(_^D))+P[9]+568446438&4294967295,x=_+(k<<5&4294967295|k>>>27),k=j+(_^D&(x^_))+P[14]+3275163606&4294967295,j=x+(k<<9&4294967295|k>>>23),k=D+(x^_&(j^x))+P[3]+4107603335&4294967295,D=j+(k<<14&4294967295|k>>>18),k=_+(j^x&(D^j))+P[8]+1163531501&4294967295,_=D+(k<<20&4294967295|k>>>12),k=x+(D^j&(_^D))+P[13]+2850285829&4294967295,x=_+(k<<5&4294967295|k>>>27),k=j+(_^D&(x^_))+P[2]+4243563512&4294967295,j=x+(k<<9&4294967295|k>>>23),k=D+(x^_&(j^x))+P[7]+1735328473&4294967295,D=j+(k<<14&4294967295|k>>>18),k=_+(j^x&(D^j))+P[12]+2368359562&4294967295,_=D+(k<<20&4294967295|k>>>12),k=x+(_^D^j)+P[5]+4294588738&4294967295,x=_+(k<<4&4294967295|k>>>28),k=j+(x^_^D)+P[8]+2272392833&4294967295,j=x+(k<<11&4294967295|k>>>21),k=D+(j^x^_)+P[11]+1839030562&4294967295,D=j+(k<<16&4294967295|k>>>16),k=_+(D^j^x)+P[14]+4259657740&4294967295,_=D+(k<<23&4294967295|k>>>9),k=x+(_^D^j)+P[1]+2763975236&4294967295,x=_+(k<<4&4294967295|k>>>28),k=j+(x^_^D)+P[4]+1272893353&4294967295,j=x+(k<<11&4294967295|k>>>21),k=D+(j^x^_)+P[7]+4139469664&4294967295,D=j+(k<<16&4294967295|k>>>16),k=_+(D^j^x)+P[10]+3200236656&4294967295,_=D+(k<<23&4294967295|k>>>9),k=x+(_^D^j)+P[13]+681279174&4294967295,x=_+(k<<4&4294967295|k>>>28),k=j+(x^_^D)+P[0]+3936430074&4294967295,j=x+(k<<11&4294967295|k>>>21),k=D+(j^x^_)+P[3]+3572445317&4294967295,D=j+(k<<16&4294967295|k>>>16),k=_+(D^j^x)+P[6]+76029189&4294967295,_=D+(k<<23&4294967295|k>>>9),k=x+(_^D^j)+P[9]+3654602809&4294967295,x=_+(k<<4&4294967295|k>>>28),k=j+(x^_^D)+P[12]+3873151461&4294967295,j=x+(k<<11&4294967295|k>>>21),k=D+(j^x^_)+P[15]+530742520&4294967295,D=j+(k<<16&4294967295|k>>>16),k=_+(D^j^x)+P[2]+3299628645&4294967295,_=D+(k<<23&4294967295|k>>>9),k=x+(D^(_|~j))+P[0]+4096336452&4294967295,x=_+(k<<6&4294967295|k>>>26),k=j+(_^(x|~D))+P[7]+1126891415&4294967295,j=x+(k<<10&4294967295|k>>>22),k=D+(x^(j|~_))+P[14]+2878612391&4294967295,D=j+(k<<15&4294967295|k>>>17),k=_+(j^(D|~x))+P[5]+4237533241&4294967295,_=D+(k<<21&4294967295|k>>>11),k=x+(D^(_|~j))+P[12]+1700485571&4294967295,x=_+(k<<6&4294967295|k>>>26),k=j+(_^(x|~D))+P[3]+2399980690&4294967295,j=x+(k<<10&4294967295|k>>>22),k=D+(x^(j|~_))+P[10]+4293915773&4294967295,D=j+(k<<15&4294967295|k>>>17),k=_+(j^(D|~x))+P[1]+2240044497&4294967295,_=D+(k<<21&4294967295|k>>>11),k=x+(D^(_|~j))+P[8]+1873313359&4294967295,x=_+(k<<6&4294967295|k>>>26),k=j+(_^(x|~D))+P[15]+4264355552&4294967295,j=x+(k<<10&4294967295|k>>>22),k=D+(x^(j|~_))+P[6]+2734768916&4294967295,D=j+(k<<15&4294967295|k>>>17),k=_+(j^(D|~x))+P[13]+1309151649&4294967295,_=D+(k<<21&4294967295|k>>>11),k=x+(D^(_|~j))+P[4]+4149444226&4294967295,x=_+(k<<6&4294967295|k>>>26),k=j+(_^(x|~D))+P[11]+3174756917&4294967295,j=x+(k<<10&4294967295|k>>>22),k=D+(x^(j|~_))+P[2]+718787259&4294967295,D=j+(k<<15&4294967295|k>>>17),k=_+(j^(D|~x))+P[9]+3951481745&4294967295,b.g[0]=b.g[0]+x&4294967295,b.g[1]=b.g[1]+(D+(k<<21&4294967295|k>>>11))&4294967295,b.g[2]=b.g[2]+D&4294967295,b.g[3]=b.g[3]+j&4294967295}r.prototype.v=function(b,x){x===void 0&&(x=b.length);const _=x-this.blockSize,P=this.C;let D=this.h,j=0;for(;j<x;){if(D==0)for(;j<=_;)s(this,b,j),j+=this.blockSize;if(typeof b=="string"){for(;j<x;)if(P[D++]=b.charCodeAt(j++),D==this.blockSize){s(this,P),D=0;break}}else for(;j<x;)if(P[D++]=b[j++],D==this.blockSize){s(this,P),D=0;break}}this.h=D,this.o+=x},r.prototype.A=function(){var b=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);b[0]=128;for(var x=1;x<b.length-8;++x)b[x]=0;x=this.o*8;for(var _=b.length-8;_<b.length;++_)b[_]=x&255,x/=256;for(this.v(b),b=Array(16),x=0,_=0;_<4;++_)for(let P=0;P<32;P+=8)b[x++]=this.g[_]>>>P&255;return b};function i(b,x){var _=l;return Object.prototype.hasOwnProperty.call(_,b)?_[b]:_[b]=x(b)}function o(b,x){this.h=x;const _=[];let P=!0;for(let D=b.length-1;D>=0;D--){const j=b[D]|0;P&&j==x||(_[D]=j,P=!1)}this.g=_}var l={};function c(b){return-128<=b&&b<128?i(b,function(x){return new o([x|0],x<0?-1:0)}):new o([b|0],b<0?-1:0)}function d(b){if(isNaN(b)||!isFinite(b))return h;if(b<0)return C(d(-b));const x=[];let _=1;for(let P=0;b>=_;P++)x[P]=b/_|0,_*=4294967296;return new o(x,0)}function f(b,x){if(b.length==0)throw Error("number format error: empty string");if(x=x||10,x<2||36<x)throw Error("radix out of range: "+x);if(b.charAt(0)=="-")return C(f(b.substring(1),x));if(b.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=d(Math.pow(x,8));let P=h;for(let j=0;j<b.length;j+=8){var D=Math.min(8,b.length-j);const k=parseInt(b.substring(j,j+D),x);D<8?(D=d(Math.pow(x,D)),P=P.j(D).add(d(k))):(P=P.j(_),P=P.add(d(k)))}return P}var h=c(0),m=c(1),v=c(16777216);t=o.prototype,t.m=function(){if(N(this))return-C(this).m();let b=0,x=1;for(let _=0;_<this.g.length;_++){const P=this.i(_);b+=(P>=0?P:4294967296+P)*x,x*=4294967296}return b},t.toString=function(b){if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(R(this))return"0";if(N(this))return"-"+C(this).toString(b);const x=d(Math.pow(b,6));var _=this;let P="";for(;;){const D=I(_,x).g;_=y(_,D.j(x));let j=((_.g.length>0?_.g[0]:_.h)>>>0).toString(b);if(_=D,R(_))return j+P;for(;j.length<6;)j="0"+j;P=j+P}},t.i=function(b){return b<0?0:b<this.g.length?this.g[b]:this.h};function R(b){if(b.h!=0)return!1;for(let x=0;x<b.g.length;x++)if(b.g[x]!=0)return!1;return!0}function N(b){return b.h==-1}t.l=function(b){return b=y(this,b),N(b)?-1:R(b)?0:1};function C(b){const x=b.g.length,_=[];for(let P=0;P<x;P++)_[P]=~b.g[P];return new o(_,~b.h).add(m)}t.abs=function(){return N(this)?C(this):this},t.add=function(b){const x=Math.max(this.g.length,b.g.length),_=[];let P=0;for(let D=0;D<=x;D++){let j=P+(this.i(D)&65535)+(b.i(D)&65535),k=(j>>>16)+(this.i(D)>>>16)+(b.i(D)>>>16);P=k>>>16,j&=65535,k&=65535,_[D]=k<<16|j}return new o(_,_[_.length-1]&-2147483648?-1:0)};function y(b,x){return b.add(C(x))}t.j=function(b){if(R(this)||R(b))return h;if(N(this))return N(b)?C(this).j(C(b)):C(C(this).j(b));if(N(b))return C(this.j(C(b)));if(this.l(v)<0&&b.l(v)<0)return d(this.m()*b.m());const x=this.g.length+b.g.length,_=[];for(var P=0;P<2*x;P++)_[P]=0;for(P=0;P<this.g.length;P++)for(let D=0;D<b.g.length;D++){const j=this.i(P)>>>16,k=this.i(P)&65535,Y=b.i(D)>>>16,He=b.i(D)&65535;_[2*P+2*D]+=k*He,w(_,2*P+2*D),_[2*P+2*D+1]+=j*He,w(_,2*P+2*D+1),_[2*P+2*D+1]+=k*Y,w(_,2*P+2*D+1),_[2*P+2*D+2]+=j*Y,w(_,2*P+2*D+2)}for(b=0;b<x;b++)_[b]=_[2*b+1]<<16|_[2*b];for(b=x;b<2*x;b++)_[b]=0;return new o(_,0)};function w(b,x){for(;(b[x]&65535)!=b[x];)b[x+1]+=b[x]>>>16,b[x]&=65535,x++}function E(b,x){this.g=b,this.h=x}function I(b,x){if(R(x))throw Error("division by zero");if(R(b))return new E(h,h);if(N(b))return x=I(C(b),x),new E(C(x.g),C(x.h));if(N(x))return x=I(b,C(x)),new E(C(x.g),x.h);if(b.g.length>30){if(N(b)||N(x))throw Error("slowDivide_ only works with positive integers.");for(var _=m,P=x;P.l(b)<=0;)_=M(_),P=M(P);var D=$(_,1),j=$(P,1);for(P=$(P,2),_=$(_,2);!R(P);){var k=j.add(P);k.l(b)<=0&&(D=D.add(_),j=k),P=$(P,1),_=$(_,1)}return x=y(b,D.j(x)),new E(D,x)}for(D=h;b.l(x)>=0;){for(_=Math.max(1,Math.floor(b.m()/x.m())),P=Math.ceil(Math.log(_)/Math.LN2),P=P<=48?1:Math.pow(2,P-48),j=d(_),k=j.j(x);N(k)||k.l(b)>0;)_-=P,j=d(_),k=j.j(x);R(j)&&(j=m),D=D.add(j),b=y(b,k)}return new E(D,b)}t.B=function(b){return I(this,b).h},t.and=function(b){const x=Math.max(this.g.length,b.g.length),_=[];for(let P=0;P<x;P++)_[P]=this.i(P)&b.i(P);return new o(_,this.h&b.h)},t.or=function(b){const x=Math.max(this.g.length,b.g.length),_=[];for(let P=0;P<x;P++)_[P]=this.i(P)|b.i(P);return new o(_,this.h|b.h)},t.xor=function(b){const x=Math.max(this.g.length,b.g.length),_=[];for(let P=0;P<x;P++)_[P]=this.i(P)^b.i(P);return new o(_,this.h^b.h)};function M(b){const x=b.g.length+1,_=[];for(let P=0;P<x;P++)_[P]=b.i(P)<<1|b.i(P-1)>>>31;return new o(_,b.h)}function $(b,x){const _=x>>5;x%=32;const P=b.g.length-_,D=[];for(let j=0;j<P;j++)D[j]=x>0?b.i(j+_)>>>x|b.i(j+_+1)<<32-x:b.i(j+_);return new o(D,b.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,cS=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=f,ui=o}).apply(typeof Ax<"u"?Ax:typeof self<"u"?self:typeof window<"u"?window:{});var zu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var uS,Ml,dS,vd,Zm,hS,fS,pS;(function(){var t,e=Object.defineProperty;function n(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof zu=="object"&&zu];for(var p=0;p<u.length;++p){var g=u[p];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=n(this);function s(u,p){if(p)e:{var g=r;u=u.split(".");for(var A=0;A<u.length-1;A++){var F=u[A];if(!(F in g))break e;g=g[F]}u=u[u.length-1],A=g[u],p=p(A),p!=A&&p!=null&&e(g,u,{configurable:!0,writable:!0,value:p})}}s("Symbol.dispose",function(u){return u||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(u){return u||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(u){return u||function(p){var g=[],A;for(A in p)Object.prototype.hasOwnProperty.call(p,A)&&g.push([A,p[A]]);return g}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function l(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function c(u,p,g){return u.call.apply(u.bind,arguments)}function d(u,p,g){return d=c,d.apply(null,arguments)}function f(u,p){var g=Array.prototype.slice.call(arguments,1);return function(){var A=g.slice();return A.push.apply(A,arguments),u.apply(this,A)}}function h(u,p){function g(){}g.prototype=p.prototype,u.Z=p.prototype,u.prototype=new g,u.prototype.constructor=u,u.Ob=function(A,F,B){for(var se=Array(arguments.length-2),Le=2;Le<arguments.length;Le++)se[Le-2]=arguments[Le];return p.prototype[F].apply(A,se)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?u=>u&&AsyncContext.Snapshot.wrap(u):u=>u;function v(u){const p=u.length;if(p>0){const g=Array(p);for(let A=0;A<p;A++)g[A]=u[A];return g}return[]}function R(u,p){for(let A=1;A<arguments.length;A++){const F=arguments[A];var g=typeof F;if(g=g!="object"?g:F?Array.isArray(F)?"array":g:"null",g=="array"||g=="object"&&typeof F.length=="number"){g=u.length||0;const B=F.length||0;u.length=g+B;for(let se=0;se<B;se++)u[g+se]=F[se]}else u.push(F)}}class N{constructor(p,g){this.i=p,this.j=g,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function C(u){o.setTimeout(()=>{throw u},0)}function y(){var u=b;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class w{constructor(){this.h=this.g=null}add(p,g){const A=E.get();A.set(p,g),this.h?this.h.next=A:this.g=A,this.h=A}}var E=new N(()=>new I,u=>u.reset());class I{constructor(){this.next=this.g=this.h=null}set(p,g){this.h=p,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let M,$=!1,b=new w,x=()=>{const u=Promise.resolve(void 0);M=()=>{u.then(_)}};function _(){for(var u;u=y();){try{u.h.call(u.g)}catch(g){C(g)}var p=E;p.j(u),p.h<100&&(p.h++,u.next=p.g,p.g=u)}$=!1}function P(){this.u=this.u,this.C=this.C}P.prototype.u=!1,P.prototype.dispose=function(){this.u||(this.u=!0,this.N())},P.prototype[Symbol.dispose]=function(){this.dispose()},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function D(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}D.prototype.h=function(){this.defaultPrevented=!0};var j=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const g=()=>{};o.addEventListener("test",g,p),o.removeEventListener("test",g,p)}catch{}return u}();function k(u){return/^[\s\xa0]*$/.test(u)}function Y(u,p){D.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u&&this.init(u,p)}h(Y,D),Y.prototype.init=function(u,p){const g=this.type=u.type,A=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget,p||(g=="mouseover"?p=u.fromElement:g=="mouseout"&&(p=u.toElement)),this.relatedTarget=p,A?(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=u.pointerType,this.state=u.state,this.i=u,u.defaultPrevented&&Y.Z.h.call(this)},Y.prototype.h=function(){Y.Z.h.call(this);const u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var He="closure_listenable_"+(Math.random()*1e6|0),_t=0;function kt(u,p,g,A,F){this.listener=u,this.proxy=null,this.src=p,this.type=g,this.capture=!!A,this.ha=F,this.key=++_t,this.da=this.fa=!1}function re(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function fe(u,p,g){for(const A in u)p.call(g,u[A],A,u)}function ve(u,p){for(const g in u)p.call(void 0,u[g],g,u)}function ke(u){const p={};for(const g in u)p[g]=u[g];return p}const We="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function It(u,p){let g,A;for(let F=1;F<arguments.length;F++){A=arguments[F];for(g in A)u[g]=A[g];for(let B=0;B<We.length;B++)g=We[B],Object.prototype.hasOwnProperty.call(A,g)&&(u[g]=A[g])}}function U(u){this.src=u,this.g={},this.h=0}U.prototype.add=function(u,p,g,A,F){const B=u.toString();u=this.g[B],u||(u=this.g[B]=[],this.h++);const se=pe(u,p,A,F);return se>-1?(p=u[se],g||(p.fa=!1)):(p=new kt(p,this.src,B,!!A,F),p.fa=g,u.push(p)),p};function ie(u,p){const g=p.type;if(g in u.g){var A=u.g[g],F=Array.prototype.indexOf.call(A,p,void 0),B;(B=F>=0)&&Array.prototype.splice.call(A,F,1),B&&(re(p),u.g[g].length==0&&(delete u.g[g],u.h--))}}function pe(u,p,g,A){for(let F=0;F<u.length;++F){const B=u[F];if(!B.da&&B.listener==p&&B.capture==!!g&&B.ha==A)return F}return-1}var Ne="closure_lm_"+(Math.random()*1e6|0),Ae={};function De(u,p,g,A,F){if(Array.isArray(p)){for(let B=0;B<p.length;B++)De(u,p[B],g,A,F);return null}return g=le(g),u&&u[He]?u.J(p,g,l(A)?!!A.capture:!1,F):be(u,p,g,!1,A,F)}function be(u,p,g,A,F,B){if(!p)throw Error("Invalid event type");const se=l(F)?!!F.capture:!!F;let Le=nt(u);if(Le||(u[Ne]=Le=new U(u)),g=Le.add(p,g,A,se,B),g.proxy)return g;if(A=at(),g.proxy=A,A.src=u,A.listener=g,u.addEventListener)j||(F=se),F===void 0&&(F=!1),u.addEventListener(p.toString(),A,F);else if(u.attachEvent)u.attachEvent(Oe(p.toString()),A);else if(u.addListener&&u.removeListener)u.addListener(A);else throw Error("addEventListener and attachEvent are unavailable.");return g}function at(){function u(g){return p.call(u.src,u.listener,g)}const p=Fe;return u}function je(u,p,g,A,F){if(Array.isArray(p))for(var B=0;B<p.length;B++)je(u,p[B],g,A,F);else A=l(A)?!!A.capture:!!A,g=le(g),u&&u[He]?(u=u.i,B=String(p).toString(),B in u.g&&(p=u.g[B],g=pe(p,g,A,F),g>-1&&(re(p[g]),Array.prototype.splice.call(p,g,1),p.length==0&&(delete u.g[B],u.h--)))):u&&(u=nt(u))&&(p=u.g[p.toString()],u=-1,p&&(u=pe(p,g,A,F)),(g=u>-1?p[u]:null)&&me(g))}function me(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[He])ie(p.i,u);else{var g=u.type,A=u.proxy;p.removeEventListener?p.removeEventListener(g,A,u.capture):p.detachEvent?p.detachEvent(Oe(g),A):p.addListener&&p.removeListener&&p.removeListener(A),(g=nt(p))?(ie(g,u),g.h==0&&(g.src=null,p[Ne]=null)):re(u)}}}function Oe(u){return u in Ae?Ae[u]:Ae[u]="on"+u}function Fe(u,p){if(u.da)u=!0;else{p=new Y(p,this);const g=u.listener,A=u.ha||u.src;u.fa&&me(u),u=g.call(A,p)}return u}function nt(u){return u=u[Ne],u instanceof U?u:null}var G="__closure_events_fn_"+(Math.random()*1e9>>>0);function le(u){return typeof u=="function"?u:(u[G]||(u[G]=function(p){return u.handleEvent(p)}),u[G])}function z(){P.call(this),this.i=new U(this),this.M=this,this.G=null}h(z,P),z.prototype[He]=!0,z.prototype.removeEventListener=function(u,p,g,A){je(this,u,p,g,A)};function ae(u,p){var g,A=u.G;if(A)for(g=[];A;A=A.G)g.push(A);if(u=u.M,A=p.type||p,typeof p=="string")p=new D(p,u);else if(p instanceof D)p.target=p.target||u;else{var F=p;p=new D(A,u),It(p,F)}F=!0;let B,se;if(g)for(se=g.length-1;se>=0;se--)B=p.g=g[se],F=ue(B,A,!0,p)&&F;if(B=p.g=u,F=ue(B,A,!0,p)&&F,F=ue(B,A,!1,p)&&F,g)for(se=0;se<g.length;se++)B=p.g=g[se],F=ue(B,A,!1,p)&&F}z.prototype.N=function(){if(z.Z.N.call(this),this.i){var u=this.i;for(const p in u.g){const g=u.g[p];for(let A=0;A<g.length;A++)re(g[A]);delete u.g[p],u.h--}}this.G=null},z.prototype.J=function(u,p,g,A){return this.i.add(String(u),p,!1,g,A)},z.prototype.K=function(u,p,g,A){return this.i.add(String(u),p,!0,g,A)};function ue(u,p,g,A){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();let F=!0;for(let B=0;B<p.length;++B){const se=p[B];if(se&&!se.da&&se.capture==g){const Le=se.listener,$t=se.ha||se.src;se.fa&&ie(u.i,se),F=Le.call($t,A)!==!1&&F}}return F&&!A.defaultPrevented}function we(u,p){if(typeof u!="function")if(u&&typeof u.handleEvent=="function")u=d(u.handleEvent,u);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:o.setTimeout(u,p||0)}function xe(u){u.g=we(()=>{u.g=null,u.i&&(u.i=!1,xe(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class Me extends P{constructor(p,g){super(),this.m=p,this.l=g,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:xe(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function L(u){P.call(this),this.h=u,this.g={}}h(L,P);var W=[];function X(u){fe(u.g,function(p,g){this.g.hasOwnProperty(g)&&me(p)},u),u.g={}}L.prototype.N=function(){L.Z.N.call(this),X(this)},L.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ne=o.JSON.stringify,O=o.JSON.parse,K=class{stringify(u){return o.JSON.stringify(u,void 0)}parse(u){return o.JSON.parse(u,void 0)}};function Q(){}function Se(){}var Pe={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Xe(){D.call(this,"d")}h(Xe,D);function jt(){D.call(this,"c")}h(jt,D);var Ge={},Zt=null;function dt(){return Zt=Zt||new z}Ge.Ia="serverreachability";function Dt(u){D.call(this,Ge.Ia,u)}h(Dt,D);function Wt(u){const p=dt();ae(p,new Dt(p))}Ge.STAT_EVENT="statevent";function Gt(u,p){D.call(this,Ge.STAT_EVENT,u),this.stat=p}h(Gt,D);function Ze(u){const p=dt();ae(p,new Gt(p,u))}Ge.Ja="timingevent";function Ot(u,p){D.call(this,Ge.Ja,u),this.size=p}h(Ot,D);function Dr(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){u()},p)}function pr(){this.g=!0}pr.prototype.ua=function(){this.g=!1};function Cs(u,p,g,A,F,B){u.info(function(){if(u.g)if(B){var se="",Le=B.split("&");for(let lt=0;lt<Le.length;lt++){var $t=Le[lt].split("=");if($t.length>1){const Kt=$t[0];$t=$t[1];const Vr=Kt.split("_");se=Vr.length>=2&&Vr[1]=="type"?se+(Kt+"="+$t+"&"):se+(Kt+"=redacted&")}}}else se=null;else se=B;return"XMLHTTP REQ ("+A+") [attempt "+F+"]: "+p+`
`+g+`
`+se})}function Mn(u,p,g,A,F,B,se){u.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+F+"]: "+p+`
`+g+`
`+B+" "+se})}function es(u,p,g,A){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+mu(u,g)+(A?" "+A:"")})}function pu(u,p){u.info(function(){return"TIMEOUT: "+p})}pr.prototype.info=function(){};function mu(u,p){if(!u.g)return p;if(!p)return null;try{const B=JSON.parse(p);if(B){for(u=0;u<B.length;u++)if(Array.isArray(B[u])){var g=B[u];if(!(g.length<2)){var A=g[1];if(Array.isArray(A)&&!(A.length<1)){var F=A[0];if(F!="noop"&&F!="stop"&&F!="close")for(let se=1;se<A.length;se++)A[se]=""}}}}return ne(B)}catch{return p}}var Ai={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},il={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},T;function H(){}h(H,Q),H.prototype.g=function(){return new XMLHttpRequest},T=new H;function te(u){return encodeURIComponent(String(u))}function ge(u){var p=1;u=u.split(":");const g=[];for(;p>0&&u.length;)g.push(u.shift()),p--;return u.length&&g.push(u.join(":")),g}function Ee(u,p,g,A){this.j=u,this.i=p,this.l=g,this.S=A||1,this.V=new L(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Je}function Je(){this.i=null,this.g="",this.h=!1}var Or={},Jn={};function Zn(u,p,g){u.M=1,u.A=gu(Lr(p)),u.u=g,u.R=!0,Lt(u,null)}function Lt(u,p){u.F=Date.now(),ts(u),u.B=Lr(u.A);var g=u.B,A=u.S;Array.isArray(A)||(A=[String(A)]),p_(g.i,"t",A),u.C=0,g=u.j.L,u.h=new Je,u.g=k_(u.j,g?p:null,!u.u),u.P>0&&(u.O=new Me(d(u.Y,u,u.g),u.P)),p=u.V,g=u.g,A=u.ba;var F="readystatechange";Array.isArray(F)||(F&&(W[0]=F.toString()),F=W);for(let B=0;B<F.length;B++){const se=De(g,F[B],A||p.handleEvent,!1,p.h||p);if(!se)break;p.g[se.key]=se}p=u.J?ke(u.J):{},u.u?(u.v||(u.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.B,u.v,u.u,p)):(u.v="GET",u.g.ea(u.B,u.v,null,p)),Wt(),Cs(u.i,u.v,u.B,u.l,u.S,u.u)}Ee.prototype.ba=function(u){u=u.target;const p=this.O;p&&Rs(u)==3?p.j():this.Y(u)},Ee.prototype.Y=function(u){try{if(u==this.g)e:{const Le=Rs(this.g),$t=this.g.ya(),lt=this.g.ca();if(!(Le<3)&&(Le!=3||this.g&&(this.h.h||this.g.la()||x_(this.g)))){this.K||Le!=4||$t==7||($t==8||lt<=0?Wt(3):Wt(2)),ko(this);var p=this.g.ca();this.X=p;var g=Nn(this);if(this.o=p==200,Mn(this.i,this.v,this.B,this.l,this.S,Le,p),this.o){if(this.U&&!this.L){t:{if(this.g){var A,F=this.g;if((A=F.g?F.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(A)){var B=A;break t}}B=null}if(u=B)es(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Vf(this,u);else{this.o=!1,this.m=3,Ze(12),Ri(this),rs(this);break e}}if(this.R){u=!0;let Kt;for(;!this.K&&this.C<g.length;)if(Kt=mr(this,g),Kt==Jn){Le==4&&(this.m=4,Ze(14),u=!1),es(this.i,this.l,null,"[Incomplete Response]");break}else if(Kt==Or){this.m=4,Ze(15),es(this.i,this.l,g,"[Invalid Chunk]"),u=!1;break}else es(this.i,this.l,Kt,null),Vf(this,Kt);if(An(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Le!=4||g.length!=0||this.h.h||(this.m=1,Ze(16),u=!1),this.o=this.o&&u,!u)es(this.i,this.l,g,"[Invalid Chunked Response]"),Ri(this),rs(this);else if(g.length>0&&!this.W){this.W=!0;var se=this.j;se.g==this&&se.aa&&!se.P&&(se.j.info("Great, no buffering proxy detected. Bytes received: "+g.length),Hf(se),se.P=!0,Ze(11))}}else es(this.i,this.l,g,null),Vf(this,g);Le==4&&Ri(this),this.o&&!this.K&&(Le==4?N_(this.j,this):(this.o=!1,ts(this)))}else b1(this.g),p==400&&g.indexOf("Unknown SID")>0?(this.m=3,Ze(12)):(this.m=0,Ze(13)),Ri(this),rs(this)}}}catch{}finally{}};function Nn(u){if(!An(u))return u.g.la();const p=x_(u.g);if(p==="")return"";let g="";const A=p.length,F=Rs(u.g)==4;if(!u.h.i){if(typeof TextDecoder>"u")return Ri(u),rs(u),"";u.h.i=new o.TextDecoder}for(let B=0;B<A;B++)u.h.h=!0,g+=u.h.i.decode(p[B],{stream:!(F&&B==A-1)});return p.length=0,u.h.g+=g,u.C=0,u.h.g}function An(u){return u.g?u.v=="GET"&&u.M!=2&&u.j.Aa:!1}function mr(u,p){var g=u.C,A=p.indexOf(`
`,g);return A==-1?Jn:(g=Number(p.substring(g,A)),isNaN(g)?Or:(A+=1,A+g>p.length?Jn:(p=p.slice(A,A+g),u.C=A+g,p)))}Ee.prototype.cancel=function(){this.K=!0,Ri(this)};function ts(u){u.T=Date.now()+u.H,ns(u,u.H)}function ns(u,p){if(u.D!=null)throw Error("WatchDog timer not null");u.D=Dr(d(u.aa,u),p)}function ko(u){u.D&&(o.clearTimeout(u.D),u.D=null)}Ee.prototype.aa=function(){this.D=null;const u=Date.now();u-this.T>=0?(pu(this.i,this.B),this.M!=2&&(Wt(),Ze(17)),Ri(this),this.m=2,rs(this)):ns(this,this.T-u)};function rs(u){u.j.I==0||u.K||N_(u.j,u)}function Ri(u){ko(u);var p=u.O;p&&typeof p.dispose=="function"&&p.dispose(),u.O=null,X(u.V),u.g&&(p=u.g,u.g=null,p.abort(),p.dispose())}function Vf(u,p){try{var g=u.j;if(g.I!=0&&(g.g==u||Mf(g.h,u))){if(!u.L&&Mf(g.h,u)&&g.I==3){try{var A=g.Ba.g.parse(p)}catch{A=null}if(Array.isArray(A)&&A.length==3){var F=A;if(F[0]==0){e:if(!g.v){if(g.g)if(g.g.F+3e3<u.F)xu(g),_u(g);else break e;qf(g),Ze(18)}}else g.xa=F[1],0<g.xa-g.K&&F[2]<37500&&g.F&&g.A==0&&!g.C&&(g.C=Dr(d(g.Va,g),6e3));o_(g.h)<=1&&g.ta&&(g.ta=void 0)}else ki(g,11)}else if((u.L||g.g==u)&&xu(g),!k(p))for(F=g.Ba.g.parse(p),p=0;p<F.length;p++){let lt=F[p];const Kt=lt[0];if(!(Kt<=g.K))if(g.K=Kt,lt=lt[1],g.I==2)if(lt[0]=="c"){g.M=lt[1],g.ba=lt[2];const Vr=lt[3];Vr!=null&&(g.ka=Vr,g.j.info("VER="+g.ka));const ji=lt[4];ji!=null&&(g.za=ji,g.j.info("SVER="+g.za));const Ps=lt[5];Ps!=null&&typeof Ps=="number"&&Ps>0&&(A=1.5*Ps,g.O=A,g.j.info("backChannelRequestTimeoutMs_="+A)),A=g;const ks=u.g;if(ks){const bu=ks.g?ks.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(bu){var B=A.h;B.g||bu.indexOf("spdy")==-1&&bu.indexOf("quic")==-1&&bu.indexOf("h2")==-1||(B.j=B.l,B.g=new Set,B.h&&(Ff(B,B.h),B.h=null))}if(A.G){const Wf=ks.g?ks.g.getResponseHeader("X-HTTP-Session-Id"):null;Wf&&(A.wa=Wf,ht(A.J,A.G,Wf))}}g.I=3,g.l&&g.l.ra(),g.aa&&(g.T=Date.now()-u.F,g.j.info("Handshake RTT: "+g.T+"ms")),A=g;var se=u;if(A.na=P_(A,A.L?A.ba:null,A.W),se.L){a_(A.h,se);var Le=se,$t=A.O;$t&&(Le.H=$t),Le.D&&(ko(Le),ts(Le)),A.g=se}else S_(A);g.i.length>0&&wu(g)}else lt[0]!="stop"&&lt[0]!="close"||ki(g,7);else g.I==3&&(lt[0]=="stop"||lt[0]=="close"?lt[0]=="stop"?ki(g,7):zf(g):lt[0]!="noop"&&g.l&&g.l.qa(lt),g.A=0)}}Wt(4)}catch{}}var u1=class{constructor(u,p){this.g=u,this.map=p}};function s_(u){this.l=u||10,o.PerformanceNavigationTiming?(u=o.performance.getEntriesByType("navigation"),u=u.length>0&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function i_(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function o_(u){return u.h?1:u.g?u.g.size:0}function Mf(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Ff(u,p){u.g?u.g.add(p):u.h=p}function a_(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}s_.prototype.cancel=function(){if(this.i=l_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function l_(u){if(u.h!=null)return u.i.concat(u.h.G);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const g of u.g.values())p=p.concat(g.G);return p}return v(u.i)}var c_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function d1(u,p){if(u){u=u.split("&");for(let g=0;g<u.length;g++){const A=u[g].indexOf("=");let F,B=null;A>=0?(F=u[g].substring(0,A),B=u[g].substring(A+1)):F=u[g],p(F,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}function Ns(u){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;u instanceof Ns?(this.l=u.l,ol(this,u.j),this.o=u.o,this.g=u.g,al(this,u.u),this.h=u.h,Uf(this,m_(u.i)),this.m=u.m):u&&(p=String(u).match(c_))?(this.l=!1,ol(this,p[1]||"",!0),this.o=ll(p[2]||""),this.g=ll(p[3]||"",!0),al(this,p[4]),this.h=ll(p[5]||"",!0),Uf(this,p[6]||"",!0),this.m=ll(p[7]||"")):(this.l=!1,this.i=new ul(null,this.l))}Ns.prototype.toString=function(){const u=[];var p=this.j;p&&u.push(cl(p,u_,!0),":");var g=this.g;return(g||p=="file")&&(u.push("//"),(p=this.o)&&u.push(cl(p,u_,!0),"@"),u.push(te(g).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.u,g!=null&&u.push(":",String(g))),(g=this.h)&&(this.g&&g.charAt(0)!="/"&&u.push("/"),u.push(cl(g,g.charAt(0)=="/"?p1:f1,!0))),(g=this.i.toString())&&u.push("?",g),(g=this.m)&&u.push("#",cl(g,g1)),u.join("")},Ns.prototype.resolve=function(u){const p=Lr(this);let g=!!u.j;g?ol(p,u.j):g=!!u.o,g?p.o=u.o:g=!!u.g,g?p.g=u.g:g=u.u!=null;var A=u.h;if(g)al(p,u.u);else if(g=!!u.h){if(A.charAt(0)!="/")if(this.g&&!this.h)A="/"+A;else{var F=p.h.lastIndexOf("/");F!=-1&&(A=p.h.slice(0,F+1)+A)}if(F=A,F==".."||F==".")A="";else if(F.indexOf("./")!=-1||F.indexOf("/.")!=-1){A=F.lastIndexOf("/",0)==0,F=F.split("/");const B=[];for(let se=0;se<F.length;){const Le=F[se++];Le=="."?A&&se==F.length&&B.push(""):Le==".."?((B.length>1||B.length==1&&B[0]!="")&&B.pop(),A&&se==F.length&&B.push("")):(B.push(Le),A=!0)}A=B.join("/")}else A=F}return g?p.h=A:g=u.i.toString()!=="",g?Uf(p,m_(u.i)):g=!!u.m,g&&(p.m=u.m),p};function Lr(u){return new Ns(u)}function ol(u,p,g){u.j=g?ll(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function al(u,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);u.u=p}else u.u=null}function Uf(u,p,g){p instanceof ul?(u.i=p,y1(u.i,u.l)):(g||(p=cl(p,m1)),u.i=new ul(p,u.l))}function ht(u,p,g){u.i.set(p,g)}function gu(u){return ht(u,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),u}function ll(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function cl(u,p,g){return typeof u=="string"?(u=encodeURI(u).replace(p,h1),g&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function h1(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var u_=/[#\/\?@]/g,f1=/[#\?:]/g,p1=/[#\?]/g,m1=/[#\?@]/g,g1=/#/g;function ul(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Pi(u){u.g||(u.g=new Map,u.h=0,u.i&&d1(u.i,function(p,g){u.add(decodeURIComponent(p.replace(/\+/g," ")),g)}))}t=ul.prototype,t.add=function(u,p){Pi(this),this.i=null,u=jo(this,u);let g=this.g.get(u);return g||this.g.set(u,g=[]),g.push(p),this.h+=1,this};function d_(u,p){Pi(u),p=jo(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function h_(u,p){return Pi(u),p=jo(u,p),u.g.has(p)}t.forEach=function(u,p){Pi(this),this.g.forEach(function(g,A){g.forEach(function(F){u.call(p,F,A,this)},this)},this)};function f_(u,p){Pi(u);let g=[];if(typeof p=="string")h_(u,p)&&(g=g.concat(u.g.get(jo(u,p))));else for(u=Array.from(u.g.values()),p=0;p<u.length;p++)g=g.concat(u[p]);return g}t.set=function(u,p){return Pi(this),this.i=null,u=jo(this,u),h_(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},t.get=function(u,p){return u?(u=f_(this,u),u.length>0?String(u[0]):p):p};function p_(u,p,g){d_(u,p),g.length>0&&(u.i=null,u.g.set(jo(u,p),v(g)),u.h+=g.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(let A=0;A<p.length;A++){var g=p[A];const F=te(g);g=f_(this,g);for(let B=0;B<g.length;B++){let se=F;g[B]!==""&&(se+="="+te(g[B])),u.push(se)}}return this.i=u.join("&")};function m_(u){const p=new ul;return p.i=u.i,u.g&&(p.g=new Map(u.g),p.h=u.h),p}function jo(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function y1(u,p){p&&!u.j&&(Pi(u),u.i=null,u.g.forEach(function(g,A){const F=A.toLowerCase();A!=F&&(d_(this,A),p_(this,F,g))},u)),u.j=p}function v1(u,p){const g=new pr;if(o.Image){const A=new Image;A.onload=f(As,g,"TestLoadImage: loaded",!0,p,A),A.onerror=f(As,g,"TestLoadImage: error",!1,p,A),A.onabort=f(As,g,"TestLoadImage: abort",!1,p,A),A.ontimeout=f(As,g,"TestLoadImage: timeout",!1,p,A),o.setTimeout(function(){A.ontimeout&&A.ontimeout()},1e4),A.src=u}else p(!1)}function _1(u,p){const g=new pr,A=new AbortController,F=setTimeout(()=>{A.abort(),As(g,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:A.signal}).then(B=>{clearTimeout(F),B.ok?As(g,"TestPingServer: ok",!0,p):As(g,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(F),As(g,"TestPingServer: error",!1,p)})}function As(u,p,g,A,F){try{F&&(F.onload=null,F.onerror=null,F.onabort=null,F.ontimeout=null),A(g)}catch{}}function w1(){this.g=new K}function $f(u){this.i=u.Sb||null,this.h=u.ab||!1}h($f,Q),$f.prototype.g=function(){return new yu(this.i,this.h)};function yu(u,p){z.call(this),this.H=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(yu,z),t=yu.prototype,t.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=u,this.D=p,this.readyState=1,hl(this)},t.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};u&&(p.body=u),(this.H||o).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,dl(this)),this.readyState=0},t.Pa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,hl(this)),this.g&&(this.readyState=3,hl(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;g_(this)}else u.text().then(this.Oa.bind(this),this.ga.bind(this))};function g_(u){u.j.read().then(u.Ma.bind(u)).catch(u.ga.bind(u))}t.Ma=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?dl(this):hl(this),this.readyState==3&&g_(this)}},t.Oa=function(u){this.g&&(this.response=this.responseText=u,dl(this))},t.Na=function(u){this.g&&(this.response=u,dl(this))},t.ga=function(){this.g&&dl(this)};function dl(u){u.readyState=4,u.l=null,u.j=null,u.B=null,hl(u)}t.setRequestHeader=function(u,p){this.A.append(u,p)},t.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var g=p.next();!g.done;)g=g.value,u.push(g[0]+": "+g[1]),g=p.next();return u.join(`\r
`)};function hl(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(yu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function y_(u){let p="";return fe(u,function(g,A){p+=A,p+=":",p+=g,p+=`\r
`}),p}function Bf(u,p,g){e:{for(A in g){var A=!1;break e}A=!0}A||(g=y_(g),typeof u=="string"?g!=null&&te(g):ht(u,p,g))}function Tt(u){z.call(this),this.headers=new Map,this.L=u||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(Tt,z);var x1=/^https?$/i,E1=["POST","PUT"];t=Tt.prototype,t.Fa=function(u){this.H=u},t.ea=function(u,p,g,A){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():T.g(),this.g.onreadystatechange=m(d(this.Ca,this));try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(B){v_(this,B);return}if(u=g||"",g=new Map(this.headers),A)if(Object.getPrototypeOf(A)===Object.prototype)for(var F in A)g.set(F,A[F]);else if(typeof A.keys=="function"&&typeof A.get=="function")for(const B of A.keys())g.set(B,A.get(B));else throw Error("Unknown input type for opt_headers: "+String(A));A=Array.from(g.keys()).find(B=>B.toLowerCase()=="content-type"),F=o.FormData&&u instanceof o.FormData,!(Array.prototype.indexOf.call(E1,p,void 0)>=0)||A||F||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[B,se]of g)this.g.setRequestHeader(B,se);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(u),this.v=!1}catch(B){v_(this,B)}};function v_(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.o=5,__(u),vu(u)}function __(u){u.A||(u.A=!0,ae(u,"complete"),ae(u,"error"))}t.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=u||7,ae(this,"complete"),ae(this,"abort"),vu(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),vu(this,!0)),Tt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?w_(this):this.Xa())},t.Xa=function(){w_(this)};function w_(u){if(u.h&&typeof i<"u"){if(u.v&&Rs(u)==4)setTimeout(u.Ca.bind(u),0);else if(ae(u,"readystatechange"),Rs(u)==4){u.h=!1;try{const B=u.ca();e:switch(B){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var g;if(!(g=p)){var A;if(A=B===0){let se=String(u.D).match(c_)[1]||null;!se&&o.self&&o.self.location&&(se=o.self.location.protocol.slice(0,-1)),A=!x1.test(se?se.toLowerCase():"")}g=A}if(g)ae(u,"complete"),ae(u,"success");else{u.o=6;try{var F=Rs(u)>2?u.g.statusText:""}catch{F=""}u.l=F+" ["+u.ca()+"]",__(u)}}finally{vu(u)}}}}function vu(u,p){if(u.g){u.m&&(clearTimeout(u.m),u.m=null);const g=u.g;u.g=null,p||ae(u,"ready");try{g.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Rs(u){return u.g?u.g.readyState:0}t.ca=function(){try{return Rs(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),O(p)}};function x_(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.F){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function b1(u){const p={};u=(u.g&&Rs(u)>=2&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let A=0;A<u.length;A++){if(k(u[A]))continue;var g=ge(u[A]);const F=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const B=p[F]||[];p[F]=B,B.push(g)}ve(p,function(A){return A.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function fl(u,p,g){return g&&g.internalChannelParams&&g.internalChannelParams[u]||p}function E_(u){this.za=0,this.i=[],this.j=new pr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=fl("failFast",!1,u),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=fl("baseRetryDelayMs",5e3,u),this.Za=fl("retryDelaySeedMs",1e4,u),this.Ta=fl("forwardChannelMaxRetries",2,u),this.va=fl("forwardChannelRequestTimeoutMs",2e4,u),this.ma=u&&u.xmlHttpFactory||void 0,this.Ua=u&&u.Rb||void 0,this.Aa=u&&u.useFetchStreams||!1,this.O=void 0,this.L=u&&u.supportsCrossDomainXhr||!1,this.M="",this.h=new s_(u&&u.concurrentRequestLimit),this.Ba=new w1,this.S=u&&u.fastHandshake||!1,this.R=u&&u.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=u&&u.Pb||!1,u&&u.ua&&this.j.ua(),u&&u.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&u&&u.detectBufferingProxy||!1,this.ia=void 0,u&&u.longPollingTimeout&&u.longPollingTimeout>0&&(this.ia=u.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=E_.prototype,t.ka=8,t.I=1,t.connect=function(u,p,g,A){Ze(0),this.W=u,this.H=p||{},g&&A!==void 0&&(this.H.OSID=g,this.H.OAID=A),this.F=this.X,this.J=P_(this,null,this.W),wu(this)};function zf(u){if(b_(u),u.I==3){var p=u.V++,g=Lr(u.J);if(ht(g,"SID",u.M),ht(g,"RID",p),ht(g,"TYPE","terminate"),pl(u,g),p=new Ee(u,u.j,p),p.M=2,p.A=gu(Lr(g)),g=!1,o.navigator&&o.navigator.sendBeacon)try{g=o.navigator.sendBeacon(p.A.toString(),"")}catch{}!g&&o.Image&&(new Image().src=p.A,g=!0),g||(p.g=k_(p.j,null),p.g.ea(p.A)),p.F=Date.now(),ts(p)}R_(u)}function _u(u){u.g&&(Hf(u),u.g.cancel(),u.g=null)}function b_(u){_u(u),u.v&&(o.clearTimeout(u.v),u.v=null),xu(u),u.h.cancel(),u.m&&(typeof u.m=="number"&&o.clearTimeout(u.m),u.m=null)}function wu(u){if(!i_(u.h)&&!u.m){u.m=!0;var p=u.Ea;M||x(),$||(M(),$=!0),b.add(p,u),u.D=0}}function I1(u,p){return o_(u.h)>=u.h.j-(u.m?1:0)?!1:u.m?(u.i=p.G.concat(u.i),!0):u.I==1||u.I==2||u.D>=(u.Sa?0:u.Ta)?!1:(u.m=Dr(d(u.Ea,u,p),A_(u,u.D)),u.D++,!0)}t.Ea=function(u){if(this.m)if(this.m=null,this.I==1){if(!u){this.V=Math.floor(Math.random()*1e5),u=this.V++;const F=new Ee(this,this.j,u);let B=this.o;if(this.U&&(B?(B=ke(B),It(B,this.U)):B=this.U),this.u!==null||this.R||(F.J=B,B=null),this.S)e:{for(var p=0,g=0;g<this.i.length;g++){t:{var A=this.i[g];if("__data__"in A.map&&(A=A.map.__data__,typeof A=="string")){A=A.length;break t}A=void 0}if(A===void 0)break;if(p+=A,p>4096){p=g;break e}if(p===4096||g===this.i.length-1){p=g+1;break e}}p=1e3}else p=1e3;p=T_(this,F,p),g=Lr(this.J),ht(g,"RID",u),ht(g,"CVER",22),this.G&&ht(g,"X-HTTP-Session-Id",this.G),pl(this,g),B&&(this.R?p="headers="+te(y_(B))+"&"+p:this.u&&Bf(g,this.u,B)),Ff(this.h,F),this.Ra&&ht(g,"TYPE","init"),this.S?(ht(g,"$req",p),ht(g,"SID","null"),F.U=!0,Zn(F,g,null)):Zn(F,g,p),this.I=2}}else this.I==3&&(u?I_(this,u):this.i.length==0||i_(this.h)||I_(this))};function I_(u,p){var g;p?g=p.l:g=u.V++;const A=Lr(u.J);ht(A,"SID",u.M),ht(A,"RID",g),ht(A,"AID",u.K),pl(u,A),u.u&&u.o&&Bf(A,u.u,u.o),g=new Ee(u,u.j,g,u.D+1),u.u===null&&(g.J=u.o),p&&(u.i=p.G.concat(u.i)),p=T_(u,g,1e3),g.H=Math.round(u.va*.5)+Math.round(u.va*.5*Math.random()),Ff(u.h,g),Zn(g,A,p)}function pl(u,p){u.H&&fe(u.H,function(g,A){ht(p,A,g)}),u.l&&fe({},function(g,A){ht(p,A,g)})}function T_(u,p,g){g=Math.min(u.i.length,g);const A=u.l?d(u.l.Ka,u.l,u):null;e:{var F=u.i;let Le=-1;for(;;){const $t=["count="+g];Le==-1?g>0?(Le=F[0].g,$t.push("ofs="+Le)):Le=0:$t.push("ofs="+Le);let lt=!0;for(let Kt=0;Kt<g;Kt++){var B=F[Kt].g;const Vr=F[Kt].map;if(B-=Le,B<0)Le=Math.max(0,F[Kt].g-100),lt=!1;else try{B="req"+B+"_"||"";try{var se=Vr instanceof Map?Vr:Object.entries(Vr);for(const[ji,Ps]of se){let ks=Ps;l(Ps)&&(ks=ne(Ps)),$t.push(B+ji+"="+encodeURIComponent(ks))}}catch(ji){throw $t.push(B+"type="+encodeURIComponent("_badmap")),ji}}catch{A&&A(Vr)}}if(lt){se=$t.join("&");break e}}se=void 0}return u=u.i.splice(0,g),p.G=u,se}function S_(u){if(!u.g&&!u.v){u.Y=1;var p=u.Da;M||x(),$||(M(),$=!0),b.add(p,u),u.A=0}}function qf(u){return u.g||u.v||u.A>=3?!1:(u.Y++,u.v=Dr(d(u.Da,u),A_(u,u.A)),u.A++,!0)}t.Da=function(){if(this.v=null,C_(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var u=4*this.T;this.j.info("BP detection timer enabled: "+u),this.B=Dr(d(this.Wa,this),u)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ze(10),_u(this),C_(this))};function Hf(u){u.B!=null&&(o.clearTimeout(u.B),u.B=null)}function C_(u){u.g=new Ee(u,u.j,"rpc",u.Y),u.u===null&&(u.g.J=u.o),u.g.P=0;var p=Lr(u.na);ht(p,"RID","rpc"),ht(p,"SID",u.M),ht(p,"AID",u.K),ht(p,"CI",u.F?"0":"1"),!u.F&&u.ia&&ht(p,"TO",u.ia),ht(p,"TYPE","xmlhttp"),pl(u,p),u.u&&u.o&&Bf(p,u.u,u.o),u.O&&(u.g.H=u.O);var g=u.g;u=u.ba,g.M=1,g.A=gu(Lr(p)),g.u=null,g.R=!0,Lt(g,u)}t.Va=function(){this.C!=null&&(this.C=null,_u(this),qf(this),Ze(19))};function xu(u){u.C!=null&&(o.clearTimeout(u.C),u.C=null)}function N_(u,p){var g=null;if(u.g==p){xu(u),Hf(u),u.g=null;var A=2}else if(Mf(u.h,p))g=p.G,a_(u.h,p),A=1;else return;if(u.I!=0){if(p.o)if(A==1){g=p.u?p.u.length:0,p=Date.now()-p.F;var F=u.D;A=dt(),ae(A,new Ot(A,g)),wu(u)}else S_(u);else if(F=p.m,F==3||F==0&&p.X>0||!(A==1&&I1(u,p)||A==2&&qf(u)))switch(g&&g.length>0&&(p=u.h,p.i=p.i.concat(g)),F){case 1:ki(u,5);break;case 4:ki(u,10);break;case 3:ki(u,6);break;default:ki(u,2)}}}function A_(u,p){let g=u.Qa+Math.floor(Math.random()*u.Za);return u.isActive()||(g*=2),g*p}function ki(u,p){if(u.j.info("Error code "+p),p==2){var g=d(u.bb,u),A=u.Ua;const F=!A;A=new Ns(A||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||ol(A,"https"),gu(A),F?v1(A.toString(),g):_1(A.toString(),g)}else Ze(2);u.I=0,u.l&&u.l.pa(p),R_(u),b_(u)}t.bb=function(u){u?(this.j.info("Successfully pinged google.com"),Ze(2)):(this.j.info("Failed to ping google.com"),Ze(1))};function R_(u){if(u.I=0,u.ja=[],u.l){const p=l_(u.h);(p.length!=0||u.i.length!=0)&&(R(u.ja,p),R(u.ja,u.i),u.h.i.length=0,v(u.i),u.i.length=0),u.l.oa()}}function P_(u,p,g){var A=g instanceof Ns?Lr(g):new Ns(g);if(A.g!="")p&&(A.g=p+"."+A.g),al(A,A.u);else{var F=o.location;A=F.protocol,p=p?p+"."+F.hostname:F.hostname,F=+F.port;const B=new Ns(null);A&&ol(B,A),p&&(B.g=p),F&&al(B,F),g&&(B.h=g),A=B}return g=u.G,p=u.wa,g&&p&&ht(A,g,p),ht(A,"VER",u.ka),pl(u,A),A}function k_(u,p,g){if(p&&!u.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Aa&&!u.ma?new Tt(new $f({ab:g})):new Tt(u.ma),p.Fa(u.L),p}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function j_(){}t=j_.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Eu(){}Eu.prototype.g=function(u,p){return new Fn(u,p)};function Fn(u,p){z.call(this),this.g=new E_(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(u?u["X-WebChannel-Client-Profile"]=p.sa:u={"X-WebChannel-Client-Profile":p.sa}),this.g.U=u,(u=p&&p.Qb)&&!k(u)&&(this.g.u=u),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!k(p)&&(this.g.G=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Do(this)}h(Fn,z),Fn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Fn.prototype.close=function(){zf(this.g)},Fn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var g={};g.__data__=u,u=g}else this.v&&(g={},g.__data__=ne(u),u=g);p.i.push(new u1(p.Ya++,u)),p.I==3&&wu(p)},Fn.prototype.N=function(){this.g.l=null,delete this.j,zf(this.g),delete this.g,Fn.Z.N.call(this)};function D_(u){Xe.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const g in p){u=g;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}h(D_,Xe);function O_(){jt.call(this),this.status=1}h(O_,jt);function Do(u){this.g=u}h(Do,j_),Do.prototype.ra=function(){ae(this.g,"a")},Do.prototype.qa=function(u){ae(this.g,new D_(u))},Do.prototype.pa=function(u){ae(this.g,new O_)},Do.prototype.oa=function(){ae(this.g,"b")},Eu.prototype.createWebChannel=Eu.prototype.g,Fn.prototype.send=Fn.prototype.o,Fn.prototype.open=Fn.prototype.m,Fn.prototype.close=Fn.prototype.close,pS=function(){return new Eu},fS=function(){return dt()},hS=Ge,Zm={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ai.NO_ERROR=0,Ai.TIMEOUT=8,Ai.HTTP_ERROR=6,vd=Ai,il.COMPLETE="complete",dS=il,Se.EventType=Pe,Pe.OPEN="a",Pe.CLOSE="b",Pe.ERROR="c",Pe.MESSAGE="d",z.prototype.listen=z.prototype.J,Ml=Se,Tt.prototype.listenOnce=Tt.prototype.K,Tt.prototype.getLastError=Tt.prototype.Ha,Tt.prototype.getLastErrorCode=Tt.prototype.ya,Tt.prototype.getStatus=Tt.prototype.ca,Tt.prototype.getResponseJson=Tt.prototype.La,Tt.prototype.getResponseText=Tt.prototype.la,Tt.prototype.send=Tt.prototype.ea,Tt.prototype.setWithCredentials=Tt.prototype.Fa,uS=Tt}).apply(typeof zu<"u"?zu:typeof self<"u"?self:typeof window<"u"?window:{});const Rx="@firebase/firestore",Px="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tn.UNAUTHENTICATED=new tn(null),tn.GOOGLE_CREDENTIALS=new tn("google-credentials-uid"),tn.FIRST_PARTY=new tn("first-party-uid"),tn.MOCK_USER=new tn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let el="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ho=new Yh("@firebase/firestore");function Qo(){return ho.logLevel}function J(t,...e){if(ho.logLevel<=$e.DEBUG){const n=e.map(zy);ho.debug(`Firestore (${el}): ${t}`,...n)}}function wn(t,...e){if(ho.logLevel<=$e.ERROR){const n=e.map(zy);ho.error(`Firestore (${el}): ${t}`,...n)}}function fo(t,...e){if(ho.logLevel<=$e.WARN){const n=e.map(zy);ho.warn(`Firestore (${el}): ${t}`,...n)}}function zy(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,mS(t,r,n)}function mS(t,e,n){let r=`FIRESTORE (${el}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw wn(r),new Error(r)}function ye(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||mS(e,s,r)}function Ce(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ee extends fr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class pO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(tn.UNAUTHENTICATED))}shutdown(){}}class mO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class gO{constructor(e){this.t=e,this.currentUser=tn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){ye(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let i=new Tr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Tr,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{J("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(J("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Tr)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(J("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ye(typeof r.accessToken=="string",31837,{l:r}),new gS(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ye(e===null||typeof e=="string",2055,{h:e}),new tn(e)}}class yO{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=tn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class vO{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new yO(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(tn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class kx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class _O{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,rr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){ye(this.o===void 0,3512);const r=i=>{i.error!=null&&J("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,J("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{J("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):J("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new kx(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(ye(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new kx(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wO(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=wO(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%62))}return r}}function Re(t,e){return t<e?-1:t>e?1:0}function eg(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),i=e.charAt(r);if(s!==i)return Np(s)===Np(i)?Re(s,i):Np(s)?1:-1}return Re(t.length,e.length)}const xO=55296,EO=57343;function Np(t){const e=t.charCodeAt(0);return e>=xO&&e<=EO}function ja(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function yS(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jx="__name__";class Br{constructor(e,n,r){n===void 0?n=0:n>e.length&&he(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&he(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Br.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Br?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=Br.compareSegments(e.get(s),n.get(s));if(i!==0)return i}return Re(e.length,n.length)}static compareSegments(e,n){const r=Br.isNumericId(e),s=Br.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?Br.extractNumericId(e).compare(Br.extractNumericId(n)):eg(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ui.fromString(e.substring(4,e.length-2))}}class Ye extends Br{construct(e,n,r){return new Ye(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ee(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Ye(n)}static emptyPath(){return new Ye([])}}const bO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class xt extends Br{construct(e,n,r){return new xt(e,n,r)}static isValidIdentifier(e){return bO.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),xt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===jx}static keyField(){return new xt([jx])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ee(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new ee(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new ee(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(o=!o,s++):l!=="."||o?(r+=l,s++):(i(),s++)}if(i(),o)throw new ee(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new xt(n)}static emptyPath(){return new xt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oe{constructor(e){this.path=e}static fromPath(e){return new oe(Ye.fromString(e))}static fromName(e){return new oe(Ye.fromString(e).popFirst(5))}static empty(){return new oe(Ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ye.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new oe(new Ye(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vS(t,e,n){if(!n)throw new ee(q.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function IO(t,e,n,r){if(e===!0&&r===!0)throw new ee(q.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Dx(t){if(!oe.isDocumentKey(t))throw new ee(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Ox(t){if(oe.isDocumentKey(t))throw new ee(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function _S(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function nf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":he(12329,{type:typeof t})}function pn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ee(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=nf(t);throw new ee(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function TO(t,e){if(e<=0)throw new ee(q.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ft(t,e){const n={typeString:t};return e&&(n.value=e),n}function tu(t,e){if(!_S(t))throw new ee(q.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const o=t[r];if(s&&typeof o!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new ee(q.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lx=-62135596800,Vx=1e6;class qe{static now(){return qe.fromMillis(Date.now())}static fromDate(e){return qe.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Vx);return new qe(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ee(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ee(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Lx)throw new ee(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ee(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Vx}_compareTo(e){return this.seconds===e.seconds?Re(this.nanoseconds,e.nanoseconds):Re(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:qe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(tu(e,qe._jsonSchema))return new qe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Lx;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}qe._jsonSchemaVersion="firestore/timestamp/1.0",qe._jsonSchema={type:Ft("string",qe._jsonSchemaVersion),seconds:Ft("number"),nanoseconds:Ft("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{static fromTimestamp(e){return new _e(e)}static min(){return new _e(new qe(0,0))}static max(){return new _e(new qe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pc=-1;class uh{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function tg(t){return t.fields.find(e=>e.kind===2)}function Fi(t){return t.fields.filter(e=>e.kind!==2)}uh.UNKNOWN_ID=-1;class _d{constructor(e,n){this.fieldPath=e,this.kind=n}}class kc{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new kc(0,Qn.min())}}function SO(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=_e.fromTimestamp(r===1e9?new qe(n+1,0):new qe(n,r));return new Qn(s,oe.empty(),e)}function wS(t){return new Qn(t.readTime,t.key,Pc)}class Qn{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Qn(_e.min(),oe.empty(),Pc)}static max(){return new Qn(_e.max(),oe.empty(),Pc)}}function Hy(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=oe.comparator(t.documentKey,e.documentKey),n!==0?n:Re(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ES{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ro(t){if(t.code!==q.FAILED_PRECONDITION||t.message!==xS)throw t;J("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&he(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new V((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof V?n:V.resolve(n)}catch(n){return V.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):V.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):V.reject(n)}static resolve(e){return new V((n,r)=>{n(e)})}static reject(e){return new V((n,r)=>{r(e)})}static waitFor(e){return new V((n,r)=>{let s=0,i=0,o=!1;e.forEach(l=>{++s,l.next(()=>{++i,o&&i===s&&n()},c=>r(c))}),o=!0,i===s&&n()})}static or(e){let n=V.resolve(!1);for(const r of e)n=n.next(s=>s?V.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new V((r,s)=>{const i=e.length,o=new Array(i);let l=0;for(let c=0;c<i;c++){const d=c;n(e[d]).next(f=>{o[d]=f,++l,l===i&&r(o)},f=>s(f))}})}static doWhile(e,n){return new V((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bn="SimpleDb";class rf{static open(e,n,r,s){try{return new rf(n,e.transaction(s,r))}catch(i){throw new nc(n,i)}}constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.S=new Tr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{n.error?this.S.reject(new nc(e,n.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=Wy(r.target.error);this.S.reject(new nc(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(J(Bn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new NO(n)}}class di{static delete(e){return J(Bn,"Removing database:",e),$i(hT().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Py())return!1;if(di.F())return!0;const e=qt(),n=di.M(e),r=0<n&&n<10,s=bS(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,n){return e.store(n)}static M(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,n,r){this.name=e,this.version=n,this.N=r,this.B=null,di.M(qt())===12.2&&wn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(J(Bn,"Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;n(o)},s.onblocked=()=>{r(new nc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new ee(q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new ee(q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new nc(e,o))},s.onupgradeneeded=i=>{J(Bn,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{J(Bn,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=n=>this.q(n)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const l=rf.open(this.db,e,i?"readonly":"readwrite",r),c=s(l).next(d=>(l.C(),d)).catch(d=>(l.abort(d),V.reject(d))).toPromise();return c.catch(()=>{}),await l.D,c}catch(l){const c=l,d=c.name!=="FirebaseError"&&o<3;if(J(Bn,"Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function bS(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class CO{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return $i(this.U.delete())}}class nc extends ee{constructor(e,n){super(q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function Si(t){return t.name==="IndexedDbTransactionError"}class NO{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(J(Bn,"PUT",this.store.name,e,n),r=this.store.put(n,e)):(J(Bn,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),$i(r)}add(e){return J(Bn,"ADD",this.store.name,e,e),$i(this.store.add(e))}get(e){return $i(this.store.get(e)).next(n=>(n===void 0&&(n=null),J(Bn,"GET",this.store.name,e,n),n))}delete(e){return J(Bn,"DELETE",this.store.name,e),$i(this.store.delete(e))}count(){return J(Bn,"COUNT",this.store.name),$i(this.store.count())}J(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new V((o,l)=>{i.onerror=c=>{l(c.target.error)},i.onsuccess=c=>{o(c.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(l,c)=>{o.push(c)}).next(()=>o)}}Y(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new V((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,n){J(Bn,"DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,l)=>l.delete())}ee(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.H(s,n)}te(e){const n=this.cursor({});return new V((r,s)=>{n.onerror=i=>{const o=Wy(i.target.error);s(o)},n.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(l=>{l?o.continue():r()}):r()}})}H(e,n){const r=[];return new V((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const l=o.target.result;if(!l)return void s();const c=new CO(l),d=n(l.primaryKey,l.value,c);if(d instanceof V){const f=d.catch(h=>(c.done(),V.reject(h)));r.push(f)}c.isDone?s():c.G===null?l.continue():l.continue(c.G)}}).next(()=>V.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function $i(t){return new V((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=Wy(r.target.error);n(s)}})}let Mx=!1;function Wy(t){const e=di.M(qt());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new ee("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Mx||(Mx=!0,setTimeout(()=>{throw r},0)),r}}return t}const rc="IndexBackfiller";class AO{constructor(e,n){this.asyncQueue=e,this.ne=n,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){J(rc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const n=await this.ne.ie();J(rc,`Documents written: ${n}`)}catch(n){Si(n)?J(rc,"Ignoring IndexedDB error during index backfill: ",n):await Ro(n)}await this.re(6e4)})}}class RO{constructor(e,n){this.localStore=e,this.persistence=n}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.se(n,e))}se(e,n){const r=new Set;let s=n,i=!0;return V.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return J(rc,`Processing collection: ${o}`),this.oe(e,o,s).next(l=>{s-=l,r.add(o)});i=!1})).next(()=>n-s)}oe(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(l=>(J(rc,`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,n,l))).next(()=>o.size)}))}_e(e,n){let r=e;return n.changes.forEach((s,i)=>{const o=wS(i);Hy(o,r)>0&&(r=o)}),new Qn(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}or.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zi=-1;function sf(t){return t==null}function jc(t){return t===0&&1/t==-1/0}function PO(t){return typeof t=="number"&&Number.isInteger(t)&&!jc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dh="";function mn(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Fx(e)),e=kO(t.get(n),e);return Fx(e)}function kO(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case dh:n+="";break;default:n+=i}}return n}function Fx(t){return t+dh+""}function qr(t){const e=t.length;if(ye(e>=2,64408,{path:t}),e===2)return ye(t.charAt(0)===dh&&t.charAt(1)==="",56145,{path:t}),Ye.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const o=t.indexOf(dh,i);switch((o<0||o>n)&&he(50515,{path:t}),t.charAt(o+1)){case"":const l=t.substring(i,o);let c;s.length===0?c=l:(s+=l,c=s,s=""),r.push(c);break;case"":s+=t.substring(i,o),s+="\0";break;case"":s+=t.substring(i,o+1);break;default:he(61167,{path:t})}i=o+2}return new Ye(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ui="remoteDocuments",nu="owner",Lo="owner",Dc="mutationQueues",jO="userId",wr="mutations",Ux="batchId",Qi="userMutationsIndex",$x=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wd(t,e){return[t,mn(e)]}function IS(t,e,n){return[t,mn(e),n]}const DO={},Da="documentMutations",hh="remoteDocumentsV14",OO=["prefixPath","collectionGroup","readTime","documentId"],xd="documentKeyIndex",LO=["prefixPath","collectionGroup","documentId"],TS="collectionGroupIndex",VO=["collectionGroup","readTime","prefixPath","documentId"],Oc="remoteDocumentGlobal",ng="remoteDocumentGlobalKey",Oa="targets",SS="queryTargetsIndex",MO=["canonicalId","targetId"],La="targetDocuments",FO=["targetId","path"],Gy="documentTargetsIndex",UO=["path","targetId"],fh="targetGlobalKey",eo="targetGlobal",Lc="collectionParents",$O=["collectionId","parent"],Va="clientMetadata",BO="clientId",of="bundles",zO="bundleId",af="namedQueries",qO="name",Ky="indexConfiguration",HO="indexId",rg="collectionGroupIndex",WO="collectionGroup",sc="indexState",GO=["indexId","uid"],CS="sequenceNumberIndex",KO=["uid","sequenceNumber"],ic="indexEntries",QO=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],NS="documentKeyIndex",YO=["indexId","uid","orderedDocumentKey"],lf="documentOverlays",XO=["userId","collectionPath","documentId"],sg="collectionPathOverlayIndex",JO=["userId","collectionPath","largestBatchId"],AS="collectionGroupOverlayIndex",ZO=["userId","collectionGroup","largestBatchId"],Qy="globals",eL="name",RS=[Dc,wr,Da,Ui,Oa,nu,eo,La,Va,Oc,Lc,of,af],tL=[...RS,lf],PS=[Dc,wr,Da,hh,Oa,nu,eo,La,Va,Oc,Lc,of,af,lf],kS=PS,Yy=[...kS,Ky,sc,ic],nL=Yy,jS=[...Yy,Qy],rL=jS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig extends ES{constructor(e,n){super(),this.le=e,this.currentSequenceNumber=n}}function Ht(t,e){const n=Ce(t);return di.O(n.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bx(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ci(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function sL(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function DS(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e,n){this.comparator=e,this.root=n||nn.EMPTY}insert(e,n){return new vt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,nn.BLACK,null,null))}remove(e){return new vt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new qu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new qu(this.root,e,this.comparator,!1)}getReverseIterator(){return new qu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new qu(this.root,e,this.comparator,!0)}}class qu{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??nn.RED,this.left=s??nn.EMPTY,this.right=i??nn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new nn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return nn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return nn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,nn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,nn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw he(43730,{key:this.key,value:this.value});if(this.right.isRed())throw he(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw he(27949);return e+(this.isRed()?0:1)}}nn.EMPTY=null,nn.RED=!0,nn.BLACK=!1;nn.EMPTY=new class{constructor(){this.size=0}get key(){throw he(57766)}get value(){throw he(16141)}get color(){throw he(16727)}get left(){throw he(29726)}get right(){throw he(36894)}copy(e,n,r,s,i){return this}insert(e,n,r){return new nn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot{constructor(e){this.comparator=e,this.data=new vt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new zx(this.data.getIterator())}getIteratorFrom(e){return new zx(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof ot)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ot(this.comparator);return n.data=e,n}}class zx{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Vo(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e){this.fields=e,e.sort(xt.comparator)}static empty(){return new jn([])}unionWith(e){let n=new ot(xt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new jn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ja(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new OS("Invalid base64 string: "+i):i}}(e);return new Ut(n)}static fromUint8Array(e){const n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Ut(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Re(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ut.EMPTY_BYTE_STRING=new Ut("");const iL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Es(t){if(ye(!!t,39018),typeof t=="string"){let e=0;const n=iL.exec(t);if(ye(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:mt(t.seconds),nanos:mt(t.nanos)}}function mt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function bs(t){return typeof t=="string"?Ut.fromBase64String(t):Ut.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LS="server_timestamp",VS="__type__",MS="__previous_value__",FS="__local_write_time__";function cf(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[VS])==null?void 0:r.stringValue)===LS}function uf(t){const e=t.mapValue.fields[MS];return cf(e)?uf(e):e}function Vc(t){const e=Es(t.mapValue.fields[FS].timestampValue);return new qe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oL{constructor(e,n,r,s,i,o,l,c,d,f){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=f}}const ph="(default)";class po{constructor(e,n){this.projectId=e,this.database=n||ph}static empty(){return new po("","")}get isDefaultDatabase(){return this.database===ph}isEqual(e){return e instanceof po&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy="__type__",US="__max__",Js={mapValue:{fields:{__type__:{stringValue:US}}}},Jy="__vector__",Ma="value",Ed={nullValue:"NULL_VALUE"};function mi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?cf(t)?4:$S(t)?9007199254740991:df(t)?10:11:he(28295,{value:t})}function Zr(t,e){if(t===e)return!0;const n=mi(t);if(n!==mi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vc(t).isEqual(Vc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Es(s.timestampValue),l=Es(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return bs(s.bytesValue).isEqual(bs(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return mt(s.geoPointValue.latitude)===mt(i.geoPointValue.latitude)&&mt(s.geoPointValue.longitude)===mt(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return mt(s.integerValue)===mt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=mt(s.doubleValue),l=mt(i.doubleValue);return o===l?jc(o)===jc(l):isNaN(o)&&isNaN(l)}return!1}(t,e);case 9:return ja(t.arrayValue.values||[],e.arrayValue.values||[],Zr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},l=i.mapValue.fields||{};if(Bx(o)!==Bx(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Zr(o[c],l[c])))return!1;return!0}(t,e);default:return he(52216,{left:t})}}function Mc(t,e){return(t.values||[]).find(n=>Zr(n,e))!==void 0}function gi(t,e){if(t===e)return 0;const n=mi(t),r=mi(e);if(n!==r)return Re(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Re(t.booleanValue,e.booleanValue);case 2:return function(i,o){const l=mt(i.integerValue||i.doubleValue),c=mt(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return qx(t.timestampValue,e.timestampValue);case 4:return qx(Vc(t),Vc(e));case 5:return eg(t.stringValue,e.stringValue);case 6:return function(i,o){const l=bs(i),c=bs(o);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const l=i.split("/"),c=o.split("/");for(let d=0;d<l.length&&d<c.length;d++){const f=Re(l[d],c[d]);if(f!==0)return f}return Re(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const l=Re(mt(i.latitude),mt(o.latitude));return l!==0?l:Re(mt(i.longitude),mt(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Hx(t.arrayValue,e.arrayValue);case 10:return function(i,o){var m,v,R,N;const l=i.fields||{},c=o.fields||{},d=(m=l[Ma])==null?void 0:m.arrayValue,f=(v=c[Ma])==null?void 0:v.arrayValue,h=Re(((R=d==null?void 0:d.values)==null?void 0:R.length)||0,((N=f==null?void 0:f.values)==null?void 0:N.length)||0);return h!==0?h:Hx(d,f)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===Js.mapValue&&o===Js.mapValue)return 0;if(i===Js.mapValue)return 1;if(o===Js.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),d=o.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let h=0;h<c.length&&h<f.length;++h){const m=eg(c[h],f[h]);if(m!==0)return m;const v=gi(l[c[h]],d[f[h]]);if(v!==0)return v}return Re(c.length,f.length)}(t.mapValue,e.mapValue);default:throw he(23264,{he:n})}}function qx(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Re(t,e);const n=Es(t),r=Es(e),s=Re(n.seconds,r.seconds);return s!==0?s:Re(n.nanos,r.nanos)}function Hx(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=gi(n[s],r[s]);if(i)return i}return Re(n.length,r.length)}function Fa(t){return og(t)}function og(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Es(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return bs(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return oe.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=og(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${og(n.fields[o])}`;return s+"}"}(t.mapValue):he(61005,{value:t})}function bd(t){switch(mi(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=uf(t);return e?16+bd(e):16;case 5:return 2*t.stringValue.length;case 6:return bs(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+bd(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return Ci(r.fields,(i,o)=>{s+=i.length+bd(o)}),s}(t.mapValue);default:throw he(13486,{value:t})}}function mo(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function ag(t){return!!t&&"integerValue"in t}function Fc(t){return!!t&&"arrayValue"in t}function Wx(t){return!!t&&"nullValue"in t}function Gx(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Id(t){return!!t&&"mapValue"in t}function df(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[Xy])==null?void 0:r.stringValue)===Jy}function oc(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Ci(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=oc(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=oc(t.arrayValue.values[n]);return e}return{...t}}function $S(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===US}const BS={mapValue:{fields:{[Xy]:{stringValue:Jy},[Ma]:{arrayValue:{}}}}};function aL(t){return"nullValue"in t?Ed:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?mo(po.empty(),oe.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?df(t)?BS:{mapValue:{}}:he(35942,{value:t})}function lL(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?mo(po.empty(),oe.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?BS:"mapValue"in t?df(t)?{mapValue:{}}:Js:he(61959,{value:t})}function Kx(t,e){const n=gi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function Qx(t,e){const n=gi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e){this.value=e}static empty(){return new dn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Id(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=oc(n)}setAll(e){let n=xt.emptyPath(),r={},s=[];e.forEach((o,l)=>{if(!n.isImmediateParentOf(l)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=l.popLast()}o?r[l.lastSegment()]=oc(o):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Id(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Zr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Id(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Ci(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new dn(oc(this.value))}}function zS(t){const e=[];return Ci(t.fields,(n,r)=>{const s=new xt([n]);if(Id(r)){const i=zS(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new jn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ct{constructor(e,n,r,s,i,o,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new Ct(e,0,_e.min(),_e.min(),_e.min(),dn.empty(),0)}static newFoundDocument(e,n,r,s){return new Ct(e,1,n,_e.min(),r,s,0)}static newNoDocument(e,n){return new Ct(e,2,n,_e.min(),_e.min(),dn.empty(),0)}static newUnknownDocument(e,n){return new Ct(e,3,n,_e.min(),_e.min(),dn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(_e.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=dn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=dn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=_e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ct&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ct(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yi{constructor(e,n){this.position=e,this.inclusive=n}}function Yx(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(i.field.isKeyField()?r=oe.comparator(oe.fromName(o.referenceValue),n.key):r=gi(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Xx(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Zr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e,n="asc"){this.field=e,this.dir=n}}function cL(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qS{}class Be extends qS{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new uL(e,n,r):n==="array-contains"?new fL(e,r):n==="in"?new YS(e,r):n==="not-in"?new pL(e,r):n==="array-contains-any"?new mL(e,r):new Be(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new dL(e,r):new hL(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(gi(n,this.value)):n!==null&&mi(this.value)===mi(n)&&this.matchesComparison(gi(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return he(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class st extends qS{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new st(e,n)}matches(e){return Ua(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ua(t){return t.op==="and"}function lg(t){return t.op==="or"}function Zy(t){return HS(t)&&Ua(t)}function HS(t){for(const e of t.filters)if(e instanceof st)return!1;return!0}function cg(t){if(t instanceof Be)return t.field.canonicalString()+t.op.toString()+Fa(t.value);if(Zy(t))return t.filters.map(e=>cg(e)).join(",");{const e=t.filters.map(n=>cg(n)).join(",");return`${t.op}(${e})`}}function WS(t,e){return t instanceof Be?function(r,s){return s instanceof Be&&r.op===s.op&&r.field.isEqual(s.field)&&Zr(r.value,s.value)}(t,e):t instanceof st?function(r,s){return s instanceof st&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,l)=>i&&WS(o,s.filters[l]),!0):!1}(t,e):void he(19439)}function GS(t,e){const n=t.filters.concat(e);return st.create(n,t.op)}function KS(t){return t instanceof Be?function(n){return`${n.field.canonicalString()} ${n.op} ${Fa(n.value)}`}(t):t instanceof st?function(n){return n.op.toString()+" {"+n.getFilters().map(KS).join(" ,")+"}"}(t):"Filter"}class uL extends Be{constructor(e,n,r){super(e,n,r),this.key=oe.fromName(r.referenceValue)}matches(e){const n=oe.comparator(e.key,this.key);return this.matchesComparison(n)}}class dL extends Be{constructor(e,n){super(e,"in",n),this.keys=QS("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class hL extends Be{constructor(e,n){super(e,"not-in",n),this.keys=QS("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function QS(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>oe.fromName(r.referenceValue))}class fL extends Be{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Fc(n)&&Mc(n.arrayValue,this.value)}}class YS extends Be{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Mc(this.value.arrayValue,n)}}class pL extends Be{constructor(e,n){super(e,"not-in",n)}matches(e){if(Mc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Mc(this.value.arrayValue,n)}}class mL extends Be{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Fc(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Mc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gL{constructor(e,n=null,r=[],s=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=l,this.Te=null}}function ug(t,e=null,n=[],r=[],s=null,i=null,o=null){return new gL(t,e,n,r,s,i,o)}function go(t){const e=Ce(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>cg(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),sf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Fa(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Fa(r)).join(",")),e.Te=n}return e.Te}function ru(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!cL(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!WS(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Xx(t.startAt,e.startAt)&&Xx(t.endAt,e.endAt)}function mh(t){return oe.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function gh(t,e){return t.filters.filter(n=>n instanceof Be&&n.field.isEqual(e))}function Jx(t,e,n){let r=Ed,s=!0;for(const i of gh(t,e)){let o=Ed,l=!0;switch(i.op){case"<":case"<=":o=aL(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,l=!1;break;case"!=":case"not-in":o=Ed}Kx({value:r,inclusive:s},{value:o,inclusive:l})<0&&(r=o,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];Kx({value:r,inclusive:s},{value:o,inclusive:n.inclusive})<0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}function Zx(t,e,n){let r=Js,s=!0;for(const i of gh(t,e)){let o=Js,l=!0;switch(i.op){case">=":case">":o=lL(i.value),l=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,l=!1;break;case"!=":case"not-in":o=Js}Qx({value:r,inclusive:s},{value:o,inclusive:l})>0&&(r=o,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];Qx({value:r,inclusive:s},{value:o,inclusive:n.inclusive})>0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ni{constructor(e,n=null,r=[],s=[],i=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function yL(t,e,n,r,s,i,o,l){return new Ni(t,e,n,r,s,i,o,l)}function su(t){return new Ni(t)}function eE(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function ev(t){return t.collectionGroup!==null}function xa(t){const e=Ce(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new ot(xt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Uc(i,r))}),n.has(xt.keyField().canonicalString())||e.Ie.push(new Uc(xt.keyField(),r))}return e.Ie}function lr(t){const e=Ce(t);return e.Ee||(e.Ee=XS(e,xa(t))),e.Ee}function vL(t){const e=Ce(t);return e.de||(e.de=XS(e,t.explicitOrderBy)),e.de}function XS(t,e){if(t.limitType==="F")return ug(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Uc(s.field,i)});const n=t.endAt?new yi(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new yi(t.startAt.position,t.startAt.inclusive):null;return ug(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function dg(t,e){const n=t.filters.concat([e]);return new Ni(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function yh(t,e,n){return new Ni(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function hf(t,e){return ru(lr(t),lr(e))&&t.limitType===e.limitType}function JS(t){return`${go(lr(t))}|lt:${t.limitType}`}function Yo(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>KS(s)).join(", ")}]`),sf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Fa(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Fa(s)).join(",")),`Target(${r})`}(lr(t))}; limitType=${t.limitType})`}function iu(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):oe.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of xa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,l,c){const d=Yx(o,l,c);return o.inclusive?d<=0:d<0}(r.startAt,xa(r),s)||r.endAt&&!function(o,l,c){const d=Yx(o,l,c);return o.inclusive?d>=0:d>0}(r.endAt,xa(r),s))}(t,e)}function _L(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function ZS(t){return(e,n)=>{let r=!1;for(const s of xa(t)){const i=wL(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function wL(t,e,n){const r=t.field.isKeyField()?oe.comparator(e.key,n.key):function(i,o,l){const c=o.data.field(i),d=l.data.field(i);return c!==null&&d!==null?gi(c,d):he(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return he(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ts{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ci(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return DS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xL=new vt(oe.comparator);function Hn(){return xL}const eC=new vt(oe.comparator);function Fl(...t){let e=eC;for(const n of t)e=e.insert(n.key,n);return e}function tC(t){let e=eC;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Hr(){return ac()}function nC(){return ac()}function ac(){return new Ts(t=>t.toString(),(t,e)=>t.isEqual(e))}const EL=new vt(oe.comparator),bL=new ot(oe.comparator);function Ve(...t){let e=bL;for(const n of t)e=e.add(n);return e}const IL=new ot(Re);function TL(){return IL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tv(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jc(e)?"-0":e}}function rC(t){return{integerValue:""+t}}function sC(t,e){return PO(e)?rC(e):tv(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff{constructor(){this._=void 0}}function SL(t,e,n){return t instanceof $a?function(s,i){const o={fields:{[VS]:{stringValue:LS},[FS]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&cf(i)&&(i=uf(i)),i&&(o.fields[MS]=i),{mapValue:o}}(n,e):t instanceof yo?oC(t,e):t instanceof Ba?aC(t,e):function(s,i){const o=iC(s,i),l=tE(o)+tE(s.Ae);return ag(o)&&ag(s.Ae)?rC(l):tv(s.serializer,l)}(t,e)}function CL(t,e,n){return t instanceof yo?oC(t,e):t instanceof Ba?aC(t,e):n}function iC(t,e){return t instanceof za?function(r){return ag(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class $a extends ff{}class yo extends ff{constructor(e){super(),this.elements=e}}function oC(t,e){const n=lC(e);for(const r of t.elements)n.some(s=>Zr(s,r))||n.push(r);return{arrayValue:{values:n}}}class Ba extends ff{constructor(e){super(),this.elements=e}}function aC(t,e){let n=lC(e);for(const r of t.elements)n=n.filter(s=>!Zr(s,r));return{arrayValue:{values:n}}}class za extends ff{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function tE(t){return mt(t.integerValue||t.doubleValue)}function lC(t){return Fc(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e,n){this.field=e,this.transform=n}}function NL(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof yo&&s instanceof yo||r instanceof Ba&&s instanceof Ba?ja(r.elements,s.elements,Zr):r instanceof za&&s instanceof za?Zr(r.Ae,s.Ae):r instanceof $a&&s instanceof $a}(t.transform,e.transform)}class AL{constructor(e,n){this.version=e,this.transformResults=n}}class hn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new hn}static exists(e){return new hn(void 0,e)}static updateTime(e){return new hn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Td(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class mf{}function cC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new gf(t.key,hn.none()):new tl(t.key,t.data,hn.none());{const n=t.data,r=dn.empty();let s=new ot(xt.comparator);for(let i of e.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Ss(t.key,r,new jn(s.toArray()),hn.none())}}function RL(t,e,n){t instanceof tl?function(s,i,o){const l=s.value.clone(),c=rE(s.fieldTransforms,i,o.transformResults);l.setAll(c),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Ss?function(s,i,o){if(!Td(s.precondition,i))return void i.convertToUnknownDocument(o.version);const l=rE(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(uC(s)),c.setAll(l),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function lc(t,e,n,r){return t instanceof tl?function(i,o,l,c){if(!Td(i.precondition,o))return l;const d=i.value.clone(),f=sE(i.fieldTransforms,c,o);return d.setAll(f),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ss?function(i,o,l,c){if(!Td(i.precondition,o))return l;const d=sE(i.fieldTransforms,c,o),f=o.data;return f.setAll(uC(i)),f.setAll(d),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(t,e,n,r):function(i,o,l){return Td(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(t,e,n)}function PL(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=iC(r.transform,s||null);i!=null&&(n===null&&(n=dn.empty()),n.set(r.field,i))}return n||null}function nE(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ja(r,s,(i,o)=>NL(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class tl extends mf{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ss extends mf{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function uC(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function rE(t,e,n){const r=new Map;ye(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,l=e.data.field(i.field);r.set(i.field,CL(o,l,n[s]))}return r}function sE(t,e,n){const r=new Map;for(const s of t){const i=s.transform,o=n.data.field(s.field);r.set(s.field,SL(i,o,e))}return r}class gf extends mf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class dC extends mf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&RL(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=lc(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=lc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=nC();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=n.has(s.key)?null:l;const c=cC(o,l);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(_e.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ve())}isEqual(e){return this.batchId===e.batchId&&ja(this.mutations,e.mutations,(n,r)=>nE(n,r))&&ja(this.baseMutations,e.baseMutations,(n,r)=>nE(n,r))}}class rv{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){ye(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return EL}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new rv(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sv{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kL{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jL{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Vt,ze;function DL(t){switch(t){case q.OK:return he(64938);case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0;default:return he(15467,{code:t})}}function hC(t){if(t===void 0)return wn("GRPC error has no .code"),q.UNKNOWN;switch(t){case Vt.OK:return q.OK;case Vt.CANCELLED:return q.CANCELLED;case Vt.UNKNOWN:return q.UNKNOWN;case Vt.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case Vt.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case Vt.INTERNAL:return q.INTERNAL;case Vt.UNAVAILABLE:return q.UNAVAILABLE;case Vt.UNAUTHENTICATED:return q.UNAUTHENTICATED;case Vt.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case Vt.NOT_FOUND:return q.NOT_FOUND;case Vt.ALREADY_EXISTS:return q.ALREADY_EXISTS;case Vt.PERMISSION_DENIED:return q.PERMISSION_DENIED;case Vt.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case Vt.ABORTED:return q.ABORTED;case Vt.OUT_OF_RANGE:return q.OUT_OF_RANGE;case Vt.UNIMPLEMENTED:return q.UNIMPLEMENTED;case Vt.DATA_LOSS:return q.DATA_LOSS;default:return he(39323,{code:t})}}(ze=Vt||(Vt={}))[ze.OK=0]="OK",ze[ze.CANCELLED=1]="CANCELLED",ze[ze.UNKNOWN=2]="UNKNOWN",ze[ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ze[ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ze[ze.NOT_FOUND=5]="NOT_FOUND",ze[ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",ze[ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",ze[ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",ze[ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ze[ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ze[ze.ABORTED=10]="ABORTED",ze[ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",ze[ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",ze[ze.INTERNAL=13]="INTERNAL",ze[ze.UNAVAILABLE=14]="UNAVAILABLE",ze[ze.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LL=new ui([4294967295,4294967295],0);function iE(t){const e=OL().encode(t),n=new cS;return n.update(e),new Uint8Array(n.digest())}function oE(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ui([n,r],0),new ui([s,i],0)]}class iv{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Ul(`Invalid padding: ${n}`);if(r<0)throw new Ul(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Ul(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Ul(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=ui.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(ui.fromNumber(r)));return s.compare(LL)===1&&(s=new ui([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=iE(e),[r,s]=oE(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new iv(i,s,n);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.ge===0)return;const n=iE(e),[r,s]=oE(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Ul extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,ou.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new yf(_e.min(),s,new vt(Re),Hn(),Ve())}}class ou{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new ou(r,n,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sd{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class fC{constructor(e,n){this.targetId=e,this.Ce=n}}class pC{constructor(e,n,r=Ut.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class aE{constructor(){this.ve=0,this.Fe=lE(),this.Me=Ut.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ve(),n=Ve(),r=Ve();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:he(38017,{changeType:i})}}),new ou(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=lE()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ye(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class VL{constructor(e){this.Ge=e,this.ze=new Map,this.je=Hn(),this.Je=Hu(),this.He=Hu(),this.Ye=new vt(Re)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:he(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,s)=>{this.rt(s)&&n(s)})}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const i=s.target;if(mh(i))if(r===0){const o=new oe(i.path);this.et(n,o,Ct.newNoDocument(o,_e.min()))}else ye(r===1,20013,{expectedCount:r});else{const o=this._t(n);if(o!==r){const l=this.ut(e),c=l?this.ct(l,e,o):1;if(c!==0){this.it(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,d)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let o,l;try{o=bs(r).toUint8Array()}catch(c){if(c instanceof OS)return fo("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new iv(o,s,i)}catch(c){return fo(c instanceof Ul?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(n,i,null),s++)}),s}Tt(e){const n=new Map;this.ze.forEach((i,o)=>{const l=this.ot(o);if(l){if(i.current&&mh(l.target)){const c=new oe(l.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,Ct.newNoDocument(c,e))}i.Be&&(n.set(o,i.ke()),i.qe())}});let r=Ve();this.He.forEach((i,o)=>{let l=!0;o.forEachWhile(c=>{const d=this.ot(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new yf(e,n,this.Ye,this.je,r);return this.je=Hn(),this.Je=Hu(),this.He=Hu(),this.Ye=new vt(Re),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new aE,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new ot(Re),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new ot(Re),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||J("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new aE),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Hu(){return new vt(oe.comparator)}function lE(){return new vt(oe.comparator)}const ML={asc:"ASCENDING",desc:"DESCENDING"},FL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},UL={and:"AND",or:"OR"};class $L{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function hg(t,e){return t.useProto3Json||sf(e)?e:{value:e}}function qa(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function mC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function BL(t,e){return qa(t,e.toTimestamp())}function In(t){return ye(!!t,49232),_e.fromTimestamp(function(n){const r=Es(n);return new qe(r.seconds,r.nanos)}(t))}function ov(t,e){return fg(t,e).canonicalString()}function fg(t,e){const n=function(s){return new Ye(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function gC(t){const e=Ye.fromString(t);return ye(IC(e),10190,{key:e.toString()}),e}function vh(t,e){return ov(t.databaseId,e.path)}function to(t,e){const n=gC(e);if(n.get(1)!==t.databaseId.projectId)throw new ee(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ee(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new oe(_C(n))}function yC(t,e){return ov(t.databaseId,e)}function vC(t){const e=gC(t);return e.length===4?Ye.emptyPath():_C(e)}function pg(t){return new Ye(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function _C(t){return ye(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function cE(t,e,n){return{name:vh(t,e),fields:n.value.mapValue.fields}}function zL(t,e,n){const r=to(t,e.name),s=In(e.updateTime),i=e.createTime?In(e.createTime):_e.min(),o=new dn({mapValue:{fields:e.fields}}),l=Ct.newFoundDocument(r,s,i,o);return n&&l.setHasCommittedMutations(),n?l.setHasCommittedMutations():l}function qL(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:he(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(ye(f===void 0||typeof f=="string",58123),Ut.fromBase64String(f||"")):(ye(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Ut.fromUint8Array(f||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(d){const f=d.code===void 0?q.UNKNOWN:hC(d.code);return new ee(f,d.message||"")}(o);n=new pC(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=to(t,r.document.name),i=In(r.document.updateTime),o=r.document.createTime?In(r.document.createTime):_e.min(),l=new dn({mapValue:{fields:r.document.fields}}),c=Ct.newFoundDocument(s,i,o,l),d=r.targetIds||[],f=r.removedTargetIds||[];n=new Sd(d,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=to(t,r.document),i=r.readTime?In(r.readTime):_e.min(),o=Ct.newNoDocument(s,i),l=r.removedTargetIds||[];n=new Sd([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=to(t,r.document),i=r.removedTargetIds||[];n=new Sd([],i,s,null)}else{if(!("filter"in e))return he(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new jL(s,i),l=r.targetId;n=new fC(l,o)}}return n}function _h(t,e){let n;if(e instanceof tl)n={update:cE(t,e.key,e.value)};else if(e instanceof gf)n={delete:vh(t,e.key)};else if(e instanceof Ss)n={update:cE(t,e.key,e.data),updateMask:XL(e.fieldMask)};else{if(!(e instanceof dC))return he(16599,{Vt:e.type});n={verify:vh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const l=o.transform;if(l instanceof $a)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof yo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ba)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof za)return{fieldPath:o.field.canonicalString(),increment:l.Ae};throw he(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:BL(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:he(27497)}(t,e.precondition)),n}function mg(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?hn.updateTime(In(i.updateTime)):i.exists!==void 0?hn.exists(i.exists):hn.none()}(e.currentDocument):hn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,l){let c=null;if("setToServerValue"in l)ye(l.setToServerValue==="REQUEST_TIME",16630,{proto:l}),c=new $a;else if("appendMissingElements"in l){const f=l.appendMissingElements.values||[];c=new yo(f)}else if("removeAllFromArray"in l){const f=l.removeAllFromArray.values||[];c=new Ba(f)}else"increment"in l?c=new za(o,l.increment):he(16584,{proto:l});const d=xt.fromServerFormat(l.fieldPath);return new pf(d,c)}(t,s)):[];if(e.update){e.update.name;const s=to(t,e.update.name),i=new dn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const d=c.fieldPaths||[];return new jn(d.map(f=>xt.fromServerFormat(f)))}(e.updateMask);return new Ss(s,i,o,n,r)}return new tl(s,i,n,r)}if(e.delete){const s=to(t,e.delete);return new gf(s,n)}if(e.verify){const s=to(t,e.verify);return new dC(s,n)}return he(1463,{proto:e})}function HL(t,e){return t&&t.length>0?(ye(e!==void 0,14353),t.map(n=>function(s,i){let o=s.updateTime?In(s.updateTime):In(i);return o.isEqual(_e.min())&&(o=In(i)),new AL(o,s.transformResults||[])}(n,e))):[]}function wC(t,e){return{documents:[yC(t,e.path)]}}function av(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=yC(t,s);const i=function(d){if(d.length!==0)return bC(st.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(d){if(d.length!==0)return d.map(f=>function(m){return{field:Gs(m.field),direction:KL(m.dir)}}(f))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const l=hg(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:n,parent:s}}function WL(t,e,n,r){const{ft:s,parent:i}=av(t,e),o={},l=[];let c=0;return n.forEach(d=>{const f="aggregate_"+c++;o[f]=d.alias,d.aggregateType==="count"?l.push({alias:f,count:{}}):d.aggregateType==="avg"?l.push({alias:f,avg:{field:Gs(d.fieldPath)}}):d.aggregateType==="sum"&&l.push({alias:f,sum:{field:Gs(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:l,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function xC(t){let e=vC(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){ye(r===1,65062);const f=n.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];n.where&&(i=function(h){const m=EC(h);return m instanceof st&&Zy(m)?m.getFilters():[m]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(m=>function(R){return new Uc(Xo(R.field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(R.direction))}(m))}(n.orderBy));let l=null;n.limit&&(l=function(h){let m;return m=typeof h=="object"?h.value:h,sf(m)?null:m}(n.limit));let c=null;n.startAt&&(c=function(h){const m=!!h.before,v=h.values||[];return new yi(v,m)}(n.startAt));let d=null;return n.endAt&&(d=function(h){const m=!h.before,v=h.values||[];return new yi(v,m)}(n.endAt)),yL(e,s,o,i,l,"F",c,d)}function GL(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return he(28987,{purpose:s})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function EC(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Xo(n.unaryFilter.field);return Be.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Xo(n.unaryFilter.field);return Be.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Xo(n.unaryFilter.field);return Be.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Xo(n.unaryFilter.field);return Be.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return he(61313);default:return he(60726)}}(t):t.fieldFilter!==void 0?function(n){return Be.create(Xo(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return he(58110);default:return he(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return st.create(n.compositeFilter.filters.map(r=>EC(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return he(1026)}}(n.compositeFilter.op))}(t):he(30097,{filter:t})}function KL(t){return ML[t]}function QL(t){return FL[t]}function YL(t){return UL[t]}function Gs(t){return{fieldPath:t.canonicalString()}}function Xo(t){return xt.fromServerFormat(t.fieldPath)}function bC(t){return t instanceof Be?function(n){if(n.op==="=="){if(Gx(n.value))return{unaryFilter:{field:Gs(n.field),op:"IS_NAN"}};if(Wx(n.value))return{unaryFilter:{field:Gs(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Gx(n.value))return{unaryFilter:{field:Gs(n.field),op:"IS_NOT_NAN"}};if(Wx(n.value))return{unaryFilter:{field:Gs(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gs(n.field),op:QL(n.op),value:n.value}}}(t):t instanceof st?function(n){const r=n.getFilters().map(s=>bC(s));return r.length===1?r[0]:{compositeFilter:{op:YL(n.op),filters:r}}}(t):he(54877,{filter:t})}function XL(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function IC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e,n,r,s,i=_e.min(),o=_e.min(),l=Ut.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new us(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new us(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new us(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new us(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TC{constructor(e){this.yt=e}}function JL(t,e){let n;if(e.document)n=zL(t.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=oe.fromSegments(e.noDocument.path),s=_o(e.noDocument.readTime);n=Ct.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return he(56709);{const r=oe.fromSegments(e.unknownDocument.path),s=_o(e.unknownDocument.version);n=Ct.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new qe(s[0],s[1]);return _e.fromTimestamp(i)}(e.readTime)),n}function uE(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:wh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:vh(i,o.key),fields:o.data.value.mapValue.fields,updateTime:qa(i,o.version.toTimestamp()),createTime:qa(i,o.createTime.toTimestamp())}}(t.yt,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:vo(e.version)};else{if(!e.isUnknownDocument())return he(57904,{document:e});r.unknownDocument={path:n.path.toArray(),version:vo(e.version)}}return r}function wh(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function vo(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function _o(t){const e=new qe(t.seconds,t.nanoseconds);return _e.fromTimestamp(e)}function Bi(t,e){const n=(e.baseMutations||[]).map(i=>mg(t.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>mg(t.yt,i)),s=qe.fromMillis(e.localWriteTimeMs);return new nv(e.batchId,s,n,r)}function $l(t){const e=_o(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?_o(t.lastLimboFreeSnapshotVersion):_e.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){const o=i.documents.length;return ye(o===1,1966,{count:o}),lr(su(vC(i.documents[0])))}(t.query):function(i){return lr(xC(i))}(t.query),new us(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,Ut.fromBase64String(t.resumeToken))}function SC(t,e){const n=vo(e.snapshotVersion),r=vo(e.lastLimboFreeSnapshotVersion);let s;s=mh(e.target)?wC(t.yt,e.target):av(t.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:go(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function CC(t){const e=xC({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?yh(e,e.limit,"L"):e}function Ap(t,e){return new sv(e.largestBatchId,mg(t.yt,e.overlayMutation))}function dE(t,e){const n=e.path.lastSegment();return[t,mn(e.path.popLast()),n]}function hE(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:vo(r.readTime),documentKey:mn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZL{getBundleMetadata(e,n){return fE(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:_o(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return fE(e).put(function(s){return{bundleId:s.id,createTime:vo(In(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return pE(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:CC(i.bundledQuery),readTime:_o(i.readTime)}}(r)})}saveNamedQuery(e,n){return pE(e).put(function(s){return{name:s.name,readTime:vo(In(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function fE(t){return Ht(t,of)}function pE(t){return Ht(t,af)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(e,n){this.serializer=e,this.userId=n}static wt(e,n){const r=n.uid||"";return new vf(e,r)}getOverlay(e,n){return Il(e).get(dE(this.userId,n)).next(r=>r?Ap(this.serializer,r):null)}getOverlays(e,n){const r=Hr();return V.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,o)=>{const l=new sv(n,o);s.push(this.St(e,l))}),V.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(o=>s.add(mn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const l=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Il(e).Z(sg,l))}),V.waitFor(i)}getOverlaysForCollection(e,n,r){const s=Hr(),i=mn(n),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Il(e).J(sg,o).next(l=>{for(const c of l){const d=Ap(this.serializer,c);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=Hr();let o;const l=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return Il(e).ee({index:AS,range:l},(c,d,f)=>{const h=Ap(this.serializer,d);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):f.done()}).next(()=>i)}St(e,n){return Il(e).put(function(s,i,o){const[l,c,d]=dE(i,o.mutation.key);return{userId:i,collectionPath:c,documentId:d,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:_h(s.yt,o.mutation)}}(this.serializer,this.userId,n))}}function Il(t){return Ht(t,lf)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eV{bt(e){return Ht(e,Qy)}getSessionToken(e){return this.bt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?Ut.fromUint8Array(r):Ut.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.bt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(mt(e.integerValue));else if("doubleValue"in e){const r=mt(e.doubleValue);isNaN(r)?this.Ft(n,13):(this.Ft(n,15),jc(r)?n.Mt(0):n.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(n,20),typeof r=="string"&&(r=Es(r)),n.xt(`${r.seconds||""}`),n.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(bs(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(n,45),n.Mt(r.latitude||0),n.Mt(r.longitude||0)}else"mapValue"in e?$S(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):df(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):he(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){const r=e.fields||{};this.Ft(n,55);for(const s of Object.keys(r))this.Ot(s,n),this.Ct(r[s],n)}kt(e,n){var o,l;const r=e.fields||{};this.Ft(n,53);const s=Ma,i=((l=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:l.length)||0;this.Ft(n,15),n.Mt(mt(i)),this.Ot(s,n),this.Ct(r[s],n)}Qt(e,n){const r=e.values||[];this.Ft(n,50);for(const s of r)this.Ct(s,n)}Lt(e,n){this.Ft(n,37),oe.fromName(e).path.forEach(r=>{this.Ft(n,60),this.Ut(r,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}}zi.Kt=new zi;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo=255;function tV(t){if(t===0)return 8;let e=0;return t>>4||(e+=4,t<<=4),t>>6||(e+=2,t<<=2),t>>7||(e+=1),e}function mE(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=tV(255&r[i]);if(s+=o,o!==8)break}return s}(t);return Math.ceil(e/8)}class nV{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Gt(r.value),r=n.next();this.zt()}jt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Jt(r.value),r=n.next();this.Ht()}Yt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=n.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=n.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const n=this.en(e),r=mE(n);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}nn(e){const n=this.en(e),r=mE(n);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}rn(){this.sn(Mo),this.sn(255)}_n(){this.an(Mo),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const n=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&n[0]);n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Gt(e){const n=255&e;n===0?(this.sn(0),this.sn(255)):n===Mo?(this.sn(Mo),this.sn(0)):this.sn(n)}Jt(e){const n=255&e;n===0?(this.an(0),this.an(255)):n===Mo?(this.an(Mo),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class rV{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class sV{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Tl{constructor(){this.cn=new nV,this.ln=new rV(this.cn),this.hn=new sV(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,n,r,s){this.Tn=e,this.In=n,this.En=r,this.dn=s}An(){const e=this.dn.length,n=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.dn,0),n!==e?r.set([0],this.dn.length):++r[r.length-1],new qi(this.Tn,this.In,this.En,r)}Rn(e,n,r){return{indexId:this.Tn,uid:e,arrayValue:Cd(this.En),directionalValue:Cd(this.dn),orderedDocumentKey:Cd(n),documentKey:r.path.toArray()}}Vn(e,n,r){const s=this.Rn(e,n,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Os(t,e){let n=t.Tn-e.Tn;return n!==0?n:(n=gE(t.En,e.En),n!==0?n:(n=gE(t.dn,e.dn),n!==0?n:oe.comparator(t.In,e.In)))}function gE(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}function Cd(t){return xT()?function(n){let r="";for(let s=0;s<n.length;s++)r+=String.fromCharCode(n[s]);return r}(t):t}function yE(t){return typeof t!="string"?t:function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(t)}class vE{constructor(e){this.mn=new ot((n,r)=>xt.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const n of e.filters){const r=n;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(ye(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const n=tg(e);if(n!==void 0&&!this.wn(n))return!1;const r=Fi(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const l=this.mn.getIterator().getNext();if(!s.has(l.field.canonicalString())){const c=r[i];if(!this.Sn(l,c)||!this.bn(this.fn[o++],c))return!1}++i}for(;i<r.length;++i){const l=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],l))return!1}return!0}Dn(){if(this.pn)return null;let e=new ot(xt.comparator);const n=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new _d(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new _d(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new _d(r.field,r.dir==="asc"?0:1)));return new uh(uh.UNKNOWN_ID,this.collectionId,n,kc.empty())}wn(e){for(const n of this.gn)if(this.Sn(n,e))return!0;return!1}Sn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}bn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NC(t){var n,r;if(ye(t instanceof Be||t instanceof st,20012),t instanceof Be){if(t instanceof YS){const s=((r=(n=t.value.arrayValue)==null?void 0:n.values)==null?void 0:r.map(i=>Be.create(t.field,"==",i)))||[];return st.create(s,"or")}return t}const e=t.filters.map(s=>NC(s));return st.create(e,t.op)}function iV(t){if(t.getFilters().length===0)return[];const e=vg(NC(t));return ye(AC(e),7391),gg(e)||yg(e)?[e]:e.getFilters()}function gg(t){return t instanceof Be}function yg(t){return t instanceof st&&Zy(t)}function AC(t){return gg(t)||yg(t)||function(n){if(n instanceof st&&lg(n)){for(const r of n.getFilters())if(!gg(r)&&!yg(r))return!1;return!0}return!1}(t)}function vg(t){if(ye(t instanceof Be||t instanceof st,34018),t instanceof Be)return t;if(t.filters.length===1)return vg(t.filters[0]);const e=t.filters.map(r=>vg(r));let n=st.create(e,t.op);return n=xh(n),AC(n)?n:(ye(n instanceof st,64498),ye(Ua(n),40251),ye(n.filters.length>1,57927),n.filters.reduce((r,s)=>lv(r,s)))}function lv(t,e){let n;return ye(t instanceof Be||t instanceof st,38388),ye(e instanceof Be||e instanceof st,25473),n=t instanceof Be?e instanceof Be?function(s,i){return st.create([s,i],"and")}(t,e):_E(t,e):e instanceof Be?_E(e,t):function(s,i){if(ye(s.filters.length>0&&i.filters.length>0,48005),Ua(s)&&Ua(i))return GS(s,i.getFilters());const o=lg(s)?s:i,l=lg(s)?i:s,c=o.filters.map(d=>lv(d,l));return st.create(c,"or")}(t,e),xh(n)}function _E(t,e){if(Ua(e))return GS(e,t.getFilters());{const n=e.filters.map(r=>lv(t,r));return st.create(n,"or")}}function xh(t){if(ye(t instanceof Be||t instanceof st,11850),t instanceof Be)return t;const e=t.getFilters();if(e.length===1)return xh(e[0]);if(HS(t))return t;const n=e.map(s=>xh(s)),r=[];return n.forEach(s=>{s instanceof Be?r.push(s):s instanceof st&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:st.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oV{constructor(){this.Cn=new cv}addToCollectionParentIndex(e,n){return this.Cn.add(n),V.resolve()}getCollectionParents(e,n){return V.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return V.resolve()}deleteFieldIndex(e,n){return V.resolve()}deleteAllFieldIndexes(e){return V.resolve()}createTargetIndexes(e,n){return V.resolve()}getDocumentsMatchingTarget(e,n){return V.resolve(null)}getIndexType(e,n){return V.resolve(0)}getFieldIndexes(e,n){return V.resolve([])}getNextCollectionGroupToUpdate(e){return V.resolve(null)}getMinOffset(e,n){return V.resolve(Qn.min())}getMinOffsetFromCollectionGroup(e,n){return V.resolve(Qn.min())}updateCollectionGroup(e,n,r){return V.resolve()}updateIndexEntries(e,n){return V.resolve()}}class cv{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new ot(Ye.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ot(Ye.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wE="IndexedDbIndexManager",Wu=new Uint8Array(0);class aV{constructor(e,n){this.databaseId=n,this.vn=new cv,this.Fn=new Ts(r=>go(r),(r,s)=>ru(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.vn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.vn.add(n)});const i={collectionId:r,parent:mn(s)};return xE(e).put(i)}return V.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[yS(n),""],!1,!0);return xE(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==n)break;r.push(qr(o.parent))}return r})}addFieldIndex(e,n){const r=Sl(e),s=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const o=Uo(e);return i.next(l=>{o.put(hE(l,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=Sl(e),s=Uo(e),i=Fo(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=Sl(e),r=Fo(e),s=Uo(e);return n.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,n){return V.forEach(this.Mn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new vE(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=Fo(e);let s=!0;const i=new Map;return V.forEach(this.Mn(n),o=>this.xn(e,o).next(l=>{s&&(s=!!l),i.set(o,l)})).next(()=>{if(s){let o=Ve();const l=[];return V.forEach(i,(c,d)=>{J(wE,`Using index ${function(E){return`id=${E.indexId}|cg=${E.collectionGroup}|f=${E.fields.map(I=>`${I.fieldPath}:${I.kind}`).join(",")}`}(c)} to execute ${go(n)}`);const f=function(E,I){const M=tg(I);if(M===void 0)return null;for(const $ of gh(E,M.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(d,c),h=function(E,I){const M=new Map;for(const $ of Fi(I))for(const b of gh(E,$.fieldPath))switch(b.op){case"==":case"in":M.set($.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return M.set($.fieldPath.canonicalString(),b.value),Array.from(M.values())}return null}(d,c),m=function(E,I){const M=[];let $=!0;for(const b of Fi(I)){const x=b.kind===0?Jx(E,b.fieldPath,E.startAt):Zx(E,b.fieldPath,E.startAt);M.push(x.value),$&&($=x.inclusive)}return new yi(M,$)}(d,c),v=function(E,I){const M=[];let $=!0;for(const b of Fi(I)){const x=b.kind===0?Zx(E,b.fieldPath,E.endAt):Jx(E,b.fieldPath,E.endAt);M.push(x.value),$&&($=x.inclusive)}return new yi(M,$)}(d,c),R=this.On(c,d,m),N=this.On(c,d,v),C=this.Nn(c,d,h),y=this.Bn(c.indexId,f,R,m.inclusive,N,v.inclusive,C);return V.forEach(y,w=>r.Y(w,n.limit).next(E=>{E.forEach(I=>{const M=oe.fromSegments(I.documentKey);o.has(M)||(o=o.add(M),l.push(M))})}))}).next(()=>l)}return V.resolve(null)})}Mn(e){let n=this.Fn.get(e);return n||(e.filters.length===0?n=[e]:n=iV(st.create(e.filters,"and")).map(r=>ug(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,n),n)}Bn(e,n,r,s,i,o,l){const c=(n!=null?n.length:1)*Math.max(r.length,i.length),d=c/(n!=null?n.length:1),f=[];for(let h=0;h<c;++h){const m=n?this.Ln(n[h/d]):Wu,v=this.kn(e,m,r[h%d],s),R=this.qn(e,m,i[h%d],o),N=l.map(C=>this.kn(e,m,C,!0));f.push(...this.createRange(v,R,N))}return f}kn(e,n,r,s){const i=new qi(e,oe.empty(),n,r);return s?i:i.An()}qn(e,n,r,s){const i=new qi(e,oe.empty(),n,r);return s?i.An():i}xn(e,n){const r=new vE(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const l of i)r.yn(l)&&(!o||l.fields.length>o.fields.length)&&(o=l);return o})}getIndexType(e,n){let r=2;const s=this.Mn(n);return V.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(c){let d=new ot(xt.comparator),f=!1;for(const h of c.filters)for(const m of h.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?f=!0:d=d.add(m.field));for(const h of c.orderBy)h.field.isKeyField()||(d=d.add(h.field));return d.size+(f?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(n)&&s.length>1&&r===2?1:r)}Qn(e,n){const r=new Tl;for(const s of Fi(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);zi.Kt.Dt(i,o)}return r.un()}Ln(e){const n=new Tl;return zi.Kt.Dt(e,n.Pn(0)),n.un()}$n(e,n){const r=new Tl;return zi.Kt.Dt(mo(this.databaseId,n),r.Pn(function(i){const o=Fi(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,n,r){if(r===null)return[];let s=[];s.push(new Tl);let i=0;for(const o of Fi(e)){const l=r[i++];for(const c of s)if(this.Un(n,o.fieldPath)&&Fc(l))s=this.Kn(s,o,l);else{const d=c.Pn(o.kind);zi.Kt.Dt(l,d)}}return this.Wn(s)}On(e,n,r){return this.Nn(e,n,r.position)}Wn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].un();return n}Kn(e,n,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const l of s){const c=new Tl;c.seed(l.un()),zi.Kt.Dt(o,c.Pn(n.kind)),i.push(c)}return i}Un(e,n){return!!e.filters.find(r=>r instanceof Be&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=Sl(e),s=Uo(e);return(n?r.J(rg,IDBKeyRange.bound(n,n)):r.J()).next(i=>{const o=[];return V.forEach(i,l=>s.get([l.indexId,this.uid]).next(c=>{o.push(function(f,h){const m=h?new kc(h.sequenceNumber,new Qn(_o(h.readTime),new oe(qr(h.documentKey)),h.largestBatchId)):kc.empty(),v=f.fields.map(([R,N])=>new _d(xt.fromServerFormat(R),N));return new uh(f.indexId,f.collectionGroup,v,m)}(l,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Re(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Sl(e),i=Uo(e);return this.Gn(e).next(o=>s.J(rg,IDBKeyRange.bound(n,n)).next(l=>V.forEach(l,c=>i.put(hE(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,n){const r=new Map;return V.forEach(n,(s,i)=>{const o=r.get(s.collectionGroup);return(o?V.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(l=>(r.set(s.collectionGroup,l),V.forEach(l,c=>this.zn(e,s,c).next(d=>{const f=this.jn(i,c);return d.isEqual(f)?V.resolve():this.Jn(e,i,c,d,f)}))))})}Hn(e,n,r,s){return Fo(e).put(s.Rn(this.uid,this.$n(r,n.key),n.key))}Yn(e,n,r,s){return Fo(e).delete(s.Vn(this.uid,this.$n(r,n.key),n.key))}zn(e,n,r){const s=Fo(e);let i=new ot(Os);return s.ee({index:NS,range:IDBKeyRange.only([r.indexId,this.uid,Cd(this.$n(r,n))])},(o,l)=>{i=i.add(new qi(r.indexId,n,yE(l.arrayValue),yE(l.directionalValue)))}).next(()=>i)}jn(e,n){let r=new ot(Os);const s=this.Qn(n,e);if(s==null)return r;const i=tg(n);if(i!=null){const o=e.data.field(i.fieldPath);if(Fc(o))for(const l of o.arrayValue.values||[])r=r.add(new qi(n.indexId,e.key,this.Ln(l),s))}else r=r.add(new qi(n.indexId,e.key,Wu,s));return r}Jn(e,n,r,s,i){J(wE,"Updating index entries for document '%s'",n.key);const o=[];return function(c,d,f,h,m){const v=c.getIterator(),R=d.getIterator();let N=Vo(v),C=Vo(R);for(;N||C;){let y=!1,w=!1;if(N&&C){const E=f(N,C);E<0?w=!0:E>0&&(y=!0)}else N!=null?w=!0:y=!0;y?(h(C),C=Vo(R)):w?(m(N),N=Vo(v)):(N=Vo(v),C=Vo(R))}}(s,i,Os,l=>{o.push(this.Hn(e,n,r,l))},l=>{o.push(this.Yn(e,n,r,l))}),V.waitFor(o)}Gn(e){let n=1;return Uo(e).ee({index:CS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((o,l)=>Os(o,l)).filter((o,l,c)=>!l||Os(o,c[l-1])!==0);const s=[];s.push(e);for(const o of r){const l=Os(o,e),c=Os(o,n);if(l===0)s[0]=e.An();else if(l>0&&c<0)s.push(o),s.push(o.An());else if(c>0)break}s.push(n);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const l=s[o].Vn(this.uid,Wu,oe.empty()),c=s[o+1].Vn(this.uid,Wu,oe.empty());i.push(IDBKeyRange.bound(l,c))}return i}Zn(e,n){return Os(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(EE)}getMinOffset(e,n){return V.mapArray(this.Mn(n),r=>this.xn(e,r).next(s=>s||he(44426))).next(EE)}}function xE(t){return Ht(t,Lc)}function Fo(t){return Ht(t,ic)}function Sl(t){return Ht(t,Ky)}function Uo(t){return Ht(t,sc)}function EE(t){ye(t.length!==0,28825);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;Hy(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new Qn(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},RC=41943040;class cn{static withCacheSize(e){return new cn(e,cn.DEFAULT_COLLECTION_PERCENTILE,cn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PC(t,e,n){const r=t.store(wr),s=t.store(Da),i=[],o=IDBKeyRange.only(n.batchId);let l=0;const c=r.ee({range:o},(f,h,m)=>(l++,m.delete()));i.push(c.next(()=>{ye(l===1,47070,{batchId:n.batchId})}));const d=[];for(const f of n.mutations){const h=IS(e,f.key.path,n.batchId);i.push(s.delete(h)),d.push(f.key)}return V.waitFor(i).next(()=>d)}function Eh(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw he(14731);e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */cn.DEFAULT_COLLECTION_PERCENTILE=10,cn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,cn.DEFAULT=new cn(RC,cn.DEFAULT_COLLECTION_PERCENTILE,cn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),cn.DISABLED=new cn(-1,0,0);class _f{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,n,r,s){ye(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new _f(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ls(e).ee({index:Qi,range:r},(s,i,o)=>{n=!1,o.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=Jo(e),o=Ls(e);return o.add({}).next(l=>{ye(typeof l=="number",49019);const c=new nv(l,n,r,s),d=function(v,R,N){const C=N.baseMutations.map(w=>_h(v.yt,w)),y=N.mutations.map(w=>_h(v.yt,w));return{userId:R,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:C,mutations:y}}(this.serializer,this.userId,c),f=[];let h=new ot((m,v)=>Re(m.canonicalString(),v.canonicalString()));for(const m of s){const v=IS(this.userId,m.key.path,l);h=h.add(m.key.path.popLast()),f.push(o.put(d)),f.push(i.put(v,DO))}return h.forEach(m=>{f.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Xn[l]=c.keys()}),V.waitFor(f).next(()=>c)})}lookupMutationBatch(e,n){return Ls(e).get(n).next(r=>r?(ye(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:n}),Bi(this.serializer,r)):null)}er(e,n){return this.Xn[n]?V.resolve(this.Xn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Xn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Ls(e).ee({index:Qi,range:s},(o,l,c)=>{l.userId===this.userId&&(ye(l.batchId>=r,47524,{tr:r}),i=Bi(this.serializer,l)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Zi;return Ls(e).ee({index:Qi,range:n,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,Zi],[this.userId,Number.POSITIVE_INFINITY]);return Ls(e).J(Qi,n).next(r=>r.map(s=>Bi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=wd(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return Jo(e).ee({range:s},(o,l,c)=>{const[d,f,h]=o,m=qr(f);if(d===this.userId&&n.path.isEqual(m))return Ls(e).get(h).next(v=>{if(!v)throw he(61480,{nr:o,batchId:h});ye(v.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:v.userId,batchId:h}),i.push(Bi(this.serializer,v))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ot(Re);const s=[];return n.forEach(i=>{const o=wd(this.userId,i.path),l=IDBKeyRange.lowerBound(o),c=Jo(e).ee({range:l},(d,f,h)=>{const[m,v,R]=d,N=qr(v);m===this.userId&&i.path.isEqual(N)?r=r.add(R):h.done()});s.push(c)}),V.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=wd(this.userId,r),o=IDBKeyRange.lowerBound(i);let l=new ot(Re);return Jo(e).ee({range:o},(c,d,f)=>{const[h,m,v]=c,R=qr(m);h===this.userId&&r.isPrefixOf(R)?R.length===s&&(l=l.add(v)):f.done()}).next(()=>this.rr(e,l))}rr(e,n){const r=[],s=[];return n.forEach(i=>{s.push(Ls(e).get(i).next(o=>{if(o===null)throw he(35274,{batchId:i});ye(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(Bi(this.serializer,o))}))}),V.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return PC(e.le,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.ir(n.batchId)}),V.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return V.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Jo(e).ee({range:r},(i,o,l)=>{if(i[0]===this.userId){const c=qr(i[1]);s.push(c)}else l.done()}).next(()=>{ye(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,n){return kC(e,this.userId,n)}_r(e){return jC(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:Zi,lastStreamToken:""})}}function kC(t,e,n){const r=wd(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Jo(t).ee({range:i,X:!0},(l,c,d)=>{const[f,h,m]=l;f===e&&h===s&&(o=!0),d.done()}).next(()=>o)}function Ls(t){return Ht(t,wr)}function Jo(t){return Ht(t,Da)}function jC(t){return Ht(t,Dc)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wo{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new wo(0)}static cr(){return new wo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lV{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.lr(e).next(n=>{const r=new wo(n.highestTargetId);return n.highestTargetId=r.next(),this.hr(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(n=>_e.fromTimestamp(new qe(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.hr(e,s)))}addTargetData(e,n){return this.Pr(e,n).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(n,r),this.hr(e,r))))}updateTargetData(e,n){return this.Pr(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>$o(e).delete(n.targetId)).next(()=>this.lr(e)).next(r=>(ye(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return $o(e).ee((o,l)=>{const c=$l(l);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>V.waitFor(i)).next(()=>s)}forEachTarget(e,n){return $o(e).ee((r,s)=>{const i=$l(s);n(i)})}lr(e){return IE(e).get(fh).next(n=>(ye(n!==null,2888),n))}hr(e,n){return IE(e).put(fh,n)}Pr(e,n){return $o(e).put(SC(this.serializer,n))}Tr(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(n=>n.targetCount)}getTargetData(e,n){const r=go(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return $o(e).ee({range:s,index:SS},(o,l,c)=>{const d=$l(l);ru(n,d.target)&&(i=d,c.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=Ks(e);return n.forEach(o=>{const l=mn(o.path);s.push(i.put({targetId:r,path:l})),s.push(this.referenceDelegate.addReference(e,r,o))}),V.waitFor(s)}removeMatchingKeys(e,n,r){const s=Ks(e);return V.forEach(n,i=>{const o=mn(i.path);return V.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=Ks(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=Ks(e);let i=Ve();return s.ee({range:r,X:!0},(o,l,c)=>{const d=qr(o[1]),f=new oe(d);i=i.add(f)}).next(()=>i)}containsKey(e,n){const r=mn(n.path),s=IDBKeyRange.bound([r],[yS(r)],!1,!0);let i=0;return Ks(e).ee({index:Gy,X:!0,range:s},([o,l],c,d)=>{o!==0&&(i++,d.done())}).next(()=>i>0)}At(e,n){return $o(e).get(n).next(r=>r?$l(r):null)}}function $o(t){return Ht(t,Oa)}function IE(t){return Ht(t,eo)}function Ks(t){return Ht(t,La)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TE="LruGarbageCollector",cV=1048576;function SE([t,e],[n,r]){const s=Re(t,n);return s===0?Re(e,r):s}class uV{constructor(e){this.Ir=e,this.buffer=new ot(SE),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();SE(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class DC{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){J(TE,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Si(n)?J(TE,"Ignoring IndexedDB error during garbage collection: ",n):await Ro(n)}await this.Vr(3e5)})}}class dV{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return V.resolve(or.ce);const r=new uV(n);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(J("LruGarbageCollector","Garbage collection skipped; disabled"),V.resolve(bE)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(J("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),bE):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,i,o,l,c,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(J("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,l=Date.now(),this.removeTargets(e,r,n))).next(h=>(i=h,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(d=Date.now(),Qo()<=$e.DEBUG&&J("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${s} in `+(l-o)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${h} documents in `+(d-c)+`ms
Total Duration: ${d-f}ms`),V.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function OC(t,e){return new dV(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hV{constructor(e,n){this.db=e,this.garbageCollector=OC(this,n)}gr(e){const n=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}pr(e,n){return this.Sr(e,(r,s)=>n(s))}addReference(e,n,r){return Gu(e,r)}removeReference(e,n,r){return Gu(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Gu(e,n)}br(e,n){return function(s,i){let o=!1;return jC(s).te(l=>kC(s,l,i).next(c=>(c&&(o=!0),V.resolve(!c)))).next(()=>o)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,l)=>{if(l<=n){const c=this.br(e,o).next(d=>{if(!d)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,_e.min()),Ks(e).delete(function(h){return[0,mn(h.path)]}(o))))});s.push(c)}}).next(()=>V.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Gu(e,n)}Sr(e,n){const r=Ks(e);let s,i=or.ce;return r.ee({index:Gy},([o,l],{path:c,sequenceNumber:d})=>{o===0?(i!==or.ce&&n(new oe(qr(s)),i),i=d,s=c):i=or.ce}).next(()=>{i!==or.ce&&n(new oe(qr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Gu(t,e){return Ks(t).put(function(r,s){return{targetId:0,path:mn(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LC{constructor(){this.changes=new Ts(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Ct.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?V.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return Di(e).put(r)}removeEntry(e,n,r){return Di(e).delete(function(i,o){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],wh(o),l[l.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Dr(e,r)))}getEntry(e,n){let r=Ct.newInvalidDocument(n);return Di(e).ee({index:xd,range:IDBKeyRange.only(Cl(n))},(s,i)=>{r=this.Cr(n,i)}).next(()=>r)}vr(e,n){let r={size:0,document:Ct.newInvalidDocument(n)};return Di(e).ee({index:xd,range:IDBKeyRange.only(Cl(n))},(s,i)=>{r={document:this.Cr(n,i),size:Eh(i)}}).next(()=>r)}getEntries(e,n){let r=Hn();return this.Fr(e,n,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,n){let r=Hn(),s=new vt(oe.comparator);return this.Fr(e,n,(i,o)=>{const l=this.Cr(i,o);r=r.insert(i,l),s=s.insert(i,Eh(o))}).next(()=>({documents:r,Or:s}))}Fr(e,n,r){if(n.isEmpty())return V.resolve();let s=new ot(AE);n.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(Cl(s.first()),Cl(s.last())),o=s.getIterator();let l=o.getNext();return Di(e).ee({index:xd,range:i},(c,d,f)=>{const h=oe.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;l&&AE(l,h)<0;)r(l,null),l=o.getNext();l&&l.isEqual(h)&&(r(l,d),l=o.hasNext()?o.getNext():null),l?f.j(Cl(l)):f.done()}).next(()=>{for(;l;)r(l,null),l=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const o=n.path,l=[o.popLast().toArray(),o.lastSegment(),wh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Di(e).J(IDBKeyRange.bound(l,c,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let f=Hn();for(const h of d){const m=this.Cr(oe.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);m.isFoundDocument()&&(iu(n,m)||s.has(m.key))&&(f=f.insert(m.key,m))}return f})}getAllFromCollectionGroup(e,n,r,s){let i=Hn();const o=NE(n,r),l=NE(n,Qn.max());return Di(e).ee({index:TS,range:IDBKeyRange.bound(o,l,!0)},(c,d,f)=>{const h=this.Cr(oe.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(h.key,h),i.size===s&&f.done()}).next(()=>i)}newChangeBuffer(e){return new pV(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return CE(e).get(ng).next(n=>(ye(!!n,20021),n))}Dr(e,n){return CE(e).put(ng,n)}Cr(e,n){if(n){const r=JL(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(_e.min())))return r}return Ct.newInvalidDocument(e)}}function VC(t){return new fV(t)}class pV extends LC{constructor(e,n){super(),this.Nr=e,this.trackRemovals=n,this.Br=new Ts(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new ot((i,o)=>Re(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const l=this.Br.get(i);if(n.push(this.Nr.removeEntry(e,i,l.readTime)),o.isValidDocument()){const c=uE(this.Nr.serializer,o);s=s.add(i.path.popLast());const d=Eh(c);r+=d-l.size,n.push(this.Nr.addEntry(e,i,c))}else if(r-=l.size,this.trackRemovals){const c=uE(this.Nr.serializer,o.convertToNoDocument(_e.min()));n.push(this.Nr.addEntry(e,i,c))}}),s.forEach(i=>{n.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.Nr.updateMetadata(e,r)),V.waitFor(n)}getFromCache(e,n){return this.Nr.vr(e,n).next(r=>(this.Br.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Nr.Mr(e,n).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function CE(t){return Ht(t,Oc)}function Di(t){return Ht(t,hh)}function Cl(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function NE(t,e){const n=e.documentKey.path.toArray();return[t,wh(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function AE(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=Re(n[i],r[i]),s)return s;return s=Re(n.length,r.length),s||(s=Re(n[n.length-2],r[r.length-2]),s||Re(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mV{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&lc(r.mutation,s,jn.empty(),qe.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ve()){const s=Hr();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let o=Fl();return i.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=Hr();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ve()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,l)=>{n.set(o,l)})})}computeViews(e,n,r,s){let i=Hn();const o=ac(),l=function(){return ac()}();return n.forEach((c,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof Ss)?i=i.insert(d.key,d):f!==void 0?(o.set(d.key,f.mutation.getFieldMask()),lc(f.mutation,d,f.mutation.getFieldMask(),qe.now())):o.set(d.key,jn.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,f)=>o.set(d,f)),n.forEach((d,f)=>l.set(d,new mV(f,o.get(d)??null))),l))}recalculateAndSaveOverlays(e,n){const r=ac();let s=new vt((o,l)=>o-l),i=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const l of o)l.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let f=r.get(c)||jn.empty();f=l.applyToLocalView(d,f),r.set(c,f);const h=(s.get(l.batchId)||Ve()).add(c);s=s.insert(l.batchId,h)})}).next(()=>{const o=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,f=c.value,h=nC();f.forEach(m=>{if(!i.has(m)){const v=cC(n.get(m),r.get(m));v!==null&&h.set(m,v),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,h))}return V.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return oe.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):ev(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):V.resolve(Hr());let l=Pc,c=i;return o.next(d=>V.forEach(d,(f,h)=>(l<h.largestBatchId&&(l=h.largestBatchId),i.get(f)?V.resolve():this.remoteDocumentCache.getEntry(e,f).next(m=>{c=c.insert(f,m)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,Ve())).next(f=>({batchId:l,changes:tC(f)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new oe(n)).next(r=>{let s=Fl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let o=Fl();return this.indexManager.getCollectionParents(e,i).next(l=>V.forEach(l,c=>{const d=function(h,m){return new Ni(m,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(f=>{f.forEach((h,m)=>{o=o.insert(h,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(o=>{i.forEach((c,d)=>{const f=d.getKey();o.get(f)===null&&(o=o.insert(f,Ct.newInvalidDocument(f)))});let l=Fl();return o.forEach((c,d)=>{const f=i.get(c);f!==void 0&&lc(f.mutation,d,jn.empty(),qe.now()),iu(n,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gV{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return V.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:In(s.createTime)}}(n)),V.resolve()}getNamedQuery(e,n){return V.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(s){return{name:s.name,query:CC(s.bundledQuery),readTime:In(s.readTime)}}(n)),V.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yV{constructor(){this.overlays=new vt(oe.comparator),this.qr=new Map}getOverlay(e,n){return V.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Hr();return V.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.St(e,n,i)}),V.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),V.resolve()}getOverlaysForCollection(e,n,r){const s=Hr(),i=n.length+1,o=new oe(n.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return V.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new vt((d,f)=>d-f);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=Hr(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Hr(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>l.set(d,f)),!(l.size()>=s)););return V.resolve(l)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new sv(n,r));let i=this.qr.get(n);i===void 0&&(i=Ve(),this.qr.set(n,i)),this.qr.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vV{constructor(){this.sessionToken=Ut.EMPTY_BYTE_STRING}getSessionToken(e){return V.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,V.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(){this.Qr=new ot(Yt.$r),this.Ur=new ot(Yt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Yt(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new Yt(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new oe(new Ye([])),r=new Yt(n,e),s=new Yt(n,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new oe(new Ye([])),r=new Yt(n,e),s=new Yt(n,e+1);let i=Ve();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new Yt(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Yt{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return oe.comparator(e.key,n.key)||Re(e.Yr,n.Yr)}static Kr(e,n){return Re(e.Yr,n.Yr)||oe.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new ot(Yt.$r)}checkEmpty(e){return V.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new nv(i,n,r,s);this.mutationQueue.push(o);for(const l of s)this.Zr=this.Zr.add(new Yt(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return V.resolve(o)}lookupMutationBatch(e,n){return V.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),i=s<0?0:s;return V.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return V.resolve(this.mutationQueue.length===0?Zi:this.tr-1)}getAllMutationBatches(e){return V.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Yt(n,0),s=new Yt(n,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const l=this.Xr(o.Yr);i.push(l)}),V.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ot(Re);return n.forEach(s=>{const i=new Yt(s,0),o=new Yt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],l=>{r=r.add(l.Yr)})}),V.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;oe.isDocumentKey(i)||(i=i.child(""));const o=new Yt(new oe(i),0);let l=new ot(Re);return this.Zr.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.Yr)),!0)},o),V.resolve(this.ti(l))}ti(e){const n=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){ye(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return V.forEach(n.mutations,s=>{const i=new Yt(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new Yt(n,0),s=this.Zr.firstAfterOrEqual(r);return V.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,V.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(e){this.ri=e,this.docs=function(){return new vt(oe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return V.resolve(r?r.document.mutableCopy():Ct.newInvalidDocument(n))}getEntries(e,n){let r=Hn();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ct.newInvalidDocument(s))}),V.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=Hn();const o=n.path,l=new oe(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:f}}=c.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||Hy(wS(f),r)<=0||(s.has(f.key)||iu(n,f))&&(i=i.insert(f.key,f.mutableCopy()))}return V.resolve(i)}getAllFromCollectionGroup(e,n,r,s){he(9500)}ii(e,n){return V.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new xV(this)}getSize(e){return V.resolve(this.size)}}class xV extends LC{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),V.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EV{constructor(e){this.persistence=e,this.si=new Ts(n=>go(n),ru),this.lastRemoteSnapshotVersion=_e.min(),this.highestTargetId=0,this.oi=0,this._i=new uv,this.targetCount=0,this.ai=wo.ur()}forEachTarget(e,n){return this.si.forEach((r,s)=>n(s)),V.resolve()}getLastRemoteSnapshotVersion(e){return V.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return V.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),V.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),V.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new wo(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,V.resolve()}updateTargetData(e,n){return this.Pr(n),V.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,V.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.si.forEach((o,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),V.waitFor(i).next(()=>s)}getTargetCount(e){return V.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return V.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),V.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),V.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),V.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return V.resolve(r)}containsKey(e,n){return V.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,n){this.ui={},this.overlays={},this.ci=new or(0),this.li=!1,this.li=!0,this.hi=new vV,this.referenceDelegate=e(this),this.Pi=new EV(this),this.indexManager=new oV,this.remoteDocumentCache=function(s){return new wV(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new TC(n),this.Ii=new gV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new yV,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new _V(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){J("MemoryPersistence","Starting transaction:",e);const s=new bV(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,n){return V.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class bV extends ES{constructor(e){super(),this.currentSequenceNumber=e}}class wf{constructor(e){this.persistence=e,this.Ri=new uv,this.Vi=null}static mi(e){return new wf(e)}get fi(){if(this.Vi)return this.Vi;throw he(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),V.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),V.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),V.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return V.forEach(this.fi,r=>{const s=oe.fromPath(r);return this.gi(e,s).next(i=>{i||n.removeEntry(s,_e.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return V.or([()=>V.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class bh{constructor(e,n){this.persistence=e,this.pi=new Ts(r=>mn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=OC(this,n)}static mi(e,n){return new bh(e,n)}Ei(){}di(e){return V.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return V.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?V.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,n).next(l=>{l||(r++,i.removeEntry(o,_e.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),V.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),V.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),V.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=bd(e.data.value)),n}br(e,n,r){return V.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return V.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IV{constructor(e){this.serializer=e}k(e,n,r,s){const i=new rf("createOrUpgrade",n);r<1&&s>=1&&(function(c){c.createObjectStore(nu)}(e),function(c){c.createObjectStore(Dc,{keyPath:jO}),c.createObjectStore(wr,{keyPath:Ux,autoIncrement:!0}).createIndex(Qi,$x,{unique:!0}),c.createObjectStore(Da)}(e),RE(e),function(c){c.createObjectStore(Ui)}(e));let o=V.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore(La),c.deleteObjectStore(Oa),c.deleteObjectStore(eo)}(e),RE(e)),o=o.next(()=>function(c){const d=c.store(eo),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:_e.min().toTimestamp(),targetCount:0};return d.put(fh,f)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(c,d){return d.store(wr).J().next(h=>{c.deleteObjectStore(wr),c.createObjectStore(wr,{keyPath:Ux,autoIncrement:!0}).createIndex(Qi,$x,{unique:!0});const m=d.store(wr),v=h.map(R=>m.put(R));return V.waitFor(v)})}(e,i))),o=o.next(()=>{(function(c){c.createObjectStore(Va,{keyPath:BO})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(c){c.createObjectStore(Oc)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(of,{keyPath:zO})})(e),function(c){c.createObjectStore(af,{keyPath:qO})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(c){const d=c.createObjectStore(lf,{keyPath:XO});d.createIndex(sg,JO,{unique:!1}),d.createIndex(AS,ZO,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(c){const d=c.createObjectStore(hh,{keyPath:OO});d.createIndex(xd,LO),d.createIndex(TS,VO)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Ui))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(c){c.createObjectStore(Ky,{keyPath:HO,autoIncrement:!0}).createIndex(rg,WO,{unique:!1}),c.createObjectStore(sc,{keyPath:GO}).createIndex(CS,KO,{unique:!1}),c.createObjectStore(ic,{keyPath:QO}).createIndex(NS,YO,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{n.objectStore(sc).clear()}).next(()=>{n.objectStore(ic).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(Qy,{keyPath:eL})})(e)})),r<18&&s>=18&&xT()&&(o=o.next(()=>{n.objectStore(sc).clear()}).next(()=>{n.objectStore(ic).clear()})),o}wi(e){let n=0;return e.store(Ui).ee((r,s)=>{n+=Eh(s)}).next(()=>{const r={byteSize:n};return e.store(Oc).put(ng,r)})}yi(e){const n=e.store(Dc),r=e.store(wr);return n.J().next(s=>V.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,Zi],[i.userId,i.lastAcknowledgedBatchId]);return r.J(Qi,o).next(l=>V.forEach(l,c=>{ye(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const d=Bi(this.serializer,c);return PC(e,i.userId,d).next(()=>{})}))}))}Si(e){const n=e.store(La),r=e.store(Ui);return e.store(eo).get(fh).next(s=>{const i=[];return r.ee((o,l)=>{const c=new Ye(o),d=function(h){return[0,mn(h)]}(c);i.push(n.get(d).next(f=>f?V.resolve():(h=>n.put({targetId:0,path:mn(h),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>V.waitFor(i))})}bi(e,n){e.createObjectStore(Lc,{keyPath:$O});const r=n.store(Lc),s=new cv,i=o=>{if(s.add(o)){const l=o.lastSegment(),c=o.popLast();return r.put({collectionId:l,parent:mn(c)})}};return n.store(Ui).ee({X:!0},(o,l)=>{const c=new Ye(o);return i(c.popLast())}).next(()=>n.store(Da).ee({X:!0},([o,l,c],d)=>{const f=qr(l);return i(f.popLast())}))}Di(e){const n=e.store(Oa);return n.ee((r,s)=>{const i=$l(s),o=SC(this.serializer,i);return n.put(o)})}Ci(e,n){const r=n.store(Ui),s=[];return r.ee((i,o)=>{const l=n.store(hh),c=function(h){return h.document?new oe(Ye.fromString(h.document.name).popFirst(5)):h.noDocument?oe.fromSegments(h.noDocument.path):h.unknownDocument?oe.fromSegments(h.unknownDocument.path):he(36783)}(o).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(l.put(d))}).next(()=>V.waitFor(s))}Fi(e,n){const r=n.store(wr),s=VC(this.serializer),i=new dv(wf.mi,this.serializer.yt);return r.J().next(o=>{const l=new Map;return o.forEach(c=>{let d=l.get(c.userId)??Ve();Bi(this.serializer,c).keys().forEach(f=>d=d.add(f)),l.set(c.userId,d)}),V.forEach(l,(c,d)=>{const f=new tn(d),h=vf.wt(this.serializer,f),m=i.getIndexManager(f),v=_f.wt(f,this.serializer,m,i.referenceDelegate);return new MC(s,v,h,m).recalculateAndSaveOverlaysForDocumentKeys(new ig(n,or.ce),c).next()})})}}function RE(t){t.createObjectStore(La,{keyPath:FO}).createIndex(Gy,UO,{unique:!0}),t.createObjectStore(Oa,{keyPath:"targetId"}).createIndex(SS,MO,{unique:!0}),t.createObjectStore(eo)}const Vs="IndexedDbPersistence",Rp=18e5,Pp=5e3,kp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",TV="main";class hv{constructor(e,n,r,s,i,o,l,c,d,f,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Mi=i,this.window=o,this.document=l,this.xi=d,this.Oi=f,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=m=>Promise.resolve(),!hv.v())throw new ee(q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new hV(this,s),this.$i=n+TV,this.serializer=new TC(c),this.Ui=new di(this.$i,this.Ni,new IV(this.serializer)),this.hi=new eV,this.Pi=new lV(this.referenceDelegate,this.serializer),this.remoteDocumentCache=VC(this.serializer),this.Ii=new ZL,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&wn(Vs,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ee(q.FAILED_PRECONDITION,kp);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new or(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ku(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(n=>{n||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(n=>this.isPrimary&&!n?this.Zi(e).next(()=>!1):!!n&&this.Xi(e).next(()=>!0))).catch(e=>{if(Si(e))return J(Vs,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return J(Vs,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Nl(e).get(Lo).next(n=>V.resolve(this.es(n)))}ts(e){return Ku(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Rp)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=Ht(n,Va);return r.J().next(s=>{const i=this.ss(s,Rp),o=s.filter(l=>i.indexOf(l)===-1);return V.forEach(o,l=>r.delete(l.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const n of e)this.Ki.removeItem(this._s(n.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?V.resolve(!0):Nl(e).get(Lo).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,Pp)&&!this.us(n.ownerId)){if(this.es(n)&&this.networkEnabled)return!0;if(!this.es(n)){if(!n.allowTabSynchronization)throw new ee(q.FAILED_PRECONDITION,kp);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ku(e).J().next(r=>this.ss(r,Pp).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,l=this.networkEnabled===s.networkEnabled;if(i||o&&l)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&J(Vs,`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[nu,Va],e=>{const n=new ig(e,or.ce);return this.Zi(n).next(()=>this.ts(n))}),this.Ui.close(),this.Ps()}ss(e,n){return e.filter(r=>this.rs(r.updateTimeMs,n)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Ku(e).J().next(n=>this.ss(n,Rp).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,n){return _f.wt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new aV(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return vf.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,n,r){J(Vs,"Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(c){return c===18?rL:c===17?jS:c===16?nL:c===15?Yy:c===14?kS:c===13?PS:c===12?tL:c===11?RS:void he(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,l=>(o=new ig(l,this.ci?this.ci.next():or.ce),n==="readwrite-primary"?this.Hi(o).next(c=>!!c||this.Yi(o)).next(c=>{if(!c)throw wn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new ee(q.FAILED_PRECONDITION,xS);return r(o)}).next(c=>this.Xi(o).next(()=>c)):this.Is(o).next(()=>r(o)))).then(l=>(o.raiseOnCommittedEvent(),l))}Is(e){return Nl(e).get(Lo).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,Pp)&&!this.us(n.ownerId)&&!this.es(n)&&!(this.Oi||this.allowTabSynchronization&&n.allowTabSynchronization))throw new ee(q.FAILED_PRECONDITION,kp)})}Xi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Nl(e).put(Lo,n)}static v(){return di.v()}Zi(e){const n=Nl(e);return n.get(Lo).next(r=>this.es(r)?(J(Vs,"Releasing primary lease."),n.delete(Lo)):V.resolve())}rs(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(wn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const n=/(?:Version|Mobile)\/1[456]/;wT()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var n;try{const r=((n=this.Ki)==null?void 0:n.getItem(this._s(e)))!==null;return J(Vs,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return wn(Vs,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){wn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Nl(t){return Ht(t,nu)}function Ku(t){return Ht(t,Va)}function SV(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=Ve(),s=Ve();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new fv(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return wT()?8:bS(qt())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.ys(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new CV;return this.Ss(e,n,o).next(l=>{if(i.result=l,this.Vs)return this.bs(e,n,o,l.size)})}).next(()=>i.result)}bs(e,n,r,s){return r.documentReadCount<this.fs?(Qo()<=$e.DEBUG&&J("QueryEngine","SDK will not create cache indexes for query:",Yo(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),V.resolve()):(Qo()<=$e.DEBUG&&J("QueryEngine","Query:",Yo(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Qo()<=$e.DEBUG&&J("QueryEngine","The SDK decides to create cache indexes for query:",Yo(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,lr(n))):V.resolve())}ys(e,n){if(eE(n))return V.resolve(null);let r=lr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=yh(n,null,"F"),r=lr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ve(...i);return this.ps.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.Ds(n,l);return this.Cs(n,d,o,c.readTime)?this.ys(e,yh(n,null,"F")):this.vs(e,d,n,c)}))})))}ws(e,n,r,s){return eE(n)||s.isEqual(_e.min())?V.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(n,i);return this.Cs(n,o,r,s)?V.resolve(null):(Qo()<=$e.DEBUG&&J("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Yo(n)),this.vs(e,o,n,SO(s,Pc)).next(l=>l))})}Ds(e,n){let r=new ot(ZS(e));return n.forEach((s,i)=>{iu(e,i)&&(r=r.add(i))}),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,n,r){return Qo()<=$e.DEBUG&&J("QueryEngine","Using full collection scan to execute query:",Yo(n)),this.ps.getDocumentsMatchingQuery(e,n,Qn.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pv="LocalStore",NV=3e8;class AV{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new vt(Re),this.xs=new Ts(i=>go(i),ru),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new MC(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function UC(t,e,n,r){return new AV(t,e,n,r)}async function $C(t,e){const n=Ce(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],l=[];let c=Ve();for(const d of s){o.push(d.batchId);for(const f of d.mutations)c=c.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)c=c.add(f.key)}return n.localDocuments.getDocuments(r,c).next(d=>({Ls:d,removedBatchIds:o,addedBatchIds:l}))})})}function RV(t,e){const n=Ce(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(l,c,d,f){const h=d.batch,m=h.keys();let v=V.resolve();return m.forEach(R=>{v=v.next(()=>f.getEntry(c,R)).next(N=>{const C=d.docVersions.get(R);ye(C!==null,48541),N.version.compareTo(C)<0&&(h.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),f.addEntry(N)))})}),v.next(()=>l.mutationQueue.removeMutationBatch(c,h))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=Ve();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function BC(t){const e=Ce(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function PV(t,e){const n=Ce(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const l=[];e.targetChanges.forEach((f,h)=>{const m=s.get(h);if(!m)return;l.push(n.Pi.removeMatchingKeys(i,f.removedDocuments,h).next(()=>n.Pi.addMatchingKeys(i,f.addedDocuments,h)));let v=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?v=v.withResumeToken(Ut.EMPTY_BYTE_STRING,_e.min()).withLastLimboFreeSnapshotVersion(_e.min()):f.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(f.resumeToken,r)),s=s.insert(h,v),function(N,C,y){return N.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=NV?!0:y.addedDocuments.size+y.modifiedDocuments.size+y.removedDocuments.size>0}(m,v,f)&&l.push(n.Pi.updateTargetData(i,v))});let c=Hn(),d=Ve();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,f))}),l.push(kV(i,o,e.documentUpdates).next(f=>{c=f.ks,d=f.qs})),!r.isEqual(_e.min())){const f=n.Pi.getLastRemoteSnapshotVersion(i).next(h=>n.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(f)}return V.waitFor(l).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(n.Ms=s,i))}function kV(t,e,n){let r=Ve(),s=Ve();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let o=Hn();return n.forEach((l,c)=>{const d=i.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(_e.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):J(pv,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{ks:o,qs:s}})}function jV(t,e){const n=Ce(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Zi),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function DV(t,e){const n=Ce(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Pi.getTargetData(r,e).next(i=>i?(s=i,V.resolve(s)):n.Pi.allocateTargetId(r).next(o=>(s=new us(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r})}async function _g(t,e,n){const r=Ce(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Si(o))throw o;J(pv,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function PE(t,e,n){const r=Ce(t);let s=_e.min(),i=Ve();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,d,f){const h=Ce(c),m=h.xs.get(f);return m!==void 0?V.resolve(h.Ms.get(m)):h.Pi.getTargetData(d,f)}(r,o,lr(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,l.targetId).next(c=>{i=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,n?s:_e.min(),n?i:Ve())).next(l=>(OV(r,_L(e),l),{documents:l,Qs:i})))}function OV(t,e,n){let r=t.Os.get(e)||_e.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.Os.set(e,r)}class kE{constructor(){this.activeTargetIds=TL()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class zC{constructor(){this.Mo=new kE,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new kE,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jE="ConnectivityMonitor";class DE{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){J(jE,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){J(jE,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qu=null;function wg(){return Qu===null?Qu=function(){return 268435456+Math.round(2147483648*Math.random())}():Qu++,"0x"+Qu.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jp="RestConnection",VV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class MV{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===ph?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,i){const o=wg(),l=this.zo(e,n.toUriEncodedString());J(jp,`Sending RPC '${e}' ${o}:`,l,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:d}=new URL(l),f=bi(d);return this.Jo(e,l,c,r,f).then(h=>(J(jp,`Received RPC '${e}' ${o}: `,h),h),h=>{throw fo(jp,`RPC '${e}' ${o} failed with error: `,h,"url: ",l,"request:",r),h})}Ho(e,n,r,s,i,o){return this.Go(e,n,r,s,i)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+el}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,n){const r=VV[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FV{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ln="WebChannelConnection";class UV extends MV{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,i){const o=wg();return new Promise((l,c)=>{const d=new uS;d.setWithCredentials(!0),d.listenOnce(dS.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case vd.NO_ERROR:const h=d.getResponseJson();J(ln,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),l(h);break;case vd.TIMEOUT:J(ln,`RPC '${e}' ${o} timed out`),c(new ee(q.DEADLINE_EXCEEDED,"Request time out"));break;case vd.HTTP_ERROR:const m=d.getStatus();if(J(ln,`RPC '${e}' ${o} failed with status:`,m,"response text:",d.getResponseText()),m>0){let v=d.getResponseJson();Array.isArray(v)&&(v=v[0]);const R=v==null?void 0:v.error;if(R&&R.status&&R.message){const N=function(y){const w=y.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(w)>=0?w:q.UNKNOWN}(R.status);c(new ee(N,R.message))}else c(new ee(q.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new ee(q.UNAVAILABLE,"Connection failed."));break;default:he(9055,{l_:e,streamId:o,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{J(ln,`RPC '${e}' ${o} completed.`)}});const f=JSON.stringify(s);J(ln,`RPC '${e}' ${o} sending request:`,s),d.send(n,"POST",f,r,15)})}T_(e,n,r){const s=wg(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=pS(),l=fS(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const f=i.join("");J(ln,`Creating RPC '${e}' stream ${s}: ${f}`,c);const h=o.createWebChannel(f,c);this.I_(h);let m=!1,v=!1;const R=new FV({Yo:C=>{v?J(ln,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(m||(J(ln,`Opening RPC '${e}' stream ${s} transport.`),h.open(),m=!0),J(ln,`RPC '${e}' stream ${s} sending:`,C),h.send(C))},Zo:()=>h.close()}),N=(C,y,w)=>{C.listen(y,E=>{try{w(E)}catch(I){setTimeout(()=>{throw I},0)}})};return N(h,Ml.EventType.OPEN,()=>{v||(J(ln,`RPC '${e}' stream ${s} transport opened.`),R.o_())}),N(h,Ml.EventType.CLOSE,()=>{v||(v=!0,J(ln,`RPC '${e}' stream ${s} transport closed`),R.a_(),this.E_(h))}),N(h,Ml.EventType.ERROR,C=>{v||(v=!0,fo(ln,`RPC '${e}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),R.a_(new ee(q.UNAVAILABLE,"The operation could not be completed")))}),N(h,Ml.EventType.MESSAGE,C=>{var y;if(!v){const w=C.data[0];ye(!!w,16349);const E=w,I=(E==null?void 0:E.error)||((y=E[0])==null?void 0:y.error);if(I){J(ln,`RPC '${e}' stream ${s} received error:`,I);const M=I.status;let $=function(_){const P=Vt[_];if(P!==void 0)return hC(P)}(M),b=I.message;$===void 0&&($=q.INTERNAL,b="Unknown error status: "+M+" with message "+I.message),v=!0,R.a_(new ee($,b)),h.close()}else J(ln,`RPC '${e}' stream ${s} received:`,w),R.u_(w)}}),N(l,hS.STAT_EVENT,C=>{C.stat===Zm.PROXY?J(ln,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===Zm.NOPROXY&&J(ln,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{R.__()},0),R}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $V(){return typeof window<"u"?window:null}function Nd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xf(t){return new $L(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e,n,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&J("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE="PersistentStream";class HC{constructor(e,n,r,s,i,o,l,c){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new qC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===q.RESOURCE_EXHAUSTED?(wn(n.toString()),wn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===n&&this.G_(r,s)},r=>{e(()=>{const s=new ee(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return J(OE,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(J(OE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class BV extends HC{constructor(e,n,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=qL(this.serializer,e),r=function(i){if(!("targetChange"in i))return _e.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?_e.min():o.readTime?In(o.readTime):_e.min()}(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=pg(this.serializer),n.addTarget=function(i,o){let l;const c=o.target;if(l=mh(c)?{documents:wC(i,c)}:{query:av(i,c).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=mC(i,o.resumeToken);const d=hg(i,o.expectedCount);d!==null&&(l.expectedCount=d)}else if(o.snapshotVersion.compareTo(_e.min())>0){l.readTime=qa(i,o.snapshotVersion.toTimestamp());const d=hg(i,o.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=GL(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=pg(this.serializer),n.removeTarget=e,this.q_(n)}}class zV extends HC{constructor(e,n,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return ye(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ye(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ye(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=HL(e.writeResults,e.commitTime),r=In(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=pg(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>_h(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qV{}class HV extends qV{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new ee(q.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,fg(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ee(q.UNKNOWN,i.toString())})}Ho(e,n,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Ho(e,fg(n,r),s,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ee(q.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class WV{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(wn(n),this.aa=!1):J("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xo="RemoteStore";class GV{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Po(this)&&(J(xo,"Restarting streams for network reachability change."),await async function(c){const d=Ce(c);d.Ea.add(4),await au(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Ef(d)}(this))})}),this.Ra=new WV(r,s)}}async function Ef(t){if(Po(t))for(const e of t.da)await e(!0)}async function au(t){for(const e of t.da)await e(!1)}function WC(t,e){const n=Ce(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),vv(n)?yv(n):nl(n).O_()&&gv(n,e))}function mv(t,e){const n=Ce(t),r=nl(n);n.Ia.delete(e),r.O_()&&GC(n,e),n.Ia.size===0&&(r.O_()?r.L_():Po(n)&&n.Ra.set("Unknown"))}function gv(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(_e.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}nl(t).Y_(e)}function GC(t,e){t.Va.Ue(e),nl(t).Z_(e)}function yv(t){t.Va=new VL({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),nl(t).start(),t.Ra.ua()}function vv(t){return Po(t)&&!nl(t).x_()&&t.Ia.size>0}function Po(t){return Ce(t).Ea.size===0}function KC(t){t.Va=void 0}async function KV(t){t.Ra.set("Online")}async function QV(t){t.Ia.forEach((e,n)=>{gv(t,e)})}async function YV(t,e){KC(t),vv(t)?(t.Ra.ha(e),yv(t)):t.Ra.set("Unknown")}async function XV(t,e,n){if(t.Ra.set("Online"),e instanceof pC&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,o),s.Ia.delete(l),s.Va.removeTarget(l))}(t,e)}catch(r){J(xo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ih(t,r)}else if(e instanceof Sd?t.Va.Ze(e):e instanceof fC?t.Va.st(e):t.Va.tt(e),!n.isEqual(_e.min()))try{const r=await BC(t.localStore);n.compareTo(r)>=0&&await function(i,o){const l=i.Va.Tt(o);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,d)=>{const f=i.Ia.get(c);if(!f)return;i.Ia.set(c,f.withResumeToken(Ut.EMPTY_BYTE_STRING,f.snapshotVersion)),GC(i,c);const h=new us(f.target,c,d,f.sequenceNumber);gv(i,h)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){J(xo,"Failed to raise snapshot:",r),await Ih(t,r)}}async function Ih(t,e,n){if(!Si(e))throw e;t.Ea.add(1),await au(t),t.Ra.set("Offline"),n||(n=()=>BC(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{J(xo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await Ef(t)})}function QC(t,e){return e().catch(n=>Ih(t,n,e))}async function lu(t){const e=Ce(t),n=vi(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Zi;for(;JV(e);)try{const s=await jV(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,ZV(e,s)}catch(s){await Ih(e,s)}YC(e)&&XC(e)}function JV(t){return Po(t)&&t.Ta.length<10}function ZV(t,e){t.Ta.push(e);const n=vi(t);n.O_()&&n.X_&&n.ea(e.mutations)}function YC(t){return Po(t)&&!vi(t).x_()&&t.Ta.length>0}function XC(t){vi(t).start()}async function eM(t){vi(t).ra()}async function tM(t){const e=vi(t);for(const n of t.Ta)e.ea(n.mutations)}async function nM(t,e,n){const r=t.Ta.shift(),s=rv.from(r,e,n);await QC(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await lu(t)}async function rM(t,e){e&&vi(t).X_&&await async function(r,s){if(function(o){return DL(o)&&o!==q.ABORTED}(s.code)){const i=r.Ta.shift();vi(r).B_(),await QC(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await lu(r)}}(t,e),YC(t)&&XC(t)}async function LE(t,e){const n=Ce(t);n.asyncQueue.verifyOperationInProgress(),J(xo,"RemoteStore received new credentials");const r=Po(n);n.Ea.add(3),await au(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Ef(n)}async function sM(t,e){const n=Ce(t);e?(n.Ea.delete(2),await Ef(n)):e||(n.Ea.add(2),await au(n),n.Ra.set("Unknown"))}function nl(t){return t.ma||(t.ma=function(n,r,s){const i=Ce(n);return i.sa(),new BV(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:KV.bind(null,t),t_:QV.bind(null,t),r_:YV.bind(null,t),H_:XV.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),vv(t)?yv(t):t.Ra.set("Unknown")):(await t.ma.stop(),KC(t))})),t.ma}function vi(t){return t.fa||(t.fa=function(n,r,s){const i=Ce(n);return i.sa(),new zV(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:eM.bind(null,t),r_:rM.bind(null,t),ta:tM.bind(null,t),na:nM.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await lu(t)):(await t.fa.stop(),t.Ta.length>0&&(J(xo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Tr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const o=Date.now()+r,l=new _v(e,n,o,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ee(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wv(t,e){if(wn("AsyncQueue",`${e}: ${t}`),Si(t))return new ee(q.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{static emptySet(e){return new Ea(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||oe.comparator(n.key,r.key):(n,r)=>oe.comparator(n.key,r.key),this.keyedMap=Fl(),this.sortedSet=new vt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Ea)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Ea;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(){this.ga=new vt(oe.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):he(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class Ha{constructor(e,n,r,s,i,o,l,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const o=[];return n.forEach(l=>{o.push({type:0,doc:l})}),new Ha(e,n,Ea.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class oM{constructor(){this.queries=ME(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=Ce(n),i=s.queries;s.queries=ME(),i.forEach((o,l)=>{for(const c of l.Sa)c.onError(r)})})(this,new ee(q.ABORTED,"Firestore shutting down"))}}function ME(){return new Ts(t=>JS(t),hf)}async function xv(t,e){const n=Ce(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new iM,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const l=wv(o,`Initialization of query '${Yo(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&bv(n)}async function Ev(t,e){const n=Ce(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function aM(t,e){const n=Ce(t);let r=!1;for(const s of e){const i=s.query,o=n.queries.get(i);if(o){for(const l of o.Sa)l.Fa(s)&&(r=!0);o.wa=s}}r&&bv(n)}function lM(t,e,n){const r=Ce(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function bv(t){t.Ca.forEach(e=>{e.next()})}var xg,FE;(FE=xg||(xg={})).Ma="default",FE.Cache="cache";class Iv{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ha(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Ha.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==xg.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e){this.key=e}}class ZC{constructor(e){this.key=e}}class cM{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ve(),this.mutatedKeys=Ve(),this.eu=ZS(e),this.tu=new Ea(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new VE,s=n?n.tu:this.tu;let i=n?n.mutatedKeys:this.mutatedKeys,o=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,h)=>{const m=s.get(f),v=iu(this.query,h)?h:null,R=!!m&&this.mutatedKeys.has(m.key),N=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let C=!1;m&&v?m.data.isEqual(v.data)?R!==N&&(r.track({type:3,doc:v}),C=!0):this.su(m,v)||(r.track({type:2,doc:v}),C=!0,(c&&this.eu(v,c)>0||d&&this.eu(v,d)<0)&&(l=!0)):!m&&v?(r.track({type:0,doc:v}),C=!0):m&&!v&&(r.track({type:1,doc:m}),C=!0,(c||d)&&(l=!0)),C&&(v?(o=o.add(v),i=N?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:o,iu:r,Cs:l,mutatedKeys:i}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((f,h)=>function(v,R){const N=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return he(20277,{Rt:C})}};return N(v)-N(R)}(f.type,h.type)||this.eu(f.doc,h.doc)),this.ou(r),s=s??!1;const l=n&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,d=c!==this.Za;return this.Za=c,o.length!==0||d?{snapshot:new Ha(this.query,e.tu,i,o,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new VE,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ve(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const n=[];return e.forEach(r=>{this.Xa.has(r)||n.push(new ZC(r))}),this.Xa.forEach(r=>{e.has(r)||n.push(new JC(r))}),n}cu(e){this.Ya=e.Qs,this.Xa=Ve();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Ha.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Tv="SyncEngine";class uM{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class dM{constructor(e){this.key=e,this.hu=!1}}class hM{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Ts(l=>JS(l),hf),this.Iu=new Map,this.Eu=new Set,this.du=new vt(oe.comparator),this.Au=new Map,this.Ru=new uv,this.Vu={},this.mu=new Map,this.fu=wo.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function fM(t,e,n=!0){const r=iN(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await eN(r,e,n,!0),s}async function pM(t,e){const n=iN(t);await eN(n,e,!0,!1)}async function eN(t,e,n,r){const s=await DV(t.localStore,lr(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await mM(t,e,i,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&WC(t.remoteStore,s),l}async function mM(t,e,n,r,s){t.pu=(h,m,v)=>async function(N,C,y,w){let E=C.view.ru(y);E.Cs&&(E=await PE(N.localStore,C.query,!1).then(({documents:b})=>C.view.ru(b,E)));const I=w&&w.targetChanges.get(C.targetId),M=w&&w.targetMismatches.get(C.targetId)!=null,$=C.view.applyChanges(E,N.isPrimaryClient,I,M);return $E(N,C.targetId,$.au),$.snapshot}(t,h,m,v);const i=await PE(t.localStore,e,!0),o=new cM(e,i.Qs),l=o.ru(i.documents),c=ou.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=o.applyChanges(l,t.isPrimaryClient,c);$E(t,n,d.au);const f=new uM(e,n,o);return t.Tu.set(e,f),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),d.snapshot}async function gM(t,e,n){const r=Ce(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!hf(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await _g(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&mv(r.remoteStore,s.targetId),Eg(r,s.targetId)}).catch(Ro)):(Eg(r,s.targetId),await _g(r.localStore,s.targetId,!0))}async function yM(t,e){const n=Ce(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),mv(n.remoteStore,r.targetId))}async function vM(t,e,n){const r=oN(t);try{const s=await function(o,l){const c=Ce(o),d=qe.now(),f=l.reduce((v,R)=>v.add(R.key),Ve());let h,m;return c.persistence.runTransaction("Locally write mutations","readwrite",v=>{let R=Hn(),N=Ve();return c.Ns.getEntries(v,f).next(C=>{R=C,R.forEach((y,w)=>{w.isValidDocument()||(N=N.add(y))})}).next(()=>c.localDocuments.getOverlayedDocuments(v,R)).next(C=>{h=C;const y=[];for(const w of l){const E=PL(w,h.get(w.key).overlayedDocument);E!=null&&y.push(new Ss(w.key,E,zS(E.value.mapValue),hn.exists(!0)))}return c.mutationQueue.addMutationBatch(v,d,y,l)}).next(C=>{m=C;const y=C.applyToLocalDocumentSet(h,N);return c.documentOverlayCache.saveOverlays(v,C.batchId,y)})}).then(()=>({batchId:m.batchId,changes:tC(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,l,c){let d=o.Vu[o.currentUser.toKey()];d||(d=new vt(Re)),d=d.insert(l,c),o.Vu[o.currentUser.toKey()]=d}(r,s.batchId,n),await cu(r,s.changes),await lu(r.remoteStore)}catch(s){const i=wv(s,"Failed to persist write");n.reject(i)}}async function tN(t,e){const n=Ce(t);try{const r=await PV(n.localStore,e);e.targetChanges.forEach((s,i)=>{const o=n.Au.get(i);o&&(ye(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?ye(o.hu,14607):s.removedDocuments.size>0&&(ye(o.hu,42227),o.hu=!1))}),await cu(n,r,e)}catch(r){await Ro(r)}}function UE(t,e,n){const r=Ce(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach((i,o)=>{const l=o.view.va(e);l.snapshot&&s.push(l.snapshot)}),function(o,l){const c=Ce(o);c.onlineState=l;let d=!1;c.queries.forEach((f,h)=>{for(const m of h.Sa)m.va(l)&&(d=!0)}),d&&bv(c)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function _M(t,e,n){const r=Ce(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new vt(oe.comparator);o=o.insert(i,Ct.newNoDocument(i,_e.min()));const l=Ve().add(i),c=new yf(_e.min(),new Map,new vt(Re),o,l);await tN(r,c),r.du=r.du.remove(i),r.Au.delete(e),Sv(r)}else await _g(r.localStore,e,!1).then(()=>Eg(r,e,n)).catch(Ro)}async function wM(t,e){const n=Ce(t),r=e.batch.batchId;try{const s=await RV(n.localStore,e);rN(n,r,null),nN(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await cu(n,s)}catch(s){await Ro(s)}}async function xM(t,e,n){const r=Ce(t);try{const s=await function(o,l){const c=Ce(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,l).next(h=>(ye(h!==null,37113),f=h.keys(),c.mutationQueue.removeMutationBatch(d,h))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(r.localStore,e);rN(r,e,n),nN(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await cu(r,s)}catch(s){await Ro(s)}}function nN(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function rN(t,e,n){const r=Ce(t);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Eg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(r=>{t.Ru.containsKey(r)||sN(t,r)})}function sN(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(mv(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Sv(t))}function $E(t,e,n){for(const r of n)r instanceof JC?(t.Ru.addReference(r.key,e),EM(t,r)):r instanceof ZC?(J(Tv,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||sN(t,r.key)):he(19791,{wu:r})}function EM(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(J(Tv,"New document in limbo: "+n),t.Eu.add(r),Sv(t))}function Sv(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new oe(Ye.fromString(e)),r=t.fu.next();t.Au.set(r,new dM(n)),t.du=t.du.insert(n,r),WC(t.remoteStore,new us(lr(su(n.path)),r,"TargetPurposeLimboResolution",or.ce))}}async function cu(t,e,n){const r=Ce(t),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((l,c)=>{o.push(r.pu(c,e,n).then(d=>{var f;if((d||n)&&r.isPrimaryClient){const h=d?!d.fromCache:(f=n==null?void 0:n.targetChanges.get(c.targetId))==null?void 0:f.current;r.sharedClientState.updateQueryState(c.targetId,h?"current":"not-current")}if(d){s.push(d);const h=fv.As(c.targetId,d);i.push(h)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(c,d){const f=Ce(c);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>V.forEach(d,m=>V.forEach(m.Es,v=>f.persistence.referenceDelegate.addReference(h,m.targetId,v)).next(()=>V.forEach(m.ds,v=>f.persistence.referenceDelegate.removeReference(h,m.targetId,v)))))}catch(h){if(!Si(h))throw h;J(pv,"Failed to update sequence numbers: "+h)}for(const h of d){const m=h.targetId;if(!h.fromCache){const v=f.Ms.get(m),R=v.snapshotVersion,N=v.withLastLimboFreeSnapshotVersion(R);f.Ms=f.Ms.insert(m,N)}}}(r.localStore,i))}async function bM(t,e){const n=Ce(t);if(!n.currentUser.isEqual(e)){J(Tv,"User change. New user:",e.toKey());const r=await $C(n.localStore,e);n.currentUser=e,function(i,o){i.mu.forEach(l=>{l.forEach(c=>{c.reject(new ee(q.CANCELLED,o))})}),i.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await cu(n,r.Ls)}}function IM(t,e){const n=Ce(t),r=n.Au.get(e);if(r&&r.hu)return Ve().add(r.key);{let s=Ve();const i=n.Iu.get(e);if(!i)return s;for(const o of i){const l=n.Tu.get(o);s=s.unionWith(l.view.nu)}return s}}function iN(t){const e=Ce(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=tN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=IM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=_M.bind(null,e),e.Pu.H_=aM.bind(null,e.eventManager),e.Pu.yu=lM.bind(null,e.eventManager),e}function oN(t){const e=Ce(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wM.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=xM.bind(null,e),e}class $c{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=xf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return UC(this.persistence,new FC,e.initialUser,this.serializer)}Cu(e){return new dv(wf.mi,this.serializer)}Du(e){return new zC}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}$c.provider={build:()=>new $c};class TM extends $c{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){ye(this.persistence.referenceDelegate instanceof bh,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new DC(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?cn.withCacheSize(this.cacheSizeBytes):cn.DEFAULT;return new dv(r=>bh.mi(r,n),this.serializer)}}class SM extends $c{constructor(e,n,r){super(),this.xu=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await oN(this.xu.syncEngine),await lu(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return UC(this.persistence,new FC,e.initialUser,this.serializer)}Fu(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new DC(r,e.asyncQueue,n)}Mu(e,n){const r=new RO(n,this.persistence);return new AO(e.asyncQueue,r)}Cu(e){const n=SV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?cn.withCacheSize(this.cacheSizeBytes):cn.DEFAULT;return new hv(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,$V(),Nd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new zC}}class Th{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>UE(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=bM.bind(null,this.syncEngine),await sM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new oM}()}createDatastore(e){const n=xf(e.databaseInfo.databaseId),r=function(i){return new UV(i)}(e.databaseInfo);return function(i,o,l,c){return new HV(i,o,l,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,o,l){return new GV(r,s,i,o,l)}(this.localStore,this.datastore,e.asyncQueue,n=>UE(this.syncEngine,n,0),function(){return DE.v()?new DE:new LV}())}createSyncEngine(e,n){return function(s,i,o,l,c,d,f){const h=new hM(s,i,o,l,c,d);return f&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=Ce(s);J(xo,"RemoteStore shutting down."),i.Ea.add(5),await au(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}Th.provider={build:()=>new Th};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cv{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):wn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _i="FirestoreClient";class CM{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=tn.UNAUTHENTICATED,this.clientId=qy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{J(_i,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(J(_i,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Tr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=wv(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Dp(t,e){t.asyncQueue.verifyOperationInProgress(),J(_i,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await $C(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function BE(t,e){t.asyncQueue.verifyOperationInProgress();const n=await NM(t);J(_i,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>LE(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>LE(e.remoteStore,s)),t._onlineComponents=e}async function NM(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){J(_i,"Using user provided OfflineComponentProvider");try{await Dp(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===q.FAILED_PRECONDITION||s.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;fo("Error using user provided cache. Falling back to memory cache: "+n),await Dp(t,new $c)}}else J(_i,"Using default OfflineComponentProvider"),await Dp(t,new TM(void 0));return t._offlineComponents}async function Nv(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(J(_i,"Using user provided OnlineComponentProvider"),await BE(t,t._uninitializedComponentsProvider._online)):(J(_i,"Using default OnlineComponentProvider"),await BE(t,new Th))),t._onlineComponents}function AM(t){return Nv(t).then(e=>e.syncEngine)}function RM(t){return Nv(t).then(e=>e.datastore)}async function Sh(t){const e=await Nv(t),n=e.eventManager;return n.onListen=fM.bind(null,e.syncEngine),n.onUnlisten=gM.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=pM.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=yM.bind(null,e.syncEngine),n}function PM(t,e,n={}){const r=new Tr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,d){const f=new Cv({next:m=>{f.Nu(),o.enqueueAndForget(()=>Ev(i,h));const v=m.docs.has(l);!v&&m.fromCache?d.reject(new ee(q.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&m.fromCache&&c&&c.source==="server"?d.reject(new ee(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(m)},error:m=>d.reject(m)}),h=new Iv(su(l.path),f,{includeMetadataChanges:!0,qa:!0});return xv(i,h)}(await Sh(t),t.asyncQueue,e,n,r)),r.promise}function kM(t,e,n={}){const r=new Tr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,d){const f=new Cv({next:m=>{f.Nu(),o.enqueueAndForget(()=>Ev(i,h)),m.fromCache&&c.source==="server"?d.reject(new ee(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(m)},error:m=>d.reject(m)}),h=new Iv(l,f,{includeMetadataChanges:!0,qa:!0});return xv(i,h)}(await Sh(t),t.asyncQueue,e,n,r)),r.promise}function jM(t,e,n){const r=new Tr;return t.asyncQueue.enqueueAndForget(async()=>{try{const s=await RM(t);r.resolve(async function(o,l,c){var N;const d=Ce(o),{request:f,gt:h,parent:m}=WL(d.serializer,vL(l),c);d.connection.$o||delete f.parent;const v=(await d.Ho("RunAggregationQuery",d.serializer.databaseId,m,f,1)).filter(C=>!!C.result);ye(v.length===1,64727);const R=(N=v[0].result)==null?void 0:N.aggregateFields;return Object.keys(R).reduce((C,y)=>(C[h[y]]=R[y],C),{})}(s,e,n))}catch(s){r.reject(s)}}),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zE=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lN="firestore.googleapis.com",qE=!0;class HE{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ee(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lN,this.ssl=qE}else this.host=e.host,this.ssl=e.ssl??qE;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=RC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<cV)throw new ee(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}IO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aN(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new ee(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new ee(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new ee(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class bf{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new HE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ee(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ee(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new HE(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new pO;switch(r.type){case"firstParty":return new vO(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ee(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=zE.get(n);r&&(J("ComponentProvider","Removing Datastore"),zE.delete(n),r.terminate())}(this),Promise.resolve()}}function DM(t,e,n,r={}){var d;t=pn(t,bf);const s=bi(e),i=t._getSettings(),o={...i,emulatorOptions:t._getEmulatorOptions()},l=`${e}:${n}`;s&&(Ay(`https://${l}`),Ry("Firestore",!0)),i.host!==lN&&i.host!==l&&fo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:l,ssl:s,emulatorOptions:r};if(!_s(c,o)&&(t._setSettings(c),r.mockUserToken)){let f,h;if(typeof r.mockUserToken=="string")f=r.mockUserToken,h=tn.MOCK_USER;else{f=yT(r.mockUserToken,(d=t._app)==null?void 0:d.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new ee(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new tn(m)}t._authCredentials=new mO(new gS(f,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new jr(this.firestore,e,this._query)}}class Nt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Nt(this.firestore,e,this._key)}toJSON(){return{type:Nt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(tu(n,Nt._jsonSchema))return new Nt(e,r||null,new oe(Ye.fromString(n.referencePath)))}}Nt._jsonSchemaVersion="firestore/documentReference/1.0",Nt._jsonSchema={type:Ft("string",Nt._jsonSchemaVersion),referencePath:Ft("string")};class hi extends jr{constructor(e,n,r){super(e,n,su(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Nt(this.firestore,null,new oe(e))}withConverter(e){return new hi(this.firestore,e,this._path)}}function Ie(t,e,...n){if(t=tt(t),vS("collection","path",e),t instanceof bf){const r=Ye.fromString(e,...n);return Ox(r),new hi(t,null,r)}{if(!(t instanceof Nt||t instanceof hi))throw new ee(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ye.fromString(e,...n));return Ox(r),new hi(t.firestore,null,r)}}function Ke(t,e,...n){if(t=tt(t),arguments.length===1&&(e=qy.newId()),vS("doc","path",e),t instanceof bf){const r=Ye.fromString(e,...n);return Dx(r),new Nt(t,null,new oe(r))}{if(!(t instanceof Nt||t instanceof hi))throw new ee(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ye.fromString(e,...n));return Dx(r),new Nt(t.firestore,t instanceof hi?t.converter:null,new oe(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WE="AsyncQueue";class GE{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new qC(this,"async_queue_retry"),this._c=()=>{const r=Nd();r&&J(WE,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Nd();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Nd();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new Tr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Si(e))throw e;J(WE,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,wn("INTERNAL UNHANDLED ERROR: ",KE(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=_v.createAndSchedule(this,e,n,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&he(47125,{Pc:KE(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function KE(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QE(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Ar extends bf{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new GE,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new GE(e),this._firestoreClient=void 0,await e}}}function cN(t,e){const n=typeof t=="object"?t:Xh(),r=typeof t=="string"?t:ph,s=Ii(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=pT("firestore");i&&DM(s,...i)}return s}function uu(t){if(t._terminated)throw new ee(q.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||uN(t),t._firestoreClient}function uN(t){var r,s,i;const e=t._freezeSettings(),n=function(l,c,d,f){return new oL(l,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,aN(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new CM(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}function OM(t,e){fo("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return LM(t,Th.provider,{build:r=>new SM(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function LM(t,e,n){if((t=pn(t,Ar))._firestoreClient||t._terminated)throw new ee(q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new ee(q.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},uN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VM{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class MM{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new sr(Ut.fromBase64String(e))}catch(n){throw new ee(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new sr(Ut.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:sr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(tu(e,sr._jsonSchema))return sr.fromBase64String(e.bytes)}}sr._jsonSchemaVersion="firestore/bytes/1.0",sr._jsonSchema={type:Ft("string",sr._jsonSchemaVersion),bytes:Ft("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ee(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ee(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ee(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Re(this._lat,e._lat)||Re(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Xr._jsonSchemaVersion}}static fromJSON(e){if(tu(e,Xr._jsonSchema))return new Xr(e.latitude,e.longitude)}}Xr._jsonSchemaVersion="firestore/geoPoint/1.0",Xr._jsonSchema={type:Ft("string",Xr._jsonSchemaVersion),latitude:Ft("number"),longitude:Ft("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Jr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(tu(e,Jr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new Jr(e.vectorValues);throw new ee(q.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Jr._jsonSchemaVersion="firestore/vectorValue/1.0",Jr._jsonSchema={type:Ft("string",Jr._jsonSchemaVersion),vectorValues:Ft("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FM=/^__.*__$/;class UM{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ss(e,this.data,this.fieldMask,n,this.fieldTransforms):new tl(e,this.data,n,this.fieldTransforms)}}class dN{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ss(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function hN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw he(40011,{Ac:t})}}class Tf{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Tf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ch(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(hN(this.Ac)&&FM.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class $M{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||xf(e)}Cc(e,n,r,s=!1){return new Tf({Ac:e,methodName:n,Dc:r,path:xt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function du(t){const e=t._freezeSettings(),n=xf(t._databaseId);return new $M(t._databaseId,!!e.ignoreUndefinedProperties,n)}function fN(t,e,n,r,s,i={}){const o=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);kv("Data must be an object, but it was:",o,r);const l=mN(r,o);let c,d;if(i.merge)c=new jn(o.fieldMask),d=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const h of i.mergeFields){const m=bg(e,h,n);if(!o.contains(m))throw new ee(q.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);yN(f,m)||f.push(m)}c=new jn(f),d=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,d=o.fieldTransforms;return new UM(new dn(l),c,d)}class Sf extends rl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Sf}}function BM(t,e,n){return new Tf({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Av extends rl{_toFieldTransform(e){return new pf(e.path,new $a)}isEqual(e){return e instanceof Av}}class Rv extends rl{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=BM(this,e,!0),r=this.vc.map(i=>sl(i,n)),s=new yo(r);return new pf(e.path,s)}isEqual(e){return e instanceof Rv&&_s(this.vc,e.vc)}}class Pv extends rl{constructor(e,n){super(e),this.Fc=n}_toFieldTransform(e){const n=new za(e.serializer,sC(e.serializer,this.Fc));return new pf(e.path,n)}isEqual(e){return e instanceof Pv&&this.Fc===e.Fc}}function zM(t,e,n,r){const s=t.Cc(1,e,n);kv("Data must be an object, but it was:",s,r);const i=[],o=dn.empty();Ci(r,(c,d)=>{const f=jv(e,c,n);d=tt(d);const h=s.yc(f);if(d instanceof Sf)i.push(f);else{const m=sl(d,h);m!=null&&(i.push(f),o.set(f,m))}});const l=new jn(i);return new dN(o,l,s.fieldTransforms)}function qM(t,e,n,r,s,i){const o=t.Cc(1,e,n),l=[bg(e,r,n)],c=[s];if(i.length%2!=0)throw new ee(q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)l.push(bg(e,i[m])),c.push(i[m+1]);const d=[],f=dn.empty();for(let m=l.length-1;m>=0;--m)if(!yN(d,l[m])){const v=l[m];let R=c[m];R=tt(R);const N=o.yc(v);if(R instanceof Sf)d.push(v);else{const C=sl(R,N);C!=null&&(d.push(v),f.set(v,C))}}const h=new jn(d);return new dN(f,h,o.fieldTransforms)}function pN(t,e,n,r=!1){return sl(n,t.Cc(r?4:3,e))}function sl(t,e){if(gN(t=tt(t)))return kv("Unsupported field value:",e,t),mN(t,e);if(t instanceof rl)return function(r,s){if(!hN(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const l of r){let c=sl(l,s.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=tt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return sC(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=qe.fromDate(r);return{timestampValue:qa(s.serializer,i)}}if(r instanceof qe){const i=new qe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:qa(s.serializer,i)}}if(r instanceof Xr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof sr)return{bytesValue:mC(s.serializer,r._byteString)};if(r instanceof Nt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ov(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Jr)return function(o,l){return{mapValue:{fields:{[Xy]:{stringValue:Jy},[Ma]:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return tv(l.serializer,d)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${nf(r)}`)}(t,e)}function mN(t,e){const n={};return DS(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ci(t,(r,s)=>{const i=sl(s,e.mc(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function gN(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof qe||t instanceof Xr||t instanceof sr||t instanceof Nt||t instanceof rl||t instanceof Jr)}function kv(t,e,n){if(!gN(n)||!_S(n)){const r=nf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function bg(t,e,n){if((e=tt(e))instanceof If)return e._internalPath;if(typeof e=="string")return jv(t,e);throw Ch("Field path arguments must be of type string or ",t,!1,void 0,n)}const HM=new RegExp("[~\\*/\\[\\]]");function jv(t,e,n){if(e.search(HM)>=0)throw Ch(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new If(...e.split("."))._internalPath}catch{throw Ch(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ch(t,e,n,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new ee(q.INVALID_ARGUMENT,l+t+c)}function yN(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dv{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Nt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new WM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Cf("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class WM extends Dv{data(){return super.data()}}function Cf(t,e){return typeof e=="string"?jv(t,e):e instanceof If?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vN(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ee(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ov{}class hu extends Ov{}function ct(t,e,...n){let r=[];e instanceof Ov&&r.push(e),r=r.concat(n),function(i){const o=i.filter(c=>c instanceof Lv).length,l=i.filter(c=>c instanceof Nf).length;if(o>1||o>0&&l>0)throw new ee(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Nf extends hu{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Nf(e,n,r)}_apply(e){const n=this._parse(e);return wN(e._query,n),new jr(e.firestore,e.converter,dg(e._query,n))}_parse(e){const n=du(e.firestore);return function(i,o,l,c,d,f,h){let m;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new ee(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){ZE(h,f);const R=[];for(const N of h)R.push(JE(c,i,N));m={arrayValue:{values:R}}}else m=JE(c,i,h)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||ZE(h,f),m=pN(l,o,h,f==="in"||f==="not-in");return Be.create(d,f,m)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function rt(t,e,n){const r=e,s=Cf("where",t);return Nf._create(s,r,n)}class Lv extends Ov{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Lv(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:st.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let o=s;const l=i.getFlattenedFilters();for(const c of l)wN(o,c),o=dg(o,c)}(e._query,n),new jr(e.firestore,e.converter,dg(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Vv extends hu{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Vv(e,n)}_apply(e){const n=function(s,i,o){if(s.startAt!==null)throw new ee(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ee(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Uc(i,o)}(e._query,this._field,this._direction);return new jr(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ni(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function xn(t,e="asc"){const n=e,r=Cf("orderBy",t);return Vv._create(r,n)}class Mv extends hu{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new Mv(e,n,r)}_apply(e){return new jr(e.firestore,e.converter,yh(e._query,this._limit,this._limitType))}}function ba(t){return TO("limit",t),Mv._create("limit",t,"F")}class Af extends hu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Af(e,n,r)}_apply(e){const n=_N(e,this.type,this._docOrFields,this._inclusive);return new jr(e.firestore,e.converter,function(s,i){return new Ni(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,n))}}function YE(...t){return Af._create("startAt",t,!0)}function GM(...t){return Af._create("startAfter",t,!1)}class Fv extends hu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Fv(e,n,r)}_apply(e){const n=_N(e,this.type,this._docOrFields,this._inclusive);return new jr(e.firestore,e.converter,function(s,i){return new Ni(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,n))}}function XE(...t){return Fv._create("endAt",t,!0)}function _N(t,e,n,r){if(n[0]=tt(n[0]),n[0]instanceof Dv)return function(i,o,l,c,d){if(!c)throw new ee(q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const f=[];for(const h of xa(i))if(h.field.isKeyField())f.push(mo(o,c.key));else{const m=c.data.field(h.field);if(cf(m))throw new ee(q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const v=h.field.canonicalString();throw new ee(q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}f.push(m)}return new yi(f,d)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=du(t.firestore);return function(o,l,c,d,f,h){const m=o.explicitOrderBy;if(f.length>m.length)throw new ee(q.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let R=0;R<f.length;R++){const N=f[R];if(m[R].field.isKeyField()){if(typeof N!="string")throw new ee(q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof N}`);if(!ev(o)&&N.indexOf("/")!==-1)throw new ee(q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${N}' contains a slash.`);const C=o.path.child(Ye.fromString(N));if(!oe.isDocumentKey(C))throw new ee(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${C}' is not because it contains an odd number of segments.`);const y=new oe(C);v.push(mo(l,y))}else{const C=pN(c,d,N);v.push(C)}}return new yi(v,h)}(t._query,t.firestore._databaseId,s,e,n,r)}}function JE(t,e,n){if(typeof(n=tt(n))=="string"){if(n==="")throw new ee(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ev(e)&&n.indexOf("/")!==-1)throw new ee(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ye.fromString(n));if(!oe.isDocumentKey(r))throw new ee(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return mo(t,new oe(r))}if(n instanceof Nt)return mo(t,n._key);throw new ee(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${nf(n)}.`)}function ZE(t,e){if(!Array.isArray(t)||t.length===0)throw new ee(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function wN(t,e){const n=function(s,i){for(const o of s)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ee(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ee(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class KM{convertValue(e,n="none"){switch(mi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return mt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(bs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw he(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ci(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var r,s,i;const n=(i=(s=(r=e.fields)==null?void 0:r[Ma].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>mt(o.doubleValue));return new Jr(n)}convertGeoPoint(e){return new Xr(mt(e.latitude),mt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=uf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Vc(e));default:return null}}convertTimestamp(e){const n=Es(e);return new qe(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ye.fromString(e);ye(IC(r),9688,{name:e});const s=new po(r.get(1),r.get(3)),i=new oe(r.popFirst(5));return s.isEqual(n)||wn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xN(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}function QM(){return new VM("count")}class Bl{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class no extends Dv{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Ad(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Cf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ee(q.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=no._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}no._jsonSchemaVersion="firestore/documentSnapshot/1.0",no._jsonSchema={type:Ft("string",no._jsonSchemaVersion),bundleSource:Ft("string","DocumentSnapshot"),bundleName:Ft("string"),bundle:Ft("string")};class Ad extends no{data(e={}){return super.data(e)}}class ro{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Bl(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Ad(this._firestore,this._userDataWriter,r.key,r,new Bl(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ee(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(l=>{const c=new Ad(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Bl(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new Ad(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Bl(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),f=o.indexOf(l.doc.key)),{type:YM(l.type),doc:c,oldIndex:d,newIndex:f}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ee(q.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ro._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=qy.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(n.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function YM(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return he(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bc(t){t=pn(t,Nt);const e=pn(t.firestore,Ar);return PM(uu(e),t._key).then(n=>EN(e,t,n))}ro._jsonSchemaVersion="firestore/querySnapshot/1.0",ro._jsonSchema={type:Ft("string",ro._jsonSchemaVersion),bundleSource:Ft("string","QuerySnapshot"),bundleName:Ft("string"),bundle:Ft("string")};class Rf extends KM{constructor(e){super(),this.firestore=e}convertBytes(e){return new sr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Nt(this.firestore,null,n)}}function et(t){t=pn(t,jr);const e=pn(t.firestore,Ar),n=uu(e),r=new Rf(e);return vN(t._query),kM(n,t._query).then(s=>new ro(e,r,t,s))}function zc(t,e,n){t=pn(t,Nt);const r=pn(t.firestore,Ar),s=xN(t.converter,e,n);return Pf(r,[fN(du(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,hn.none())])}function Pn(t,e,n,...r){t=pn(t,Nt);const s=pn(t.firestore,Ar),i=du(s);let o;return o=typeof(e=tt(e))=="string"||e instanceof If?qM(i,"updateDoc",t._key,e,n,r):zM(i,"updateDoc",t._key,e),Pf(s,[o.toMutation(t._key,hn.exists(!0))])}function fs(t){return Pf(pn(t.firestore,Ar),[new gf(t._key,hn.none())])}function fn(t,e){const n=pn(t.firestore,Ar),r=Ke(t),s=xN(t.converter,e);return Pf(n,[fN(du(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,hn.exists(!1))]).then(()=>r)}function zn(t,...e){var c,d,f;t=tt(t);let n={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||QE(e[r])||(n=e[r++]);const s={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(QE(e[r])){const h=e[r];e[r]=(c=h.next)==null?void 0:c.bind(h),e[r+1]=(d=h.error)==null?void 0:d.bind(h),e[r+2]=(f=h.complete)==null?void 0:f.bind(h)}let i,o,l;if(t instanceof Nt)o=pn(t.firestore,Ar),l=su(t._key.path),i={next:h=>{e[r]&&e[r](EN(o,t,h))},error:e[r+1],complete:e[r+2]};else{const h=pn(t,jr);o=pn(h.firestore,Ar),l=h._query;const m=new Rf(o);i={next:v=>{e[r]&&e[r](new ro(o,m,h,v))},error:e[r+1],complete:e[r+2]},vN(t._query)}return function(m,v,R,N){const C=new Cv(N),y=new Iv(v,C,R);return m.asyncQueue.enqueueAndForget(async()=>xv(await Sh(m),y)),()=>{C.Nu(),m.asyncQueue.enqueueAndForget(async()=>Ev(await Sh(m),y))}}(uu(o),l,s,i)}function Pf(t,e){return function(r,s){const i=new Tr;return r.asyncQueue.enqueueAndForget(async()=>vM(await AM(r),s,i)),i.promise}(uu(t),e)}function EN(t,e,n){const r=n.docs.get(e._key),s=new Rf(t);return new no(t,s,e._key,r,new Bl(n.hasPendingWrites,n.fromCache),e.converter)}function XM(t){return JM(t,{count:QM()})}function JM(t,e){const n=pn(t.firestore,Ar),r=uu(n),s=sL(e,(i,o)=>new kL(o,i.aggregateType,i._internalFieldPath));return jM(r,t._query,s).then(i=>function(l,c,d){const f=new Rf(l);return new MM(c,f,d)}(n,t,i))}function er(){return new Av("serverTimestamp")}function ZM(...t){return new Rv("arrayUnion",t)}function eb(t){return new Pv("increment",t)}(function(e,n=!0){(function(s){el=s})(No),Cr(new hr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),l=new Ar(new gO(r.getProvider("auth-internal")),new _O(o,r.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new ee(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new po(d.options.projectId,f)}(o,s),o);return i={useFetchStreams:n,...i},l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Vn(Rx,Px,e),Vn(Rx,Px,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bN="firebasestorage.googleapis.com",IN="storageBucket",eF=2*60*1e3,tF=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt extends fr{constructor(e,n,r=0){super(Op(e),`Firebase Storage: ${n} (${Op(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Rt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Op(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var At;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(At||(At={}));function Op(t){return"storage/"+t}function Uv(){const t="An unknown error occurred, please check the error payload for server response.";return new Rt(At.UNKNOWN,t)}function nF(t){return new Rt(At.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function rF(t){return new Rt(At.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function sF(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Rt(At.UNAUTHENTICATED,t)}function iF(){return new Rt(At.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function oF(t){return new Rt(At.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function aF(){return new Rt(At.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function lF(){return new Rt(At.CANCELED,"User canceled the upload/download.")}function cF(t){return new Rt(At.INVALID_URL,"Invalid URL '"+t+"'.")}function uF(t){return new Rt(At.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function dF(){return new Rt(At.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+IN+"' property when initializing the app?")}function hF(){return new Rt(At.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function fF(){return new Rt(At.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function pF(t){return new Rt(At.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ig(t){return new Rt(At.INVALID_ARGUMENT,t)}function TN(){return new Rt(At.APP_DELETED,"The Firebase app was deleted.")}function mF(t){return new Rt(At.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function cc(t,e){return new Rt(At.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Al(t){throw new Rt(At.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=En.makeFromUrl(e,n)}catch{return new En(e,"")}if(r.path==="")return r;throw uF(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(I){I.path.charAt(I.path.length-1)==="/"&&(I.path_=I.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+s+o,"i"),c={bucket:1,path:3};function d(I){I.path_=decodeURIComponent(I.path)}const f="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",v=new RegExp(`^https?://${h}/${f}/b/${s}/o${m}`,"i"),R={bucket:1,path:3},N=n===bN?"(?:storage.googleapis.com|storage.cloud.google.com)":n,C="([^?#]*)",y=new RegExp(`^https?://${N}/${s}/${C}`,"i"),E=[{regex:l,indices:c,postModify:i},{regex:v,indices:R,postModify:d},{regex:y,indices:{bucket:1,path:2},postModify:d}];for(let I=0;I<E.length;I++){const M=E[I],$=M.regex.exec(e);if($){const b=$[M.indices.bucket];let x=$[M.indices.path];x||(x=""),r=new En(b,x),M.postModify(r);break}}if(r==null)throw cF(e);return r}}class gF{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yF(t,e,n){let r=1,s=null,i=null,o=!1,l=0;function c(){return l===2}let d=!1;function f(...C){d||(d=!0,e.apply(null,C))}function h(C){s=setTimeout(()=>{s=null,t(v,c())},C)}function m(){i&&clearTimeout(i)}function v(C,...y){if(d){m();return}if(C){m(),f.call(null,C,...y);return}if(c()||o){m(),f.call(null,C,...y);return}r<64&&(r*=2);let E;l===1?(l=2,E=0):E=(r+Math.random())*1e3,h(E)}let R=!1;function N(C){R||(R=!0,m(),!d&&(s!==null?(C||(l=2),clearTimeout(s),h(0)):C||(l=1)))}return h(0),i=setTimeout(()=>{o=!0,N(!0)},n),N}function vF(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _F(t){return t!==void 0}function wF(t){return typeof t=="object"&&!Array.isArray(t)}function $v(t){return typeof t=="string"||t instanceof String}function tb(t){return Bv()&&t instanceof Blob}function Bv(){return typeof Blob<"u"}function Tg(t,e,n,r){if(r<e)throw Ig(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Ig(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fu(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function SN(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var so;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(so||(so={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xF(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e,n,r,s,i,o,l,c,d,f,h,m=!0,v=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=f,this.connectionFactory_=h,this.retry=m,this.isUsingEmulator=v,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((R,N)=>{this.resolve_=R,this.reject_=N,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Yu(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const l=i.getErrorCode()===so.NO_ERROR,c=i.getStatus();if(!l||xF(c,this.additionalRetryCodes_)&&this.retry){const f=i.getErrorCode()===so.ABORT;r(!1,new Yu(!1,null,f));return}const d=this.successCodes_.indexOf(c)!==-1;r(!0,new Yu(d,i))})},n=(r,s)=>{const i=this.resolve_,o=this.reject_,l=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());_F(c)?i(c):i()}catch(c){o(c)}else if(l!==null){const c=Uv();c.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,c)):o(c)}else if(s.canceled){const c=this.appDelete_?TN():lF();o(c)}else{const c=aF();o(c)}};this.canceled_?n(!1,new Yu(!1,null,!0)):this.backoffId_=yF(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&vF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Yu{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function bF(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function IF(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function TF(t,e){e&&(t["X-Firebase-GMPID"]=e)}function SF(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function CF(t,e,n,r,s,i,o=!0,l=!1){const c=SN(t.urlParams),d=t.url+c,f=Object.assign({},t.headers);return TF(f,e),bF(f,n),IF(f,i),SF(f,r),new EF(d,t.method,f,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NF(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function AF(...t){const e=NF();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(Bv())return new Blob(t);throw new Rt(At.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function RF(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PF(t){if(typeof atob>"u")throw pF("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wr={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Lp{constructor(e,n){this.data=e,this.contentType=n||null}}function kF(t,e){switch(t){case Wr.RAW:return new Lp(CN(e));case Wr.BASE64:case Wr.BASE64URL:return new Lp(NN(t,e));case Wr.DATA_URL:return new Lp(DF(e),OF(e))}throw Uv()}function CN(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=t.charCodeAt(++n);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function jF(t){let e;try{e=decodeURIComponent(t)}catch{throw cc(Wr.DATA_URL,"Malformed data URL.")}return CN(e)}function NN(t,e){switch(t){case Wr.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw cc(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Wr.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw cc(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=PF(e)}catch(s){throw s.message.includes("polyfill")?s:cc(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class AN{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw cc(Wr.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=LF(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function DF(t){const e=new AN(t);return e.base64?NN(Wr.BASE64,e.rest):jF(e.rest)}function OF(t){return new AN(t).contentType}function LF(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e,n){let r=0,s="";tb(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(tb(this.data_)){const r=this.data_,s=RF(r,e,n);return s===null?null:new Qs(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new Qs(r,!0)}}static getBlob(...e){if(Bv()){const n=e.map(r=>r instanceof Qs?r.data_:r);return new Qs(AF.apply(null,n))}else{const n=e.map(o=>$v(o)?kF(Wr.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(o=>{for(let l=0;l<o.length;l++)s[i++]=o[l]}),new Qs(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zv(t){let e;try{e=JSON.parse(t)}catch{return null}return wF(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VF(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function MF(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function RN(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FF(t,e){return e}class vn{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||FF}}let Xu=null;function UF(t){return!$v(t)||t.length<2?t:RN(t)}function PN(){if(Xu)return Xu;const t=[];t.push(new vn("bucket")),t.push(new vn("generation")),t.push(new vn("metageneration")),t.push(new vn("name","fullPath",!0));function e(i,o){return UF(o)}const n=new vn("name");n.xform=e,t.push(n);function r(i,o){return o!==void 0?Number(o):o}const s=new vn("size");return s.xform=r,t.push(s),t.push(new vn("timeCreated")),t.push(new vn("updated")),t.push(new vn("md5Hash",null,!0)),t.push(new vn("cacheControl",null,!0)),t.push(new vn("contentDisposition",null,!0)),t.push(new vn("contentEncoding",null,!0)),t.push(new vn("contentLanguage",null,!0)),t.push(new vn("contentType",null,!0)),t.push(new vn("metadata","customMetadata",!0)),Xu=t,Xu}function $F(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new En(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function BF(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const o=n[i];r[o.local]=o.xform(r,e[o.server])}return $F(r,t),r}function kN(t,e,n){const r=zv(e);return r===null?null:BF(t,r,n)}function zF(t,e,n,r){const s=zv(e);if(s===null||!$v(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(d=>{const f=t.bucket,h=t.fullPath,m="/b/"+o(f)+"/o/"+o(h),v=fu(m,n,r),R=SN({alt:"media",token:d});return v+R})[0]}function qF(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nb="prefixes",rb="items";function HF(t,e,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[nb])for(const s of n[nb]){const i=s.replace(/\/$/,""),o=t._makeStorageReference(new En(e,i));r.prefixes.push(o)}if(n[rb])for(const s of n[rb]){const i=t._makeStorageReference(new En(e,s.name));r.items.push(i)}return r}function WF(t,e,n){const r=zv(n);return r===null?null:HF(t,e,r)}class kf{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qv(t){if(!t)throw Uv()}function GF(t,e){function n(r,s){const i=kN(t,s,e);return qv(i!==null),i}return n}function KF(t,e){function n(r,s){const i=WF(t,e,s);return qv(i!==null),i}return n}function QF(t,e){function n(r,s){const i=kN(t,s,e);return qv(i!==null),zF(i,s,t.host,t._protocol)}return n}function Hv(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=iF():s=sF():n.getStatus()===402?s=rF(t.bucket):n.getStatus()===403?s=oF(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function jN(t){const e=Hv(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=nF(t.path)),i.serverResponse=s.serverResponse,i}return n}function YF(t,e,n,r,s){const i={};e.isRoot?i.prefix="":i.prefix=e.path+"/",n.length>0&&(i.delimiter=n),r&&(i.pageToken=r),s&&(i.maxResults=s);const o=e.bucketOnlyServerUrl(),l=fu(o,t.host,t._protocol),c="GET",d=t.maxOperationRetryTime,f=new kf(l,c,KF(t,e.bucket),d);return f.urlParams=i,f.errorHandler=Hv(e),f}function XF(t,e,n){const r=e.fullServerUrl(),s=fu(r,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,l=new kf(s,i,QF(t,n),o);return l.errorHandler=jN(e),l}function JF(t,e){const n=e.fullServerUrl(),r=fu(n,t.host,t._protocol),s="DELETE",i=t.maxOperationRetryTime;function o(c,d){}const l=new kf(r,s,o,i);return l.successCodes=[200,204],l.errorHandler=jN(e),l}function ZF(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function e4(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=ZF(null,e)),r}function t4(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function l(){let E="";for(let I=0;I<2;I++)E=E+Math.random().toString().slice(2);return E}const c=l();o["Content-Type"]="multipart/related; boundary="+c;const d=e4(e,r,s),f=qF(d,n),h="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+f+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,m=`\r
--`+c+"--",v=Qs.getBlob(h,r,m);if(v===null)throw hF();const R={name:d.fullPath},N=fu(i,t.host,t._protocol),C="POST",y=t.maxUploadRetryTime,w=new kf(N,C,GF(t,n),y);return w.urlParams=R,w.headers=o,w.body=v.uploadData(),w.errorHandler=Hv(e),w}class n4{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=so.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=so.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=so.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s,i){if(this.sent_)throw Al("cannot .send() more than once");if(bi(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Al("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Al("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Al("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Al("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class r4 extends n4{initXhr(){this.xhr_.responseType="text"}}function jf(){return new r4}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(e,n){this._service=e,n instanceof En?this._location=n:this._location=En.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new Eo(e,n)}get root(){const e=new En(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return RN(this._location.path)}get storage(){return this._service}get parent(){const e=VF(this._location.path);if(e===null)return null;const n=new En(this._location.bucket,e);return new Eo(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw mF(e)}}function s4(t,e,n){t._throwIfRoot("uploadBytes");const r=t4(t.storage,t._location,PN(),new Qs(e,!0),n);return t.storage.makeRequestWithTokens(r,jf).then(s=>({metadata:s,ref:t}))}function i4(t){const e={prefixes:[],items:[]};return DN(t,e).then(()=>e)}async function DN(t,e,n){const s=await o4(t,{pageToken:n});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await DN(t,e,s.nextPageToken)}function o4(t,e){e!=null&&typeof e.maxResults=="number"&&Tg("options.maxResults",1,1e3,e.maxResults);const n=e||{},r=YF(t.storage,t._location,"/",n.pageToken,n.maxResults);return t.storage.makeRequestWithTokens(r,jf)}function a4(t){t._throwIfRoot("getDownloadURL");const e=XF(t.storage,t._location,PN());return t.storage.makeRequestWithTokens(e,jf).then(n=>{if(n===null)throw fF();return n})}function l4(t){t._throwIfRoot("deleteObject");const e=JF(t.storage,t._location);return t.storage.makeRequestWithTokens(e,jf)}function c4(t,e){const n=MF(t._location.path,e),r=new En(t._location.bucket,n);return new Eo(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u4(t){return/^[A-Za-z]+:\/\//.test(t)}function d4(t,e){return new Eo(t,e)}function ON(t,e){if(t instanceof Wv){const n=t;if(n._bucket==null)throw dF();const r=new Eo(n,n._bucket);return e!=null?ON(r,e):r}else return e!==void 0?c4(t,e):t}function h4(t,e){if(e&&u4(e)){if(t instanceof Wv)return d4(t,e);throw Ig("To use ref(service, url), the first argument must be a Storage instance.")}else return ON(t,e)}function sb(t,e){const n=e==null?void 0:e[IN];return n==null?null:En.makeFromBucketSpec(n,t)}function f4(t,e,n,r={}){t.host=`${e}:${n}`;const s=bi(e);s&&(Ay(`https://${t.host}/b`),Ry("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:yT(i,t.app.options.projectId))}class Wv{constructor(e,n,r,s,i,o=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=bN,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=eF,this._maxUploadRetryTime=tF,this._requests=new Set,s!=null?this._bucket=En.makeFromBucketSpec(s,this._host):this._bucket=sb(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=En.makeFromBucketSpec(this._url,e):this._bucket=sb(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Tg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Tg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(rr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Eo(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new gF(TN());{const o=CF(e,this._appId,r,s,n,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const ib="@firebase/storage",ob="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LN="storage";function ab(t,e,n){return t=tt(t),s4(t,e,n)}function lb(t){return t=tt(t),i4(t)}function cb(t){return t=tt(t),a4(t)}function Vp(t){return t=tt(t),l4(t)}function Rl(t,e){return t=tt(t),h4(t,e)}function Hi(t=Xh(),e){t=tt(t);const r=Ii(t,LN).getImmediate({identifier:e}),s=pT("storage");return s&&p4(r,...s),r}function p4(t,e,n,r={}){f4(t,e,n,r)}function m4(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new Wv(n,r,s,e,No)}function g4(){Cr(new hr(LN,m4,"PUBLIC").setMultipleInstances(!0)),Vn(ib,ob,""),Vn(ib,ob,"esm2020")}g4();const y4={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},Gv=jy(y4),ub=lS(Gv),db=cN(Gv);Hi(Gv);const v4="/odontocloud-react/assets/fondo.png",VN="/odontocloud-react/assets/logo.png",hb=(t,e)=>{const n={email:t,rol:e,timestamp:Date.now()};localStorage.setItem("odc_session",JSON.stringify(n))},Mp=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},_4=()=>{const t=kr(),[e,n]=S.useState(""),[r,s]=S.useState(""),[i,o]=S.useState(""),[l,c]=S.useState(navigator.onLine);S.useEffect(()=>{const h=()=>c(!0),m=()=>c(!1);return window.addEventListener("online",h),window.addEventListener("offline",m),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",m)}},[]);const d=h=>{const m=(h||"").toLowerCase();m==="administrador"?t("/dashboard_admin",{replace:!0}):m==="doctor"?t("/dashboard_doctor",{replace:!0}):m==="recepcionista"?t("/dashboard_recepcion",{replace:!0}):o("Rol no reconocido. Contacte al administrador.")};S.useEffect(()=>{if(!navigator.onLine){const m=Mp();m!=null&&m.rol?d(m.rol):o("Sin conexin y no hay sesin guardada.");return}const h=Uy(ub,async m=>{if(m){const v=Mp();if(v!=null&&v.rol){d(v.rol);return}try{const R=ct(Ie(db,"users"),rt("correo","==",m.email||"")),N=await et(R);if(!N.empty){const C=N.docs[0].data().rol||"sin_rol";hb(m.email||"",C),d(C)}}catch{d("administrador")}}});return()=>h()},[]);const f=async h=>{if(h.preventDefault(),o(""),!l){const m=Mp();m!=null&&m.rol?d(m.rol):o("Sin conexin y no hay sesin guardada.");return}try{const v=(await ZD(ub,e,r)).user,R=ct(Ie(db,"users"),rt("correo","==",e)),N=await et(R);if(N.empty){o("Usuario no encontrado en la base de datos.");return}const y=N.docs[0].data().rol||"sin_rol";hb(e,y),d(y)}catch(m){switch(console.error("Error login:",m),m.code){case"auth/user-not-found":o("Usuario no registrado.");break;case"auth/wrong-password":o("Contrasea incorrecta.");break;case"auth/invalid-email":o("Correo no vlido.");break;case"auth/network-request-failed":o("Sin conexin. Usa la sesin guardada o reconecta.");break;default:o("Error al iniciar sesin.")}}};return a.jsx("div",{className:"login-root",style:{backgroundImage:`url(${v4})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed",width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:a.jsxs("div",{className:"container",children:[a.jsxs("div",{className:"left-panel",children:[a.jsx("img",{src:VN,alt:"OdontoCloud Logo",className:"logo"}),a.jsxs("h2",{children:["Su clnica, ",a.jsx("br",{})," ms conectada."]}),a.jsx("p",{children:"OdontoCloud optimiza cada detalle de su gestin."})]}),a.jsxs("div",{className:"right-panel",children:[a.jsx("h3",{children:"Acceso a la plataforma"}),a.jsxs("form",{onSubmit:f,children:[a.jsx("input",{type:"email",placeholder:"usuario@ejemplo.com",value:e,onChange:h=>n(h.target.value),required:l}),a.jsx("input",{type:"password",placeholder:"Contrasea",value:r,onChange:h=>s(h.target.value),required:l}),a.jsx("button",{type:"submit",children:l?"Iniciar sesin":"Entrar (modo offline)"}),i&&a.jsx("p",{style:{color:"red",marginTop:10},children:i}),!l&&a.jsx("p",{style:{color:"orange",marginTop:10},children:" Modo offline activado"})]})]})]})})},MN="@firebase/installations",Kv="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FN=1e4,UN=`w:${Kv}`,$N="FIS_v2",w4="https://firebaseinstallations.googleapis.com/v1",x4=60*60*1e3,E4="installations",b4="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},bo=new Co(E4,b4,I4);function BN(t){return t instanceof fr&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zN({projectId:t}){return`${w4}/projects/${t}/installations`}function qN(t){return{token:t.token,requestStatus:2,expiresIn:S4(t.expiresIn),creationTime:Date.now()}}async function HN(t,e){const r=(await e.json()).error;return bo.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function WN({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function T4(t,{refreshToken:e}){const n=WN(t);return n.append("Authorization",C4(e)),n}async function GN(t){const e=await t();return e.status>=500&&e.status<600?t():e}function S4(t){return Number(t.replace("s","000"))}function C4(t){return`${$N} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N4({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=zN(t),s=WN(t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={fid:n,authVersion:$N,appId:t.appId,sdkVersion:UN},l={method:"POST",headers:s,body:JSON.stringify(o)},c=await GN(()=>fetch(r,l));if(c.ok){const d=await c.json();return{fid:d.fid||n,registrationStatus:2,refreshToken:d.refreshToken,authToken:qN(d.authToken)}}else throw await HN("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KN(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A4(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R4=/^[cdef][\w-]{21}$/,Sg="";function P4(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=k4(t);return R4.test(n)?n:Sg}catch{return Sg}}function k4(t){return A4(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QN=new Map;function YN(t,e){const n=Df(t);XN(n,e),j4(n,e)}function XN(t,e){const n=QN.get(t);if(n)for(const r of n)r(e)}function j4(t,e){const n=D4();n&&n.postMessage({key:t,fid:e}),O4()}let Yi=null;function D4(){return!Yi&&"BroadcastChannel"in self&&(Yi=new BroadcastChannel("[Firebase] FID Change"),Yi.onmessage=t=>{XN(t.data.key,t.data.fid)}),Yi}function O4(){QN.size===0&&Yi&&(Yi.close(),Yi=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L4="firebase-installations-database",V4=1,Io="firebase-installations-store";let Fp=null;function Qv(){return Fp||(Fp=TT(L4,V4,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Io)}}})),Fp}async function Nh(t,e){const n=Df(t),s=(await Qv()).transaction(Io,"readwrite"),i=s.objectStore(Io),o=await i.get(n);return await i.put(e,n),await s.done,(!o||o.fid!==e.fid)&&YN(t,e.fid),e}async function JN(t){const e=Df(t),r=(await Qv()).transaction(Io,"readwrite");await r.objectStore(Io).delete(e),await r.done}async function Of(t,e){const n=Df(t),s=(await Qv()).transaction(Io,"readwrite"),i=s.objectStore(Io),o=await i.get(n),l=e(o);return l===void 0?await i.delete(n):await i.put(l,n),await s.done,l&&(!o||o.fid!==l.fid)&&YN(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yv(t){let e;const n=await Of(t.appConfig,r=>{const s=M4(r),i=F4(t,s);return e=i.registrationPromise,i.installationEntry});return n.fid===Sg?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function M4(t){const e=t||{fid:P4(),registrationStatus:0};return ZN(e)}function F4(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(bo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=U4(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:$4(t)}:{installationEntry:e}}async function U4(t,e){try{const n=await N4(t,e);return Nh(t.appConfig,n)}catch(n){throw BN(n)&&n.customData.serverCode===409?await JN(t.appConfig):await Nh(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function $4(t){let e=await fb(t.appConfig);for(;e.registrationStatus===1;)await KN(100),e=await fb(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await Yv(t);return r||n}return e}function fb(t){return Of(t,e=>{if(!e)throw bo.create("installation-not-found");return ZN(e)})}function ZN(t){return B4(t)?{fid:t.fid,registrationStatus:0}:t}function B4(t){return t.registrationStatus===1&&t.registrationTime+FN<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function z4({appConfig:t,heartbeatServiceProvider:e},n){const r=q4(t,n),s=T4(t,n),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={installation:{sdkVersion:UN,appId:t.appId}},l={method:"POST",headers:s,body:JSON.stringify(o)},c=await GN(()=>fetch(r,l));if(c.ok){const d=await c.json();return qN(d)}else throw await HN("Generate Auth Token",c)}function q4(t,{fid:e}){return`${zN(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xv(t,e=!1){let n;const r=await Of(t.appConfig,i=>{if(!e1(i))throw bo.create("not-registered");const o=i.authToken;if(!e&&G4(o))return i;if(o.requestStatus===1)return n=H4(t,e),i;{if(!navigator.onLine)throw bo.create("app-offline");const l=Q4(i);return n=W4(t,l),l}});return n?await n:r.authToken}async function H4(t,e){let n=await pb(t.appConfig);for(;n.authToken.requestStatus===1;)await KN(100),n=await pb(t.appConfig);const r=n.authToken;return r.requestStatus===0?Xv(t,e):r}function pb(t){return Of(t,e=>{if(!e1(e))throw bo.create("not-registered");const n=e.authToken;return Y4(n)?{...e,authToken:{requestStatus:0}}:e})}async function W4(t,e){try{const n=await z4(t,e),r={...e,authToken:n};return await Nh(t.appConfig,r),n}catch(n){if(BN(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await JN(t.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Nh(t.appConfig,r)}throw n}}function e1(t){return t!==void 0&&t.registrationStatus===2}function G4(t){return t.requestStatus===2&&!K4(t)}function K4(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+x4}function Q4(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}function Y4(t){return t.requestStatus===1&&t.requestTime+FN<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X4(t){const e=t,{installationEntry:n,registrationPromise:r}=await Yv(e);return r?r.catch(console.error):Xv(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J4(t,e=!1){const n=t;return await Z4(n),(await Xv(n,e)).token}async function Z4(t){const{registrationPromise:e}=await Yv(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e6(t){if(!t||!t.options)throw Up("App Configuration");if(!t.name)throw Up("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Up(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function Up(t){return bo.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t1="installations",t6="installations-internal",n6=t=>{const e=t.getProvider("app").getImmediate(),n=e6(e),r=Ii(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},r6=t=>{const e=t.getProvider("app").getImmediate(),n=Ii(e,t1).getImmediate();return{getId:()=>X4(n),getToken:s=>J4(n,s)}};function s6(){Cr(new hr(t1,n6,"PUBLIC")),Cr(new hr(t6,r6,"PRIVATE"))}s6();Vn(MN,Kv);Vn(MN,Kv,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ah="analytics",i6="firebase_id",o6="origin",a6=60*1e3,l6="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Jv="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tn=new Yh("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c6={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Gn=new Co("analytics","Analytics",c6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u6(t){if(!t.startsWith(Jv)){const e=Gn.create("invalid-gtag-resource",{gtagURL:t});return Tn.warn(e.message),""}return t}function n1(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function d6(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function h6(t,e){const n=d6("firebase-js-sdk-policy",{createScriptURL:u6}),r=document.createElement("script"),s=`${Jv}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function f6(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function p6(t,e,n,r,s,i){const o=r[s];try{if(o)await e[o];else{const c=(await n1(n)).find(d=>d.measurementId===s);c&&await e[c.appId]}}catch(l){Tn.error(l)}t("config",s,i)}async function m6(t,e,n,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const l=await n1(n);for(const c of o){const d=l.find(h=>h.measurementId===c),f=d&&e[d.appId];if(f)i.push(f);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),t("event",r,s||{})}catch(i){Tn.error(i)}}function g6(t,e,n,r){async function s(i,...o){try{if(i==="event"){const[l,c]=o;await m6(t,e,n,l,c)}else if(i==="config"){const[l,c]=o;await p6(t,e,n,r,l,c)}else if(i==="consent"){const[l,c]=o;t("consent",l,c)}else if(i==="get"){const[l,c,d]=o;t("get",l,c,d)}else if(i==="set"){const[l]=o;t("set",l)}else t(i,...o)}catch(l){Tn.error(l)}}return s}function y6(t,e,n,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=g6(i,t,e,n),{gtagCore:i,wrappedGtag:window[s]}}function v6(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Jv)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _6=30,w6=1e3;class x6{constructor(e={},n=w6){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const r1=new x6;function E6(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function b6(t){var o;const{appId:e,apiKey:n}=t,r={method:"GET",headers:E6(n)},s=l6.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let l="";try{const c=await i.json();(o=c.error)!=null&&o.message&&(l=c.error.message)}catch{}throw Gn.create("config-fetch-failed",{httpStatus:i.status,responseMessage:l})}return i.json()}async function I6(t,e=r1,n){const{appId:r,apiKey:s,measurementId:i}=t.options;if(!r)throw Gn.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw Gn.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new C6;return setTimeout(async()=>{l.abort()},a6),s1({appId:r,apiKey:s,measurementId:i},o,l,e)}async function s1(t,{throttleEndTimeMillis:e,backoffCount:n},r,s=r1){var l;const{appId:i,measurementId:o}=t;try{await T6(r,e)}catch(c){if(o)return Tn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:o};throw c}try{const c=await b6(t);return s.deleteThrottleMetadata(i),c}catch(c){const d=c;if(!S6(d)){if(s.deleteThrottleMetadata(i),o)return Tn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:i,measurementId:o};throw c}const f=Number((l=d==null?void 0:d.customData)==null?void 0:l.httpStatus)===503?ex(n,s.intervalMillis,_6):ex(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+f,backoffCount:n+1};return s.setThrottleMetadata(i,h),Tn.debug(`Calling attemptFetch again in ${f} millis`),s1(t,h,r,s)}}function T6(t,e){return new Promise((n,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(n,s);t.addEventListener(()=>{clearTimeout(i),r(Gn.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function S6(t){if(!(t instanceof fr)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class C6{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function N6(t,e,n,r,s){if(s&&s.global){t("event",n,r);return}else{const i=await e,o={...r,send_to:i};t("event",n,o)}}async function A6(t,e,n,r){if(r&&r.global){const s={};for(const i of Object.keys(n))s[`user_properties.${i}`]=n[i];return t("set",s),Promise.resolve()}else{const s=await e;t("config",s,{update:!0,user_properties:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R6(){if(Py())try{await ET()}catch(t){return Tn.warn(Gn.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return Tn.warn(Gn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function P6(t,e,n,r,s,i,o){const l=I6(t);l.then(m=>{n[m.measurementId]=m.appId,t.options.measurementId&&m.measurementId!==t.options.measurementId&&Tn.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>Tn.error(m)),e.push(l);const c=R6().then(m=>{if(m)return r.getId()}),[d,f]=await Promise.all([l,c]);v6(i)||h6(i,d.measurementId),s("js",new Date);const h=(o==null?void 0:o.config)??{};return h[o6]="firebase",h.update=!0,f!=null&&(h[i6]=f),s("config",d.measurementId,h),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k6{constructor(e){this.app=e}_delete(){return delete Ia[this.app.options.appId],Promise.resolve()}}let Ia={},mb=[];const gb={};let $p="dataLayer",j6="gtag",yb,Zv,vb=!1;function D6(){const t=[];if(_T()&&t.push("This is a browser extension environment."),Ok()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,s)=>`(${s+1}) ${r}`).join(" "),n=Gn.create("invalid-analytics-context",{errorInfo:e});Tn.warn(n.message)}}function O6(t,e,n){D6();const r=t.options.appId;if(!r)throw Gn.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)Tn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Gn.create("no-api-key");if(Ia[r]!=null)throw Gn.create("already-exists",{id:r});if(!vb){f6($p);const{wrappedGtag:i,gtagCore:o}=y6(Ia,mb,gb,$p,j6);Zv=i,yb=o,vb=!0}return Ia[r]=P6(t,mb,gb,e,yb,$p,n),new k6(t)}function L6(t=Xh()){t=tt(t);const e=Ii(t,Ah);return e.isInitialized()?e.getImmediate():V6(t)}function V6(t,e={}){const n=Ii(t,Ah);if(n.isInitialized()){const s=n.getImmediate();if(_s(e,n.getOptions()))return s;throw Gn.create("already-initialized")}return n.initialize({options:e})}function M6(t,e,n){t=tt(t),A6(Zv,Ia[t.app.options.appId],e,n).catch(r=>Tn.error(r))}function F6(t,e,n,r){t=tt(t),N6(Zv,Ia[t.app.options.appId],e,n,r).catch(s=>Tn.error(s))}const _b="@firebase/analytics",wb="0.10.19";function U6(){Cr(new hr(Ah,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return O6(r,s,n)},"PUBLIC")),Cr(new hr("analytics-internal",t,"PRIVATE")),Vn(_b,wb),Vn(_b,wb,"esm2020");function t(e){try{const n=e.getProvider(Ah).getImmediate();return{logEvent:(r,s,i)=>F6(n,r,s,i),setUserProperties:(r,s)=>M6(n,r,s)}}catch(n){throw Gn.create("interop-component-reg-failed",{reason:n})}}}U6();const $6={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},Lf=jy($6),Rh=lS(Lf),ce=cN(Lf);Hi(Lf);L6(Lf);const e_=(t,e="")=>{try{return localStorage.getItem(t)??e}catch{return e}},xb=()=>{var t;return((t=document.querySelector('meta[name="company-name"]'))==null?void 0:t.getAttribute("content"))||e_("empresa_nombre","OdontoCloud")},B6=()=>{var t;return((t=document.querySelector('meta[name="company-logo"]'))==null?void 0:t.getAttribute("content"))||e_("empresa_logo_url","")},Eb=()=>{var t;return((t=document.querySelector('meta[name="software-footer"]'))==null?void 0:t.getAttribute("content"))||e_("software_footer_text","Generado por OdontoCloud")},Ju=()=>{const t=new Date;return t.setHours(0,0,0,0),t},Ms=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e},Bp=t=>{const e=new Date(t);return e.setHours(23,59,59,999),e},Fr=(t,e)=>{const n=new Date(t);return n.setDate(n.getDate()+e),n},bb=t=>{const e=new Date(t),n=e.getDay(),r=(n===0?-6:1)-n;return e.setDate(e.getDate()+r),e.setHours(0,0,0,0),e},Ib=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();var jb;const Un=typeof navigator<"u"&&((jb=navigator.language)!=null&&jb.startsWith("es"))?"es-ES":"en-US",zp=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`},Bo=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),z6=t=>{try{const e=new URLSearchParams(t||""),n=e.get("date")||e.get("day")||e.get("d")||e.get("fecha")||e.get("selectedDate")||(typeof sessionStorage<"u"?sessionStorage.getItem("agenda.targetDate"):""),r=String(n||"").slice(0,10);if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return null;const[s,i,o]=r.split("-").map(c=>parseInt(c,10));return new Date(s,(i||1)-1,o||1,0,0,0,0)}catch{return null}};function q6(){const t=yn(),[e,n]=S.useState("day"),[r,s]=S.useState(Ju()),[i,o]=S.useState(Ju()),[l,c]=S.useState(!0),[d,f]=S.useState([]),[h,m]=S.useState(""),[v,R]=S.useState(""),[N,C]=S.useState("");S.useEffect(()=>{const U=z6(t.search);if(U){const ie=Ms(U);s(ie),o(ie),n("day");try{sessionStorage.removeItem("agenda.targetDate")}catch{}}},[t.search]),S.useEffect(()=>{c(!0);const U=Ie(ce,"citas"),ie=ct(U,xn("fecha","asc")),pe=zn(ie,Ne=>{const Ae=Ne.docs.map(je=>{const me=je.data(),Oe=me.horaInicio||me.hora||"00:00",[Fe="0",nt="0"]=Oe.split(":"),G=parseInt(Fe,10)||0,le=parseInt(nt,10)||0;let z;if(me.fecha&&me.fecha.toDate)z=me.fecha.toDate(),z.setHours(G,le,0,0);else if(typeof me.fecha=="string"){const[we,xe,Me]=me.fecha.split("-");z=new Date(parseInt(we,10),parseInt(xe,10)-1,parseInt(Me,10),G,le,0,0)}else me.fecha instanceof Date?(z=new Date(me.fecha),z.setHours(G,le,0,0)):(z=new Date,z.setHours(G,le,0,0));const ae=me.documentoPaciente||me.docPaciente||me.pacienteDocumento||me.documento||"",ue=me.celularPaciente||me.telefonoPaciente||me.celular||me.telefono||"";return{id:je.id,raw:me,fecha:z,horaInicio:Oe,paciente:me.paciente||me.pacienteNombre||"Sin nombre",doctor:me.doctor||me.doctorNombre||"",sucursal:me.sucursal||"",espacio:me.espacio||me.consultorio||"",comentario:me.comentario||"",estado:me.estado||"En espera",recordatorio:me.recordatorio||"",documento:ae,telefono:ue}});let De,be;if(e==="day")De=Ms(r),be=Bp(r);else if(e==="week"){const je=bb(r),me=Fr(je,6);De=Ms(je),be=Bp(me)}else{const je=Ms(r),me=Fr(je,-30),Oe=Fr(je,60);De=Ms(me),be=Bp(Oe)}const at=Ae.filter(je=>je.fecha>=De&&je.fecha<=be);f(at),c(!1)},Ne=>{console.error("Error leyendo citas:",Ne),f([]),c(!1)});return()=>pe()},[e,r]);const y=S.useMemo(()=>{const U=new Set;return d.forEach(ie=>ie.sucursal&&U.add(ie.sucursal)),Array.from(U)},[d]),w=S.useMemo(()=>{const U=new Set;return d.forEach(ie=>ie.doctor&&U.add(ie.doctor)),Array.from(U)},[d]),E=S.useMemo(()=>{const U=N.trim().toLowerCase();return d.filter(ie=>{if(h&&ie.sucursal!==h||v&&ie.doctor!==v)return!1;if(!U)return!0;const pe=[ie.paciente,ie.doctor,ie.comentario,ie.documento,ie.sucursal,ie.espacio,ie.estado],Ne=ie.raw?JSON.stringify(ie.raw):"";return[...pe,Ne].filter(Boolean).some(De=>String(De).toLowerCase().includes(U))})},[d,h,v,N]),I=S.useMemo(()=>l?"Ocupacin: cargando...":E.length===0?"Ocupacin: sin citas para el rango seleccionado.":`Ocupacin: ${E.length} cita${E.length!==1?"s":""} en el rango actual.`,[E,l]),M=S.useMemo(()=>{const U=new Date(i.getFullYear(),i.getMonth(),1),ie=(U.getDay()+6)%7,pe=new Date(U);pe.setDate(pe.getDate()-ie);const Ne=[];for(let Ae=0;Ae<6;Ae++){const De=[];for(let be=0;be<7;be++){const at=new Date(pe),je=at.getMonth()===i.getMonth(),me=Ib(at,Ju()),Oe=Ib(at,r);De.push({date:at,isCurrentMonth:je,isToday:me,isSelected:Oe}),pe.setDate(pe.getDate()+1)}Ne.push(De)}return Ne},[i,r]),$=()=>{const U=new Date(i);U.setMonth(U.getMonth()-1),o(U)},b=()=>{const U=new Date(i);U.setMonth(U.getMonth()+1),o(U)},x=U=>{s(Ms(U)),o(Ms(U)),n("day")},_=S.useMemo(()=>i.toLocaleDateString(Un,{month:"long",year:"numeric"}),[i]),P=S.useMemo(()=>{if(e==="day")return r.toLocaleDateString(Un,{weekday:"long",day:"2-digit",month:"long",year:"numeric"});if(e==="week"){const U=bb(r),ie=Fr(U,6);return U.toLocaleDateString(Un,{day:"2-digit",month:"short"})+" - "+ie.toLocaleDateString(Un,{day:"2-digit",month:"short",year:"numeric"})}return"ltimas citas (detalle)"},[e,r]),D=()=>{s(e==="day"?Fr(r,-1):e==="week"?Fr(r,-7):Fr(r,-1))},j=()=>{s(e==="day"?Fr(r,1):e==="week"?Fr(r,7):Fr(r,1))},k=()=>{const U=Ju();s(U),o(U),n("day")},Y=()=>{var le;const U=z=>String(z??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ie=xb(),pe=B6(),Ne=Eb(),Ae=h||"",De=v||"",be=new Date;be.setHours(0,0,0,0);const at=E.length===0?'<tr class="empty"><td colspan="10">No hay citas registradas para este rango.</td></tr>':E.map((z,ae)=>{var X,ne,O,K,Q,Se;const ue=z.fecha.toLocaleTimeString(Un,{hour:"2-digit",minute:"2-digit",hour12:!0}),we=z.documento||((X=z.raw)==null?void 0:X.documento)||((ne=z.raw)==null?void 0:ne.nroDocumento)||"",xe=((O=z.raw)==null?void 0:O.celularPaciente)||((K=z.raw)==null?void 0:K.celular)||"",Me=((Q=z.raw)==null?void 0:Q.telefonoPaciente)||((Se=z.raw)==null?void 0:Se.telefono)||"",L=new Date(z.fecha.getFullYear(),z.fecha.getMonth(),z.fecha.getDate());let W="Futura";return L.getTime()===be.getTime()?W="Hoy":L.getTime()<be.getTime()&&(W="Pasada"),`<tr class="${ae%2?"zebra":""}">
              <td class="mono">${U(ue)}</td>
              <td>${U(z.paciente)}</td>
              <td class="mono">${U(we)}</td>
              <td class="mono">${U(xe)}</td>
              <td class="mono">${U(Me)}</td>
              <td>${U(z.doctor)}</td>
              <td>${U(z.espacio)}</td>
              <td>${U(z.comentario)}</td>
              <td class="status">${U(z.estado)}</td>
              <td class="actual">${U(W)}</td>
            </tr>`}).join(""),me=`<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Agenda  ${U(ie)}</title>
  <style>
    @page { size: A4 portrait; margin: 14mm 16mm; }
    * { box-sizing: border-box; }
    html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    body { font-family: "Segoe UI", Roboto, Arial, sans-serif; color:#0f172a; line-height:1.35; }

    /* Cabecera */
    .hdr {
      display:flex; flex-direction:column; align-items:center; text-align:center;
      margin-bottom:14px;
    }
    .logo {
      max-height:120px; width:auto; max-width:100%; object-fit:contain;
      filter: drop-shadow(0 1px 0 rgba(0,0,0,.04));
    }
    .brand {
      margin-top:4px; font-weight:800; letter-spacing:.5px; text-transform:uppercase;
      font-size:26px; color:#0a86d8;
    }
    .sub { margin-top:2px; font-size:12px; color:#64748b; }

    /* Tarjeta info Sede/Doctor */
    .info-card {
      width:100%; display:flex; justify-content:center; margin:8px 0 16px;
    }
    .info {
      width:70%; border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; border-collapse:separate;
      font-size:12px;
    }
    .info-row { display:flex; border-top:1px solid #e5e7eb; }
    .info-row:first-child { border-top:0; }
    .label {
      width:22%; padding:8px 10px; background:#f8fafc; font-weight:600; color:#334155; border-right:1px solid #e5e7eb;
    }
    .value { flex:1; padding:8px 10px; }

    /* Tabla principal */
    table { width:100%; border-collapse:separate; border-spacing:0; font-size:12px; }
    thead th {
      background:#0f172a; color:#ffffff; text-align:center; font-weight:700;
      padding:9px 8px; position:relative;
    }
    thead th + th { box-shadow: inset 1px 0 0 rgba(255,255,255,.08); }
    tbody td {
      padding:8px 8px; vertical-align:top; border-bottom:1px solid #e5e7eb;
    }
    tbody tr.zebra td { background:#fafafa; }
    tbody tr.empty td {
      padding:16px; color:#6b7280; text-align:center; background:#fafafa;
      border:1px dashed #e5e7eb; border-radius:8px;
    }
    td.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    td.status { white-space:nowrap; }
    td.actual { font-weight:600; }
    /* Bordes exteriores suaves */
    .tbl-wrap { border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; }

    /* Notas pie */
    .note { margin-top:10px; font-size:10px; color:#6b7280; }

    /* Evitar cortes feos */
    tr, .hdr, .info-card { page-break-inside: avoid; }
  </style>
</head>
<body>
  <div class="hdr">
    ${pe?`<img src="${pe}" alt="Logo" class="logo">`:""}
    <div class="brand">${U(ie)}</div>
    <div class="sub">Agenda de citas  ${U(P)}</div>
  </div>

  <div class="info-card">
    <div class="info">
      <div class="info-row"><div class="label">Sede</div><div class="value">${U(Ae)}</div></div>
      <div class="info-row"><div class="label">Doctor</div><div class="value">${U(De)}</div></div>
    </div>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th style="width:9%">Hora</th>
          <th style="width:17%">Nombre paciente</th>
          <th style="width:12%">Documento</th>
          <th style="width:12%">Celular</th>
          <th style="width:12%">Telfono</th>
          <th style="width:10%">Doctor</th>
          <th style="width:11%">Espacio</th>
          <th>Comentario</th>
          <th style="width:9%">Estado</th>
          <th style="width:9%">Actualidad</th>
        </tr>
      </thead>
      <tbody>${at}</tbody>
    </table>
  </div>

  <div class="note">
    ${U(Ne)}  ${U(new Date().toLocaleString(Un))}
  </div>

  <script>
    window.addEventListener('load', function() {
      try { window.focus(); window.print(); } catch (e) {}
    });
  <\/script>
</body>
</html>`,Oe=new Blob([me],{type:"text/html;charset=utf-8"}),Fe=URL.createObjectURL(Oe),nt=window.open(Fe,"_blank","noopener,noreferrer,width=900,height=700");if(!nt){alert("El navegador bloque la ventana de impresin. Permite pop-ups para este sitio."),URL.revokeObjectURL(Fe);return}const G=()=>{try{URL.revokeObjectURL(Fe)}catch{}};(le=nt.addEventListener)==null||le.call(nt,"load",G),setTimeout(G,15e3)},He=()=>alert("Funcin de confirmar citas se integrar con n8n / correo."),_t=()=>k(),kt=()=>{if(E.length===0){alert("No hay citas para exportar.");return}const U=xb(),ie=Eb(),pe=[`Empresa: ${U}`],Ne=["Fecha","Hora","Paciente","Doctor","Espacio","Comentario"],Ae=E.map(Fe=>{const nt=Fe.fecha.toLocaleDateString(Un),G=Fe.fecha.toLocaleTimeString(Un,{hour:"2-digit",minute:"2-digit",hour12:!0});return[nt,G,Fe.paciente||"",Fe.doctor||"",Fe.espacio||"",(Fe.comentario||"").replace(/\r?\n/g," ")]}),De=[ie],be=[pe,[],Ne,...Ae,[],De].map(Fe=>(Fe||[]).map(nt=>`"${String(nt??"").replace(/"/g,'""')}"`).join(",")).join(`
`),at=`citas_${U.toLowerCase().replace(/\s+/g,"_")}_${zp(Ms(r))}`+(e==="week"?"_semana":e==="detail"?"_detalle":"")+".csv",je=new Blob(["\uFEFF"+be],{type:"text/csv;charset=utf-8;"}),me=URL.createObjectURL(je),Oe=document.createElement("a");Oe.href=me,Oe.download=at,Oe.click(),URL.revokeObjectURL(me)},re=async(U,ie)=>{try{const pe=Ke(ce,"citas",U);await Pn(pe,{estado:ie})}catch(pe){console.error("Error actualizando estado:",pe),alert("No se pudo actualizar el estado de la cita.")}},fe=(U,ie)=>{if(!U){alert("Este paciente no tiene celular registrado.");return}const pe=String(U).replace(/\D/g,""),Ne=ie.fecha.toLocaleDateString(Un),Ae=ie.fecha.toLocaleTimeString(Un,{hour:"numeric",minute:"2-digit",hour12:!0}),De=encodeURIComponent(`Hola ${ie.paciente}, le recordamos su cita odontolgica el ${Ne} a las ${Ae}. Por favor confirme su asistencia.`),be=`https://wa.me/${pe}?text=${De}`;window.open(be,"_blank")},ve=async U=>{if(window.confirm(`Seguro que deseas eliminar la cita de ${U.paciente} del ${U.fecha.toLocaleDateString(Un)}?`))try{const pe=Ke(ce,"citas",U.id);await fs(pe)}catch(pe){console.error("Error eliminando cita:",pe),alert(" No se pudo eliminar la cita.")}},ke=()=>{const U=document.createElement("div");Object.assign(U.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const ie=document.createElement("div");Object.assign(ie.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"}),ie.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Nueva Cita</h2>
      <form id="formNuevaCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label style="font-weight:600;">Paciente existente</label>
        <div style="position:relative;">
          <input type="text" id="buscarPaciente" placeholder="Buscar por nombre, apellido o documento..." autocomplete="off"/>
          <div id="acResultados" style="position:absolute;left:0;right:0;top:calc(100% + 6px);z-index:10000;display:none;background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 8px 22px rgba(0,0,0,.12);max-height:240px;overflow:auto;"></div>
        </div>
        <small style="color:gray;">Si el paciente no existe, marca Registrar nuevo paciente.</small>

        <label style="display:flex;align-items:center;gap:8px;margin-top:5px;">
          <input type="checkbox" id="esNuevoPaciente" />
          <span>Registrar nuevo paciente</span>
        </label>

        <div id="nuevoPacienteCampos" style="display:none;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border-radius:8px;background:#f9f9f9;border:1px solid #ddd;">
          <h4 style="margin:0;text-align:center;color:#0a86d8;">Datos del paciente</h4>
          <div style="display:flex;gap:8px;">
            <input type="text" id="npNombre" placeholder="Nombre" style="flex:1;" />
            <input type="text" id="npApellido" placeholder="Apellido" style="flex:1;" />
          </div>
          <select id="npTipoDocumento">
            <option value="">Tipo de documento</option>
            <option value="CC">Cdula de Ciudadana</option>
            <option value="CE">Cdula de Extranjera</option>
            <option value="TI">Tarjeta de Identidad</option>
            <option value="PA">Pasaporte</option>
            <option value="DI">Documento Internacional</option>
            <option value="OTRO">Otro</option>
          </select>
          <input type="text" id="npDocumento" placeholder="Nmero de documento" />
          <input type="email" id="npCorreo" placeholder="Correo electrnico" />
          <div style="display:flex;gap:5px;">
            <select id="npIndicativo" style="width:40%;">
              <option value="+57"> +57</option>
              <option value="+1"> +1</option>
              <option value="+34"> +34</option>
              <option value="+52"> +52</option>
              <option value="+54"> +54</option>
              <option value="+593"> +593</option>
              <option value="+56"> +56</option>
              <option value="+58"> +58</option>
            </select>
            <input type="tel" id="npCelular" placeholder="Celular (obligatorio)" style="flex:1;" />
          </div>
          <input type="tel" id="npTelefono" placeholder="Telfono fijo (opcional)" />
          <label style="font-weight:500;">Fecha de nacimiento:</label>
          <input type="date" id="npNacimiento" />
          <select id="npSexo">
            <option value="">Sexo</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
            <option value="Otro">Otro</option>
          </select>
          <textarea id="npComentario" placeholder="Comentario o antecedentes del paciente" rows="2"></textarea>
        </div>

        <hr style="margin:10px 0;border:none;border-top:1px solid #ddd;" />
        <h4 style="margin:0;text-align:center;color:#0a86d8;">Detalles de la cita</h4>
        <input type="text" id="ncDoctor" placeholder="Doctor asignado" required />
        <input type="date" id="ncFecha" required value="${zp(r)}" />
        <input type="time" id="ncHora" required />
        <input type="text" id="ncEspacio" placeholder="Espacio fsico / Sala" />
        <textarea id="ncComentario" placeholder="Comentario sobre la cita" rows="3"></textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarModal" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    `;const pe=document.createElement("style");pe.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      input, select, textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      input:focus, select:focus, textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
      .ac-item { padding: 8px 10px; display:flex; gap:8px; align-items:baseline; cursor:pointer; }
      .ac-item:hover, .ac-item.active { background:#f5f7fb; }
      .ac-name { font-weight:600; } .ac-doc { color:#64748b; font-size:12px; } .ac-tel { margin-left:auto; font-size:12px; color:#0f172a; }
      .ac-empty { padding:10px; color:#9aa4b2; font-size:13px; }
    `,document.head.appendChild(pe),U.appendChild(ie),document.body.appendChild(U);const Ne=ie.querySelector("#esNuevoPaciente"),Ae=ie.querySelector("#nuevoPacienteCampos"),De=ie.querySelector("#buscarPaciente"),be=ie.querySelector("#acResultados");Ne.addEventListener("change",()=>{Ae.style.display=Ne.checked?"flex":"none",Ne.checked&&(be.style.display="none")}),ie.querySelector("#btnCancelarModal").addEventListener("click",()=>U.remove());let at=null,je=null,me=-1,Oe=[];const Fe=ue=>{if(Oe=ue||[],me=-1,!ue||ue.length===0){be.innerHTML='<div class="ac-empty">Sin resultados</div>',be.style.display="block";return}be.innerHTML=ue.map((we,xe)=>`
            <div class="ac-item" data-index="${xe}" data-id="${we.id}">
              <span class="ac-name">${we.nombre}</span>
              <span class="ac-doc"> ${we.documento||"s/doc"}</span>
              <span class="ac-tel">${we.celular||we.telefono||""}</span>
            </div>`).join(""),be.style.display="block",[...be.querySelectorAll(".ac-item")].forEach(we=>{we.addEventListener("click",()=>{const xe=Number(we.getAttribute("data-index"));nt(xe)})})},nt=ue=>{const we=Oe[ue];we&&(je=we,De.value=we.nombre,be.style.display="none",Ne.checked=!1,Ae.style.display="none")},G=ue=>{Oe.length&&(me=(me+ue+Oe.length)%Oe.length,[...be.querySelectorAll(".ac-item")].forEach((we,xe)=>{xe===me?we.classList.add("active"):we.classList.remove("active")}))},le=(ue,we)=>ue.nombreCompleto||ue.paciente||[ue.nombres,ue.apellidos].filter(Boolean).join(" ")||we,z=async ue=>{const we=(ue||"").toString().trim(),xe=Bo(we);if(!xe||xe.length<2)return[];if(/^\d{5,}$/.test(we))try{const Me=ct(Ie(ce,"pacientes"),rt("documento","==",we)),L=ct(Ie(ce,"pacientes"),rt("nroDocumento","==",we)),[W,X]=await Promise.all([et(Me),et(L)]),ne=W.empty?X:W;if(!ne.empty)return ne.docs.slice(0,10).map(O=>{const K=O.data()||{};return{id:O.id,nombre:le(K,O.id),documento:K.documento||K.nroDocumento||O.id,celular:K.celularPaciente||K.celular||"",telefono:K.telefonoPaciente||K.telefono||""}})}catch{}try{const Me=ct(Ie(ce,"pacientes"),xn("nombre_busqueda"),YE(xe),XE(xe+""),ba(10)),L=await et(Me);if(!L.empty)return L.docs.map(W=>{const X=W.data()||{};return{id:W.id,nombre:le(X,W.id),documento:X.documento||X.nroDocumento||W.id,celular:X.celularPaciente||X.celular||"",telefono:X.telefonoPaciente||X.telefono||""}})}catch{}try{const Me=ct(Ie(ce,"pacientes"),xn("creado","desc"),ba(50));return(await et(Me)).docs.map(ne=>({id:ne.id,...ne.data()||{}})).map(ne=>({id:ne.id,nombre:le(ne,ne.id),documento:ne.documento||ne.nroDocumento||ne.id,celular:ne.celularPaciente||ne.celular||"",telefono:ne.telefonoPaciente||ne.telefono||"",_norm:Bo(`${ne.nombreCompleto||ne.paciente||""} ${ne.nombres||""} ${ne.apellidos||""} ${ne.documento||ne.nroDocumento||""}`)})).filter(ne=>ne._norm.includes(xe)).slice(0,10).map(({_norm:ne,...O})=>O)}catch{}return[]};De.addEventListener("input",()=>{je=null;const ue=De.value;if(clearTimeout(at),!ue||ue.trim().length<2){be.style.display="none";return}at=setTimeout(async()=>{const we=await z(ue.trim());Fe(we)},220)}),De.addEventListener("keydown",ue=>{be.style.display==="block"&&(ue.key==="ArrowDown"?(ue.preventDefault(),G(1)):ue.key==="ArrowUp"?(ue.preventDefault(),G(-1)):ue.key==="Enter"?me>=0&&(ue.preventDefault(),nt(me)):ue.key==="Escape"&&(be.style.display="none"))}),document.addEventListener("click",ue=>{ie.contains(ue.target)&&!be.contains(ue.target)&&ue.target!==De&&(be.style.display="none")},{capture:!0});const ae=ie.querySelector("#formNuevaCita");ae.addEventListener("submit",async ue=>{ue.preventDefault();const we=Ne.checked,xe=(ae.querySelector("#buscarPaciente").value||"").trim(),Me=ae.querySelector("#ncDoctor").value.trim(),L=ae.querySelector("#ncFecha").value,W=ae.querySelector("#ncHora").value,X=ae.querySelector("#ncEspacio").value.trim(),ne=ae.querySelector("#ncComentario").value.trim();if(!L||!W){alert(" Debes seleccionar fecha y hora para la cita.");return}if(!Me){alert(" Indica el doctor asignado.");return}try{let O=null,K=null,Q="",Se="",Pe="";if(we){const Zt=(ae.querySelector("#npNombre").value||"").trim(),dt=(ae.querySelector("#npApellido").value||"").trim();if(Q=`${Zt} ${dt}`.trim(),!Q){alert(" Debes indicar nombre y apellido para el nuevo paciente.");return}const Dt=(ae.querySelector("#npDocumento").value||"").trim(),Wt=(ae.querySelector("#npCelular").value||"").trim(),Gt=(ae.querySelector("#npTelefono").value||"").trim();if(!Wt&&!Gt){alert(" Debes registrar al menos un telfono (celular o fijo) del paciente o de un acudiente.");return}if(O=Dt||Q.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"_"),K=Ke(ce,"pacientes",O),!(await Bc(K)).exists()){const Ot=Bo(Q);await zc(K,{nombres:Zt,apellidos:dt,nombreCompleto:Q,paciente:Q,nombre_busqueda:Ot,variantes_busqueda:[Ot,Bo(Zt),Bo(dt)],tipoDocumento:ae.querySelector("#npTipoDocumento").value,documento:Dt,correo:(ae.querySelector("#npCorreo").value||"").trim(),indicativo:ae.querySelector("#npIndicativo").value,celular:Wt,telefono:Gt,celularPaciente:Wt,telefonoPaciente:Gt,fechaNacimiento:ae.querySelector("#npNacimiento").value,sexo:ae.querySelector("#npSexo").value,notas:(ae.querySelector("#npComentario").value||"").trim(),creado:new Date().toISOString(),activo:!0,citas:[]},{merge:!0})}Se=Wt,Pe=Gt}else if(je)O=je.id,Q=je.nombre,K=Ke(ce,"pacientes",O),Se=je.celular||"",Pe=je.telefono||"";else{if(!xe){alert(" Por favor, escribe o selecciona un paciente.");return}const Zt=ct(Ie(ce,"pacientes"),rt("documento","==",xe)),dt=ct(Ie(ce,"pacientes"),rt("nroDocumento","==",xe)),[Dt,Wt]=await Promise.all([et(Zt),et(dt)]),Gt=Dt.empty?Wt:Dt;if(Gt.empty){let Ze=null;try{const Ot=Bo(xe),Dr=ct(Ie(ce,"pacientes"),xn("nombre_busqueda"),YE(Ot),XE(Ot+""),ba(1)),pr=await et(Dr);if(!pr.empty){const Cs=pr.docs[0],Mn=Cs.data()||{};Ze={id:Cs.id,ref:Cs.ref,nombre:Mn.nombreCompleto||Mn.paciente||[Mn.nombres,Mn.apellidos].filter(Boolean).join(" "),cel:Mn.celularPaciente||Mn.celular||"",tel:Mn.telefonoPaciente||Mn.telefono||""}}}catch{}Ze?(O=Ze.id,K=Ze.ref,Q=Ze.nombre||xe,Se=Ze.cel||"",Pe=Ze.tel||""):Q=xe}else{const Ze=Gt.docs[0],Ot=Ze.data()||{};O=Ze.id,K=Ze.ref,Q=Ot.nombreCompleto||Ot.paciente||[Ot.nombres,Ot.apellidos].filter(Boolean).join(" ")||xe,Se=Ot.celularPaciente||Ot.celular||"",Pe=Ot.telefonoPaciente||Ot.telefono||""}}if(!(Se||Pe||"").trim()){alert(" Este paciente no tiene ningn telfono registrado. Edita sus datos y agrega un nmero antes de guardar la cita.");return}const jt={paciente:Q||"Paciente",pacienteId:O||null,doctor:Me,fecha:L,horaInicio:W,espacio:X,comentario:ne,estado:"En espera",creado:new Date().toISOString(),celularPaciente:Se||"",telefonoPaciente:Pe||""},Ge=await fn(Ie(ce,"citas"),jt);K&&await zc(K,{citas:ZM(Ge.id)},{merge:!0}),alert(" Cita registrada correctamente y vinculada al paciente."),U.remove()}catch(O){console.error(" Error al guardar cita:",O),alert(" Error al guardar la cita. Revisa la consola para ms detalles.")}})},We=U=>{var at,je;const ie=document.createElement("div");Object.assign(ie.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const pe=document.createElement("div");Object.assign(pe.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"});const Ne=(at=U.raw)!=null&&at.fecha&&typeof U.raw.fecha=="string"?U.raw.fecha:zp(U.fecha),Ae=((je=U.raw)==null?void 0:je.horaInicio)||U.fecha.toTimeString().slice(0,5);pe.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Editar Cita</h2>
      <form id="formEditarCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label>Paciente</label>
        <input type="text" id="editPaciente" value="${U.paciente||""}" />

        <label>Doctor asignado</label>
        <input type="text" id="editDoctor" value="${U.doctor||""}" />

        <div style="display:flex;gap:8px;">
          <div style="flex:1;">
            <label>Fecha</label>
            <input type="date" id="editFecha" value="${Ne}" />
          </div>
          <div style="flex:1;">
            <label>Hora</label>
            <input type="time" id="editHora" value="${Ae}" />
          </div>
        </div>

        <label>Espacio fsico / Sala</label>
        <input type="text" id="editEspacio" value="${U.espacio||""}" />

        <label>Estado</label>
        <select id="editEstado" class="estado-select">
          <option value="En espera" ${U.estado==="En espera"?"selected":""}>En espera</option>
          <option value="En sala" ${U.estado==="En sala"?"selected":""}>En sala</option>
          <option value="Atendiendo" ${U.estado==="Atendiendo"?"selected":""}>Atendiendo</option>
          <option value="Finalizada" ${U.estado==="Finalizada"?"selected":""}>Finalizada</option>
          <option value="pendiente" ${U.estado==="pendiente"?"selected":""}>Pendiente</option>
          <option value="No asisti" ${U.estado==="No asisti"?"selected":""}>No asisti</option>
        </select>

        <label>Comentario</label>
        <textarea id="editComentario" rows="3">${U.comentario||""}</textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarEdit" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar cambios</button>
        </div>
      </form>
    `;const De=document.createElement("style");De.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      #formEditarCita input, #formEditarCita select, #formEditarCita textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      #formEditarCita input:focus, #formEditarCita select:focus, #formEditarCita textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
    `,document.head.appendChild(De),ie.appendChild(pe),document.body.appendChild(ie),pe.querySelector("#btnCancelarEdit").addEventListener("click",()=>ie.remove());const be=pe.querySelector("#formEditarCita");be.addEventListener("submit",async me=>{me.preventDefault();const Oe=be.querySelector("#editPaciente").value.trim(),Fe=be.querySelector("#editDoctor").value.trim(),nt=be.querySelector("#editFecha").value,G=be.querySelector("#editHora").value,le=be.querySelector("#editEspacio").value.trim(),z=be.querySelector("#editEstado").value,ae=be.querySelector("#editComentario").value.trim();if(!Oe)return alert(" El nombre del paciente es obligatorio.");if(!nt||!G)return alert(" Debes indicar fecha y hora.");try{const ue=Ke(ce,"citas",U.id);await Pn(ue,{paciente:Oe,doctor:Fe,fecha:nt,horaInicio:G,espacio:le,estado:z,comentario:ae}),alert(" Cita actualizada correctamente."),ie.remove()}catch(ue){console.error(" Error al actualizar cita:",ue),alert(" Error al actualizar la cita. Revisa la consola para ms detalles.")}})},It=U=>{const ie=U.fecha.toLocaleDateString(Un),pe=U.fecha.toLocaleTimeString(Un,{hour:"numeric",minute:"2-digit",hour12:!0}),Ne=`${ie}  ${pe}`;return a.jsxs("tr",{className:"fade-in-row",onClick:()=>We(U),style:{cursor:"pointer"},children:[a.jsx("td",{children:Ne}),a.jsx("td",{children:U.paciente}),a.jsx("td",{children:U.doctor}),a.jsx("td",{children:U.espacio}),a.jsx("td",{children:U.comentario}),a.jsx("td",{onClick:Ae=>{Ae.stopPropagation()},children:a.jsxs("select",{className:"estado-select",value:U.estado,onChange:Ae=>re(U.id,Ae.target.value),children:[a.jsx("option",{value:"En espera",children:"En espera"}),a.jsx("option",{value:"En sala",children:"En sala"}),a.jsx("option",{value:"Atendiendo",children:"Atendiendo"}),a.jsx("option",{value:"Finalizada",children:"Finalizada"}),a.jsx("option",{value:"pendiente",children:"Pendiente"}),a.jsx("option",{value:"No asisti",children:"No asisti"})]})}),a.jsxs("td",{className:"acciones-cell",onClick:Ae=>{Ae.stopPropagation()},children:[U.telefono?a.jsx("button",{type:"button",className:"btn-whatsapp",onClick:Ae=>{Ae.stopPropagation(),fe(U.telefono,U)},children:"WhatsApp"}):a.jsx("span",{className:"acciones-texto",children:"Sin celular"}),a.jsx("button",{type:"button",className:"btn-delete",onClick:Ae=>{Ae.stopPropagation(),ve(U)},children:"Eliminar"}),U.recordatorio&&a.jsx("span",{className:"acciones-texto",children:U.recordatorio})]})]},U.id)};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"odc-topbar-green"}),a.jsx("div",{className:"odc-topbar-blue",children:"Agenda"}),a.jsx("section",{className:"odc-agenda-root",children:a.jsxs("div",{className:"odc-agenda-inner",children:[a.jsxs("aside",{className:"odc-left","aria-label":"Panel izquierdo - calendario y filtros",children:[a.jsxs("div",{className:"odc-mini-calendar-card",role:"region","aria-label":"Mini calendario",children:[a.jsxs("div",{className:"mini-cal-header",children:[a.jsx("button",{className:"cal-arrow",id:"miniCalPrev","aria-label":"Mes anterior",onClick:$,children:""}),a.jsx("div",{id:"miniCalMonthYear","aria-live":"polite",children:_}),a.jsx("button",{className:"cal-arrow",id:"miniCalNext","aria-label":"Mes siguiente",onClick:b,children:""})]}),a.jsxs("table",{className:"mini-month-table","aria-hidden":"false",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Lu"}),a.jsx("th",{children:"Ma"}),a.jsx("th",{children:"Mi"}),a.jsx("th",{children:"Ju"}),a.jsx("th",{children:"Vi"}),a.jsx("th",{children:"Sa"}),a.jsx("th",{children:"Do"})]})}),a.jsx("tbody",{id:"miniCalendar",children:M.map((U,ie)=>a.jsx("tr",{children:U.map((pe,Ne)=>a.jsx("td",{className:[pe.isCurrentMonth?"":"empty",pe.isToday?"today":"",pe.isSelected?"selected":""].filter(Boolean).join(" "),onClick:()=>pe.isCurrentMonth&&x(pe.date),children:pe.date.getDate()},Ne))},ie))})]})]}),a.jsxs("div",{className:"odc-filters-card","aria-label":"Filtros de agenda",children:[a.jsx("label",{htmlFor:"filterSucursal",children:"Sucursal"}),a.jsxs("select",{id:"filterSucursal",value:h,onChange:U=>m(U.target.value),children:[a.jsx("option",{value:"",children:" Todas "}),y.map(U=>a.jsx("option",{value:U,children:U},U))]}),a.jsx("label",{htmlFor:"filterDoctor",children:"Doctores"}),a.jsxs("select",{id:"filterDoctor",value:v,onChange:U=>R(U.target.value),children:[a.jsx("option",{value:"",children:" Todos "}),w.map(U=>a.jsx("option",{value:U,children:U},U))]})]})]}),a.jsxs("main",{className:"odc-right","aria-label":"Panel principal - agenda",children:[a.jsxs("div",{className:"odc-header-bar",role:"region","aria-label":"Controles de la agenda",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[a.jsxs("div",{className:"odc-header-left",style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[a.jsx("h3",{className:"odc-title",style:{marginRight:8},children:"Agenda"}),a.jsxs("div",{className:"view-buttons",role:"tablist","aria-label":"Vistas",style:{display:"flex",gap:6},children:[a.jsx("button",{className:`btn view ${e==="day"?"active":""}`,"data-view":"day",role:"tab","aria-selected":e==="day",onClick:()=>n("day"),children:"Da"}),a.jsx("button",{className:`btn view ${e==="week"?"active":""}`,"data-view":"week",role:"tab","aria-selected":e==="week",onClick:()=>n("week"),children:"Semana"}),a.jsx("button",{className:`btn view ${e==="detail"?"active":""}`,"data-view":"detail",role:"tab","aria-selected":e==="detail",onClick:()=>n("detail"),children:"Detalle"})]}),a.jsxs("div",{className:"date-nav",style:{display:"flex",alignItems:"center",gap:6,flex:"0 0 auto"},children:[a.jsx("button",{className:"btn icon",id:"btnPrev","aria-label":"Anterior",onClick:D,children:""}),a.jsx("button",{className:"btn icon",id:"btnNext","aria-label":"Siguiente",onClick:j,children:""}),a.jsx("span",{id:"currentDateDisplay",className:"current-date","aria-live":"polite",style:{whiteSpace:"nowrap"},children:P}),a.jsx("button",{id:"btnHoy",className:"btn small",onClick:k,children:"Hoy"})]})]}),a.jsx("div",{className:"odc-header-right",style:{display:"flex",alignItems:"center",gap:8,flexShrink:0},children:a.jsxs("div",{className:"right-actions",style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("input",{id:"searchCitas",placeholder:"Buscar...",className:"search-input","aria-label":"Buscar citas",value:N,onChange:U=>C(U.target.value)}),a.jsx("button",{id:"btnNuevaCita",className:"btn green","aria-label":"Nueva cita",onClick:ke,children:"+ Nueva cita"})]})})]}),a.jsxs("div",{className:"odc-content-card",role:"region","aria-label":"Contenido agenda",children:[a.jsxs("div",{className:"tools-row",children:[a.jsx("div",{className:"tools-left",children:a.jsx("div",{id:"ocupacionInfo",className:"ocupacion-info",children:I})}),a.jsxs("div",{className:"tools-right",children:[a.jsx("button",{id:"btnPrint",className:"btn",title:"Imprimir agenda",onClick:Y,children:" Imprimir"}),a.jsx("button",{id:"btnConfirmar",className:"btn blue",title:"Confirmar citas",onClick:He,children:" Confirmar"}),a.jsx("button",{id:"btnHoyCitas",className:"btn",title:"Ver citas de hoy",onClick:_t,children:" Hoy"}),a.jsx("button",{id:"btnExportar",className:"btn",title:"Exportar citas a CSV",onClick:kt,children:" Exportar"})]})]}),a.jsx("div",{className:"table-wrap",role:"region","aria-label":"Lista de citas",children:a.jsxs("table",{className:"appointments-table","aria-live":"polite",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:{width:"180px"},children:"Fecha / Hora"}),a.jsx("th",{children:"Paciente"}),a.jsx("th",{children:"Doctor"}),a.jsx("th",{children:"Espacio fsico"}),a.jsx("th",{children:"Comentario"}),a.jsx("th",{style:{width:"120px"},children:"Estado"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{id:"citasTbody",children:l?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"no-data",children:"Cargando citas..."})}):E.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"no-data",children:"No hay citas registradas para este rango."})}):E.map(It)})]})})]})]})]})})]})}function H6(){return a.jsxs("div",{style:{padding:"20px"},children:[a.jsx("h2",{children:"Mdulo de Facturacin"}),a.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function W6(){return a.jsxs("div",{style:{padding:"20px"},children:[a.jsx("h2",{children:"Mdulo de Facturacin"}),a.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function G6(){return a.jsxs("div",{style:{padding:"20px"},children:[a.jsx("h2",{children:"Mdulo de Facturacin"}),a.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}const Zu={caja:"caja",pagos:"facturacion/pagos",facturas:"facturacion/facturas"};var Db;const zl=typeof navigator<"u"&&((Db=navigator.language)!=null&&Db.startsWith("es"))?"es-ES":"en-US",K6=["Colombia","Argentina","Bolivia","Chile","Costa Rica","Cuba","Ecuador","El Salvador","Espaa","Guatemala","Honduras","Mxico","Nicaragua","Panam","Paraguay","Per","Puerto Rico","Repblica Dominicana","Uruguay","Venezuela","Estados Unidos","Canad"],qp={Colombia:["Bogot","Medelln","Cali","Barranquilla","Cartagena","Ccuta","Bucaramanga","Pereira","Santa Marta","Ibagu"],Mxico:["Ciudad de Mxico","Guadalajara","Monterrey","Puebla","Quertaro","Tijuana","Mrida","Len"],Per:["Lima","Arequipa","Trujillo","Chiclayo","Cusco","Piura"],Chile:["Santiago","Valparaso","Concepcin","La Serena","Antofagasta"],Argentina:["Buenos Aires","Crdoba","Rosario","Mendoza","La Plata"],Espaa:["Madrid","Barcelona","Valencia","Sevilla","Zaragoza","Bilbao"],"Estados Unidos":["Miami","New York","Los ngeles","Houston","Chicago"],Ecuador:["Quito","Guayaquil","Cuenca","Manta"],Venezuela:["Caracas","Maracaibo","Valencia","Barquisimeto","Maracay"]},Q6=t=>{if(!t)return"";const[e,n,r]=t.split("-").map(c=>parseInt(c,10)),s=new Date(e,(n||1)-1,r||1),i=new Date;let o=i.getFullYear()-s.getFullYear();const l=i.getMonth()-s.getMonth();return(l<0||l===0&&i.getDate()<s.getDate())&&o--,isNaN(o)?"":String(o)};async function Tb(t,{maxW:e=900,maxH:n=900,quality:r=.82}={}){var m;if(!t||!((m=t.type)!=null&&m.startsWith("image/")))return t;const s=await new Promise((v,R)=>{const N=new Image;N.onload=()=>v(N),N.onerror=R,N.src=URL.createObjectURL(t)});let{width:i,height:o}=s;const l=Math.min(e/i,n/o,1);i=Math.round(i*l),o=Math.round(o*l);const c=document.createElement("canvas");c.width=i,c.height=o,c.getContext("2d").drawImage(s,0,0,i,o);const f=await new Promise(v=>c.toBlob(v,"image/jpeg",r)),h=new File([f],(t.name||"foto.jpg").replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return URL.revokeObjectURL(s.src),h}const ql=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),Y6=t=>ql([t.nombres,t.apellidos,t.nombreCompleto,t.nroDocumento,t.celular,t.email].filter(Boolean).join(" ")),X6=t=>{if(!t)return"";const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}-${r}-${s}T${i}:${o}`},J6=t=>{try{return new Date(t).toLocaleString(zl,{dateStyle:"medium",timeStyle:"short"})}catch{return""}},zo={tipoDocumento:"",nroDocumento:"",nroHistoria:"",nombres:"",apellidos:"",nombreCompleto:"",sexo:"",estadoCivil:"",paisNacimiento:"",ciudadNacimiento:"",fechaIngreso:"",fechaNacimiento:"",edad:"",paisDomicilio:"",ciudadDomicilio:"",barrio:"",lugarResidencia:"",estrato:"",zonaResidencial:"",esExtranjero:!1,permitePublicidad:!1,celular:"",telDomicilio:"",telOficina:"",extension:"",email:"",ocupacion:"",nombreResponsable:"",parentesco:"",celularResponsable:"",telefonoResponsable:"",emailResponsable:"",nombreAcompanante:"",telefonoAcompanante:"",convenioBeneficio:"",comoConocio:"",campania:"",remitidoPor:"",asesorComercial:"",tipoVinculacion:"",nombreEps:"",polizaSalud:"",doctor:"",notas:"",rxImagenes:[],historiaClinica:{antecedentes:"",alergias:"",medicamentos:"",motivoConsulta:"",notas:""},odontograma:[],periodontograma:[],presupuestos:[],evoluciones:[],facturacion:{saldoFavor:0,saldoCredito:0},fotoUrl:"",activo:!0},Hp=20,qo=t=>Number(t||0);function Z6(t){const[e,n]=S.useState(!1),[r,s]=S.useState([]),[i,o]=S.useState([]),[l,c]=S.useState("");S.useEffect(()=>{let C=!0;return(async()=>{if(!t){s([]),o([]);return}n(!0),c("");try{let w=ct(Ie(ce,"facturas"),rt("patientId","==",t),xn("fechaISO","desc"));const M=(await et(w)).docs.map(P=>({id:P.id,...P.data()})).map(P=>({...P,total:qo(P.total??P.valor??P.montoTotal),estado:(P.estado||"pendiente").toLowerCase(),fechaISO:P.fechaISO||P.fecha||null}));let $=ct(Ie(ce,"pagos"),rt("patientId","==",t),xn("fechaISO","desc"));const _=(await et($)).docs.map(P=>({id:P.id,...P.data()})).map(P=>({...P,monto:qo(P.monto??P.valor??P.total),fechaISO:P.fechaISO||P.fecha||null,medio:P.medio||P.metodo||""}));if(!C)return;s(M),o(_)}catch(w){console.warn("Finanzas: no se pudo leer colecciones. Contino solo con saldos del paciente.",w),C&&c("No se pudieron leer facturas/pagos.")}finally{C&&n(!1)}})(),()=>{C=!1}},[t]);const d=r.reduce((C,y)=>C+qo(y.total),0),f=i.reduce((C,y)=>C+qo(y.monto),0),h=r.filter(C=>["pagada","pagado","paid"].includes((C.estado||"").toLowerCase())),m=r.filter(C=>["pendiente","abierta","open","deuda"].includes((C.estado||"").toLowerCase())),v=h.reduce((C,y)=>C+qo(y.total),0),R=m.reduce((C,y)=>C+qo(y.total),0);return{loading:e,error:l,facturas:r,pagos:i,totalFacturado:d,totalPagado:f,totalFacturasPendientes:R,totalFacturasPagadas:v}}function eU(t){const[e,n]=S.useState(!1),[r,s]=S.useState([]);return S.useEffect(()=>{if(!t){s([]);return}n(!0);const i=Ie(ce,"citas"),o=v=>{const R=v.data()||{},N=typeof R.fecha=="string"?R.fecha:"",C=(R.horaInicio||R.hora||"00:00").slice(0,5);let y=null;if(N){const[w,E,I]=N.split("-").map(x=>parseInt(x,10)),[M,$]=C.split(":").map(x=>parseInt(x,10)||0);y=new Date(w,(E||1)-1,I||1,M,$,0,0).toISOString()}return{id:v.id,...R,fechaISO:y,motivo:R.motivo||R.comentario||"",profesional:R.doctor||R.doctorNombre||"",fechaYYYYMMDD:N}};let l=new Map;const c=()=>{const v=Array.from(l.values());v.sort((R,N)=>{const C=R.fechaISO||"",y=N.fechaISO||"";if(C<y)return 1;if(C>y)return-1;const w=R.creado||"",E=N.creado||"";return w<E?1:w>E?-1:0}),s(v),n(!1)},d=ct(i,rt("pacienteId","==",t)),f=ct(i,rt("patientId","==",t)),h=zn(d,v=>{v.docChanges().forEach(R=>{R.type==="removed"?l.delete(R.doc.id):l.set(R.doc.id,o(R.doc))}),c()},()=>n(!1)),m=zn(f,v=>{v.docChanges().forEach(R=>{R.type==="removed"?l.delete(R.doc.id):l.set(R.doc.id,o(R.doc))}),c()},()=>n(!1));return()=>{try{h()}catch{}try{m()}catch{}}},[t]),{loading:e,citas:r}}function tU(){var Dr,pr,Cs,Mn,es,pu,mu,Ai,il;const t=kr(),e=yn(),n=Pg.useMemo(()=>{const T=e.pathname.split("/").filter(Boolean),H=T.findIndex(Ee=>["pacientes","agenda","caja","facturacion","config","reportes","software"].includes(Ee)),ge="/"+T.slice(0,H>=0?H:T.length).join("/");return ge==="/"?"":ge},[e.pathname]),r=T=>{const H=String(T||"").replace(/^\//,""),te=n?`${n}/`:"/";t(`${te}${H}`)},s=(T,H)=>{const te=String(T).replace(/^\//,""),ge=H?new URLSearchParams(H).toString():"";return`${n?`${n}/`:"/"}${te}${ge?`?${ge}`:""}`},i=(T,H)=>{const te=String(T||"").slice(0,10);if(!te)return r("agenda");try{sessionStorage.setItem("agenda.targetDate",te)}catch{}const ge=new URLSearchParams({date:te,day:te,d:te,fecha:te,selectedDate:te,ts:String(new Date(te+"T00:00:00").getTime()),patientId:H||""}).toString();r(`agenda?${ge}`)},[o,l]=S.useState(!0),[c,d]=S.useState([]),[f,h]=S.useState(""),[m,v]=S.useState(null),[R,N]=S.useState(!0),[C,y]=S.useState(!1),[w,E]=S.useState(null),[I,M]=S.useState(null),$=S.useRef(null),[b,x]=S.useState("datos"),[_,P]=S.useState(zo),[D,j]=S.useState(null),[k,Y]=S.useState(""),[He,_t]=S.useState([]),[kt,re]=S.useState(!1),fe=S.useRef(null),ve="comfy",[ke,We]=S.useState(""),It=S.useMemo(()=>{switch(ve){case"comfy":return{thumbW:220,thumbH:165,colMin:240};case"cozy":return{thumbW:160,thumbH:120,colMin:180};default:return{thumbW:120,thumbH:90,colMin:140}}},[ve]),U=T=>{var te,ge;if((ge=(te=T==null?void 0:T.type)==null?void 0:te.startsWith)!=null&&ge.call(te,"image/"))return!0;const H=((T==null?void 0:T.name)||(T==null?void 0:T.title)||"").toLowerCase();return/\.(png|jpe?g|gif|bmp|webp|tiff?)$/.test(H)},ie=S.useMemo(()=>{const T=ke.trim().toLowerCase(),H=Array.isArray(I==null?void 0:I.rxImagenes)?I.rxImagenes:[];let te=H;return T?te=H.filter(ge=>`${ge.name||""} ${ge.title||""} ${ge.desc||""}`.toLowerCase().includes(T)):te=H.slice(),te.sort((ge,Ee)=>{const Je=ge.uploadedAtMS??ge.created??0;return(Ee.uploadedAtMS??Ee.created??0)-Je}),te},[I==null?void 0:I.rxImagenes,ke]),pe=async(T,H)=>{if(!(I!=null&&I.id))return;const te=Array.isArray(I.rxImagenes)?[...I.rxImagenes]:[];te[T]={...te[T]||{},...H},await Q({rxImagenes:te})},Ne=()=>{const T=new Date,H=T.getFullYear(),te=String(T.getMonth()+1).padStart(2,"0"),ge=String(T.getDate()).padStart(2,"0");return`${H}-${te}-${ge}`},[Ae,De]=S.useState(Ne()),[be,at]=S.useState(""),[je,me]=S.useState(""),[Oe,Fe]=S.useState(""),[nt,G]=S.useState("");S.useEffect(()=>{me((I==null?void 0:I.doctor)||"")},[I==null?void 0:I.doctor,I==null?void 0:I.id]);const le=async()=>{if(!(I!=null&&I.id))return alert("Paciente no cargado.");if(!Ae)return alert("Selecciona la fecha.");if(!be)return alert("Selecciona la hora.");if(!je.trim())return alert("Indica el doctor.");const T=I.nombreCompleto||I.paciente||"Paciente",H=I.celular||I.celularPaciente||"",te=I.telDomicilio||I.telefonoPaciente||"";if(!H&&!te)return alert("Este paciente no tiene telfono registrado (celular o fijo). Agrega uno antes de crear la cita.");try{const ge={paciente:T,pacienteId:I.id,doctor:je.trim(),fecha:Ae,horaInicio:be,espacio:Oe||"",comentario:nt||"",estado:"En espera",creado:new Date().toISOString(),celularPaciente:H,telefonoPaciente:te};await fn(Ie(ce,"citas"),ge),at(""),Fe(""),G(""),alert(" Cita creada. Ya aparece en la lista y en Agenda.")}catch(ge){console.error("Error creando cita:",ge),alert("No se pudo crear la cita.")}};S.useMemo(()=>qp[_.paisNacimiento]||[],[_.paisNacimiento]),S.useEffect(()=>((async()=>{l(!0);try{const te=(await et(Ie(ce,"eps"))).docs.map(Ee=>{var Je;return(Je=Ee.data())==null?void 0:Je.nombre}).filter(Boolean),ge=Array.from(new Map(te.map(Ee=>[String(Ee).toLowerCase(),Ee])).values()).sort((Ee,Je)=>Ee.localeCompare(Je,"es"));_t(ge),await we(!0)}catch(H){console.error(H),alert("No se pudieron cargar pacientes/EPS.")}finally{l(!1)}})(),()=>{$.current&&($.current(),$.current=null)}),[]),S.useEffect(()=>{P(T=>({...T,nombreCompleto:`${T.nombres} ${T.apellidos}`.trim()}))},[_.nombres,_.apellidos]),S.useEffect(()=>{P(T=>({...T,nroHistoria:T.nroDocumento}))},[_.nroDocumento]),S.useEffect(()=>{P(T=>({...T,edad:Q6(T.fechaNacimiento)}))},[_.fechaNacimiento]),S.useEffect(()=>{const T=new Date,H=T.toLocaleDateString(zl)+" - "+T.toLocaleTimeString(zl,{hour:"2-digit",minute:"2-digit",hour12:!0});P(te=>({...te,fechaIngreso:H}))},[]);const z=(T,H)=>P(te=>({...te,[T]:H})),ae=()=>{P(zo);const T=new Date,H=T.toLocaleDateString(zl)+" - "+T.toLocaleTimeString(zl,{hour:"2-digit",minute:"2-digit",hour12:!0});P(te=>({...te,fechaIngreso:H})),j(null),Y(""),E(null)},ue=async T=>{if(!T){j(null),Y("");return}try{const H=await Tb(T,{maxW:900,maxH:900,quality:.82});j(H);const te=new FileReader;te.onload=ge=>Y(ge.target.result),te.readAsDataURL(H)}catch{j(T);const H=new FileReader;H.onload=te=>Y(te.target.result),H.readAsDataURL(T)}},we=async(T=!1)=>{l(!0);try{let H;T||!m?H=ct(Ie(ce,"pacientes"),xn("creado","desc"),ba(Hp)):H=ct(Ie(ce,"pacientes"),xn("creado","desc"),GM(m),ba(Hp));const te=await et(H),ge=te.docs.map(Ee=>({id:Ee.id,...Ee.data()}));d(T?ge:Ee=>[...Ee,...ge]),v(te.docs[te.docs.length-1]||null),N(te.size===Hp)}catch(H){console.error(H),alert("No se pudo cargar pacientes.")}finally{l(!1)}},xe=async T=>{if(T.preventDefault(),!_.nroDocumento.trim())return alert("El nmero de documento es obligatorio.");if(!_.nombres.trim())return alert("Los nombres son obligatorios.");if(!_.apellidos.trim())return alert("Los apellidos son obligatorios.");if(!_.sexo.trim())return alert("El sexo es obligatorio.");if(!_.fechaNacimiento.trim())return alert("La fecha de nacimiento es obligatoria.");if(!_.celular.trim())return alert("El celular es obligatorio.");if(!_.email.trim())return alert("El correo electrnico es obligatorio.");if(!_.tipoVinculacion.trim())return alert("El tipo de vinculacin es obligatorio.");if(!_.nombreEps.trim())return alert("El nombre de la EPS es obligatorio.");try{const H=_.nroDocumento.trim();if(!w&&(await Bc(Ke(ce,"pacientes",H))).exists())return alert("Ya existe un paciente con ese nmero de documento.");const te=(_.nombreEps||"").trim(),ge=He.map(Lt=>Lt.toLowerCase()).includes(te.toLowerCase());if(te&&!ge&&window.confirm(`La EPS "${te}" no existe. Deseas guardarla para futuras selecciones?`)){const Nn=te.toLowerCase().replace(/\s+/g,"_");await zc(Ke(ce,"eps",Nn),{nombre:te,nombreLower:te.toLowerCase(),creado:er()},{merge:!0})}let Ee=_.fotoUrl||"",Je="";if(D)try{const Lt=Hi(),Nn=(D.name||"foto.jpg").replace(/\s+/g,"_");Je=`pacientes/${H}/${Date.now()}_${Nn}`;const An=Rl(Lt,Je),mr={contentType:D.type||"image/jpeg",cacheControl:"public, max-age=86400"};await ab(An,D,mr),Ee=await cb(An)}catch(Lt){console.error("Foto (warning):",Lt)}const Or=_.creado||null,Jn=w&&Or||er(),Zn={..._,fotoUrl:Ee,nombre_busqueda:Y6({..._,fotoUrl:Ee}),nombresLower:ql(_.nombres),apellidosLower:ql(_.apellidos),documentoLower:ql(_.nroDocumento),emailLower:ql(_.email),creado:Jn,createdAt:Jn,actualizado:er(),updatedAt:er(),activo:_.activo??!0,celularPaciente:_.celular,telefonoPaciente:_.telDomicilio||"",documento:_.nroDocumento,paciente:_.nombreCompleto};if(await zc(Ke(ce,"pacientes",H),Zn,{merge:!0}),Je)try{const Lt=Hi(),Nn=Rl(Lt,`pacientes/${H}`),An=await lb(Nn),mr=Je,ts=An.items.filter(ns=>ns.fullPath!==mr).map(ns=>Vp(ns).catch(()=>null));await Promise.allSettled(ts)}catch(Lt){console.warn("No se pudo limpiar fotos antiguas:",Lt)}alert(w?" Paciente actualizado.":" Paciente guardado."),d(Lt=>{const Nn=Lt.filter(An=>An.id!==H);return[{id:H,...Zn},...Nn]}),y(!1),E(null),ae()}catch(H){console.error("Error guardando paciente:",H),alert(`No se pudo guardar el paciente.

`+((H==null?void 0:H.message)||H))}},Me=()=>{ae(),y(!0)},L=()=>{I&&(P({...zo,...I,fotoUrl:I.fotoUrl||""}),j(null),Y(I.fotoUrl||""),E(I.id),O(),y(!0))},W=async T=>{if(window.confirm(`Eliminar al paciente "${T.nombreCompleto}"?`))try{await fs(Ke(ce,"pacientes",T.id)),d(H=>H.filter(te=>te.id!==T.id));try{const H=Hi(),te=Rl(H,`pacientes/${T.id}`),Ee=(await lb(te)).items.map(Je=>Vp(Je).catch(()=>null));await Promise.allSettled(Ee)}catch(H){console.warn("No se pudo borrar la carpeta de fotos:",H)}}catch(H){console.error(H),alert("No se pudo eliminar.")}},X=S.useMemo(()=>{const T=f.trim().toLowerCase();return T?c.filter(H=>`${H.nombreCompleto||H.paciente||""} ${H.nroDocumento||""} ${H.celular||H.celularPaciente||""} ${H.email||""}`.toLowerCase().includes(T)):c},[c,f]),ne=T=>{O();const H=Ke(ce,"pacientes",T.id),te=zn(H,ge=>{ge.exists()?M({id:ge.id,...K(ge.data())}):M(null)});$.current=te,x("datos")},O=()=>{$.current&&($.current(),$.current=null),M(null)},K=T=>({...zo,...T,historiaClinica:{...zo.historiaClinica,...T.historiaClinica||{}},facturacion:{...zo.facturacion,...T.facturacion||{}},rxImagenes:Array.isArray(T.rxImagenes)?T.rxImagenes:[],odontograma:Array.isArray(T.odontograma)?T.odontograma:[],periodontograma:Array.isArray(T.periodontograma)?T.periodontograma:[],presupuestos:Array.isArray(T.presupuestos)?T.presupuestos:[],evoluciones:Array.isArray(T.evoluciones)?T.evoluciones:[]}),Q=async T=>{if(I!=null&&I.id)try{await Pn(Ke(ce,"pacientes",I.id),{...T,actualizado:er(),updatedAt:er()})}catch(H){console.error(H),alert("No se pudo actualizar.")}},Se=async T=>{var te;if(!(I!=null&&I.id)||!(T!=null&&T.length))return;const H=Hi();try{re(!0);const ge=[];for(const Ee of T){let Je=Ee;if((te=Ee.type)!=null&&te.startsWith("image/"))try{Je=await Tb(Ee,{maxW:1600,maxH:1600,quality:.85})}catch{Je=Ee}const Or=(Je.name||"archivo").replace(/\s+/g,"_"),Jn=`pacientes/${I.id}/rx/${Date.now()}_${Or}`,Zn=Rl(H,Jn),Lt={contentType:Je.type||"application/octet-stream",cacheControl:"public, max-age=31536000"};await ab(Zn,Je,Lt);const Nn=await cb(Zn),An=new Date().toISOString(),mr=Date.now();ge.push({url:Nn,name:Ee.name,title:Ee.name.replace(/\.[^.]+$/,""),desc:"",type:Ee.type,size:Ee.size||0,created:mr,uploadedAtMS:mr,uploadedAtISO:An,path:Jn})}await Q({rxImagenes:[...I.rxImagenes||[],...ge]})}catch(ge){console.error("RX upload error:",ge);const Ee=`No se pudo subir el/los archivo(s).
 Verifica que el usuario est autenticado.
 Revisa reglas de Storage para permitir escribir en 'pacientes/{id}/**'.
 Si usas Emulador, confirma que el bucket coincida.

`+((ge==null?void 0:ge.message)||"");alert(Ee)}finally{re(!1);try{fe.current&&(fe.current.value="")}catch{}}},Pe=async T=>{if(!(I!=null&&I.id))return;const H=I.rxImagenes[T],te=I.rxImagenes.filter((ge,Ee)=>Ee!==T);await Q({rxImagenes:te});try{if(H!=null&&H.path){const ge=Hi();await Vp(Rl(ge,H.path))}}catch(ge){console.warn("No se pudo borrar del Storage:",ge)}},Xe=(T,H)=>{const te={...I.historiaClinica||{},[T]:H};Q({historiaClinica:te})},jt=T=>{const H=[...I.presupuestos||[],{id:String(Date.now()),...T}];Q({presupuestos:H})},Ge=T=>{Q({presupuestos:(I.presupuestos||[]).filter(H=>H.id!==T)})},Zt=T=>{const H=[...I.evoluciones||[],{id:String(Date.now()),fechaISO:new Date().toISOString(),nota:T}];Q({evoluciones:H})},dt=T=>{Q({evoluciones:(I.evoluciones||[]).filter(H=>H.id!==T)})},Dt=(T,H)=>{const te=Array.isArray(I[T])?I[T]:[],ge=te.find(Je=>Je.pieza===H);let Ee;ge?Ee=te.filter(Je=>Je.pieza!==H):Ee=[...te,{pieza:H,estado:"marcada"}],Q({[T]:Ee})},Wt=(I==null?void 0:I.id)||null,Gt=Z6(Wt),{loading:Ze,citas:Ot}=eU(Wt);return a.jsxs("div",{className:"odc-container",children:[a.jsx("div",{className:"odc-topbar-green"}),a.jsx("div",{className:"odc-topbar-blue",children:a.jsx("div",{className:"odc-top-inner",children:a.jsx("div",{className:"odc-breadcrumbs",children:"Pacientes"})})}),a.jsxs("div",{className:"odc-card",children:[a.jsxs("div",{className:"odc-card-header",children:[a.jsx("h3",{className:"odc-title",children:"Pacientes"}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("input",{className:"search-input",style:{minWidth:280},placeholder:"Buscar por nombre, documento o telfono",value:f,onChange:T=>h(T.target.value)}),a.jsx("button",{type:"button",className:"btn green",onClick:Me,children:"+ Nuevo paciente"})]})]}),a.jsx("div",{className:"table-wrap",children:a.jsxs("table",{className:"appointments-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Foto"}),a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Documento"}),a.jsx("th",{children:"Celular"}),a.jsx("th",{children:"Correo"}),a.jsx("th",{children:"Estado"})]})}),a.jsx("tbody",{children:o&&c.length===0?a.jsx("tr",{children:a.jsx("td",{className:"no-data",colSpan:6,children:"Cargando"})}):X.length===0?a.jsx("tr",{children:a.jsx("td",{className:"no-data",colSpan:6,children:"No hay pacientes o no coinciden con la bsqueda."})}):X.map(T=>a.jsxs("tr",{className:"row-click",onClick:()=>ne(T),children:[a.jsx("td",{onClick:H=>H.stopPropagation(),children:T.fotoUrl?a.jsx("img",{src:T.fotoUrl,alt:"Foto",style:{width:36,height:36,borderRadius:"50%",objectFit:"cover"}}):a.jsx("div",{className:"avatar-fallback",children:(T.nombreCompleto||"P")[0]})}),a.jsx("td",{children:T.nombreCompleto||T.paciente||""}),a.jsx("td",{children:T.nroDocumento||T.documento||""}),a.jsx("td",{children:T.celular||T.celularPaciente||""}),a.jsx("td",{children:T.email||""}),a.jsx("td",{children:a.jsx("span",{className:"pill pill-ok",children:T.activo?"Activo":"Inactivo"})})]},T.id))})]})}),a.jsxs("div",{className:"footer-actions",children:[a.jsx("button",{type:"button",className:"btn",disabled:o||!R,onClick:()=>we(!1),children:R?"Cargar ms":"No hay ms"}),a.jsxs("div",{className:"hint",children:[c.length," registros cargados"]})]})]}),C&&a.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"odc-modal-backdrop",onClick:()=>y(!1)}),a.jsxs("div",{className:"odc-card",style:{width:1e3,maxWidth:"95%",maxHeight:"92vh",overflowY:"auto"},children:[a.jsxs("div",{className:"odc-card-header",children:[a.jsx("h3",{className:"odc-title",children:w?"Editar paciente":"Nuevo paciente"}),a.jsx("button",{type:"button",className:"btn",onClick:()=>y(!1),children:""})]}),a.jsxs("form",{onSubmit:xe,children:[a.jsx("div",{className:"form-section-title",children:"Foto del paciente"}),a.jsxs("div",{className:"foto-row",children:[a.jsxs("label",{className:"foto-drop",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:T=>{var H;return ue(((H=T.target.files)==null?void 0:H[0])||null)},style:{display:"none"}}),k?a.jsx("img",{src:k,alt:"Preview",className:"foto-preview"}):a.jsx("div",{className:"foto-empty",children:"Arrastra o haz clic para cargar"})]}),k&&a.jsx("button",{type:"button",className:"btn",onClick:()=>ue(null),children:"Quitar foto"})]}),a.jsx("div",{className:"form-section-title",children:"Datos de identificacin"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Tipo de documento *"}),a.jsxs("select",{className:"form-input",value:_.tipoDocumento,onChange:T=>z("tipoDocumento",T.target.value),children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{value:"CC",children:"Cdula"}),a.jsx("option",{value:"TI",children:"Tarjeta de identidad"}),a.jsx("option",{value:"PA",children:"Pasaporte"}),a.jsx("option",{value:"OTRO",children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nro. de documento *"}),a.jsx("input",{className:"form-input",value:_.nroDocumento,onChange:T=>z("nroDocumento",T.target.value),placeholder:"Nmero de documento",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nmero de Historia"}),a.jsx("input",{className:"form-input",value:_.nroHistoria,readOnly:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nombres *"}),a.jsx("input",{className:"form-input",value:_.nombres,onChange:T=>z("nombres",T.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Apellidos *"}),a.jsx("input",{className:"form-input",value:_.apellidos,onChange:T=>z("apellidos",T.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nombre completo"}),a.jsx("input",{className:"form-input",value:_.nombreCompleto,readOnly:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Sexo *"}),a.jsxs("select",{className:"form-input",value:_.sexo,onChange:T=>z("sexo",T.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Masculino"}),a.jsx("option",{children:"Femenino"}),a.jsx("option",{children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Estado civil *"}),a.jsxs("select",{className:"form-input",value:_.estadoCivil,onChange:T=>z("estadoCivil",T.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Soltero"}),a.jsx("option",{children:"Casado"}),a.jsx("option",{children:"Unin libre"}),a.jsx("option",{children:"Divorciado"}),a.jsx("option",{children:"Viudo"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Pas de nacimiento *"}),a.jsx("input",{className:"form-input",list:"listCountries",value:_.paisNacimiento,onChange:T=>z("paisNacimiento",T.target.value),placeholder:"Escribe y elige",required:!0}),a.jsx("datalist",{id:"listCountries",children:K6.map(T=>a.jsx("option",{value:T},T))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Ciudad de nacimiento"}),a.jsx("input",{className:"form-input",list:"listCitiesBirth",value:_.ciudadNacimiento,onChange:T=>z("ciudadNacimiento",T.target.value),placeholder:"Escribe y elige"}),a.jsx("datalist",{id:"listCitiesBirth",children:(qp[_.paisNacimiento]||[]).map(T=>a.jsx("option",{value:T},T))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Fecha de ingreso"}),a.jsx("input",{className:"form-input",value:_.fechaIngreso,readOnly:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Fecha de nacimiento *"}),a.jsx("input",{type:"date",className:"form-input",value:_.fechaNacimiento,onChange:T=>z("fechaNacimiento",T.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Edad"}),a.jsx("input",{className:"form-input",value:_.edad,readOnly:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Pas de domicilio *"}),a.jsx("input",{className:"form-input",list:"listCountries",value:_.paisDomicilio,onChange:T=>z("paisDomicilio",T.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Ciudad de domicilio *"}),a.jsx("input",{className:"form-input",list:"listCitiesHome",value:_.ciudadDomicilio,onChange:T=>z("ciudadDomicilio",T.target.value),required:!0}),a.jsx("datalist",{id:"listCitiesHome",children:(qp[_.paisDomicilio]||[]).map(T=>a.jsx("option",{value:T},T))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Barrio *"}),a.jsx("input",{className:"form-input",value:_.barrio,onChange:T=>z("barrio",T.target.value),required:!0,placeholder:"Barrio"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Lugar de residencia *"}),a.jsx("input",{className:"form-input",value:_.lugarResidencia,onChange:T=>z("lugarResidencia",T.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Estrato"}),a.jsxs("select",{className:"form-input",value:_.estrato,onChange:T=>z("estrato",T.target.value),children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"1"}),a.jsx("option",{children:"2"}),a.jsx("option",{children:"3"}),a.jsx("option",{children:"4"}),a.jsx("option",{children:"5"}),a.jsx("option",{children:"6"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Zona residencial *"}),a.jsxs("select",{className:"form-input",value:_.zonaResidencial,onChange:T=>z("zonaResidencial",T.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Urbana"}),a.jsx("option",{children:"Rural"})]})]}),a.jsxs("div",{className:"checkbox-cell",children:[a.jsx("label",{className:"form-label",children:"Es extranjero?"}),a.jsx("input",{type:"checkbox",checked:_.esExtranjero,onChange:T=>z("esExtranjero",T.target.checked)})]}),a.jsxs("div",{className:"checkbox-cell",children:[a.jsx("label",{className:"form-label",children:"Permite publicidad?"}),a.jsx("input",{type:"checkbox",checked:_.permitePublicidad,onChange:T=>z("permitePublicidad",T.target.checked)})]})]}),a.jsx("div",{className:"form-section-title",children:"Contacto"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Celular *"}),a.jsx("input",{className:"form-input",value:_.celular,onChange:T=>z("celular",T.target.value),required:!0,placeholder:"Celular del paciente"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Telfono de domicilio"}),a.jsx("input",{className:"form-input",value:_.telDomicilio,onChange:T=>z("telDomicilio",T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Telfono de oficina"}),a.jsx("input",{className:"form-input",value:_.telOficina,onChange:T=>z("telOficina",T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Extensin"}),a.jsx("input",{className:"form-input",value:_.extension,onChange:T=>z("extension",T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Correo electrnico *"}),a.jsx("input",{type:"email",className:"form-input",value:_.email,onChange:T=>z("email",T.target.value),required:!0,placeholder:"correo@dominio.com"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Ocupacin *"}),a.jsx("input",{className:"form-input",value:_.ocupacion,onChange:T=>z("ocupacion",T.target.value),required:!0})]})]}),a.jsx("div",{className:"form-section-title",children:"Datos de facturacin"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Responsable"}),a.jsx("input",{className:"form-input",value:_.nombreResponsable,onChange:T=>z("nombreResponsable",T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Parentesco"}),a.jsxs("select",{className:"form-input",value:_.parentesco,onChange:T=>z("parentesco",T.target.value),children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Padre/Madre"}),a.jsx("option",{children:"Hermano"}),a.jsx("option",{children:"Esposo/a"}),a.jsx("option",{children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Celular"}),a.jsx("input",{className:"form-input",value:_.celularResponsable,onChange:T=>z("celularResponsable",T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Telfono"}),a.jsx("input",{className:"form-input",value:_.telefonoResponsable,onChange:T=>z("telefonoResponsable",T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Correo electrnico"}),a.jsx("input",{type:"email",className:"form-input",value:_.emailResponsable,onChange:T=>z("emailResponsable",T.target.value)})]})]}),a.jsx("div",{className:"form-section-title",children:"Acompaante"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nombre"}),a.jsx("input",{className:"form-input",value:_.nombreAcompanante,onChange:T=>z("nombreAcompanante",T.target.value),placeholder:"Nombre acompaante"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Telfono"}),a.jsx("input",{className:"form-input",value:_.telefonoAcompanante,onChange:T=>z("telefonoAcompanante",T.target.value),placeholder:"Telfono acompaante"})]})]}),a.jsx("div",{className:"form-section-title",children:"Mercadeo"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Convenio beneficio"}),a.jsx("input",{className:"form-input",value:_.convenioBeneficio,onChange:T=>z("convenioBeneficio",T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Cmo nos conoci?"}),a.jsxs("select",{className:"form-input",value:_.comoConocio,onChange:T=>z("comoConocio",T.target.value),children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Redes sociales"}),a.jsx("option",{children:"Publicidad"}),a.jsx("option",{children:"Recomendacin"}),a.jsx("option",{children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Campaa"}),a.jsx("input",{className:"form-input",value:_.campania,onChange:T=>z("campania",T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Remitido por"}),a.jsx("input",{className:"form-input",value:_.remitidoPor,onChange:T=>z("remitidoPor",T.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Asesor comercial"}),a.jsx("input",{className:"form-input",value:_.asesorComercial,onChange:T=>z("asesorComercial",T.target.value)})]})]}),a.jsx("div",{className:"form-section-title",children:"EPS"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Tipo de vinculacin *"}),a.jsxs("select",{className:"form-input",value:_.tipoVinculacion,onChange:T=>z("tipoVinculacion",T.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Contributivo"}),a.jsx("option",{children:"Subsidiado"}),a.jsx("option",{children:"Particular"}),a.jsx("option",{children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nombre de la EPS *"}),a.jsx("input",{className:"form-input",list:"listEps",value:_.nombreEps,onChange:T=>z("nombreEps",T.target.value),placeholder:"Escribe y selecciona",required:!0}),a.jsx("datalist",{id:"listEps",children:He.map(T=>a.jsx("option",{value:T},T))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Pliza de salud"}),a.jsx("input",{className:"form-input",value:_.polizaSalud,onChange:T=>z("polizaSalud",T.target.value)})]})]}),a.jsx("div",{className:"form-section-title",children:"Doctor"}),a.jsx("div",{className:"form-grid",children:a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Doctor"}),a.jsx("input",{className:"form-input",value:_.doctor,onChange:T=>z("doctor",T.target.value),placeholder:"Usuario / Libre"})]})}),a.jsx("div",{className:"form-section-title",children:"Alertas y Notas"}),a.jsx("div",{className:"form-grid",children:a.jsx("textarea",{className:"form-input",rows:3,value:_.notas,onChange:T=>z("notas",T.target.value),placeholder:"Notas del paciente"})}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,marginTop:12},children:[w?a.jsx("button",{type:"button",className:"btn",onClick:()=>W({id:w,nombreCompleto:_.nombreCompleto}),children:"Eliminar"}):a.jsx("div",{}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("button",{type:"button",className:"btn",onClick:()=>y(!1),children:"Cancelar"}),a.jsx("button",{type:"submit",className:"btn blue",children:w?"Actualizar":"Guardar paciente"})]})]})]})]})]}),I&&a.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"odc-modal-backdrop",onClick:O}),a.jsxs("div",{className:"odc-card ficha-card",children:[a.jsxs("div",{className:"ficha-header",children:[a.jsxs("div",{className:"ficha-header-left",children:[I.fotoUrl?a.jsx("img",{src:I.fotoUrl,alt:"Foto",className:"ficha-avatar"}):a.jsx("div",{className:"avatar-fallback ficha-avatar-fallback",children:(I.nombreCompleto||"P")[0]}),a.jsxs("div",{children:[a.jsx("div",{className:"ficha-nombre",children:I.nombreCompleto||""}),a.jsxs("div",{className:"ficha-doc",children:[I.tipoDocumento||""," ",I.nroDocumento||""]}),a.jsxs("div",{className:"ficha-badges",children:[a.jsx("span",{className:"ficha-badge blue",children:"En valoracin"}),a.jsx("span",{className:"ficha-badge green",children:"Sin deuda"})]})]})]}),a.jsx("div",{className:"ficha-header-right",children:a.jsxs("div",{className:"ficha-actions",children:[a.jsx("button",{type:"button",className:"btn",onClick:O,children:"Cerrar"}),a.jsx("button",{type:"button",className:"btn blue",onClick:L,children:"Editar"}),a.jsx("button",{type:"button",className:"btn green",onClick:()=>t(s(Zu.caja,{cobro:1,patientId:I.id})),title:"Ir a Caja para cobrar a este paciente",children:"Cobrar"})]})})]}),a.jsxs("div",{className:"ficha-body",children:[a.jsxs("aside",{className:"ficha-sidebar",children:[a.jsx("div",{className:"ficha-sidebar-title",children:"Informacin general"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="datos"?"active":""}`,onClick:()=>x("datos"),children:"Datos personales"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="marketing"?"active":""}`,onClick:()=>x("marketing"),children:"Marketing"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="eps"?"active":""}`,onClick:()=>x("eps"),children:"EPS"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="prof"?"active":""}`,onClick:()=>x("prof"),children:"Profesionales"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="rx"?"active":""}`,onClick:()=>x("rx"),children:"Rx/Imgenes/Doc"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="citas"?"active":""}`,onClick:()=>x("citas"),children:"Citas"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="crm"?"active":""}`,onClick:()=>x("crm"),children:"CRM"}),a.jsx("div",{className:"ficha-sidebar-title mt",children:"Historia clnica"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="doc"?"active":""}`,onClick:()=>x("doc"),children:"Doc. Clnicos"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="odonto"?"active":""}`,onClick:()=>x("odonto"),children:"Odontogramas"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="perio"?"active":""}`,onClick:()=>x("perio"),children:"Periodontogramas"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="presu"?"active":""}`,onClick:()=>x("presu"),children:"Presupuestos"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="evo"?"active":""}`,onClick:()=>x("evo"),children:"Evoluciones"}),a.jsx("div",{className:"ficha-sidebar-title mt",children:"Facturacin"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="fact"?"active":""}`,onClick:()=>x("fact"),children:"Resumen"}),a.jsxs("div",{className:"ficha-sidebar-actions",style:{display:"grid",gap:8,marginTop:8},children:[a.jsx("button",{type:"button",className:"btn pay",onClick:()=>t(s(Zu.caja,{cobro:1,patientId:I.id})),title:"Cobrar a este paciente",children:"Realizar pago"}),a.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${Zu.pagos}?patientId=${encodeURIComponent(I.id)}`),title:"Ver histrico de pagos",children:"Histrico de pagos"}),a.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${Zu.facturas}?patientId=${encodeURIComponent(I.id)}`),title:"Ver histrico de facturacin",children:"Histrico de facturacin"})]})]}),a.jsxs("main",{className:"ficha-content",children:[b==="datos"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Datos personales"}),a.jsx("div",{className:"ficha-grid",children:[["Tipo de documento",I.tipoDocumento],["Nro. de documento",I.nroDocumento],["Nmero de Historia",I.nroHistoria],["Fecha de ingreso",I.fechaIngreso],["Nombres",I.nombres],["Apellidos",I.apellidos],["Nombre completo",I.nombreCompleto],["Sexo",I.sexo],["Estado civil",I.estadoCivil],["Pas de nacimiento",I.paisNacimiento],["Ciudad de nacimiento",I.ciudadNacimiento],["Fecha de nacimiento",I.fechaNacimiento],["Edad",I.edad],["Pas de domicilio",I.paisDomicilio],["Ciudad de domicilio",I.ciudadDomicilio],["Barrio",I.barrio],["Lugar de residencia",I.lugarResidencia],["Estrato",I.estrato],["Zona residencial",I.zonaResidencial],["Extranjero",I.esExtranjero?"S":"No"],["Permite publicidad",I.permitePublicidad?"S":"No"],["Celular",I.celular||I.celularPaciente],["Telfono domicilio",I.telDomicilio||I.telefonoPaciente],["Telfono oficina",I.telOficina],["Extensin",I.extension],["Correo electrnico",I.email],["Ocupacin",I.ocupacion],["Responsable",I.nombreResponsable],["Parentesco",I.parentesco],["Cel. responsable",I.celularResponsable],["Tel. responsable",I.telefonoResponsable],["Email responsable",I.emailResponsable],["Acompaante",I.nombreAcompanante],["Tel. acompaante",I.telefonoAcompanante]].map(([T,H])=>a.jsxs("div",{className:"field",children:[a.jsx("label",{children:T}),a.jsx("input",{className:"form-input",value:H||"",readOnly:!0})]},T))})]}),b==="marketing"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Marketing"}),a.jsx("div",{className:"ficha-grid",children:[["Convenio beneficio",I.convenioBeneficio],["Cmo nos conoci?",I.comoConocio],["Campaa",I.campania],["Remitido por",I.remitidoPor],["Asesor comercial",I.asesorComercial]].map(([T,H])=>a.jsxs("div",{className:"field",children:[a.jsx("label",{children:T}),a.jsx("input",{className:"form-input",value:H||"",readOnly:!0})]},T))})]}),b==="eps"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"EPS"}),a.jsx("div",{className:"ficha-grid",children:[["Tipo de vinculacin",I.tipoVinculacion],["Nombre EPS",I.nombreEps],["Pliza de salud",I.polizaSalud]].map(([T,H])=>a.jsxs("div",{className:"field",children:[a.jsx("label",{children:T}),a.jsx("input",{className:"form-input",value:H||"",readOnly:!0})]},T))})]}),b==="prof"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Profesionales"}),a.jsx("div",{className:"ficha-grid",children:a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Doctor"}),a.jsx("input",{className:"form-input",value:I.doctor||"",readOnly:!0})]})})]}),b==="rx"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Rx / Imgenes / Documentos"}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsxs("label",{className:"btn blue",children:["Subir archivos",a.jsx("input",{ref:fe,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",style:{display:"none"},onChange:T=>Se([...T.target.files||[]])})]}),kt&&a.jsx("span",{className:"hint",children:"Subiendo"}),a.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:a.jsx("input",{className:"form-input",style:{width:200},placeholder:"Buscar en Rx",value:ke,onChange:T=>We(T.target.value),title:"Filtra por nombre, ttulo o descripcin"})})]}),a.jsxs("div",{className:"hint",style:{marginTop:6},children:[ie.length," elemento(s)",ke?"  filtrado(s)":"","."]}),a.jsxs("div",{className:"rx-grid",style:{display:"grid",gap:10,marginTop:12,gridTemplateColumns:`repeat(auto-fill, minmax(${It.colMin}px, 1fr))`,alignItems:"start"},children:[ie.length===0&&a.jsx("div",{className:"no-data",style:{gridColumn:"1 / -1"},children:ke?"Sin coincidencias.":"Sin archivos an."}),ie.map((T,H)=>{var Or,Jn;const te=U(T),ge=T.title||T.name||`archivo-${H}`,Ee=((Or=(T.name||"").split(".").pop())==null?void 0:Or.toUpperCase())||((Jn=(T.type||"").split("/").pop())==null?void 0:Jn.toUpperCase())||"",Je=T.uploadedAtISO||(T.created?new Date(T.created).toISOString():null);return a.jsxs("div",{className:"rx-item mini-card",style:{padding:8,display:"grid",gap:8},title:ge,children:[a.jsx("a",{href:T.url,target:"_blank",rel:"noreferrer",style:{width:"100%",height:It.thumbH,borderRadius:8,overflow:"hidden",border:"1px solid #e5e7eb",display:"grid",placeItems:"center",background:"#fafafa"},children:te?a.jsx("img",{src:T.url,alt:ge,style:{width:It.thumbW,height:It.thumbH,objectFit:"contain",display:"block"},loading:"lazy"}):a.jsxs("div",{style:{textAlign:"center",padding:10},children:[a.jsx("div",{style:{fontSize:24,fontWeight:700},children:Ee||"DOC"}),a.jsx("div",{style:{fontSize:12,opacity:.7},children:"Ver / descargar"})]})}),a.jsx("div",{style:{fontWeight:600,fontSize:13,lineHeight:1.2},children:ge.length>40?ge.slice(0,37)+"":ge}),a.jsxs("details",{children:[a.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#2563eb"},children:"Editar nombre y descripcin"}),a.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[a.jsx("label",{className:"form-label",style:{marginTop:4},children:"Nombre para mostrar"}),a.jsx("input",{id:`rx-title-${H}`,className:"form-input",defaultValue:T.title||T.name||"",placeholder:"Ej. Rx aleta derecha 2025-11-29"}),a.jsx("label",{className:"form-label",children:"Descripcin"}),a.jsx("textarea",{id:`rx-desc-${H}`,className:"form-input",rows:2,defaultValue:T.desc||"",placeholder:"Observaciones, regin, tcnica, etc."}),a.jsx("label",{className:"form-label",children:"Fecha de subida"}),a.jsx("input",{id:`rx-date-${H}`,type:"datetime-local",className:"form-input",defaultValue:X6(Je)}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"space-between"},children:[a.jsx("button",{type:"button",className:"btn blue",onClick:()=>{var ts,ns,ko;const Zn=((ts=document.getElementById(`rx-title-${H}`))==null?void 0:ts.value)||"",Lt=((ns=document.getElementById(`rx-desc-${H}`))==null?void 0:ns.value)||"",Nn=((ko=document.getElementById(`rx-date-${H}`))==null?void 0:ko.value)||"";let An=Je,mr=T.uploadedAtMS||T.created||null;if(Nn){const rs=new Date(Nn);isNaN(rs.getTime())||(An=rs.toISOString(),mr=rs.getTime())}pe(H,{title:Zn,name:Zn||T.name,desc:Lt,uploadedAtISO:An,uploadedAtMS:mr})},children:"Guardar"}),a.jsx("button",{type:"button",className:"btn",onClick:()=>Pe(H),children:"Eliminar"})]}),a.jsxs("div",{className:"hint",style:{fontSize:11},children:["Tipo: ",T.type||"","  Tamao: ",(T.size||0).toLocaleString()," bytes",Je?`  Subido: ${J6(Je)}`:""]})]})]})]},`${T.url}-${H}`)})]})]}),b==="doc"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Doc. Clnicos"}),a.jsxs("div",{className:"ficha-grid",children:[a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Motivo de consulta"}),a.jsx("textarea",{className:"form-input",rows:3,value:((Dr=I.historiaClinica)==null?void 0:Dr.motivoConsulta)||"",onChange:T=>Xe("motivoConsulta",T.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Antecedentes"}),a.jsx("textarea",{className:"form-input",rows:3,value:((pr=I.historiaClinica)==null?void 0:pr.antecedentes)||"",onChange:T=>Xe("antecedentes",T.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Alergias"}),a.jsx("textarea",{className:"form-input",rows:2,value:((Cs=I.historiaClinica)==null?void 0:Cs.alergias)||"",onChange:T=>Xe("alergias",T.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Medicamentos"}),a.jsx("textarea",{className:"form-input",rows:2,value:((Mn=I.historiaClinica)==null?void 0:Mn.medicamentos)||"",onChange:T=>Xe("medicamentos",T.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Notas"}),a.jsx("textarea",{className:"form-input",rows:3,value:((es=I.historiaClinica)==null?void 0:es.notas)||"",onChange:T=>Xe("notas",T.target.value)})]})]})]}),b==="odonto"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Odontograma (placeholder)"}),a.jsx("div",{className:"odont-grid",children:Array.from({length:32},(T,H)=>H+1).map(T=>{const H=(I.odontograma||[]).some(te=>te.pieza===T);return a.jsx("button",{type:"button",className:`tooth ${H?"on":""}`,onClick:()=>Dt("odontograma",T),title:`Pieza ${T}`,children:T},T)})})]}),b==="perio"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Periodontograma (placeholder)"}),a.jsx("div",{className:"odont-grid",children:Array.from({length:32},(T,H)=>H+1).map(T=>{const H=(I.periodontograma||[]).some(te=>te.pieza===T);return a.jsx("button",{type:"button",className:`tooth ${H?"on":""}`,onClick:()=>Dt("periodontograma",T),title:`Pieza ${T}`,children:T},T)})})]}),b==="presu"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Presupuestos & planes"}),a.jsx(nU,{onAdd:jt}),a.jsxs("div",{className:"presu-list",children:[(I.presupuestos||[]).map(T=>a.jsxs("div",{className:"presu-item",children:[a.jsxs("div",{children:[a.jsx("div",{className:"presu-title",children:T.titulo}),a.jsxs("div",{className:"presu-meta",children:["Costo: $",T.costo||0,"  Estado: ",T.estado||"Pendiente"]})]}),a.jsx("button",{type:"button",className:"btn small",onClick:()=>Ge(T.id),children:"Eliminar"})]},T.id)),(!I.presupuestos||I.presupuestos.length===0)&&a.jsx("div",{className:"no-data",children:"Sin presupuestos an."})]})]}),b==="evo"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Evoluciones & Remisiones"}),a.jsx(rU,{onAdd:Zt}),a.jsxs("div",{className:"evo-list",children:[(I.evoluciones||[]).map(T=>a.jsxs("div",{className:"evo-item",children:[a.jsx("div",{className:"evo-date",children:new Date(T.fechaISO).toLocaleString()}),a.jsx("div",{className:"evo-note",children:T.nota}),a.jsx("button",{type:"button",className:"btn small",onClick:()=>dt(T.id),children:"Eliminar"})]},T.id)),(!I.evoluciones||I.evoluciones.length===0)&&a.jsx("div",{className:"no-data",children:"Sin evoluciones an."})]})]}),b==="fact"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Facturacin"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px,1fr))",gap:12},children:[a.jsx(Ho,{title:"Total facturado",value:`$ ${Gt.totalFacturado.toLocaleString()}`}),a.jsx(Ho,{title:"Total pagado",value:`$ ${Gt.totalPagado.toLocaleString()}`}),a.jsx(Ho,{title:"Facturas pendientes",value:`$ ${Gt.totalFacturasPendientes.toLocaleString()}`}),a.jsx(Ho,{title:"Saldo pendiente (facturas - pagos)",value:`$ ${(Gt.totalFacturado-Gt.totalPagado).toLocaleString()}`}),a.jsx(Ho,{title:"Saldo a favor",value:`$ ${(((pu=I.facturacion)==null?void 0:pu.saldoFavor)??0).toLocaleString()}`}),a.jsx(Ho,{title:"Saldo crdito",value:`$ ${(((mu=I.facturacion)==null?void 0:mu.saldoCredito)??0).toLocaleString()}`})]}),Gt.error&&a.jsxs("div",{className:"hint",style:{marginTop:6},children:[" ",Gt.error]}),a.jsxs("div",{className:"ficha-grid",style:{marginTop:12},children:[a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Saldo a favor"}),a.jsx("input",{type:"number",className:"form-input",value:((Ai=I.facturacion)==null?void 0:Ai.saldoFavor)??0,onChange:T=>Q({facturacion:{...I.facturacion||{},saldoFavor:Number(T.target.value||0)}})})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Saldo crdito"}),a.jsx("input",{type:"number",className:"form-input",value:((il=I.facturacion)==null?void 0:il.saldoCredito)??0,onChange:T=>Q({facturacion:{...I.facturacion||{},saldoCredito:Number(T.target.value||0)}})})]})]})]}),b==="citas"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Citas"}),a.jsxs("div",{className:"mini-card",style:{marginBottom:12},children:[a.jsx("div",{className:"mini-card-title",children:"Crear cita para este paciente"}),a.jsxs("div",{className:"ficha-grid",style:{marginTop:8},children:[a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Fecha"}),a.jsx("input",{type:"date",className:"form-input",value:Ae,onChange:T=>De(T.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Hora"}),a.jsx("input",{type:"time",className:"form-input",value:be,onChange:T=>at(T.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Doctor"}),a.jsx("input",{className:"form-input",value:je,onChange:T=>me(T.target.value),placeholder:"Doctor asignado"})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Espacio / Sala"}),a.jsx("input",{className:"form-input",value:Oe,onChange:T=>Fe(T.target.value),placeholder:"Consultorio / Silla"})]}),a.jsxs("div",{className:"field",style:{gridColumn:"1 / -1"},children:[a.jsx("label",{children:"Comentario"}),a.jsx("textarea",{className:"form-input",rows:2,value:nt,onChange:T=>G(T.target.value),placeholder:"Motivo / notas de la cita"})]})]}),a.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[a.jsx("button",{type:"button",className:"btn blue",onClick:le,children:"Guardar cita"}),Ae&&a.jsx("button",{type:"button",className:"btn",onClick:()=>i(Ae,I.id),children:"Ver ese da en Agenda"})]})]}),a.jsx("div",{className:"table-wrap",children:a.jsxs("table",{className:"appointments-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Fecha"}),a.jsx("th",{children:"Estado"}),a.jsx("th",{children:"Motivo"}),a.jsx("th",{children:"Profesional / Acciones"})]})}),a.jsx("tbody",{children:Ze?a.jsx("tr",{children:a.jsx("td",{className:"no-data",colSpan:4,children:"Cargando"})}):Ot.length===0?a.jsx("tr",{children:a.jsx("td",{className:"no-data",colSpan:4,children:"Sin citas registradas."})}):Ot.map(T=>a.jsxs("tr",{children:[a.jsx("td",{children:T.fechaISO?new Date(T.fechaISO).toLocaleString():T.fechaYYYYMMDD||""}),a.jsx("td",{children:T.estado||""}),a.jsx("td",{children:T.motivo||""}),a.jsx("td",{children:a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{children:T.profesional||""}),a.jsx("button",{type:"button",className:"btn small",onClick:()=>{const H=T.fechaYYYYMMDD||T.fecha||(T.fechaISO?new Date(T.fechaISO).toISOString().slice(0,10):"");i(H,I.id)},title:"Abrir en Agenda",children:"Ver en Agenda"})]})})]},T.id))})]})})]}),b==="crm"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"CRM"}),a.jsx("div",{className:"no-data",children:"Notas / recordatorios comerciales del paciente."})]}),a.jsx("div",{className:"ficha-footer"})]})]})]})]})]})}function Ho({title:t,value:e}){return a.jsxs("div",{className:"mini-card",children:[a.jsx("div",{className:"mini-card-title",children:t}),a.jsx("div",{style:{fontWeight:700,fontSize:20,marginTop:6},children:e})]})}function nU({onAdd:t}){const[e,n]=S.useState(""),[r,s]=S.useState(""),[i,o]=S.useState("Pendiente");return a.jsxs("div",{className:"presu-form",children:[a.jsx("input",{className:"form-input",placeholder:"Procedimiento / plan",value:e,onChange:l=>n(l.target.value)}),a.jsx("input",{type:"number",className:"form-input",placeholder:"Costo",value:r,onChange:l=>s(l.target.value)}),a.jsxs("select",{className:"form-input",value:i,onChange:l=>o(l.target.value),children:[a.jsx("option",{children:"Pendiente"}),a.jsx("option",{children:"Aprobado"}),a.jsx("option",{children:"Rechazado"})]}),a.jsx("button",{type:"button",className:"btn blue",onClick:()=>{if(!e)return alert("Ttulo requerido");t({titulo:e,costo:Number(r||0),estado:i}),n(""),s(""),o("Pendiente")},children:"Agregar"})]})}function rU({onAdd:t}){const[e,n]=S.useState("");return a.jsxs("div",{className:"evo-form",children:[a.jsx("textarea",{className:"form-input",rows:2,placeholder:"Escribe la evolucin / remisin",value:e,onChange:r=>n(r.target.value)}),a.jsx("button",{type:"button",className:"btn blue",onClick:()=>{e.trim()&&(t(e.trim()),n(""))},children:"Guardar evolucin"})]})}function sU(){return a.jsxs("div",{style:{padding:"20px"},children:[a.jsx("h2",{children:"Mdulo de Facturacin"}),a.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function iU({basePath:t="",className:e=""}){const n=kr(),r=()=>{const s=String(t||"").replace(/\/+$/g,"");n(`${s}/config/datos-basicos`,{replace:!1})};return a.jsx("button",{type:"button",className:`oc-icon-btn ${e}`,title:"Configuracin","aria-label":"Abrir configuracin",onClick:r,children:""})}function oU(t,e){let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}function aU(){const[t,e]=S.useState({nombre:"",marca:"",pais:"Colombia",ciudad:"",tipoDocumento:"NIT",numeroDocumento:"",tipoPersona:"",telefono:"",celular:"",direccion:"",sitioWeb:"",urlAgendamiento:"",regimen:"",responsabilidadTributaria:"",correo:"",moneda:"Pesos colombianos (COP)",zonaHoraria:"Hora de Colombia",cuentaContable:"",esIPS:!1,usuarioSispro:"",tipoDocSispro:"Cdula de Ciudadana",passwordSispro:"",codigoPrestador:""});S.useEffect(()=>{var s;try{const i=localStorage.getItem("empresa_datos_basicos");if(i){const o=JSON.parse(i);e(l=>({...l,...o}))}else{const o=(s=document.querySelector('meta[name="company-name"]'))==null?void 0:s.getAttribute("content");o&&e(l=>({...l,nombre:o}))}}catch{}},[]);const n=s=>{const{name:i,type:o,value:l,checked:c}=s.target;e(d=>({...d,[i]:o==="checkbox"?c:l}))},r=async s=>{s.preventDefault();try{localStorage.setItem("empresa_datos_basicos",JSON.stringify(t)),localStorage.setItem("empresa_nombre",t.nombre||"OdontoCloud"),oU("company-name",t.nombre||"OdontoCloud")}catch{}console.log("Guardar Empresa  Datos bsicos:",t),alert("Datos bsicos guardados.")};return a.jsxs("div",{className:"oc-main-content",children:[a.jsx("div",{className:"oc-section-title",children:a.jsx("h2",{children:"Configuracin  Datos bsicos"})}),a.jsxs("div",{className:"emp-card",children:[a.jsx("div",{className:"emp-title",children:"Datos bsicos"}),a.jsxs("form",{className:"emp-form",onSubmit:r,children:[a.jsxs("div",{className:"oc-form-grid",children:[a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Nombre *"}),a.jsx("input",{name:"nombre",className:"emp-input",autoComplete:"organization",required:!0,value:t.nombre,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Marca"}),a.jsx("input",{name:"marca",className:"emp-input",value:t.marca,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Pas"}),a.jsxs("select",{name:"pais",className:"emp-select",value:t.pais,onChange:n,children:[a.jsx("option",{children:"Colombia"}),a.jsx("option",{children:"Mxico"}),a.jsx("option",{children:"Per"}),a.jsx("option",{children:"Chile"}),a.jsx("option",{children:"Argentina"}),a.jsx("option",{children:"Espaa"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Ciudad"}),a.jsx("input",{name:"ciudad",className:"emp-input",value:t.ciudad,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Tipo documento *"}),a.jsxs("select",{name:"tipoDocumento",className:"emp-select",required:!0,value:t.tipoDocumento,onChange:n,children:[a.jsx("option",{children:"NIT"}),a.jsx("option",{children:"CC"}),a.jsx("option",{children:"CE"}),a.jsx("option",{children:"PA"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Nmero de documento *"}),a.jsx("input",{name:"numeroDocumento",className:"emp-input",required:!0,value:t.numeroDocumento,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Tipo de persona"}),a.jsxs("select",{name:"tipoPersona",className:"emp-select",value:t.tipoPersona,onChange:n,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Natural"}),a.jsx("option",{children:"Jurdica"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Telfono fijo"}),a.jsx("input",{name:"telefono",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.telefono,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Celular"}),a.jsx("input",{name:"celular",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.celular,onChange:n})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Direccin"}),a.jsx("input",{name:"direccion",className:"emp-input",autoComplete:"street-address",value:t.direccion,onChange:n})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Sitio web"}),a.jsx("input",{name:"sitioWeb",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.sitioWeb,onChange:n})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Agendamiento (URL)"}),a.jsx("input",{name:"urlAgendamiento",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.urlAgendamiento,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Rgimen legal"}),a.jsxs("select",{name:"regimen",className:"emp-select",value:t.regimen,onChange:n,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Comn"}),a.jsx("option",{children:"Simplificado"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Responsabilidad tributaria"}),a.jsxs("select",{name:"responsabilidadTributaria",className:"emp-select",value:t.responsabilidadTributaria,onChange:n,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"No aplica"}),a.jsx("option",{children:"Autorretenedor"})]})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Correo electrnico"}),a.jsx("input",{name:"correo",className:"emp-input",type:"email",autoComplete:"email",value:t.correo,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Moneda"}),a.jsxs("select",{name:"moneda",className:"emp-select",value:t.moneda,onChange:n,children:[a.jsx("option",{children:"Pesos colombianos (COP)"}),a.jsx("option",{children:"Dlares (USD)"}),a.jsx("option",{children:"Euros (EUR)"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Zona horaria"}),a.jsxs("select",{name:"zonaHoraria",className:"emp-select",value:t.zonaHoraria,onChange:n,children:[a.jsx("option",{children:"Hora de Colombia"}),a.jsx("option",{children:"America/Bogota"}),a.jsx("option",{children:"UTC-5"})]})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Cuenta contable"}),a.jsx("input",{name:"cuentaContable",className:"emp-input",value:t.cuentaContable,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Es una institucin prestadora de salud (IPS)?"}),a.jsxs("div",{className:"emp-inline",children:[a.jsx("input",{id:"esIPS",type:"checkbox",name:"esIPS",checked:t.esIPS,onChange:n}),a.jsx("label",{htmlFor:"esIPS",children:"S"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Usuario SISPRO"}),a.jsx("input",{name:"usuarioSispro",className:"emp-input",value:t.usuarioSispro,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Tipo documento SISPRO"}),a.jsxs("select",{name:"tipoDocSispro",className:"emp-select",value:t.tipoDocSispro,onChange:n,children:[a.jsx("option",{children:"Cdula de Ciudadana"}),a.jsx("option",{children:"Cdula de Extranjera"}),a.jsx("option",{children:"NIT"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Contrasea SISPRO"}),a.jsx("input",{name:"passwordSispro",className:"emp-input",type:"password",value:t.passwordSispro,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Cdigo de prestador"}),a.jsx("input",{name:"codigoPrestador",className:"emp-input",value:t.codigoPrestador,onChange:n})]})]}),a.jsx("div",{className:"oc-form-actions",children:a.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})})]})]})]})}const Wp="empresa_logo_url";function Sb(t,e){let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}function lU(){const[t,e]=S.useState(()=>{try{return localStorage.getItem(Wp)||""}catch{return""}}),[n,r]=S.useState(null),[s,i]=S.useState(!1),o=S.useRef(null),l=S.useCallback(N=>{const C=N==null?void 0:N[0];if(!C)return;if(!C.type.startsWith("image/")){alert("Por favor selecciona una imagen (PNG/JPG/SVG/WebP).");return}r(C);const y=new FileReader;y.onload=w=>{var E;return e(String(((E=w.target)==null?void 0:E.result)||""))},y.readAsDataURL(C)},[]),c=N=>l(N.target.files),d=N=>{N.preventDefault(),N.stopPropagation(),i(!1),l(N.dataTransfer.files)},f=N=>{N.preventDefault(),i(!0)},h=()=>i(!1),m=()=>{var N;return(N=o.current)==null?void 0:N.click()},v=()=>{r(null),e("")},R=async()=>{try{t?(localStorage.setItem(Wp,t),Sb("company-logo",t)):(localStorage.removeItem(Wp),Sb("company-logo","")),alert("Logo guardado.")}catch(N){console.error(N),alert("No se pudo guardar localmente.")}};return a.jsxs("div",{className:"oc-main-content",children:[a.jsx("div",{className:"oc-section-title",children:a.jsx("h2",{children:"Configuracin  Logo empresa"})}),a.jsxs("div",{className:"emp-card",children:[a.jsx("div",{className:"emp-title",children:"Logo"}),a.jsxs("div",{className:"logo-wrap",children:[a.jsxs("div",{className:"logo-current",children:[a.jsx("div",{className:"emp-label",children:"Logo actual"}),a.jsx("div",{className:"logo-preview","aria-live":"polite",children:t?a.jsx("img",{src:t,alt:"Logo actual de la empresa"}):a.jsx("div",{className:"logo-empty",children:"Sin logo"})}),a.jsx("div",{className:"logo-actions",children:a.jsx("button",{type:"button",className:"oc-btn danger",onClick:v,disabled:!t,children:"Eliminar"})})]}),a.jsxs("div",{className:"logo-uploader",children:[a.jsx("div",{className:"emp-label",children:"Cargar foto"}),a.jsxs("div",{className:`logo-drop ${s?"over":""}`,onDragOver:f,onDragLeave:h,onDrop:d,onClick:m,role:"button",tabIndex:0,onKeyDown:N=>(N.key==="Enter"||N.key===" ")&&m(),"aria-label":"Arrastra o haz click para cargar la imagen del logo",children:[a.jsx("input",{ref:o,type:"file",accept:"image/*",onChange:c,style:{display:"none"}}),a.jsxs("div",{className:"logo-drop-hint",children:["Arrastra o click para cargar la foto.",a.jsx("div",{className:"logo-subhint",children:"Solo archivos de imagen"})]})]}),n&&a.jsxs("div",{className:"logo-file-name",children:["Archivo seleccionado: ",a.jsx("b",{children:n.name})]})]})]}),a.jsx("div",{className:"oc-form-actions",children:a.jsx("button",{type:"button",className:"oc-btn primary",onClick:R,children:"Guardar"})})]})]})}function i1(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function cU(){S.useEffect(()=>{var r,s;(r=document.getElementById("lp-acciones-unificadas-icons26"))==null||r.remove(),(s=document.getElementById("lp-acciones-unificadas-icons_v2"))==null||s.remove();const t="lp-acciones-unificadas-icons_v2",e=`
      .lp-wrap{padding:0;}
      .lp-h2{margin:0 0 12px;font-weight:800;font-size:20px;color:#0f172a;}

      .lp-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;}
      .lp-pill{padding:7px 16px;border-radius:999px;border:1px solid #d1d5db;background:#fff;
        font-weight:600;color:#374151;cursor:pointer;font-size:14px;transition:.2s;}
      .lp-pill:hover{background:#f3f4f6;}
      .lp-pill.active{background:#2b6cb0;color:#fff;border-color:#2b6cb0;}

      .lp-card{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:18px;box-shadow:0 1px 2px rgba(0,0,0,.04);}
      .lp-card-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:12px;}
      .lp-subtitle{font-size:16px;font-weight:800;color:#111827;margin:0 0 8px;border-bottom:1px solid #e5e7eb;padding-bottom:6px;}

      .chip{display:inline-flex;align-items:center;gap:8px;height:34px;padding:0 12px;border-radius:999px;border:1px solid #d1d5db;
        background:#fff;color:#374151;font-weight:600;cursor:pointer;transition:.2s;white-space:nowrap;}
      .chip:hover{background:#f3f4f6;}
      .btn-soft{display:inline-flex;align-items:center;gap:6px;height:32px;padding:0 12px;border-radius:999px;border:none;cursor:pointer;
        font-weight:700;font-size:13px;background:#22c55e;color:#fff;}
      .btn-soft.gray{background:#6b7280;}
      .btn-soft:hover{filter:brightness(.95);}

      .lp-table-wrap{overflow-x:hidden;width:100%;}
      .lp-card table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:14px;}
      thead tr{background:#f9fafb;}
      th,td{padding:8px 10px;white-space:normal;word-break:break-word;vertical-align:middle;}
      th{text-align:left;border-bottom:1px solid #e5e7eb;font-weight:700;color:#475569;}
      tbody tr{border-top:1px solid #f1f5f9;}
      .muted{color:#6b7280;}

      /* Acciones unificadas */
      th.actions, td.actions{width:140px;text-align:right;}
      .lp-actions{display:flex;gap:8px;justify-content:flex-end;align-items:center;flex-wrap:nowrap;}

      .iconbtn{
        display:inline-flex;align-items:center;justify-content:center;
        width:32px;height:32px;border-radius:10px;border:1px solid transparent;cursor:pointer;transition:.15s;
      }
      .iconbtn.green{background:#ecfdf5;color:#0f9d5b;border-color:#bbf7d0;}
      .iconbtn.blue {background:#eff6ff;color:#1e3a8a;border-color:#bfdbfe;}
      .iconbtn.red  {background:#fef2f2;color:#b91c1c;border-color:#fecaca;}
      .iconbtn:hover{filter:brightness(.97);}

      /* cono ms grande (no crece el botn) */
      .iconbtn > svg{
        width:38px !important;
        height:38px !important;
        display:block;
        stroke-width:2.4;
        vector-effect: non-scaling-stroke;
        pointer-events:none;
      }

      .badge{display:inline-block;padding:5px 10px;border-radius:999px;font-weight:700;font-size:12px;line-height:1;}
      .badge.green{background:#e8f7ee;color:#16a34a;border:1px solid #cbead7;}

      /* ---------- Form de Nuevo Producto ---------- */
      .np-grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:6px;}
      .np-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
      .np-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
      .np-field{display:flex;flex-direction:column;gap:6px;}
      .np-label{font-weight:700;color:#334155;font-size:13px;}
      .np-input, .np-select, .np-text{
        border:1px solid #d1d5db;border-radius:8px;padding:8px 10px;font-size:14px;background:#fff;
      }
      .np-text{min-height:72px;resize:vertical;}
      .np-toggle{display:flex;align-items:center;gap:10px;}
      .np-card-img{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:6px;}
      .np-avatar{width:140px;height:140px;border-radius:12px;background:#e5e7eb;display:flex;align-items:center;justify-content:center;color:#64748b;}
      .np-drop{border:2px dashed #d1d5db;border-radius:12px;padding:16px;text-align:center;color:#64748b;}
      .np-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;}

      @media (max-width:900px){
        .np-row, .np-row-3{grid-template-columns:1fr;}
      }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}const t_=()=>a.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M12 20h9"}),a.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5z"})]}),n_=()=>a.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),a.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),r_=()=>a.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("polyline",{points:"3 6 5 6 21 6"}),a.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),a.jsx("path",{d:"M10 11v6M14 11v6"})]}),uU=()=>a.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:a.jsx("path",{d:"M20 6L9 17l-5-5"})});function dU(){const[t,e]=S.useState(!0),[n,r]=S.useState([]),[s,i]=S.useState("list"),[o,l]=S.useState(""),{pathname:c}=yn(),d=kr(),f=S.useMemo(()=>i1(c),[c]);S.useEffect(()=>{(async()=>{e(!0);try{const y=(await et(Ie(ce,"listas_precios"))).docs.map(w=>({id:w.id,...w.data()}));y.sort((w,E)=>String(E.actualizado||E.creado||"").localeCompare(String(w.actualizado||w.creado||""))),r(y)}finally{e(!1)}})()},[]);const h=async()=>{if(!o.trim())return alert("Escribe el nombre de la lista.");const C=new Date().toLocaleString("es-CO"),y={nombre:o.trim(),creado:C,actualizado:C,en_uso:!1,tipo:"clinicos"},w=await fn(Ie(ce,"listas_precios"),y);r(E=>[{id:w.id,...y},...E]),l(""),i("list")},m=async C=>{const y=await et(Ie(ce,"listas_precios"));await Promise.all(y.docs.map(w=>Pn(Ke(ce,"listas_precios",w.id),{en_uso:w.id===C.id}))),r(w=>w.map(E=>({...E,en_uso:E.id===C.id})))},v=async C=>{window.confirm(`Eliminar "${C==null?void 0:C.nombre}"?`)&&(await fs(Ke(ce,"listas_precios",C.id)),r(y=>y.filter(w=>w.id!==C.id)))},R=async C=>{const y=new Date().toLocaleString("es-CO"),{id:w,...E}=C,I={...E,nombre:`${(C==null?void 0:C.nombre)||"Lista"} (copia)`,en_uso:!1,creado:y,actualizado:y},M=await fn(Ie(ce,"listas_precios"),I);r($=>[{id:M.id,...I},...$])},N=C=>d(`${f}/config/lista-de-precios/editar/${C.id}`);return a.jsxs("div",{className:"lp-card",children:[a.jsx("h3",{className:"lp-subtitle",children:"Lista de precios clnicos"}),s==="list"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"lp-card-header",children:[a.jsx("div",{}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsxs("button",{className:"chip",onClick:()=>i("nuevo"),children:[a.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de precios"]}),a.jsx("button",{className:"chip",onClick:()=>alert("Exportar plantilla (prximamente)"),children:"Exportar plantilla"})]})]}),a.jsx("div",{className:"lp-table-wrap",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Fecha de creacin"}),a.jsx("th",{children:"Fecha de actualizacin"}),a.jsx("th",{children:"En uso"}),a.jsx("th",{className:"actions",children:"Acciones"})]})}),a.jsx("tbody",{children:t?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center"},children:"Cargando"})}):n.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center"},className:"muted",children:"Sin datos"})}):n.map(C=>a.jsxs("tr",{children:[a.jsx("td",{style:{fontWeight:600},children:(C==null?void 0:C.nombre)||""}),a.jsx("td",{children:(C==null?void 0:C.creado)||""}),a.jsx("td",{children:(C==null?void 0:C.actualizado)||""}),a.jsx("td",{children:C!=null&&C.en_uso?a.jsx("span",{className:"badge green",children:"En uso"}):a.jsxs("button",{className:"btn-soft",onClick:()=>m(C),title:"Usar esta lista",children:[a.jsx(uU,{})," Usar"]})}),a.jsx("td",{className:"actions",children:a.jsxs("div",{className:"lp-actions",children:[a.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>R(C),"aria-label":"Clonar",children:a.jsx(n_,{})}),a.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>N(C),"aria-label":"Editar",children:a.jsx(t_,{})}),a.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>v(C),"aria-label":"Eliminar",children:a.jsx(r_,{})})]})})]},C.id))})]})})]}):a.jsxs("div",{children:[a.jsxs("div",{className:"lp-card-header",children:[a.jsx("h4",{style:{margin:0,fontWeight:700},children:"Nueva lista de precios"}),a.jsx("button",{className:"chip",onClick:()=>i("list"),children:" Volver"})]}),a.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",maxWidth:560,marginTop:10},children:[a.jsx("input",{type:"text",placeholder:"Nombre de la lista",value:o,onChange:C=>l(C.target.value),style:{flex:1,border:"1px solid #d1d5db",borderRadius:8,padding:"8px 10px"}}),a.jsx("button",{type:"button",title:"Sugerir nombre automtico",className:"chip",onClick:()=>l("Lista de precios "+new Date().toLocaleDateString("es-CO")),children:""}),a.jsx("button",{className:"btn-soft",onClick:h,children:"Guardar"})]})]})]})}function hU(){const[t,e]=S.useState([]),[n,r]=S.useState("list"),[s,i]=S.useState(null),o=kr(),{pathname:l}=yn(),c=S.useMemo(()=>i1(l),[l]),d=y=>o(`${c}/config/lista-de-precios/productos/editar/${y.id}`),f={nombre:"",referencia:"",descripcion:"",cuentaContable:"",categoria:"",esServicio:!1,precioCompra:"",marca:"",principioActivo:"",registroInvima:"",formaFarmaceutica:"",concentracion:"",presentacionComercial:"",tempAlmacenamiento:"",unidadTemperatura:"",humedadAlmacenamiento:"",unidadHumedad:"",esInventariable:!1,clasificacionRiesgo:"",vidaUtil:"",periodicidadMantenimiento:"",periodicidadCalibracion:"",extTexto1:"",extTexto2:"",extNumero1:"",extNumero2:"",extFecha1:"",extFecha2:""},[h,m]=S.useState(f);S.useEffect(()=>{(async()=>{try{const w=(await et(Ie(ce,"listas_precios_productos"))).docs.map(E=>({id:E.id,...E.data()}));e(w)}catch{e([])}})()},[]);const v=async y=>{const{id:w,...E}=y,I=await fn(Ie(ce,"listas_precios_productos"),{...E,nombre:`${(y==null?void 0:y.nombre)||"Producto"} (copia)`});e(M=>[{id:I.id,...E,nombre:`${(y==null?void 0:y.nombre)||"Producto"} (copia)`},...M])},R=async y=>{window.confirm(`Eliminar "${y==null?void 0:y.nombre}"?`)&&(await fs(Ke(ce,"listas_precios_productos",y.id)),e(w=>w.filter(E=>E.id!==y.id)))},N=y=>{var I;const w=(I=y.target.files)==null?void 0:I[0];if(!w)return;const E=new FileReader;E.onload=()=>i(E.result),E.readAsDataURL(w)},C=async()=>{if(!h.nombre.trim())return alert("El nombre es obligatorio.");const y={...h,precioCompra:h.precioCompra===""?0:Number(h.precioCompra),creado:new Date().toISOString(),imgPreview:s||null};await fn(Ie(ce,"productos"),y),m(f),i(null),r("list"),alert("Producto guardado.")};return a.jsxs("div",{className:"lp-card",children:[a.jsx("h3",{className:"lp-subtitle",children:"Lista de precios productos"}),n==="list"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"lp-card-header",children:[a.jsx("div",{}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsxs("button",{className:"chip",onClick:()=>r("nuevo"),children:[a.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo producto"]}),a.jsx("button",{className:"chip",onClick:()=>alert("Exportar plantilla (prximamente)"),children:"Exportar plantilla"})]})]}),a.jsx("div",{className:"lp-table-wrap",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Marca"}),a.jsx("th",{children:"Descripcin"}),a.jsx("th",{className:"actions",children:"Acciones"})]})}),a.jsx("tbody",{children:t.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(y=>a.jsxs("tr",{children:[a.jsx("td",{style:{fontWeight:600},children:(y==null?void 0:y.nombre)||""}),a.jsx("td",{children:(y==null?void 0:y.marca)||""}),a.jsx("td",{children:(y==null?void 0:y.descripcion)||""}),a.jsx("td",{className:"actions",children:a.jsxs("div",{className:"lp-actions",children:[a.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>v(y),"aria-label":"Clonar",children:a.jsx(n_,{})}),a.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>d(y),"aria-label":"Editar",children:a.jsx(t_,{})}),a.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>R(y),"aria-label":"Eliminar",children:a.jsx(r_,{})})]})})]},y.id))})]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"lp-card-header",children:[a.jsx("h4",{style:{margin:0,fontWeight:700},children:"Nuevo producto"}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("button",{className:"btn-soft gray",onClick:()=>r("list"),children:" Volver"}),a.jsx("button",{className:"btn-soft",onClick:C,children:"Guardar"})]})]}),a.jsxs("div",{className:"np-card-img",children:[a.jsx("div",{className:"np-avatar",children:s?a.jsx("img",{src:s,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12}}):a.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[a.jsx("circle",{cx:"12",cy:"8",r:"4"}),a.jsx("path",{d:"M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6"})]})}),a.jsxs("div",{className:"np-drop",children:[a.jsxs("div",{style:{marginBottom:6},children:["Arrastra o haz click para cargar la foto.",a.jsx("br",{}),"Solo archivos de imgenes"]}),a.jsx("input",{type:"file",accept:"image/*",onChange:N})]})]}),a.jsxs("div",{className:"np-grid",children:[a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Nombre*"}),a.jsx("input",{className:"np-input",value:h.nombre,onChange:y=>m({...h,nombre:y.target.value}),placeholder:"Nombre del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Referencia"}),a.jsx("input",{className:"np-input",value:h.referencia,onChange:y=>m({...h,referencia:y.target.value}),placeholder:"Referencia del concepto"})]})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Descripcin"}),a.jsx("textarea",{className:"np-text",value:h.descripcion,onChange:y=>m({...h,descripcion:y.target.value}),placeholder:"Descripcin del concepto"})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Cuenta contable"}),a.jsx("input",{className:"np-input",value:h.cuentaContable,onChange:y=>m({...h,cuentaContable:y.target.value}),placeholder:"Buscar tem..."})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Categora*"}),a.jsxs("select",{className:"np-select",value:h.categoria,onChange:y=>m({...h,categoria:y.target.value}),children:[a.jsx("option",{value:"",children:"Seleccione..."}),a.jsx("option",{children:"Medicamentos"}),a.jsx("option",{children:"Insumos"}),a.jsx("option",{children:"Equipos"})]})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field np-toggle",children:[a.jsx("label",{className:"np-label",style:{margin:0},children:"Es servicio?"}),a.jsx("input",{type:"checkbox",checked:h.esServicio,onChange:y=>m({...h,esServicio:y.target.checked})})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Precio compra*"}),a.jsx("input",{className:"np-input",type:"number",value:h.precioCompra,onChange:y=>m({...h,precioCompra:y.target.value}),placeholder:"$0"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Marca"}),a.jsx("input",{className:"np-input",value:h.marca,onChange:y=>m({...h,marca:y.target.value}),placeholder:"Marca del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Principio activo"}),a.jsx("input",{className:"np-input",value:h.principioActivo,onChange:y=>m({...h,principioActivo:y.target.value}),placeholder:"Principio activo del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Registro Invima"}),a.jsx("input",{className:"np-input",value:h.registroInvima,onChange:y=>m({...h,registroInvima:y.target.value}),placeholder:"Informacin Invima del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Forma farmacutica"}),a.jsx("input",{className:"np-input",value:h.formaFarmaceutica,onChange:y=>m({...h,formaFarmaceutica:y.target.value}),placeholder:"Forma farmacutica del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Concentracin"}),a.jsx("input",{className:"np-input",value:h.concentracion,onChange:y=>m({...h,concentracion:y.target.value}),placeholder:"Concentracin del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Presentacin comercial"}),a.jsx("input",{className:"np-input",value:h.presentacionComercial,onChange:y=>m({...h,presentacionComercial:y.target.value}),placeholder:"Presentacin com. del concepto"})]})]}),a.jsxs("div",{className:"np-row-3",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Temperatura de almacenamiento"}),a.jsx("input",{className:"np-input",value:h.tempAlmacenamiento,onChange:y=>m({...h,tempAlmacenamiento:y.target.value}),placeholder:"Temperatura de almacenamiento"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Unidad de temperatura"}),a.jsx("input",{className:"np-input",value:h.unidadTemperatura,onChange:y=>m({...h,unidadTemperatura:y.target.value}),placeholder:"Unidad de temp. del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Humedad de almacenamiento"}),a.jsx("input",{className:"np-input",value:h.humedadAlmacenamiento,onChange:y=>m({...h,humedadAlmacenamiento:y.target.value}),placeholder:"Humedad de almacenamiento"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Unidad de humedad"}),a.jsx("input",{className:"np-input",value:h.unidadHumedad,onChange:y=>m({...h,unidadHumedad:y.target.value}),placeholder:"Unidad de hum. del concepto"})]}),a.jsxs("div",{className:"np-field np-toggle",children:[a.jsx("label",{className:"np-label",style:{margin:0},children:"Es inventariable?"}),a.jsx("input",{type:"checkbox",checked:h.esInventariable,onChange:y=>m({...h,esInventariable:y.target.checked})})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Clasificacin de riesgo"}),a.jsx("input",{className:"np-input",value:h.clasificacionRiesgo,onChange:y=>m({...h,clasificacionRiesgo:y.target.value}),placeholder:"Clasif. riesgo del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Vida til"}),a.jsx("input",{className:"np-input",value:h.vidaUtil,onChange:y=>m({...h,vidaUtil:y.target.value}),placeholder:"Vida til del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Periodicidad mantenimiento"}),a.jsx("input",{className:"np-input",value:h.periodicidadMantenimiento,onChange:y=>m({...h,periodicidadMantenimiento:y.target.value}),placeholder:"Periodicidad mant. del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Periodicidad calibracin"}),a.jsx("input",{className:"np-input",value:h.periodicidadCalibracion,onChange:y=>m({...h,periodicidadCalibracion:y.target.value}),placeholder:"Periodicidad cal. del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin texto 1"}),a.jsx("input",{className:"np-input",value:h.extTexto1,onChange:y=>m({...h,extTexto1:y.target.value}),placeholder:"Ext. texto 1 del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin texto 2"}),a.jsx("input",{className:"np-input",value:h.extTexto2,onChange:y=>m({...h,extTexto2:y.target.value}),placeholder:"Ext. texto 2 del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin nmero 1"}),a.jsx("input",{className:"np-input",type:"number",value:h.extNumero1,onChange:y=>m({...h,extNumero1:y.target.value}),placeholder:"Ext. nmero 1 del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin nmero 2"}),a.jsx("input",{className:"np-input",type:"number",value:h.extNumero2,onChange:y=>m({...h,extNumero2:y.target.value}),placeholder:"Ext. nmero 2 del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin fecha 1 (dd/mm/aaaa)"}),a.jsx("input",{className:"np-input",type:"date",value:h.extFecha1,onChange:y=>m({...h,extFecha1:y.target.value})})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin fecha 2 (dd/mm/aaaa)"}),a.jsx("input",{className:"np-input",type:"date",value:h.extFecha2,onChange:y=>m({...h,extFecha2:y.target.value})})]})]}),a.jsxs("div",{className:"np-actions",children:[a.jsx("button",{className:"btn-soft gray",onClick:()=>r("list"),children:"Cancelar"}),a.jsx("button",{className:"btn-soft",onClick:C,children:"Guardar"})]})]})]})]})}function fU(){const[t,e]=S.useState([]);S.useEffect(()=>{(async()=>{try{const i=(await et(Ie(ce,"listas_precios_servicios"))).docs.map(o=>({id:o.id,...o.data()}));e(i)}catch{e([])}})()},[]);const n=async s=>{const{id:i,...o}=s,l=await fn(Ie(ce,"listas_precios_servicios"),{...o,nombre:`${(s==null?void 0:s.nombre)||"Servicio"} (copia)`});e(c=>[{id:l.id,...o,nombre:`${(s==null?void 0:s.nombre)||"Servicio"} (copia)`},...c])},r=async s=>{window.confirm(`Eliminar "${s==null?void 0:s.nombre}"?`)&&(await fs(Ke(ce,"listas_precios_servicios",s.id)),e(i=>i.filter(o=>o.id!==s.id)))};return a.jsxs("div",{className:"lp-card",children:[a.jsx("h3",{className:"lp-subtitle",children:"Lista de precios servicios"}),a.jsxs("div",{className:"lp-card-header",children:[a.jsx("div",{}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsxs("button",{className:"chip",onClick:()=>alert("Nuevo listado de servicios (prximamente)"),children:[a.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de servicios"]}),a.jsx("button",{className:"chip",onClick:()=>alert("Exportar plantilla (prximamente)"),children:"Exportar plantilla"})]})]}),a.jsx("div",{className:"lp-table-wrap",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Marca"}),a.jsx("th",{children:"Descripcin"}),a.jsx("th",{className:"actions",children:"Acciones"})]})}),a.jsx("tbody",{children:t.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(s=>a.jsxs("tr",{children:[a.jsx("td",{style:{fontWeight:600},children:(s==null?void 0:s.nombre)||""}),a.jsx("td",{children:(s==null?void 0:s.marca)||""}),a.jsx("td",{children:(s==null?void 0:s.descripcion)||""}),a.jsx("td",{className:"actions",children:a.jsxs("div",{className:"lp-actions",children:[a.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>n(s),"aria-label":"Clonar",children:a.jsx(n_,{})}),a.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>alert("Editar servicio (prx.)"),"aria-label":"Editar",children:a.jsx(t_,{})}),a.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>r(s),"aria-label":"Eliminar",children:a.jsx(r_,{})})]})})]},s.id))})]})})]})}function o1(){cU();const[t,e]=S.useState("clinicos");return a.jsxs("div",{className:"lp-wrap",children:[a.jsx("h2",{className:"lp-h2",children:"Configuracin  Lista de precios"}),a.jsxs("div",{className:"lp-tabs",children:[a.jsx("button",{className:`lp-pill ${t==="clinicos"?"active":""}`,onClick:()=>e("clinicos"),children:"Lista de precios clnicos"}),a.jsx("button",{className:`lp-pill ${t==="productos"?"active":""}`,onClick:()=>e("productos"),children:"Lista de precios productos"}),a.jsx("button",{className:`lp-pill ${t==="servicios"?"active":""}`,onClick:()=>e("servicios"),children:"Lista de precios servicios"})]}),t==="productos"?a.jsx(hU,{}):t==="servicios"?a.jsx(fU,{}):a.jsx(dU,{})]})}function pU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}const Gp=[{nombre:"Rehabilitacin Oral",comentario:""},{nombre:"Implantologa",comentario:""},{nombre:"Ciruga Oral",comentario:""},{nombre:"Periodoncia",comentario:""},{nombre:"Endodoncia",comentario:""},{nombre:"Ortodoncia",comentario:""},{nombre:"Odontologa General",comentario:""},{nombre:"Radiologa",comentario:""},{nombre:"Psicologa",comentario:""}],Cb=t=>Ke(ce,"listas_precios",t),Oi=t=>Ie(ce,"listas_precios",t,"categorias"),yr=(t,e)=>Ie(ce,"listas_precios",t,"categorias",e,"items");function mU(){S.useEffect(()=>{var r;const t="lp-edit-inline";(r=document.getElementById(t))==null||r.remove();const e=`
      .oc-main-content.lp { padding:16px 20px }
      .oc-section-title { margin-bottom:16px }
      .oc-section-title h2 { margin:0; font-weight:800; font-size:20px; color:#0f172a }
      .card { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.04) }
      .toolbar { display:flex; gap:8px; align-items:center; }

      .chip { height:34px; padding:0 12px; border-radius:999px; border:1px solid #e5e7eb; cursor:pointer; font-weight:600; background:#f9fafb; transition:.15s }
      .chip:hover { background:#e5e7eb }
      .chip.blue   { background:#3b82f6; color:#fff; border:none }
      .chip.green  { background:#22c55e; color:#fff; border:none }
      .chip.orange { background:#f59e0b; color:#fff; border:none }
      .chip.indigo { background:#6366f1; color:#fff; border:none }
      .chip.gray   { background:#64748b; color:#fff; border:none }

      .name-row { display:flex; align-items:center; gap:8px; }
      .text-inp { height:38px; padding:0 10px; border-radius:8px; border:1px solid #cbd5e1; outline:none; width:280px }

      .table-responsive { width:100%; overflow-x:auto }
      table { width:100%; border-collapse:collapse; font-size:.9rem }
      thead tr { background:#f1f5f9 }
      th, td { padding:10px 12px; white-space:nowrap; vertical-align:middle }
      th { text-align:left; border-bottom:1px solid #e2e8f0; color:#475569; font-weight:700 }
      tr + tr { border-top:1px solid #e2e8f0 }
      .muted { color:#64748b }
      .status-pill { padding:2px 8px; border-radius:999px; font-weight:600 }
      .status-on { background:#dcfce7; color:#166534 }
      .status-off{ background:#fee2e2; color:#991b1b }

      .btn { padding:4px 8px; border:none; border-radius:6px; color:#fff; cursor:pointer; margin-right:6px; font-weight:600; transition:.12s }
      .btn:hover { opacity:.9 }
      .btn.blue   { background:#3b82f6 }
      .btn.green  { background:#22c55e }
      .btn.orange { background:#f59e0b }
      .btn.red    { background:#ef4444 }
      .btn.sky    { background:#06b6d4 }
      .btn.sm { height:32px; padding:0 10px; border-radius:8px }

      /* Acorden */
      .toggle-cell{width:34px}
      .arrow{font-weight:900;font-size:18px;opacity:.7;cursor:pointer;display:inline-block}
      .row-cat-actions{display:flex;gap:6px;justify-content:flex-end}

      /* Fila desplegable */
      .cat-details{background:#fafafa}
      .inner-table{width:100%; border-collapse:collapse; font-size:.88rem}
      .inner-table th, .inner-table td{padding:8px 10px}
      .inner-table thead tr{background:#f8fafc}
      .inner-actions{display:flex;gap:6px;justify-content:flex-end}
      .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

      /* Modal base */
      .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:999}
      .modal{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(840px,92vw);padding:0;border:1px solid #e5e7eb}
      .modal .hd{padding:12px 16px;border-bottom:1px solid #e5e7eb;font-weight:700}
      .modal .bd{padding:16px}
      .modal .ft{padding:12px 16px;border-top:1px solid #e5e7eb;display:flex;gap:8px;justify-content:flex-end}

      .row{display:flex;gap:10px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
      .col{display:flex;flex-direction:column;gap:6px}
      .inp{height:36px;border:1px solid #cbd5e1;border-radius:8px;padding:0 10px;outline:none}
      .ta{border:1px solid #cbd5e1;border-radius:8px;padding:8px;min-height:80px;outline:none}
      .label-strong{font-weight:700;color:#0f172a}

      /* Toggle simple */
      .toggle{display:inline-flex;align-items:center;gap:10px}
      .toggle-pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #cbd5e1;border-radius:999px;padding:2px 8px;height:32px}
      .toggle-pill span{font-weight:700}
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}function gU(t){mU();const e=NP(),n=(t==null?void 0:t.listaId)??e.id??e.listaId??e.priceListId??e.listId??null,{pathname:r}=yn(),s=kr(),o=`${S.useMemo(()=>pU(r),[r])}/config/lista-de-precios`,[l,c]=S.useState(""),[d,f]=S.useState(!1),[h,m]=S.useState([]),[v,R]=S.useState(!0),[N,C]=S.useState(""),[y,w]=S.useState(!1),[E,I]=S.useState(!1),[M,$]=S.useState(!1),[b,x]=S.useState(!1),[_,P]=S.useState(null),D={codigo:"",nombre:"",precio:"0",observaciones:"",usa_pago_fijo:!1,pago_valor_fijo:"0",permite_descuento:!1,genera_rips:!1,es_consulta:!1,ver_en_agenda:!1,cuenta_contable:"",max_descuento_pct:"",max_descuento_valor:""},[j,k]=S.useState(D),[Y,He]=S.useState(0),[_t,kt]=S.useState("none"),[re,fe]=S.useState("existentes"),[ve,ke]=S.useState([]),[We,It]=S.useState(""),[U,ie]=S.useState("");S.useEffect(()=>{async function L(){if(!n){C("Ruta invlida: falta el id de la lista."),R(!1);return}R(!0);try{const W=await Bc(Cb(n));c(W.exists()&&W.data().nombre||"")}catch{c(""),C("No se pudo cargar la lista. Revisa la ruta y permisos.")}try{const X=(await et(Oi(n))).docs.map(ne=>({id:ne.id,expanded:!1,itemsLoaded:!1,items:[],activa:ne.data().activa??!0,...ne.data()}));X.sort((ne,O)=>(ne.nombre||"").localeCompare(O.nombre||"")),m(X)}finally{R(!1)}}L()},[n]);async function pe(){try{if(!n)return;f(!0),await Pn(Cb(n),{nombre:(l||"").trim(),actualizado:new Date().toLocaleString("es-CO")})}catch{alert("No se pudo actualizar el nombre.")}finally{f(!1)}}async function Ne(L){if(m(W=>W.map(X=>X.id===L.id?{...X,expanded:!X.expanded}:X)),!L.itemsLoaded&&n){const W=await et(yr(n,L.id)).catch(()=>null),X=W?W.docs.map(ne=>({id:ne.id,...ne.data()})):[];m(ne=>ne.map(O=>O.id===L.id?{...O,items:X,itemsLoaded:!0}:O))}}async function Ae(L){n&&(await Pn(Ke(Oi(n),L.id),{activa:!L.activa}),m(W=>W.map(X=>X.id===L.id?{...X,activa:!X.activa}:X)))}async function De(L){if(!n)return;const W=(prompt("Editar nombre de la categora:",L.nombre)||"").trim();if(!W)return;const X=(prompt("Comentario (opcional):",L.comentario||"")||"").trim();await Pn(Ke(Oi(n),L.id),{nombre:W,comentario:X}),m(ne=>ne.map(O=>O.id===L.id?{...O,nombre:W,comentario:X}:O))}async function be(L){if(!n||!confirm(`Eliminar categora "${L.nombre}" y TODOS sus tems?`))return;const W=await et(yr(n,L.id)).catch(()=>null);W&&await Promise.all(W.docs.map(X=>fs(Ke(yr(n,L.id),X.id)))),await fs(Ke(Oi(n),L.id)),m(X=>X.filter(ne=>ne.id!==L.id))}async function at(L){if(!n)return;const W=prompt("Ajuste porcentual (ej.: 5 para +5%, -10 para -10%)","5");if(W==null)return;const X=Number(W);if(Number.isNaN(X))return alert("Valor invlido.");const ne=await et(yr(n,L.id)).catch(()=>null);ne&&(await Promise.all(ne.docs.map(async O=>{const K=O.data()||{},Q=Math.round(Number(K.precio||0)*(1+X/100));await Pn(Ke(yr(n,L.id),O.id),{precio:Q,actualizado:new Date().toLocaleString("es-CO")})})),m(O=>O.map(K=>K.id===L.id?{...K,items:K.items.map(Q=>({...Q,precio:Math.round(Number(Q.precio||0)*(1+X/100))}))}:K)),alert("Precios actualizados."))}async function je(L){if(!n)return;const W=await fn(Oi(n),{nombre:`${L.nombre||"Categora"} (copia)`,comentario:L.comentario||"",activa:!0,creado:new Date().toLocaleString("es-CO")});m(X=>[...X,{...L,id:W.id,nombre:`${L.nombre||"Categora"} (copia)`,expanded:!1,itemsLoaded:!1,items:[],activa:!0}])}function me(L){P(L),k(D),x(!0)}async function Oe(){if(!n||!_)return;if(!j.nombre.trim())return alert("El nombre es obligatorio.");const L=ne=>Number(String(ne).replace(/\D/g,""))||0,W={codigo:j.codigo.trim(),nombre:j.nombre.trim(),permite_descuento:!!j.permite_descuento,max_descuento_pct:j.permite_descuento?Number(j.max_descuento_pct||0):0,max_descuento_valor:j.permite_descuento?L(j.max_descuento_valor||0):0,genera_rips:!!j.genera_rips,es_consulta:!!j.es_consulta,ver_en_agenda:!!j.ver_en_agenda,cuenta_contable:j.cuenta_contable.trim(),comentario:j.observaciones.trim(),precio:L(j.precio),usa_pago_fijo:!!j.usa_pago_fijo,pago_valor_fijo:L(j.pago_valor_fijo),creado:new Date().toLocaleString("es-CO")},X=await fn(yr(n,_.id),W);m(ne=>ne.map(O=>O.id===_.id?{...O,items:[...O.items,{id:X.id,...W}],expanded:!0}:O)),x(!1)}async function Fe(L,W){if(!n)return;const X=(prompt("Cdigo:",W.codigo||"")||"").trim(),ne=(prompt("Nombre:",W.nombre||"")||"").trim(),O=window.confirm("Permite descuento? (Aceptar = S / Cancelar = No)"),K=(prompt("Precio (COP):",String(W.precio||0))||"0").replace(/\D/g,""),Q=Number(K||0);await Pn(Ke(yr(n,L.id),W.id),{codigo:X,nombre:ne,permite_descuento:!!O,precio:Q,actualizado:new Date().toLocaleString("es-CO")}),m(Se=>Se.map(Pe=>Pe.id===L.id?{...Pe,items:Pe.items.map(Xe=>Xe.id===W.id?{...Xe,codigo:X,nombre:ne,permite_descuento:!!O,precio:Q}:Xe)}:Pe))}async function nt(L,W){n&&confirm(`Eliminar "${W.nombre}"?`)&&(await fs(Ke(yr(n,L.id),W.id)),m(X=>X.map(ne=>ne.id===L.id?{...ne,items:ne.items.filter(O=>O.id!==W.id)}:ne)))}async function G(){try{const L=Ie(ce,"catalogo_categorias");for(const W of Gp){const X=`${W.nombre}`.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-");await zc(Ke(L,X),{nombre:W.nombre,comentario:W.comentario||""},{merge:!0})}alert("Catlogo base creado/actualizado. Vuelve a abrir 'Agregar categora'.")}catch{alert("No se pudo sembrar el catlogo base.")}}async function le(){$(!0),fe("existentes"),It(""),ie("");try{const W=(await et(Ie(ce,"catalogo_categorias"))).docs.map(X=>({id:X.id,...X.data()}));ke(W.length?W:Gp.map((X,ne)=>({id:`def-${ne}`,...X})))}catch{ke(Gp.map((L,W)=>({id:`def-${W}`,...L})))}}async function z(L){if(n)try{const W=Oi(n);await fn(W,{nombre:L.nombre,comentario:L.comentario||"",activa:!0,creado:new Date().toLocaleString("es-CO")});const X=await et(W);m(X.docs.map(ne=>({id:ne.id,...ne.data(),activa:ne.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),alert("Categora agregada.")}catch{alert("No se pudo agregar la categora.")}}async function ae(){if(n){if(!We.trim())return alert("Escribe el nombre de la categora.");try{const L=Oi(n);await fn(L,{nombre:We.trim(),comentario:U.trim(),activa:!0,creado:new Date().toLocaleString("es-CO")});const W=await et(L);m(W.docs.map(X=>({id:X.id,...X.data(),activa:X.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),$(!1)}catch{alert("No se pudo crear la categora.")}}}function ue(){return new Promise(L=>{if(typeof window<"u"&&window.XLSX)return L(window.XLSX);const W=document.createElement("script");W.src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js",W.onload=()=>L(window.XLSX||null),W.onerror=()=>L(null),document.head.appendChild(W)})}function we(L,W){return W==="up"?Math.ceil(L):W==="down"?Math.floor(L):L}async function xe(){if(!n)return;const L=Number(Y);if(!Number.isFinite(L))return alert("Ingresa un porcentaje vlido.");try{for(const W of h){const X=await et(yr(n,W.id)).catch(()=>null);if(X)for(const ne of X.docs){const O=ne.data()||{},K=we(Number(O.precio||0)*(1+L/100),_t);await Pn(Ke(yr(n,W.id),ne.id),{precio:K,actualizado:new Date().toLocaleString("es-CO")})}}alert("Precios actualizados."),w(!1)}catch{alert("No se pudo aplicar el incremento.")}}async function Me(){try{if(!n)return;const L=["Categora","Cdigo","Nombre","Permite desc","Precio","Genera RIPS","Es consulta","Ver en agenda","Nombre en la agenda","Tiempo","Identificador","Cuenta contable"],W=[],X=`OdontoCloud  Lista de precios  ${l||"Principal"}`,ne=`Exportado: ${new Date().toLocaleString("es-CO")}`;W.push([X]),W.push([ne]),W.push([]),W.push(L);const O=4,K=Pe=>Pe?"si":"no";for(const Pe of h){const Xe=await et(yr(n,Pe.id)).catch(()=>null),jt=Xe?Xe.docs.map(Ge=>({id:Ge.id,...Ge.data()})):[];for(const Ge of jt)W.push([Pe.nombre||"",Ge.codigo||"",Ge.nombre||"",K(!!Ge.permite_descuento),Number(Ge.precio||0),K(!!Ge.genera_rips),K(!!Ge.es_consulta),K(!!Ge.ver_en_agenda),Ge.nombre_en_agenda||"",Number(Ge.tiempo||0),Ge.identificador||"",Ge.cuenta_contable||""])}const Q=await ue(),Se=`OdontoCloud-ListaPrecios-${l||"Principal"}`;if(Q&&Q.utils&&W.length>O-1){const Pe=Q.utils.aoa_to_sheet(W);Pe["!cols"]=[{wch:22},{wch:14},{wch:36},{wch:12},{wch:14},{wch:12},{wch:12},{wch:14},{wch:28},{wch:10},{wch:16},{wch:18}],Pe["!merges"]=[{s:{r:0,c:0},e:{r:0,c:11}},{s:{r:1,c:0},e:{r:1,c:11}}];const Xe=W.length;Pe["!autofilter"]={ref:`A${O}:L${Xe}`};const jt=Q.utils.book_new();Q.utils.book_append_sheet(jt,Pe,"Lista de precios");const Ge=Q.write(jt,{bookType:"xlsx",type:"array"}),Zt=new Blob([Ge],{type:"application/octet-stream"}),dt=document.createElement("a");dt.href=URL.createObjectURL(Zt),dt.download=`${Se}.xlsx`,dt.click(),URL.revokeObjectURL(dt.href)}else{const Pe=W.map(Ge=>Ge.map(Zt=>{const dt=String(Zt??"").replace(/"/g,'""');return/[",\n]/.test(dt)?`"${dt}"`:dt}).join(",")).join(`
`),Xe=new Blob([Pe],{type:"text/csv;charset=utf-8"}),jt=document.createElement("a");jt.href=URL.createObjectURL(Xe),jt.download=`${Se}.csv`,jt.click(),URL.revokeObjectURL(jt.href)}}catch{alert("No se pudo exportar.")}}return a.jsxs("div",{className:"oc-main-content lp",children:[a.jsx("div",{className:"oc-section-title",children:a.jsx("h2",{children:"Configuracin  Edicin Lista de precios"})}),N&&a.jsx("div",{style:{marginBottom:12,padding:"8px 12px",border:"1px solid #fecaca",background:"#fef2f2",color:"#991b1b",borderRadius:8},children:N}),a.jsxs("div",{className:"card",children:[a.jsxs("div",{className:"toolbar",style:{justifyContent:"space-between",marginBottom:12},children:[a.jsxs("div",{className:"name-row",children:[a.jsx("label",{style:{fontWeight:700},children:"Nombre*"}),a.jsx("input",{className:"text-inp",value:l,placeholder:"Principal",onChange:L=>c(L.target.value)}),a.jsx("button",{className:"btn green",onClick:pe,disabled:d,title:"Guardar nombre",children:d?"Guardando":"Guardar"})]}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("button",{className:"chip blue",title:"Exportar",onClick:Me,children:"Exportar"}),a.jsx("button",{className:"chip orange",title:"Incrementar %",onClick:()=>{He(0),kt("none"),w(!0)},children:"%"}),a.jsx("button",{className:"chip indigo",title:"Opciones",onClick:()=>I(!0),children:" Opciones"}),a.jsx("button",{className:"chip green",onClick:le,children:"+ Agregar categora"})]})]}),a.jsx("div",{className:"table-responsive",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:"toggle-cell"}),a.jsx("th",{children:"Categora"}),a.jsx("th",{children:"Comentario"}),a.jsx("th",{style:{width:140},children:"Estado"}),a.jsx("th",{style:{width:360,textAlign:"right"},children:"Acciones"})]})}),a.jsx("tbody",{children:v?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):h.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Sin categoras."})}):h.map(L=>a.jsxs(Pg.Fragment,{children:[a.jsxs("tr",{children:[a.jsx("td",{className:"toggle-cell",children:a.jsx("span",{className:"arrow",onClick:()=>Ne(L),children:L.expanded?"":""})}),a.jsx("td",{style:{fontWeight:700},children:L.nombre||"Categora"}),a.jsx("td",{className:"muted",children:L.comentario||""}),a.jsx("td",{children:a.jsx("span",{className:`status-pill ${L.activa?"status-on":"status-off"}`,children:L.activa?"Conectado":"Desconectado"})}),a.jsx("td",{style:{textAlign:"right"},children:a.jsxs("div",{className:"row-cat-actions",children:[a.jsx("button",{className:"btn green sm",title:"Nuevo tem",onClick:()=>me(L),children:""}),a.jsx("button",{className:"btn orange sm",title:"Actualizar precios %",onClick:()=>at(L),children:"%"}),a.jsx("button",{className:"btn sky sm",title:"Editar categora",onClick:()=>De(L),children:""}),a.jsx("button",{className:"btn red sm",title:"Eliminar categora",onClick:()=>be(L),children:""}),a.jsx("button",{className:"btn blue sm",title:L.activa?"Desactivar":"Activar",onClick:()=>Ae(L),children:L.activa?"":""}),a.jsx("button",{className:"btn sky sm",title:"Duplicar categora",onClick:()=>je(L),children:""})]})})]}),L.expanded&&a.jsxs("tr",{className:"cat-details",children:[a.jsx("td",{}),a.jsx("td",{colSpan:4,children:a.jsx("div",{className:"table-responsive",children:a.jsxs("table",{className:"inner-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:{width:110},children:"Cdigo"}),a.jsx("th",{children:"Lista de precios"}),a.jsx("th",{style:{width:160},children:"Permite descuento"}),a.jsx("th",{style:{width:140},children:"Precio"}),a.jsx("th",{style:{width:140,textAlign:"right"},children:"Acciones"})]})}),a.jsx("tbody",{children:!L.items||L.items.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"muted",style:{textAlign:"center",padding:12},children:"Sin tems en esta categora."})}):L.items.map(W=>a.jsxs("tr",{children:[a.jsx("td",{className:"mono",children:W.codigo||""}),a.jsx("td",{style:{fontWeight:600},children:W.nombre||""}),a.jsx("td",{children:W.permite_descuento?"S":"No"}),a.jsxs("td",{className:"mono",children:["$",Number(W.precio||0).toLocaleString("es-CO")]}),a.jsx("td",{style:{textAlign:"right"},children:a.jsxs("div",{className:"inner-actions",children:[a.jsx("button",{className:"btn sky sm",onClick:()=>Fe(L,W),children:""}),a.jsx("button",{className:"btn red sm",onClick:()=>nt(L,W),children:""})]})})]},W.id))})]})})})]})]},L.id))})]})}),a.jsx("div",{style:{marginTop:16},children:a.jsx("button",{className:"chip gray",onClick:()=>s(o),children:" Volver"})})]}),y&&a.jsx("div",{className:"modal-mask",onClick:()=>w(!1),children:a.jsxs("div",{className:"modal",onClick:L=>L.stopPropagation(),children:[a.jsx("div",{className:"hd",children:"Incrementar todos los precios"}),a.jsx("div",{className:"bd",children:a.jsxs("div",{className:"col",children:[a.jsx("label",{className:"label-strong",children:"Porcentaje de incremento *"}),a.jsx("div",{className:"row",children:a.jsx("input",{className:"inp",style:{maxWidth:160},type:"number",min:"0",step:"0.01",placeholder:"0",value:Y,onChange:L=>He(L.target.value)})}),a.jsxs("div",{className:"col",style:{gap:8},children:[a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"radio",name:"round",checked:_t==="down",onChange:()=>kt("down")})," Redondear hacia abajo"]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"radio",name:"round",checked:_t==="up",onChange:()=>kt("up")})," Redondear hacia arriba"]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"radio",name:"round",checked:_t==="none",onChange:()=>kt("none")})," No redondear"]})]})]})}),a.jsxs("div",{className:"ft",children:[a.jsx("button",{className:"chip gray",onClick:()=>w(!1),children:"Cerrar"}),a.jsx("button",{className:"chip green",onClick:xe,children:"Incrementar"})]})]})}),E&&a.jsx("div",{className:"modal-mask",onClick:()=>I(!1),children:a.jsxs("div",{className:"modal",onClick:L=>L.stopPropagation(),children:[a.jsx("div",{className:"hd",children:"Opciones"}),a.jsxs("div",{className:"bd",children:[a.jsx("p",{className:"muted",style:{marginTop:0},children:"Acciones generales de la lista."}),a.jsx("button",{className:"chip green",onClick:G,children:"Sembrar catlogo base"})]}),a.jsx("div",{className:"ft",children:a.jsx("button",{className:"chip gray",onClick:()=>I(!1),children:"Cerrar"})})]})}),M&&a.jsx("div",{className:"modal-mask",onClick:()=>$(!1),children:a.jsxs("div",{className:"modal",onClick:L=>L.stopPropagation(),children:[a.jsx("div",{className:"hd",children:"Categora"}),a.jsxs("div",{className:"bd",children:[a.jsxs("div",{className:"row",style:{gap:6,marginBottom:12},children:[a.jsx("button",{className:`chip ${re==="existentes"?"blue":""}`,onClick:()=>fe("existentes"),children:"Categoras existentes"}),a.jsx("button",{className:`chip ${re==="nueva"?"blue":""}`,onClick:()=>fe("nueva"),children:"Editar/Nueva categora"})]}),re==="existentes"?a.jsx("div",{children:ve.length===0?a.jsx("p",{className:"muted",children:"No hay catlogo disponible. Puedes crear una nueva categora en la pestaa de la derecha."}):a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Comentario"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:ve.map(L=>a.jsxs("tr",{children:[a.jsx("td",{children:L.nombre}),a.jsx("td",{className:"muted",children:L.comentario||""}),a.jsx("td",{children:a.jsx("button",{className:"btn green sm",onClick:()=>z(L),children:"Agregar"})})]},L.id))})]})}):a.jsxs("div",{children:[a.jsxs("div",{className:"row",children:[a.jsx("label",{style:{minWidth:140},children:"Nombre *"}),a.jsx("input",{className:"inp",placeholder:"Ingrese el nombre de la categora",value:We,onChange:L=>It(L.target.value)})]}),a.jsxs("div",{className:"row",style:{alignItems:"flex-start"},children:[a.jsx("label",{style:{minWidth:140,paddingTop:6},children:"Comentario"}),a.jsx("textarea",{className:"ta",placeholder:"",value:U,onChange:L=>ie(L.target.value)})]})]})]}),a.jsxs("div",{className:"ft",children:[a.jsx("button",{className:"chip gray",onClick:()=>$(!1),children:"Cerrar"}),re==="nueva"&&a.jsx("button",{className:"chip green",onClick:ae,children:"Guardar"})]})]})}),b&&a.jsx("div",{className:"modal-mask",onClick:()=>x(!1),children:a.jsxs("div",{className:"modal",onClick:L=>L.stopPropagation(),children:[a.jsxs("div",{className:"hd",children:["Agregar producto ",_?` ${_.nombre}`:""]}),a.jsx("div",{className:"bd",children:a.jsxs("div",{className:"col",style:{gap:12},children:[a.jsxs("div",{className:"row",children:[a.jsxs("div",{className:"col",style:{flex:1},children:[a.jsx("label",{className:"label-strong",children:"Cdigo *"}),a.jsx("input",{className:"inp",value:j.codigo,onChange:L=>k({...j,codigo:L.target.value}),placeholder:"Cdigo"})]}),a.jsxs("div",{className:"col",style:{flex:2},children:[a.jsx("label",{className:"label-strong",children:"Nombre *"}),a.jsx("input",{className:"inp",value:j.nombre,onChange:L=>k({...j,nombre:L.target.value}),placeholder:"Nombre del procedimiento"})]}),a.jsxs("div",{className:"col",style:{width:200},children:[a.jsx("label",{className:"label-strong",children:"Precio *"}),a.jsx("input",{className:"inp",type:"number",min:"0",value:j.precio,onChange:L=>k({...j,precio:L.target.value}),placeholder:"$0"})]})]}),a.jsxs("div",{className:"col",children:[a.jsx("label",{className:"label-strong",children:"Observaciones"}),a.jsx("textarea",{className:"ta",value:j.observaciones,onChange:L=>k({...j,observaciones:L.target.value})})]}),a.jsx("div",{className:"row",children:a.jsxs("div",{className:"col",style:{flex:1},children:[a.jsx("label",{className:"label-strong",children:"Pago valor fijo a doctores"}),a.jsxs("div",{className:"row",children:[a.jsx("input",{className:"inp",style:{maxWidth:160},type:"number",min:"0",value:j.pago_valor_fijo,onChange:L=>k({...j,pago_valor_fijo:L.target.value})}),a.jsxs("label",{className:"toggle",style:{marginLeft:10},children:[a.jsx("input",{type:"checkbox",checked:j.usa_pago_fijo,onChange:L=>k({...j,usa_pago_fijo:L.target.checked})}),"Usar valor fijo"]})]}),a.jsx("small",{className:"muted",children:"Use este campo para no liquidar a los doctores por su % configurado sino por un valor fijo en dinero $"})]})}),a.jsxs("div",{className:"row",children:[a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:j.permite_descuento,onChange:L=>k({...j,permite_descuento:L.target.checked,...L.target.checked?{}:{max_descuento_pct:"",max_descuento_valor:""}})}),"Permite descuento"]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:j.genera_rips,onChange:L=>k({...j,genera_rips:L.target.checked})})," Genera RIPS"]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:j.es_consulta,onChange:L=>k({...j,es_consulta:L.target.checked})})," Es consulta"]}),a.jsxs("div",{className:"toggle",children:[a.jsx("span",{children:"Ver en agenda"}),a.jsxs("label",{className:"toggle-pill",children:[a.jsx("input",{type:"checkbox",checked:j.ver_en_agenda,onChange:L=>k({...j,ver_en_agenda:L.target.checked})}),a.jsx("span",{children:j.ver_en_agenda?"S":"No"})]})]})]}),j.permite_descuento&&a.jsxs("div",{className:"row",children:[a.jsxs("div",{className:"col",style:{minWidth:240},children:[a.jsx("label",{className:"label-strong",children:"Mximo descuento (%)"}),a.jsxs("div",{className:"row",style:{gap:6},children:[a.jsx("input",{className:"inp",type:"number",min:"0",step:"0.01",placeholder:"0",value:j.max_descuento_pct,onChange:L=>k({...j,max_descuento_pct:L.target.value}),style:{maxWidth:160}}),a.jsx("span",{className:"muted",style:{alignSelf:"center"},children:"%"})]})]}),a.jsxs("div",{className:"col",style:{minWidth:240},children:[a.jsx("label",{className:"label-strong",children:"Mximo descuento ($)"}),a.jsxs("div",{className:"row",style:{gap:6},children:[a.jsx("span",{className:"muted",style:{alignSelf:"center"},children:"$"}),a.jsx("input",{className:"inp",type:"number",min:"0",step:"1",placeholder:"0",value:j.max_descuento_valor,onChange:L=>k({...j,max_descuento_valor:L.target.value}),style:{maxWidth:200}})]})]})]}),a.jsx("div",{className:"row",children:a.jsxs("div",{className:"col",style:{flex:1},children:[a.jsx("label",{className:"label-strong",children:"Cuenta contable"}),a.jsx("input",{className:"inp",placeholder:"Buscar tem...",value:j.cuenta_contable,onChange:L=>k({...j,cuenta_contable:L.target.value})})]})})]})}),a.jsxs("div",{className:"ft",children:[a.jsx("button",{className:"chip gray",onClick:()=>x(!1),children:"Cerrar"}),a.jsx("button",{className:"chip green",onClick:Oe,children:"Guardar"})]})]})})]})}const Pl="listas_precios_productos";function yU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function vU(){const[t,e]=S.useState(!0),[n,r]=S.useState([]),{pathname:s}=yn(),i=kr(),o=S.useMemo(()=>yU(s),[s]),l=h=>i(`${o}/config/lista-de-precios/productos/editar/${h.id}`);S.useEffect(()=>{async function h(){e(!0);try{const v=(await et(Ie(ce,Pl))).docs.map(R=>({id:R.id,...R.data()}));v.sort((R,N)=>{const C=R.actualizado||R.creado||"",y=N.actualizado||N.creado||"";return C&&y?String(y).localeCompare(String(C)):((R==null?void 0:R.nombre)||"").localeCompare((N==null?void 0:N.nombre)||"")}),r(v)}catch(m){console.error("[LP Productos] cargar:",m==null?void 0:m.code,m==null?void 0:m.message),r([])}finally{e(!1)}}h()},[]);async function c(){try{const m={nombre:`Lista de productos ${new Date().toLocaleDateString("es-CO")}`,creado:new Date().toLocaleString("es-CO"),actualizado:new Date().toLocaleString("es-CO"),en_uso:!1,tipo:"productos"},v=await fn(Ie(ce,Pl),m);r(R=>[{id:v.id,...m},...R])}catch(h){console.error(h),alert("No se pudo crear el listado de productos.")}}async function d(h){try{const v=(await et(Ie(ce,Pl))).docs.map(R=>Pn(Ke(ce,Pl,R.id),{en_uso:R.id===h.id}));await Promise.all(v),r(R=>R.map(N=>({...N,en_uso:N.id===h.id})))}catch(m){console.error(m),alert("No se pudo cambiar el estado de uso.")}}async function f(h){if(window.confirm(`Eliminar "${h==null?void 0:h.nombre}"?`))try{await fs(Ke(ce,Pl,h.id)),r(m=>m.filter(v=>v.id!==h.id))}catch(m){console.error(m),alert("No se pudo eliminar.")}}return a.jsxs("div",{className:"lp-card",children:[a.jsxs("div",{className:"lp-tabs",style:{justifyContent:"space-between"},children:[a.jsx("div",{style:{display:"flex",gap:8},children:a.jsx("span",{className:"lp-pill active",children:"Lista de precios productos"})}),a.jsx("button",{className:"btn blue",onClick:c,children:"+ Nuevo listado de productos"})]}),a.jsx("div",{className:"lp-table-wrap",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Fecha de creacin"}),a.jsx("th",{children:"Fecha de actualizacin"}),a.jsx("th",{children:"En uso"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:t?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):n.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:a.jsx("span",{className:"muted",children:"Sin datos"})})}):n.map(h=>a.jsxs("tr",{children:[a.jsx("td",{style:{fontWeight:700},children:(h==null?void 0:h.nombre)||""}),a.jsx("td",{children:(h==null?void 0:h.creado)||""}),a.jsx("td",{children:(h==null?void 0:h.actualizado)||""}),a.jsx("td",{style:{color:h!=null&&h.en_uso?"#16a34a":"#64748b"},children:h!=null&&h.en_uso?"En uso":""}),a.jsx("td",{children:a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("button",{className:"btn blue",onClick:()=>l(h),children:"Editar"}),a.jsx("button",{className:"btn green",onClick:()=>d(h),children:"Usar"}),a.jsx("button",{className:"btn red",onClick:()=>f(h),children:"Eliminar"})]})})]},h.id))})]})})]})}const _U={"datos-basicos":aU,logo:lU,"lista-de-precios":o1};function wU(t=""){const e=t.toLowerCase().indexOf("/config/");return e===-1?[]:t.slice(e+8).split("/").filter(Boolean)}function xU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function EU({current:t,onNav:e}){const n=[{slug:"datos-basicos",label:"Datos bsicos"},{slug:"logo",label:"Logo"},{slug:"lista-de-precios",label:"Lista de precios"},{slug:"consecutivos",label:"Consecutivos",soon:!0},{slug:"sucursales",label:"Sucursales",soon:!0},{slug:"metodos-de-pago",label:"Mtodos de pago",soon:!0},{slug:"especialidades",label:"Especialidades",soon:!0},{slug:"usuarios",label:"Usuarios",soon:!0},{slug:"condiciones-de-pago",label:"Condiciones de pago",soon:!0},{slug:"plantillas-doc-clinicos",label:"Plantillas Doc. Clnicos",soon:!0},{slug:"impuestos",label:"Impuestos",soon:!0}];return a.jsxs("aside",{style:{width:300,flex:"0 0 300px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,position:"sticky",top:12,alignSelf:"flex-start",maxHeight:"calc(100vh - 24px)",overflow:"auto"},"aria-label":"Informacin general",children:[a.jsx("h4",{style:{margin:"4px 0 10px",color:"#64748b"},children:"Informacin general"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.map(r=>{const s=r.slug===t;return a.jsxs("button",{type:"button",onClick:()=>!r.soon&&e(r.slug),title:r.soon?"Prximamente":r.label,style:{textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid "+(s?"#60a5fa":"#e5e7eb"),background:s?"#eff6ff":"#f9fafb",fontWeight:600,cursor:r.soon?"not-allowed":"pointer",color:r.soon?"#94a3b8":"#0f172a"},children:[r.label," ",r.soon?"  prximamente":""]},r.slug)})})]})}function Nb(){return a.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[a.jsx("h3",{style:{marginTop:0},children:"Configuracin"}),a.jsxs("p",{className:"oc-muted",style:{margin:0},children:["Selecciona una seccin del men de la izquierda para empezar (por ejemplo, ",a.jsx("b",{children:"Datos bsicos"}),")."]})]})}function bU(){const{pathname:t}=yn(),e=kr(),n=wU(t),r=n[0]||"",s=n[1]||"",i=xU(t),o=r==="lista-de-precios"&&!s,l=r==="lista-de-precios"&&s==="productos",c=r==="lista-de-precios"&&s==="editar";let d=_U[r]||Nb,f={};if(c){const m=n[2]||null;d=gU,f={listaId:m,key:`lpedit-${m||"none"}`}}else l?d=vU:o&&(d=o1);const h=m=>e(`${i}/config/${m}`);return S.useEffect(()=>{r||e(`${i}/config/datos-basicos`,{replace:!0})},[r,i,e]),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",gap:16,background:"#f8fafc",padding:16,borderRadius:12},children:[a.jsx(EU,{current:r,onNav:h}),a.jsx("div",{style:{minWidth:0,background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:r?a.jsx(d,{...f}):a.jsx(Nb,{})})]})}const Ur=t=>(Number(t)||0).toLocaleString("es-CO",{maximumFractionDigits:0}),Wo=()=>new Date().toISOString().slice(0,10),IU=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),TU=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0),Ab=t=>qe.fromDate(t),SU=()=>{const[t,e]=S.useState(null);return S.useEffect(()=>{const n=Uy(Rh,r=>e(r||null));return()=>n()},[]),t},Qt=({children:t,align:e})=>a.jsx("th",{className:"oc-th",style:{position:"sticky",top:0,zIndex:1,textAlign:e||"left",background:"var(--oc-surface, #fff)"},children:t}),CU=()=>Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);function NU(){var ne;const t=SU(),e=[{key:"abrir",label:"Abrir caja",icon:""},{key:"abiertas",label:"Cajas abiertas",icon:""},{key:"cerradas",label:"Cajas cerradas",icon:""},{key:"mio",label:"Mi caja (hoy)",icon:""},{key:"simulados",label:"Cierres simulados",icon:""},{key:"bancos",label:"Bancos",icon:""}],[n,r]=S.useState("abiertas"),[s,i]=S.useState(""),[o,l]=S.useState(""),c=S.useRef(null),[d,f]=S.useState(!1),[h,m]=S.useState(""),[v,R]=S.useState([]),[N,C]=S.useState(!0),[y,w]=S.useState([]),[E,I]=S.useState(!0),[M,$]=S.useState(null),[b,x]=S.useState(!0),[_,P]=S.useState(""),[D,j]=S.useState([]),[k,Y]=S.useState(null),[He,_t]=S.useState(""),[kt,re]=S.useState("efectivo"),[fe,ve]=S.useState(!1),[ke,We]=S.useState("ingreso"),[It,U]=S.useState(""),[ie,pe]=S.useState(""),[Ne,Ae]=S.useState(!1),[De,be]=S.useState([]),[at,je]=S.useState([]);S.useEffect(()=>{const O=ct(Ie(ce,"cajas"),rt("estado","==","abierta"),xn("fechaApertura","desc")),K=zn(O,Q=>{R(Q.docs.map(Se=>me(Se.id,Se.data()))),C(!1),i("")},Q=>{console.error(Q),i((Q==null?void 0:Q.code)==="failed-precondition"?"Falta ndice (estado, fechaApertura) en Firestore.":(Q==null?void 0:Q.code)==="permission-denied"?"Permiso denegado en Firestore (revisa reglas).":"No se pudieron leer las cajas."),C(!1)});return()=>K()},[]),S.useEffect(()=>{const O=ct(Ie(ce,"cajas"),rt("estado","==","cerrada"),xn("fechaCierre","desc")),K=zn(O,Q=>{w(Q.docs.map(Se=>me(Se.id,Se.data()))),I(!1)},Q=>{console.error(Q),I(!1)});return()=>K()},[]),S.useEffect(()=>{if(!t){$(null),x(!1);return}x(!0);const O=ct(Ie(ce,"cajas"),rt("estado","==","abierta"),rt("usuarioId","==",t.uid),rt("fechaApertura",">=",Ab(IU())),rt("fechaApertura","<",Ab(TU()))),K=zn(O,Q=>{const Se=Q.docs[0];$(Se?me(Se.id,Se.data()):null),x(!1)},Q=>{console.error(Q),x(!1),(Q==null?void 0:Q.code)==="failed-precondition"&&i("Falta ndice (estado, usuarioId, fechaApertura) en Firestore.")});return()=>K()},[t]),S.useEffect(()=>{if(!(M!=null&&M.id)){be([]),je([]);return}const O=ct(Ie(ce,"movimientos"),rt("cashId","==",M.id),rt("dia","==",Wo()),xn("fecha","desc")),K=zn(O,Pe=>be(Pe.docs.map(Xe=>({id:Xe.id,...Xe.data()}))),Pe=>console.error(Pe)),Q=ct(Ie(ce,"payments"),rt("cashId","==",M.id),rt("dia","==",Wo()),xn("fecha","desc")),Se=zn(Q,Pe=>je(Pe.docs.map(Xe=>({id:Xe.id,...Xe.data()}))),Pe=>console.error(Pe));return()=>{K(),Se()}},[M==null?void 0:M.id]),S.useEffect(()=>{if(!(_!=null&&_.trim())){j([]);return}const O=ct(Ie(ce,"patients"),rt("q",">=",z(_)),rt("q","<=",z(_)+""),xn("q","asc")),K=zn(O,Q=>j(Q.docs.map(Se=>({id:Se.id,...Se.data()}))),Q=>console.error(Q));return()=>K()},[_]);function me(O,K={}){const Q=Dt=>{var Wt;return((Wt=Dt==null?void 0:Dt.toDate)==null?void 0:Wt.call(Dt))||(typeof Dt=="string"?new Date(Dt):Dt||null)},Se=Q(K.fechaApertura),Pe=Q(K.fechaCierre),Xe=Number(K.baseInicial||0),jt=Number(K.baseActual!==void 0?K.baseActual:Xe),Ge=Number(K.saldoInicial||0),Zt=Number(K.saldoActual!==void 0?K.saldoActual:Ge),dt=[];return Zt<0&&dt.push("Saldo negativo"),jt<0&&dt.push("Base negativa"),{id:O,estado:K.estado||"abierta",usuarioId:K.usuarioId||"",usuarioNombre:K.usuarioNombre||"Usuario",nombre:K.nombre||K.usuarioNombre||"Caja",fechaApertura:Se,fechaCierre:Pe,baseInicial:Xe,baseActual:jt,saldoInicial:Ge,saldoActual:Zt,ia:dt}}const Oe=async O=>{var K;if((K=O==null?void 0:O.preventDefault)==null||K.call(O),!t){i("Debes iniciar sesin para abrir una caja.");return}f(!0);try{const Q=Number(h||0);await fn(Ie(ce,"cajas"),{estado:"abierta",usuarioId:t.uid,usuarioNombre:t.displayName||t.email||"Usuario",fechaApertura:er(),baseInicial:Q,baseActual:Q,saldoInicial:0,saldoActual:0,dia:Wo()}),m(""),r("mio"),i("")}catch(Q){console.error(Q),i("No se pudo abrir la caja.")}finally{f(!1)}},Fe=async O=>{try{await Pn(Ke(ce,"cajas",O),{estado:"cerrada",fechaCierre:er()}),r("cerradas")}catch(K){console.error(K),i("No se pudo cerrar la caja.")}},nt=async O=>{var Q;if((Q=O==null?void 0:O.preventDefault)==null||Q.call(O),!(M!=null&&M.id)){i("Debes abrir tu caja para registrar movimientos.");return}const K=Number(ie||0);if(!(!K||K<=0)){Ae(!0);try{await fn(Ie(ce,"movimientos"),{cashId:M.id,tipo:ke,concepto:It||(ke==="ingreso"?"Ingreso":"Egreso"),valor:K,fecha:er(),dia:Wo(),usuarioId:(t==null?void 0:t.uid)||null});const Se=ke==="ingreso"?K:-K;await Pn(Ke(ce,"cajas",M.id),{saldoActual:eb(Se)}),U(""),pe("")}catch(Se){console.error(Se),i("No se pudo registrar el movimiento.")}finally{Ae(!1)}}},G=async O=>{var Q;if((Q=O==null?void 0:O.preventDefault)==null||Q.call(O),!(M!=null&&M.id))return i("Abre tu caja para cobrar.");const K=Number(He||0);if(!(!K||K<=0)){if(!k)return i("Selecciona un paciente.");ve(!0);try{const Se=await fn(Ie(ce,"payments"),{cashId:M.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:K,medio:kt,estado:"aprobado",fecha:er(),dia:Wo()});await Pn(Ke(ce,"cajas",M.id),{saldoActual:eb(K)}),_t(""),re("efectivo"),i(`Pago registrado (${Se.id}).`)}catch(Se){console.error(Se),i("No se pudo registrar el pago.")}finally{ve(!1)}}},le=async O=>{var Q;if((Q=O==null?void 0:O.preventDefault)==null||Q.call(O),!(M!=null&&M.id))return i("Abre tu caja para cobrar.");const K=Number(He||0);if(!(!K||K<=0)){if(!k)return i("Selecciona un paciente.");ve(!0);try{const Pe=`https://pay.odontocloud/mock/${CU()}`,Xe=await fn(Ie(ce,"payments"),{cashId:M.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:K,medio:"link",estado:"pending",linkUrl:Pe,fecha:er(),dia:Wo()});i(`Link de pago generado: ${Pe}`),_t("")}catch(Se){console.error(Se),i("No se pudo generar link de pago.")}finally{ve(!1)}}},z=O=>(O||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),ae=S.useMemo(()=>{const O=z(o);return O?v.filter(K=>[K.nombre,K.usuarioNombre,Ur(K.saldoActual),Ur(K.baseActual)].map(z).some(Q=>Q.includes(O))):v},[o,v]),ue=()=>a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:a.jsx("h3",{children:"Abrir caja"})}),a.jsxs("form",{className:"oc-form",onSubmit:Oe,style:{display:"flex",gap:12,alignItems:"end",flexWrap:"wrap"},children:[a.jsxs("label",{style:{display:"inline-flex",flexDirection:"column",gap:6},children:[a.jsx("span",{children:"Base inicial (COP)"}),a.jsx("input",{type:"number",className:"oc-input",min:"0",step:"1000",value:h,onChange:O=>m(O.target.value),placeholder:"0"})]}),a.jsx("button",{className:"oc-btn",type:"submit",disabled:d,children:d?"Abriendo...":"Abrir caja"})]}),a.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Se asociar a tu usuario y quedar visible en ",a.jsx("b",{children:"Mi caja (hoy)"}),"."]})]}),we=()=>a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"card",style:{marginBottom:10},children:a.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("h3",{style:{margin:0},children:"Cajas Abiertas"}),a.jsx("span",{className:"oc-tag",children:ae.length}),s&&a.jsx("span",{className:"oc-tag oc-tag-danger",children:s})]}),a.jsx("input",{ref:c,className:"oc-input",style:{maxWidth:280},placeholder:"Buscar...",value:o,onChange:O=>l(O.target.value)})]})}),a.jsx("div",{className:"card",children:a.jsx("div",{className:"oc-table-wrap",children:a.jsxs("table",{className:"oc-table",children:[a.jsx("thead",{className:"oc-thead",children:a.jsxs("tr",{className:"oc-tr",children:[a.jsx(Qt,{children:"Caja"}),a.jsx(Qt,{children:"Fecha apertura"}),a.jsx(Qt,{align:"right",children:"Base actual"}),a.jsx(Qt,{align:"right",children:"Saldo inicial"}),a.jsx(Qt,{align:"right",children:"Saldo actual"}),a.jsx(Qt,{children:"Usuario"}),a.jsx(Qt,{children:"Acciones"})]})}),a.jsx("tbody",{className:"oc-tbody",children:N?a.jsx(Rb,{cols:7}):ae.length===0?a.jsx("tr",{className:"oc-tr",children:a.jsx("td",{className:"oc-td",colSpan:7,children:a.jsx("span",{className:"oc-muted",children:"Sin cajas abiertas."})})}):ae.map(O=>{var K;return a.jsxs("tr",{className:"oc-tr",children:[a.jsxs("td",{className:"oc-td",children:[a.jsx("b",{children:O.nombre})," ",(K=O.ia)!=null&&K.length?a.jsx("span",{className:"oc-tag oc-tag-danger",title:O.ia.join("  "),children:"IA"}):null]}),a.jsx("td",{className:"oc-td",children:O.fechaApertura?O.fechaApertura.toLocaleString("es-CO"):""}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(O.baseActual)]}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(O.saldoInicial)]}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right",color:O.saldoActual<0?"#b91c1c":void 0,fontWeight:600},children:["$",Ur(O.saldoActual)]}),a.jsx("td",{className:"oc-td",children:O.usuarioNombre}),a.jsxs("td",{className:"oc-td",style:{whiteSpace:"nowrap"},children:[a.jsx("button",{className:"oc-small-btn",onClick:()=>r("mio"),children:"Ver"})," ",a.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Fe(O.id),children:"Cerrar"})]})]},O.id)})})]})})})]}),xe=()=>a.jsxs("div",{className:"card",children:[a.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("h3",{children:"Mi caja (hoy)"}),(M==null?void 0:M.estado)==="abierta"&&a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("span",{className:"oc-tag oc-tag-success",children:"Abierta"}),a.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Fe(M.id),children:"Cerrar caja"})]})]}),b?a.jsx("div",{className:"oc-muted",children:"Cargando"}):M?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"oc-stats-row",style:{marginBottom:12},children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:"Base actual"}),a.jsxs("span",{className:"stat-value",children:["$",Ur(M.baseActual)]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:"Saldo actual"}),a.jsxs("span",{className:"stat-value",style:{color:M.saldoActual<0?"#b91c1c":void 0},children:["$",Ur(M.saldoActual)]})]})]}),a.jsxs("div",{className:"card",style:{marginBottom:12},children:[a.jsx("h4",{style:{marginBottom:8},children:"Cobro rpido"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:8},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsx("label",{className:"oc-muted",children:"Paciente"}),a.jsx("input",{className:"oc-input",placeholder:"Buscar nombre o documento",value:_,onChange:O=>P(O.target.value)}),_&&D.length>0&&a.jsx("div",{className:"oc-dropdown",children:D.slice(0,6).map(O=>a.jsx("button",{className:`oc-menu-item ${(k==null?void 0:k.id)===O.id?"active":""}`,onClick:()=>{Y(O),P(O.nombre||O.name||O.doc||"")},type:"button",children:(O.nombre||O.name||"Paciente")+(O.doc?`  ${O.doc}`:"")},O.id))})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsx("label",{className:"oc-muted",children:"Monto (COP)"}),a.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:He,onChange:O=>_t(O.target.value)})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsx("label",{className:"oc-muted",children:"Medio"}),a.jsxs("select",{className:"oc-input",value:kt,onChange:O=>re(O.target.value),children:[a.jsx("option",{value:"efectivo",children:"Efectivo"}),a.jsx("option",{value:"tarjeta",children:"Tarjeta"}),a.jsx("option",{value:"transferencia",children:"Transferencia"}),a.jsx("option",{value:"link",children:"Link (en lnea)"})]})]}),a.jsx("div",{style:{display:"flex",alignItems:"end",gap:6},children:kt==="link"?a.jsx("button",{className:"oc-btn",onClick:le,disabled:fe,children:fe?"Creando":"Generar link"}):a.jsx("button",{className:"oc-btn",onClick:G,disabled:fe,children:fe?"Guardando":"Registrar pago"})})]}),a.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Para link, el saldo se actualiza cuando el pago pase a ",a.jsx("b",{children:"aprobado"})," (webhook)."]})]}),a.jsxs("div",{className:"card",style:{marginBottom:12},children:[a.jsx("h4",{style:{marginBottom:8},children:"Movimiento manual"}),a.jsxs("form",{onSubmit:nt,style:{display:"grid",gridTemplateColumns:"120px 1fr 180px auto",gap:8},children:[a.jsxs("select",{className:"oc-input",value:ke,onChange:O=>We(O.target.value),children:[a.jsx("option",{value:"ingreso",children:"Ingreso"}),a.jsx("option",{value:"egreso",children:"Egreso"})]}),a.jsx("input",{className:"oc-input",placeholder:"Concepto (ej. Caja chica, Arriendo, etc.)",value:It,onChange:O=>U(O.target.value)}),a.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:ie,onChange:O=>pe(O.target.value)}),a.jsx("button",{className:"oc-btn",disabled:Ne,children:Ne?"Guardando":"Agregar"})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("h4",{style:{marginBottom:8},children:"Movimientos y pagos (hoy)"}),a.jsx("div",{className:"oc-table-wrap",style:{marginBottom:12},children:a.jsxs("table",{className:"oc-table",children:[a.jsx("thead",{className:"oc-thead",children:a.jsxs("tr",{className:"oc-tr",children:[a.jsx(Qt,{children:"Tipo"}),a.jsx(Qt,{children:"Concepto / Paciente"}),a.jsx(Qt,{children:"Medio"}),a.jsx(Qt,{children:"Estado"}),a.jsx(Qt,{align:"right",children:"Valor"}),a.jsx(Qt,{children:"Hora"})]})}),a.jsx("tbody",{className:"oc-tbody",children:De.length===0&&at.length===0?a.jsx("tr",{className:"oc-tr",children:a.jsx("td",{className:"oc-td",colSpan:6,children:a.jsx("span",{className:"oc-muted",children:"Sin movimientos ni pagos an."})})}):a.jsxs(a.Fragment,{children:[at.map(O=>{var K,Q;return a.jsxs("tr",{className:"oc-tr",children:[a.jsx("td",{className:"oc-td",children:"Pago"}),a.jsxs("td",{className:"oc-td",children:[O.patientName||"Paciente"," ",O.linkUrl?a.jsx("a",{href:O.linkUrl,target:"_blank",rel:"noreferrer",children:"(link)"}):null]}),a.jsx("td",{className:"oc-td",children:O.medio}),a.jsx("td",{className:"oc-td",children:a.jsx("span",{className:`oc-tag ${O.estado==="aprobado"?"oc-tag-success":O.estado==="pending"?"oc-tag-warning":"oc-tag-danger"}`,children:O.estado})}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(O.valor)]}),a.jsx("td",{className:"oc-td",children:(Q=(K=O.fecha)==null?void 0:K.toDate)!=null&&Q.call(K)?O.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`pay-${O.id}`)}),De.map(O=>{var K,Q;return a.jsxs("tr",{className:"oc-tr",children:[a.jsx("td",{className:"oc-td",children:O.tipo}),a.jsx("td",{className:"oc-td",children:O.concepto}),a.jsx("td",{className:"oc-td",children:""}),a.jsx("td",{className:"oc-td",children:a.jsx("span",{className:"oc-tag",children:(O.tipo==="ingreso","ok")})}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(O.valor)]}),a.jsx("td",{className:"oc-td",children:(Q=(K=O.fecha)==null?void 0:K.toDate)!=null&&Q.call(K)?O.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`mov-${O.id}`)})]})})]})}),a.jsx("p",{className:"oc-muted",children:"Sugerencia: crea ndice compuesto para `movimientos(cashId, dia, fecha)` y `payments(cashId, dia, fecha)` para rendimiento."})]})]}):a.jsxs("div",{className:"oc-empty",children:[a.jsx("p",{className:"oc-muted",children:"No tienes una caja abierta hoy."}),a.jsx("button",{className:"oc-btn",onClick:()=>r("abrir"),children:"Abrir caja"})]})]}),Me=()=>a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:a.jsxs("h3",{children:["Cajas cerradas ",a.jsx("span",{className:"oc-tag",children:y.length})]})}),a.jsx("div",{className:"oc-table-wrap",children:a.jsxs("table",{className:"oc-table",children:[a.jsx("thead",{className:"oc-thead",children:a.jsxs("tr",{className:"oc-tr",children:[a.jsx(Qt,{children:"Caja"}),a.jsx(Qt,{children:"Usuario"}),a.jsx(Qt,{children:"Apertura"}),a.jsx(Qt,{children:"Cierre"}),a.jsx(Qt,{align:"right",children:"Saldo final"})]})}),a.jsx("tbody",{className:"oc-tbody",children:E?a.jsx(Rb,{cols:5}):y.length===0?a.jsx("tr",{className:"oc-tr",children:a.jsx("td",{className:"oc-td",colSpan:5,children:a.jsx("span",{className:"oc-muted",children:"Sin cajas cerradas."})})}):y.map(O=>a.jsxs("tr",{className:"oc-tr",children:[a.jsx("td",{className:"oc-td",children:O.nombre}),a.jsx("td",{className:"oc-td",children:O.usuarioNombre}),a.jsx("td",{className:"oc-td",children:O.fechaApertura?O.fechaApertura.toLocaleString("es-CO"):""}),a.jsx("td",{className:"oc-td",children:O.fechaCierre?O.fechaCierre.toLocaleString("es-CO"):""}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(O.saldoActual)]})]},O.id))})]})})]}),L=()=>a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Cierres simulados"}),a.jsx("p",{className:"oc-muted",children:"El cierre hipottico compara ventas y movimientos detectando errores y descuadres con IA. (Conectar fuente de datos para activarlo)."})]}),W=()=>a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Bancos"}),a.jsx("p",{className:"oc-muted",children:"Conciliacin de consignaciones/pagos electrnicos contra caja del da. (Conectar pasarela o extractos para habilitar)."})]}),X=({m:O})=>a.jsxs("button",{type:"button",onClick:()=>r(O.key),className:`oc-menu-item ${n===O.key?"active":""}`,style:{width:"100%",textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid transparent",background:n===O.key?"var(--oc-surface-2, #f3f6ff)":"transparent",fontWeight:600},title:O.label,children:[a.jsx("span",{style:{opacity:.8,marginRight:6},children:O.icon}),O.label]});return a.jsxs("div",{className:"oc-main-content",style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:16},children:[a.jsx("aside",{className:"card",role:"navigation","aria-label":"Men de caja",style:{height:"fit-content",padding:12},children:a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:e.map(O=>a.jsx(X,{m:O},O.key))})}),a.jsxs("section",{children:[a.jsx("div",{className:"card",style:{marginBottom:12,padding:12},children:a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[a.jsxs("div",{className:"oc-breadcrumb",children:[a.jsx("span",{children:"Caja"}),a.jsx("span",{children:""}),a.jsx("b",{children:(ne=e.find(O=>O.key===n))==null?void 0:ne.label})]}),n==="abiertas"&&a.jsx("input",{ref:c,className:"oc-input",placeholder:"Buscar...",value:o,onChange:O=>l(O.target.value),style:{maxWidth:300}})]})}),n==="abrir"&&a.jsx(ue,{}),n==="abiertas"&&a.jsx(we,{}),n==="cerradas"&&a.jsx(Me,{}),n==="mio"&&a.jsx(xe,{}),n==="simulados"&&a.jsx(L,{}),n==="bancos"&&a.jsx(W,{})]})]})}function Rb({cols:t=6,n:e=3}){return a.jsx(a.Fragment,{children:Array.from({length:e}).map((n,r)=>a.jsx("tr",{className:"oc-tr",children:Array.from({length:t}).map((s,i)=>a.jsx("td",{className:"oc-td",children:a.jsx("div",{style:{height:12,width:i===0?160:100+i%3*40,background:"var(--oc-skeleton, #e5e7eb)",borderRadius:6}})},i))},r))})}function AU({items:t=[]}){return a.jsxs("div",{className:"card activity-card",children:[a.jsx("h4",{children:"Actividad reciente"}),a.jsx("ul",{className:"activity-list",children:t.map(e=>a.jsxs("li",{children:[a.jsx("strong",{children:e.title}),a.jsx("div",{className:"time",children:e.time})]},e.id))})]})}function RU({status:t}){return t?a.jsxs("div",{className:"card",children:[a.jsx("h4",{children:"Automatizaciones (N8N)"}),a.jsxs("div",{className:"n8n-line",children:[a.jsx("strong",{children:"Conectado:"})," ",t.connected?"S":"No"]}),a.jsxs("div",{className:"n8n-line",children:[a.jsx("strong",{children:"Flujos activos:"})," ",t.flowsRunning]}),t.lastError&&a.jsxs("div",{className:"n8n-error",children:["Error: ",t.lastError]})]}):null}const Kp={es:{nav_home:"Inicio",nav_agenda:"Agenda",nav_patients:"Pacientes",nav_billing:"Facturacin",nav_inventory:"Inventario",nav_odontogram:"Odontograma",nav_reports:"Reportes",nav_cash:"Caja",nav_admin:"Administracin",welcomeTitle:"Bienvenido a OdontoCloud",welcomeSubtitle:"Administra tus pacientes, agenda, inventario y facturacin de manera inteligente y moderna.",clinicLabel:"Clnica",userLabel:"Usuario",roleLabel:"Rol",searchPlaceholder:"Buscar acciones o ir a",stats_patientsToday:"Pacientes totales",stats_appointmentsToday:"Citas hoy",stats_revenueToday:"Facturacin hoy",stats_waiting:"En espera",stats_currency:"COP",n8n_title:"Automatizaciones (n8n)",recent_title:"Actividad reciente",recent_empty:"Sin actividad registrada.",loading:"Cargando...",logout:"Cerrar sesin",module_coming:"Mdulo prximamente.",todays_appts:"Citas de hoy",see_schedule:"Ir a Agenda",no_appts_today:"No hay citas programadas hoy.",at:"a las"},en:{nav_home:"Overview",nav_agenda:"Schedule",nav_patients:"Patients",nav_billing:"Billing",nav_inventory:"Inventory",nav_odontogram:"Odontogram",nav_reports:"Reports",nav_cash:"Cash",nav_admin:"Administration",welcomeTitle:"Welcome to OdontoCloud",welcomeSubtitle:"Manage your patients, schedule, inventory and billing in a smart and modern way.",clinicLabel:"Clinic",userLabel:"User",roleLabel:"Role",searchPlaceholder:"Search actions or go to",stats_patientsToday:"Total patients",stats_appointmentsToday:"Appointments today",stats_revenueToday:"Revenue today",stats_waiting:"In waiting room",stats_currency:"COP",n8n_title:"Automations (n8n)",recent_title:"Recent activity",recent_empty:"No activity yet.",loading:"Loading...",logout:"Log out",module_coming:"Module coming soon.",todays_appts:"Today's appointments",see_schedule:"Open Schedule",no_appts_today:"No appointments today.",at:"at"}},a1=()=>typeof navigator>"u"||(navigator.language||navigator.userLanguage||"es").toLowerCase().startsWith("es")?"es":"en",PU=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},kU=()=>S.useMemo(()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0);return{startToday:qe.fromDate(e),endToday:qe.fromDate(n),startTodayJS:e}},[]),jU=t=>`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,DU=(t,e)=>t.toLocaleTimeString(e==="es"?"es-CO":"en-US",{hour:"2-digit",minute:"2-digit"}),OU=(t,e)=>{try{const[n,r,s]=(t||"").split("-").map(l=>parseInt(l,10)),[i=0,o=0]=(e||"00:00").split(":").map(l=>parseInt(l,10));return new Date(n,(r||1)-1,s||1,i,o,0,0)}catch{return new Date}};function LU({data:t=[]}){const s=Math.max(1,...t.map(d=>Number(d.value)||0)),i=t.length||7,o=10,l=Math.max(16,Math.min(44,(640-o*(i+1))/i)),c=(l+o)*i+o;return a.jsx("div",{style:{width:"100%",overflowX:"auto"},children:a.jsxs("svg",{width:c,height:240,role:"img","aria-label":"Pacientes registrados por da en la ltima semana",children:[[.25,.5,.75,1].map((d,f)=>{const h=18+(1-d)*182;return a.jsx("line",{x1:0,x2:c,y1:h,y2:h,stroke:"#e5e7eb",strokeDasharray:"4 4"},f)}),t.map((d,f)=>{const h=Number(d.value)||0,m=Math.round(h/s*182),v=o+f*(l+o),R=200-m;return a.jsxs("g",{children:[a.jsx("rect",{x:v,y:R,width:l,height:m,rx:"6",ry:"6",fill:h>0?"#0ea5e9":"#cbd5e1",children:a.jsx("title",{children:`${d.label||d.shortLabel||""}  ${h} paciente${h!==1?"s":""}`})}),h>0&&m>14&&a.jsx("text",{x:v+l/2,y:R-6,textAnchor:"middle",fontSize:"11",fill:"#0f172a",children:h}),a.jsx("text",{x:v+l/2,y:214,textAnchor:"middle",fontSize:"11",fill:"#64748b",children:d.shortLabel||""})]},f)})]})})}function VU({onNavigate:t,onAction:e,placeholder:n}){const[r,s]=S.useState(""),[i,o]=S.useState(!1),[l,c]=S.useState(0),d=S.useRef(null),f=S.useMemo(()=>[{group:"Navegacin",label:"Ir a Inicio",keywords:"inicio home overview",run:()=>t==null?void 0:t("Inicio")},{group:"Navegacin",label:"Ir a Agenda",keywords:"agenda calendario schedule",run:()=>t==null?void 0:t("Agenda")},{group:"Navegacin",label:"Ir a Pacientes",keywords:"pacientes",run:()=>t==null?void 0:t("Pacientes")},{group:"Navegacin",label:"Ir a Facturacin",keywords:"facturacion facturas billing",run:()=>t==null?void 0:t("Facturacin")},{group:"Navegacin",label:"Ir a Inventario",keywords:"inventario stock",run:()=>t==null?void 0:t("Inventario")},{group:"Navegacin",label:"Ir a Odontograma",keywords:"odontograma",run:()=>t==null?void 0:t("Odontograma")},{group:"Navegacin",label:"Ir a Reportes",keywords:"reportes informes",run:()=>t==null?void 0:t("Reportes")},{group:"Acciones",label:"Nueva cita",keywords:"nueva cita agendar",run:()=>e==null?void 0:e("new_appointment")},{group:"Acciones",label:"Nuevo paciente",keywords:"nuevo paciente alta",run:()=>e==null?void 0:e("new_patient")},{group:"Acciones",label:"Nueva factura",keywords:"nueva factura",run:()=>e==null?void 0:e("new_invoice")},{group:"Acciones",label:"Exportar agenda",keywords:"exportar agenda",run:()=>e==null?void 0:e("export_agenda")},{group:"Acciones",label:"Ir a hoy (Agenda)",keywords:"hoy today",run:()=>e==null?void 0:e("agenda_today")},{group:"Acciones",label:"Cambiar modo oscuro",keywords:"oscuro dark mode",run:()=>e==null?void 0:e("toggle_dark")},{group:"Acciones",label:"Cerrar sesin",keywords:"logout salir cerrar",run:()=>e==null?void 0:e("logout")},{group:"Ayuda",label:"Ver atajos de teclado",keywords:"atajos ayuda",run:()=>e==null?void 0:e("show_shortcuts")},{group:"Ayuda",label:"Soporte / Contacto",keywords:"soporte ayuda contacto",run:()=>e==null?void 0:e("support")}],[t,e]),h=S.useMemo(()=>{const N=r.toLowerCase().trim();return N?f.filter(C=>C.label.toLowerCase().includes(N)||C.keywords.includes(N)):[]},[r,f]);S.useEffect(()=>{const N=C=>{d.current&&(d.current.contains(C.target)||o(!1))};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[]);const m=N=>{var C;(C=N.run)==null||C.call(N),s(""),o(!1)},v=N=>{!i||h.length===0||(N.key==="ArrowDown"&&(N.preventDefault(),c(C=>(C+1)%h.length)),N.key==="ArrowUp"&&(N.preventDefault(),c(C=>(C-1+h.length)%h.length)),N.key==="Enter"&&(N.preventDefault(),h[l]&&m(h[l])),N.key==="Escape"&&o(!1))},R=S.useMemo(()=>{const N=new Map;return h.forEach(C=>{N.has(C.group)||N.set(C.group,[]),N.get(C.group).push(C)}),Array.from(N.entries())},[h]);return a.jsxs("div",{className:"oc-search-wrap",ref:d,children:[a.jsx("input",{className:"oc-search",type:"search",inputMode:"search",placeholder:n,"aria-label":n,value:r,onChange:N=>{s(N.target.value),o(!!N.target.value),c(0)},onFocus:()=>o(!!r),onKeyDown:v}),i&&a.jsx("div",{className:"oc-search-dropdown",role:"listbox","aria-label":"Resultados de comandos",children:R.length===0?a.jsx("div",{className:"oc-search-item empty",children:"Escribe para ver opciones"}):R.map(([N,C])=>a.jsxs("div",{children:[a.jsx("div",{className:"oc-search-group",children:N}),C.map(y=>{const w=h.indexOf(y);return a.jsx("button",{className:`oc-search-item ${w===l?"active":""}`,onMouseEnter:()=>c(w),onClick:()=>m(y),role:"option",children:a.jsx("span",{className:"oc-search-title",children:y.label})},y.label)})]},N))})]})}function MU({open:t,anchorRect:e,onClose:n,onSoon:r,onNavigatePath:s,onSetFactView:i,dark:o}){const[l,c]=S.useState(null),d=S.useRef(null);if(S.useEffect(()=>{if(!t)return;const Y=_t=>_t.key==="Escape"&&(n==null?void 0:n()),He=()=>n==null?void 0:n();return window.addEventListener("keydown",Y),window.addEventListener("scroll",He,!0),()=>{window.removeEventListener("keydown",Y),window.removeEventListener("scroll",He,!0)}},[t,n]),!t)return null;const f=((e==null?void 0:e.bottom)||60)+8,h=Math.max(12,Math.min(((e==null?void 0:e.left)||300)-160,window.innerWidth-920)),m=10,v=h+360+m,R=o?"#0b1220":"#ffffff",N=o?"#e5e7eb":"#0f172a",C=o?"#0f1a32":"#f3f6ff",y=o?"#1f2a44":"#e2e8f0",w=o?"#b6c1d1":"#475569",E={position:"fixed",top:f,left:h,width:880,maxWidth:"calc(100vw - 24px)",background:R,color:N,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${y}`,zIndex:400,padding:12},I={position:"fixed",top:f,left:v,width:420,maxWidth:"calc(100vw - 24px)",background:R,color:N,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${y}`,zIndex:410,padding:12},M={display:"flex",flexDirection:"column",gap:6,padding:"8px 10px"},$={height:38,borderRadius:10,padding:"0 12px",display:"flex",alignItems:"center",gap:8,fontSize:".92rem",cursor:"pointer",border:"1px solid transparent",background:"transparent",color:N,fontWeight:500,textAlign:"left"},b=(Y,He=!0)=>Object.assign(Y.currentTarget.style,He?{background:C,borderColor:y}:{background:"transparent",borderColor:"transparent"}),x=()=>{d.current&&clearTimeout(d.current)},_=()=>{x(),d.current=setTimeout(()=>n==null?void 0:n(),180)},P={position:"fixed",top:f,left:h+360,width:m,height:520,zIndex:405},D=[{label:"Recibo de caja",key:"recibo",path:"facturacion/recibo"},{label:"Saldo a favor",key:"saldo",path:"facturacion/saldo"},{label:"Nota crdito",key:"nc",path:"facturacion/nc"},{label:"Nota dbito",key:"nd",path:"facturacion/nd"},{label:"Liquidaciones",key:"liq",path:"facturacion/liq"},{label:"Traslados",key:"tras",path:"facturacion/tras"},{label:"Pagos",key:"pagos",path:"facturacion/pagos"},{label:"rdenes de compra",key:"oc",path:"facturacion/oc"},{label:"Factura de venta",key:"fv",path:"facturacion/facturas"},{label:"Facturas de compra",key:"fc",path:"facturacion/fc"}],j=[{label:"RIPS anteriores (RS-3374)",key:"rips3374"},{label:"RIPS nuevo (RS-2275)",key:"rips2275"}],k=Y=>{i==null||i(Y.key),s==null||s(Y.path),n==null||n()};return a.jsxs(a.Fragment,{children:[a.jsx("div",{onClick:n,style:{position:"fixed",inset:0,background:"transparent",zIndex:399}}),a.jsx("div",{style:E,onMouseEnter:x,onMouseLeave:_,children:a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"360px 1fr",gap:8,alignItems:"start"},children:[a.jsxs("div",{style:M,children:[a.jsx("button",{type:"button",style:$,onMouseEnter:()=>{x(),c("facturacion")},onFocus:()=>{x(),c("facturacion")},onClick:()=>c(Y=>Y==="facturacion"?null:"facturacion"),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Facturacin "}),a.jsx("button",{type:"button",style:$,onMouseEnter:()=>{x(),c("rips")},onFocus:()=>{x(),c("rips")},onClick:()=>c(Y=>Y==="rips"?null:"rips"),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" RIPS "}),a.jsx("button",{type:"button",style:$,onClick:()=>s==null?void 0:s("agenda"),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Gestin de agenda"}),a.jsx("button",{type:"button",style:$,onClick:()=>s==null?void 0:s("inventario"),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Inventario"}),a.jsx("button",{type:"button",style:$,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Convenios"}),a.jsx("button",{type:"button",style:$,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Terceros"}),a.jsx("button",{type:"button",style:$,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Campaas"}),a.jsx("button",{type:"button",style:$,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Temperatura y humedad"}),a.jsx("button",{type:"button",style:$,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Residuos"}),a.jsx("button",{type:"button",style:$,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Medicamentos y planes"}),a.jsx("button",{type:"button",style:$,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Esterilizacin"})]}),a.jsx("div",{style:M,children:a.jsxs("div",{style:{fontSize:".85rem",color:w},children:["Accesos rpidos a mdulos de administracin. Pasa el mouse por ",a.jsx("b",{children:"Facturacin"})," o ",a.jsx("b",{children:"RIPS"})," para ver sus acciones."]})})]})}),a.jsx("div",{style:P,onMouseEnter:x,onMouseLeave:_}),l&&a.jsx("div",{style:I,onMouseEnter:x,onMouseLeave:_,children:a.jsx("div",{style:{...M,display:"grid",gridTemplateColumns:"1fr"},children:(l==="facturacion"?D:j).map(Y=>a.jsx("button",{type:"button",style:$,onClick:()=>l==="facturacion"?k(Y):r==null?void 0:r(),onMouseOver:He=>b(He,!0),onMouseOut:He=>b(He,!1),children:Y.label},Y.label))})})]})}function FU({t,companyName:e,userName:n,role:r,darkMode:s,weeklySeries:i,weekRangeLabel:o,todaysAppointments:l,todaysLoading:c,metrics:d,metricsLoading:f,n8nState:h,n8nLoading:m,recent:v,recentLoading:R,onGoAgenda:N}){return a.jsxs("div",{className:"oc-main-content",children:[a.jsxs("section",{className:"oc-hero","aria-label":"Resumen general",children:[a.jsxs("div",{className:"oc-hero-text",children:[a.jsx("h1",{children:t("welcomeTitle")}),a.jsx("p",{children:t("welcomeSubtitle")}),a.jsxs("p",{className:"oc-hero-meta",children:[t("clinicLabel"),": ",e,"  ",t("userLabel"),": ",n,"  ",t("roleLabel"),": ",r||""]})]}),a.jsxs("div",{className:"oc-hero-badge","aria-live":"polite",children:[a.jsx("span",{className:"oc-hero-badge-title",children:t("stats_appointmentsToday")}),a.jsx("span",{className:"oc-hero-badge-value",children:f&&c?"":d.citasHoy}),a.jsxs("span",{className:"oc-hero-badge-sub",children:[t("stats_patientsToday"),": ",f?"":d.pacientesHoy]})]})]}),a.jsxs("section",{className:"oc-stats-row","aria-label":"Indicadores del da",children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:t("stats_patientsToday")}),a.jsx("span",{className:"stat-value",children:d.pacientesHoy})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:t("stats_appointmentsToday")}),a.jsx("span",{className:"stat-value",children:d.citasHoy})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:t("stats_revenueToday")}),a.jsxs("span",{className:"stat-value",children:[d.facturacionHoy.toLocaleString("es-CO")," ",a.jsx("span",{className:"stat-currency",children:t("stats_currency")})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:t("stats_waiting")}),a.jsx("span",{className:"stat-value",children:d.enEspera})]})]}),a.jsxs("section",{className:"oc-grid","aria-label":"Contenido principal del dashboard",children:[a.jsx("div",{className:"oc-grid-main",children:a.jsxs("div",{className:"card card-quickcharts",children:[a.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[a.jsx("h3",{children:"Pacientes registrados  ltimos 7 das"}),a.jsx("span",{className:"oc-muted",style:{marginLeft:8,fontSize:12},children:o})]}),i.length===0||i.every(C=>((C==null?void 0:C.value)||0)===0)?a.jsx("p",{className:"oc-weekly-empty",children:"Sin pacientes registrados en la ltima semana."}):a.jsx(LU,{data:i})]})}),a.jsxs("aside",{className:"oc-grid-side","aria-label":"Panel lateral",children:[a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:t("n8n_title")}),m?a.jsx("span",{className:"oc-muted",children:t("loading")}):a.jsx(RU,{status:h})]}),a.jsxs("div",{className:"card",children:[a.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[a.jsx("h3",{children:t("todays_appts")}),a.jsx("button",{className:"oc-small-link",type:"button",onClick:N,children:t("see_schedule")})]}),c?a.jsx("span",{className:"oc-muted",children:t("loading")}):l.length===0?a.jsx("p",{className:"oc-muted",children:t("no_appts_today")}):a.jsx("ul",{className:"oc-list",children:l.slice(0,5).map(C=>a.jsxs("li",{className:"oc-list-item",children:[a.jsxs("div",{className:"oc-list-main",children:[a.jsx("b",{children:C.pacienteNombre||"Paciente"})," ",a.jsxs("span",{className:"oc-muted",children:[t("at")," ",DU(C.fecha,a1())]})]}),a.jsx("div",{className:`oc-tag oc-tag-${(C.estado||"programada").toLowerCase().replace(/\s+/g,"-")}`,children:C.estado||"programada"})]},C.id))})]}),a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Actividad reciente"}),R?a.jsx("span",{className:"oc-muted",children:t("loading")}):v.length===0?a.jsx("p",{className:"oc-muted",children:t("recent_empty")}):a.jsx(AU,{items:v})]})]})]}),a.jsxs("footer",{className:"oc-footer",children:[" ",new Date().getFullYear()," OdontoCloud | Creado por Ingeniero Juan Madrid"]})]})}function Qp(){const t=kr(),e=yn(),[n]=S.useState(a1()),r=G=>Kp[n][G]||G,[s,i]=S.useState("Inicio"),[o,l]=S.useState("recibo"),[c,d]=S.useState(()=>{try{return localStorage.getItem("odontocloud:dark")==="1"}catch{return!1}});S.useEffect(()=>{try{localStorage.setItem("odontocloud:dark",c?"1":"0")}catch{}document.documentElement.classList.toggle("dark",c)},[c]);const[f]=S.useState(()=>PU()),[h]=S.useState((f==null?void 0:f.rol)||""),[m]=S.useState((f==null?void 0:f.email)||""),[v,R]=S.useState("OdontoCloud"),[N,C]=S.useState(m||"Usuario"),[y,w]=S.useState(!0);S.useEffect(()=>{const G=Uy(Rh,async le=>{try{if(!le){C(m||"Usuario"),R("OdontoCloud"),w(!1);return}C(le.displayName||le.email||m||"Usuario");const z=Ke(ce,"empresas",le.uid),ae=await Bc(z);R(ae.exists()&&ae.data().nombre||"OdontoCloud")}catch(z){console.error("Error cargando empresa/usuario:",z)}finally{w(!1)}});return()=>G()},[m]);const[E,I]=S.useState({pacientesHoy:0,citasHoy:0,facturacionHoy:0,enEspera:0}),[M,$]=S.useState(!0),[b,x]=S.useState([]),[_,P]=S.useState([]),[D,j]=S.useState(!0),{startToday:k,endToday:Y,startTodayJS:He}=kU(),_t=S.useMemo(()=>jU(He),[He]),kt=S.useMemo(()=>{const G=new Date,le=new Date(G.getFullYear(),G.getMonth(),G.getDate()-6),z=G,ae=ue=>ue.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit",month:"short"}).replace(".","");return`${ae(le)}  ${ae(z)}`},[n]),re=G=>{var we;const le=G.data()||{};let z;if((we=le.fecha)!=null&&we.toDate){z=le.fecha.toDate();const xe=le.horaInicio||le.hora;if(xe&&typeof xe=="string"){const[Me=0,L=0]=xe.split(":").map(W=>parseInt(W,10));z.setHours(Me||0,L||0,0,0)}}else if(typeof le.fecha=="string"){const xe=le.horaInicio||le.hora||"00:00";z=OU(le.fecha,xe)}else z=new Date;const ae=le.pacienteNombre||le.paciente||"Paciente",ue=le.estado&&String(le.estado)||"programada";return{id:G.id,fecha:z,pacienteId:le.pacienteId||"",pacienteNombre:ae,estado:ue,motivo:le.motivo||""}};S.useEffect(()=>{const G=ct(Ie(ce,"citas"),rt("fecha",">=",k),rt("fecha","<",Y),xn("fecha","asc")),le=ct(Ie(ce,"citas"),rt("fecha","==",_t));let z=new Map,ae=!1,ue=!1;const we=()=>{const L=Array.from(z.values()).sort((X,ne)=>X.fecha.getTime()-ne.fecha.getTime()),W=L.filter(X=>String(X.estado).toLowerCase().trim()==="en espera").length;P(L),I(X=>({...X,citasHoy:L.length,enEspera:W})),ae&&ue&&j(!1)},xe=zn(G,L=>{ae=!0;const W=new Map(z);L.docs.forEach(X=>W.set(X.id,re(X))),z=W,we()},L=>{console.error("Realtime citas hoy (TS):",L),ae=!0,we()}),Me=zn(le,L=>{ue=!0;const W=new Map(z);L.docs.forEach(X=>W.set(X.id,re(X))),z=W,we()},L=>{console.error("Realtime citas hoy (STR):",L),ue=!0,we()});return()=>{try{xe(),Me()}catch{}}},[k,Y,_t]),S.useEffect(()=>{(async()=>{try{const z=(await XM(Ie(ce,"pacientes"))).data().count||0;let ae=0;try{const ue=ct(Ie(ce,"facturas"),rt("fecha",">=",k),rt("fecha","<",Y));(await et(ue)).forEach(xe=>{const Me=xe.data();typeof Me.monto=="number"&&(ae+=Me.monto)})}catch{ae=0}I(ue=>({...ue,pacientesHoy:z,facturacionHoy:ae}))}catch(le){console.error("Error cargando mtricas:",le),I(z=>({...z,pacientesHoy:0,facturacionHoy:0}))}finally{$(!1)}})()},[k,Y]),S.useEffect(()=>{const G=new Date,le=new Date(G.getFullYear(),G.getMonth(),G.getDate()-6),z=new Date(G.getFullYear(),G.getMonth(),G.getDate()+1),ae=new Map;for(let xe=0;xe<7;xe++){const Me=new Date(G.getFullYear(),G.getMonth(),G.getDate()-(6-xe)),L=Me.toISOString().slice(0,10),W=Me.toLocaleDateString(n==="es"?"es-ES":"en-US"),X=Me.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit"}).replace(".","");ae.set(L,{label:W,shortLabel:X,value:0})}const ue=ct(Ie(ce,"pacientes"),rt("createdAt",">=",qe.fromDate(le)),rt("createdAt","<",qe.fromDate(z))),we=zn(ue,xe=>{const Me=new Map(ae);xe.docs.forEach(L=>{var K;const W=L.data()||{},X=(K=L.data().createdAt)!=null&&K.toDate?L.data().createdAt.toDate():W.createdAt?new Date(W.createdAt):null;if(!X||isNaN(X))return;const ne=X.toISOString().slice(0,10);if(!Me.has(ne))return;const O=Me.get(ne);O.value+=1,Me.set(ne,O)}),x(Array.from(Me.values()))},xe=>{console.error("Error realtime serie semanal (pacientes):",xe),x(Array.from(ae.values()))});return()=>{try{we()}catch{}}},[n]);const[fe,ve]=S.useState([]),[ke,We]=S.useState(!0);S.useEffect(()=>{(async()=>{try{const le=ct(Ie(ce,"actividad"),xn("fecha","desc"),ba(5)),z=await et(le);ve(z.docs.map(ae=>({id:ae.id,title:ae.data().descripcion||ae.data().titulo||"Actividad",time:ae.data().resumenTiempo||""})))}catch(le){console.error("Error cargando actividad:",le),ve([])}finally{We(!1)}})()},[]);const[It,U]=S.useState(null),[ie,pe]=S.useState(!0);S.useEffect(()=>{(async()=>{try{const le=Ke(ce,"integraciones","n8n"),z=await Bc(le);U(z.exists()?{connected:!!z.data().connected,flowsRunning:z.data().flowsRunning||0,lastError:z.data().lastError||null}:{connected:!1,flowsRunning:0,lastError:null})}catch(le){console.error("Error cargando estado n8n:",le),U({connected:!1,flowsRunning:0,lastError:"No se pudo leer el estado desde Firebase."})}finally{pe(!1)}})()},[]);const Ne=async()=>{try{localStorage.removeItem("odc_session")}catch{}try{await r2(Rh)}catch(G){console.error("Error al cerrar sesin:",G)}window.location.href="/"},[Ae,De]=S.useState(!1),[be,at]=S.useState(null),je=S.useRef(null);S.useRef(null);const me=()=>{var le,z;const G=(z=(le=je.current)==null?void 0:le.getBoundingClientRect)==null?void 0:z.call(le);at(G),De(!0)};S.useEffect(()=>{const G=e.pathname.toLowerCase(),le=G.includes("/pacientes"),z=G.includes("/caja"),ae=G.includes("/agenda"),ue=G.includes("/facturacion"),we=G.includes("/inventario"),xe=G.includes("/odontograma"),Me=G.includes("/reportes"),L=G.includes("/config");i(le?"Pacientes":z?"Caja":ae?"Agenda":we?"Inventario":xe?"Odontograma":Me?"Reportes":L?"Config":"Inicio"),ue&&(i("Facturacin"),G.includes("/pagos")?l("pagos"):G.includes("/facturas")?l("fv"):G.includes("/recibo")?l("recibo"):G.includes("/saldo")?l("saldo"):G.includes("/nc")?l("nc"):G.includes("/nd")?l("nd"):G.includes("/liq")?l("liq"):G.includes("/tras")?l("tras"):G.includes("/oc")?l("oc"):G.includes("/fc")?l("fc"):l("recibo"))},[e.pathname]);const Oe=S.useMemo(()=>{const G=e.pathname.split("/").filter(Boolean),le=G.findIndex(z=>z.startsWith("dashboard_"));return le>=0?`/${G.slice(0,le+1).join("/")}`:""},[e.pathname]),Fe=(G="")=>{const le=String(G).replace(/^\/+|\/+$/g,""),z=le?`${Oe}/${le}`:Oe||"/",ae=e.pathname.toLowerCase()===z.toLowerCase();t(z,{replace:ae})},nt=()=>{switch(s){case"Agenda":return a.jsx(q6,{});case"Pacientes":return a.jsx(S.Suspense,{fallback:a.jsx("div",{style:{padding:16},children:"Cargando"}),children:a.jsx(tU,{})});case"Facturacin":return a.jsx(H6,{view:o});case"Inventario":return a.jsx(W6,{});case"Odontograma":return a.jsx(G6,{});case"Reportes":return a.jsx(sU,{});case"Caja":return a.jsx(NU,{});case"Config":case"Configuracin":case"Configuracion":return a.jsx(bU,{});case"Inicio":default:return null}};return a.jsxs("div",{className:`oc-shell ${c?"oc-dark":""}`,children:[a.jsx("a",{href:"#oc-main",className:"oc-skip-link",children:"Saltar al contenido"}),a.jsxs("header",{className:"oc-header",role:"banner",children:[a.jsxs("div",{className:"oc-header-left",children:[a.jsx("img",{src:VN,alt:"OdontoCloud",className:"oc-logo"}),a.jsxs("div",{className:"oc-brand-text",children:[a.jsx("span",{className:"oc-brand-main",children:"OdontoCloud"}),a.jsx("span",{className:"oc-brand-sub",children:y?"...":v})]})]}),a.jsxs("nav",{className:"oc-nav",role:"navigation","aria-label":"Navegacin principal",children:[a.jsx(Ko,{to:Oe,end:!0,className:({isActive:G})=>G&&s==="Inicio"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_home"),children:r("nav_home")}),a.jsx(Ko,{to:`${Oe}/agenda`,className:({isActive:G})=>G||s==="Agenda"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_agenda"),children:r("nav_agenda")}),a.jsx(Ko,{to:`${Oe}/pacientes`,className:({isActive:G})=>G||s==="Pacientes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_patients"),children:r("nav_patients")}),a.jsx(Ko,{to:`${Oe}/caja`,className:({isActive:G})=>G||s==="Caja"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_cash"),children:r("nav_cash")}),a.jsx("button",{type:"button",ref:je,className:"oc-nav-btn",title:r("nav_admin"),"aria-haspopup":"true","aria-expanded":Ae,onClick:()=>Ae?De(!1):me(),children:r("nav_admin")}),a.jsx(Ko,{to:`${Oe}/reportes`,className:({isActive:G})=>G||s==="Reportes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_reports"),children:r("nav_reports")})]}),a.jsxs("div",{className:"oc-header-right",children:[a.jsx(VU,{placeholder:r("searchPlaceholder"),onNavigate:G=>{G==="Inicio"?Fe(""):G==="Facturacin"?(l("recibo"),Fe("facturacion/recibo")):Fe(G.toLowerCase())},onAction:G=>{switch(G){case"new_appointment":case"agenda_today":case"export_agenda":Fe("agenda");break;case"new_patient":Fe("pacientes");break;case"new_invoice":l("fv"),Fe("facturacion/facturas");break;case"toggle_dark":d(le=>!le);break;case"logout":Ne();break;case"show_shortcuts":alert("Atajos: Ctrl/Cmd + K para abrir bsqueda, / para moverse, Enter para ejecutar.");break;case"support":window.open("https://tu-soporte.odc","_blank");break}}}),a.jsx(iU,{basePath:Oe,className:"ml-2"}),a.jsx("button",{className:"oc-icon-btn",type:"button",onClick:()=>d(G=>!G),"aria-pressed":c,title:c?"Activar modo claro":"Activar modo oscuro",children:c?"":""}),a.jsx("button",{className:"oc-icon-btn",type:"button",onClick:Ne,title:Kp[n].logout,children:Kp[n].logout})]})]}),a.jsx(MU,{open:Ae,anchorRect:be,dark:c,onClose:()=>De(!1),onSoon:()=>{alert("Prximamente"),De(!1)},onNavigatePath:G=>{Fe(G),De(!1)},onSetFactView:G=>l(G)}),a.jsxs("main",{id:"oc-main",className:"oc-main-wrapper",role:"main",children:[s!=="Inicio"&&nt(),s==="Inicio"&&a.jsx(FU,{t:r,companyName:v,userName:N,role:h,darkMode:c,weeklySeries:b,weekRangeLabel:kt,todaysAppointments:_,todaysLoading:D,metrics:E,metricsLoading:M,n8nState:It,n8nLoading:ie,recent:fe,recentLoading:ke,onGoAgenda:()=>Fe("agenda")})]})]})}const l1=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},c1=t=>{const e=(t||"").toLowerCase();return e==="administrador"?"/dashboard_admin":e==="doctor"?"/dashboard_doctor":e==="recepcionista"?"/dashboard_recepcion":"/"};function Yp({allowedRoles:t,children:e}){var s;const n=l1();if(!n)return a.jsx(th,{to:"/",replace:!0});const r=(s=n.rol)==null?void 0:s.toLowerCase();return t.map(i=>i.toLowerCase()).includes(r)?e:a.jsx(th,{to:c1(n.rol),replace:!0})}function UU(){const t=l1();return a.jsxs(zP,{children:[a.jsx(Go,{path:"/",element:t?a.jsx(th,{to:c1(t.rol),replace:!0}):a.jsx(_4,{})}),a.jsx(Go,{path:"/dashboard_admin/*",element:a.jsx(Yp,{allowedRoles:["administrador"],children:a.jsx(Qp,{})})}),a.jsx(Go,{path:"/dashboard_doctor/*",element:a.jsx(Yp,{allowedRoles:["doctor"],children:a.jsx(Qp,{})})}),a.jsx(Go,{path:"/dashboard_recepcion/*",element:a.jsx(Yp,{allowedRoles:["recepcionista"],children:a.jsx(Qp,{})})}),a.jsx(Go,{path:"*",element:a.jsx(th,{to:"/",replace:!0})})]})}async function $U(){try{await e2(Rh,ZT),await OM(ce),console.log(" Firebase listo con sesin persistente y modo offline.")}catch(t){console.warn(" Firebase offline/persistencia fall:",t.message)}}const BU="modulepreload",zU=function(t){return"/odontocloud-react/"+t},Pb={},qU=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=zU(c),c in Pb)return;Pb[c]=!0;const d=c.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":BU,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((m,v)=>{h.addEventListener("load",m),h.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function HU(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=t;let l,c;const d=async(h=!0)=>{await c};async function f(){if("serviceWorker"in navigator){if(l=await qU(async()=>{const{Workbox:h}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:h}},[]).then(({Workbox:h})=>new h("/odontocloud-react/sw.js",{scope:"/odontocloud-react/",type:"classic"})).catch(h=>{o==null||o(h)}),!l)return;l.addEventListener("activated",h=>{(h.isUpdate||h.isExternal)&&window.location.reload()}),l.addEventListener("installed",h=>{h.isUpdate||r==null||r()}),l.register({immediate:e}).then(h=>{i?i("/odontocloud-react/sw.js",h):s==null||s(h)}).catch(h=>{o==null||o(h)})}}return c=f(),d}const WU="empresa_logo_url",kb="empresa_nombre",GU=S.createContext(null);function KU({children:t}){const[e,n]=S.useState(""),[r,s]=S.useState("OdontoCloud"),[i,o]=S.useState(!0);S.useEffect(()=>{var h;let d="";try{d=localStorage.getItem(WU)||""}catch{}d||(d="/assets/logo.png"),n(d);let f="OdontoCloud";try{f=localStorage.getItem(kb)||((h=document.querySelector('meta[name="company-name"]'))==null?void 0:h.getAttribute("content"))||"OdontoCloud"}catch{}s(f),o(!1)},[]);const c={logoUrl:e,clinicName:r,loading:i,setLogoUrl:n,setClinicName:d=>{const f=d||"OdontoCloud";try{localStorage.setItem(kb,f)}catch{}let h=document.querySelector('meta[name="company-name"]');h||(h=document.createElement("meta"),h.setAttribute("name","company-name"),document.head.appendChild(h)),h.setAttribute("content",f),s(f)}};return a.jsx(GU.Provider,{value:c,children:t})}const QU="/odontocloud-react/";$U();HU({immediate:!0});G0(document.getElementById("root")).render(a.jsx(Pg.StrictMode,{children:a.jsx(KU,{children:a.jsx(hk,{basename:QU,children:a.jsx(UU,{})})})}));
