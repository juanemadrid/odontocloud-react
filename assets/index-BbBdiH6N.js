(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function _1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var RI={exports:{}},Rh={},NI={exports:{}},Fe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bc=Symbol.for("react.element"),w1=Symbol.for("react.portal"),E1=Symbol.for("react.fragment"),x1=Symbol.for("react.strict_mode"),I1=Symbol.for("react.profiler"),b1=Symbol.for("react.provider"),T1=Symbol.for("react.context"),S1=Symbol.for("react.forward_ref"),C1=Symbol.for("react.suspense"),A1=Symbol.for("react.memo"),R1=Symbol.for("react.lazy"),P_=Symbol.iterator;function N1(t){return t===null||typeof t!="object"?null:(t=P_&&t[P_]||t["@@iterator"],typeof t=="function"?t:null)}var PI={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},kI=Object.assign,DI={};function qa(t,e,n){this.props=t,this.context=e,this.refs=DI,this.updater=n||PI}qa.prototype.isReactComponent={};qa.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};qa.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function jI(){}jI.prototype=qa.prototype;function Sg(t,e,n){this.props=t,this.context=e,this.refs=DI,this.updater=n||PI}var Cg=Sg.prototype=new jI;Cg.constructor=Sg;kI(Cg,qa.prototype);Cg.isPureReactComponent=!0;var k_=Array.isArray,OI=Object.prototype.hasOwnProperty,Ag={current:null},LI={key:!0,ref:!0,__self:!0,__source:!0};function VI(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)OI.call(e,r)&&!LI.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),d=0;d<a;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Bc,type:t,key:i,ref:o,props:s,_owner:Ag.current}}function P1(t,e){return{$$typeof:Bc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Rg(t){return typeof t=="object"&&t!==null&&t.$$typeof===Bc}function k1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var D_=/\/+/g;function Wf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?k1(""+t.key):e.toString(36)}function Ju(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Bc:case w1:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Wf(o,0):r,k_(s)?(n="",t!=null&&(n=t.replace(D_,"$&/")+"/"),Ju(s,e,n,"",function(d){return d})):s!=null&&(Rg(s)&&(s=P1(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(D_,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",k_(t))for(var a=0;a<t.length;a++){i=t[a];var c=r+Wf(i,a);o+=Ju(i,e,n,c,s)}else if(c=N1(t),typeof c=="function")for(t=c.call(t),a=0;!(i=t.next()).done;)i=i.value,c=r+Wf(i,a++),o+=Ju(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function xu(t,e,n){if(t==null)return t;var r=[],s=0;return Ju(t,r,"","",function(i){return e.call(n,i,s++)}),r}function D1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var En={current:null},Zu={transition:null},j1={ReactCurrentDispatcher:En,ReactCurrentBatchConfig:Zu,ReactCurrentOwner:Ag};function MI(){throw Error("act(...) is not supported in production builds of React.")}Fe.Children={map:xu,forEach:function(t,e,n){xu(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return xu(t,function(){e++}),e},toArray:function(t){return xu(t,function(e){return e})||[]},only:function(t){if(!Rg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Fe.Component=qa;Fe.Fragment=E1;Fe.Profiler=I1;Fe.PureComponent=Sg;Fe.StrictMode=x1;Fe.Suspense=C1;Fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j1;Fe.act=MI;Fe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=kI({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=Ag.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)OI.call(e,c)&&!LI.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var d=0;d<c;d++)a[d]=arguments[d+2];r.children=a}return{$$typeof:Bc,type:t.type,key:s,ref:i,props:r,_owner:o}};Fe.createContext=function(t){return t={$$typeof:T1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:b1,_context:t},t.Consumer=t};Fe.createElement=VI;Fe.createFactory=function(t){var e=VI.bind(null,t);return e.type=t,e};Fe.createRef=function(){return{current:null}};Fe.forwardRef=function(t){return{$$typeof:S1,render:t}};Fe.isValidElement=Rg;Fe.lazy=function(t){return{$$typeof:R1,_payload:{_status:-1,_result:t},_init:D1}};Fe.memo=function(t,e){return{$$typeof:A1,type:t,compare:e===void 0?null:e}};Fe.startTransition=function(t){var e=Zu.transition;Zu.transition={};try{t()}finally{Zu.transition=e}};Fe.unstable_act=MI;Fe.useCallback=function(t,e){return En.current.useCallback(t,e)};Fe.useContext=function(t){return En.current.useContext(t)};Fe.useDebugValue=function(){};Fe.useDeferredValue=function(t){return En.current.useDeferredValue(t)};Fe.useEffect=function(t,e){return En.current.useEffect(t,e)};Fe.useId=function(){return En.current.useId()};Fe.useImperativeHandle=function(t,e,n){return En.current.useImperativeHandle(t,e,n)};Fe.useInsertionEffect=function(t,e){return En.current.useInsertionEffect(t,e)};Fe.useLayoutEffect=function(t,e){return En.current.useLayoutEffect(t,e)};Fe.useMemo=function(t,e){return En.current.useMemo(t,e)};Fe.useReducer=function(t,e,n){return En.current.useReducer(t,e,n)};Fe.useRef=function(t){return En.current.useRef(t)};Fe.useState=function(t){return En.current.useState(t)};Fe.useSyncExternalStore=function(t,e,n){return En.current.useSyncExternalStore(t,e,n)};Fe.useTransition=function(){return En.current.useTransition()};Fe.version="18.3.1";NI.exports=Fe;var C=NI.exports;const FI=_1(C);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O1=C,L1=Symbol.for("react.element"),V1=Symbol.for("react.fragment"),M1=Object.prototype.hasOwnProperty,F1=O1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,U1={key:!0,ref:!0,__self:!0,__source:!0};function UI(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)M1.call(e,r)&&!U1.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:L1,type:t,key:i,ref:o,props:s,_owner:F1.current}}Rh.Fragment=V1;Rh.jsx=UI;Rh.jsxs=UI;RI.exports=Rh;var l=RI.exports,$I={exports:{}},Gn={},BI={exports:{}},zI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(ee,me){var _e=ee.length;ee.push(me);e:for(;0<_e;){var Pe=_e-1>>>1,Ke=ee[Pe];if(0<s(Ke,me))ee[Pe]=me,ee[_e]=Ke,_e=Pe;else break e}}function n(ee){return ee.length===0?null:ee[0]}function r(ee){if(ee.length===0)return null;var me=ee[0],_e=ee.pop();if(_e!==me){ee[0]=_e;e:for(var Pe=0,Ke=ee.length,St=Ke>>>1;Pe<St;){var U=2*(Pe+1)-1,ie=ee[U],B=U+1,W=ee[B];if(0>s(ie,_e))B<Ke&&0>s(W,ie)?(ee[Pe]=W,ee[B]=_e,Pe=B):(ee[Pe]=ie,ee[U]=_e,Pe=U);else if(B<Ke&&0>s(W,_e))ee[Pe]=W,ee[B]=_e,Pe=B;else break e}}return me}function s(ee,me){var _e=ee.sortIndex-me.sortIndex;return _e!==0?_e:ee.id-me.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],d=[],h=1,f=null,m=3,_=!1,R=!1,A=!1,N=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(ee){for(var me=n(d);me!==null;){if(me.callback===null)r(d);else if(me.startTime<=ee)r(d),me.sortIndex=me.expirationTime,e(c,me);else break;me=n(d)}}function I(ee){if(A=!1,E(ee),!R)if(n(c)!==null)R=!0,At(O);else{var me=n(d);me!==null&&Qt(I,me.startTime-ee)}}function O(ee,me){R=!1,A&&(A=!1,b(w),w=-1),_=!0;var _e=m;try{for(E(me),f=n(c);f!==null&&(!(f.expirationTime>me)||ee&&!D());){var Pe=f.callback;if(typeof Pe=="function"){f.callback=null,m=f.priorityLevel;var Ke=Pe(f.expirationTime<=me);me=t.unstable_now(),typeof Ke=="function"?f.callback=Ke:f===n(c)&&r(c),E(me)}else r(c);f=n(c)}if(f!==null)var St=!0;else{var U=n(d);U!==null&&Qt(I,U.startTime-me),St=!1}return St}finally{f=null,m=_e,_=!1}}var F=!1,x=null,w=-1,v=5,P=-1;function D(){return!(t.unstable_now()-P<v)}function j(){if(x!==null){var ee=t.unstable_now();P=ee;var me=!0;try{me=x(!0,ee)}finally{me?k():(F=!1,x=null)}}else F=!1}var k;if(typeof y=="function")k=function(){y(j)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,We=K.port2;K.port1.onmessage=j,k=function(){We.postMessage(null)}}else k=function(){N(j,0)};function At(ee){x=ee,F||(F=!0,k())}function Qt(ee,me){w=N(function(){ee(t.unstable_now())},me)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ee){ee.callback=null},t.unstable_continueExecution=function(){R||_||(R=!0,At(O))},t.unstable_forceFrameRate=function(ee){0>ee||125<ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):v=0<ee?Math.floor(1e3/ee):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(ee){switch(m){case 1:case 2:case 3:var me=3;break;default:me=m}var _e=m;m=me;try{return ee()}finally{m=_e}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(ee,me){switch(ee){case 1:case 2:case 3:case 4:case 5:break;default:ee=3}var _e=m;m=ee;try{return me()}finally{m=_e}},t.unstable_scheduleCallback=function(ee,me,_e){var Pe=t.unstable_now();switch(typeof _e=="object"&&_e!==null?(_e=_e.delay,_e=typeof _e=="number"&&0<_e?Pe+_e:Pe):_e=Pe,ee){case 1:var Ke=-1;break;case 2:Ke=250;break;case 5:Ke=1073741823;break;case 4:Ke=1e4;break;default:Ke=5e3}return Ke=_e+Ke,ee={id:h++,callback:me,priorityLevel:ee,startTime:_e,expirationTime:Ke,sortIndex:-1},_e>Pe?(ee.sortIndex=_e,e(d,ee),n(c)===null&&ee===n(d)&&(A?(b(w),w=-1):A=!0,Qt(I,_e-Pe))):(ee.sortIndex=Ke,e(c,ee),R||_||(R=!0,At(O))),ee},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(ee){var me=m;return function(){var _e=m;m=me;try{return ee.apply(this,arguments)}finally{m=_e}}}})(zI);BI.exports=zI;var $1=BI.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B1=C,Hn=$1;function Y(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var qI=new Set,cc={};function xo(t,e){xa(t,e),xa(t+"Capture",e)}function xa(t,e){for(cc[t]=e,t=0;t<e.length;t++)qI.add(e[t])}var ds=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Yp=Object.prototype.hasOwnProperty,z1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,j_={},O_={};function q1(t){return Yp.call(O_,t)?!0:Yp.call(j_,t)?!1:z1.test(t)?O_[t]=!0:(j_[t]=!0,!1)}function H1(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function W1(t,e,n,r){if(e===null||typeof e>"u"||H1(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function xn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var en={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){en[t]=new xn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];en[e]=new xn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){en[t]=new xn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){en[t]=new xn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){en[t]=new xn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){en[t]=new xn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){en[t]=new xn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){en[t]=new xn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){en[t]=new xn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ng=/[\-:]([a-z])/g;function Pg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Ng,Pg);en[e]=new xn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Ng,Pg);en[e]=new xn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Ng,Pg);en[e]=new xn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){en[t]=new xn(t,1,!1,t.toLowerCase(),null,!1,!1)});en.xlinkHref=new xn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){en[t]=new xn(t,1,!1,t.toLowerCase(),null,!0,!0)});function kg(t,e,n,r){var s=en.hasOwnProperty(e)?en[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(W1(e,n,s,r)&&(n=null),r||s===null?q1(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Es=B1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Iu=Symbol.for("react.element"),Yo=Symbol.for("react.portal"),Xo=Symbol.for("react.fragment"),Dg=Symbol.for("react.strict_mode"),Xp=Symbol.for("react.profiler"),HI=Symbol.for("react.provider"),WI=Symbol.for("react.context"),jg=Symbol.for("react.forward_ref"),Jp=Symbol.for("react.suspense"),Zp=Symbol.for("react.suspense_list"),Og=Symbol.for("react.memo"),Vs=Symbol.for("react.lazy"),GI=Symbol.for("react.offscreen"),L_=Symbol.iterator;function fl(t){return t===null||typeof t!="object"?null:(t=L_&&t[L_]||t["@@iterator"],typeof t=="function"?t:null)}var _t=Object.assign,Gf;function Pl(t){if(Gf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Gf=e&&e[1]||""}return`
`+Gf+t}var Kf=!1;function Qf(t,e){if(!t||Kf)return"";Kf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=a);break}}}finally{Kf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Pl(t):""}function G1(t){switch(t.tag){case 5:return Pl(t.type);case 16:return Pl("Lazy");case 13:return Pl("Suspense");case 19:return Pl("SuspenseList");case 0:case 2:case 15:return t=Qf(t.type,!1),t;case 11:return t=Qf(t.type.render,!1),t;case 1:return t=Qf(t.type,!0),t;default:return""}}function em(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Xo:return"Fragment";case Yo:return"Portal";case Xp:return"Profiler";case Dg:return"StrictMode";case Jp:return"Suspense";case Zp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case WI:return(t.displayName||"Context")+".Consumer";case HI:return(t._context.displayName||"Context")+".Provider";case jg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Og:return e=t.displayName||null,e!==null?e:em(t.type)||"Memo";case Vs:e=t._payload,t=t._init;try{return em(t(e))}catch{}}return null}function K1(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return em(e);case 8:return e===Dg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function di(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function KI(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Q1(t){var e=KI(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function bu(t){t._valueTracker||(t._valueTracker=Q1(t))}function QI(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=KI(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ad(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function tm(t,e){var n=e.checked;return _t({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function V_(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=di(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function YI(t,e){e=e.checked,e!=null&&kg(t,"checked",e,!1)}function nm(t,e){YI(t,e);var n=di(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?rm(t,e.type,n):e.hasOwnProperty("defaultValue")&&rm(t,e.type,di(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function M_(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function rm(t,e,n){(e!=="number"||Ad(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var kl=Array.isArray;function ca(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+di(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function sm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Y(91));return _t({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function F_(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Y(92));if(kl(n)){if(1<n.length)throw Error(Y(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:di(n)}}function XI(t,e){var n=di(e.value),r=di(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function U_(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function JI(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function im(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?JI(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Tu,ZI=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Tu=Tu||document.createElement("div"),Tu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Tu.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function uc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ql={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Y1=["Webkit","ms","Moz","O"];Object.keys(ql).forEach(function(t){Y1.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ql[e]=ql[t]})});function eb(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ql.hasOwnProperty(t)&&ql[t]?(""+e).trim():e+"px"}function tb(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=eb(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var X1=_t({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function om(t,e){if(e){if(X1[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Y(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Y(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Y(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Y(62))}}function am(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lm=null;function Lg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var cm=null,ua=null,da=null;function $_(t){if(t=Hc(t)){if(typeof cm!="function")throw Error(Y(280));var e=t.stateNode;e&&(e=jh(e),cm(t.stateNode,t.type,e))}}function nb(t){ua?da?da.push(t):da=[t]:ua=t}function rb(){if(ua){var t=ua,e=da;if(da=ua=null,$_(t),e)for(t=0;t<e.length;t++)$_(e[t])}}function sb(t,e){return t(e)}function ib(){}var Yf=!1;function ob(t,e,n){if(Yf)return t(e,n);Yf=!0;try{return sb(t,e,n)}finally{Yf=!1,(ua!==null||da!==null)&&(ib(),rb())}}function dc(t,e){var n=t.stateNode;if(n===null)return null;var r=jh(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Y(231,e,typeof n));return n}var um=!1;if(ds)try{var pl={};Object.defineProperty(pl,"passive",{get:function(){um=!0}}),window.addEventListener("test",pl,pl),window.removeEventListener("test",pl,pl)}catch{um=!1}function J1(t,e,n,r,s,i,o,a,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var Hl=!1,Rd=null,Nd=!1,dm=null,Z1={onError:function(t){Hl=!0,Rd=t}};function eR(t,e,n,r,s,i,o,a,c){Hl=!1,Rd=null,J1.apply(Z1,arguments)}function tR(t,e,n,r,s,i,o,a,c){if(eR.apply(this,arguments),Hl){if(Hl){var d=Rd;Hl=!1,Rd=null}else throw Error(Y(198));Nd||(Nd=!0,dm=d)}}function Io(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function ab(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function B_(t){if(Io(t)!==t)throw Error(Y(188))}function nR(t){var e=t.alternate;if(!e){if(e=Io(t),e===null)throw Error(Y(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return B_(s),t;if(i===r)return B_(s),e;i=i.sibling}throw Error(Y(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(Y(189))}}if(n.alternate!==r)throw Error(Y(190))}if(n.tag!==3)throw Error(Y(188));return n.stateNode.current===n?t:e}function lb(t){return t=nR(t),t!==null?cb(t):null}function cb(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=cb(t);if(e!==null)return e;t=t.sibling}return null}var ub=Hn.unstable_scheduleCallback,z_=Hn.unstable_cancelCallback,rR=Hn.unstable_shouldYield,sR=Hn.unstable_requestPaint,Ct=Hn.unstable_now,iR=Hn.unstable_getCurrentPriorityLevel,Vg=Hn.unstable_ImmediatePriority,db=Hn.unstable_UserBlockingPriority,Pd=Hn.unstable_NormalPriority,oR=Hn.unstable_LowPriority,hb=Hn.unstable_IdlePriority,Nh=null,qr=null;function aR(t){if(qr&&typeof qr.onCommitFiberRoot=="function")try{qr.onCommitFiberRoot(Nh,t,void 0,(t.current.flags&128)===128)}catch{}}var wr=Math.clz32?Math.clz32:uR,lR=Math.log,cR=Math.LN2;function uR(t){return t>>>=0,t===0?32:31-(lR(t)/cR|0)|0}var Su=64,Cu=4194304;function Dl(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function kd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=Dl(a):(i&=o,i!==0&&(r=Dl(i)))}else o=n&~s,o!==0?r=Dl(o):i!==0&&(r=Dl(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-wr(e),s=1<<n,r|=t[n],e&=~s;return r}function dR(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hR(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-wr(i),a=1<<o,c=s[o];c===-1?(!(a&n)||a&r)&&(s[o]=dR(a,e)):c<=e&&(t.expiredLanes|=a),i&=~a}}function hm(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function fb(){var t=Su;return Su<<=1,!(Su&4194240)&&(Su=64),t}function Xf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function zc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-wr(e),t[e]=n}function fR(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-wr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Mg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-wr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var et=0;function pb(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var mb,Fg,gb,yb,vb,fm=!1,Au=[],Xs=null,Js=null,Zs=null,hc=new Map,fc=new Map,Fs=[],pR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function q_(t,e){switch(t){case"focusin":case"focusout":Xs=null;break;case"dragenter":case"dragleave":Js=null;break;case"mouseover":case"mouseout":Zs=null;break;case"pointerover":case"pointerout":hc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":fc.delete(e.pointerId)}}function ml(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Hc(e),e!==null&&Fg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function mR(t,e,n,r,s){switch(e){case"focusin":return Xs=ml(Xs,t,e,n,r,s),!0;case"dragenter":return Js=ml(Js,t,e,n,r,s),!0;case"mouseover":return Zs=ml(Zs,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return hc.set(i,ml(hc.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,fc.set(i,ml(fc.get(i)||null,t,e,n,r,s)),!0}return!1}function _b(t){var e=zi(t.target);if(e!==null){var n=Io(e);if(n!==null){if(e=n.tag,e===13){if(e=ab(n),e!==null){t.blockedOn=e,vb(t.priority,function(){gb(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ed(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=pm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);lm=r,n.target.dispatchEvent(r),lm=null}else return e=Hc(n),e!==null&&Fg(e),t.blockedOn=n,!1;e.shift()}return!0}function H_(t,e,n){ed(t)&&n.delete(e)}function gR(){fm=!1,Xs!==null&&ed(Xs)&&(Xs=null),Js!==null&&ed(Js)&&(Js=null),Zs!==null&&ed(Zs)&&(Zs=null),hc.forEach(H_),fc.forEach(H_)}function gl(t,e){t.blockedOn===e&&(t.blockedOn=null,fm||(fm=!0,Hn.unstable_scheduleCallback(Hn.unstable_NormalPriority,gR)))}function pc(t){function e(s){return gl(s,t)}if(0<Au.length){gl(Au[0],t);for(var n=1;n<Au.length;n++){var r=Au[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Xs!==null&&gl(Xs,t),Js!==null&&gl(Js,t),Zs!==null&&gl(Zs,t),hc.forEach(e),fc.forEach(e),n=0;n<Fs.length;n++)r=Fs[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Fs.length&&(n=Fs[0],n.blockedOn===null);)_b(n),n.blockedOn===null&&Fs.shift()}var ha=Es.ReactCurrentBatchConfig,Dd=!0;function yR(t,e,n,r){var s=et,i=ha.transition;ha.transition=null;try{et=1,Ug(t,e,n,r)}finally{et=s,ha.transition=i}}function vR(t,e,n,r){var s=et,i=ha.transition;ha.transition=null;try{et=4,Ug(t,e,n,r)}finally{et=s,ha.transition=i}}function Ug(t,e,n,r){if(Dd){var s=pm(t,e,n,r);if(s===null)ap(t,e,r,jd,n),q_(t,r);else if(mR(s,t,e,n,r))r.stopPropagation();else if(q_(t,r),e&4&&-1<pR.indexOf(t)){for(;s!==null;){var i=Hc(s);if(i!==null&&mb(i),i=pm(t,e,n,r),i===null&&ap(t,e,r,jd,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else ap(t,e,r,null,n)}}var jd=null;function pm(t,e,n,r){if(jd=null,t=Lg(r),t=zi(t),t!==null)if(e=Io(t),e===null)t=null;else if(n=e.tag,n===13){if(t=ab(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return jd=t,null}function wb(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(iR()){case Vg:return 1;case db:return 4;case Pd:case oR:return 16;case hb:return 536870912;default:return 16}default:return 16}}var Ks=null,$g=null,td=null;function Eb(){if(td)return td;var t,e=$g,n=e.length,r,s="value"in Ks?Ks.value:Ks.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return td=s.slice(t,1<r?1-r:void 0)}function nd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ru(){return!0}function W_(){return!1}function Kn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ru:W_,this.isPropagationStopped=W_,this}return _t(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ru)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ru)},persist:function(){},isPersistent:Ru}),e}var Ha={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bg=Kn(Ha),qc=_t({},Ha,{view:0,detail:0}),_R=Kn(qc),Jf,Zf,yl,Ph=_t({},qc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==yl&&(yl&&t.type==="mousemove"?(Jf=t.screenX-yl.screenX,Zf=t.screenY-yl.screenY):Zf=Jf=0,yl=t),Jf)},movementY:function(t){return"movementY"in t?t.movementY:Zf}}),G_=Kn(Ph),wR=_t({},Ph,{dataTransfer:0}),ER=Kn(wR),xR=_t({},qc,{relatedTarget:0}),ep=Kn(xR),IR=_t({},Ha,{animationName:0,elapsedTime:0,pseudoElement:0}),bR=Kn(IR),TR=_t({},Ha,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),SR=Kn(TR),CR=_t({},Ha,{data:0}),K_=Kn(CR),AR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function PR(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=NR[t])?!!e[t]:!1}function zg(){return PR}var kR=_t({},qc,{key:function(t){if(t.key){var e=AR[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=nd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?RR[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zg,charCode:function(t){return t.type==="keypress"?nd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?nd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),DR=Kn(kR),jR=_t({},Ph,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Q_=Kn(jR),OR=_t({},qc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zg}),LR=Kn(OR),VR=_t({},Ha,{propertyName:0,elapsedTime:0,pseudoElement:0}),MR=Kn(VR),FR=_t({},Ph,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),UR=Kn(FR),$R=[9,13,27,32],qg=ds&&"CompositionEvent"in window,Wl=null;ds&&"documentMode"in document&&(Wl=document.documentMode);var BR=ds&&"TextEvent"in window&&!Wl,xb=ds&&(!qg||Wl&&8<Wl&&11>=Wl),Y_=" ",X_=!1;function Ib(t,e){switch(t){case"keyup":return $R.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bb(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Jo=!1;function zR(t,e){switch(t){case"compositionend":return bb(e);case"keypress":return e.which!==32?null:(X_=!0,Y_);case"textInput":return t=e.data,t===Y_&&X_?null:t;default:return null}}function qR(t,e){if(Jo)return t==="compositionend"||!qg&&Ib(t,e)?(t=Eb(),td=$g=Ks=null,Jo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return xb&&e.locale!=="ko"?null:e.data;default:return null}}var HR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function J_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!HR[t.type]:e==="textarea"}function Tb(t,e,n,r){nb(r),e=Od(e,"onChange"),0<e.length&&(n=new Bg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Gl=null,mc=null;function WR(t){Lb(t,0)}function kh(t){var e=ta(t);if(QI(e))return t}function GR(t,e){if(t==="change")return e}var Sb=!1;if(ds){var tp;if(ds){var np="oninput"in document;if(!np){var Z_=document.createElement("div");Z_.setAttribute("oninput","return;"),np=typeof Z_.oninput=="function"}tp=np}else tp=!1;Sb=tp&&(!document.documentMode||9<document.documentMode)}function ew(){Gl&&(Gl.detachEvent("onpropertychange",Cb),mc=Gl=null)}function Cb(t){if(t.propertyName==="value"&&kh(mc)){var e=[];Tb(e,mc,t,Lg(t)),ob(WR,e)}}function KR(t,e,n){t==="focusin"?(ew(),Gl=e,mc=n,Gl.attachEvent("onpropertychange",Cb)):t==="focusout"&&ew()}function QR(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return kh(mc)}function YR(t,e){if(t==="click")return kh(e)}function XR(t,e){if(t==="input"||t==="change")return kh(e)}function JR(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ir=typeof Object.is=="function"?Object.is:JR;function gc(t,e){if(Ir(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Yp.call(e,s)||!Ir(t[s],e[s]))return!1}return!0}function tw(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function nw(t,e){var n=tw(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=tw(n)}}function Ab(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Ab(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Rb(){for(var t=window,e=Ad();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ad(t.document)}return e}function Hg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function ZR(t){var e=Rb(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Ab(n.ownerDocument.documentElement,n)){if(r!==null&&Hg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=nw(n,i);var o=nw(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var eN=ds&&"documentMode"in document&&11>=document.documentMode,Zo=null,mm=null,Kl=null,gm=!1;function rw(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;gm||Zo==null||Zo!==Ad(r)||(r=Zo,"selectionStart"in r&&Hg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Kl&&gc(Kl,r)||(Kl=r,r=Od(mm,"onSelect"),0<r.length&&(e=new Bg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Zo)))}function Nu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ea={animationend:Nu("Animation","AnimationEnd"),animationiteration:Nu("Animation","AnimationIteration"),animationstart:Nu("Animation","AnimationStart"),transitionend:Nu("Transition","TransitionEnd")},rp={},Nb={};ds&&(Nb=document.createElement("div").style,"AnimationEvent"in window||(delete ea.animationend.animation,delete ea.animationiteration.animation,delete ea.animationstart.animation),"TransitionEvent"in window||delete ea.transitionend.transition);function Dh(t){if(rp[t])return rp[t];if(!ea[t])return t;var e=ea[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Nb)return rp[t]=e[n];return t}var Pb=Dh("animationend"),kb=Dh("animationiteration"),Db=Dh("animationstart"),jb=Dh("transitionend"),Ob=new Map,sw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vi(t,e){Ob.set(t,e),xo(e,[t])}for(var sp=0;sp<sw.length;sp++){var ip=sw[sp],tN=ip.toLowerCase(),nN=ip[0].toUpperCase()+ip.slice(1);vi(tN,"on"+nN)}vi(Pb,"onAnimationEnd");vi(kb,"onAnimationIteration");vi(Db,"onAnimationStart");vi("dblclick","onDoubleClick");vi("focusin","onFocus");vi("focusout","onBlur");vi(jb,"onTransitionEnd");xa("onMouseEnter",["mouseout","mouseover"]);xa("onMouseLeave",["mouseout","mouseover"]);xa("onPointerEnter",["pointerout","pointerover"]);xa("onPointerLeave",["pointerout","pointerover"]);xo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));xo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));xo("onBeforeInput",["compositionend","keypress","textInput","paste"]);xo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));xo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));xo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rN=new Set("cancel close invalid load scroll toggle".split(" ").concat(jl));function iw(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,tR(r,e,void 0,t),t.currentTarget=null}function Lb(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],c=a.instance,d=a.currentTarget;if(a=a.listener,c!==i&&s.isPropagationStopped())break e;iw(s,a,d),i=c}else for(o=0;o<r.length;o++){if(a=r[o],c=a.instance,d=a.currentTarget,a=a.listener,c!==i&&s.isPropagationStopped())break e;iw(s,a,d),i=c}}}if(Nd)throw t=dm,Nd=!1,dm=null,t}function lt(t,e){var n=e[Em];n===void 0&&(n=e[Em]=new Set);var r=t+"__bubble";n.has(r)||(Vb(e,t,2,!1),n.add(r))}function op(t,e,n){var r=0;e&&(r|=4),Vb(n,t,r,e)}var Pu="_reactListening"+Math.random().toString(36).slice(2);function yc(t){if(!t[Pu]){t[Pu]=!0,qI.forEach(function(n){n!=="selectionchange"&&(rN.has(n)||op(n,!1,t),op(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Pu]||(e[Pu]=!0,op("selectionchange",!1,e))}}function Vb(t,e,n,r){switch(wb(e)){case 1:var s=yR;break;case 4:s=vR;break;default:s=Ug}n=s.bind(null,e,n,t),s=void 0,!um||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function ap(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;a!==null;){if(o=zi(a),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}a=a.parentNode}}r=r.return}ob(function(){var d=i,h=Lg(n),f=[];e:{var m=Ob.get(t);if(m!==void 0){var _=Bg,R=t;switch(t){case"keypress":if(nd(n)===0)break e;case"keydown":case"keyup":_=DR;break;case"focusin":R="focus",_=ep;break;case"focusout":R="blur",_=ep;break;case"beforeblur":case"afterblur":_=ep;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=G_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=ER;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=LR;break;case Pb:case kb:case Db:_=bR;break;case jb:_=MR;break;case"scroll":_=_R;break;case"wheel":_=UR;break;case"copy":case"cut":case"paste":_=SR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=Q_}var A=(e&4)!==0,N=!A&&t==="scroll",b=A?m!==null?m+"Capture":null:m;A=[];for(var y=d,E;y!==null;){E=y;var I=E.stateNode;if(E.tag===5&&I!==null&&(E=I,b!==null&&(I=dc(y,b),I!=null&&A.push(vc(y,I,E)))),N)break;y=y.return}0<A.length&&(m=new _(m,R,null,n,h),f.push({event:m,listeners:A}))}}if(!(e&7)){e:{if(m=t==="mouseover"||t==="pointerover",_=t==="mouseout"||t==="pointerout",m&&n!==lm&&(R=n.relatedTarget||n.fromElement)&&(zi(R)||R[hs]))break e;if((_||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,_?(R=n.relatedTarget||n.toElement,_=d,R=R?zi(R):null,R!==null&&(N=Io(R),R!==N||R.tag!==5&&R.tag!==6)&&(R=null)):(_=null,R=d),_!==R)){if(A=G_,I="onMouseLeave",b="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(A=Q_,I="onPointerLeave",b="onPointerEnter",y="pointer"),N=_==null?m:ta(_),E=R==null?m:ta(R),m=new A(I,y+"leave",_,n,h),m.target=N,m.relatedTarget=E,I=null,zi(h)===d&&(A=new A(b,y+"enter",R,n,h),A.target=E,A.relatedTarget=N,I=A),N=I,_&&R)t:{for(A=_,b=R,y=0,E=A;E;E=ko(E))y++;for(E=0,I=b;I;I=ko(I))E++;for(;0<y-E;)A=ko(A),y--;for(;0<E-y;)b=ko(b),E--;for(;y--;){if(A===b||b!==null&&A===b.alternate)break t;A=ko(A),b=ko(b)}A=null}else A=null;_!==null&&ow(f,m,_,A,!1),R!==null&&N!==null&&ow(f,N,R,A,!0)}}e:{if(m=d?ta(d):window,_=m.nodeName&&m.nodeName.toLowerCase(),_==="select"||_==="input"&&m.type==="file")var O=GR;else if(J_(m))if(Sb)O=XR;else{O=QR;var F=KR}else(_=m.nodeName)&&_.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(O=YR);if(O&&(O=O(t,d))){Tb(f,O,n,h);break e}F&&F(t,m,d),t==="focusout"&&(F=m._wrapperState)&&F.controlled&&m.type==="number"&&rm(m,"number",m.value)}switch(F=d?ta(d):window,t){case"focusin":(J_(F)||F.contentEditable==="true")&&(Zo=F,mm=d,Kl=null);break;case"focusout":Kl=mm=Zo=null;break;case"mousedown":gm=!0;break;case"contextmenu":case"mouseup":case"dragend":gm=!1,rw(f,n,h);break;case"selectionchange":if(eN)break;case"keydown":case"keyup":rw(f,n,h)}var x;if(qg)e:{switch(t){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Jo?Ib(t,n)&&(w="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(w="onCompositionStart");w&&(xb&&n.locale!=="ko"&&(Jo||w!=="onCompositionStart"?w==="onCompositionEnd"&&Jo&&(x=Eb()):(Ks=h,$g="value"in Ks?Ks.value:Ks.textContent,Jo=!0)),F=Od(d,w),0<F.length&&(w=new K_(w,t,null,n,h),f.push({event:w,listeners:F}),x?w.data=x:(x=bb(n),x!==null&&(w.data=x)))),(x=BR?zR(t,n):qR(t,n))&&(d=Od(d,"onBeforeInput"),0<d.length&&(h=new K_("onBeforeInput","beforeinput",null,n,h),f.push({event:h,listeners:d}),h.data=x))}Lb(f,e)})}function vc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Od(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=dc(t,n),i!=null&&r.unshift(vc(t,i,s)),i=dc(t,e),i!=null&&r.push(vc(t,i,s))),t=t.return}return r}function ko(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ow(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,c=a.alternate,d=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&d!==null&&(a=d,s?(c=dc(n,i),c!=null&&o.unshift(vc(n,c,a))):s||(c=dc(n,i),c!=null&&o.push(vc(n,c,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var sN=/\r\n?/g,iN=/\u0000|\uFFFD/g;function aw(t){return(typeof t=="string"?t:""+t).replace(sN,`
`).replace(iN,"")}function ku(t,e,n){if(e=aw(e),aw(t)!==e&&n)throw Error(Y(425))}function Ld(){}var ym=null,vm=null;function _m(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var wm=typeof setTimeout=="function"?setTimeout:void 0,oN=typeof clearTimeout=="function"?clearTimeout:void 0,lw=typeof Promise=="function"?Promise:void 0,aN=typeof queueMicrotask=="function"?queueMicrotask:typeof lw<"u"?function(t){return lw.resolve(null).then(t).catch(lN)}:wm;function lN(t){setTimeout(function(){throw t})}function lp(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),pc(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);pc(e)}function ei(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function cw(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Wa=Math.random().toString(36).slice(2),Ur="__reactFiber$"+Wa,_c="__reactProps$"+Wa,hs="__reactContainer$"+Wa,Em="__reactEvents$"+Wa,cN="__reactListeners$"+Wa,uN="__reactHandles$"+Wa;function zi(t){var e=t[Ur];if(e)return e;for(var n=t.parentNode;n;){if(e=n[hs]||n[Ur]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=cw(t);t!==null;){if(n=t[Ur])return n;t=cw(t)}return e}t=n,n=t.parentNode}return null}function Hc(t){return t=t[Ur]||t[hs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ta(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Y(33))}function jh(t){return t[_c]||null}var xm=[],na=-1;function _i(t){return{current:t}}function ut(t){0>na||(t.current=xm[na],xm[na]=null,na--)}function ot(t,e){na++,xm[na]=t.current,t.current=e}var hi={},hn=_i(hi),Rn=_i(!1),no=hi;function Ia(t,e){var n=t.type.contextTypes;if(!n)return hi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Nn(t){return t=t.childContextTypes,t!=null}function Vd(){ut(Rn),ut(hn)}function uw(t,e,n){if(hn.current!==hi)throw Error(Y(168));ot(hn,e),ot(Rn,n)}function Mb(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Y(108,K1(t)||"Unknown",s));return _t({},n,r)}function Md(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||hi,no=hn.current,ot(hn,t),ot(Rn,Rn.current),!0}function dw(t,e,n){var r=t.stateNode;if(!r)throw Error(Y(169));n?(t=Mb(t,e,no),r.__reactInternalMemoizedMergedChildContext=t,ut(Rn),ut(hn),ot(hn,t)):ut(Rn),ot(Rn,n)}var ns=null,Oh=!1,cp=!1;function Fb(t){ns===null?ns=[t]:ns.push(t)}function dN(t){Oh=!0,Fb(t)}function wi(){if(!cp&&ns!==null){cp=!0;var t=0,e=et;try{var n=ns;for(et=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ns=null,Oh=!1}catch(s){throw ns!==null&&(ns=ns.slice(t+1)),ub(Vg,wi),s}finally{et=e,cp=!1}}return null}var ra=[],sa=0,Fd=null,Ud=0,Jn=[],Zn=0,ro=null,rs=1,ss="";function Di(t,e){ra[sa++]=Ud,ra[sa++]=Fd,Fd=t,Ud=e}function Ub(t,e,n){Jn[Zn++]=rs,Jn[Zn++]=ss,Jn[Zn++]=ro,ro=t;var r=rs;t=ss;var s=32-wr(r)-1;r&=~(1<<s),n+=1;var i=32-wr(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,rs=1<<32-wr(e)+s|n<<s|r,ss=i+t}else rs=1<<i|n<<s|r,ss=t}function Wg(t){t.return!==null&&(Di(t,1),Ub(t,1,0))}function Gg(t){for(;t===Fd;)Fd=ra[--sa],ra[sa]=null,Ud=ra[--sa],ra[sa]=null;for(;t===ro;)ro=Jn[--Zn],Jn[Zn]=null,ss=Jn[--Zn],Jn[Zn]=null,rs=Jn[--Zn],Jn[Zn]=null}var zn=null,$n=null,ht=!1,yr=null;function $b(t,e){var n=nr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function hw(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,zn=t,$n=ei(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,zn=t,$n=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ro!==null?{id:rs,overflow:ss}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=nr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,zn=t,$n=null,!0):!1;default:return!1}}function Im(t){return(t.mode&1)!==0&&(t.flags&128)===0}function bm(t){if(ht){var e=$n;if(e){var n=e;if(!hw(t,e)){if(Im(t))throw Error(Y(418));e=ei(n.nextSibling);var r=zn;e&&hw(t,e)?$b(r,n):(t.flags=t.flags&-4097|2,ht=!1,zn=t)}}else{if(Im(t))throw Error(Y(418));t.flags=t.flags&-4097|2,ht=!1,zn=t}}}function fw(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;zn=t}function Du(t){if(t!==zn)return!1;if(!ht)return fw(t),ht=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!_m(t.type,t.memoizedProps)),e&&(e=$n)){if(Im(t))throw Bb(),Error(Y(418));for(;e;)$b(t,e),e=ei(e.nextSibling)}if(fw(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Y(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){$n=ei(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}$n=null}}else $n=zn?ei(t.stateNode.nextSibling):null;return!0}function Bb(){for(var t=$n;t;)t=ei(t.nextSibling)}function ba(){$n=zn=null,ht=!1}function Kg(t){yr===null?yr=[t]:yr.push(t)}var hN=Es.ReactCurrentBatchConfig;function vl(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Y(309));var r=n.stateNode}if(!r)throw Error(Y(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(Y(284));if(!n._owner)throw Error(Y(290,t))}return t}function ju(t,e){throw t=Object.prototype.toString.call(e),Error(Y(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function pw(t){var e=t._init;return e(t._payload)}function zb(t){function e(b,y){if(t){var E=b.deletions;E===null?(b.deletions=[y],b.flags|=16):E.push(y)}}function n(b,y){if(!t)return null;for(;y!==null;)e(b,y),y=y.sibling;return null}function r(b,y){for(b=new Map;y!==null;)y.key!==null?b.set(y.key,y):b.set(y.index,y),y=y.sibling;return b}function s(b,y){return b=si(b,y),b.index=0,b.sibling=null,b}function i(b,y,E){return b.index=E,t?(E=b.alternate,E!==null?(E=E.index,E<y?(b.flags|=2,y):E):(b.flags|=2,y)):(b.flags|=1048576,y)}function o(b){return t&&b.alternate===null&&(b.flags|=2),b}function a(b,y,E,I){return y===null||y.tag!==6?(y=gp(E,b.mode,I),y.return=b,y):(y=s(y,E),y.return=b,y)}function c(b,y,E,I){var O=E.type;return O===Xo?h(b,y,E.props.children,I,E.key):y!==null&&(y.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===Vs&&pw(O)===y.type)?(I=s(y,E.props),I.ref=vl(b,y,E),I.return=b,I):(I=cd(E.type,E.key,E.props,null,b.mode,I),I.ref=vl(b,y,E),I.return=b,I)}function d(b,y,E,I){return y===null||y.tag!==4||y.stateNode.containerInfo!==E.containerInfo||y.stateNode.implementation!==E.implementation?(y=yp(E,b.mode,I),y.return=b,y):(y=s(y,E.children||[]),y.return=b,y)}function h(b,y,E,I,O){return y===null||y.tag!==7?(y=Qi(E,b.mode,I,O),y.return=b,y):(y=s(y,E),y.return=b,y)}function f(b,y,E){if(typeof y=="string"&&y!==""||typeof y=="number")return y=gp(""+y,b.mode,E),y.return=b,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Iu:return E=cd(y.type,y.key,y.props,null,b.mode,E),E.ref=vl(b,null,y),E.return=b,E;case Yo:return y=yp(y,b.mode,E),y.return=b,y;case Vs:var I=y._init;return f(b,I(y._payload),E)}if(kl(y)||fl(y))return y=Qi(y,b.mode,E,null),y.return=b,y;ju(b,y)}return null}function m(b,y,E,I){var O=y!==null?y.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return O!==null?null:a(b,y,""+E,I);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Iu:return E.key===O?c(b,y,E,I):null;case Yo:return E.key===O?d(b,y,E,I):null;case Vs:return O=E._init,m(b,y,O(E._payload),I)}if(kl(E)||fl(E))return O!==null?null:h(b,y,E,I,null);ju(b,E)}return null}function _(b,y,E,I,O){if(typeof I=="string"&&I!==""||typeof I=="number")return b=b.get(E)||null,a(y,b,""+I,O);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Iu:return b=b.get(I.key===null?E:I.key)||null,c(y,b,I,O);case Yo:return b=b.get(I.key===null?E:I.key)||null,d(y,b,I,O);case Vs:var F=I._init;return _(b,y,E,F(I._payload),O)}if(kl(I)||fl(I))return b=b.get(E)||null,h(y,b,I,O,null);ju(y,I)}return null}function R(b,y,E,I){for(var O=null,F=null,x=y,w=y=0,v=null;x!==null&&w<E.length;w++){x.index>w?(v=x,x=null):v=x.sibling;var P=m(b,x,E[w],I);if(P===null){x===null&&(x=v);break}t&&x&&P.alternate===null&&e(b,x),y=i(P,y,w),F===null?O=P:F.sibling=P,F=P,x=v}if(w===E.length)return n(b,x),ht&&Di(b,w),O;if(x===null){for(;w<E.length;w++)x=f(b,E[w],I),x!==null&&(y=i(x,y,w),F===null?O=x:F.sibling=x,F=x);return ht&&Di(b,w),O}for(x=r(b,x);w<E.length;w++)v=_(x,b,w,E[w],I),v!==null&&(t&&v.alternate!==null&&x.delete(v.key===null?w:v.key),y=i(v,y,w),F===null?O=v:F.sibling=v,F=v);return t&&x.forEach(function(D){return e(b,D)}),ht&&Di(b,w),O}function A(b,y,E,I){var O=fl(E);if(typeof O!="function")throw Error(Y(150));if(E=O.call(E),E==null)throw Error(Y(151));for(var F=O=null,x=y,w=y=0,v=null,P=E.next();x!==null&&!P.done;w++,P=E.next()){x.index>w?(v=x,x=null):v=x.sibling;var D=m(b,x,P.value,I);if(D===null){x===null&&(x=v);break}t&&x&&D.alternate===null&&e(b,x),y=i(D,y,w),F===null?O=D:F.sibling=D,F=D,x=v}if(P.done)return n(b,x),ht&&Di(b,w),O;if(x===null){for(;!P.done;w++,P=E.next())P=f(b,P.value,I),P!==null&&(y=i(P,y,w),F===null?O=P:F.sibling=P,F=P);return ht&&Di(b,w),O}for(x=r(b,x);!P.done;w++,P=E.next())P=_(x,b,w,P.value,I),P!==null&&(t&&P.alternate!==null&&x.delete(P.key===null?w:P.key),y=i(P,y,w),F===null?O=P:F.sibling=P,F=P);return t&&x.forEach(function(j){return e(b,j)}),ht&&Di(b,w),O}function N(b,y,E,I){if(typeof E=="object"&&E!==null&&E.type===Xo&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case Iu:e:{for(var O=E.key,F=y;F!==null;){if(F.key===O){if(O=E.type,O===Xo){if(F.tag===7){n(b,F.sibling),y=s(F,E.props.children),y.return=b,b=y;break e}}else if(F.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===Vs&&pw(O)===F.type){n(b,F.sibling),y=s(F,E.props),y.ref=vl(b,F,E),y.return=b,b=y;break e}n(b,F);break}else e(b,F);F=F.sibling}E.type===Xo?(y=Qi(E.props.children,b.mode,I,E.key),y.return=b,b=y):(I=cd(E.type,E.key,E.props,null,b.mode,I),I.ref=vl(b,y,E),I.return=b,b=I)}return o(b);case Yo:e:{for(F=E.key;y!==null;){if(y.key===F)if(y.tag===4&&y.stateNode.containerInfo===E.containerInfo&&y.stateNode.implementation===E.implementation){n(b,y.sibling),y=s(y,E.children||[]),y.return=b,b=y;break e}else{n(b,y);break}else e(b,y);y=y.sibling}y=yp(E,b.mode,I),y.return=b,b=y}return o(b);case Vs:return F=E._init,N(b,y,F(E._payload),I)}if(kl(E))return R(b,y,E,I);if(fl(E))return A(b,y,E,I);ju(b,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,y!==null&&y.tag===6?(n(b,y.sibling),y=s(y,E),y.return=b,b=y):(n(b,y),y=gp(E,b.mode,I),y.return=b,b=y),o(b)):n(b,y)}return N}var Ta=zb(!0),qb=zb(!1),$d=_i(null),Bd=null,ia=null,Qg=null;function Yg(){Qg=ia=Bd=null}function Xg(t){var e=$d.current;ut($d),t._currentValue=e}function Tm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function fa(t,e){Bd=t,Qg=ia=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Cn=!0),t.firstContext=null)}function or(t){var e=t._currentValue;if(Qg!==t)if(t={context:t,memoizedValue:e,next:null},ia===null){if(Bd===null)throw Error(Y(308));ia=t,Bd.dependencies={lanes:0,firstContext:t}}else ia=ia.next=t;return e}var qi=null;function Jg(t){qi===null?qi=[t]:qi.push(t)}function Hb(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Jg(e)):(n.next=s.next,s.next=n),e.interleaved=n,fs(t,r)}function fs(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ms=!1;function Zg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Wb(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ls(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ti(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,He&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,fs(t,n)}return s=r.interleaved,s===null?(e.next=e,Jg(r)):(e.next=s.next,s.next=e),r.interleaved=e,fs(t,n)}function rd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Mg(t,n)}}function mw(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function zd(t,e,n,r){var s=t.updateQueue;Ms=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=d:a.next=d,h.lastBaseUpdate=c))}if(i!==null){var f=s.baseState;o=0,h=d=c=null,a=i;do{var m=a.lane,_=a.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:_,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var R=t,A=a;switch(m=e,_=n,A.tag){case 1:if(R=A.payload,typeof R=="function"){f=R.call(_,f,m);break e}f=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=A.payload,m=typeof R=="function"?R.call(_,f,m):R,m==null)break e;f=_t({},f,m);break e;case 2:Ms=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,m=s.effects,m===null?s.effects=[a]:m.push(a))}else _={eventTime:_,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(d=h=_,c=f):h=h.next=_,o|=m;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;m=a,a=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(!0);if(h===null&&(c=f),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);io|=o,t.lanes=o,t.memoizedState=f}}function gw(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Y(191,s));s.call(r)}}}var Wc={},Hr=_i(Wc),wc=_i(Wc),Ec=_i(Wc);function Hi(t){if(t===Wc)throw Error(Y(174));return t}function ey(t,e){switch(ot(Ec,e),ot(wc,t),ot(Hr,Wc),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:im(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=im(e,t)}ut(Hr),ot(Hr,e)}function Sa(){ut(Hr),ut(wc),ut(Ec)}function Gb(t){Hi(Ec.current);var e=Hi(Hr.current),n=im(e,t.type);e!==n&&(ot(wc,t),ot(Hr,n))}function ty(t){wc.current===t&&(ut(Hr),ut(wc))}var mt=_i(0);function qd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var up=[];function ny(){for(var t=0;t<up.length;t++)up[t]._workInProgressVersionPrimary=null;up.length=0}var sd=Es.ReactCurrentDispatcher,dp=Es.ReactCurrentBatchConfig,so=0,vt=null,Mt=null,Gt=null,Hd=!1,Ql=!1,xc=0,fN=0;function nn(){throw Error(Y(321))}function ry(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ir(t[n],e[n]))return!1;return!0}function sy(t,e,n,r,s,i){if(so=i,vt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,sd.current=t===null||t.memoizedState===null?yN:vN,t=n(r,s),Ql){i=0;do{if(Ql=!1,xc=0,25<=i)throw Error(Y(301));i+=1,Gt=Mt=null,e.updateQueue=null,sd.current=_N,t=n(r,s)}while(Ql)}if(sd.current=Wd,e=Mt!==null&&Mt.next!==null,so=0,Gt=Mt=vt=null,Hd=!1,e)throw Error(Y(300));return t}function iy(){var t=xc!==0;return xc=0,t}function Mr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gt===null?vt.memoizedState=Gt=t:Gt=Gt.next=t,Gt}function ar(){if(Mt===null){var t=vt.alternate;t=t!==null?t.memoizedState:null}else t=Mt.next;var e=Gt===null?vt.memoizedState:Gt.next;if(e!==null)Gt=e,Mt=t;else{if(t===null)throw Error(Y(310));Mt=t,t={memoizedState:Mt.memoizedState,baseState:Mt.baseState,baseQueue:Mt.baseQueue,queue:Mt.queue,next:null},Gt===null?vt.memoizedState=Gt=t:Gt=Gt.next=t}return Gt}function Ic(t,e){return typeof e=="function"?e(t):e}function hp(t){var e=ar(),n=e.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=t;var r=Mt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,c=null,d=i;do{var h=d.lane;if((so&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(a=c=f,o=r):c=c.next=f,vt.lanes|=h,io|=h}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=a,Ir(r,e.memoizedState)||(Cn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,vt.lanes|=i,io|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function fp(t){var e=ar(),n=e.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);Ir(i,e.memoizedState)||(Cn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function Kb(){}function Qb(t,e){var n=vt,r=ar(),s=e(),i=!Ir(r.memoizedState,s);if(i&&(r.memoizedState=s,Cn=!0),r=r.queue,oy(Jb.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Gt!==null&&Gt.memoizedState.tag&1){if(n.flags|=2048,bc(9,Xb.bind(null,n,r,s,e),void 0,null),Kt===null)throw Error(Y(349));so&30||Yb(n,e,s)}return s}function Yb(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=vt.updateQueue,e===null?(e={lastEffect:null,stores:null},vt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Xb(t,e,n,r){e.value=n,e.getSnapshot=r,Zb(e)&&e0(t)}function Jb(t,e,n){return n(function(){Zb(e)&&e0(t)})}function Zb(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ir(t,n)}catch{return!0}}function e0(t){var e=fs(t,1);e!==null&&Er(e,t,1,-1)}function yw(t){var e=Mr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ic,lastRenderedState:t},e.queue=t,t=t.dispatch=gN.bind(null,vt,t),[e.memoizedState,t]}function bc(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=vt.updateQueue,e===null?(e={lastEffect:null,stores:null},vt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function t0(){return ar().memoizedState}function id(t,e,n,r){var s=Mr();vt.flags|=t,s.memoizedState=bc(1|e,n,void 0,r===void 0?null:r)}function Lh(t,e,n,r){var s=ar();r=r===void 0?null:r;var i=void 0;if(Mt!==null){var o=Mt.memoizedState;if(i=o.destroy,r!==null&&ry(r,o.deps)){s.memoizedState=bc(e,n,i,r);return}}vt.flags|=t,s.memoizedState=bc(1|e,n,i,r)}function vw(t,e){return id(8390656,8,t,e)}function oy(t,e){return Lh(2048,8,t,e)}function n0(t,e){return Lh(4,2,t,e)}function r0(t,e){return Lh(4,4,t,e)}function s0(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function i0(t,e,n){return n=n!=null?n.concat([t]):null,Lh(4,4,s0.bind(null,e,t),n)}function ay(){}function o0(t,e){var n=ar();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ry(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function a0(t,e){var n=ar();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ry(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function l0(t,e,n){return so&21?(Ir(n,e)||(n=fb(),vt.lanes|=n,io|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Cn=!0),t.memoizedState=n)}function pN(t,e){var n=et;et=n!==0&&4>n?n:4,t(!0);var r=dp.transition;dp.transition={};try{t(!1),e()}finally{et=n,dp.transition=r}}function c0(){return ar().memoizedState}function mN(t,e,n){var r=ri(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},u0(t))d0(e,n);else if(n=Hb(t,e,n,r),n!==null){var s=vn();Er(n,t,r,s),h0(n,e,r)}}function gN(t,e,n){var r=ri(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(u0(t))d0(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,Ir(a,o)){var c=e.interleaved;c===null?(s.next=s,Jg(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=Hb(t,e,s,r),n!==null&&(s=vn(),Er(n,t,r,s),h0(n,e,r))}}function u0(t){var e=t.alternate;return t===vt||e!==null&&e===vt}function d0(t,e){Ql=Hd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function h0(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Mg(t,n)}}var Wd={readContext:or,useCallback:nn,useContext:nn,useEffect:nn,useImperativeHandle:nn,useInsertionEffect:nn,useLayoutEffect:nn,useMemo:nn,useReducer:nn,useRef:nn,useState:nn,useDebugValue:nn,useDeferredValue:nn,useTransition:nn,useMutableSource:nn,useSyncExternalStore:nn,useId:nn,unstable_isNewReconciler:!1},yN={readContext:or,useCallback:function(t,e){return Mr().memoizedState=[t,e===void 0?null:e],t},useContext:or,useEffect:vw,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,id(4194308,4,s0.bind(null,e,t),n)},useLayoutEffect:function(t,e){return id(4194308,4,t,e)},useInsertionEffect:function(t,e){return id(4,2,t,e)},useMemo:function(t,e){var n=Mr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Mr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=mN.bind(null,vt,t),[r.memoizedState,t]},useRef:function(t){var e=Mr();return t={current:t},e.memoizedState=t},useState:yw,useDebugValue:ay,useDeferredValue:function(t){return Mr().memoizedState=t},useTransition:function(){var t=yw(!1),e=t[0];return t=pN.bind(null,t[1]),Mr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=vt,s=Mr();if(ht){if(n===void 0)throw Error(Y(407));n=n()}else{if(n=e(),Kt===null)throw Error(Y(349));so&30||Yb(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,vw(Jb.bind(null,r,i,t),[t]),r.flags|=2048,bc(9,Xb.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Mr(),e=Kt.identifierPrefix;if(ht){var n=ss,r=rs;n=(r&~(1<<32-wr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=xc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=fN++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},vN={readContext:or,useCallback:o0,useContext:or,useEffect:oy,useImperativeHandle:i0,useInsertionEffect:n0,useLayoutEffect:r0,useMemo:a0,useReducer:hp,useRef:t0,useState:function(){return hp(Ic)},useDebugValue:ay,useDeferredValue:function(t){var e=ar();return l0(e,Mt.memoizedState,t)},useTransition:function(){var t=hp(Ic)[0],e=ar().memoizedState;return[t,e]},useMutableSource:Kb,useSyncExternalStore:Qb,useId:c0,unstable_isNewReconciler:!1},_N={readContext:or,useCallback:o0,useContext:or,useEffect:oy,useImperativeHandle:i0,useInsertionEffect:n0,useLayoutEffect:r0,useMemo:a0,useReducer:fp,useRef:t0,useState:function(){return fp(Ic)},useDebugValue:ay,useDeferredValue:function(t){var e=ar();return Mt===null?e.memoizedState=t:l0(e,Mt.memoizedState,t)},useTransition:function(){var t=fp(Ic)[0],e=ar().memoizedState;return[t,e]},useMutableSource:Kb,useSyncExternalStore:Qb,useId:c0,unstable_isNewReconciler:!1};function pr(t,e){if(t&&t.defaultProps){e=_t({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Sm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:_t({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Vh={isMounted:function(t){return(t=t._reactInternals)?Io(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=vn(),s=ri(t),i=ls(r,s);i.payload=e,n!=null&&(i.callback=n),e=ti(t,i,s),e!==null&&(Er(e,t,s,r),rd(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=vn(),s=ri(t),i=ls(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ti(t,i,s),e!==null&&(Er(e,t,s,r),rd(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=vn(),r=ri(t),s=ls(n,r);s.tag=2,e!=null&&(s.callback=e),e=ti(t,s,r),e!==null&&(Er(e,t,r,n),rd(e,t,r))}};function _w(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!gc(n,r)||!gc(s,i):!0}function f0(t,e,n){var r=!1,s=hi,i=e.contextType;return typeof i=="object"&&i!==null?i=or(i):(s=Nn(e)?no:hn.current,r=e.contextTypes,i=(r=r!=null)?Ia(t,s):hi),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Vh,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function ww(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Vh.enqueueReplaceState(e,e.state,null)}function Cm(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Zg(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=or(i):(i=Nn(e)?no:hn.current,s.context=Ia(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Sm(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Vh.enqueueReplaceState(s,s.state,null),zd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ca(t,e){try{var n="",r=e;do n+=G1(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function pp(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Am(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var wN=typeof WeakMap=="function"?WeakMap:Map;function p0(t,e,n){n=ls(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Kd||(Kd=!0,Mm=r),Am(t,e)},n}function m0(t,e,n){n=ls(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Am(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Am(t,e),typeof r!="function"&&(ni===null?ni=new Set([this]):ni.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Ew(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new wN;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=jN.bind(null,t,e,n),e.then(t,t))}function xw(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Iw(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ls(-1,1),e.tag=2,ti(n,e,1))),n.lanes|=1),t)}var EN=Es.ReactCurrentOwner,Cn=!1;function pn(t,e,n,r){e.child=t===null?qb(e,null,n,r):Ta(e,t.child,n,r)}function bw(t,e,n,r,s){n=n.render;var i=e.ref;return fa(e,s),r=sy(t,e,n,r,i,s),n=iy(),t!==null&&!Cn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,ps(t,e,s)):(ht&&n&&Wg(e),e.flags|=1,pn(t,e,r,s),e.child)}function Tw(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!my(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,g0(t,e,i,r,s)):(t=cd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:gc,n(o,r)&&t.ref===e.ref)return ps(t,e,s)}return e.flags|=1,t=si(i,r),t.ref=e.ref,t.return=e,e.child=t}function g0(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(gc(i,r)&&t.ref===e.ref)if(Cn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Cn=!0);else return e.lanes=t.lanes,ps(t,e,s)}return Rm(t,e,n,r,s)}function y0(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ot(aa,Mn),Mn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ot(aa,Mn),Mn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,ot(aa,Mn),Mn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,ot(aa,Mn),Mn|=r;return pn(t,e,s,n),e.child}function v0(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Rm(t,e,n,r,s){var i=Nn(n)?no:hn.current;return i=Ia(e,i),fa(e,s),n=sy(t,e,n,r,i,s),r=iy(),t!==null&&!Cn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,ps(t,e,s)):(ht&&r&&Wg(e),e.flags|=1,pn(t,e,n,s),e.child)}function Sw(t,e,n,r,s){if(Nn(n)){var i=!0;Md(e)}else i=!1;if(fa(e,s),e.stateNode===null)od(t,e),f0(e,n,r),Cm(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=or(d):(d=Nn(n)?no:hn.current,d=Ia(e,d));var h=n.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||c!==d)&&ww(e,o,r,d),Ms=!1;var m=e.memoizedState;o.state=m,zd(e,r,o,s),c=e.memoizedState,a!==r||m!==c||Rn.current||Ms?(typeof h=="function"&&(Sm(e,n,h,r),c=e.memoizedState),(a=Ms||_w(e,n,a,r,m,c,d))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Wb(t,e),a=e.memoizedProps,d=e.type===e.elementType?a:pr(e.type,a),o.props=d,f=e.pendingProps,m=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=or(c):(c=Nn(n)?no:hn.current,c=Ia(e,c));var _=n.getDerivedStateFromProps;(h=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||m!==c)&&ww(e,o,r,c),Ms=!1,m=e.memoizedState,o.state=m,zd(e,r,o,s);var R=e.memoizedState;a!==f||m!==R||Rn.current||Ms?(typeof _=="function"&&(Sm(e,n,_,r),R=e.memoizedState),(d=Ms||_w(e,n,d,r,m,R,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,R,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,R,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=R),o.props=r,o.state=R,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),r=!1)}return Nm(t,e,n,r,i,s)}function Nm(t,e,n,r,s,i){v0(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&dw(e,n,!1),ps(t,e,i);r=e.stateNode,EN.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Ta(e,t.child,null,i),e.child=Ta(e,null,a,i)):pn(t,e,a,i),e.memoizedState=r.state,s&&dw(e,n,!0),e.child}function _0(t){var e=t.stateNode;e.pendingContext?uw(t,e.pendingContext,e.pendingContext!==e.context):e.context&&uw(t,e.context,!1),ey(t,e.containerInfo)}function Cw(t,e,n,r,s){return ba(),Kg(s),e.flags|=256,pn(t,e,n,r),e.child}var Pm={dehydrated:null,treeContext:null,retryLane:0};function km(t){return{baseLanes:t,cachePool:null,transitions:null}}function w0(t,e,n){var r=e.pendingProps,s=mt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),ot(mt,s&1),t===null)return bm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Uh(o,r,0,null),t=Qi(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=km(n),e.memoizedState=Pm,t):ly(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return xN(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=si(s,c),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=si(a,i):(i=Qi(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?km(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Pm,r}return i=t.child,t=i.sibling,r=si(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function ly(t,e){return e=Uh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ou(t,e,n,r){return r!==null&&Kg(r),Ta(e,t.child,null,n),t=ly(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function xN(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=pp(Error(Y(422))),Ou(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Uh({mode:"visible",children:r.children},s,0,null),i=Qi(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Ta(e,t.child,null,o),e.child.memoizedState=km(o),e.memoizedState=Pm,i);if(!(e.mode&1))return Ou(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(Y(419)),r=pp(i,r,void 0),Ou(t,e,o,r)}if(a=(o&t.childLanes)!==0,Cn||a){if(r=Kt,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,fs(t,s),Er(r,t,s,-1))}return py(),r=pp(Error(Y(421))),Ou(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=ON.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,$n=ei(s.nextSibling),zn=e,ht=!0,yr=null,t!==null&&(Jn[Zn++]=rs,Jn[Zn++]=ss,Jn[Zn++]=ro,rs=t.id,ss=t.overflow,ro=e),e=ly(e,r.children),e.flags|=4096,e)}function Aw(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Tm(t.return,e,n)}function mp(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function E0(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(pn(t,e,r.children,n),r=mt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Aw(t,n,e);else if(t.tag===19)Aw(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ot(mt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&qd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),mp(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&qd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}mp(e,!0,n,null,i);break;case"together":mp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function od(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ps(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),io|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Y(153));if(e.child!==null){for(t=e.child,n=si(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=si(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function IN(t,e,n){switch(e.tag){case 3:_0(e),ba();break;case 5:Gb(e);break;case 1:Nn(e.type)&&Md(e);break;case 4:ey(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;ot($d,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ot(mt,mt.current&1),e.flags|=128,null):n&e.child.childLanes?w0(t,e,n):(ot(mt,mt.current&1),t=ps(t,e,n),t!==null?t.sibling:null);ot(mt,mt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return E0(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ot(mt,mt.current),r)break;return null;case 22:case 23:return e.lanes=0,y0(t,e,n)}return ps(t,e,n)}var x0,Dm,I0,b0;x0=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Dm=function(){};I0=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Hi(Hr.current);var i=null;switch(n){case"input":s=tm(t,s),r=tm(t,r),i=[];break;case"select":s=_t({},s,{value:void 0}),r=_t({},r,{value:void 0}),i=[];break;case"textarea":s=sm(t,s),r=sm(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ld)}om(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var a=s[d];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(cc.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(a=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==a&&(c!=null||a!=null))if(d==="style")if(a){for(o in a)!a.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&a[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(cc.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&lt("scroll",t),i||a===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};b0=function(t,e,n,r){n!==r&&(e.flags|=4)};function _l(t,e){if(!ht)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function rn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function bN(t,e,n){var r=e.pendingProps;switch(Gg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rn(e),null;case 1:return Nn(e.type)&&Vd(),rn(e),null;case 3:return r=e.stateNode,Sa(),ut(Rn),ut(hn),ny(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Du(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,yr!==null&&($m(yr),yr=null))),Dm(t,e),rn(e),null;case 5:ty(e);var s=Hi(Ec.current);if(n=e.type,t!==null&&e.stateNode!=null)I0(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Y(166));return rn(e),null}if(t=Hi(Hr.current),Du(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Ur]=e,r[_c]=i,t=(e.mode&1)!==0,n){case"dialog":lt("cancel",r),lt("close",r);break;case"iframe":case"object":case"embed":lt("load",r);break;case"video":case"audio":for(s=0;s<jl.length;s++)lt(jl[s],r);break;case"source":lt("error",r);break;case"img":case"image":case"link":lt("error",r),lt("load",r);break;case"details":lt("toggle",r);break;case"input":V_(r,i),lt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},lt("invalid",r);break;case"textarea":F_(r,i),lt("invalid",r)}om(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&ku(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&ku(r.textContent,a,t),s=["children",""+a]):cc.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&lt("scroll",r)}switch(n){case"input":bu(r),M_(r,i,!0);break;case"textarea":bu(r),U_(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Ld)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=JI(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Ur]=e,t[_c]=r,x0(t,e,!1,!1),e.stateNode=t;e:{switch(o=am(n,r),n){case"dialog":lt("cancel",t),lt("close",t),s=r;break;case"iframe":case"object":case"embed":lt("load",t),s=r;break;case"video":case"audio":for(s=0;s<jl.length;s++)lt(jl[s],t);s=r;break;case"source":lt("error",t),s=r;break;case"img":case"image":case"link":lt("error",t),lt("load",t),s=r;break;case"details":lt("toggle",t),s=r;break;case"input":V_(t,r),s=tm(t,r),lt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=_t({},r,{value:void 0}),lt("invalid",t);break;case"textarea":F_(t,r),s=sm(t,r),lt("invalid",t);break;default:s=r}om(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var c=a[i];i==="style"?tb(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&ZI(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&uc(t,c):typeof c=="number"&&uc(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(cc.hasOwnProperty(i)?c!=null&&i==="onScroll"&&lt("scroll",t):c!=null&&kg(t,i,c,o))}switch(n){case"input":bu(t),M_(t,r,!1);break;case"textarea":bu(t),U_(t);break;case"option":r.value!=null&&t.setAttribute("value",""+di(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ca(t,!!r.multiple,i,!1):r.defaultValue!=null&&ca(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Ld)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return rn(e),null;case 6:if(t&&e.stateNode!=null)b0(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Y(166));if(n=Hi(Ec.current),Hi(Hr.current),Du(e)){if(r=e.stateNode,n=e.memoizedProps,r[Ur]=e,(i=r.nodeValue!==n)&&(t=zn,t!==null))switch(t.tag){case 3:ku(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ku(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Ur]=e,e.stateNode=r}return rn(e),null;case 13:if(ut(mt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ht&&$n!==null&&e.mode&1&&!(e.flags&128))Bb(),ba(),e.flags|=98560,i=!1;else if(i=Du(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Y(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Y(317));i[Ur]=e}else ba(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;rn(e),i=!1}else yr!==null&&($m(yr),yr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||mt.current&1?Ft===0&&(Ft=3):py())),e.updateQueue!==null&&(e.flags|=4),rn(e),null);case 4:return Sa(),Dm(t,e),t===null&&yc(e.stateNode.containerInfo),rn(e),null;case 10:return Xg(e.type._context),rn(e),null;case 17:return Nn(e.type)&&Vd(),rn(e),null;case 19:if(ut(mt),i=e.memoizedState,i===null)return rn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)_l(i,!1);else{if(Ft!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=qd(t),o!==null){for(e.flags|=128,_l(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ot(mt,mt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Ct()>Aa&&(e.flags|=128,r=!0,_l(i,!1),e.lanes=4194304)}else{if(!r)if(t=qd(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),_l(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!ht)return rn(e),null}else 2*Ct()-i.renderingStartTime>Aa&&n!==1073741824&&(e.flags|=128,r=!0,_l(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ct(),e.sibling=null,n=mt.current,ot(mt,r?n&1|2:n&1),e):(rn(e),null);case 22:case 23:return fy(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Mn&1073741824&&(rn(e),e.subtreeFlags&6&&(e.flags|=8192)):rn(e),null;case 24:return null;case 25:return null}throw Error(Y(156,e.tag))}function TN(t,e){switch(Gg(e),e.tag){case 1:return Nn(e.type)&&Vd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Sa(),ut(Rn),ut(hn),ny(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ty(e),null;case 13:if(ut(mt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Y(340));ba()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ut(mt),null;case 4:return Sa(),null;case 10:return Xg(e.type._context),null;case 22:case 23:return fy(),null;case 24:return null;default:return null}}var Lu=!1,an=!1,SN=typeof WeakSet=="function"?WeakSet:Set,de=null;function oa(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Et(t,e,r)}else n.current=null}function jm(t,e,n){try{n()}catch(r){Et(t,e,r)}}var Rw=!1;function CN(t,e){if(ym=Dd,t=Rb(),Hg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,c=-1,d=0,h=0,f=t,m=null;t:for(;;){for(var _;f!==n||s!==0&&f.nodeType!==3||(a=o+s),f!==i||r!==0&&f.nodeType!==3||(c=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(_=f.firstChild)!==null;)m=f,f=_;for(;;){if(f===t)break t;if(m===n&&++d===s&&(a=o),m===i&&++h===r&&(c=o),(_=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=_}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(vm={focusedElem:t,selectionRange:n},Dd=!1,de=e;de!==null;)if(e=de,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,de=t;else for(;de!==null;){e=de;try{var R=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var A=R.memoizedProps,N=R.memoizedState,b=e.stateNode,y=b.getSnapshotBeforeUpdate(e.elementType===e.type?A:pr(e.type,A),N);b.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Y(163))}}catch(I){Et(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,de=t;break}de=e.return}return R=Rw,Rw=!1,R}function Yl(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&jm(e,n,i)}s=s.next}while(s!==r)}}function Mh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Om(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function T0(t){var e=t.alternate;e!==null&&(t.alternate=null,T0(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ur],delete e[_c],delete e[Em],delete e[cN],delete e[uN])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function S0(t){return t.tag===5||t.tag===3||t.tag===4}function Nw(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||S0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Lm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ld));else if(r!==4&&(t=t.child,t!==null))for(Lm(t,e,n),t=t.sibling;t!==null;)Lm(t,e,n),t=t.sibling}function Vm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Vm(t,e,n),t=t.sibling;t!==null;)Vm(t,e,n),t=t.sibling}var Yt=null,mr=!1;function Ps(t,e,n){for(n=n.child;n!==null;)C0(t,e,n),n=n.sibling}function C0(t,e,n){if(qr&&typeof qr.onCommitFiberUnmount=="function")try{qr.onCommitFiberUnmount(Nh,n)}catch{}switch(n.tag){case 5:an||oa(n,e);case 6:var r=Yt,s=mr;Yt=null,Ps(t,e,n),Yt=r,mr=s,Yt!==null&&(mr?(t=Yt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Yt.removeChild(n.stateNode));break;case 18:Yt!==null&&(mr?(t=Yt,n=n.stateNode,t.nodeType===8?lp(t.parentNode,n):t.nodeType===1&&lp(t,n),pc(t)):lp(Yt,n.stateNode));break;case 4:r=Yt,s=mr,Yt=n.stateNode.containerInfo,mr=!0,Ps(t,e,n),Yt=r,mr=s;break;case 0:case 11:case 14:case 15:if(!an&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&jm(n,e,o),s=s.next}while(s!==r)}Ps(t,e,n);break;case 1:if(!an&&(oa(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Et(n,e,a)}Ps(t,e,n);break;case 21:Ps(t,e,n);break;case 22:n.mode&1?(an=(r=an)||n.memoizedState!==null,Ps(t,e,n),an=r):Ps(t,e,n);break;default:Ps(t,e,n)}}function Pw(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new SN),e.forEach(function(r){var s=LN.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function fr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Yt=a.stateNode,mr=!1;break e;case 3:Yt=a.stateNode.containerInfo,mr=!0;break e;case 4:Yt=a.stateNode.containerInfo,mr=!0;break e}a=a.return}if(Yt===null)throw Error(Y(160));C0(i,o,s),Yt=null,mr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Et(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)A0(e,t),e=e.sibling}function A0(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(fr(e,t),Or(t),r&4){try{Yl(3,t,t.return),Mh(3,t)}catch(A){Et(t,t.return,A)}try{Yl(5,t,t.return)}catch(A){Et(t,t.return,A)}}break;case 1:fr(e,t),Or(t),r&512&&n!==null&&oa(n,n.return);break;case 5:if(fr(e,t),Or(t),r&512&&n!==null&&oa(n,n.return),t.flags&32){var s=t.stateNode;try{uc(s,"")}catch(A){Et(t,t.return,A)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&YI(s,i),am(a,o);var d=am(a,i);for(o=0;o<c.length;o+=2){var h=c[o],f=c[o+1];h==="style"?tb(s,f):h==="dangerouslySetInnerHTML"?ZI(s,f):h==="children"?uc(s,f):kg(s,h,f,d)}switch(a){case"input":nm(s,i);break;case"textarea":XI(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var _=i.value;_!=null?ca(s,!!i.multiple,_,!1):m!==!!i.multiple&&(i.defaultValue!=null?ca(s,!!i.multiple,i.defaultValue,!0):ca(s,!!i.multiple,i.multiple?[]:"",!1))}s[_c]=i}catch(A){Et(t,t.return,A)}}break;case 6:if(fr(e,t),Or(t),r&4){if(t.stateNode===null)throw Error(Y(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(A){Et(t,t.return,A)}}break;case 3:if(fr(e,t),Or(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{pc(e.containerInfo)}catch(A){Et(t,t.return,A)}break;case 4:fr(e,t),Or(t);break;case 13:fr(e,t),Or(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(dy=Ct())),r&4&&Pw(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(an=(d=an)||h,fr(e,t),an=d):fr(e,t),Or(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(de=t,h=t.child;h!==null;){for(f=de=h;de!==null;){switch(m=de,_=m.child,m.tag){case 0:case 11:case 14:case 15:Yl(4,m,m.return);break;case 1:oa(m,m.return);var R=m.stateNode;if(typeof R.componentWillUnmount=="function"){r=m,n=m.return;try{e=r,R.props=e.memoizedProps,R.state=e.memoizedState,R.componentWillUnmount()}catch(A){Et(r,n,A)}}break;case 5:oa(m,m.return);break;case 22:if(m.memoizedState!==null){Dw(f);continue}}_!==null?(_.return=m,de=_):Dw(f)}h=h.sibling}e:for(h=null,f=t;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=eb("display",o))}catch(A){Et(t,t.return,A)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(A){Et(t,t.return,A)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:fr(e,t),Or(t),r&4&&Pw(t);break;case 21:break;default:fr(e,t),Or(t)}}function Or(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(S0(n)){var r=n;break e}n=n.return}throw Error(Y(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(uc(s,""),r.flags&=-33);var i=Nw(t);Vm(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Nw(t);Lm(t,a,o);break;default:throw Error(Y(161))}}catch(c){Et(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function AN(t,e,n){de=t,R0(t)}function R0(t,e,n){for(var r=(t.mode&1)!==0;de!==null;){var s=de,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Lu;if(!o){var a=s.alternate,c=a!==null&&a.memoizedState!==null||an;a=Lu;var d=an;if(Lu=o,(an=c)&&!d)for(de=s;de!==null;)o=de,c=o.child,o.tag===22&&o.memoizedState!==null?jw(s):c!==null?(c.return=o,de=c):jw(s);for(;i!==null;)de=i,R0(i),i=i.sibling;de=s,Lu=a,an=d}kw(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,de=i):kw(t)}}function kw(t){for(;de!==null;){var e=de;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:an||Mh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!an)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:pr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&gw(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}gw(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&pc(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Y(163))}an||e.flags&512&&Om(e)}catch(m){Et(e,e.return,m)}}if(e===t){de=null;break}if(n=e.sibling,n!==null){n.return=e.return,de=n;break}de=e.return}}function Dw(t){for(;de!==null;){var e=de;if(e===t){de=null;break}var n=e.sibling;if(n!==null){n.return=e.return,de=n;break}de=e.return}}function jw(t){for(;de!==null;){var e=de;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Mh(4,e)}catch(c){Et(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Et(e,s,c)}}var i=e.return;try{Om(e)}catch(c){Et(e,i,c)}break;case 5:var o=e.return;try{Om(e)}catch(c){Et(e,o,c)}}}catch(c){Et(e,e.return,c)}if(e===t){de=null;break}var a=e.sibling;if(a!==null){a.return=e.return,de=a;break}de=e.return}}var RN=Math.ceil,Gd=Es.ReactCurrentDispatcher,cy=Es.ReactCurrentOwner,sr=Es.ReactCurrentBatchConfig,He=0,Kt=null,jt=null,Zt=0,Mn=0,aa=_i(0),Ft=0,Tc=null,io=0,Fh=0,uy=0,Xl=null,Sn=null,dy=0,Aa=1/0,ts=null,Kd=!1,Mm=null,ni=null,Vu=!1,Qs=null,Qd=0,Jl=0,Fm=null,ad=-1,ld=0;function vn(){return He&6?Ct():ad!==-1?ad:ad=Ct()}function ri(t){return t.mode&1?He&2&&Zt!==0?Zt&-Zt:hN.transition!==null?(ld===0&&(ld=fb()),ld):(t=et,t!==0||(t=window.event,t=t===void 0?16:wb(t.type)),t):1}function Er(t,e,n,r){if(50<Jl)throw Jl=0,Fm=null,Error(Y(185));zc(t,n,r),(!(He&2)||t!==Kt)&&(t===Kt&&(!(He&2)&&(Fh|=n),Ft===4&&Us(t,Zt)),Pn(t,r),n===1&&He===0&&!(e.mode&1)&&(Aa=Ct()+500,Oh&&wi()))}function Pn(t,e){var n=t.callbackNode;hR(t,e);var r=kd(t,t===Kt?Zt:0);if(r===0)n!==null&&z_(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&z_(n),e===1)t.tag===0?dN(Ow.bind(null,t)):Fb(Ow.bind(null,t)),aN(function(){!(He&6)&&wi()}),n=null;else{switch(pb(r)){case 1:n=Vg;break;case 4:n=db;break;case 16:n=Pd;break;case 536870912:n=hb;break;default:n=Pd}n=V0(n,N0.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function N0(t,e){if(ad=-1,ld=0,He&6)throw Error(Y(327));var n=t.callbackNode;if(pa()&&t.callbackNode!==n)return null;var r=kd(t,t===Kt?Zt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Yd(t,r);else{e=r;var s=He;He|=2;var i=k0();(Kt!==t||Zt!==e)&&(ts=null,Aa=Ct()+500,Ki(t,e));do try{kN();break}catch(a){P0(t,a)}while(!0);Yg(),Gd.current=i,He=s,jt!==null?e=0:(Kt=null,Zt=0,e=Ft)}if(e!==0){if(e===2&&(s=hm(t),s!==0&&(r=s,e=Um(t,s))),e===1)throw n=Tc,Ki(t,0),Us(t,r),Pn(t,Ct()),n;if(e===6)Us(t,r);else{if(s=t.current.alternate,!(r&30)&&!NN(s)&&(e=Yd(t,r),e===2&&(i=hm(t),i!==0&&(r=i,e=Um(t,i))),e===1))throw n=Tc,Ki(t,0),Us(t,r),Pn(t,Ct()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Y(345));case 2:ji(t,Sn,ts);break;case 3:if(Us(t,r),(r&130023424)===r&&(e=dy+500-Ct(),10<e)){if(kd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){vn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=wm(ji.bind(null,t,Sn,ts),e);break}ji(t,Sn,ts);break;case 4:if(Us(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-wr(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ct()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*RN(r/1960))-r,10<r){t.timeoutHandle=wm(ji.bind(null,t,Sn,ts),r);break}ji(t,Sn,ts);break;case 5:ji(t,Sn,ts);break;default:throw Error(Y(329))}}}return Pn(t,Ct()),t.callbackNode===n?N0.bind(null,t):null}function Um(t,e){var n=Xl;return t.current.memoizedState.isDehydrated&&(Ki(t,e).flags|=256),t=Yd(t,e),t!==2&&(e=Sn,Sn=n,e!==null&&$m(e)),t}function $m(t){Sn===null?Sn=t:Sn.push.apply(Sn,t)}function NN(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Ir(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Us(t,e){for(e&=~uy,e&=~Fh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-wr(e),r=1<<n;t[n]=-1,e&=~r}}function Ow(t){if(He&6)throw Error(Y(327));pa();var e=kd(t,0);if(!(e&1))return Pn(t,Ct()),null;var n=Yd(t,e);if(t.tag!==0&&n===2){var r=hm(t);r!==0&&(e=r,n=Um(t,r))}if(n===1)throw n=Tc,Ki(t,0),Us(t,e),Pn(t,Ct()),n;if(n===6)throw Error(Y(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ji(t,Sn,ts),Pn(t,Ct()),null}function hy(t,e){var n=He;He|=1;try{return t(e)}finally{He=n,He===0&&(Aa=Ct()+500,Oh&&wi())}}function oo(t){Qs!==null&&Qs.tag===0&&!(He&6)&&pa();var e=He;He|=1;var n=sr.transition,r=et;try{if(sr.transition=null,et=1,t)return t()}finally{et=r,sr.transition=n,He=e,!(He&6)&&wi()}}function fy(){Mn=aa.current,ut(aa)}function Ki(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,oN(n)),jt!==null)for(n=jt.return;n!==null;){var r=n;switch(Gg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Vd();break;case 3:Sa(),ut(Rn),ut(hn),ny();break;case 5:ty(r);break;case 4:Sa();break;case 13:ut(mt);break;case 19:ut(mt);break;case 10:Xg(r.type._context);break;case 22:case 23:fy()}n=n.return}if(Kt=t,jt=t=si(t.current,null),Zt=Mn=e,Ft=0,Tc=null,uy=Fh=io=0,Sn=Xl=null,qi!==null){for(e=0;e<qi.length;e++)if(n=qi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}qi=null}return t}function P0(t,e){do{var n=jt;try{if(Yg(),sd.current=Wd,Hd){for(var r=vt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Hd=!1}if(so=0,Gt=Mt=vt=null,Ql=!1,xc=0,cy.current=null,n===null||n.return===null){Ft=1,Tc=e,jt=null;break}e:{var i=t,o=n.return,a=n,c=e;if(e=Zt,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=a,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var _=xw(o);if(_!==null){_.flags&=-257,Iw(_,o,a,i,e),_.mode&1&&Ew(i,d,e),e=_,c=d;var R=e.updateQueue;if(R===null){var A=new Set;A.add(c),e.updateQueue=A}else R.add(c);break e}else{if(!(e&1)){Ew(i,d,e),py();break e}c=Error(Y(426))}}else if(ht&&a.mode&1){var N=xw(o);if(N!==null){!(N.flags&65536)&&(N.flags|=256),Iw(N,o,a,i,e),Kg(Ca(c,a));break e}}i=c=Ca(c,a),Ft!==4&&(Ft=2),Xl===null?Xl=[i]:Xl.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var b=p0(i,c,e);mw(i,b);break e;case 1:a=c;var y=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ni===null||!ni.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var I=m0(i,a,e);mw(i,I);break e}}i=i.return}while(i!==null)}j0(n)}catch(O){e=O,jt===n&&n!==null&&(jt=n=n.return);continue}break}while(!0)}function k0(){var t=Gd.current;return Gd.current=Wd,t===null?Wd:t}function py(){(Ft===0||Ft===3||Ft===2)&&(Ft=4),Kt===null||!(io&268435455)&&!(Fh&268435455)||Us(Kt,Zt)}function Yd(t,e){var n=He;He|=2;var r=k0();(Kt!==t||Zt!==e)&&(ts=null,Ki(t,e));do try{PN();break}catch(s){P0(t,s)}while(!0);if(Yg(),He=n,Gd.current=r,jt!==null)throw Error(Y(261));return Kt=null,Zt=0,Ft}function PN(){for(;jt!==null;)D0(jt)}function kN(){for(;jt!==null&&!rR();)D0(jt)}function D0(t){var e=L0(t.alternate,t,Mn);t.memoizedProps=t.pendingProps,e===null?j0(t):jt=e,cy.current=null}function j0(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=TN(n,e),n!==null){n.flags&=32767,jt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ft=6,jt=null;return}}else if(n=bN(n,e,Mn),n!==null){jt=n;return}if(e=e.sibling,e!==null){jt=e;return}jt=e=t}while(e!==null);Ft===0&&(Ft=5)}function ji(t,e,n){var r=et,s=sr.transition;try{sr.transition=null,et=1,DN(t,e,n,r)}finally{sr.transition=s,et=r}return null}function DN(t,e,n,r){do pa();while(Qs!==null);if(He&6)throw Error(Y(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Y(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(fR(t,i),t===Kt&&(jt=Kt=null,Zt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Vu||(Vu=!0,V0(Pd,function(){return pa(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=sr.transition,sr.transition=null;var o=et;et=1;var a=He;He|=4,cy.current=null,CN(t,n),A0(n,t),ZR(vm),Dd=!!ym,vm=ym=null,t.current=n,AN(n),sR(),He=a,et=o,sr.transition=i}else t.current=n;if(Vu&&(Vu=!1,Qs=t,Qd=s),i=t.pendingLanes,i===0&&(ni=null),aR(n.stateNode),Pn(t,Ct()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Kd)throw Kd=!1,t=Mm,Mm=null,t;return Qd&1&&t.tag!==0&&pa(),i=t.pendingLanes,i&1?t===Fm?Jl++:(Jl=0,Fm=t):Jl=0,wi(),null}function pa(){if(Qs!==null){var t=pb(Qd),e=sr.transition,n=et;try{if(sr.transition=null,et=16>t?16:t,Qs===null)var r=!1;else{if(t=Qs,Qs=null,Qd=0,He&6)throw Error(Y(331));var s=He;for(He|=4,de=t.current;de!==null;){var i=de,o=i.child;if(de.flags&16){var a=i.deletions;if(a!==null){for(var c=0;c<a.length;c++){var d=a[c];for(de=d;de!==null;){var h=de;switch(h.tag){case 0:case 11:case 15:Yl(8,h,i)}var f=h.child;if(f!==null)f.return=h,de=f;else for(;de!==null;){h=de;var m=h.sibling,_=h.return;if(T0(h),h===d){de=null;break}if(m!==null){m.return=_,de=m;break}de=_}}}var R=i.alternate;if(R!==null){var A=R.child;if(A!==null){R.child=null;do{var N=A.sibling;A.sibling=null,A=N}while(A!==null)}}de=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,de=o;else e:for(;de!==null;){if(i=de,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Yl(9,i,i.return)}var b=i.sibling;if(b!==null){b.return=i.return,de=b;break e}de=i.return}}var y=t.current;for(de=y;de!==null;){o=de;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,de=E;else e:for(o=y;de!==null;){if(a=de,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Mh(9,a)}}catch(O){Et(a,a.return,O)}if(a===o){de=null;break e}var I=a.sibling;if(I!==null){I.return=a.return,de=I;break e}de=a.return}}if(He=s,wi(),qr&&typeof qr.onPostCommitFiberRoot=="function")try{qr.onPostCommitFiberRoot(Nh,t)}catch{}r=!0}return r}finally{et=n,sr.transition=e}}return!1}function Lw(t,e,n){e=Ca(n,e),e=p0(t,e,1),t=ti(t,e,1),e=vn(),t!==null&&(zc(t,1,e),Pn(t,e))}function Et(t,e,n){if(t.tag===3)Lw(t,t,n);else for(;e!==null;){if(e.tag===3){Lw(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ni===null||!ni.has(r))){t=Ca(n,t),t=m0(e,t,1),e=ti(e,t,1),t=vn(),e!==null&&(zc(e,1,t),Pn(e,t));break}}e=e.return}}function jN(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=vn(),t.pingedLanes|=t.suspendedLanes&n,Kt===t&&(Zt&n)===n&&(Ft===4||Ft===3&&(Zt&130023424)===Zt&&500>Ct()-dy?Ki(t,0):uy|=n),Pn(t,e)}function O0(t,e){e===0&&(t.mode&1?(e=Cu,Cu<<=1,!(Cu&130023424)&&(Cu=4194304)):e=1);var n=vn();t=fs(t,e),t!==null&&(zc(t,e,n),Pn(t,n))}function ON(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),O0(t,n)}function LN(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Y(314))}r!==null&&r.delete(e),O0(t,n)}var L0;L0=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Rn.current)Cn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Cn=!1,IN(t,e,n);Cn=!!(t.flags&131072)}else Cn=!1,ht&&e.flags&1048576&&Ub(e,Ud,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;od(t,e),t=e.pendingProps;var s=Ia(e,hn.current);fa(e,n),s=sy(null,e,r,t,s,n);var i=iy();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Nn(r)?(i=!0,Md(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Zg(e),s.updater=Vh,e.stateNode=s,s._reactInternals=e,Cm(e,r,t,n),e=Nm(null,e,r,!0,i,n)):(e.tag=0,ht&&i&&Wg(e),pn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(od(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=MN(r),t=pr(r,t),s){case 0:e=Rm(null,e,r,t,n);break e;case 1:e=Sw(null,e,r,t,n);break e;case 11:e=bw(null,e,r,t,n);break e;case 14:e=Tw(null,e,r,pr(r.type,t),n);break e}throw Error(Y(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:pr(r,s),Rm(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:pr(r,s),Sw(t,e,r,s,n);case 3:e:{if(_0(e),t===null)throw Error(Y(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Wb(t,e),zd(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ca(Error(Y(423)),e),e=Cw(t,e,r,n,s);break e}else if(r!==s){s=Ca(Error(Y(424)),e),e=Cw(t,e,r,n,s);break e}else for($n=ei(e.stateNode.containerInfo.firstChild),zn=e,ht=!0,yr=null,n=qb(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ba(),r===s){e=ps(t,e,n);break e}pn(t,e,r,n)}e=e.child}return e;case 5:return Gb(e),t===null&&bm(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,_m(r,s)?o=null:i!==null&&_m(r,i)&&(e.flags|=32),v0(t,e),pn(t,e,o,n),e.child;case 6:return t===null&&bm(e),null;case 13:return w0(t,e,n);case 4:return ey(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ta(e,null,r,n):pn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:pr(r,s),bw(t,e,r,s,n);case 7:return pn(t,e,e.pendingProps,n),e.child;case 8:return pn(t,e,e.pendingProps.children,n),e.child;case 12:return pn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,ot($d,r._currentValue),r._currentValue=o,i!==null)if(Ir(i.value,o)){if(i.children===s.children&&!Rn.current){e=ps(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=ls(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Tm(i.return,n,e),a.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Y(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Tm(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}pn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,fa(e,n),s=or(s),r=r(s),e.flags|=1,pn(t,e,r,n),e.child;case 14:return r=e.type,s=pr(r,e.pendingProps),s=pr(r.type,s),Tw(t,e,r,s,n);case 15:return g0(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:pr(r,s),od(t,e),e.tag=1,Nn(r)?(t=!0,Md(e)):t=!1,fa(e,n),f0(e,r,s),Cm(e,r,s,n),Nm(null,e,r,!0,t,n);case 19:return E0(t,e,n);case 22:return y0(t,e,n)}throw Error(Y(156,e.tag))};function V0(t,e){return ub(t,e)}function VN(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nr(t,e,n,r){return new VN(t,e,n,r)}function my(t){return t=t.prototype,!(!t||!t.isReactComponent)}function MN(t){if(typeof t=="function")return my(t)?1:0;if(t!=null){if(t=t.$$typeof,t===jg)return 11;if(t===Og)return 14}return 2}function si(t,e){var n=t.alternate;return n===null?(n=nr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function cd(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")my(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Xo:return Qi(n.children,s,i,e);case Dg:o=8,s|=8;break;case Xp:return t=nr(12,n,e,s|2),t.elementType=Xp,t.lanes=i,t;case Jp:return t=nr(13,n,e,s),t.elementType=Jp,t.lanes=i,t;case Zp:return t=nr(19,n,e,s),t.elementType=Zp,t.lanes=i,t;case GI:return Uh(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case HI:o=10;break e;case WI:o=9;break e;case jg:o=11;break e;case Og:o=14;break e;case Vs:o=16,r=null;break e}throw Error(Y(130,t==null?t:typeof t,""))}return e=nr(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Qi(t,e,n,r){return t=nr(7,t,r,e),t.lanes=n,t}function Uh(t,e,n,r){return t=nr(22,t,r,e),t.elementType=GI,t.lanes=n,t.stateNode={isHidden:!1},t}function gp(t,e,n){return t=nr(6,t,null,e),t.lanes=n,t}function yp(t,e,n){return e=nr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function FN(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xf(0),this.expirationTimes=Xf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function gy(t,e,n,r,s,i,o,a,c){return t=new FN(t,e,n,a,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=nr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Zg(i),t}function UN(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Yo,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function M0(t){if(!t)return hi;t=t._reactInternals;e:{if(Io(t)!==t||t.tag!==1)throw Error(Y(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Nn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Y(171))}if(t.tag===1){var n=t.type;if(Nn(n))return Mb(t,n,e)}return e}function F0(t,e,n,r,s,i,o,a,c){return t=gy(n,r,!0,t,s,i,o,a,c),t.context=M0(null),n=t.current,r=vn(),s=ri(n),i=ls(r,s),i.callback=e??null,ti(n,i,s),t.current.lanes=s,zc(t,s,r),Pn(t,r),t}function $h(t,e,n,r){var s=e.current,i=vn(),o=ri(s);return n=M0(n),e.context===null?e.context=n:e.pendingContext=n,e=ls(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ti(s,e,o),t!==null&&(Er(t,s,o,i),rd(t,s,o)),o}function Xd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Vw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function yy(t,e){Vw(t,e),(t=t.alternate)&&Vw(t,e)}function $N(){return null}var U0=typeof reportError=="function"?reportError:function(t){console.error(t)};function vy(t){this._internalRoot=t}Bh.prototype.render=vy.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Y(409));$h(t,e,null,null)};Bh.prototype.unmount=vy.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;oo(function(){$h(null,t,null,null)}),e[hs]=null}};function Bh(t){this._internalRoot=t}Bh.prototype.unstable_scheduleHydration=function(t){if(t){var e=yb();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Fs.length&&e!==0&&e<Fs[n].priority;n++);Fs.splice(n,0,t),n===0&&_b(t)}};function _y(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function zh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Mw(){}function BN(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Xd(o);i.call(d)}}var o=F0(e,r,t,0,null,!1,!1,"",Mw);return t._reactRootContainer=o,t[hs]=o.current,yc(t.nodeType===8?t.parentNode:t),oo(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var d=Xd(c);a.call(d)}}var c=gy(t,0,!1,null,null,!1,!1,"",Mw);return t._reactRootContainer=c,t[hs]=c.current,yc(t.nodeType===8?t.parentNode:t),oo(function(){$h(e,c,n,r)}),c}function qh(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var c=Xd(o);a.call(c)}}$h(e,o,t,s)}else o=BN(n,e,t,s,r);return Xd(o)}mb=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Dl(e.pendingLanes);n!==0&&(Mg(e,n|1),Pn(e,Ct()),!(He&6)&&(Aa=Ct()+500,wi()))}break;case 13:oo(function(){var r=fs(t,1);if(r!==null){var s=vn();Er(r,t,1,s)}}),yy(t,1)}};Fg=function(t){if(t.tag===13){var e=fs(t,134217728);if(e!==null){var n=vn();Er(e,t,134217728,n)}yy(t,134217728)}};gb=function(t){if(t.tag===13){var e=ri(t),n=fs(t,e);if(n!==null){var r=vn();Er(n,t,e,r)}yy(t,e)}};yb=function(){return et};vb=function(t,e){var n=et;try{return et=t,e()}finally{et=n}};cm=function(t,e,n){switch(e){case"input":if(nm(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=jh(r);if(!s)throw Error(Y(90));QI(r),nm(r,s)}}}break;case"textarea":XI(t,n);break;case"select":e=n.value,e!=null&&ca(t,!!n.multiple,e,!1)}};sb=hy;ib=oo;var zN={usingClientEntryPoint:!1,Events:[Hc,ta,jh,nb,rb,hy]},wl={findFiberByHostInstance:zi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qN={bundleType:wl.bundleType,version:wl.version,rendererPackageName:wl.rendererPackageName,rendererConfig:wl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Es.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=lb(t),t===null?null:t.stateNode},findFiberByHostInstance:wl.findFiberByHostInstance||$N,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mu.isDisabled&&Mu.supportsFiber)try{Nh=Mu.inject(qN),qr=Mu}catch{}}Gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zN;Gn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_y(e))throw Error(Y(200));return UN(t,e,null,n)};Gn.createRoot=function(t,e){if(!_y(t))throw Error(Y(299));var n=!1,r="",s=U0;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=gy(t,1,!1,null,null,n,!1,r,s),t[hs]=e.current,yc(t.nodeType===8?t.parentNode:t),new vy(e)};Gn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Y(188)):(t=Object.keys(t).join(","),Error(Y(268,t)));return t=lb(e),t=t===null?null:t.stateNode,t};Gn.flushSync=function(t){return oo(t)};Gn.hydrate=function(t,e,n){if(!zh(e))throw Error(Y(200));return qh(null,t,e,!0,n)};Gn.hydrateRoot=function(t,e,n){if(!_y(t))throw Error(Y(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=U0;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=F0(e,null,t,1,n??null,s,!1,i,o),t[hs]=e.current,yc(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Bh(e)};Gn.render=function(t,e,n){if(!zh(e))throw Error(Y(200));return qh(null,t,e,!1,n)};Gn.unmountComponentAtNode=function(t){if(!zh(t))throw Error(Y(40));return t._reactRootContainer?(oo(function(){qh(null,null,t,!1,function(){t._reactRootContainer=null,t[hs]=null})}),!0):!1};Gn.unstable_batchedUpdates=hy;Gn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!zh(n))throw Error(Y(200));if(t==null||t._reactInternals===void 0)throw Error(Y(38));return qh(t,e,n,!1,r)};Gn.version="18.3.1-next-f1338f8080-20240426";function $0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE($0)}catch(t){console.error(t)}}$0(),$I.exports=Gn;var HN=$I.exports,B0,Fw=HN;B0=Fw.createRoot,Fw.hydrateRoot;/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Uw="popstate";function WN(t={}){function e(r,s){let{pathname:i,search:o,hash:a}=r.location;return Bm("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Sc(s)}return KN(e,n,null,t)}function ft(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function lr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function GN(){return Math.random().toString(36).substring(2,10)}function $w(t,e){return{usr:t.state,key:t.key,idx:e}}function Bm(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Ga(e):e,state:n,key:e&&e.key||r||GN()}}function Sc({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ga(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function KN(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",c=null,d=h();d==null&&(d=0,o.replaceState({...o.state,idx:d},""));function h(){return(o.state||{idx:null}).idx}function f(){a="POP";let N=h(),b=N==null?null:N-d;d=N,c&&c({action:a,location:A.location,delta:b})}function m(N,b){a="PUSH";let y=Bm(A.location,N,b);d=h()+1;let E=$w(y,d),I=A.createHref(y);try{o.pushState(E,"",I)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;s.location.assign(I)}i&&c&&c({action:a,location:A.location,delta:1})}function _(N,b){a="REPLACE";let y=Bm(A.location,N,b);d=h();let E=$w(y,d),I=A.createHref(y);o.replaceState(E,"",I),i&&c&&c({action:a,location:A.location,delta:0})}function R(N){return QN(N)}let A={get action(){return a},get location(){return t(s,o)},listen(N){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(Uw,f),c=N,()=>{s.removeEventListener(Uw,f),c=null}},createHref(N){return e(s,N)},createURL:R,encodeLocation(N){let b=R(N);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:m,replace:_,go(N){return o.go(N)}};return A}function QN(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),ft(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Sc(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function z0(t,e,n="/"){return YN(t,e,n,!1)}function YN(t,e,n,r){let s=typeof e=="string"?Ga(e):e,i=ms(s.pathname||"/",n);if(i==null)return null;let o=q0(t);XN(o);let a=null;for(let c=0;a==null&&c<o.length;++c){let d=lP(i);a=oP(o[c],d,r)}return a}function q0(t,e=[],n=[],r="",s=!1){let i=(o,a,c=s,d)=>{let h={relativePath:d===void 0?o.path||"":d,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(r)&&c)return;ft(h.relativePath.startsWith(r),`Absolute route path "${h.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(r.length)}let f=cs([r,h.relativePath]),m=n.concat(h);o.children&&o.children.length>0&&(ft(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),q0(o.children,e,m,f,c)),!(o.path==null&&!o.index)&&e.push({path:f,score:sP(f,o.index),routesMeta:m})};return t.forEach((o,a)=>{var c;if(o.path===""||!((c=o.path)!=null&&c.includes("?")))i(o,a);else for(let d of H0(o.path))i(o,a,!0,d)}),e}function H0(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=H0(r.join("/")),a=[];return a.push(...o.map(c=>c===""?i:[i,c].join("/"))),s&&a.push(...o),a.map(c=>t.startsWith("/")&&c===""?"/":c)}function XN(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:iP(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var JN=/^:[\w-]+$/,ZN=3,eP=2,tP=1,nP=10,rP=-2,Bw=t=>t==="*";function sP(t,e){let n=t.split("/"),r=n.length;return n.some(Bw)&&(r+=rP),e&&(r+=eP),n.filter(s=>!Bw(s)).reduce((s,i)=>s+(JN.test(i)?ZN:i===""?tP:nP),r)}function iP(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function oP(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let a=0;a<r.length;++a){let c=r[a],d=a===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",f=Jd({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),m=c.route;if(!f&&d&&n&&!r[r.length-1].route.index&&(f=Jd({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!f)return null;Object.assign(s,f.params),o.push({params:s,pathname:cs([i,f.pathname]),pathnameBase:fP(cs([i,f.pathnameBase])),route:m}),f.pathnameBase!=="/"&&(i=cs([i,f.pathnameBase]))}return o}function Jd(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=aP(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((d,{paramName:h,isOptional:f},m)=>{if(h==="*"){let R=a[m]||"";o=i.slice(0,i.length-R.length).replace(/(.)\/+$/,"$1")}const _=a[m];return f&&!_?d[h]=void 0:d[h]=(_||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:t}}function aP(t,e=!1,n=!0){lr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(r.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function lP(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return lr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function ms(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var cP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,uP=t=>cP.test(t);function dP(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Ga(t):t,i;if(n)if(uP(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),lr(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=zw(n.substring(1),"/"):i=zw(n,e)}else i=e;return{pathname:i,search:pP(r),hash:mP(s)}}function zw(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function vp(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function hP(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function wy(t){let e=hP(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Ey(t,e,n,r=!1){let s;typeof t=="string"?s=Ga(t):(s={...t},ft(!s.pathname||!s.pathname.includes("?"),vp("?","pathname","search",s)),ft(!s.pathname||!s.pathname.includes("#"),vp("#","pathname","hash",s)),ft(!s.search||!s.search.includes("#"),vp("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),f-=1;s.pathname=m.join("/")}a=f>=0?e[f]:"/"}let c=dP(s,a),d=o&&o!=="/"&&o.endsWith("/"),h=(i||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}var cs=t=>t.join("/").replace(/\/\/+/g,"/"),fP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),pP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,mP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function gP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var W0=["POST","PUT","PATCH","DELETE"];new Set(W0);var yP=["GET",...W0];new Set(yP);var Ka=C.createContext(null);Ka.displayName="DataRouter";var Hh=C.createContext(null);Hh.displayName="DataRouterState";C.createContext(!1);var G0=C.createContext({isTransitioning:!1});G0.displayName="ViewTransition";var vP=C.createContext(new Map);vP.displayName="Fetchers";var _P=C.createContext(null);_P.displayName="Await";var Cr=C.createContext(null);Cr.displayName="Navigation";var Gc=C.createContext(null);Gc.displayName="Location";var Ar=C.createContext({outlet:null,matches:[],isDataRoute:!1});Ar.displayName="Route";var xy=C.createContext(null);xy.displayName="RouteError";function wP(t,{relative:e}={}){ft(Qa(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=C.useContext(Cr),{hash:s,pathname:i,search:o}=Kc(t,{relative:e}),a=i;return n!=="/"&&(a=i==="/"?n:cs([n,i])),r.createHref({pathname:a,search:o,hash:s})}function Qa(){return C.useContext(Gc)!=null}function Dn(){return ft(Qa(),"useLocation() may be used only in the context of a <Router> component."),C.useContext(Gc).location}var K0="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Q0(t){C.useContext(Cr).static||C.useLayoutEffect(t)}function xs(){let{isDataRoute:t}=C.useContext(Ar);return t?jP():EP()}function EP(){ft(Qa(),"useNavigate() may be used only in the context of a <Router> component.");let t=C.useContext(Ka),{basename:e,navigator:n}=C.useContext(Cr),{matches:r}=C.useContext(Ar),{pathname:s}=Dn(),i=JSON.stringify(wy(r)),o=C.useRef(!1);return Q0(()=>{o.current=!0}),C.useCallback((c,d={})=>{if(lr(o.current,K0),!o.current)return;if(typeof c=="number"){n.go(c);return}let h=Ey(c,JSON.parse(i),s,d.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:cs([e,h.pathname])),(d.replace?n.replace:n.push)(h,d.state,d)},[e,n,i,s,t])}C.createContext(null);function xP(){let{matches:t}=C.useContext(Ar),e=t[t.length-1];return e?e.params:{}}function Kc(t,{relative:e}={}){let{matches:n}=C.useContext(Ar),{pathname:r}=Dn(),s=JSON.stringify(wy(n));return C.useMemo(()=>Ey(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function IP(t,e){return Y0(t,e)}function Y0(t,e,n,r,s){var y;ft(Qa(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=C.useContext(Cr),{matches:o}=C.useContext(Ar),a=o[o.length-1],c=a?a.params:{},d=a?a.pathname:"/",h=a?a.pathnameBase:"/",f=a&&a.route;{let E=f&&f.path||"";X0(d,!f||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let m=Dn(),_;if(e){let E=typeof e=="string"?Ga(e):e;ft(h==="/"||((y=E.pathname)==null?void 0:y.startsWith(h)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${E.pathname}" was given in the \`location\` prop.`),_=E}else _=m;let R=_.pathname||"/",A=R;if(h!=="/"){let E=h.replace(/^\//,"").split("/");A="/"+R.replace(/^\//,"").split("/").slice(E.length).join("/")}let N=z0(t,{pathname:A});lr(f||N!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),lr(N==null||N[N.length-1].route.element!==void 0||N[N.length-1].route.Component!==void 0||N[N.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=AP(N&&N.map(E=>Object.assign({},E,{params:Object.assign({},c,E.params),pathname:cs([h,i.encodeLocation?i.encodeLocation(E.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?h:cs([h,i.encodeLocation?i.encodeLocation(E.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathnameBase])})),o,n,r,s);return e&&b?C.createElement(Gc.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},b):b}function bP(){let t=DP(),e=gP(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=C.createElement(C.Fragment,null,C.createElement("p",null," Hey developer "),C.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",C.createElement("code",{style:i},"ErrorBoundary")," or"," ",C.createElement("code",{style:i},"errorElement")," prop on your route.")),C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},e),n?C.createElement("pre",{style:s},n):null,o)}var TP=C.createElement(bP,null),SP=class extends C.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?C.createElement(Ar.Provider,{value:this.props.routeContext},C.createElement(xy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function CP({routeContext:t,match:e,children:n}){let r=C.useContext(Ka);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),C.createElement(Ar.Provider,{value:t},n)}function AP(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let h=i.findIndex(f=>f.route.id&&(o==null?void 0:o[f.route.id])!==void 0);ft(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,h+1))}let a=!1,c=-1;if(n)for(let h=0;h<i.length;h++){let f=i[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(c=h),f.route.id){let{loaderData:m,errors:_}=n,R=f.route.loader&&!m.hasOwnProperty(f.route.id)&&(!_||_[f.route.id]===void 0);if(f.route.lazy||R){a=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}let d=n&&r?(h,f)=>{var m,_;r(h,{location:n.location,params:((_=(m=n.matches)==null?void 0:m[0])==null?void 0:_.params)??{},errorInfo:f})}:void 0;return i.reduceRight((h,f,m)=>{let _,R=!1,A=null,N=null;n&&(_=o&&f.route.id?o[f.route.id]:void 0,A=f.route.errorElement||TP,a&&(c<0&&m===0?(X0("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),R=!0,N=null):c===m&&(R=!0,N=f.route.hydrateFallbackElement||null)));let b=e.concat(i.slice(0,m+1)),y=()=>{let E;return _?E=A:R?E=N:f.route.Component?E=C.createElement(f.route.Component,null):f.route.element?E=f.route.element:E=h,C.createElement(CP,{match:f,routeContext:{outlet:h,matches:b,isDataRoute:n!=null},children:E})};return n&&(f.route.ErrorBoundary||f.route.errorElement||m===0)?C.createElement(SP,{location:n.location,revalidation:n.revalidation,component:A,error:_,children:y(),routeContext:{outlet:null,matches:b,isDataRoute:!0},onError:d}):y()},null)}function Iy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function RP(t){let e=C.useContext(Ka);return ft(e,Iy(t)),e}function NP(t){let e=C.useContext(Hh);return ft(e,Iy(t)),e}function PP(t){let e=C.useContext(Ar);return ft(e,Iy(t)),e}function by(t){let e=PP(t),n=e.matches[e.matches.length-1];return ft(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function kP(){return by("useRouteId")}function DP(){var r;let t=C.useContext(xy),e=NP("useRouteError"),n=by("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function jP(){let{router:t}=RP("useNavigate"),e=by("useNavigate"),n=C.useRef(!1);return Q0(()=>{n.current=!0}),C.useCallback(async(s,i={})=>{lr(n.current,K0),n.current&&(typeof s=="number"?t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var qw={};function X0(t,e,n){!e&&!qw[t]&&(qw[t]=!0,lr(!1,n))}C.memo(OP);function OP({routes:t,future:e,state:n,unstable_onError:r}){return Y0(t,void 0,n,r,e)}function Zd({to:t,replace:e,state:n,relative:r}){ft(Qa(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=C.useContext(Cr);lr(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=C.useContext(Ar),{pathname:o}=Dn(),a=xs(),c=Ey(t,wy(i),o,r==="path"),d=JSON.stringify(c);return C.useEffect(()=>{a(JSON.parse(d),{replace:e,state:n,relative:r})},[a,d,r,e,n]),null}function qo(t){ft(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function LP({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1}){ft(!Qa(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),a=C.useMemo(()=>({basename:o,navigator:s,static:i,future:{}}),[o,s,i]);typeof n=="string"&&(n=Ga(n));let{pathname:c="/",search:d="",hash:h="",state:f=null,key:m="default"}=n,_=C.useMemo(()=>{let R=ms(c,o);return R==null?null:{location:{pathname:R,search:d,hash:h,state:f,key:m},navigationType:r}},[o,c,d,h,f,m,r]);return lr(_!=null,`<Router basename="${o}"> is not able to match the URL "${c}${d}${h}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:C.createElement(Cr.Provider,{value:a},C.createElement(Gc.Provider,{children:e,value:_}))}function VP({children:t,location:e}){return IP(zm(t),e)}function zm(t,e=[]){let n=[];return C.Children.forEach(t,(r,s)=>{if(!C.isValidElement(r))return;let i=[...e,s];if(r.type===C.Fragment){n.push.apply(n,zm(r.props.children,i));return}ft(r.type===qo,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ft(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=zm(r.props.children,i)),n.push(o)}),n}var ud="get",dd="application/x-www-form-urlencoded";function Wh(t){return t!=null&&typeof t.tagName=="string"}function MP(t){return Wh(t)&&t.tagName.toLowerCase()==="button"}function FP(t){return Wh(t)&&t.tagName.toLowerCase()==="form"}function UP(t){return Wh(t)&&t.tagName.toLowerCase()==="input"}function $P(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function BP(t,e){return t.button===0&&(!e||e==="_self")&&!$P(t)}var Fu=null;function zP(){if(Fu===null)try{new FormData(document.createElement("form"),0),Fu=!1}catch{Fu=!0}return Fu}var qP=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function _p(t){return t!=null&&!qP.has(t)?(lr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${dd}"`),null):t}function HP(t,e){let n,r,s,i,o;if(FP(t)){let a=t.getAttribute("action");r=a?ms(a,e):null,n=t.getAttribute("method")||ud,s=_p(t.getAttribute("enctype"))||dd,i=new FormData(t)}else if(MP(t)||UP(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||a.getAttribute("action");if(r=c?ms(c,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||ud,s=_p(t.getAttribute("formenctype"))||_p(a.getAttribute("enctype"))||dd,i=new FormData(a,t),!zP()){let{name:d,type:h,value:f}=t;if(h==="image"){let m=d?`${d}.`:"";i.append(`${m}x`,"0"),i.append(`${m}y`,"0")}else d&&i.append(d,f)}}else{if(Wh(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=ud,r=null,s=dd,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ty(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function WP(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&ms(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function GP(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function KP(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function QP(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await GP(i,n);return o.links?o.links():[]}return[]}));return ZP(r.flat(1).filter(KP).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Hw(t,e,n,r,s,i){let o=(c,d)=>n[d]?c.route.id!==n[d].route.id:!0,a=(c,d)=>{var h;return n[d].pathname!==c.pathname||((h=n[d].route.path)==null?void 0:h.endsWith("*"))&&n[d].params["*"]!==c.params["*"]};return i==="assets"?e.filter((c,d)=>o(c,d)||a(c,d)):i==="data"?e.filter((c,d)=>{var f;let h=r.routes[c.route.id];if(!h||!h.hasLoader)return!1;if(o(c,d)||a(c,d))return!0;if(c.route.shouldRevalidate){let m=c.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function YP(t,e,{includeHydrateFallback:n}={}){return XP(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function XP(t){return[...new Set(t)]}function JP(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function ZP(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let i=JSON.stringify(JP(s));return n.has(i)||(n.add(i),r.push({key:i,link:s})),r},[])}function J0(){let t=C.useContext(Ka);return Ty(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function ek(){let t=C.useContext(Hh);return Ty(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Sy=C.createContext(void 0);Sy.displayName="FrameworkContext";function Z0(){let t=C.useContext(Sy);return Ty(t,"You must render this element inside a <HydratedRouter> element"),t}function tk(t,e){let n=C.useContext(Sy),[r,s]=C.useState(!1),[i,o]=C.useState(!1),{onFocus:a,onBlur:c,onMouseEnter:d,onMouseLeave:h,onTouchStart:f}=e,m=C.useRef(null);C.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let A=b=>{b.forEach(y=>{o(y.isIntersecting)})},N=new IntersectionObserver(A,{threshold:.5});return m.current&&N.observe(m.current),()=>{N.disconnect()}}},[t]),C.useEffect(()=>{if(r){let A=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(A)}}},[r]);let _=()=>{s(!0)},R=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,m,{}]:[i,m,{onFocus:El(a,_),onBlur:El(c,R),onMouseEnter:El(d,_),onMouseLeave:El(h,R),onTouchStart:El(f,_)}]:[!1,m,{}]}function El(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function nk({page:t,...e}){let{router:n}=J0(),r=C.useMemo(()=>z0(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?C.createElement(sk,{page:t,matches:r,...e}):null}function rk(t){let{manifest:e,routeModules:n}=Z0(),[r,s]=C.useState([]);return C.useEffect(()=>{let i=!1;return QP(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function sk({page:t,matches:e,...n}){let r=Dn(),{manifest:s,routeModules:i}=Z0(),{basename:o}=J0(),{loaderData:a,matches:c}=ek(),d=C.useMemo(()=>Hw(t,e,c,s,r,"data"),[t,e,c,s,r]),h=C.useMemo(()=>Hw(t,e,c,s,r,"assets"),[t,e,c,s,r]),f=C.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let R=new Set,A=!1;if(e.forEach(b=>{var E;let y=s.routes[b.route.id];!y||!y.hasLoader||(!d.some(I=>I.route.id===b.route.id)&&b.route.id in a&&((E=i[b.route.id])!=null&&E.shouldRevalidate)||y.hasClientLoader?A=!0:R.add(b.route.id))}),R.size===0)return[];let N=WP(t,o,"data");return A&&R.size>0&&N.searchParams.set("_routes",e.filter(b=>R.has(b.route.id)).map(b=>b.route.id).join(",")),[N.pathname+N.search]},[o,a,r,s,d,e,t,i]),m=C.useMemo(()=>YP(h,s),[h,s]),_=rk(h);return C.createElement(C.Fragment,null,f.map(R=>C.createElement("link",{key:R,rel:"prefetch",as:"fetch",href:R,...n})),m.map(R=>C.createElement("link",{key:R,rel:"modulepreload",href:R,...n})),_.map(({key:R,link:A})=>C.createElement("link",{key:R,nonce:n.nonce,...A})))}function ik(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var eT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{eT&&(window.__reactRouterVersion="7.9.6")}catch{}function ok({basename:t,children:e,window:n}){let r=C.useRef();r.current==null&&(r.current=WN({window:n,v5Compat:!0}));let s=r.current,[i,o]=C.useState({action:s.action,location:s.location}),a=C.useCallback(c=>{C.startTransition(()=>o(c))},[o]);return C.useLayoutEffect(()=>s.listen(a),[s,a]),C.createElement(LP,{basename:t,children:e,location:i.location,navigationType:i.action,navigator:s})}var tT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,nT=C.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:c,to:d,preventScrollReset:h,viewTransition:f,...m},_){let{basename:R}=C.useContext(Cr),A=typeof d=="string"&&tT.test(d),N,b=!1;if(typeof d=="string"&&A&&(N=d,eT))try{let v=new URL(window.location.href),P=d.startsWith("//")?new URL(v.protocol+d):new URL(d),D=ms(P.pathname,R);P.origin===v.origin&&D!=null?d=D+P.search+P.hash:b=!0}catch{lr(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let y=wP(d,{relative:s}),[E,I,O]=tk(r,m),F=ck(d,{replace:o,state:a,target:c,preventScrollReset:h,relative:s,viewTransition:f});function x(v){e&&e(v),v.defaultPrevented||F(v)}let w=C.createElement("a",{...m,...O,href:N||y,onClick:b||i?e:x,ref:ik(_,I),target:c,"data-discover":!A&&n==="render"?"true":void 0});return E&&!A?C.createElement(C.Fragment,null,w,C.createElement(nk,{page:y})):w});nT.displayName="Link";var Ho=C.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:c,...d},h){let f=Kc(o,{relative:d.relative}),m=Dn(),_=C.useContext(Hh),{navigator:R,basename:A}=C.useContext(Cr),N=_!=null&&pk(f)&&a===!0,b=R.encodeLocation?R.encodeLocation(f).pathname:f.pathname,y=m.pathname,E=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(y=y.toLowerCase(),E=E?E.toLowerCase():null,b=b.toLowerCase()),E&&A&&(E=ms(E,A)||E);const I=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let O=y===b||!s&&y.startsWith(b)&&y.charAt(I)==="/",F=E!=null&&(E===b||!s&&E.startsWith(b)&&E.charAt(b.length)==="/"),x={isActive:O,isPending:F,isTransitioning:N},w=O?e:void 0,v;typeof r=="function"?v=r(x):v=[r,O?"active":null,F?"pending":null,N?"transitioning":null].filter(Boolean).join(" ");let P=typeof i=="function"?i(x):i;return C.createElement(nT,{...d,"aria-current":w,className:v,ref:h,style:P,to:o,viewTransition:a},typeof c=="function"?c(x):c)});Ho.displayName="NavLink";var ak=C.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=ud,action:a,onSubmit:c,relative:d,preventScrollReset:h,viewTransition:f,...m},_)=>{let R=hk(),A=fk(a,{relative:d}),N=o.toLowerCase()==="get"?"get":"post",b=typeof a=="string"&&tT.test(a),y=E=>{if(c&&c(E),E.defaultPrevented)return;E.preventDefault();let I=E.nativeEvent.submitter,O=(I==null?void 0:I.getAttribute("formmethod"))||o;R(I||E.currentTarget,{fetcherKey:e,method:O,navigate:n,replace:s,state:i,relative:d,preventScrollReset:h,viewTransition:f})};return C.createElement("form",{ref:_,method:N,action:A,onSubmit:r?c:y,...m,"data-discover":!b&&t==="render"?"true":void 0})});ak.displayName="Form";function lk(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rT(t){let e=C.useContext(Ka);return ft(e,lk(t)),e}function ck(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let a=xs(),c=Dn(),d=Kc(t,{relative:i});return C.useCallback(h=>{if(BP(h,e)){h.preventDefault();let f=n!==void 0?n:Sc(c)===Sc(d);a(t,{replace:f,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[c,a,d,n,r,e,t,s,i,o])}var uk=0,dk=()=>`__${String(++uk)}__`;function hk(){let{router:t}=rT("useSubmit"),{basename:e}=C.useContext(Cr),n=kP();return C.useCallback(async(r,s={})=>{let{action:i,method:o,encType:a,formData:c,body:d}=HP(r,e);if(s.navigate===!1){let h=s.fetcherKey||dk();await t.fetch(h,n,s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||o,formEncType:s.encType||a,flushSync:s.flushSync})}else await t.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||o,formEncType:s.encType||a,replace:s.replace,state:s.state,fromRouteId:n,flushSync:s.flushSync,viewTransition:s.viewTransition})},[t,e,n])}function fk(t,{relative:e}={}){let{basename:n}=C.useContext(Cr),r=C.useContext(Ar);ft(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Kc(t||".",{relative:e})},o=Dn();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),c=a.getAll("index");if(c.some(h=>h==="")){a.delete("index"),c.filter(f=>f).forEach(f=>a.append("index",f));let h=a.toString();i.search=h?`?${h}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:cs([n,i.pathname])),Sc(i)}function pk(t,{relative:e}={}){let n=C.useContext(G0);ft(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=rT("useViewTransitionState"),s=Kc(t,{relative:e});if(!n.isTransitioning)return!1;let i=ms(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=ms(n.nextLocation.pathname,r)||n.nextLocation.pathname;return Jd(s.pathname,o)!=null||Jd(s.pathname,i)!=null}const mk=()=>{};var Ww={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sT=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},gk=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],a=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},iT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,a=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,h=i>>2,f=(i&3)<<4|a>>4;let m=(a&15)<<2|d>>6,_=d&63;c||(_=64,o||(m=64)),r.push(n[h],n[f],n[m],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(sT(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):gk(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const f=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||a==null||d==null||f==null)throw new yk;const m=i<<2|a>>4;if(r.push(m),d!==64){const _=a<<4&240|d>>2;if(r.push(_),f!==64){const R=d<<6&192|f;r.push(R)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class yk extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const vk=function(t){const e=sT(t);return iT.encodeByteArray(e,!0)},eh=function(t){return vk(t).replace(/\./g,"")},oT=function(t){try{return iT.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aT(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _k=()=>aT().__FIREBASE_DEFAULTS__,wk=()=>{if(typeof process>"u"||typeof Ww>"u")return;const t=Ww.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Ek=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&oT(t[1]);return e&&JSON.parse(e)},Gh=()=>{try{return mk()||_k()||wk()||Ek()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},lT=t=>{var e,n;return(n=(e=Gh())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},cT=t=>{const e=lT(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},uT=()=>{var t;return(t=Gh())==null?void 0:t.config},dT=t=>{var e;return(e=Gh())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ei(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Cy(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hT(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[eh(JSON.stringify(n)),eh(JSON.stringify(o)),""].join(".")}const Zl={};function Ik(){const t={prod:[],emulator:[]};for(const e of Object.keys(Zl))Zl[e]?t.emulator.push(e):t.prod.push(e);return t}function bk(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Gw=!1;function Ay(t,e){if(typeof window>"u"||typeof document>"u"||!Ei(window.location.host)||Zl[t]===e||Zl[t]||Gw)return;Zl[t]=e;function n(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=Ik().prod.length>0;function o(){const m=document.getElementById(r);m&&m.remove()}function a(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,_){m.setAttribute("width","24"),m.setAttribute("id",_),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function d(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{Gw=!0,o()},m}function h(m,_){m.setAttribute("id",_),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=bk(r),_=n("text"),R=document.getElementById(_)||document.createElement("span"),A=n("learnmore"),N=document.getElementById(A)||document.createElement("a"),b=n("preprendIcon"),y=document.getElementById(b)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const E=m.element;a(E),h(N,A);const I=d();c(y,b),E.append(y,R,N,I),document.body.appendChild(E)}i?(R.innerText="Preview backend disconnected.",y.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(y.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,R.innerText="Preview backend running in this workspace."),R.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ut(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Tk(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ut())}function fT(){var e;const t=(e=Gh())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Sk(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function pT(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Ck(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ak(){const t=Ut();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function mT(){return!fT()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function gT(){return!fT()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Ry(){try{return typeof indexedDB=="object"}catch{return!1}}function yT(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}function Rk(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk="FirebaseError";class ur extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Nk,Object.setPrototypeOf(this,ur.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bo.prototype.create)}}class bo{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?Pk(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ur(s,a,r)}}function Pk(t,e){return t.replace(kk,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const kk=/\{\$([^}]+)}/g;function Dk(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function gs(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(Kw(i)&&Kw(o)){if(!gs(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Kw(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qc(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ol(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Ll(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function jk(t,e){const n=new Ok(t,e);return n.subscribe.bind(n)}class Ok{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Lk(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=wp),s.error===void 0&&(s.error=wp),s.complete===void 0&&(s.complete=wp);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Lk(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function wp(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk=1e3,Mk=2,Fk=4*60*60*1e3,Uk=.5;function Qw(t,e=Vk,n=Mk){const r=e*Math.pow(n,t),s=Math.round(Uk*r*(Math.random()-.5)*2);return Math.min(Fk,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xe(t){return t&&t._delegate?t._delegate:t}class cr{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new xk;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(zk(e))try{this.getOrInitializeService({instanceIdentifier:Oi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Oi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Oi){return this.instances.has(e)}getOptions(e=Oi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Bk(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Oi){return this.component?this.component.multipleInstances?e:Oi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Bk(t){return t===Oi?void 0:t}function zk(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new $k(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $e;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})($e||($e={}));const Hk={debug:$e.DEBUG,verbose:$e.VERBOSE,info:$e.INFO,warn:$e.WARN,error:$e.ERROR,silent:$e.SILENT},Wk=$e.INFO,Gk={[$e.DEBUG]:"log",[$e.VERBOSE]:"log",[$e.INFO]:"info",[$e.WARN]:"warn",[$e.ERROR]:"error"},Kk=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=Gk[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Kh{constructor(e){this.name=e,this._logLevel=Wk,this._logHandler=Kk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $e))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Hk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$e.DEBUG,...e),this._logHandler(this,$e.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$e.VERBOSE,...e),this._logHandler(this,$e.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$e.INFO,...e),this._logHandler(this,$e.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$e.WARN,...e),this._logHandler(this,$e.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$e.ERROR,...e),this._logHandler(this,$e.ERROR,...e)}}const Qk=(t,e)=>e.some(n=>t instanceof n);let Yw,Xw;function Yk(){return Yw||(Yw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xk(){return Xw||(Xw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const vT=new WeakMap,qm=new WeakMap,_T=new WeakMap,Ep=new WeakMap,Ny=new WeakMap;function Jk(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(ii(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&vT.set(n,t)}).catch(()=>{}),Ny.set(e,t),e}function Zk(t){if(qm.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});qm.set(t,e)}let Hm={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return qm.get(t);if(e==="objectStoreNames")return t.objectStoreNames||_T.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ii(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function eD(t){Hm=t(Hm)}function tD(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(xp(this),e,...n);return _T.set(r,e.sort?e.sort():[e]),ii(r)}:Xk().includes(t)?function(...e){return t.apply(xp(this),e),ii(vT.get(this))}:function(...e){return ii(t.apply(xp(this),e))}}function nD(t){return typeof t=="function"?tD(t):(t instanceof IDBTransaction&&Zk(t),Qk(t,Yk())?new Proxy(t,Hm):t)}function ii(t){if(t instanceof IDBRequest)return Jk(t);if(Ep.has(t))return Ep.get(t);const e=nD(t);return e!==t&&(Ep.set(t,e),Ny.set(e,t)),e}const xp=t=>Ny.get(t);function wT(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=ii(o);return r&&o.addEventListener("upgradeneeded",c=>{r(ii(o.result),c.oldVersion,c.newVersion,ii(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),a}const rD=["get","getKey","getAll","getAllKeys","count"],sD=["put","add","delete","clear"],Ip=new Map;function Jw(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ip.get(e))return Ip.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=sD.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||rD.includes(n)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(a.shift())),(await Promise.all([d[n](...a),s&&c.done]))[0]};return Ip.set(e,i),i}eD(t=>({...t,get:(e,n,r)=>Jw(e,n)||t.get(e,n,r),has:(e,n)=>!!Jw(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(oD(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function oD(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Wm="@firebase/app",Zw="0.14.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ys=new Kh("@firebase/app"),aD="@firebase/app-compat",lD="@firebase/analytics-compat",cD="@firebase/analytics",uD="@firebase/app-check-compat",dD="@firebase/app-check",hD="@firebase/auth",fD="@firebase/auth-compat",pD="@firebase/database",mD="@firebase/data-connect",gD="@firebase/database-compat",yD="@firebase/functions",vD="@firebase/functions-compat",_D="@firebase/installations",wD="@firebase/installations-compat",ED="@firebase/messaging",xD="@firebase/messaging-compat",ID="@firebase/performance",bD="@firebase/performance-compat",TD="@firebase/remote-config",SD="@firebase/remote-config-compat",CD="@firebase/storage",AD="@firebase/storage-compat",RD="@firebase/firestore",ND="@firebase/ai",PD="@firebase/firestore-compat",kD="firebase",DD="12.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm="[DEFAULT]",jD={[Wm]:"fire-core",[aD]:"fire-core-compat",[cD]:"fire-analytics",[lD]:"fire-analytics-compat",[dD]:"fire-app-check",[uD]:"fire-app-check-compat",[hD]:"fire-auth",[fD]:"fire-auth-compat",[pD]:"fire-rtdb",[mD]:"fire-data-connect",[gD]:"fire-rtdb-compat",[yD]:"fire-fn",[vD]:"fire-fn-compat",[_D]:"fire-iid",[wD]:"fire-iid-compat",[ED]:"fire-fcm",[xD]:"fire-fcm-compat",[ID]:"fire-perf",[bD]:"fire-perf-compat",[TD]:"fire-rc",[SD]:"fire-rc-compat",[CD]:"fire-gcs",[AD]:"fire-gcs-compat",[RD]:"fire-fst",[PD]:"fire-fst-compat",[ND]:"fire-vertex","fire-js":"fire-js",[kD]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const th=new Map,OD=new Map,Km=new Map;function eE(t,e){try{t.container.addComponent(e)}catch(n){ys.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function br(t){const e=t.name;if(Km.has(e))return ys.debug(`There were multiple attempts to register component ${e}.`),!1;Km.set(e,t);for(const n of th.values())eE(n,t);for(const n of OD.values())eE(n,t);return!0}function xi(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function er(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},oi=new bo("app","Firebase",LD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new cr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw oi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const To=DD;function Py(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Gm,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw oi.create("bad-app-name",{appName:String(s)});if(n||(n=uT()),!n)throw oi.create("no-options");const i=th.get(s);if(i){if(gs(n,i.options)&&gs(r,i.config))return i;throw oi.create("duplicate-app",{appName:s})}const o=new qk(s);for(const c of Km.values())o.addComponent(c);const a=new VD(n,r,o);return th.set(s,a),a}function Qh(t=Gm){const e=th.get(t);if(!e&&t===Gm&&uT())return Py();if(!e)throw oi.create("no-app",{appName:t});return e}function kn(t,e,n){let r=jD[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ys.warn(o.join(" "));return}br(new cr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MD="firebase-heartbeat-database",FD=1,Cc="firebase-heartbeat-store";let bp=null;function ET(){return bp||(bp=wT(MD,FD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Cc)}catch(n){console.warn(n)}}}}).catch(t=>{throw oi.create("idb-open",{originalErrorMessage:t.message})})),bp}async function UD(t){try{const n=(await ET()).transaction(Cc),r=await n.objectStore(Cc).get(xT(t));return await n.done,r}catch(e){if(e instanceof ur)ys.warn(e.message);else{const n=oi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ys.warn(n.message)}}}async function tE(t,e){try{const r=(await ET()).transaction(Cc,"readwrite");await r.objectStore(Cc).put(e,xT(t)),await r.done}catch(n){if(n instanceof ur)ys.warn(n.message);else{const r=oi.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ys.warn(r.message)}}}function xT(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $D=1024,BD=30;class zD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new HD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=nE();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>BD){const o=WD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ys.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=nE(),{heartbeatsToSend:r,unsentEntries:s}=qD(this._heartbeatsCache.heartbeats),i=eh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ys.warn(n),""}}}function nE(){return new Date().toISOString().substring(0,10)}function qD(t,e=$D){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),rE(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),rE(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class HD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ry()?yT().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await UD(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return tE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return tE(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function rE(t){return eh(JSON.stringify({version:2,heartbeats:t})).length}function WD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GD(t){br(new cr("platform-logger",e=>new iD(e),"PRIVATE")),br(new cr("heartbeat",e=>new zD(e),"PRIVATE")),kn(Wm,Zw,t),kn(Wm,Zw,"esm2020"),kn("fire-js","")}GD("");var KD="firebase",QD="12.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */kn(KD,QD,"app");function IT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const YD=IT,bT=new bo("auth","Firebase",IT());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nh=new Kh("@firebase/auth");function XD(t,...e){nh.logLevel<=$e.WARN&&nh.warn(`Auth (${To}): ${t}`,...e)}function hd(t,...e){nh.logLevel<=$e.ERROR&&nh.error(`Auth (${To}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tr(t,...e){throw ky(t,...e)}function Wr(t,...e){return ky(t,...e)}function TT(t,e,n){const r={...YD(),[e]:n};return new bo("auth","Firebase",r).create(e,{appName:t.name})}function ai(t){return TT(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ky(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return bT.create(t,...e)}function be(t,e,...n){if(!t)throw ky(e,...n)}function is(t){const e="INTERNAL ASSERTION FAILED: "+t;throw hd(e),new Error(e)}function vs(t,e){t||is(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qm(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function JD(){return sE()==="http:"||sE()==="https:"}function sE(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(JD()||pT()||"connection"in navigator)?navigator.onLine:!0}function ej(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc{constructor(e,n){this.shortDelay=e,this.longDelay=n,vs(n>e,"Short delay should be less than long delay!"),this.isMobile=Tk()||Ck()}get(){return ZD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dy(t,e){vs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;is("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;is("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;is("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tj={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nj=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],rj=new Yc(3e4,6e4);function So(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ii(t,e,n,r,s={}){return CT(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Qc({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return Sk()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&Ei(t.emulatorConfig.host)&&(d.credentials="include"),ST.fetch()(await AT(t,t.config.apiHost,n,a),d)})}async function CT(t,e,n){t._canInitEmulator=!1;const r={...tj,...e};try{const s=new ij(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Uu(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[c,d]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Uu(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Uu(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw Uu(t,"user-disabled",o);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw TT(t,h,d);Tr(t,h)}}catch(s){if(s instanceof ur)throw s;Tr(t,"network-request-failed",{message:String(s)})}}async function Yh(t,e,n,r,s={}){const i=await Ii(t,e,n,r,s);return"mfaPendingCredential"in i&&Tr(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function AT(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?Dy(t.config,s):`${t.config.apiScheme}://${s}`;return nj.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function sj(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ij{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Wr(this.auth,"network-request-failed")),rj.get())})}}function Uu(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Wr(t,e,r);return s.customData._tokenResponse=n,s}function iE(t){return t!==void 0&&t.enterprise!==void 0}class oj{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return sj(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function aj(t,e){return Ii(t,"GET","/v2/recaptchaConfig",So(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lj(t,e){return Ii(t,"POST","/v1/accounts:delete",e)}async function rh(t,e){return Ii(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ec(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function cj(t,e=!1){const n=Xe(t),r=await n.getIdToken(e),s=jy(r);be(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:ec(Tp(s.auth_time)),issuedAtTime:ec(Tp(s.iat)),expirationTime:ec(Tp(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Tp(t){return Number(t)*1e3}function jy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return hd("JWT malformed, contained fewer than 3 sections"),null;try{const s=oT(n);return s?JSON.parse(s):(hd("Failed to decode base64 JWT payload"),null)}catch(s){return hd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function oE(t){const e=jy(t);return be(e,"internal-error"),be(typeof e.exp<"u","internal-error"),be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ac(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof ur&&uj(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function uj({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dj{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=ec(this.lastLoginAt),this.creationTime=ec(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sh(t){var f;const e=t.auth,n=await t.getIdToken(),r=await Ac(t,rh(e,{idToken:n}));be(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?RT(s.providerUserInfo):[],o=fj(t.providerData,i),a=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=a?c:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Ym(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,h)}async function hj(t){const e=Xe(t);await sh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function fj(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function RT(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pj(t,e){const n=await CT(t,{},async()=>{const r=Qc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await AT(t,s,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:a,body:r};return t.emulatorConfig&&Ei(t.emulatorConfig.host)&&(c.credentials="include"),ST.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function mj(t,e){return Ii(t,"POST","/v2/accounts:revokeToken",So(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){be(e.idToken,"internal-error"),be(typeof e.idToken<"u","internal-error"),be(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):oE(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){be(e.length!==0,"internal-error");const n=oE(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await pj(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new ma;return r&&(be(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(be(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(be(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ma,this.toJSON())}_performRefresh(){return is("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ks(t,e){be(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class vr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new dj(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Ym(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Ac(this,this.stsTokenManager.getToken(this.auth,e));return be(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return cj(this,e)}reload(){return hj(this)}_assign(e){this!==e&&(be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new vr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await sh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(er(this.auth.app))return Promise.reject(ai(this.auth));const e=await this.getIdToken();return await Ac(this,lj(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,a=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,h=n.lastLoginAt??void 0,{uid:f,emailVerified:m,isAnonymous:_,providerData:R,stsTokenManager:A}=n;be(f&&A,e,"internal-error");const N=ma.fromJSON(this.name,A);be(typeof f=="string",e,"internal-error"),ks(r,e.name),ks(s,e.name),be(typeof m=="boolean",e,"internal-error"),be(typeof _=="boolean",e,"internal-error"),ks(i,e.name),ks(o,e.name),ks(a,e.name),ks(c,e.name),ks(d,e.name),ks(h,e.name);const b=new vr({uid:f,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:_,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:N,createdAt:d,lastLoginAt:h});return R&&Array.isArray(R)&&(b.providerData=R.map(y=>({...y}))),c&&(b._redirectEventId=c),b}static async _fromIdTokenResponse(e,n,r=!1){const s=new ma;s.updateFromServerResponse(n);const i=new vr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await sh(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];be(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?RT(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ma;a.updateFromIdToken(r);const c=new vr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new Ym(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aE=new Map;function os(t){vs(t instanceof Function,"Expected a class definition");let e=aE.get(t);return e?(vs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,aE.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}NT.type="NONE";const lE=NT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(t,e,n){return`firebase:${t}:${e}:${n}`}class ga{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=fd(this.userKey,s.apiKey,i),this.fullPersistenceKey=fd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await rh(this.auth,{idToken:e}).catch(()=>{});return n?vr._fromGetAccountInfoResponse(this.auth,n,e):null}return vr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new ga(os(lE),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||os(lE);const o=fd(r,e.config.apiKey,e.name);let a=null;for(const d of n)try{const h=await d._get(o);if(h){let f;if(typeof h=="string"){const m=await rh(e,{idToken:h}).catch(()=>{});if(!m)break;f=await vr._fromGetAccountInfoResponse(e,m,h)}else f=vr._fromJSON(e,h);d!==i&&(a=f),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new ga(i,e,r):(i=c[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new ga(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cE(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(jT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(PT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(LT(e))return"Blackberry";if(VT(e))return"Webos";if(kT(e))return"Safari";if((e.includes("chrome/")||DT(e))&&!e.includes("edge/"))return"Chrome";if(OT(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function PT(t=Ut()){return/firefox\//i.test(t)}function kT(t=Ut()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function DT(t=Ut()){return/crios\//i.test(t)}function jT(t=Ut()){return/iemobile/i.test(t)}function OT(t=Ut()){return/android/i.test(t)}function LT(t=Ut()){return/blackberry/i.test(t)}function VT(t=Ut()){return/webos/i.test(t)}function Oy(t=Ut()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function gj(t=Ut()){var e;return Oy(t)&&!!((e=window.navigator)!=null&&e.standalone)}function yj(){return Ak()&&document.documentMode===10}function MT(t=Ut()){return Oy(t)||OT(t)||VT(t)||LT(t)||/windows phone/i.test(t)||jT(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FT(t,e=[]){let n;switch(t){case"Browser":n=cE(Ut());break;case"Worker":n=`${cE(Ut())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${To}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vj{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,a)=>{try{const c=e(i);o(c)}catch(c){a(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _j(t,e={}){return Ii(t,"GET","/v2/passwordPolicy",So(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wj=6;class Ej{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??wj,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xj{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new uE(this),this.idTokenSubscription=new uE(this),this.beforeStateQueue=new vj(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=os(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await ga.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await rh(this,{idToken:e}),r=await vr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(er(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await sh(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=ej()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(er(this.app))return Promise.reject(ai(this));const n=e?Xe(e):null;return n&&be(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return er(this.app)?Promise.reject(ai(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return er(this.app)?Promise.reject(ai(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(os(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await _j(this),n=new Ej(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new bo("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await mj(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&os(e)||this._popupRedirectResolver;be(n,this,"argument-error"),this.redirectPersistenceManager=await ga.create(this,[os(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(be(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=FT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(er(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&XD(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Ya(t){return Xe(t)}class uE{constructor(e){this.auth=e,this.observer=null,this.addObserver=jk(n=>this.observer=n)}get next(){return be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xh={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Ij(t){Xh=t}function UT(t){return Xh.loadJS(t)}function bj(){return Xh.recaptchaEnterpriseScript}function Tj(){return Xh.gapiScript}function Sj(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class Cj{constructor(){this.enterprise=new Aj}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class Aj{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const Rj="recaptcha-enterprise",$T="NO_RECAPTCHA";class Nj{constructor(e){this.type=Rj,this.auth=Ya(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{aj(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const d=new oj(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{a(c)})})}function s(i,o,a){const c=window.grecaptcha;iE(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o($T)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new Cj().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!n&&iE(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=bj();c.length!==0&&(c+=a),UT(c).then(()=>{s(a,i,o)}).catch(d=>{o(d)})}}).catch(a=>{o(a)})})}}async function dE(t,e,n,r=!1,s=!1){const i=new Nj(t);let o;if(s)o=$T;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const a={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const c=a.phoneEnrollmentInfo.phoneNumber,d=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const c=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function hE(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await dE(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await dE(t,e,n,n==="getOobCode");return r(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pj(t,e){const n=xi(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(gs(i,e??{}))return s;Tr(s,"already-initialized")}return n.initialize({options:e})}function kj(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(os);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function Dj(t,e,n){const r=Ya(t);be(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=BT(e),{host:o,port:a}=jj(e),c=a===null?"":`:${a}`,d={url:`${i}//${o}${c}/`},h=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){be(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),be(gs(d,r.config.emulator)&&gs(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Ei(o)?(Cy(`${i}//${o}${c}`),Ay("Auth",!0)):Oj()}function BT(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function jj(t){const e=BT(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:fE(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:fE(o)}}}function fE(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Oj(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return is("not implemented")}_getIdTokenResponse(e){return is("not implemented")}_linkToIdToken(e,n){return is("not implemented")}_getReauthenticationResolver(e){return is("not implemented")}}async function Lj(t,e){return Ii(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vj(t,e){return Yh(t,"POST","/v1/accounts:signInWithPassword",So(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mj(t,e){return Yh(t,"POST","/v1/accounts:signInWithEmailLink",So(t,e))}async function Fj(t,e){return Yh(t,"POST","/v1/accounts:signInWithEmailLink",So(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc extends Ly{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Rc(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Rc(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return hE(e,n,"signInWithPassword",Vj);case"emailLink":return Mj(e,{email:this._email,oobCode:this._password});default:Tr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return hE(e,r,"signUpPassword",Lj);case"emailLink":return Fj(e,{idToken:n,email:this._email,oobCode:this._password});default:Tr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ya(t,e){return Yh(t,"POST","/v1/accounts:signInWithIdp",So(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uj="http://localhost";class ao extends Ly{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ao(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Tr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new ao(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return ya(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,ya(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,ya(e,n)}buildRequest(){const e={requestUri:Uj,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Qc(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $j(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Bj(t){const e=Ol(Ll(t)).link,n=e?Ol(Ll(e)).deep_link_id:null,r=Ol(Ll(t)).deep_link_id;return(r?Ol(Ll(r)).link:null)||r||n||e||t}class Vy{constructor(e){const n=Ol(Ll(e)),r=n.apiKey??null,s=n.oobCode??null,i=$j(n.mode??null);be(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=Bj(e);try{return new Vy(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(){this.providerId=Xa.PROVIDER_ID}static credential(e,n){return Rc._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Vy.parseLink(n);return be(r,"argument-error"),Rc._fromEmailAndCode(e,r.code,r.tenantId)}}Xa.PROVIDER_ID="password";Xa.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Xa.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc extends zT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends Xc{constructor(){super("facebook.com")}static credential(e){return ao._fromParams({providerId:$s.PROVIDER_ID,signInMethod:$s.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $s.credentialFromTaggedObject(e)}static credentialFromError(e){return $s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return $s.credential(e.oauthAccessToken)}catch{return null}}}$s.FACEBOOK_SIGN_IN_METHOD="facebook.com";$s.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bs extends Xc{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ao._fromParams({providerId:Bs.PROVIDER_ID,signInMethod:Bs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Bs.credentialFromTaggedObject(e)}static credentialFromError(e){return Bs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Bs.credential(n,r)}catch{return null}}}Bs.GOOGLE_SIGN_IN_METHOD="google.com";Bs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs extends Xc{constructor(){super("github.com")}static credential(e){return ao._fromParams({providerId:zs.PROVIDER_ID,signInMethod:zs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zs.credentialFromTaggedObject(e)}static credentialFromError(e){return zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return zs.credential(e.oauthAccessToken)}catch{return null}}}zs.GITHUB_SIGN_IN_METHOD="github.com";zs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs extends Xc{constructor(){super("twitter.com")}static credential(e,n){return ao._fromParams({providerId:qs.PROVIDER_ID,signInMethod:qs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return qs.credentialFromTaggedObject(e)}static credentialFromError(e){return qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return qs.credential(n,r)}catch{return null}}}qs.TWITTER_SIGN_IN_METHOD="twitter.com";qs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await vr._fromIdTokenResponse(e,r,s),o=pE(r);return new Ra({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=pE(r);return new Ra({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function pE(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ih extends ur{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ih.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new ih(e,n,r,s)}}function qT(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ih._fromErrorAndOperation(t,i,e,r):i})}async function zj(t,e,n=!1){const r=await Ac(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ra._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qj(t,e,n=!1){const{auth:r}=t;if(er(r.app))return Promise.reject(ai(r));const s="reauthenticate";try{const i=await Ac(t,qT(r,s,e,t),n);be(i.idToken,r,"internal-error");const o=jy(i.idToken);be(o,r,"internal-error");const{sub:a}=o;return be(t.uid===a,r,"user-mismatch"),Ra._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Tr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HT(t,e,n=!1){if(er(t.app))return Promise.reject(ai(t));const r="signIn",s=await qT(t,r,e),i=await Ra._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function Hj(t,e){return HT(Ya(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wj(t){const e=Ya(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function Gj(t,e,n){return er(t.app)?Promise.reject(ai(t)):Hj(Xe(t),Xa.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Wj(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kj(t,e){return Xe(t).setPersistence(e)}function Qj(t,e,n,r){return Xe(t).onIdTokenChanged(e,n,r)}function Yj(t,e,n){return Xe(t).beforeAuthStateChanged(e,n)}function My(t,e,n,r){return Xe(t).onAuthStateChanged(e,n,r)}function Xj(t){return Xe(t).signOut()}const oh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WT{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(oh,"1"),this.storage.removeItem(oh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jj=1e3,Zj=10;class GT extends WT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=MT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);yj()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Zj):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Jj)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}GT.type="LOCAL";const KT=GT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT extends WT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}QT.type="SESSION";const YT=QT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Jh(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async d=>d(n.origin,i)),c=await e2(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Jh.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,c)=>{const d=Fy("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===d)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(m.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gr(){return window}function n2(t){Gr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XT(){return typeof Gr().WorkerGlobalScope<"u"&&typeof Gr().importScripts=="function"}async function r2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function s2(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function i2(){return XT()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JT="firebaseLocalStorageDb",o2=1,ah="firebaseLocalStorage",ZT="fbase_key";class Jc{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Zh(t,e){return t.transaction([ah],e?"readwrite":"readonly").objectStore(ah)}function a2(){const t=indexedDB.deleteDatabase(JT);return new Jc(t).toPromise()}function Xm(){const t=indexedDB.open(JT,o2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(ah,{keyPath:ZT})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(ah)?e(r):(r.close(),await a2(),e(await Xm()))})})}async function mE(t,e,n){const r=Zh(t,!0).put({[ZT]:e,value:n});return new Jc(r).toPromise()}async function l2(t,e){const n=Zh(t,!1).get(e),r=await new Jc(n).toPromise();return r===void 0?null:r.value}function gE(t,e){const n=Zh(t,!0).delete(e);return new Jc(n).toPromise()}const c2=800,u2=3;class eS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Xm(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>u2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return XT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Jh._getInstance(i2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await r2(),!this.activeServiceWorker)return;this.sender=new t2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||s2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xm();return await mE(e,oh,"1"),await gE(e,oh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>mE(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>l2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>gE(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Zh(s,!1).getAll();return new Jc(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),c2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}eS.type="LOCAL";const d2=eS;new Yc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h2(t,e){return e?os(e):(be(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy extends Ly{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ya(e,this._buildIdpRequest())}_linkToIdToken(e,n){return ya(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return ya(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function f2(t){return HT(t.auth,new Uy(t),t.bypassAuthState)}function p2(t){const{auth:e,user:n}=t;return be(n,e,"internal-error"),qj(n,new Uy(t),t.bypassAuthState)}async function m2(t){const{auth:e,user:n}=t;return be(n,e,"internal-error"),zj(n,new Uy(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return f2;case"linkViaPopup":case"linkViaRedirect":return m2;case"reauthViaPopup":case"reauthViaRedirect":return p2;default:Tr(this.auth,"internal-error")}}resolve(e){vs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){vs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g2=new Yc(2e3,1e4);class la extends tS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,la.currentPopupAction&&la.currentPopupAction.cancel(),la.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return be(e,this.auth,"internal-error"),e}async onExecution(){vs(this.filter.length===1,"Popup operations only handle one event");const e=Fy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Wr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Wr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,la.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Wr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,g2.get())};e()}}la.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y2="pendingRedirect",pd=new Map;class v2 extends tS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=pd.get(this.auth._key());if(!e){try{const r=await _2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}pd.set(this.auth._key(),e)}return this.bypassAuthState||pd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function _2(t,e){const n=x2(e),r=E2(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function w2(t,e){pd.set(t._key(),e)}function E2(t){return os(t._redirectPersistence)}function x2(t){return fd(y2,t.config.apiKey,t.name)}async function I2(t,e,n=!1){if(er(t.app))return Promise.reject(ai(t));const r=Ya(t),s=h2(r,e),o=await new v2(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b2=10*60*1e3;class T2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!S2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!nS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Wr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=b2&&this.cachedEventUids.clear(),this.cachedEventUids.has(yE(e))}saveEventToCache(e){this.cachedEventUids.add(yE(e)),this.lastProcessedEventTime=Date.now()}}function yE(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function nS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function S2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C2(t,e={}){return Ii(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,R2=/^https?/;async function N2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await C2(t);for(const n of e)try{if(P2(n))return}catch{}Tr(t,"unauthorized-domain")}function P2(t){const e=Qm(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!R2.test(n))return!1;if(A2.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k2=new Yc(3e4,6e4);function vE(){const t=Gr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function D2(t){return new Promise((e,n)=>{var s,i,o;function r(){vE(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vE(),n(Wr(t,"network-request-failed"))},timeout:k2.get()})}if((i=(s=Gr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Gr().gapi)!=null&&o.load)r();else{const a=Sj("iframefcb");return Gr()[a]=()=>{gapi.load?r():n(Wr(t,"network-request-failed"))},UT(`${Tj()}?onload=${a}`).catch(c=>n(c))}}).catch(e=>{throw md=null,e})}let md=null;function j2(t){return md=md||D2(t),md}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O2=new Yc(5e3,15e3),L2="__/auth/iframe",V2="emulator/auth/iframe",M2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},F2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function U2(t){const e=t.config;be(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Dy(e,V2):`https://${t.config.authDomain}/${L2}`,r={apiKey:e.apiKey,appName:t.name,v:To},s=F2.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Qc(r).slice(1)}`}async function $2(t){const e=await j2(t),n=Gr().gapi;return be(n,t,"internal-error"),e.open({where:document.body,url:U2(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:M2,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Wr(t,"network-request-failed"),a=Gr().setTimeout(()=>{i(o)},O2.get());function c(){Gr().clearTimeout(a),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},z2=500,q2=600,H2="_blank",W2="http://localhost";class _E{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function G2(t,e,n,r=z2,s=q2){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c={...B2,width:r.toString(),height:s.toString(),top:i,left:o},d=Ut().toLowerCase();n&&(a=DT(d)?H2:n),PT(d)&&(e=e||W2,c.scrollbars="yes");const h=Object.entries(c).reduce((m,[_,R])=>`${m}${_}=${R},`,"");if(gj(d)&&a!=="_self")return K2(e||"",a),new _E(null);const f=window.open(e||"",a,h);be(f,t,"popup-blocked");try{f.focus()}catch{}return new _E(f)}function K2(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q2="__/auth/handler",Y2="emulator/auth/handler",X2=encodeURIComponent("fac");async function wE(t,e,n,r,s,i){be(t.config.authDomain,t,"auth-domain-config-required"),be(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:To,eventId:s};if(e instanceof zT){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",Dk(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries({}))o[h]=f}if(e instanceof Xc){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(o.scopes=h.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const c=await t._getAppCheckToken(),d=c?`#${X2}=${encodeURIComponent(c)}`:"";return`${J2(t)}?${Qc(a).slice(1)}${d}`}function J2({config:t}){return t.emulator?Dy(t,Y2):`https://${t.authDomain}/${Q2}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sp="webStorageSupport";class Z2{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=YT,this._completeRedirectFn=I2,this._overrideRedirectResult=w2}async _openPopup(e,n,r,s){var o;vs((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await wE(e,n,r,Qm(),s);return G2(e,i,Fy())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await wE(e,n,r,Qm(),s);return n2(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(vs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await $2(e),r=new T2(e);return n.register("authEvent",s=>(be(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Sp,{type:Sp},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Sp];i!==void 0&&n(!!i),Tr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=N2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return MT()||kT()||Oy()}}const eO=Z2;var EE="@firebase/auth",xE="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function rO(t){br(new cr("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;be(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:FT(t)},d=new xj(r,s,i,c);return kj(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),br(new cr("auth-internal",e=>{const n=Ya(e.getProvider("auth").getImmediate());return(r=>new tO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),kn(EE,xE,nO(t)),kn(EE,xE,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sO=5*60,iO=dT("authIdTokenMaxAge")||sO;let IE=null;const oO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>iO)return;const s=n==null?void 0:n.token;IE!==s&&(IE=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function rS(t=Qh()){const e=xi(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Pj(t,{popupRedirectResolver:eO,persistence:[d2,KT,YT]}),r=dT("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=oO(i.toString());Yj(n,o,()=>o(n.currentUser)),Qj(n,a=>o(a))}}const s=lT("auth");return s&&Dj(n,`http://${s}`),n}function aO(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}Ij({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Wr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",aO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});rO("Browser");var bE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var li,sS;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(x,w){function v(){}v.prototype=w.prototype,x.F=w.prototype,x.prototype=new v,x.prototype.constructor=x,x.D=function(P,D,j){for(var k=Array(arguments.length-2),K=2;K<arguments.length;K++)k[K-2]=arguments[K];return w.prototype[D].apply(P,k)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(x,w,v){v||(v=0);const P=Array(16);if(typeof w=="string")for(var D=0;D<16;++D)P[D]=w.charCodeAt(v++)|w.charCodeAt(v++)<<8|w.charCodeAt(v++)<<16|w.charCodeAt(v++)<<24;else for(D=0;D<16;++D)P[D]=w[v++]|w[v++]<<8|w[v++]<<16|w[v++]<<24;w=x.g[0],v=x.g[1],D=x.g[2];let j=x.g[3],k;k=w+(j^v&(D^j))+P[0]+3614090360&4294967295,w=v+(k<<7&4294967295|k>>>25),k=j+(D^w&(v^D))+P[1]+3905402710&4294967295,j=w+(k<<12&4294967295|k>>>20),k=D+(v^j&(w^v))+P[2]+606105819&4294967295,D=j+(k<<17&4294967295|k>>>15),k=v+(w^D&(j^w))+P[3]+3250441966&4294967295,v=D+(k<<22&4294967295|k>>>10),k=w+(j^v&(D^j))+P[4]+4118548399&4294967295,w=v+(k<<7&4294967295|k>>>25),k=j+(D^w&(v^D))+P[5]+1200080426&4294967295,j=w+(k<<12&4294967295|k>>>20),k=D+(v^j&(w^v))+P[6]+2821735955&4294967295,D=j+(k<<17&4294967295|k>>>15),k=v+(w^D&(j^w))+P[7]+4249261313&4294967295,v=D+(k<<22&4294967295|k>>>10),k=w+(j^v&(D^j))+P[8]+1770035416&4294967295,w=v+(k<<7&4294967295|k>>>25),k=j+(D^w&(v^D))+P[9]+2336552879&4294967295,j=w+(k<<12&4294967295|k>>>20),k=D+(v^j&(w^v))+P[10]+4294925233&4294967295,D=j+(k<<17&4294967295|k>>>15),k=v+(w^D&(j^w))+P[11]+2304563134&4294967295,v=D+(k<<22&4294967295|k>>>10),k=w+(j^v&(D^j))+P[12]+1804603682&4294967295,w=v+(k<<7&4294967295|k>>>25),k=j+(D^w&(v^D))+P[13]+4254626195&4294967295,j=w+(k<<12&4294967295|k>>>20),k=D+(v^j&(w^v))+P[14]+2792965006&4294967295,D=j+(k<<17&4294967295|k>>>15),k=v+(w^D&(j^w))+P[15]+1236535329&4294967295,v=D+(k<<22&4294967295|k>>>10),k=w+(D^j&(v^D))+P[1]+4129170786&4294967295,w=v+(k<<5&4294967295|k>>>27),k=j+(v^D&(w^v))+P[6]+3225465664&4294967295,j=w+(k<<9&4294967295|k>>>23),k=D+(w^v&(j^w))+P[11]+643717713&4294967295,D=j+(k<<14&4294967295|k>>>18),k=v+(j^w&(D^j))+P[0]+3921069994&4294967295,v=D+(k<<20&4294967295|k>>>12),k=w+(D^j&(v^D))+P[5]+3593408605&4294967295,w=v+(k<<5&4294967295|k>>>27),k=j+(v^D&(w^v))+P[10]+38016083&4294967295,j=w+(k<<9&4294967295|k>>>23),k=D+(w^v&(j^w))+P[15]+3634488961&4294967295,D=j+(k<<14&4294967295|k>>>18),k=v+(j^w&(D^j))+P[4]+3889429448&4294967295,v=D+(k<<20&4294967295|k>>>12),k=w+(D^j&(v^D))+P[9]+568446438&4294967295,w=v+(k<<5&4294967295|k>>>27),k=j+(v^D&(w^v))+P[14]+3275163606&4294967295,j=w+(k<<9&4294967295|k>>>23),k=D+(w^v&(j^w))+P[3]+4107603335&4294967295,D=j+(k<<14&4294967295|k>>>18),k=v+(j^w&(D^j))+P[8]+1163531501&4294967295,v=D+(k<<20&4294967295|k>>>12),k=w+(D^j&(v^D))+P[13]+2850285829&4294967295,w=v+(k<<5&4294967295|k>>>27),k=j+(v^D&(w^v))+P[2]+4243563512&4294967295,j=w+(k<<9&4294967295|k>>>23),k=D+(w^v&(j^w))+P[7]+1735328473&4294967295,D=j+(k<<14&4294967295|k>>>18),k=v+(j^w&(D^j))+P[12]+2368359562&4294967295,v=D+(k<<20&4294967295|k>>>12),k=w+(v^D^j)+P[5]+4294588738&4294967295,w=v+(k<<4&4294967295|k>>>28),k=j+(w^v^D)+P[8]+2272392833&4294967295,j=w+(k<<11&4294967295|k>>>21),k=D+(j^w^v)+P[11]+1839030562&4294967295,D=j+(k<<16&4294967295|k>>>16),k=v+(D^j^w)+P[14]+4259657740&4294967295,v=D+(k<<23&4294967295|k>>>9),k=w+(v^D^j)+P[1]+2763975236&4294967295,w=v+(k<<4&4294967295|k>>>28),k=j+(w^v^D)+P[4]+1272893353&4294967295,j=w+(k<<11&4294967295|k>>>21),k=D+(j^w^v)+P[7]+4139469664&4294967295,D=j+(k<<16&4294967295|k>>>16),k=v+(D^j^w)+P[10]+3200236656&4294967295,v=D+(k<<23&4294967295|k>>>9),k=w+(v^D^j)+P[13]+681279174&4294967295,w=v+(k<<4&4294967295|k>>>28),k=j+(w^v^D)+P[0]+3936430074&4294967295,j=w+(k<<11&4294967295|k>>>21),k=D+(j^w^v)+P[3]+3572445317&4294967295,D=j+(k<<16&4294967295|k>>>16),k=v+(D^j^w)+P[6]+76029189&4294967295,v=D+(k<<23&4294967295|k>>>9),k=w+(v^D^j)+P[9]+3654602809&4294967295,w=v+(k<<4&4294967295|k>>>28),k=j+(w^v^D)+P[12]+3873151461&4294967295,j=w+(k<<11&4294967295|k>>>21),k=D+(j^w^v)+P[15]+530742520&4294967295,D=j+(k<<16&4294967295|k>>>16),k=v+(D^j^w)+P[2]+3299628645&4294967295,v=D+(k<<23&4294967295|k>>>9),k=w+(D^(v|~j))+P[0]+4096336452&4294967295,w=v+(k<<6&4294967295|k>>>26),k=j+(v^(w|~D))+P[7]+1126891415&4294967295,j=w+(k<<10&4294967295|k>>>22),k=D+(w^(j|~v))+P[14]+2878612391&4294967295,D=j+(k<<15&4294967295|k>>>17),k=v+(j^(D|~w))+P[5]+4237533241&4294967295,v=D+(k<<21&4294967295|k>>>11),k=w+(D^(v|~j))+P[12]+1700485571&4294967295,w=v+(k<<6&4294967295|k>>>26),k=j+(v^(w|~D))+P[3]+2399980690&4294967295,j=w+(k<<10&4294967295|k>>>22),k=D+(w^(j|~v))+P[10]+4293915773&4294967295,D=j+(k<<15&4294967295|k>>>17),k=v+(j^(D|~w))+P[1]+2240044497&4294967295,v=D+(k<<21&4294967295|k>>>11),k=w+(D^(v|~j))+P[8]+1873313359&4294967295,w=v+(k<<6&4294967295|k>>>26),k=j+(v^(w|~D))+P[15]+4264355552&4294967295,j=w+(k<<10&4294967295|k>>>22),k=D+(w^(j|~v))+P[6]+2734768916&4294967295,D=j+(k<<15&4294967295|k>>>17),k=v+(j^(D|~w))+P[13]+1309151649&4294967295,v=D+(k<<21&4294967295|k>>>11),k=w+(D^(v|~j))+P[4]+4149444226&4294967295,w=v+(k<<6&4294967295|k>>>26),k=j+(v^(w|~D))+P[11]+3174756917&4294967295,j=w+(k<<10&4294967295|k>>>22),k=D+(w^(j|~v))+P[2]+718787259&4294967295,D=j+(k<<15&4294967295|k>>>17),k=v+(j^(D|~w))+P[9]+3951481745&4294967295,x.g[0]=x.g[0]+w&4294967295,x.g[1]=x.g[1]+(D+(k<<21&4294967295|k>>>11))&4294967295,x.g[2]=x.g[2]+D&4294967295,x.g[3]=x.g[3]+j&4294967295}r.prototype.v=function(x,w){w===void 0&&(w=x.length);const v=w-this.blockSize,P=this.C;let D=this.h,j=0;for(;j<w;){if(D==0)for(;j<=v;)s(this,x,j),j+=this.blockSize;if(typeof x=="string"){for(;j<w;)if(P[D++]=x.charCodeAt(j++),D==this.blockSize){s(this,P),D=0;break}}else for(;j<w;)if(P[D++]=x[j++],D==this.blockSize){s(this,P),D=0;break}}this.h=D,this.o+=w},r.prototype.A=function(){var x=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);x[0]=128;for(var w=1;w<x.length-8;++w)x[w]=0;w=this.o*8;for(var v=x.length-8;v<x.length;++v)x[v]=w&255,w/=256;for(this.v(x),x=Array(16),w=0,v=0;v<4;++v)for(let P=0;P<32;P+=8)x[w++]=this.g[v]>>>P&255;return x};function i(x,w){var v=a;return Object.prototype.hasOwnProperty.call(v,x)?v[x]:v[x]=w(x)}function o(x,w){this.h=w;const v=[];let P=!0;for(let D=x.length-1;D>=0;D--){const j=x[D]|0;P&&j==w||(v[D]=j,P=!1)}this.g=v}var a={};function c(x){return-128<=x&&x<128?i(x,function(w){return new o([w|0],w<0?-1:0)}):new o([x|0],x<0?-1:0)}function d(x){if(isNaN(x)||!isFinite(x))return f;if(x<0)return N(d(-x));const w=[];let v=1;for(let P=0;x>=v;P++)w[P]=x/v|0,v*=4294967296;return new o(w,0)}function h(x,w){if(x.length==0)throw Error("number format error: empty string");if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(x.charAt(0)=="-")return N(h(x.substring(1),w));if(x.indexOf("-")>=0)throw Error('number format error: interior "-" character');const v=d(Math.pow(w,8));let P=f;for(let j=0;j<x.length;j+=8){var D=Math.min(8,x.length-j);const k=parseInt(x.substring(j,j+D),w);D<8?(D=d(Math.pow(w,D)),P=P.j(D).add(d(k))):(P=P.j(v),P=P.add(d(k)))}return P}var f=c(0),m=c(1),_=c(16777216);t=o.prototype,t.m=function(){if(A(this))return-N(this).m();let x=0,w=1;for(let v=0;v<this.g.length;v++){const P=this.i(v);x+=(P>=0?P:4294967296+P)*w,w*=4294967296}return x},t.toString=function(x){if(x=x||10,x<2||36<x)throw Error("radix out of range: "+x);if(R(this))return"0";if(A(this))return"-"+N(this).toString(x);const w=d(Math.pow(x,6));var v=this;let P="";for(;;){const D=I(v,w).g;v=b(v,D.j(w));let j=((v.g.length>0?v.g[0]:v.h)>>>0).toString(x);if(v=D,R(v))return j+P;for(;j.length<6;)j="0"+j;P=j+P}},t.i=function(x){return x<0?0:x<this.g.length?this.g[x]:this.h};function R(x){if(x.h!=0)return!1;for(let w=0;w<x.g.length;w++)if(x.g[w]!=0)return!1;return!0}function A(x){return x.h==-1}t.l=function(x){return x=b(this,x),A(x)?-1:R(x)?0:1};function N(x){const w=x.g.length,v=[];for(let P=0;P<w;P++)v[P]=~x.g[P];return new o(v,~x.h).add(m)}t.abs=function(){return A(this)?N(this):this},t.add=function(x){const w=Math.max(this.g.length,x.g.length),v=[];let P=0;for(let D=0;D<=w;D++){let j=P+(this.i(D)&65535)+(x.i(D)&65535),k=(j>>>16)+(this.i(D)>>>16)+(x.i(D)>>>16);P=k>>>16,j&=65535,k&=65535,v[D]=k<<16|j}return new o(v,v[v.length-1]&-2147483648?-1:0)};function b(x,w){return x.add(N(w))}t.j=function(x){if(R(this)||R(x))return f;if(A(this))return A(x)?N(this).j(N(x)):N(N(this).j(x));if(A(x))return N(this.j(N(x)));if(this.l(_)<0&&x.l(_)<0)return d(this.m()*x.m());const w=this.g.length+x.g.length,v=[];for(var P=0;P<2*w;P++)v[P]=0;for(P=0;P<this.g.length;P++)for(let D=0;D<x.g.length;D++){const j=this.i(P)>>>16,k=this.i(P)&65535,K=x.i(D)>>>16,We=x.i(D)&65535;v[2*P+2*D]+=k*We,y(v,2*P+2*D),v[2*P+2*D+1]+=j*We,y(v,2*P+2*D+1),v[2*P+2*D+1]+=k*K,y(v,2*P+2*D+1),v[2*P+2*D+2]+=j*K,y(v,2*P+2*D+2)}for(x=0;x<w;x++)v[x]=v[2*x+1]<<16|v[2*x];for(x=w;x<2*w;x++)v[x]=0;return new o(v,0)};function y(x,w){for(;(x[w]&65535)!=x[w];)x[w+1]+=x[w]>>>16,x[w]&=65535,w++}function E(x,w){this.g=x,this.h=w}function I(x,w){if(R(w))throw Error("division by zero");if(R(x))return new E(f,f);if(A(x))return w=I(N(x),w),new E(N(w.g),N(w.h));if(A(w))return w=I(x,N(w)),new E(N(w.g),w.h);if(x.g.length>30){if(A(x)||A(w))throw Error("slowDivide_ only works with positive integers.");for(var v=m,P=w;P.l(x)<=0;)v=O(v),P=O(P);var D=F(v,1),j=F(P,1);for(P=F(P,2),v=F(v,2);!R(P);){var k=j.add(P);k.l(x)<=0&&(D=D.add(v),j=k),P=F(P,1),v=F(v,1)}return w=b(x,D.j(w)),new E(D,w)}for(D=f;x.l(w)>=0;){for(v=Math.max(1,Math.floor(x.m()/w.m())),P=Math.ceil(Math.log(v)/Math.LN2),P=P<=48?1:Math.pow(2,P-48),j=d(v),k=j.j(w);A(k)||k.l(x)>0;)v-=P,j=d(v),k=j.j(w);R(j)&&(j=m),D=D.add(j),x=b(x,k)}return new E(D,x)}t.B=function(x){return I(this,x).h},t.and=function(x){const w=Math.max(this.g.length,x.g.length),v=[];for(let P=0;P<w;P++)v[P]=this.i(P)&x.i(P);return new o(v,this.h&x.h)},t.or=function(x){const w=Math.max(this.g.length,x.g.length),v=[];for(let P=0;P<w;P++)v[P]=this.i(P)|x.i(P);return new o(v,this.h|x.h)},t.xor=function(x){const w=Math.max(this.g.length,x.g.length),v=[];for(let P=0;P<w;P++)v[P]=this.i(P)^x.i(P);return new o(v,this.h^x.h)};function O(x){const w=x.g.length+1,v=[];for(let P=0;P<w;P++)v[P]=x.i(P)<<1|x.i(P-1)>>>31;return new o(v,x.h)}function F(x,w){const v=w>>5;w%=32;const P=x.g.length-v,D=[];for(let j=0;j<P;j++)D[j]=w>0?x.i(j+v)>>>w|x.i(j+v+1)<<32-w:x.i(j+v);return new o(D,x.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,sS=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=h,li=o}).apply(typeof bE<"u"?bE:typeof self<"u"?self:typeof window<"u"?window:{});var $u=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var iS,Vl,oS,gd,Jm,aS,lS,cS;(function(){var t,e=Object.defineProperty;function n(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof $u=="object"&&$u];for(var p=0;p<u.length;++p){var g=u[p];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=n(this);function s(u,p){if(p)e:{var g=r;u=u.split(".");for(var S=0;S<u.length-1;S++){var V=u[S];if(!(V in g))break e;g=g[V]}u=u[u.length-1],S=g[u],p=p(S),p!=S&&p!=null&&e(g,u,{configurable:!0,writable:!0,value:p})}}s("Symbol.dispose",function(u){return u||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(u){return u||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(u){return u||function(p){var g=[],S;for(S in p)Object.prototype.hasOwnProperty.call(p,S)&&g.push([S,p[S]]);return g}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function a(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function c(u,p,g){return u.call.apply(u.bind,arguments)}function d(u,p,g){return d=c,d.apply(null,arguments)}function h(u,p){var g=Array.prototype.slice.call(arguments,1);return function(){var S=g.slice();return S.push.apply(S,arguments),u.apply(this,S)}}function f(u,p){function g(){}g.prototype=p.prototype,u.Z=p.prototype,u.prototype=new g,u.prototype.constructor=u,u.Ob=function(S,V,$){for(var ne=Array(arguments.length-2),je=2;je<arguments.length;je++)ne[je-2]=arguments[je];return p.prototype[V].apply(S,ne)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?u=>u&&AsyncContext.Snapshot.wrap(u):u=>u;function _(u){const p=u.length;if(p>0){const g=Array(p);for(let S=0;S<p;S++)g[S]=u[S];return g}return[]}function R(u,p){for(let S=1;S<arguments.length;S++){const V=arguments[S];var g=typeof V;if(g=g!="object"?g:V?Array.isArray(V)?"array":g:"null",g=="array"||g=="object"&&typeof V.length=="number"){g=u.length||0;const $=V.length||0;u.length=g+$;for(let ne=0;ne<$;ne++)u[g+ne]=V[ne]}else u.push(V)}}class A{constructor(p,g){this.i=p,this.j=g,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function N(u){o.setTimeout(()=>{throw u},0)}function b(){var u=x;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class y{constructor(){this.h=this.g=null}add(p,g){const S=E.get();S.set(p,g),this.h?this.h.next=S:this.g=S,this.h=S}}var E=new A(()=>new I,u=>u.reset());class I{constructor(){this.next=this.g=this.h=null}set(p,g){this.h=p,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let O,F=!1,x=new y,w=()=>{const u=Promise.resolve(void 0);O=()=>{u.then(v)}};function v(){for(var u;u=b();){try{u.h.call(u.g)}catch(g){N(g)}var p=E;p.j(u),p.h<100&&(p.h++,u.next=p.g,p.g=u)}F=!1}function P(){this.u=this.u,this.C=this.C}P.prototype.u=!1,P.prototype.dispose=function(){this.u||(this.u=!0,this.N())},P.prototype[Symbol.dispose]=function(){this.dispose()},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function D(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}D.prototype.h=function(){this.defaultPrevented=!0};var j=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const g=()=>{};o.addEventListener("test",g,p),o.removeEventListener("test",g,p)}catch{}return u}();function k(u){return/^[\s\xa0]*$/.test(u)}function K(u,p){D.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u&&this.init(u,p)}f(K,D),K.prototype.init=function(u,p){const g=this.type=u.type,S=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget,p||(g=="mouseover"?p=u.fromElement:g=="mouseout"&&(p=u.toElement)),this.relatedTarget=p,S?(this.clientX=S.clientX!==void 0?S.clientX:S.pageX,this.clientY=S.clientY!==void 0?S.clientY:S.pageY,this.screenX=S.screenX||0,this.screenY=S.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=u.pointerType,this.state=u.state,this.i=u,u.defaultPrevented&&K.Z.h.call(this)},K.prototype.h=function(){K.Z.h.call(this);const u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var We="closure_listenable_"+(Math.random()*1e6|0),At=0;function Qt(u,p,g,S,V){this.listener=u,this.proxy=null,this.src=p,this.type=g,this.capture=!!S,this.ha=V,this.key=++At,this.da=this.fa=!1}function ee(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function me(u,p,g){for(const S in u)p.call(g,u[S],S,u)}function _e(u,p){for(const g in u)p.call(void 0,u[g],g,u)}function Pe(u){const p={};for(const g in u)p[g]=u[g];return p}const Ke="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function St(u,p){let g,S;for(let V=1;V<arguments.length;V++){S=arguments[V];for(g in S)u[g]=S[g];for(let $=0;$<Ke.length;$++)g=Ke[$],Object.prototype.hasOwnProperty.call(S,g)&&(u[g]=S[g])}}function U(u){this.src=u,this.g={},this.h=0}U.prototype.add=function(u,p,g,S,V){const $=u.toString();u=this.g[$],u||(u=this.g[$]=[],this.h++);const ne=B(u,p,S,V);return ne>-1?(p=u[ne],g||(p.fa=!1)):(p=new Qt(p,this.src,$,!!S,V),p.fa=g,u.push(p)),p};function ie(u,p){const g=p.type;if(g in u.g){var S=u.g[g],V=Array.prototype.indexOf.call(S,p,void 0),$;($=V>=0)&&Array.prototype.splice.call(S,V,1),$&&(ee(p),u.g[g].length==0&&(delete u.g[g],u.h--))}}function B(u,p,g,S){for(let V=0;V<u.length;++V){const $=u[V];if(!$.da&&$.listener==p&&$.capture==!!g&&$.ha==S)return V}return-1}var W="closure_lm_"+(Math.random()*1e6|0),re={};function ge(u,p,g,S,V){if(Array.isArray(p)){for(let $=0;$<p.length;$++)ge(u,p[$],g,S,V);return null}return g=ae(g),u&&u[We]?u.J(p,g,a(S)?!!S.capture:!1,V):he(u,p,g,!1,S,V)}function he(u,p,g,S,V,$){if(!p)throw Error("Invalid event type");const ne=a(V)?!!V.capture:!!V;let je=nt(u);if(je||(u[W]=je=new U(u)),g=je.add(p,g,S,ne,$),g.proxy)return g;if(S=Oe(),g.proxy=S,S.src=u,S.listener=g,u.addEventListener)j||(V=ne),V===void 0&&(V=!1),u.addEventListener(p.toString(),S,V);else if(u.attachEvent)u.attachEvent(De(p.toString()),S);else if(u.addListener&&u.removeListener)u.addListener(S);else throw Error("addEventListener and attachEvent are unavailable.");return g}function Oe(){function u(g){return p.call(u.src,u.listener,g)}const p=Le;return u}function fe(u,p,g,S,V){if(Array.isArray(p))for(var $=0;$<p.length;$++)fe(u,p[$],g,S,V);else S=a(S)?!!S.capture:!!S,g=ae(g),u&&u[We]?(u=u.i,$=String(p).toString(),$ in u.g&&(p=u.g[$],g=B(p,g,S,V),g>-1&&(ee(p[g]),Array.prototype.splice.call(p,g,1),p.length==0&&(delete u.g[$],u.h--)))):u&&(u=nt(u))&&(p=u.g[p.toString()],u=-1,p&&(u=B(p,g,S,V)),(g=u>-1?p[u]:null)&&le(g))}function le(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[We])ie(p.i,u);else{var g=u.type,S=u.proxy;p.removeEventListener?p.removeEventListener(g,S,u.capture):p.detachEvent?p.detachEvent(De(g),S):p.addListener&&p.removeListener&&p.removeListener(S),(g=nt(p))?(ie(g,u),g.h==0&&(g.src=null,p[W]=null)):ee(u)}}}function De(u){return u in re?re[u]:re[u]="on"+u}function Le(u,p){if(u.da)u=!0;else{p=new K(p,this);const g=u.listener,S=u.ha||u.src;u.fa&&le(u),u=g.call(S,p)}return u}function nt(u){return u=u[W],u instanceof U?u:null}var G="__closure_events_fn_"+(Math.random()*1e9>>>0);function ae(u){return typeof u=="function"?u:(u[G]||(u[G]=function(p){return u.handleEvent(p)}),u[G])}function z(){P.call(this),this.i=new U(this),this.M=this,this.G=null}f(z,P),z.prototype[We]=!0,z.prototype.removeEventListener=function(u,p,g,S){fe(this,u,p,g,S)};function oe(u,p){var g,S=u.G;if(S)for(g=[];S;S=S.G)g.push(S);if(u=u.M,S=p.type||p,typeof p=="string")p=new D(p,u);else if(p instanceof D)p.target=p.target||u;else{var V=p;p=new D(S,u),St(p,V)}V=!0;let $,ne;if(g)for(ne=g.length-1;ne>=0;ne--)$=p.g=g[ne],V=ce($,S,!0,p)&&V;if($=p.g=u,V=ce($,S,!0,p)&&V,V=ce($,S,!1,p)&&V,g)for(ne=0;ne<g.length;ne++)$=p.g=g[ne],V=ce($,S,!1,p)&&V}z.prototype.N=function(){if(z.Z.N.call(this),this.i){var u=this.i;for(const p in u.g){const g=u.g[p];for(let S=0;S<g.length;S++)ee(g[S]);delete u.g[p],u.h--}}this.G=null},z.prototype.J=function(u,p,g,S){return this.i.add(String(u),p,!1,g,S)},z.prototype.K=function(u,p,g,S){return this.i.add(String(u),p,!0,g,S)};function ce(u,p,g,S){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();let V=!0;for(let $=0;$<p.length;++$){const ne=p[$];if(ne&&!ne.da&&ne.capture==g){const je=ne.listener,Vt=ne.ha||ne.src;ne.fa&&ie(u.i,ne),V=je.call(Vt,S)!==!1&&V}}return V&&!S.defaultPrevented}function xe(u,p){if(typeof u!="function")if(u&&typeof u.handleEvent=="function")u=d(u.handleEvent,u);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:o.setTimeout(u,p||0)}function Ie(u){u.g=xe(()=>{u.g=null,u.i&&(u.i=!1,Ie(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class Ue extends P{constructor(p,g){super(),this.m=p,this.l=g,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Ie(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Re(u){P.call(this),this.h=u,this.g={}}f(Re,P);var Me=[];function ke(u){me(u.g,function(p,g){this.g.hasOwnProperty(g)&&le(p)},u),u.g={}}Re.prototype.N=function(){Re.Z.N.call(this),ke(this)},Re.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Se=o.JSON.stringify,M=o.JSON.parse,J=class{stringify(u){return o.JSON.stringify(u,void 0)}parse(u){return o.JSON.parse(u,void 0)}};function te(){}function Ne(){}var rt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Rt(){D.call(this,"d")}f(Rt,D);function Nr(){D.call(this,"c")}f(Nr,D);var In={},jn=null;function tn(){return jn=jn||new z}In.Ia="serverreachability";function Nt(u){D.call(this,In.Ia,u)}f(Nt,D);function Bt(u){const p=tn();oe(p,new Nt(p))}In.STAT_EVENT="statevent";function zt(u,p){D.call(this,In.STAT_EVENT,u),this.stat=p}f(zt,D);function Ye(u){const p=tn();oe(p,new zt(p,u))}In.Ja="timingevent";function Pt(u,p){D.call(this,In.Ja,u),this.size=p}f(Pt,D);function Pr(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){u()},p)}function dr(){this.g=!0}dr.prototype.ua=function(){this.g=!1};function Ts(u,p,g,S,V,$){u.info(function(){if(u.g)if($){var ne="",je=$.split("&");for(let st=0;st<je.length;st++){var Vt=je[st].split("=");if(Vt.length>1){const qt=Vt[0];Vt=Vt[1];const jr=qt.split("_");ne=jr.length>=2&&jr[1]=="type"?ne+(qt+"="+Vt+"&"):ne+(qt+"=redacted&")}}}else ne=null;else ne=$;return"XMLHTTP REQ ("+S+") [attempt "+V+"]: "+p+`
`+g+`
`+ne})}function On(u,p,g,S,V,$,ne){u.info(function(){return"XMLHTTP RESP ("+S+") [ attempt "+V+"]: "+p+`
`+g+`
`+$+" "+ne})}function Xr(u,p,g,S){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+fu(u,g)+(S?" "+S:"")})}function hu(u,p){u.info(function(){return"TIMEOUT: "+p})}dr.prototype.info=function(){};function fu(u,p){if(!u.g)return p;if(!p)return null;try{const $=JSON.parse(p);if($){for(u=0;u<$.length;u++)if(Array.isArray($[u])){var g=$[u];if(!(g.length<2)){var S=g[1];if(Array.isArray(S)&&!(S.length<1)){var V=S[0];if(V!="noop"&&V!="stop"&&V!="close")for(let ne=1;ne<S.length;ne++)S[ne]=""}}}}return Se($)}catch{return p}}var Ci={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},rl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},T;function H(){}f(H,te),H.prototype.g=function(){return new XMLHttpRequest},T=new H;function Z(u){return encodeURIComponent(String(u))}function ye(u){var p=1;u=u.split(":");const g=[];for(;p>0&&u.length;)g.push(u.shift()),p--;return u.length&&g.push(u.join(":")),g}function Ee(u,p,g,S){this.j=u,this.i=p,this.l=g,this.S=S||1,this.V=new Re(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Qe}function Qe(){this.i=null,this.g="",this.h=!1}var kr={},Qn={};function Yn(u,p,g){u.M=1,u.A=pu(Dr(p)),u.u=g,u.R=!0,kt(u,null)}function kt(u,p){u.F=Date.now(),Jr(u),u.B=Dr(u.A);var g=u.B,S=u.S;Array.isArray(S)||(S=[String(S)]),c_(g.i,"t",S),u.C=0,g=u.j.L,u.h=new Qe,u.g=C_(u.j,g?p:null,!u.u),u.P>0&&(u.O=new Ue(d(u.Y,u,u.g),u.P)),p=u.V,g=u.g,S=u.ba;var V="readystatechange";Array.isArray(V)||(V&&(Me[0]=V.toString()),V=Me);for(let $=0;$<V.length;$++){const ne=ge(g,V[$],S||p.handleEvent,!1,p.h||p);if(!ne)break;p.g[ne.key]=ne}p=u.J?Pe(u.J):{},u.u?(u.v||(u.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.B,u.v,u.u,p)):(u.v="GET",u.g.ea(u.B,u.v,null,p)),Bt(),Ts(u.i,u.v,u.B,u.l,u.S,u.u)}Ee.prototype.ba=function(u){u=u.target;const p=this.O;p&&As(u)==3?p.j():this.Y(u)},Ee.prototype.Y=function(u){try{if(u==this.g)e:{const je=As(this.g),Vt=this.g.ya(),st=this.g.ca();if(!(je<3)&&(je!=3||this.g&&(this.h.h||this.g.la()||g_(this.g)))){this.K||je!=4||Vt==7||(Vt==8||st<=0?Bt(3):Bt(2)),Ro(this);var p=this.g.ca();this.X=p;var g=bn(this);if(this.o=p==200,On(this.i,this.v,this.B,this.l,this.S,je,p),this.o){if(this.U&&!this.L){t:{if(this.g){var S,V=this.g;if((S=V.g?V.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(S)){var $=S;break t}}$=null}if(u=$)Xr(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Lf(this,u);else{this.o=!1,this.m=3,Ye(12),Ai(this),es(this);break e}}if(this.R){u=!0;let qt;for(;!this.K&&this.C<g.length;)if(qt=hr(this,g),qt==Qn){je==4&&(this.m=4,Ye(14),u=!1),Xr(this.i,this.l,null,"[Incomplete Response]");break}else if(qt==kr){this.m=4,Ye(15),Xr(this.i,this.l,g,"[Invalid Chunk]"),u=!1;break}else Xr(this.i,this.l,qt,null),Lf(this,qt);if(Tn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),je!=4||g.length!=0||this.h.h||(this.m=1,Ye(16),u=!1),this.o=this.o&&u,!u)Xr(this.i,this.l,g,"[Invalid Chunked Response]"),Ai(this),es(this);else if(g.length>0&&!this.W){this.W=!0;var ne=this.j;ne.g==this&&ne.aa&&!ne.P&&(ne.j.info("Great, no buffering proxy detected. Bytes received: "+g.length),qf(ne),ne.P=!0,Ye(11))}}else Xr(this.i,this.l,g,null),Lf(this,g);je==4&&Ai(this),this.o&&!this.K&&(je==4?I_(this.j,this):(this.o=!1,Jr(this)))}else y1(this.g),p==400&&g.indexOf("Unknown SID")>0?(this.m=3,Ye(12)):(this.m=0,Ye(13)),Ai(this),es(this)}}}catch{}finally{}};function bn(u){if(!Tn(u))return u.g.la();const p=g_(u.g);if(p==="")return"";let g="";const S=p.length,V=As(u.g)==4;if(!u.h.i){if(typeof TextDecoder>"u")return Ai(u),es(u),"";u.h.i=new o.TextDecoder}for(let $=0;$<S;$++)u.h.h=!0,g+=u.h.i.decode(p[$],{stream:!(V&&$==S-1)});return p.length=0,u.h.g+=g,u.C=0,u.h.g}function Tn(u){return u.g?u.v=="GET"&&u.M!=2&&u.j.Aa:!1}function hr(u,p){var g=u.C,S=p.indexOf(`
`,g);return S==-1?Qn:(g=Number(p.substring(g,S)),isNaN(g)?kr:(S+=1,S+g>p.length?Qn:(p=p.slice(S,S+g),u.C=S+g,p)))}Ee.prototype.cancel=function(){this.K=!0,Ai(this)};function Jr(u){u.T=Date.now()+u.H,Zr(u,u.H)}function Zr(u,p){if(u.D!=null)throw Error("WatchDog timer not null");u.D=Pr(d(u.aa,u),p)}function Ro(u){u.D&&(o.clearTimeout(u.D),u.D=null)}Ee.prototype.aa=function(){this.D=null;const u=Date.now();u-this.T>=0?(hu(this.i,this.B),this.M!=2&&(Bt(),Ye(17)),Ai(this),this.m=2,es(this)):Zr(this,this.T-u)};function es(u){u.j.I==0||u.K||I_(u.j,u)}function Ai(u){Ro(u);var p=u.O;p&&typeof p.dispose=="function"&&p.dispose(),u.O=null,ke(u.V),u.g&&(p=u.g,u.g=null,p.abort(),p.dispose())}function Lf(u,p){try{var g=u.j;if(g.I!=0&&(g.g==u||Vf(g.h,u))){if(!u.L&&Vf(g.h,u)&&g.I==3){try{var S=g.Ba.g.parse(p)}catch{S=null}if(Array.isArray(S)&&S.length==3){var V=S;if(V[0]==0){e:if(!g.v){if(g.g)if(g.g.F+3e3<u.F)_u(g),yu(g);else break e;zf(g),Ye(18)}}else g.xa=V[1],0<g.xa-g.K&&V[2]<37500&&g.F&&g.A==0&&!g.C&&(g.C=Pr(d(g.Va,g),6e3));t_(g.h)<=1&&g.ta&&(g.ta=void 0)}else Ni(g,11)}else if((u.L||g.g==u)&&_u(g),!k(p))for(V=g.Ba.g.parse(p),p=0;p<V.length;p++){let st=V[p];const qt=st[0];if(!(qt<=g.K))if(g.K=qt,st=st[1],g.I==2)if(st[0]=="c"){g.M=st[1],g.ba=st[2];const jr=st[3];jr!=null&&(g.ka=jr,g.j.info("VER="+g.ka));const Pi=st[4];Pi!=null&&(g.za=Pi,g.j.info("SVER="+g.za));const Rs=st[5];Rs!=null&&typeof Rs=="number"&&Rs>0&&(S=1.5*Rs,g.O=S,g.j.info("backChannelRequestTimeoutMs_="+S)),S=g;const Ns=u.g;if(Ns){const Eu=Ns.g?Ns.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Eu){var $=S.h;$.g||Eu.indexOf("spdy")==-1&&Eu.indexOf("quic")==-1&&Eu.indexOf("h2")==-1||($.j=$.l,$.g=new Set,$.h&&(Mf($,$.h),$.h=null))}if(S.G){const Hf=Ns.g?Ns.g.getResponseHeader("X-HTTP-Session-Id"):null;Hf&&(S.wa=Hf,at(S.J,S.G,Hf))}}g.I=3,g.l&&g.l.ra(),g.aa&&(g.T=Date.now()-u.F,g.j.info("Handshake RTT: "+g.T+"ms")),S=g;var ne=u;if(S.na=S_(S,S.L?S.ba:null,S.W),ne.L){n_(S.h,ne);var je=ne,Vt=S.O;Vt&&(je.H=Vt),je.D&&(Ro(je),Jr(je)),S.g=ne}else E_(S);g.i.length>0&&vu(g)}else st[0]!="stop"&&st[0]!="close"||Ni(g,7);else g.I==3&&(st[0]=="stop"||st[0]=="close"?st[0]=="stop"?Ni(g,7):Bf(g):st[0]!="noop"&&g.l&&g.l.qa(st),g.A=0)}}Bt(4)}catch{}}var s1=class{constructor(u,p){this.g=u,this.map=p}};function Zv(u){this.l=u||10,o.PerformanceNavigationTiming?(u=o.performance.getEntriesByType("navigation"),u=u.length>0&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function e_(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function t_(u){return u.h?1:u.g?u.g.size:0}function Vf(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Mf(u,p){u.g?u.g.add(p):u.h=p}function n_(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}Zv.prototype.cancel=function(){if(this.i=r_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function r_(u){if(u.h!=null)return u.i.concat(u.h.G);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const g of u.g.values())p=p.concat(g.G);return p}return _(u.i)}var s_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function i1(u,p){if(u){u=u.split("&");for(let g=0;g<u.length;g++){const S=u[g].indexOf("=");let V,$=null;S>=0?(V=u[g].substring(0,S),$=u[g].substring(S+1)):V=u[g],p(V,$?decodeURIComponent($.replace(/\+/g," ")):"")}}}function Ss(u){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;u instanceof Ss?(this.l=u.l,sl(this,u.j),this.o=u.o,this.g=u.g,il(this,u.u),this.h=u.h,Ff(this,u_(u.i)),this.m=u.m):u&&(p=String(u).match(s_))?(this.l=!1,sl(this,p[1]||"",!0),this.o=ol(p[2]||""),this.g=ol(p[3]||"",!0),il(this,p[4]),this.h=ol(p[5]||"",!0),Ff(this,p[6]||"",!0),this.m=ol(p[7]||"")):(this.l=!1,this.i=new ll(null,this.l))}Ss.prototype.toString=function(){const u=[];var p=this.j;p&&u.push(al(p,i_,!0),":");var g=this.g;return(g||p=="file")&&(u.push("//"),(p=this.o)&&u.push(al(p,i_,!0),"@"),u.push(Z(g).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.u,g!=null&&u.push(":",String(g))),(g=this.h)&&(this.g&&g.charAt(0)!="/"&&u.push("/"),u.push(al(g,g.charAt(0)=="/"?l1:a1,!0))),(g=this.i.toString())&&u.push("?",g),(g=this.m)&&u.push("#",al(g,u1)),u.join("")},Ss.prototype.resolve=function(u){const p=Dr(this);let g=!!u.j;g?sl(p,u.j):g=!!u.o,g?p.o=u.o:g=!!u.g,g?p.g=u.g:g=u.u!=null;var S=u.h;if(g)il(p,u.u);else if(g=!!u.h){if(S.charAt(0)!="/")if(this.g&&!this.h)S="/"+S;else{var V=p.h.lastIndexOf("/");V!=-1&&(S=p.h.slice(0,V+1)+S)}if(V=S,V==".."||V==".")S="";else if(V.indexOf("./")!=-1||V.indexOf("/.")!=-1){S=V.lastIndexOf("/",0)==0,V=V.split("/");const $=[];for(let ne=0;ne<V.length;){const je=V[ne++];je=="."?S&&ne==V.length&&$.push(""):je==".."?(($.length>1||$.length==1&&$[0]!="")&&$.pop(),S&&ne==V.length&&$.push("")):($.push(je),S=!0)}S=$.join("/")}else S=V}return g?p.h=S:g=u.i.toString()!=="",g?Ff(p,u_(u.i)):g=!!u.m,g&&(p.m=u.m),p};function Dr(u){return new Ss(u)}function sl(u,p,g){u.j=g?ol(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function il(u,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);u.u=p}else u.u=null}function Ff(u,p,g){p instanceof ll?(u.i=p,d1(u.i,u.l)):(g||(p=al(p,c1)),u.i=new ll(p,u.l))}function at(u,p,g){u.i.set(p,g)}function pu(u){return at(u,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),u}function ol(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function al(u,p,g){return typeof u=="string"?(u=encodeURI(u).replace(p,o1),g&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function o1(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var i_=/[#\/\?@]/g,a1=/[#\?:]/g,l1=/[#\?]/g,c1=/[#\?@]/g,u1=/#/g;function ll(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Ri(u){u.g||(u.g=new Map,u.h=0,u.i&&i1(u.i,function(p,g){u.add(decodeURIComponent(p.replace(/\+/g," ")),g)}))}t=ll.prototype,t.add=function(u,p){Ri(this),this.i=null,u=No(this,u);let g=this.g.get(u);return g||this.g.set(u,g=[]),g.push(p),this.h+=1,this};function o_(u,p){Ri(u),p=No(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function a_(u,p){return Ri(u),p=No(u,p),u.g.has(p)}t.forEach=function(u,p){Ri(this),this.g.forEach(function(g,S){g.forEach(function(V){u.call(p,V,S,this)},this)},this)};function l_(u,p){Ri(u);let g=[];if(typeof p=="string")a_(u,p)&&(g=g.concat(u.g.get(No(u,p))));else for(u=Array.from(u.g.values()),p=0;p<u.length;p++)g=g.concat(u[p]);return g}t.set=function(u,p){return Ri(this),this.i=null,u=No(this,u),a_(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},t.get=function(u,p){return u?(u=l_(this,u),u.length>0?String(u[0]):p):p};function c_(u,p,g){o_(u,p),g.length>0&&(u.i=null,u.g.set(No(u,p),_(g)),u.h+=g.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(let S=0;S<p.length;S++){var g=p[S];const V=Z(g);g=l_(this,g);for(let $=0;$<g.length;$++){let ne=V;g[$]!==""&&(ne+="="+Z(g[$])),u.push(ne)}}return this.i=u.join("&")};function u_(u){const p=new ll;return p.i=u.i,u.g&&(p.g=new Map(u.g),p.h=u.h),p}function No(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function d1(u,p){p&&!u.j&&(Ri(u),u.i=null,u.g.forEach(function(g,S){const V=S.toLowerCase();S!=V&&(o_(this,S),c_(this,V,g))},u)),u.j=p}function h1(u,p){const g=new dr;if(o.Image){const S=new Image;S.onload=h(Cs,g,"TestLoadImage: loaded",!0,p,S),S.onerror=h(Cs,g,"TestLoadImage: error",!1,p,S),S.onabort=h(Cs,g,"TestLoadImage: abort",!1,p,S),S.ontimeout=h(Cs,g,"TestLoadImage: timeout",!1,p,S),o.setTimeout(function(){S.ontimeout&&S.ontimeout()},1e4),S.src=u}else p(!1)}function f1(u,p){const g=new dr,S=new AbortController,V=setTimeout(()=>{S.abort(),Cs(g,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:S.signal}).then($=>{clearTimeout(V),$.ok?Cs(g,"TestPingServer: ok",!0,p):Cs(g,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(V),Cs(g,"TestPingServer: error",!1,p)})}function Cs(u,p,g,S,V){try{V&&(V.onload=null,V.onerror=null,V.onabort=null,V.ontimeout=null),S(g)}catch{}}function p1(){this.g=new J}function Uf(u){this.i=u.Sb||null,this.h=u.ab||!1}f(Uf,te),Uf.prototype.g=function(){return new mu(this.i,this.h)};function mu(u,p){z.call(this),this.H=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}f(mu,z),t=mu.prototype,t.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=u,this.D=p,this.readyState=1,ul(this)},t.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};u&&(p.body=u),(this.H||o).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,cl(this)),this.readyState=0},t.Pa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,ul(this)),this.g&&(this.readyState=3,ul(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;d_(this)}else u.text().then(this.Oa.bind(this),this.ga.bind(this))};function d_(u){u.j.read().then(u.Ma.bind(u)).catch(u.ga.bind(u))}t.Ma=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?cl(this):ul(this),this.readyState==3&&d_(this)}},t.Oa=function(u){this.g&&(this.response=this.responseText=u,cl(this))},t.Na=function(u){this.g&&(this.response=u,cl(this))},t.ga=function(){this.g&&cl(this)};function cl(u){u.readyState=4,u.l=null,u.j=null,u.B=null,ul(u)}t.setRequestHeader=function(u,p){this.A.append(u,p)},t.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var g=p.next();!g.done;)g=g.value,u.push(g[0]+": "+g[1]),g=p.next();return u.join(`\r
`)};function ul(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(mu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function h_(u){let p="";return me(u,function(g,S){p+=S,p+=":",p+=g,p+=`\r
`}),p}function $f(u,p,g){e:{for(S in g){var S=!1;break e}S=!0}S||(g=h_(g),typeof u=="string"?g!=null&&Z(g):at(u,p,g))}function wt(u){z.call(this),this.headers=new Map,this.L=u||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}f(wt,z);var m1=/^https?$/i,g1=["POST","PUT"];t=wt.prototype,t.Fa=function(u){this.H=u},t.ea=function(u,p,g,S){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():T.g(),this.g.onreadystatechange=m(d(this.Ca,this));try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch($){f_(this,$);return}if(u=g||"",g=new Map(this.headers),S)if(Object.getPrototypeOf(S)===Object.prototype)for(var V in S)g.set(V,S[V]);else if(typeof S.keys=="function"&&typeof S.get=="function")for(const $ of S.keys())g.set($,S.get($));else throw Error("Unknown input type for opt_headers: "+String(S));S=Array.from(g.keys()).find($=>$.toLowerCase()=="content-type"),V=o.FormData&&u instanceof o.FormData,!(Array.prototype.indexOf.call(g1,p,void 0)>=0)||S||V||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[$,ne]of g)this.g.setRequestHeader($,ne);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(u),this.v=!1}catch($){f_(this,$)}};function f_(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.o=5,p_(u),gu(u)}function p_(u){u.A||(u.A=!0,oe(u,"complete"),oe(u,"error"))}t.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=u||7,oe(this,"complete"),oe(this,"abort"),gu(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gu(this,!0)),wt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?m_(this):this.Xa())},t.Xa=function(){m_(this)};function m_(u){if(u.h&&typeof i<"u"){if(u.v&&As(u)==4)setTimeout(u.Ca.bind(u),0);else if(oe(u,"readystatechange"),As(u)==4){u.h=!1;try{const $=u.ca();e:switch($){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var g;if(!(g=p)){var S;if(S=$===0){let ne=String(u.D).match(s_)[1]||null;!ne&&o.self&&o.self.location&&(ne=o.self.location.protocol.slice(0,-1)),S=!m1.test(ne?ne.toLowerCase():"")}g=S}if(g)oe(u,"complete"),oe(u,"success");else{u.o=6;try{var V=As(u)>2?u.g.statusText:""}catch{V=""}u.l=V+" ["+u.ca()+"]",p_(u)}}finally{gu(u)}}}}function gu(u,p){if(u.g){u.m&&(clearTimeout(u.m),u.m=null);const g=u.g;u.g=null,p||oe(u,"ready");try{g.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function As(u){return u.g?u.g.readyState:0}t.ca=function(){try{return As(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),M(p)}};function g_(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.F){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function y1(u){const p={};u=(u.g&&As(u)>=2&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let S=0;S<u.length;S++){if(k(u[S]))continue;var g=ye(u[S]);const V=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const $=p[V]||[];p[V]=$,$.push(g)}_e(p,function(S){return S.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function dl(u,p,g){return g&&g.internalChannelParams&&g.internalChannelParams[u]||p}function y_(u){this.za=0,this.i=[],this.j=new dr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=dl("failFast",!1,u),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=dl("baseRetryDelayMs",5e3,u),this.Za=dl("retryDelaySeedMs",1e4,u),this.Ta=dl("forwardChannelMaxRetries",2,u),this.va=dl("forwardChannelRequestTimeoutMs",2e4,u),this.ma=u&&u.xmlHttpFactory||void 0,this.Ua=u&&u.Rb||void 0,this.Aa=u&&u.useFetchStreams||!1,this.O=void 0,this.L=u&&u.supportsCrossDomainXhr||!1,this.M="",this.h=new Zv(u&&u.concurrentRequestLimit),this.Ba=new p1,this.S=u&&u.fastHandshake||!1,this.R=u&&u.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=u&&u.Pb||!1,u&&u.ua&&this.j.ua(),u&&u.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&u&&u.detectBufferingProxy||!1,this.ia=void 0,u&&u.longPollingTimeout&&u.longPollingTimeout>0&&(this.ia=u.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=y_.prototype,t.ka=8,t.I=1,t.connect=function(u,p,g,S){Ye(0),this.W=u,this.H=p||{},g&&S!==void 0&&(this.H.OSID=g,this.H.OAID=S),this.F=this.X,this.J=S_(this,null,this.W),vu(this)};function Bf(u){if(v_(u),u.I==3){var p=u.V++,g=Dr(u.J);if(at(g,"SID",u.M),at(g,"RID",p),at(g,"TYPE","terminate"),hl(u,g),p=new Ee(u,u.j,p),p.M=2,p.A=pu(Dr(g)),g=!1,o.navigator&&o.navigator.sendBeacon)try{g=o.navigator.sendBeacon(p.A.toString(),"")}catch{}!g&&o.Image&&(new Image().src=p.A,g=!0),g||(p.g=C_(p.j,null),p.g.ea(p.A)),p.F=Date.now(),Jr(p)}T_(u)}function yu(u){u.g&&(qf(u),u.g.cancel(),u.g=null)}function v_(u){yu(u),u.v&&(o.clearTimeout(u.v),u.v=null),_u(u),u.h.cancel(),u.m&&(typeof u.m=="number"&&o.clearTimeout(u.m),u.m=null)}function vu(u){if(!e_(u.h)&&!u.m){u.m=!0;var p=u.Ea;O||w(),F||(O(),F=!0),x.add(p,u),u.D=0}}function v1(u,p){return t_(u.h)>=u.h.j-(u.m?1:0)?!1:u.m?(u.i=p.G.concat(u.i),!0):u.I==1||u.I==2||u.D>=(u.Sa?0:u.Ta)?!1:(u.m=Pr(d(u.Ea,u,p),b_(u,u.D)),u.D++,!0)}t.Ea=function(u){if(this.m)if(this.m=null,this.I==1){if(!u){this.V=Math.floor(Math.random()*1e5),u=this.V++;const V=new Ee(this,this.j,u);let $=this.o;if(this.U&&($?($=Pe($),St($,this.U)):$=this.U),this.u!==null||this.R||(V.J=$,$=null),this.S)e:{for(var p=0,g=0;g<this.i.length;g++){t:{var S=this.i[g];if("__data__"in S.map&&(S=S.map.__data__,typeof S=="string")){S=S.length;break t}S=void 0}if(S===void 0)break;if(p+=S,p>4096){p=g;break e}if(p===4096||g===this.i.length-1){p=g+1;break e}}p=1e3}else p=1e3;p=w_(this,V,p),g=Dr(this.J),at(g,"RID",u),at(g,"CVER",22),this.G&&at(g,"X-HTTP-Session-Id",this.G),hl(this,g),$&&(this.R?p="headers="+Z(h_($))+"&"+p:this.u&&$f(g,this.u,$)),Mf(this.h,V),this.Ra&&at(g,"TYPE","init"),this.S?(at(g,"$req",p),at(g,"SID","null"),V.U=!0,Yn(V,g,null)):Yn(V,g,p),this.I=2}}else this.I==3&&(u?__(this,u):this.i.length==0||e_(this.h)||__(this))};function __(u,p){var g;p?g=p.l:g=u.V++;const S=Dr(u.J);at(S,"SID",u.M),at(S,"RID",g),at(S,"AID",u.K),hl(u,S),u.u&&u.o&&$f(S,u.u,u.o),g=new Ee(u,u.j,g,u.D+1),u.u===null&&(g.J=u.o),p&&(u.i=p.G.concat(u.i)),p=w_(u,g,1e3),g.H=Math.round(u.va*.5)+Math.round(u.va*.5*Math.random()),Mf(u.h,g),Yn(g,S,p)}function hl(u,p){u.H&&me(u.H,function(g,S){at(p,S,g)}),u.l&&me({},function(g,S){at(p,S,g)})}function w_(u,p,g){g=Math.min(u.i.length,g);const S=u.l?d(u.l.Ka,u.l,u):null;e:{var V=u.i;let je=-1;for(;;){const Vt=["count="+g];je==-1?g>0?(je=V[0].g,Vt.push("ofs="+je)):je=0:Vt.push("ofs="+je);let st=!0;for(let qt=0;qt<g;qt++){var $=V[qt].g;const jr=V[qt].map;if($-=je,$<0)je=Math.max(0,V[qt].g-100),st=!1;else try{$="req"+$+"_"||"";try{var ne=jr instanceof Map?jr:Object.entries(jr);for(const[Pi,Rs]of ne){let Ns=Rs;a(Rs)&&(Ns=Se(Rs)),Vt.push($+Pi+"="+encodeURIComponent(Ns))}}catch(Pi){throw Vt.push($+"type="+encodeURIComponent("_badmap")),Pi}}catch{S&&S(jr)}}if(st){ne=Vt.join("&");break e}}ne=void 0}return u=u.i.splice(0,g),p.G=u,ne}function E_(u){if(!u.g&&!u.v){u.Y=1;var p=u.Da;O||w(),F||(O(),F=!0),x.add(p,u),u.A=0}}function zf(u){return u.g||u.v||u.A>=3?!1:(u.Y++,u.v=Pr(d(u.Da,u),b_(u,u.A)),u.A++,!0)}t.Da=function(){if(this.v=null,x_(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var u=4*this.T;this.j.info("BP detection timer enabled: "+u),this.B=Pr(d(this.Wa,this),u)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ye(10),yu(this),x_(this))};function qf(u){u.B!=null&&(o.clearTimeout(u.B),u.B=null)}function x_(u){u.g=new Ee(u,u.j,"rpc",u.Y),u.u===null&&(u.g.J=u.o),u.g.P=0;var p=Dr(u.na);at(p,"RID","rpc"),at(p,"SID",u.M),at(p,"AID",u.K),at(p,"CI",u.F?"0":"1"),!u.F&&u.ia&&at(p,"TO",u.ia),at(p,"TYPE","xmlhttp"),hl(u,p),u.u&&u.o&&$f(p,u.u,u.o),u.O&&(u.g.H=u.O);var g=u.g;u=u.ba,g.M=1,g.A=pu(Dr(p)),g.u=null,g.R=!0,kt(g,u)}t.Va=function(){this.C!=null&&(this.C=null,yu(this),zf(this),Ye(19))};function _u(u){u.C!=null&&(o.clearTimeout(u.C),u.C=null)}function I_(u,p){var g=null;if(u.g==p){_u(u),qf(u),u.g=null;var S=2}else if(Vf(u.h,p))g=p.G,n_(u.h,p),S=1;else return;if(u.I!=0){if(p.o)if(S==1){g=p.u?p.u.length:0,p=Date.now()-p.F;var V=u.D;S=tn(),oe(S,new Pt(S,g)),vu(u)}else E_(u);else if(V=p.m,V==3||V==0&&p.X>0||!(S==1&&v1(u,p)||S==2&&zf(u)))switch(g&&g.length>0&&(p=u.h,p.i=p.i.concat(g)),V){case 1:Ni(u,5);break;case 4:Ni(u,10);break;case 3:Ni(u,6);break;default:Ni(u,2)}}}function b_(u,p){let g=u.Qa+Math.floor(Math.random()*u.Za);return u.isActive()||(g*=2),g*p}function Ni(u,p){if(u.j.info("Error code "+p),p==2){var g=d(u.bb,u),S=u.Ua;const V=!S;S=new Ss(S||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||sl(S,"https"),pu(S),V?h1(S.toString(),g):f1(S.toString(),g)}else Ye(2);u.I=0,u.l&&u.l.pa(p),T_(u),v_(u)}t.bb=function(u){u?(this.j.info("Successfully pinged google.com"),Ye(2)):(this.j.info("Failed to ping google.com"),Ye(1))};function T_(u){if(u.I=0,u.ja=[],u.l){const p=r_(u.h);(p.length!=0||u.i.length!=0)&&(R(u.ja,p),R(u.ja,u.i),u.h.i.length=0,_(u.i),u.i.length=0),u.l.oa()}}function S_(u,p,g){var S=g instanceof Ss?Dr(g):new Ss(g);if(S.g!="")p&&(S.g=p+"."+S.g),il(S,S.u);else{var V=o.location;S=V.protocol,p=p?p+"."+V.hostname:V.hostname,V=+V.port;const $=new Ss(null);S&&sl($,S),p&&($.g=p),V&&il($,V),g&&($.h=g),S=$}return g=u.G,p=u.wa,g&&p&&at(S,g,p),at(S,"VER",u.ka),hl(u,S),S}function C_(u,p,g){if(p&&!u.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Aa&&!u.ma?new wt(new Uf({ab:g})):new wt(u.ma),p.Fa(u.L),p}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function A_(){}t=A_.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function wu(){}wu.prototype.g=function(u,p){return new Ln(u,p)};function Ln(u,p){z.call(this),this.g=new y_(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(u?u["X-WebChannel-Client-Profile"]=p.sa:u={"X-WebChannel-Client-Profile":p.sa}),this.g.U=u,(u=p&&p.Qb)&&!k(u)&&(this.g.u=u),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!k(p)&&(this.g.G=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Po(this)}f(Ln,z),Ln.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ln.prototype.close=function(){Bf(this.g)},Ln.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var g={};g.__data__=u,u=g}else this.v&&(g={},g.__data__=Se(u),u=g);p.i.push(new s1(p.Ya++,u)),p.I==3&&vu(p)},Ln.prototype.N=function(){this.g.l=null,delete this.j,Bf(this.g),delete this.g,Ln.Z.N.call(this)};function R_(u){Rt.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const g in p){u=g;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}f(R_,Rt);function N_(){Nr.call(this),this.status=1}f(N_,Nr);function Po(u){this.g=u}f(Po,A_),Po.prototype.ra=function(){oe(this.g,"a")},Po.prototype.qa=function(u){oe(this.g,new R_(u))},Po.prototype.pa=function(u){oe(this.g,new N_)},Po.prototype.oa=function(){oe(this.g,"b")},wu.prototype.createWebChannel=wu.prototype.g,Ln.prototype.send=Ln.prototype.o,Ln.prototype.open=Ln.prototype.m,Ln.prototype.close=Ln.prototype.close,cS=function(){return new wu},lS=function(){return tn()},aS=In,Jm={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ci.NO_ERROR=0,Ci.TIMEOUT=8,Ci.HTTP_ERROR=6,gd=Ci,rl.COMPLETE="complete",oS=rl,Ne.EventType=rt,rt.OPEN="a",rt.CLOSE="b",rt.ERROR="c",rt.MESSAGE="d",z.prototype.listen=z.prototype.J,Vl=Ne,wt.prototype.listenOnce=wt.prototype.K,wt.prototype.getLastError=wt.prototype.Ha,wt.prototype.getLastErrorCode=wt.prototype.ya,wt.prototype.getStatus=wt.prototype.ca,wt.prototype.getResponseJson=wt.prototype.La,wt.prototype.getResponseText=wt.prototype.la,wt.prototype.send=wt.prototype.ea,wt.prototype.setWithCredentials=wt.prototype.Fa,iS=wt}).apply(typeof $u<"u"?$u:typeof self<"u"?self:typeof window<"u"?window:{});const TE="@firebase/firestore",SE="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Xt.UNAUTHENTICATED=new Xt(null),Xt.GOOGLE_CREDENTIALS=new Xt("google-credentials-uid"),Xt.FIRST_PARTY=new Xt("first-party-uid"),Xt.MOCK_USER=new Xt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ja="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lo=new Kh("@firebase/firestore");function Wo(){return lo.logLevel}function Q(t,...e){if(lo.logLevel<=$e.DEBUG){const n=e.map($y);lo.debug(`Firestore (${Ja}): ${t}`,...n)}}function mn(t,...e){if(lo.logLevel<=$e.ERROR){const n=e.map($y);lo.error(`Firestore (${Ja}): ${t}`,...n)}}function co(t,...e){if(lo.logLevel<=$e.WARN){const n=e.map($y);lo.warn(`Firestore (${Ja}): ${t}`,...n)}}function $y(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pe(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,uS(t,r,n)}function uS(t,e,n){let r=`FIRESTORE (${Ja}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw mn(r),new Error(r)}function ve(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||uS(e,s,r)}function Te(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class X extends ur{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dS{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class lO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Xt.UNAUTHENTICATED))}shutdown(){}}class cO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class uO{constructor(e){this.t=e,this.currentUser=Xt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){ve(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let i=new xr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new xr,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{Q("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(Q("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new xr)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(Q("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ve(typeof r.accessToken=="string",31837,{l:r}),new dS(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ve(e===null||typeof e=="string",2055,{h:e}),new Xt(e)}}class dO{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=Xt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class hO{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new dO(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(Xt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class CE{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class fO{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,er(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){ve(this.o===void 0,3512);const r=i=>{i.error!=null&&Q("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,Q("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Q("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):Q("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new CE(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(ve(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new CE(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pO(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=pO(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%62))}return r}}function Ae(t,e){return t<e?-1:t>e?1:0}function Zm(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),i=e.charAt(r);if(s!==i)return Cp(s)===Cp(i)?Ae(s,i):Cp(s)?1:-1}return Ae(t.length,e.length)}const mO=55296,gO=57343;function Cp(t){const e=t.charCodeAt(0);return e>=mO&&e<=gO}function Na(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function hS(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AE="__name__";class Fr{constructor(e,n,r){n===void 0?n=0:n>e.length&&pe(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&pe(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Fr.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Fr?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=Fr.compareSegments(e.get(s),n.get(s));if(i!==0)return i}return Ae(e.length,n.length)}static compareSegments(e,n){const r=Fr.isNumericId(e),s=Fr.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?Fr.extractNumericId(e).compare(Fr.extractNumericId(n)):Zm(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return li.fromString(e.substring(4,e.length-2))}}class Ge extends Fr{construct(e,n,r){return new Ge(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new X(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Ge(n)}static emptyPath(){return new Ge([])}}const yO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class yt extends Fr{construct(e,n,r){return new yt(e,n,r)}static isValidIdentifier(e){return yO.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),yt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===AE}static keyField(){return new yt([AE])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new X(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new X(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new X(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new X(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new yt(n)}static emptyPath(){return new yt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(e){this.path=e}static fromPath(e){return new se(Ge.fromString(e))}static fromName(e){return new se(Ge.fromString(e).popFirst(5))}static empty(){return new se(Ge.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ge.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ge.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new Ge(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fS(t,e,n){if(!n)throw new X(q.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function vO(t,e,n,r){if(e===!0&&r===!0)throw new X(q.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function RE(t){if(!se.isDocumentKey(t))throw new X(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function NE(t){if(se.isDocumentKey(t))throw new X(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function pS(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function ef(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":pe(12329,{type:typeof t})}function un(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new X(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ef(t);throw new X(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function _O(t,e){if(e<=0)throw new X(q.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ot(t,e){const n={typeString:t};return e&&(n.value=e),n}function Zc(t,e){if(!pS(t))throw new X(q.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const o=t[r];if(s&&typeof o!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new X(q.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PE=-62135596800,kE=1e6;class qe{static now(){return qe.fromMillis(Date.now())}static fromDate(e){return qe.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*kE);return new qe(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new X(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new X(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<PE)throw new X(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new X(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/kE}_compareTo(e){return this.seconds===e.seconds?Ae(this.nanoseconds,e.nanoseconds):Ae(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:qe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Zc(e,qe._jsonSchema))return new qe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-PE;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}qe._jsonSchemaVersion="firestore/timestamp/1.0",qe._jsonSchema={type:Ot("string",qe._jsonSchemaVersion),seconds:Ot("number"),nanoseconds:Ot("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{static fromTimestamp(e){return new we(e)}static min(){return new we(new qe(0,0))}static max(){return new we(new qe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nc=-1;class lh{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function eg(t){return t.fields.find(e=>e.kind===2)}function Li(t){return t.fields.filter(e=>e.kind!==2)}lh.UNKNOWN_ID=-1;class yd{constructor(e,n){this.fieldPath=e,this.kind=n}}class Pc{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Pc(0,Wn.min())}}function wO(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=we.fromTimestamp(r===1e9?new qe(n+1,0):new qe(n,r));return new Wn(s,se.empty(),e)}function mS(t){return new Wn(t.readTime,t.key,Nc)}class Wn{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Wn(we.min(),se.empty(),Nc)}static max(){return new Wn(we.max(),se.empty(),Nc)}}function zy(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=se.comparator(t.documentKey,e.documentKey),n!==0?n:Ae(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Co(t){if(t.code!==q.FAILED_PRECONDITION||t.message!==gS)throw t;Q("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&pe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new L((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof L?n:L.resolve(n)}catch(n){return L.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):L.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):L.reject(n)}static resolve(e){return new L((n,r)=>{n(e)})}static reject(e){return new L((n,r)=>{r(e)})}static waitFor(e){return new L((n,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&n()},c=>r(c))}),o=!0,i===s&&n()})}static or(e){let n=L.resolve(!1);for(const r of e)n=n.next(s=>s?L.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new L((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let c=0;c<i;c++){const d=c;n(e[d]).next(h=>{o[d]=h,++a,a===i&&r(o)},h=>s(h))}})}static doWhile(e,n){return new L((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fn="SimpleDb";class tf{static open(e,n,r,s){try{return new tf(n,e.transaction(s,r))}catch(i){throw new tc(n,i)}}constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.S=new xr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{n.error?this.S.reject(new tc(e,n.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=qy(r.target.error);this.S.reject(new tc(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(Q(Fn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new xO(n)}}class ci{static delete(e){return Q(Fn,"Removing database:",e),Mi(aT().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Ry())return!1;if(ci.F())return!0;const e=Ut(),n=ci.M(e),r=0<n&&n<10,s=vS(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,n){return e.store(n)}static M(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,n,r){this.name=e,this.version=n,this.N=r,this.B=null,ci.M(Ut())===12.2&&mn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(Q(Fn,"Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;n(o)},s.onblocked=()=>{r(new tc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new X(q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new X(q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new tc(e,o))},s.onupgradeneeded=i=>{Q(Fn,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{Q(Fn,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=n=>this.q(n)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=tf.open(this.db,e,i?"readonly":"readwrite",r),c=s(a).next(d=>(a.C(),d)).catch(d=>(a.abort(d),L.reject(d))).toPromise();return c.catch(()=>{}),await a.D,c}catch(a){const c=a,d=c.name!=="FirebaseError"&&o<3;if(Q(Fn,"Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function vS(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class EO{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Mi(this.U.delete())}}class tc extends X{constructor(e,n){super(q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function bi(t){return t.name==="IndexedDbTransactionError"}class xO{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(Q(Fn,"PUT",this.store.name,e,n),r=this.store.put(n,e)):(Q(Fn,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Mi(r)}add(e){return Q(Fn,"ADD",this.store.name,e,e),Mi(this.store.add(e))}get(e){return Mi(this.store.get(e)).next(n=>(n===void 0&&(n=null),Q(Fn,"GET",this.store.name,e,n),n))}delete(e){return Q(Fn,"DELETE",this.store.name,e),Mi(this.store.delete(e))}count(){return Q(Fn,"COUNT",this.store.name),Mi(this.store.count())}J(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new L((o,a)=>{i.onerror=c=>{a(c.target.error)},i.onsuccess=c=>{o(c.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,c)=>{o.push(c)}).next(()=>o)}}Y(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new L((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,n){Q(Fn,"DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.H(s,n)}te(e){const n=this.cursor({});return new L((r,s)=>{n.onerror=i=>{const o=qy(i.target.error);s(o)},n.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,n){const r=[];return new L((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const c=new EO(a),d=n(a.primaryKey,a.value,c);if(d instanceof L){const h=d.catch(f=>(c.done(),L.reject(f)));r.push(h)}c.isDone?s():c.G===null?a.continue():a.continue(c.G)}}).next(()=>L.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function Mi(t){return new L((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=qy(r.target.error);n(s)}})}let DE=!1;function qy(t){const e=ci.M(Ut());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new X("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return DE||(DE=!0,setTimeout(()=>{throw r},0)),r}}return t}const nc="IndexBackfiller";class IO{constructor(e,n){this.asyncQueue=e,this.ne=n,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){Q(nc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const n=await this.ne.ie();Q(nc,`Documents written: ${n}`)}catch(n){bi(n)?Q(nc,"Ignoring IndexedDB error during index backfill: ",n):await Co(n)}await this.re(6e4)})}}class bO{constructor(e,n){this.localStore=e,this.persistence=n}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.se(n,e))}se(e,n){const r=new Set;let s=n,i=!0;return L.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return Q(nc,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>n-s)}oe(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(Q(nc,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,n,a))).next(()=>o.size)}))}_e(e,n){let r=e;return n.changes.forEach((s,i)=>{const o=mS(i);zy(o,r)>0&&(r=o)}),new Wn(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}rr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yi=-1;function nf(t){return t==null}function kc(t){return t===0&&1/t==-1/0}function TO(t){return typeof t=="number"&&Number.isInteger(t)&&!kc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch="";function dn(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=jE(e)),e=SO(t.get(n),e);return jE(e)}function SO(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case ch:n+="";break;default:n+=i}}return n}function jE(t){return t+ch+""}function $r(t){const e=t.length;if(ve(e>=2,64408,{path:t}),e===2)return ve(t.charAt(0)===ch&&t.charAt(1)==="",56145,{path:t}),Ge.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const o=t.indexOf(ch,i);switch((o<0||o>n)&&pe(50515,{path:t}),t.charAt(o+1)){case"":const a=t.substring(i,o);let c;s.length===0?c=a:(s+=a,c=s,s=""),r.push(c);break;case"":s+=t.substring(i,o),s+="\0";break;case"":s+=t.substring(i,o+1);break;default:pe(61167,{path:t})}i=o+2}return new Ge(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vi="remoteDocuments",eu="owner",Do="owner",Dc="mutationQueues",CO="userId",gr="mutations",OE="batchId",Wi="userMutationsIndex",LE=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vd(t,e){return[t,dn(e)]}function _S(t,e,n){return[t,dn(e),n]}const AO={},Pa="documentMutations",uh="remoteDocumentsV14",RO=["prefixPath","collectionGroup","readTime","documentId"],_d="documentKeyIndex",NO=["prefixPath","collectionGroup","documentId"],wS="collectionGroupIndex",PO=["collectionGroup","readTime","prefixPath","documentId"],jc="remoteDocumentGlobal",tg="remoteDocumentGlobalKey",ka="targets",ES="queryTargetsIndex",kO=["canonicalId","targetId"],Da="targetDocuments",DO=["targetId","path"],Hy="documentTargetsIndex",jO=["path","targetId"],dh="targetGlobalKey",Xi="targetGlobal",Oc="collectionParents",OO=["collectionId","parent"],ja="clientMetadata",LO="clientId",rf="bundles",VO="bundleId",sf="namedQueries",MO="name",Wy="indexConfiguration",FO="indexId",ng="collectionGroupIndex",UO="collectionGroup",rc="indexState",$O=["indexId","uid"],xS="sequenceNumberIndex",BO=["uid","sequenceNumber"],sc="indexEntries",zO=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],IS="documentKeyIndex",qO=["indexId","uid","orderedDocumentKey"],of="documentOverlays",HO=["userId","collectionPath","documentId"],rg="collectionPathOverlayIndex",WO=["userId","collectionPath","largestBatchId"],bS="collectionGroupOverlayIndex",GO=["userId","collectionGroup","largestBatchId"],Gy="globals",KO="name",TS=[Dc,gr,Pa,Vi,ka,eu,Xi,Da,ja,jc,Oc,rf,sf],QO=[...TS,of],SS=[Dc,gr,Pa,uh,ka,eu,Xi,Da,ja,jc,Oc,rf,sf,of],CS=SS,Ky=[...CS,Wy,rc,sc],YO=Ky,AS=[...Ky,Gy],XO=AS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sg extends yS{constructor(e,n){super(),this.le=e,this.currentSequenceNumber=n}}function $t(t,e){const n=Te(t);return ci.O(n.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VE(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ti(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function JO(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function RS(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e,n){this.comparator=e,this.root=n||Jt.EMPTY}insert(e,n){return new pt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Jt.BLACK,null,null))}remove(e){return new pt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Jt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bu(this.root,e,this.comparator,!0)}}class Bu{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Jt{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??Jt.RED,this.left=s??Jt.EMPTY,this.right=i??Jt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new Jt(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Jt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return Jt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Jt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Jt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw pe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw pe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw pe(27949);return e+(this.isRed()?0:1)}}Jt.EMPTY=null,Jt.RED=!0,Jt.BLACK=!1;Jt.EMPTY=new class{constructor(){this.size=0}get key(){throw pe(57766)}get value(){throw pe(16141)}get color(){throw pe(16727)}get left(){throw pe(29726)}get right(){throw pe(36894)}copy(e,n,r,s,i){return this}insert(e,n,r){return new Jt(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e){this.comparator=e,this.data=new pt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new ME(this.data.getIterator())}getIteratorFrom(e){return new ME(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof tt)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new tt(this.comparator);return n.data=e,n}}class ME{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function jo(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{constructor(e){this.fields=e,e.sort(yt.comparator)}static empty(){return new An([])}unionWith(e){let n=new tt(yt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new An(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Na(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new NS("Invalid base64 string: "+i):i}}(e);return new Lt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Lt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ae(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Lt.EMPTY_BYTE_STRING=new Lt("");const ZO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _s(t){if(ve(!!t,39018),typeof t=="string"){let e=0;const n=ZO.exec(t);if(ve(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:dt(t.seconds),nanos:dt(t.nanos)}}function dt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ws(t){return typeof t=="string"?Lt.fromBase64String(t):Lt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PS="server_timestamp",kS="__type__",DS="__previous_value__",jS="__local_write_time__";function af(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[kS])==null?void 0:r.stringValue)===PS}function lf(t){const e=t.mapValue.fields[DS];return af(e)?lf(e):e}function Lc(t){const e=_s(t.mapValue.fields[jS].timestampValue);return new qe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eL{constructor(e,n,r,s,i,o,a,c,d,h){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=h}}const hh="(default)";class uo{constructor(e,n){this.projectId=e,this.database=n||hh}static empty(){return new uo("","")}get isDefaultDatabase(){return this.database===hh}isEqual(e){return e instanceof uo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy="__type__",OS="__max__",Ys={mapValue:{fields:{__type__:{stringValue:OS}}}},Yy="__vector__",Oa="value",wd={nullValue:"NULL_VALUE"};function fi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?af(t)?4:LS(t)?9007199254740991:cf(t)?10:11:pe(28295,{value:t})}function Yr(t,e){if(t===e)return!0;const n=fi(t);if(n!==fi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Lc(t).isEqual(Lc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=_s(s.timestampValue),a=_s(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return ws(s.bytesValue).isEqual(ws(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return dt(s.geoPointValue.latitude)===dt(i.geoPointValue.latitude)&&dt(s.geoPointValue.longitude)===dt(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return dt(s.integerValue)===dt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=dt(s.doubleValue),a=dt(i.doubleValue);return o===a?kc(o)===kc(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return Na(t.arrayValue.values||[],e.arrayValue.values||[],Yr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(VE(o)!==VE(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Yr(o[c],a[c])))return!1;return!0}(t,e);default:return pe(52216,{left:t})}}function Vc(t,e){return(t.values||[]).find(n=>Yr(n,e))!==void 0}function pi(t,e){if(t===e)return 0;const n=fi(t),r=fi(e);if(n!==r)return Ae(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ae(t.booleanValue,e.booleanValue);case 2:return function(i,o){const a=dt(i.integerValue||i.doubleValue),c=dt(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(t,e);case 3:return FE(t.timestampValue,e.timestampValue);case 4:return FE(Lc(t),Lc(e));case 5:return Zm(t.stringValue,e.stringValue);case 6:return function(i,o){const a=ws(i),c=ws(o);return a.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),c=o.split("/");for(let d=0;d<a.length&&d<c.length;d++){const h=Ae(a[d],c[d]);if(h!==0)return h}return Ae(a.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ae(dt(i.latitude),dt(o.latitude));return a!==0?a:Ae(dt(i.longitude),dt(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return UE(t.arrayValue,e.arrayValue);case 10:return function(i,o){var m,_,R,A;const a=i.fields||{},c=o.fields||{},d=(m=a[Oa])==null?void 0:m.arrayValue,h=(_=c[Oa])==null?void 0:_.arrayValue,f=Ae(((R=d==null?void 0:d.values)==null?void 0:R.length)||0,((A=h==null?void 0:h.values)==null?void 0:A.length)||0);return f!==0?f:UE(d,h)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===Ys.mapValue&&o===Ys.mapValue)return 0;if(i===Ys.mapValue)return 1;if(o===Ys.mapValue)return-1;const a=i.fields||{},c=Object.keys(a),d=o.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let f=0;f<c.length&&f<h.length;++f){const m=Zm(c[f],h[f]);if(m!==0)return m;const _=pi(a[c[f]],d[h[f]]);if(_!==0)return _}return Ae(c.length,h.length)}(t.mapValue,e.mapValue);default:throw pe(23264,{he:n})}}function FE(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ae(t,e);const n=_s(t),r=_s(e),s=Ae(n.seconds,r.seconds);return s!==0?s:Ae(n.nanos,r.nanos)}function UE(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=pi(n[s],r[s]);if(i)return i}return Ae(n.length,r.length)}function La(t){return ig(t)}function ig(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=_s(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return ws(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return se.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=ig(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${ig(n.fields[o])}`;return s+"}"}(t.mapValue):pe(61005,{value:t})}function Ed(t){switch(fi(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=lf(t);return e?16+Ed(e):16;case 5:return 2*t.stringValue.length;case 6:return ws(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Ed(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return Ti(r.fields,(i,o)=>{s+=i.length+Ed(o)}),s}(t.mapValue);default:throw pe(13486,{value:t})}}function ho(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function og(t){return!!t&&"integerValue"in t}function Mc(t){return!!t&&"arrayValue"in t}function $E(t){return!!t&&"nullValue"in t}function BE(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function xd(t){return!!t&&"mapValue"in t}function cf(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[Qy])==null?void 0:r.stringValue)===Yy}function ic(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Ti(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=ic(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=ic(t.arrayValue.values[n]);return e}return{...t}}function LS(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===OS}const VS={mapValue:{fields:{[Qy]:{stringValue:Yy},[Oa]:{arrayValue:{}}}}};function tL(t){return"nullValue"in t?wd:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?ho(uo.empty(),se.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?cf(t)?VS:{mapValue:{}}:pe(35942,{value:t})}function nL(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?ho(uo.empty(),se.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?VS:"mapValue"in t?cf(t)?{mapValue:{}}:Ys:pe(61959,{value:t})}function zE(t,e){const n=pi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function qE(t,e){const n=pi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e){this.value=e}static empty(){return new ln({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!xd(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=ic(n)}setAll(e){let n=yt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=a.popLast()}o?r[a.lastSegment()]=ic(o):s.push(a.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());xd(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Yr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];xd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Ti(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new ln(ic(this.value))}}function MS(t){const e=[];return Ti(t.fields,(n,r)=>{const s=new yt([n]);if(xd(r)){const i=MS(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new An(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,n,r,s,i,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new xt(e,0,we.min(),we.min(),we.min(),ln.empty(),0)}static newFoundDocument(e,n,r,s){return new xt(e,1,n,we.min(),r,s,0)}static newNoDocument(e,n){return new xt(e,2,n,we.min(),we.min(),ln.empty(),0)}static newUnknownDocument(e,n){return new xt(e,3,n,we.min(),we.min(),ln.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(we.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ln.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ln.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=we.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof xt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new xt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(e,n){this.position=e,this.inclusive=n}}function HE(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(i.field.isKeyField()?r=se.comparator(se.fromName(o.referenceValue),n.key):r=pi(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function WE(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Yr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e,n="asc"){this.field=e,this.dir=n}}function rL(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{}class Be extends FS{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new sL(e,n,r):n==="array-contains"?new aL(e,r):n==="in"?new HS(e,r):n==="not-in"?new lL(e,r):n==="array-contains-any"?new cL(e,r):new Be(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new iL(e,r):new oL(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(pi(n,this.value)):n!==null&&fi(this.value)===fi(n)&&this.matchesComparison(pi(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return pe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ze extends FS{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new Ze(e,n)}matches(e){return Va(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Va(t){return t.op==="and"}function ag(t){return t.op==="or"}function Xy(t){return US(t)&&Va(t)}function US(t){for(const e of t.filters)if(e instanceof Ze)return!1;return!0}function lg(t){if(t instanceof Be)return t.field.canonicalString()+t.op.toString()+La(t.value);if(Xy(t))return t.filters.map(e=>lg(e)).join(",");{const e=t.filters.map(n=>lg(n)).join(",");return`${t.op}(${e})`}}function $S(t,e){return t instanceof Be?function(r,s){return s instanceof Be&&r.op===s.op&&r.field.isEqual(s.field)&&Yr(r.value,s.value)}(t,e):t instanceof Ze?function(r,s){return s instanceof Ze&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&$S(o,s.filters[a]),!0):!1}(t,e):void pe(19439)}function BS(t,e){const n=t.filters.concat(e);return Ze.create(n,t.op)}function zS(t){return t instanceof Be?function(n){return`${n.field.canonicalString()} ${n.op} ${La(n.value)}`}(t):t instanceof Ze?function(n){return n.op.toString()+" {"+n.getFilters().map(zS).join(" ,")+"}"}(t):"Filter"}class sL extends Be{constructor(e,n,r){super(e,n,r),this.key=se.fromName(r.referenceValue)}matches(e){const n=se.comparator(e.key,this.key);return this.matchesComparison(n)}}class iL extends Be{constructor(e,n){super(e,"in",n),this.keys=qS("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class oL extends Be{constructor(e,n){super(e,"not-in",n),this.keys=qS("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function qS(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>se.fromName(r.referenceValue))}class aL extends Be{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Mc(n)&&Vc(n.arrayValue,this.value)}}class HS extends Be{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Vc(this.value.arrayValue,n)}}class lL extends Be{constructor(e,n){super(e,"not-in",n)}matches(e){if(Vc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Vc(this.value.arrayValue,n)}}class cL extends Be{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Mc(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Vc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uL{constructor(e,n=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function cg(t,e=null,n=[],r=[],s=null,i=null,o=null){return new uL(t,e,n,r,s,i,o)}function fo(t){const e=Te(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>lg(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),nf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>La(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>La(r)).join(",")),e.Te=n}return e.Te}function tu(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!rL(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!$S(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!WE(t.startAt,e.startAt)&&WE(t.endAt,e.endAt)}function fh(t){return se.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function ph(t,e){return t.filters.filter(n=>n instanceof Be&&n.field.isEqual(e))}function GE(t,e,n){let r=wd,s=!0;for(const i of ph(t,e)){let o=wd,a=!0;switch(i.op){case"<":case"<=":o=tL(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=wd}zE({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];zE({value:r,inclusive:s},{value:o,inclusive:n.inclusive})<0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}function KE(t,e,n){let r=Ys,s=!0;for(const i of ph(t,e)){let o=Ys,a=!0;switch(i.op){case">=":case">":o=nL(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Ys}qE({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];qE({value:r,inclusive:s},{value:o,inclusive:n.inclusive})>0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(e,n=null,r=[],s=[],i=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function dL(t,e,n,r,s,i,o,a){return new Si(t,e,n,r,s,i,o,a)}function nu(t){return new Si(t)}function QE(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Jy(t){return t.collectionGroup!==null}function va(t){const e=Te(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new tt(yt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(a=a.add(d.field))})}),a})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Fc(i,r))}),n.has(yt.keyField().canonicalString())||e.Ie.push(new Fc(yt.keyField(),r))}return e.Ie}function ir(t){const e=Te(t);return e.Ee||(e.Ee=WS(e,va(t))),e.Ee}function hL(t){const e=Te(t);return e.de||(e.de=WS(e,t.explicitOrderBy)),e.de}function WS(t,e){if(t.limitType==="F")return cg(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Fc(s.field,i)});const n=t.endAt?new mi(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new mi(t.startAt.position,t.startAt.inclusive):null;return cg(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function ug(t,e){const n=t.filters.concat([e]);return new Si(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function mh(t,e,n){return new Si(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function uf(t,e){return tu(ir(t),ir(e))&&t.limitType===e.limitType}function GS(t){return`${fo(ir(t))}|lt:${t.limitType}`}function Go(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>zS(s)).join(", ")}]`),nf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>La(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>La(s)).join(",")),`Target(${r})`}(ir(t))}; limitType=${t.limitType})`}function ru(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):se.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of va(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,a,c){const d=HE(o,a,c);return o.inclusive?d<=0:d<0}(r.startAt,va(r),s)||r.endAt&&!function(o,a,c){const d=HE(o,a,c);return o.inclusive?d>=0:d>0}(r.endAt,va(r),s))}(t,e)}function fL(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function KS(t){return(e,n)=>{let r=!1;for(const s of va(t)){const i=pL(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function pL(t,e,n){const r=t.field.isKeyField()?se.comparator(e.key,n.key):function(i,o,a){const c=o.data.field(i),d=a.data.field(i);return c!==null&&d!==null?pi(c,d):pe(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return pe(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ti(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return RS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mL=new pt(se.comparator);function Bn(){return mL}const QS=new pt(se.comparator);function Ml(...t){let e=QS;for(const n of t)e=e.insert(n.key,n);return e}function YS(t){let e=QS;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Br(){return oc()}function XS(){return oc()}function oc(){return new Is(t=>t.toString(),(t,e)=>t.isEqual(e))}const gL=new pt(se.comparator),yL=new tt(se.comparator);function Ve(...t){let e=yL;for(const n of t)e=e.add(n);return e}const vL=new tt(Ae);function _L(){return vL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zy(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:kc(e)?"-0":e}}function JS(t){return{integerValue:""+t}}function ZS(t,e){return TO(e)?JS(e):Zy(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df{constructor(){this._=void 0}}function wL(t,e,n){return t instanceof Ma?function(s,i){const o={fields:{[kS]:{stringValue:PS},[jS]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&af(i)&&(i=lf(i)),i&&(o.fields[DS]=i),{mapValue:o}}(n,e):t instanceof po?tC(t,e):t instanceof Fa?nC(t,e):function(s,i){const o=eC(s,i),a=YE(o)+YE(s.Ae);return og(o)&&og(s.Ae)?JS(a):Zy(s.serializer,a)}(t,e)}function EL(t,e,n){return t instanceof po?tC(t,e):t instanceof Fa?nC(t,e):n}function eC(t,e){return t instanceof Ua?function(r){return og(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Ma extends df{}class po extends df{constructor(e){super(),this.elements=e}}function tC(t,e){const n=rC(e);for(const r of t.elements)n.some(s=>Yr(s,r))||n.push(r);return{arrayValue:{values:n}}}class Fa extends df{constructor(e){super(),this.elements=e}}function nC(t,e){let n=rC(e);for(const r of t.elements)n=n.filter(s=>!Yr(s,r));return{arrayValue:{values:n}}}class Ua extends df{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function YE(t){return dt(t.integerValue||t.doubleValue)}function rC(t){return Mc(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(e,n){this.field=e,this.transform=n}}function xL(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof po&&s instanceof po||r instanceof Fa&&s instanceof Fa?Na(r.elements,s.elements,Yr):r instanceof Ua&&s instanceof Ua?Yr(r.Ae,s.Ae):r instanceof Ma&&s instanceof Ma}(t.transform,e.transform)}class IL{constructor(e,n){this.version=e,this.transformResults=n}}class cn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new cn}static exists(e){return new cn(void 0,e)}static updateTime(e){return new cn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Id(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class ff{}function sC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new pf(t.key,cn.none()):new Za(t.key,t.data,cn.none());{const n=t.data,r=ln.empty();let s=new tt(yt.comparator);for(let i of e.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new bs(t.key,r,new An(s.toArray()),cn.none())}}function bL(t,e,n){t instanceof Za?function(s,i,o){const a=s.value.clone(),c=JE(s.fieldTransforms,i,o.transformResults);a.setAll(c),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof bs?function(s,i,o){if(!Id(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=JE(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(iC(s)),c.setAll(a),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function ac(t,e,n,r){return t instanceof Za?function(i,o,a,c){if(!Id(i.precondition,o))return a;const d=i.value.clone(),h=ZE(i.fieldTransforms,c,o);return d.setAll(h),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof bs?function(i,o,a,c){if(!Id(i.precondition,o))return a;const d=ZE(i.fieldTransforms,c,o),h=o.data;return h.setAll(iC(i)),h.setAll(d),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(i,o,a){return Id(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function TL(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=eC(r.transform,s||null);i!=null&&(n===null&&(n=ln.empty()),n.set(r.field,i))}return n||null}function XE(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Na(r,s,(i,o)=>xL(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Za extends ff{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class bs extends ff{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function iC(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function JE(t,e,n){const r=new Map;ve(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,EL(o,a,n[s]))}return r}function ZE(t,e,n){const r=new Map;for(const s of t){const i=s.transform,o=n.data.field(s.field);r.set(s.field,wL(i,o,e))}return r}class pf extends ff{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class oC extends ff{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&bL(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=ac(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=ac(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=XS();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=n.has(s.key)?null:a;const c=sC(o,a);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(we.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ve())}isEqual(e){return this.batchId===e.batchId&&Na(this.mutations,e.mutations,(n,r)=>XE(n,r))&&Na(this.baseMutations,e.baseMutations,(n,r)=>XE(n,r))}}class tv{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){ve(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return gL}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new tv(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SL{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CL{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Dt,ze;function AL(t){switch(t){case q.OK:return pe(64938);case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0;default:return pe(15467,{code:t})}}function aC(t){if(t===void 0)return mn("GRPC error has no .code"),q.UNKNOWN;switch(t){case Dt.OK:return q.OK;case Dt.CANCELLED:return q.CANCELLED;case Dt.UNKNOWN:return q.UNKNOWN;case Dt.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case Dt.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case Dt.INTERNAL:return q.INTERNAL;case Dt.UNAVAILABLE:return q.UNAVAILABLE;case Dt.UNAUTHENTICATED:return q.UNAUTHENTICATED;case Dt.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case Dt.NOT_FOUND:return q.NOT_FOUND;case Dt.ALREADY_EXISTS:return q.ALREADY_EXISTS;case Dt.PERMISSION_DENIED:return q.PERMISSION_DENIED;case Dt.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case Dt.ABORTED:return q.ABORTED;case Dt.OUT_OF_RANGE:return q.OUT_OF_RANGE;case Dt.UNIMPLEMENTED:return q.UNIMPLEMENTED;case Dt.DATA_LOSS:return q.DATA_LOSS;default:return pe(39323,{code:t})}}(ze=Dt||(Dt={}))[ze.OK=0]="OK",ze[ze.CANCELLED=1]="CANCELLED",ze[ze.UNKNOWN=2]="UNKNOWN",ze[ze.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ze[ze.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ze[ze.NOT_FOUND=5]="NOT_FOUND",ze[ze.ALREADY_EXISTS=6]="ALREADY_EXISTS",ze[ze.PERMISSION_DENIED=7]="PERMISSION_DENIED",ze[ze.UNAUTHENTICATED=16]="UNAUTHENTICATED",ze[ze.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ze[ze.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ze[ze.ABORTED=10]="ABORTED",ze[ze.OUT_OF_RANGE=11]="OUT_OF_RANGE",ze[ze.UNIMPLEMENTED=12]="UNIMPLEMENTED",ze[ze.INTERNAL=13]="INTERNAL",ze[ze.UNAVAILABLE=14]="UNAVAILABLE",ze[ze.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NL=new li([4294967295,4294967295],0);function ex(t){const e=RL().encode(t),n=new sS;return n.update(e),new Uint8Array(n.digest())}function tx(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new li([n,r],0),new li([s,i],0)]}class rv{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Fl(`Invalid padding: ${n}`);if(r<0)throw new Fl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Fl(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Fl(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=li.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(li.fromNumber(r)));return s.compare(NL)===1&&(s=new li([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=ex(e),[r,s]=tx(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new rv(i,s,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const n=ex(e),[r,s]=tx(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Fl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,su.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new mf(we.min(),s,new pt(Ae),Bn(),Ve())}}class su{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new su(r,n,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class lC{constructor(e,n){this.targetId=e,this.Ce=n}}class cC{constructor(e,n,r=Lt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class nx{constructor(){this.ve=0,this.Fe=rx(),this.Me=Lt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ve(),n=Ve(),r=Ve();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:pe(38017,{changeType:i})}}),new su(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=rx()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ve(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class PL{constructor(e){this.Ge=e,this.ze=new Map,this.je=Bn(),this.Je=zu(),this.He=zu(),this.Ye=new pt(Ae)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:pe(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,s)=>{this.rt(s)&&n(s)})}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const i=s.target;if(fh(i))if(r===0){const o=new se(i.path);this.et(n,o,xt.newNoDocument(o,we.min()))}else ve(r===1,20013,{expectedCount:r});else{const o=this._t(n);if(o!==r){const a=this.ut(e),c=a?this.ct(a,e,o):1;if(c!==0){this.it(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,d)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let o,a;try{o=ws(r).toUint8Array()}catch(c){if(c instanceof NS)return co("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new rv(o,s,i)}catch(c){return co(c instanceof Fl?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.ge===0?null:a}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(n,i,null),s++)}),s}Tt(e){const n=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&fh(a.target)){const c=new se(a.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,xt.newNoDocument(c,e))}i.Be&&(n.set(o,i.ke()),i.qe())}});let r=Ve();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(c=>{const d=this.ot(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new mf(e,n,this.Ye,this.je,r);return this.je=Bn(),this.Je=zu(),this.He=zu(),this.Ye=new pt(Ae),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new nx,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new tt(Ae),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new tt(Ae),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Q("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new nx),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function zu(){return new pt(se.comparator)}function rx(){return new pt(se.comparator)}const kL={asc:"ASCENDING",desc:"DESCENDING"},DL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jL={and:"AND",or:"OR"};class OL{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function dg(t,e){return t.useProto3Json||nf(e)?e:{value:e}}function $a(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function uC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function LL(t,e){return $a(t,e.toTimestamp())}function _n(t){return ve(!!t,49232),we.fromTimestamp(function(n){const r=_s(n);return new qe(r.seconds,r.nanos)}(t))}function sv(t,e){return hg(t,e).canonicalString()}function hg(t,e){const n=function(s){return new Ge(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function dC(t){const e=Ge.fromString(t);return ve(_C(e),10190,{key:e.toString()}),e}function gh(t,e){return sv(t.databaseId,e.path)}function Ji(t,e){const n=dC(e);if(n.get(1)!==t.databaseId.projectId)throw new X(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new X(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new se(pC(n))}function hC(t,e){return sv(t.databaseId,e)}function fC(t){const e=dC(t);return e.length===4?Ge.emptyPath():pC(e)}function fg(t){return new Ge(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function pC(t){return ve(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function sx(t,e,n){return{name:gh(t,e),fields:n.value.mapValue.fields}}function VL(t,e,n){const r=Ji(t,e.name),s=_n(e.updateTime),i=e.createTime?_n(e.createTime):we.min(),o=new ln({mapValue:{fields:e.fields}}),a=xt.newFoundDocument(r,s,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function ML(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:pe(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,h){return d.useProto3Json?(ve(h===void 0||typeof h=="string",58123),Lt.fromBase64String(h||"")):(ve(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Lt.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(d){const h=d.code===void 0?q.UNKNOWN:aC(d.code);return new X(h,d.message||"")}(o);n=new cC(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ji(t,r.document.name),i=_n(r.document.updateTime),o=r.document.createTime?_n(r.document.createTime):we.min(),a=new ln({mapValue:{fields:r.document.fields}}),c=xt.newFoundDocument(s,i,o,a),d=r.targetIds||[],h=r.removedTargetIds||[];n=new bd(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Ji(t,r.document),i=r.readTime?_n(r.readTime):we.min(),o=xt.newNoDocument(s,i),a=r.removedTargetIds||[];n=new bd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Ji(t,r.document),i=r.removedTargetIds||[];n=new bd([],i,s,null)}else{if(!("filter"in e))return pe(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new CL(s,i),a=r.targetId;n=new lC(a,o)}}return n}function yh(t,e){let n;if(e instanceof Za)n={update:sx(t,e.key,e.value)};else if(e instanceof pf)n={delete:gh(t,e.key)};else if(e instanceof bs)n={update:sx(t,e.key,e.data),updateMask:HL(e.fieldMask)};else{if(!(e instanceof oC))return pe(16599,{Vt:e.type});n={verify:gh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof Ma)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof po)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Fa)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Ua)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw pe(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:LL(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:pe(27497)}(t,e.precondition)),n}function pg(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?cn.updateTime(_n(i.updateTime)):i.exists!==void 0?cn.exists(i.exists):cn.none()}(e.currentDocument):cn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let c=null;if("setToServerValue"in a)ve(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),c=new Ma;else if("appendMissingElements"in a){const h=a.appendMissingElements.values||[];c=new po(h)}else if("removeAllFromArray"in a){const h=a.removeAllFromArray.values||[];c=new Fa(h)}else"increment"in a?c=new Ua(o,a.increment):pe(16584,{proto:a});const d=yt.fromServerFormat(a.fieldPath);return new hf(d,c)}(t,s)):[];if(e.update){e.update.name;const s=Ji(t,e.update.name),i=new ln({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const d=c.fieldPaths||[];return new An(d.map(h=>yt.fromServerFormat(h)))}(e.updateMask);return new bs(s,i,o,n,r)}return new Za(s,i,n,r)}if(e.delete){const s=Ji(t,e.delete);return new pf(s,n)}if(e.verify){const s=Ji(t,e.verify);return new oC(s,n)}return pe(1463,{proto:e})}function FL(t,e){return t&&t.length>0?(ve(e!==void 0,14353),t.map(n=>function(s,i){let o=s.updateTime?_n(s.updateTime):_n(i);return o.isEqual(we.min())&&(o=_n(i)),new IL(o,s.transformResults||[])}(n,e))):[]}function mC(t,e){return{documents:[hC(t,e.path)]}}function iv(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=hC(t,s);const i=function(d){if(d.length!==0)return vC(Ze.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(d){if(d.length!==0)return d.map(h=>function(m){return{field:Hs(m.field),direction:BL(m.dir)}}(h))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=dg(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:n,parent:s}}function UL(t,e,n,r){const{ft:s,parent:i}=iv(t,e),o={},a=[];let c=0;return n.forEach(d=>{const h="aggregate_"+c++;o[h]=d.alias,d.aggregateType==="count"?a.push({alias:h,count:{}}):d.aggregateType==="avg"?a.push({alias:h,avg:{field:Hs(d.fieldPath)}}):d.aggregateType==="sum"&&a.push({alias:h,sum:{field:Hs(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:a,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function gC(t){let e=fC(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){ve(r===1,65062);const h=n.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];n.where&&(i=function(f){const m=yC(f);return m instanceof Ze&&Xy(m)?m.getFilters():[m]}(n.where));let o=[];n.orderBy&&(o=function(f){return f.map(m=>function(R){return new Fc(Ko(R.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(R.direction))}(m))}(n.orderBy));let a=null;n.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,nf(m)?null:m}(n.limit));let c=null;n.startAt&&(c=function(f){const m=!!f.before,_=f.values||[];return new mi(_,m)}(n.startAt));let d=null;return n.endAt&&(d=function(f){const m=!f.before,_=f.values||[];return new mi(_,m)}(n.endAt)),dL(e,s,o,i,a,"F",c,d)}function $L(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return pe(28987,{purpose:s})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function yC(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Ko(n.unaryFilter.field);return Be.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ko(n.unaryFilter.field);return Be.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ko(n.unaryFilter.field);return Be.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Ko(n.unaryFilter.field);return Be.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return pe(61313);default:return pe(60726)}}(t):t.fieldFilter!==void 0?function(n){return Be.create(Ko(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return pe(58110);default:return pe(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Ze.create(n.compositeFilter.filters.map(r=>yC(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return pe(1026)}}(n.compositeFilter.op))}(t):pe(30097,{filter:t})}function BL(t){return kL[t]}function zL(t){return DL[t]}function qL(t){return jL[t]}function Hs(t){return{fieldPath:t.canonicalString()}}function Ko(t){return yt.fromServerFormat(t.fieldPath)}function vC(t){return t instanceof Be?function(n){if(n.op==="=="){if(BE(n.value))return{unaryFilter:{field:Hs(n.field),op:"IS_NAN"}};if($E(n.value))return{unaryFilter:{field:Hs(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(BE(n.value))return{unaryFilter:{field:Hs(n.field),op:"IS_NOT_NAN"}};if($E(n.value))return{unaryFilter:{field:Hs(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hs(n.field),op:zL(n.op),value:n.value}}}(t):t instanceof Ze?function(n){const r=n.getFilters().map(s=>vC(s));return r.length===1?r[0]:{compositeFilter:{op:qL(n.op),filters:r}}}(t):pe(54877,{filter:t})}function HL(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function _C(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e,n,r,s,i=we.min(),o=we.min(),a=Lt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new as(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new as(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new as(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new as(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wC{constructor(e){this.yt=e}}function WL(t,e){let n;if(e.document)n=VL(t.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=se.fromSegments(e.noDocument.path),s=go(e.noDocument.readTime);n=xt.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return pe(56709);{const r=se.fromSegments(e.unknownDocument.path),s=go(e.unknownDocument.version);n=xt.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new qe(s[0],s[1]);return we.fromTimestamp(i)}(e.readTime)),n}function ix(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:vh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:gh(i,o.key),fields:o.data.value.mapValue.fields,updateTime:$a(i,o.version.toTimestamp()),createTime:$a(i,o.createTime.toTimestamp())}}(t.yt,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:mo(e.version)};else{if(!e.isUnknownDocument())return pe(57904,{document:e});r.unknownDocument={path:n.path.toArray(),version:mo(e.version)}}return r}function vh(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function mo(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function go(t){const e=new qe(t.seconds,t.nanoseconds);return we.fromTimestamp(e)}function Fi(t,e){const n=(e.baseMutations||[]).map(i=>pg(t.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>pg(t.yt,i)),s=qe.fromMillis(e.localWriteTimeMs);return new ev(e.batchId,s,n,r)}function Ul(t){const e=go(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?go(t.lastLimboFreeSnapshotVersion):we.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){const o=i.documents.length;return ve(o===1,1966,{count:o}),ir(nu(fC(i.documents[0])))}(t.query):function(i){return ir(gC(i))}(t.query),new as(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,Lt.fromBase64String(t.resumeToken))}function EC(t,e){const n=mo(e.snapshotVersion),r=mo(e.lastLimboFreeSnapshotVersion);let s;s=fh(e.target)?mC(t.yt,e.target):iv(t.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:fo(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function xC(t){const e=gC({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?mh(e,e.limit,"L"):e}function Ap(t,e){return new nv(e.largestBatchId,pg(t.yt,e.overlayMutation))}function ox(t,e){const n=e.path.lastSegment();return[t,dn(e.path.popLast()),n]}function ax(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:mo(r.readTime),documentKey:dn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GL{getBundleMetadata(e,n){return lx(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:go(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return lx(e).put(function(s){return{bundleId:s.id,createTime:mo(_n(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return cx(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:xC(i.bundledQuery),readTime:go(i.readTime)}}(r)})}saveNamedQuery(e,n){return cx(e).put(function(s){return{name:s.name,readTime:mo(_n(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function lx(t){return $t(t,rf)}function cx(t){return $t(t,sf)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e,n){this.serializer=e,this.userId=n}static wt(e,n){const r=n.uid||"";return new gf(e,r)}getOverlay(e,n){return xl(e).get(ox(this.userId,n)).next(r=>r?Ap(this.serializer,r):null)}getOverlays(e,n){const r=Br();return L.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,o)=>{const a=new nv(n,o);s.push(this.St(e,a))}),L.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(o=>s.add(dn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(xl(e).Z(rg,a))}),L.waitFor(i)}getOverlaysForCollection(e,n,r){const s=Br(),i=dn(n),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return xl(e).J(rg,o).next(a=>{for(const c of a){const d=Ap(this.serializer,c);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=Br();let o;const a=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return xl(e).ee({index:bS,range:a},(c,d,h)=>{const f=Ap(this.serializer,d);i.size()<s||f.largestBatchId===o?(i.set(f.getKey(),f),o=f.largestBatchId):h.done()}).next(()=>i)}St(e,n){return xl(e).put(function(s,i,o){const[a,c,d]=ox(i,o.mutation.key);return{userId:i,collectionPath:c,documentId:d,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:yh(s.yt,o.mutation)}}(this.serializer,this.userId,n))}}function xl(t){return $t(t,of)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KL{bt(e){return $t(e,Gy)}getSessionToken(e){return this.bt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?Lt.fromUint8Array(r):Lt.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.bt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(dt(e.integerValue));else if("doubleValue"in e){const r=dt(e.doubleValue);isNaN(r)?this.Ft(n,13):(this.Ft(n,15),kc(r)?n.Mt(0):n.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(n,20),typeof r=="string"&&(r=_s(r)),n.xt(`${r.seconds||""}`),n.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(ws(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(n,45),n.Mt(r.latitude||0),n.Mt(r.longitude||0)}else"mapValue"in e?LS(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):cf(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):pe(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){const r=e.fields||{};this.Ft(n,55);for(const s of Object.keys(r))this.Ot(s,n),this.Ct(r[s],n)}kt(e,n){var o,a;const r=e.fields||{};this.Ft(n,53);const s=Oa,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(n,15),n.Mt(dt(i)),this.Ot(s,n),this.Ct(r[s],n)}Qt(e,n){const r=e.values||[];this.Ft(n,50);for(const s of r)this.Ct(s,n)}Lt(e,n){this.Ft(n,37),se.fromName(e).path.forEach(r=>{this.Ft(n,60),this.Ut(r,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}}Ui.Kt=new Ui;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oo=255;function QL(t){if(t===0)return 8;let e=0;return t>>4||(e+=4,t<<=4),t>>6||(e+=2,t<<=2),t>>7||(e+=1),e}function ux(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=QL(255&r[i]);if(s+=o,o!==8)break}return s}(t);return Math.ceil(e/8)}class YL{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Gt(r.value),r=n.next();this.zt()}jt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Jt(r.value),r=n.next();this.Ht()}Yt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=n.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=n.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const n=this.en(e),r=ux(n);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}nn(e){const n=this.en(e),r=ux(n);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}rn(){this.sn(Oo),this.sn(255)}_n(){this.an(Oo),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const n=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&n[0]);n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Gt(e){const n=255&e;n===0?(this.sn(0),this.sn(255)):n===Oo?(this.sn(Oo),this.sn(0)):this.sn(n)}Jt(e){const n=255&e;n===0?(this.an(0),this.an(255)):n===Oo?(this.an(Oo),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class XL{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class JL{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Il{constructor(){this.cn=new YL,this.ln=new XL(this.cn),this.hn=new JL(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e,n,r,s){this.Tn=e,this.In=n,this.En=r,this.dn=s}An(){const e=this.dn.length,n=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.dn,0),n!==e?r.set([0],this.dn.length):++r[r.length-1],new $i(this.Tn,this.In,this.En,r)}Rn(e,n,r){return{indexId:this.Tn,uid:e,arrayValue:Td(this.En),directionalValue:Td(this.dn),orderedDocumentKey:Td(n),documentKey:r.path.toArray()}}Vn(e,n,r){const s=this.Rn(e,n,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Ds(t,e){let n=t.Tn-e.Tn;return n!==0?n:(n=dx(t.En,e.En),n!==0?n:(n=dx(t.dn,e.dn),n!==0?n:se.comparator(t.In,e.In)))}function dx(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}function Td(t){return gT()?function(n){let r="";for(let s=0;s<n.length;s++)r+=String.fromCharCode(n[s]);return r}(t):t}function hx(t){return typeof t!="string"?t:function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(t)}class fx{constructor(e){this.mn=new tt((n,r)=>yt.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const n of e.filters){const r=n;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(ve(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const n=eg(e);if(n!==void 0&&!this.wn(n))return!1;const r=Li(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const c=r[i];if(!this.Sn(a,c)||!this.bn(this.fn[o++],c))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new tt(yt.comparator);const n=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new yd(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new yd(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new yd(r.field,r.dir==="asc"?0:1)));return new lh(lh.UNKNOWN_ID,this.collectionId,n,Pc.empty())}wn(e){for(const n of this.gn)if(this.Sn(n,e))return!0;return!1}Sn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}bn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IC(t){var n,r;if(ve(t instanceof Be||t instanceof Ze,20012),t instanceof Be){if(t instanceof HS){const s=((r=(n=t.value.arrayValue)==null?void 0:n.values)==null?void 0:r.map(i=>Be.create(t.field,"==",i)))||[];return Ze.create(s,"or")}return t}const e=t.filters.map(s=>IC(s));return Ze.create(e,t.op)}function ZL(t){if(t.getFilters().length===0)return[];const e=yg(IC(t));return ve(bC(e),7391),mg(e)||gg(e)?[e]:e.getFilters()}function mg(t){return t instanceof Be}function gg(t){return t instanceof Ze&&Xy(t)}function bC(t){return mg(t)||gg(t)||function(n){if(n instanceof Ze&&ag(n)){for(const r of n.getFilters())if(!mg(r)&&!gg(r))return!1;return!0}return!1}(t)}function yg(t){if(ve(t instanceof Be||t instanceof Ze,34018),t instanceof Be)return t;if(t.filters.length===1)return yg(t.filters[0]);const e=t.filters.map(r=>yg(r));let n=Ze.create(e,t.op);return n=_h(n),bC(n)?n:(ve(n instanceof Ze,64498),ve(Va(n),40251),ve(n.filters.length>1,57927),n.filters.reduce((r,s)=>ov(r,s)))}function ov(t,e){let n;return ve(t instanceof Be||t instanceof Ze,38388),ve(e instanceof Be||e instanceof Ze,25473),n=t instanceof Be?e instanceof Be?function(s,i){return Ze.create([s,i],"and")}(t,e):px(t,e):e instanceof Be?px(e,t):function(s,i){if(ve(s.filters.length>0&&i.filters.length>0,48005),Va(s)&&Va(i))return BS(s,i.getFilters());const o=ag(s)?s:i,a=ag(s)?i:s,c=o.filters.map(d=>ov(d,a));return Ze.create(c,"or")}(t,e),_h(n)}function px(t,e){if(Va(e))return BS(e,t.getFilters());{const n=e.filters.map(r=>ov(t,r));return Ze.create(n,"or")}}function _h(t){if(ve(t instanceof Be||t instanceof Ze,11850),t instanceof Be)return t;const e=t.getFilters();if(e.length===1)return _h(e[0]);if(US(t))return t;const n=e.map(s=>_h(s)),r=[];return n.forEach(s=>{s instanceof Be?r.push(s):s instanceof Ze&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Ze.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eV{constructor(){this.Cn=new av}addToCollectionParentIndex(e,n){return this.Cn.add(n),L.resolve()}getCollectionParents(e,n){return L.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return L.resolve()}deleteFieldIndex(e,n){return L.resolve()}deleteAllFieldIndexes(e){return L.resolve()}createTargetIndexes(e,n){return L.resolve()}getDocumentsMatchingTarget(e,n){return L.resolve(null)}getIndexType(e,n){return L.resolve(0)}getFieldIndexes(e,n){return L.resolve([])}getNextCollectionGroupToUpdate(e){return L.resolve(null)}getMinOffset(e,n){return L.resolve(Wn.min())}getMinOffsetFromCollectionGroup(e,n){return L.resolve(Wn.min())}updateCollectionGroup(e,n,r){return L.resolve()}updateIndexEntries(e,n){return L.resolve()}}class av{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new tt(Ge.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new tt(Ge.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mx="IndexedDbIndexManager",qu=new Uint8Array(0);class tV{constructor(e,n){this.databaseId=n,this.vn=new av,this.Fn=new Is(r=>fo(r),(r,s)=>tu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.vn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.vn.add(n)});const i={collectionId:r,parent:dn(s)};return gx(e).put(i)}return L.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[hS(n),""],!1,!0);return gx(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==n)break;r.push($r(o.parent))}return r})}addFieldIndex(e,n){const r=bl(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const o=Vo(e);return i.next(a=>{o.put(ax(a,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=bl(e),s=Vo(e),i=Lo(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=bl(e),r=Lo(e),s=Vo(e);return n.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,n){return L.forEach(this.Mn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new fx(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=Lo(e);let s=!0;const i=new Map;return L.forEach(this.Mn(n),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ve();const a=[];return L.forEach(i,(c,d)=>{Q(mx,`Using index ${function(E){return`id=${E.indexId}|cg=${E.collectionGroup}|f=${E.fields.map(I=>`${I.fieldPath}:${I.kind}`).join(",")}`}(c)} to execute ${fo(n)}`);const h=function(E,I){const O=eg(I);if(O===void 0)return null;for(const F of ph(E,O.fieldPath))switch(F.op){case"array-contains-any":return F.value.arrayValue.values||[];case"array-contains":return[F.value]}return null}(d,c),f=function(E,I){const O=new Map;for(const F of Li(I))for(const x of ph(E,F.fieldPath))switch(x.op){case"==":case"in":O.set(F.fieldPath.canonicalString(),x.value);break;case"not-in":case"!=":return O.set(F.fieldPath.canonicalString(),x.value),Array.from(O.values())}return null}(d,c),m=function(E,I){const O=[];let F=!0;for(const x of Li(I)){const w=x.kind===0?GE(E,x.fieldPath,E.startAt):KE(E,x.fieldPath,E.startAt);O.push(w.value),F&&(F=w.inclusive)}return new mi(O,F)}(d,c),_=function(E,I){const O=[];let F=!0;for(const x of Li(I)){const w=x.kind===0?KE(E,x.fieldPath,E.endAt):GE(E,x.fieldPath,E.endAt);O.push(w.value),F&&(F=w.inclusive)}return new mi(O,F)}(d,c),R=this.On(c,d,m),A=this.On(c,d,_),N=this.Nn(c,d,f),b=this.Bn(c.indexId,h,R,m.inclusive,A,_.inclusive,N);return L.forEach(b,y=>r.Y(y,n.limit).next(E=>{E.forEach(I=>{const O=se.fromSegments(I.documentKey);o.has(O)||(o=o.add(O),a.push(O))})}))}).next(()=>a)}return L.resolve(null)})}Mn(e){let n=this.Fn.get(e);return n||(e.filters.length===0?n=[e]:n=ZL(Ze.create(e.filters,"and")).map(r=>cg(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,n),n)}Bn(e,n,r,s,i,o,a){const c=(n!=null?n.length:1)*Math.max(r.length,i.length),d=c/(n!=null?n.length:1),h=[];for(let f=0;f<c;++f){const m=n?this.Ln(n[f/d]):qu,_=this.kn(e,m,r[f%d],s),R=this.qn(e,m,i[f%d],o),A=a.map(N=>this.kn(e,m,N,!0));h.push(...this.createRange(_,R,A))}return h}kn(e,n,r,s){const i=new $i(e,se.empty(),n,r);return s?i:i.An()}qn(e,n,r,s){const i=new $i(e,se.empty(),n,r);return s?i.An():i}xn(e,n){const r=new fx(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,n){let r=2;const s=this.Mn(n);return L.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(c){let d=new tt(yt.comparator),h=!1;for(const f of c.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:d=d.add(m.field));for(const f of c.orderBy)f.field.isKeyField()||(d=d.add(f.field));return d.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(n)&&s.length>1&&r===2?1:r)}Qn(e,n){const r=new Il;for(const s of Li(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);Ui.Kt.Dt(i,o)}return r.un()}Ln(e){const n=new Il;return Ui.Kt.Dt(e,n.Pn(0)),n.un()}$n(e,n){const r=new Il;return Ui.Kt.Dt(ho(this.databaseId,n),r.Pn(function(i){const o=Li(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,n,r){if(r===null)return[];let s=[];s.push(new Il);let i=0;for(const o of Li(e)){const a=r[i++];for(const c of s)if(this.Un(n,o.fieldPath)&&Mc(a))s=this.Kn(s,o,a);else{const d=c.Pn(o.kind);Ui.Kt.Dt(a,d)}}return this.Wn(s)}On(e,n,r){return this.Nn(e,n,r.position)}Wn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].un();return n}Kn(e,n,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const c=new Il;c.seed(a.un()),Ui.Kt.Dt(o,c.Pn(n.kind)),i.push(c)}return i}Un(e,n){return!!e.filters.find(r=>r instanceof Be&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=bl(e),s=Vo(e);return(n?r.J(ng,IDBKeyRange.bound(n,n)):r.J()).next(i=>{const o=[];return L.forEach(i,a=>s.get([a.indexId,this.uid]).next(c=>{o.push(function(h,f){const m=f?new Pc(f.sequenceNumber,new Wn(go(f.readTime),new se($r(f.documentKey)),f.largestBatchId)):Pc.empty(),_=h.fields.map(([R,A])=>new yd(yt.fromServerFormat(R),A));return new lh(h.indexId,h.collectionGroup,_,m)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ae(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=bl(e),i=Vo(e);return this.Gn(e).next(o=>s.J(ng,IDBKeyRange.bound(n,n)).next(a=>L.forEach(a,c=>i.put(ax(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,n){const r=new Map;return L.forEach(n,(s,i)=>{const o=r.get(s.collectionGroup);return(o?L.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),L.forEach(a,c=>this.zn(e,s,c).next(d=>{const h=this.jn(i,c);return d.isEqual(h)?L.resolve():this.Jn(e,i,c,d,h)}))))})}Hn(e,n,r,s){return Lo(e).put(s.Rn(this.uid,this.$n(r,n.key),n.key))}Yn(e,n,r,s){return Lo(e).delete(s.Vn(this.uid,this.$n(r,n.key),n.key))}zn(e,n,r){const s=Lo(e);let i=new tt(Ds);return s.ee({index:IS,range:IDBKeyRange.only([r.indexId,this.uid,Td(this.$n(r,n))])},(o,a)=>{i=i.add(new $i(r.indexId,n,hx(a.arrayValue),hx(a.directionalValue)))}).next(()=>i)}jn(e,n){let r=new tt(Ds);const s=this.Qn(n,e);if(s==null)return r;const i=eg(n);if(i!=null){const o=e.data.field(i.fieldPath);if(Mc(o))for(const a of o.arrayValue.values||[])r=r.add(new $i(n.indexId,e.key,this.Ln(a),s))}else r=r.add(new $i(n.indexId,e.key,qu,s));return r}Jn(e,n,r,s,i){Q(mx,"Updating index entries for document '%s'",n.key);const o=[];return function(c,d,h,f,m){const _=c.getIterator(),R=d.getIterator();let A=jo(_),N=jo(R);for(;A||N;){let b=!1,y=!1;if(A&&N){const E=h(A,N);E<0?y=!0:E>0&&(b=!0)}else A!=null?y=!0:b=!0;b?(f(N),N=jo(R)):y?(m(A),A=jo(_)):(A=jo(_),N=jo(R))}}(s,i,Ds,a=>{o.push(this.Hn(e,n,r,a))},a=>{o.push(this.Yn(e,n,r,a))}),L.waitFor(o)}Gn(e){let n=1;return Vo(e).ee({index:xS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((o,a)=>Ds(o,a)).filter((o,a,c)=>!a||Ds(o,c[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Ds(o,e),c=Ds(o,n);if(a===0)s[0]=e.An();else if(a>0&&c<0)s.push(o),s.push(o.An());else if(c>0)break}s.push(n);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,qu,se.empty()),c=s[o+1].Vn(this.uid,qu,se.empty());i.push(IDBKeyRange.bound(a,c))}return i}Zn(e,n){return Ds(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(yx)}getMinOffset(e,n){return L.mapArray(this.Mn(n),r=>this.xn(e,r).next(s=>s||pe(44426))).next(yx)}}function gx(t){return $t(t,Oc)}function Lo(t){return $t(t,sc)}function bl(t){return $t(t,Wy)}function Vo(t){return $t(t,rc)}function yx(t){ve(t.length!==0,28825);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;zy(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new Wn(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},TC=41943040;class on{static withCacheSize(e){return new on(e,on.DEFAULT_COLLECTION_PERCENTILE,on.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SC(t,e,n){const r=t.store(gr),s=t.store(Pa),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.ee({range:o},(h,f,m)=>(a++,m.delete()));i.push(c.next(()=>{ve(a===1,47070,{batchId:n.batchId})}));const d=[];for(const h of n.mutations){const f=_S(e,h.key.path,n.batchId);i.push(s.delete(f)),d.push(h.key)}return L.waitFor(i).next(()=>d)}function wh(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw pe(14731);e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */on.DEFAULT_COLLECTION_PERCENTILE=10,on.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,on.DEFAULT=new on(TC,on.DEFAULT_COLLECTION_PERCENTILE,on.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),on.DISABLED=new on(-1,0,0);class yf{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,n,r,s){ve(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new yf(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return js(e).ee({index:Wi,range:r},(s,i,o)=>{n=!1,o.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=Qo(e),o=js(e);return o.add({}).next(a=>{ve(typeof a=="number",49019);const c=new ev(a,n,r,s),d=function(_,R,A){const N=A.baseMutations.map(y=>yh(_.yt,y)),b=A.mutations.map(y=>yh(_.yt,y));return{userId:R,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:N,mutations:b}}(this.serializer,this.userId,c),h=[];let f=new tt((m,_)=>Ae(m.canonicalString(),_.canonicalString()));for(const m of s){const _=_S(this.userId,m.key.path,a);f=f.add(m.key.path.popLast()),h.push(o.put(d)),h.push(i.put(_,AO))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Xn[a]=c.keys()}),L.waitFor(h).next(()=>c)})}lookupMutationBatch(e,n){return js(e).get(n).next(r=>r?(ve(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:n}),Fi(this.serializer,r)):null)}er(e,n){return this.Xn[n]?L.resolve(this.Xn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Xn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return js(e).ee({index:Wi,range:s},(o,a,c)=>{a.userId===this.userId&&(ve(a.batchId>=r,47524,{tr:r}),i=Fi(this.serializer,a)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Yi;return js(e).ee({index:Wi,range:n,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,Yi],[this.userId,Number.POSITIVE_INFINITY]);return js(e).J(Wi,n).next(r=>r.map(s=>Fi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=vd(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return Qo(e).ee({range:s},(o,a,c)=>{const[d,h,f]=o,m=$r(h);if(d===this.userId&&n.path.isEqual(m))return js(e).get(f).next(_=>{if(!_)throw pe(61480,{nr:o,batchId:f});ve(_.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:_.userId,batchId:f}),i.push(Fi(this.serializer,_))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new tt(Ae);const s=[];return n.forEach(i=>{const o=vd(this.userId,i.path),a=IDBKeyRange.lowerBound(o),c=Qo(e).ee({range:a},(d,h,f)=>{const[m,_,R]=d,A=$r(_);m===this.userId&&i.path.isEqual(A)?r=r.add(R):f.done()});s.push(c)}),L.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=vd(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new tt(Ae);return Qo(e).ee({range:o},(c,d,h)=>{const[f,m,_]=c,R=$r(m);f===this.userId&&r.isPrefixOf(R)?R.length===s&&(a=a.add(_)):h.done()}).next(()=>this.rr(e,a))}rr(e,n){const r=[],s=[];return n.forEach(i=>{s.push(js(e).get(i).next(o=>{if(o===null)throw pe(35274,{batchId:i});ve(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(Fi(this.serializer,o))}))}),L.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return SC(e.le,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.ir(n.batchId)}),L.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return L.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Qo(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const c=$r(i[1]);s.push(c)}else a.done()}).next(()=>{ve(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,n){return CC(e,this.userId,n)}_r(e){return AC(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:Yi,lastStreamToken:""})}}function CC(t,e,n){const r=vd(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Qo(t).ee({range:i,X:!0},(a,c,d)=>{const[h,f,m]=a;h===e&&f===s&&(o=!0),d.done()}).next(()=>o)}function js(t){return $t(t,gr)}function Qo(t){return $t(t,Pa)}function AC(t){return $t(t,Dc)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new yo(0)}static cr(){return new yo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nV{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.lr(e).next(n=>{const r=new yo(n.highestTargetId);return n.highestTargetId=r.next(),this.hr(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(n=>we.fromTimestamp(new qe(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.hr(e,s)))}addTargetData(e,n){return this.Pr(e,n).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(n,r),this.hr(e,r))))}updateTargetData(e,n){return this.Pr(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>Mo(e).delete(n.targetId)).next(()=>this.lr(e)).next(r=>(ve(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return Mo(e).ee((o,a)=>{const c=Ul(a);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>L.waitFor(i)).next(()=>s)}forEachTarget(e,n){return Mo(e).ee((r,s)=>{const i=Ul(s);n(i)})}lr(e){return _x(e).get(dh).next(n=>(ve(n!==null,2888),n))}hr(e,n){return _x(e).put(dh,n)}Pr(e,n){return Mo(e).put(EC(this.serializer,n))}Tr(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(n=>n.targetCount)}getTargetData(e,n){const r=fo(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Mo(e).ee({range:s,index:ES},(o,a,c)=>{const d=Ul(a);tu(n,d.target)&&(i=d,c.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=Ws(e);return n.forEach(o=>{const a=dn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),L.waitFor(s)}removeMatchingKeys(e,n,r){const s=Ws(e);return L.forEach(n,i=>{const o=dn(i.path);return L.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=Ws(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=Ws(e);let i=Ve();return s.ee({range:r,X:!0},(o,a,c)=>{const d=$r(o[1]),h=new se(d);i=i.add(h)}).next(()=>i)}containsKey(e,n){const r=dn(n.path),s=IDBKeyRange.bound([r],[hS(r)],!1,!0);let i=0;return Ws(e).ee({index:Hy,X:!0,range:s},([o,a],c,d)=>{o!==0&&(i++,d.done())}).next(()=>i>0)}At(e,n){return Mo(e).get(n).next(r=>r?Ul(r):null)}}function Mo(t){return $t(t,ka)}function _x(t){return $t(t,Xi)}function Ws(t){return $t(t,Da)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wx="LruGarbageCollector",rV=1048576;function Ex([t,e],[n,r]){const s=Ae(t,n);return s===0?Ae(e,r):s}class sV{constructor(e){this.Ir=e,this.buffer=new tt(Ex),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();Ex(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class RC{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Q(wx,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){bi(n)?Q(wx,"Ignoring IndexedDB error during garbage collection: ",n):await Co(n)}await this.Vr(3e5)})}}class iV{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return L.resolve(rr.ce);const r=new sV(n);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Q("LruGarbageCollector","Garbage collection skipped; disabled"),L.resolve(vx)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Q("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vx):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,i,o,a,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(Q("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,o=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,n))).next(f=>(i=f,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(d=Date.now(),Wo()<=$e.DEBUG&&Q("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(c-a)+`ms
	Removed ${f} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),L.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function NC(t,e){return new iV(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oV{constructor(e,n){this.db=e,this.garbageCollector=NC(this,n)}gr(e){const n=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}pr(e,n){return this.Sr(e,(r,s)=>n(s))}addReference(e,n,r){return Hu(e,r)}removeReference(e,n,r){return Hu(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Hu(e,n)}br(e,n){return function(s,i){let o=!1;return AC(s).te(a=>CC(s,a,i).next(c=>(c&&(o=!0),L.resolve(!c)))).next(()=>o)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=n){const c=this.br(e,o).next(d=>{if(!d)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,we.min()),Ws(e).delete(function(f){return[0,dn(f.path)]}(o))))});s.push(c)}}).next(()=>L.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Hu(e,n)}Sr(e,n){const r=Ws(e);let s,i=rr.ce;return r.ee({index:Hy},([o,a],{path:c,sequenceNumber:d})=>{o===0?(i!==rr.ce&&n(new se($r(s)),i),i=d,s=c):i=rr.ce}).next(()=>{i!==rr.ce&&n(new se($r(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Hu(t,e){return Ws(t).put(function(r,s){return{targetId:0,path:dn(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PC{constructor(){this.changes=new Is(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,xt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?L.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aV{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return ki(e).put(r)}removeEntry(e,n,r){return ki(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],vh(o),a[a.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Dr(e,r)))}getEntry(e,n){let r=xt.newInvalidDocument(n);return ki(e).ee({index:_d,range:IDBKeyRange.only(Tl(n))},(s,i)=>{r=this.Cr(n,i)}).next(()=>r)}vr(e,n){let r={size:0,document:xt.newInvalidDocument(n)};return ki(e).ee({index:_d,range:IDBKeyRange.only(Tl(n))},(s,i)=>{r={document:this.Cr(n,i),size:wh(i)}}).next(()=>r)}getEntries(e,n){let r=Bn();return this.Fr(e,n,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,n){let r=Bn(),s=new pt(se.comparator);return this.Fr(e,n,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,wh(o))}).next(()=>({documents:r,Or:s}))}Fr(e,n,r){if(n.isEmpty())return L.resolve();let s=new tt(bx);n.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(Tl(s.first()),Tl(s.last())),o=s.getIterator();let a=o.getNext();return ki(e).ee({index:_d,range:i},(c,d,h)=>{const f=se.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;a&&bx(a,f)<0;)r(a,null),a=o.getNext();a&&a.isEqual(f)&&(r(a,d),a=o.hasNext()?o.getNext():null),a?h.j(Tl(a)):h.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const o=n.path,a=[o.popLast().toArray(),o.lastSegment(),vh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ki(e).J(IDBKeyRange.bound(a,c,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let h=Bn();for(const f of d){const m=this.Cr(se.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(ru(n,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,n,r,s){let i=Bn();const o=Ix(n,r),a=Ix(n,Wn.max());return ki(e).ee({index:wS,range:IDBKeyRange.bound(o,a,!0)},(c,d,h)=>{const f=this.Cr(se.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new lV(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return xx(e).get(tg).next(n=>(ve(!!n,20021),n))}Dr(e,n){return xx(e).put(tg,n)}Cr(e,n){if(n){const r=WL(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(we.min())))return r}return xt.newInvalidDocument(e)}}function kC(t){return new aV(t)}class lV extends PC{constructor(e,n){super(),this.Nr=e,this.trackRemovals=n,this.Br=new Is(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new tt((i,o)=>Ae(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(n.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const c=ix(this.Nr.serializer,o);s=s.add(i.path.popLast());const d=wh(c);r+=d-a.size,n.push(this.Nr.addEntry(e,i,c))}else if(r-=a.size,this.trackRemovals){const c=ix(this.Nr.serializer,o.convertToNoDocument(we.min()));n.push(this.Nr.addEntry(e,i,c))}}),s.forEach(i=>{n.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.Nr.updateMetadata(e,r)),L.waitFor(n)}getFromCache(e,n){return this.Nr.vr(e,n).next(r=>(this.Br.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Nr.Mr(e,n).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function xx(t){return $t(t,jc)}function ki(t){return $t(t,uh)}function Tl(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ix(t,e){const n=e.documentKey.path.toArray();return[t,vh(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function bx(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=Ae(n[i],r[i]),s)return s;return s=Ae(n.length,r.length),s||(s=Ae(n[n.length-2],r[r.length-2]),s||Ae(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cV{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DC{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&ac(r.mutation,s,An.empty(),qe.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ve()){const s=Br();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let o=Ml();return i.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=Br();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ve()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,s){let i=Bn();const o=oc(),a=function(){return oc()}();return n.forEach((c,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof bs)?i=i.insert(d.key,d):h!==void 0?(o.set(d.key,h.mutation.getFieldMask()),ac(h.mutation,d,h.mutation.getFieldMask(),qe.now())):o.set(d.key,An.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,h)=>o.set(d,h)),n.forEach((d,h)=>a.set(d,new cV(h,o.get(d)??null))),a))}recalculateAndSaveOverlays(e,n){const r=oc();let s=new pt((o,a)=>o-a),i=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let h=r.get(c)||An.empty();h=a.applyToLocalView(d,h),r.set(c,h);const f=(s.get(a.batchId)||Ve()).add(c);s=s.insert(a.batchId,f)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),d=c.key,h=c.value,f=XS();h.forEach(m=>{if(!i.has(m)){const _=sC(n.get(m),r.get(m));_!==null&&f.set(m,_),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,f))}return L.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):Jy(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):L.resolve(Br());let a=Nc,c=i;return o.next(d=>L.forEach(d,(h,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),i.get(h)?L.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{c=c.insert(h,m)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,Ve())).next(h=>({batchId:a,changes:YS(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new se(n)).next(r=>{let s=Ml();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let o=Ml();return this.indexManager.getCollectionParents(e,i).next(a=>L.forEach(a,c=>{const d=function(f,m){return new Si(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(o=>{i.forEach((c,d)=>{const h=d.getKey();o.get(h)===null&&(o=o.insert(h,xt.newInvalidDocument(h)))});let a=Ml();return o.forEach((c,d)=>{const h=i.get(c);h!==void 0&&ac(h.mutation,d,An.empty(),qe.now()),ru(n,d)&&(a=a.insert(c,d))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uV{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return L.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:_n(s.createTime)}}(n)),L.resolve()}getNamedQuery(e,n){return L.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(s){return{name:s.name,query:xC(s.bundledQuery),readTime:_n(s.readTime)}}(n)),L.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dV{constructor(){this.overlays=new pt(se.comparator),this.qr=new Map}getOverlay(e,n){return L.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Br();return L.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.St(e,n,i)}),L.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),L.resolve()}getOverlaysForCollection(e,n,r){const s=Br(),i=n.length+1,o=new se(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return L.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new pt((d,h)=>d-h);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=Br(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const a=Br(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=s)););return L.resolve(a)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new nv(n,r));let i=this.qr.get(n);i===void 0&&(i=Ve(),this.qr.set(n,i)),this.qr.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hV{constructor(){this.sessionToken=Lt.EMPTY_BYTE_STRING}getSessionToken(e){return L.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,L.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv{constructor(){this.Qr=new tt(Wt.$r),this.Ur=new tt(Wt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Wt(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new Wt(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new se(new Ge([])),r=new Wt(n,e),s=new Wt(n,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new se(new Ge([])),r=new Wt(n,e),s=new Wt(n,e+1);let i=Ve();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new Wt(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Wt{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return se.comparator(e.key,n.key)||Ae(e.Yr,n.Yr)}static Kr(e,n){return Ae(e.Yr,n.Yr)||se.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new tt(Wt.$r)}checkEmpty(e){return L.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new ev(i,n,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new Wt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return L.resolve(o)}lookupMutationBatch(e,n){return L.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),i=s<0?0:s;return L.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return L.resolve(this.mutationQueue.length===0?Yi:this.tr-1)}getAllMutationBatches(e){return L.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Wt(n,0),s=new Wt(n,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),L.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new tt(Ae);return n.forEach(s=>{const i=new Wt(s,0),o=new Wt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),L.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;se.isDocumentKey(i)||(i=i.child(""));const o=new Wt(new se(i),0);let a=new tt(Ae);return this.Zr.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(a=a.add(c.Yr)),!0)},o),L.resolve(this.ti(a))}ti(e){const n=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){ve(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return L.forEach(n.mutations,s=>{const i=new Wt(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new Wt(n,0),s=this.Zr.firstAfterOrEqual(r);return L.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,L.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pV{constructor(e){this.ri=e,this.docs=function(){return new pt(se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return L.resolve(r?r.document.mutableCopy():xt.newInvalidDocument(n))}getEntries(e,n){let r=Bn();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():xt.newInvalidDocument(s))}),L.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=Bn();const o=n.path,a=new se(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||zy(mS(h),r)<=0||(s.has(h.key)||ru(n,h))&&(i=i.insert(h.key,h.mutableCopy()))}return L.resolve(i)}getAllFromCollectionGroup(e,n,r,s){pe(9500)}ii(e,n){return L.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new mV(this)}getSize(e){return L.resolve(this.size)}}class mV extends PC{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),L.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gV{constructor(e){this.persistence=e,this.si=new Is(n=>fo(n),tu),this.lastRemoteSnapshotVersion=we.min(),this.highestTargetId=0,this.oi=0,this._i=new lv,this.targetCount=0,this.ai=yo.ur()}forEachTarget(e,n){return this.si.forEach((r,s)=>n(s)),L.resolve()}getLastRemoteSnapshotVersion(e){return L.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return L.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),L.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),L.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new yo(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,L.resolve()}updateTargetData(e,n){return this.Pr(n),L.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,L.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),L.waitFor(i).next(()=>s)}getTargetCount(e){return L.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return L.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),L.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),L.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),L.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return L.resolve(r)}containsKey(e,n){return L.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(e,n){this.ui={},this.overlays={},this.ci=new rr(0),this.li=!1,this.li=!0,this.hi=new hV,this.referenceDelegate=e(this),this.Pi=new gV(this),this.indexManager=new eV,this.remoteDocumentCache=function(s){return new pV(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new wC(n),this.Ii=new uV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new dV,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new fV(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){Q("MemoryPersistence","Starting transaction:",e);const s=new yV(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,n){return L.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class yV extends yS{constructor(e){super(),this.currentSequenceNumber=e}}class vf{constructor(e){this.persistence=e,this.Ri=new lv,this.Vi=null}static mi(e){return new vf(e)}get fi(){if(this.Vi)return this.Vi;throw pe(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),L.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),L.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),L.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return L.forEach(this.fi,r=>{const s=se.fromPath(r);return this.gi(e,s).next(i=>{i||n.removeEntry(s,we.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return L.or([()=>L.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Eh{constructor(e,n){this.persistence=e,this.pi=new Is(r=>dn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=NC(this,n)}static mi(e,n){return new Eh(e,n)}Ei(){}di(e){return L.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return L.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?L.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,n).next(a=>{a||(r++,i.removeEntry(o,we.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),L.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),L.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),L.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),L.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Ed(e.data.value)),n}br(e,n,r){return L.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return L.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vV{constructor(e){this.serializer=e}k(e,n,r,s){const i=new tf("createOrUpgrade",n);r<1&&s>=1&&(function(c){c.createObjectStore(eu)}(e),function(c){c.createObjectStore(Dc,{keyPath:CO}),c.createObjectStore(gr,{keyPath:OE,autoIncrement:!0}).createIndex(Wi,LE,{unique:!0}),c.createObjectStore(Pa)}(e),Tx(e),function(c){c.createObjectStore(Vi)}(e));let o=L.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore(Da),c.deleteObjectStore(ka),c.deleteObjectStore(Xi)}(e),Tx(e)),o=o.next(()=>function(c){const d=c.store(Xi),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:we.min().toTimestamp(),targetCount:0};return d.put(dh,h)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(c,d){return d.store(gr).J().next(f=>{c.deleteObjectStore(gr),c.createObjectStore(gr,{keyPath:OE,autoIncrement:!0}).createIndex(Wi,LE,{unique:!0});const m=d.store(gr),_=f.map(R=>m.put(R));return L.waitFor(_)})}(e,i))),o=o.next(()=>{(function(c){c.createObjectStore(ja,{keyPath:LO})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(c){c.createObjectStore(jc)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(rf,{keyPath:VO})})(e),function(c){c.createObjectStore(sf,{keyPath:MO})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(c){const d=c.createObjectStore(of,{keyPath:HO});d.createIndex(rg,WO,{unique:!1}),d.createIndex(bS,GO,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(c){const d=c.createObjectStore(uh,{keyPath:RO});d.createIndex(_d,NO),d.createIndex(wS,PO)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Vi))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(c){c.createObjectStore(Wy,{keyPath:FO,autoIncrement:!0}).createIndex(ng,UO,{unique:!1}),c.createObjectStore(rc,{keyPath:$O}).createIndex(xS,BO,{unique:!1}),c.createObjectStore(sc,{keyPath:zO}).createIndex(IS,qO,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{n.objectStore(rc).clear()}).next(()=>{n.objectStore(sc).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(Gy,{keyPath:KO})})(e)})),r<18&&s>=18&&gT()&&(o=o.next(()=>{n.objectStore(rc).clear()}).next(()=>{n.objectStore(sc).clear()})),o}wi(e){let n=0;return e.store(Vi).ee((r,s)=>{n+=wh(s)}).next(()=>{const r={byteSize:n};return e.store(jc).put(tg,r)})}yi(e){const n=e.store(Dc),r=e.store(gr);return n.J().next(s=>L.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,Yi],[i.userId,i.lastAcknowledgedBatchId]);return r.J(Wi,o).next(a=>L.forEach(a,c=>{ve(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const d=Fi(this.serializer,c);return SC(e,i.userId,d).next(()=>{})}))}))}Si(e){const n=e.store(Da),r=e.store(Vi);return e.store(Xi).get(dh).next(s=>{const i=[];return r.ee((o,a)=>{const c=new Ge(o),d=function(f){return[0,dn(f)]}(c);i.push(n.get(d).next(h=>h?L.resolve():(f=>n.put({targetId:0,path:dn(f),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>L.waitFor(i))})}bi(e,n){e.createObjectStore(Oc,{keyPath:OO});const r=n.store(Oc),s=new av,i=o=>{if(s.add(o)){const a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:dn(c)})}};return n.store(Vi).ee({X:!0},(o,a)=>{const c=new Ge(o);return i(c.popLast())}).next(()=>n.store(Pa).ee({X:!0},([o,a,c],d)=>{const h=$r(a);return i(h.popLast())}))}Di(e){const n=e.store(ka);return n.ee((r,s)=>{const i=Ul(s),o=EC(this.serializer,i);return n.put(o)})}Ci(e,n){const r=n.store(Vi),s=[];return r.ee((i,o)=>{const a=n.store(uh),c=function(f){return f.document?new se(Ge.fromString(f.document.name).popFirst(5)):f.noDocument?se.fromSegments(f.noDocument.path):f.unknownDocument?se.fromSegments(f.unknownDocument.path):pe(36783)}(o).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(d))}).next(()=>L.waitFor(s))}Fi(e,n){const r=n.store(gr),s=kC(this.serializer),i=new cv(vf.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(c=>{let d=a.get(c.userId)??Ve();Fi(this.serializer,c).keys().forEach(h=>d=d.add(h)),a.set(c.userId,d)}),L.forEach(a,(c,d)=>{const h=new Xt(d),f=gf.wt(this.serializer,h),m=i.getIndexManager(h),_=yf.wt(h,this.serializer,m,i.referenceDelegate);return new DC(s,_,f,m).recalculateAndSaveOverlaysForDocumentKeys(new sg(n,rr.ce),c).next()})})}}function Tx(t){t.createObjectStore(Da,{keyPath:DO}).createIndex(Hy,jO,{unique:!0}),t.createObjectStore(ka,{keyPath:"targetId"}).createIndex(ES,kO,{unique:!0}),t.createObjectStore(Xi)}const Os="IndexedDbPersistence",Rp=18e5,Np=5e3,Pp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",_V="main";class uv{constructor(e,n,r,s,i,o,a,c,d,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=d,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=m=>Promise.resolve(),!uv.v())throw new X(q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new oV(this,s),this.$i=n+_V,this.serializer=new wC(c),this.Ui=new ci(this.$i,this.Ni,new vV(this.serializer)),this.hi=new KL,this.Pi=new nV(this.referenceDelegate,this.serializer),this.remoteDocumentCache=kC(this.serializer),this.Ii=new GL,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&mn(Os,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new X(q.FAILED_PRECONDITION,Pp);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new rr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Wu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(n=>{n||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(n=>this.isPrimary&&!n?this.Zi(e).next(()=>!1):!!n&&this.Xi(e).next(()=>!0))).catch(e=>{if(bi(e))return Q(Os,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Q(Os,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Sl(e).get(Do).next(n=>L.resolve(this.es(n)))}ts(e){return Wu(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Rp)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=$t(n,ja);return r.J().next(s=>{const i=this.ss(s,Rp),o=s.filter(a=>i.indexOf(a)===-1);return L.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const n of e)this.Ki.removeItem(this._s(n.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?L.resolve(!0):Sl(e).get(Do).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,Np)&&!this.us(n.ownerId)){if(this.es(n)&&this.networkEnabled)return!0;if(!this.es(n)){if(!n.allowTabSynchronization)throw new X(q.FAILED_PRECONDITION,Pp);return!1}}return!(!this.networkEnabled||!this.inForeground)||Wu(e).J().next(r=>this.ss(r,Np).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&Q(Os,`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[eu,ja],e=>{const n=new sg(e,rr.ce);return this.Zi(n).next(()=>this.ts(n))}),this.Ui.close(),this.Ps()}ss(e,n){return e.filter(r=>this.rs(r.updateTimeMs,n)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Wu(e).J().next(n=>this.ss(n,Rp).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,n){return yf.wt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new tV(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return gf.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,n,r){Q(Os,"Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(c){return c===18?XO:c===17?AS:c===16?YO:c===15?Ky:c===14?CS:c===13?SS:c===12?QO:c===11?TS:void pe(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new sg(a,this.ci?this.ci.next():rr.ce),n==="readwrite-primary"?this.Hi(o).next(c=>!!c||this.Yi(o)).next(c=>{if(!c)throw mn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new X(q.FAILED_PRECONDITION,gS);return r(o)}).next(c=>this.Xi(o).next(()=>c)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Sl(e).get(Do).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,Np)&&!this.us(n.ownerId)&&!this.es(n)&&!(this.Oi||this.allowTabSynchronization&&n.allowTabSynchronization))throw new X(q.FAILED_PRECONDITION,Pp)})}Xi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Sl(e).put(Do,n)}static v(){return ci.v()}Zi(e){const n=Sl(e);return n.get(Do).next(r=>this.es(r)?(Q(Os,"Releasing primary lease."),n.delete(Do)):L.resolve())}rs(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(mn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const n=/(?:Version|Mobile)\/1[456]/;mT()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var n;try{const r=((n=this.Ki)==null?void 0:n.getItem(this._s(e)))!==null;return Q(Os,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return mn(Os,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){mn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Sl(t){return $t(t,eu)}function Wu(t){return $t(t,ja)}function wV(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=Ve(),s=Ve();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new dv(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jC{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return mT()?8:vS(Ut())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.ys(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new EV;return this.Ss(e,n,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,n,o,a.size)})}).next(()=>i.result)}bs(e,n,r,s){return r.documentReadCount<this.fs?(Wo()<=$e.DEBUG&&Q("QueryEngine","SDK will not create cache indexes for query:",Go(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),L.resolve()):(Wo()<=$e.DEBUG&&Q("QueryEngine","Query:",Go(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Wo()<=$e.DEBUG&&Q("QueryEngine","The SDK decides to create cache indexes for query:",Go(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ir(n))):L.resolve())}ys(e,n){if(QE(n))return L.resolve(null);let r=ir(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=mh(n,null,"F"),r=ir(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ve(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.Ds(n,a);return this.Cs(n,d,o,c.readTime)?this.ys(e,mh(n,null,"F")):this.vs(e,d,n,c)}))})))}ws(e,n,r,s){return QE(n)||s.isEqual(we.min())?L.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(n,i);return this.Cs(n,o,r,s)?L.resolve(null):(Wo()<=$e.DEBUG&&Q("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Go(n)),this.vs(e,o,n,wO(s,Nc)).next(a=>a))})}Ds(e,n){let r=new tt(KS(e));return n.forEach((s,i)=>{ru(e,i)&&(r=r.add(i))}),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,n,r){return Wo()<=$e.DEBUG&&Q("QueryEngine","Using full collection scan to execute query:",Go(n)),this.ps.getDocumentsMatchingQuery(e,n,Wn.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hv="LocalStore",xV=3e8;class IV{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new pt(Ae),this.xs=new Is(i=>fo(i),tu),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new DC(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function OC(t,e,n,r){return new IV(t,e,n,r)}async function LC(t,e){const n=Te(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let c=Ve();for(const d of s){o.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of i){a.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return n.localDocuments.getDocuments(r,c).next(d=>({Ls:d,removedBatchIds:o,addedBatchIds:a}))})})}function bV(t,e){const n=Te(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(a,c,d,h){const f=d.batch,m=f.keys();let _=L.resolve();return m.forEach(R=>{_=_.next(()=>h.getEntry(c,R)).next(A=>{const N=d.docVersions.get(R);ve(N!==null,48541),A.version.compareTo(N)<0&&(f.applyToRemoteDocument(A,d),A.isValidDocument()&&(A.setReadTime(d.commitVersion),h.addEntry(A)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(c,f))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=Ve();for(let d=0;d<a.mutationResults.length;++d)a.mutationResults[d].transformResults.length>0&&(c=c.add(a.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function VC(t){const e=Te(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function TV(t,e){const n=Te(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const a=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;a.push(n.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>n.Pi.addMatchingKeys(i,h.addedDocuments,f)));let _=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(Lt.EMPTY_BYTE_STRING,we.min()).withLastLimboFreeSnapshotVersion(we.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,r)),s=s.insert(f,_),function(A,N,b){return A.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=xV?!0:b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0}(m,_,h)&&a.push(n.Pi.updateTargetData(i,_))});let c=Bn(),d=Ve();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(i,h))}),a.push(SV(i,o,e.documentUpdates).next(h=>{c=h.ks,d=h.qs})),!r.isEqual(we.min())){const h=n.Pi.getLastRemoteSnapshotVersion(i).next(f=>n.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(h)}return L.waitFor(a).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(n.Ms=s,i))}function SV(t,e,n){let r=Ve(),s=Ve();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let o=Bn();return n.forEach((a,c)=>{const d=i.get(a);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(we.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):Q(hv,"Ignoring outdated watch update for ",a,". Current version:",d.version," Watch version:",c.version)}),{ks:o,qs:s}})}function CV(t,e){const n=Te(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Yi),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function AV(t,e){const n=Te(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Pi.getTargetData(r,e).next(i=>i?(s=i,L.resolve(s)):n.Pi.allocateTargetId(r).next(o=>(s=new as(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r})}async function vg(t,e,n){const r=Te(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!bi(o))throw o;Q(hv,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Sx(t,e,n){const r=Te(t);let s=we.min(),i=Ve();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,d,h){const f=Te(c),m=f.xs.get(h);return m!==void 0?L.resolve(f.Ms.get(m)):f.Pi.getTargetData(d,h)}(r,o,ir(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(c=>{i=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,n?s:we.min(),n?i:Ve())).next(a=>(RV(r,fL(e),a),{documents:a,Qs:i})))}function RV(t,e,n){let r=t.Os.get(e)||we.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.Os.set(e,r)}class Cx{constructor(){this.activeTargetIds=_L()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class MC{constructor(){this.Mo=new Cx,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Cx,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NV{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ax="ConnectivityMonitor";class Rx{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Q(Ax,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Q(Ax,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gu=null;function _g(){return Gu===null?Gu=function(){return 268435456+Math.round(2147483648*Math.random())}():Gu++,"0x"+Gu.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kp="RestConnection",PV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kV{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===hh?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,i){const o=_g(),a=this.zo(e,n.toUriEncodedString());Q(kp,`Sending RPC '${e}' ${o}:`,a,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:d}=new URL(a),h=Ei(d);return this.Jo(e,a,c,r,h).then(f=>(Q(kp,`Received RPC '${e}' ${o}: `,f),f),f=>{throw co(kp,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Ho(e,n,r,s,i,o){return this.Go(e,n,r,s,i)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ja}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,n){const r=PV[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sn="WebChannelConnection";class jV extends kV{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,i){const o=_g();return new Promise((a,c)=>{const d=new iS;d.setWithCredentials(!0),d.listenOnce(oS.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case gd.NO_ERROR:const f=d.getResponseJson();Q(sn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case gd.TIMEOUT:Q(sn,`RPC '${e}' ${o} timed out`),c(new X(q.DEADLINE_EXCEEDED,"Request time out"));break;case gd.HTTP_ERROR:const m=d.getStatus();if(Q(sn,`RPC '${e}' ${o} failed with status:`,m,"response text:",d.getResponseText()),m>0){let _=d.getResponseJson();Array.isArray(_)&&(_=_[0]);const R=_==null?void 0:_.error;if(R&&R.status&&R.message){const A=function(b){const y=b.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(y)>=0?y:q.UNKNOWN}(R.status);c(new X(A,R.message))}else c(new X(q.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new X(q.UNAVAILABLE,"Connection failed."));break;default:pe(9055,{l_:e,streamId:o,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{Q(sn,`RPC '${e}' ${o} completed.`)}});const h=JSON.stringify(s);Q(sn,`RPC '${e}' ${o} sending request:`,s),d.send(n,"POST",h,r,15)})}T_(e,n,r){const s=_g(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=cS(),a=lS(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const h=i.join("");Q(sn,`Creating RPC '${e}' stream ${s}: ${h}`,c);const f=o.createWebChannel(h,c);this.I_(f);let m=!1,_=!1;const R=new DV({Yo:N=>{_?Q(sn,`Not sending because RPC '${e}' stream ${s} is closed:`,N):(m||(Q(sn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),Q(sn,`RPC '${e}' stream ${s} sending:`,N),f.send(N))},Zo:()=>f.close()}),A=(N,b,y)=>{N.listen(b,E=>{try{y(E)}catch(I){setTimeout(()=>{throw I},0)}})};return A(f,Vl.EventType.OPEN,()=>{_||(Q(sn,`RPC '${e}' stream ${s} transport opened.`),R.o_())}),A(f,Vl.EventType.CLOSE,()=>{_||(_=!0,Q(sn,`RPC '${e}' stream ${s} transport closed`),R.a_(),this.E_(f))}),A(f,Vl.EventType.ERROR,N=>{_||(_=!0,co(sn,`RPC '${e}' stream ${s} transport errored. Name:`,N.name,"Message:",N.message),R.a_(new X(q.UNAVAILABLE,"The operation could not be completed")))}),A(f,Vl.EventType.MESSAGE,N=>{var b;if(!_){const y=N.data[0];ve(!!y,16349);const E=y,I=(E==null?void 0:E.error)||((b=E[0])==null?void 0:b.error);if(I){Q(sn,`RPC '${e}' stream ${s} received error:`,I);const O=I.status;let F=function(v){const P=Dt[v];if(P!==void 0)return aC(P)}(O),x=I.message;F===void 0&&(F=q.INTERNAL,x="Unknown error status: "+O+" with message "+I.message),_=!0,R.a_(new X(F,x)),f.close()}else Q(sn,`RPC '${e}' stream ${s} received:`,y),R.u_(y)}}),A(a,aS.STAT_EVENT,N=>{N.stat===Jm.PROXY?Q(sn,`RPC '${e}' stream ${s} detected buffering proxy`):N.stat===Jm.NOPROXY&&Q(sn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{R.__()},0),R}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OV(){return typeof window<"u"?window:null}function Sd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _f(t){return new OL(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e,n,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&Q("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nx="PersistentStream";class UC{constructor(e,n,r,s,i,o,a,c){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new FC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===q.RESOURCE_EXHAUSTED?(mn(n.toString()),mn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===n&&this.G_(r,s)},r=>{e(()=>{const s=new X(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return Q(Nx,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(Q(Nx,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class LV extends UC{constructor(e,n,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=ML(this.serializer,e),r=function(i){if(!("targetChange"in i))return we.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?we.min():o.readTime?_n(o.readTime):we.min()}(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=fg(this.serializer),n.addTarget=function(i,o){let a;const c=o.target;if(a=fh(c)?{documents:mC(i,c)}:{query:iv(i,c).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=uC(i,o.resumeToken);const d=dg(i,o.expectedCount);d!==null&&(a.expectedCount=d)}else if(o.snapshotVersion.compareTo(we.min())>0){a.readTime=$a(i,o.snapshotVersion.toTimestamp());const d=dg(i,o.expectedCount);d!==null&&(a.expectedCount=d)}return a}(this.serializer,e);const r=$L(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=fg(this.serializer),n.removeTarget=e,this.q_(n)}}class VV extends UC{constructor(e,n,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return ve(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ve(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ve(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=FL(e.writeResults,e.commitTime),r=_n(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=fg(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>yh(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{}class FV extends MV{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new X(q.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,hg(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new X(q.UNKNOWN,i.toString())})}Ho(e,n,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,hg(n,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new X(q.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class UV{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(mn(n),this.aa=!1):Q("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vo="RemoteStore";class $V{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Ao(this)&&(Q(vo,"Restarting streams for network reachability change."),await async function(c){const d=Te(c);d.Ea.add(4),await iu(d),d.Ra.set("Unknown"),d.Ea.delete(4),await wf(d)}(this))})}),this.Ra=new UV(r,s)}}async function wf(t){if(Ao(t))for(const e of t.da)await e(!0)}async function iu(t){for(const e of t.da)await e(!1)}function $C(t,e){const n=Te(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),gv(n)?mv(n):el(n).O_()&&pv(n,e))}function fv(t,e){const n=Te(t),r=el(n);n.Ia.delete(e),r.O_()&&BC(n,e),n.Ia.size===0&&(r.O_()?r.L_():Ao(n)&&n.Ra.set("Unknown"))}function pv(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(we.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}el(t).Y_(e)}function BC(t,e){t.Va.Ue(e),el(t).Z_(e)}function mv(t){t.Va=new PL({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),el(t).start(),t.Ra.ua()}function gv(t){return Ao(t)&&!el(t).x_()&&t.Ia.size>0}function Ao(t){return Te(t).Ea.size===0}function zC(t){t.Va=void 0}async function BV(t){t.Ra.set("Online")}async function zV(t){t.Ia.forEach((e,n)=>{pv(t,e)})}async function qV(t,e){zC(t),gv(t)?(t.Ra.ha(e),mv(t)):t.Ra.set("Unknown")}async function HV(t,e,n){if(t.Ra.set("Online"),e instanceof cC&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(t,e)}catch(r){Q(vo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await xh(t,r)}else if(e instanceof bd?t.Va.Ze(e):e instanceof lC?t.Va.st(e):t.Va.tt(e),!n.isEqual(we.min()))try{const r=await VC(t.localStore);n.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.Ia.get(d);h&&i.Ia.set(d,h.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,d)=>{const h=i.Ia.get(c);if(!h)return;i.Ia.set(c,h.withResumeToken(Lt.EMPTY_BYTE_STRING,h.snapshotVersion)),BC(i,c);const f=new as(h.target,c,d,h.sequenceNumber);pv(i,f)}),i.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(r){Q(vo,"Failed to raise snapshot:",r),await xh(t,r)}}async function xh(t,e,n){if(!bi(e))throw e;t.Ea.add(1),await iu(t),t.Ra.set("Offline"),n||(n=()=>VC(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Q(vo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await wf(t)})}function qC(t,e){return e().catch(n=>xh(t,n,e))}async function ou(t){const e=Te(t),n=gi(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Yi;for(;WV(e);)try{const s=await CV(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,GV(e,s)}catch(s){await xh(e,s)}HC(e)&&WC(e)}function WV(t){return Ao(t)&&t.Ta.length<10}function GV(t,e){t.Ta.push(e);const n=gi(t);n.O_()&&n.X_&&n.ea(e.mutations)}function HC(t){return Ao(t)&&!gi(t).x_()&&t.Ta.length>0}function WC(t){gi(t).start()}async function KV(t){gi(t).ra()}async function QV(t){const e=gi(t);for(const n of t.Ta)e.ea(n.mutations)}async function YV(t,e,n){const r=t.Ta.shift(),s=tv.from(r,e,n);await qC(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await ou(t)}async function XV(t,e){e&&gi(t).X_&&await async function(r,s){if(function(o){return AL(o)&&o!==q.ABORTED}(s.code)){const i=r.Ta.shift();gi(r).B_(),await qC(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await ou(r)}}(t,e),HC(t)&&WC(t)}async function Px(t,e){const n=Te(t);n.asyncQueue.verifyOperationInProgress(),Q(vo,"RemoteStore received new credentials");const r=Ao(n);n.Ea.add(3),await iu(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await wf(n)}async function JV(t,e){const n=Te(t);e?(n.Ea.delete(2),await wf(n)):e||(n.Ea.add(2),await iu(n),n.Ra.set("Unknown"))}function el(t){return t.ma||(t.ma=function(n,r,s){const i=Te(n);return i.sa(),new LV(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:BV.bind(null,t),t_:zV.bind(null,t),r_:qV.bind(null,t),H_:HV.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),gv(t)?mv(t):t.Ra.set("Unknown")):(await t.ma.stop(),zC(t))})),t.ma}function gi(t){return t.fa||(t.fa=function(n,r,s){const i=Te(n);return i.sa(),new VV(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:KV.bind(null,t),r_:XV.bind(null,t),ta:QV.bind(null,t),na:YV.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await ou(t)):(await t.fa.stop(),t.Ta.length>0&&(Q(vo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new xr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const o=Date.now()+r,a=new yv(e,n,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new X(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function vv(t,e){if(mn("AsyncQueue",`${e}: ${t}`),bi(t))return new X(q.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _a{static emptySet(e){return new _a(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||se.comparator(n.key,r.key):(n,r)=>se.comparator(n.key,r.key),this.keyedMap=Ml(),this.sortedSet=new pt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof _a)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new _a;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kx{constructor(){this.ga=new pt(se.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):pe(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class Ba{constructor(e,n,r,s,i,o,a,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new Ba(e,n,_a.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&uf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZV{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class eM{constructor(){this.queries=Dx(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=Te(n),i=s.queries;s.queries=Dx(),i.forEach((o,a)=>{for(const c of a.Sa)c.onError(r)})})(this,new X(q.ABORTED,"Firestore shutting down"))}}function Dx(){return new Is(t=>GS(t),uf)}async function _v(t,e){const n=Te(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new ZV,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const a=vv(o,`Initialization of query '${Go(e.query)}' failed`);return void e.onError(a)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&Ev(n)}async function wv(t,e){const n=Te(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function tM(t,e){const n=Te(t);let r=!1;for(const s of e){const i=s.query,o=n.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&Ev(n)}function nM(t,e,n){const r=Te(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function Ev(t){t.Ca.forEach(e=>{e.next()})}var wg,jx;(jx=wg||(wg={})).Ma="default",jx.Cache="cache";class xv{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ba(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Ba.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==wg.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GC{constructor(e){this.key=e}}class KC{constructor(e){this.key=e}}class rM{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ve(),this.mutatedKeys=Ve(),this.eu=KS(e),this.tu=new _a(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new kx,s=n?n.tu:this.tu;let i=n?n.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),_=ru(this.query,f)?f:null,R=!!m&&this.mutatedKeys.has(m.key),A=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let N=!1;m&&_?m.data.isEqual(_.data)?R!==A&&(r.track({type:3,doc:_}),N=!0):this.su(m,_)||(r.track({type:2,doc:_}),N=!0,(c&&this.eu(_,c)>0||d&&this.eu(_,d)<0)&&(a=!0)):!m&&_?(r.track({type:0,doc:_}),N=!0):m&&!_&&(r.track({type:1,doc:m}),N=!0,(c||d)&&(a=!0)),N&&(_?(o=o.add(_),i=A?i.add(h):i.delete(h)):(o=o.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((h,f)=>function(_,R){const A=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return pe(20277,{Rt:N})}};return A(_)-A(R)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const a=n&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,d=c!==this.Za;return this.Za=c,o.length!==0||d?{snapshot:new Ba(this.query,e.tu,i,o,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new kx,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ve(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const n=[];return e.forEach(r=>{this.Xa.has(r)||n.push(new KC(r))}),this.Xa.forEach(r=>{e.has(r)||n.push(new GC(r))}),n}cu(e){this.Ya=e.Qs,this.Xa=Ve();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Ba.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Iv="SyncEngine";class sM{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class iM{constructor(e){this.key=e,this.hu=!1}}class oM{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Is(a=>GS(a),uf),this.Iu=new Map,this.Eu=new Set,this.du=new pt(se.comparator),this.Au=new Map,this.Ru=new lv,this.Vu={},this.mu=new Map,this.fu=yo.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function aM(t,e,n=!0){const r=eA(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await QC(r,e,n,!0),s}async function lM(t,e){const n=eA(t);await QC(n,e,!0,!1)}async function QC(t,e,n,r){const s=await AV(t.localStore,ir(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await cM(t,e,i,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&$C(t.remoteStore,s),a}async function cM(t,e,n,r,s){t.pu=(f,m,_)=>async function(A,N,b,y){let E=N.view.ru(b);E.Cs&&(E=await Sx(A.localStore,N.query,!1).then(({documents:x})=>N.view.ru(x,E)));const I=y&&y.targetChanges.get(N.targetId),O=y&&y.targetMismatches.get(N.targetId)!=null,F=N.view.applyChanges(E,A.isPrimaryClient,I,O);return Lx(A,N.targetId,F.au),F.snapshot}(t,f,m,_);const i=await Sx(t.localStore,e,!0),o=new rM(e,i.Qs),a=o.ru(i.documents),c=su.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=o.applyChanges(a,t.isPrimaryClient,c);Lx(t,n,d.au);const h=new sM(e,n,o);return t.Tu.set(e,h),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),d.snapshot}async function uM(t,e,n){const r=Te(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!uf(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await vg(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&fv(r.remoteStore,s.targetId),Eg(r,s.targetId)}).catch(Co)):(Eg(r,s.targetId),await vg(r.localStore,s.targetId,!0))}async function dM(t,e){const n=Te(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),fv(n.remoteStore,r.targetId))}async function hM(t,e,n){const r=tA(t);try{const s=await function(o,a){const c=Te(o),d=qe.now(),h=a.reduce((_,R)=>_.add(R.key),Ve());let f,m;return c.persistence.runTransaction("Locally write mutations","readwrite",_=>{let R=Bn(),A=Ve();return c.Ns.getEntries(_,h).next(N=>{R=N,R.forEach((b,y)=>{y.isValidDocument()||(A=A.add(b))})}).next(()=>c.localDocuments.getOverlayedDocuments(_,R)).next(N=>{f=N;const b=[];for(const y of a){const E=TL(y,f.get(y.key).overlayedDocument);E!=null&&b.push(new bs(y.key,E,MS(E.value.mapValue),cn.exists(!0)))}return c.mutationQueue.addMutationBatch(_,d,b,a)}).next(N=>{m=N;const b=N.applyToLocalDocumentSet(f,A);return c.documentOverlayCache.saveOverlays(_,N.batchId,b)})}).then(()=>({batchId:m.batchId,changes:YS(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,c){let d=o.Vu[o.currentUser.toKey()];d||(d=new pt(Ae)),d=d.insert(a,c),o.Vu[o.currentUser.toKey()]=d}(r,s.batchId,n),await au(r,s.changes),await ou(r.remoteStore)}catch(s){const i=vv(s,"Failed to persist write");n.reject(i)}}async function YC(t,e){const n=Te(t);try{const r=await TV(n.localStore,e);e.targetChanges.forEach((s,i)=>{const o=n.Au.get(i);o&&(ve(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?ve(o.hu,14607):s.removedDocuments.size>0&&(ve(o.hu,42227),o.hu=!1))}),await au(n,r,e)}catch(r){await Co(r)}}function Ox(t,e,n){const r=Te(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const c=Te(o);c.onlineState=a;let d=!1;c.queries.forEach((h,f)=>{for(const m of f.Sa)m.va(a)&&(d=!0)}),d&&Ev(c)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function fM(t,e,n){const r=Te(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new pt(se.comparator);o=o.insert(i,xt.newNoDocument(i,we.min()));const a=Ve().add(i),c=new mf(we.min(),new Map,new pt(Ae),o,a);await YC(r,c),r.du=r.du.remove(i),r.Au.delete(e),bv(r)}else await vg(r.localStore,e,!1).then(()=>Eg(r,e,n)).catch(Co)}async function pM(t,e){const n=Te(t),r=e.batch.batchId;try{const s=await bV(n.localStore,e);JC(n,r,null),XC(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await au(n,s)}catch(s){await Co(s)}}async function mM(t,e,n){const r=Te(t);try{const s=await function(o,a){const c=Te(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,a).next(f=>(ve(f!==null,37113),h=f.keys(),c.mutationQueue.removeMutationBatch(d,f))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(r.localStore,e);JC(r,e,n),XC(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await au(r,s)}catch(s){await Co(s)}}function XC(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function JC(t,e,n){const r=Te(t);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Eg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(r=>{t.Ru.containsKey(r)||ZC(t,r)})}function ZC(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(fv(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),bv(t))}function Lx(t,e,n){for(const r of n)r instanceof GC?(t.Ru.addReference(r.key,e),gM(t,r)):r instanceof KC?(Q(Iv,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||ZC(t,r.key)):pe(19791,{wu:r})}function gM(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(Q(Iv,"New document in limbo: "+n),t.Eu.add(r),bv(t))}function bv(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new se(Ge.fromString(e)),r=t.fu.next();t.Au.set(r,new iM(n)),t.du=t.du.insert(n,r),$C(t.remoteStore,new as(ir(nu(n.path)),r,"TargetPurposeLimboResolution",rr.ce))}}async function au(t,e,n){const r=Te(t),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,c)=>{o.push(r.pu(c,e,n).then(d=>{var h;if((d||n)&&r.isPrimaryClient){const f=d?!d.fromCache:(h=n==null?void 0:n.targetChanges.get(c.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(d){s.push(d);const f=dv.As(c.targetId,d);i.push(f)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(c,d){const h=Te(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>L.forEach(d,m=>L.forEach(m.Es,_=>h.persistence.referenceDelegate.addReference(f,m.targetId,_)).next(()=>L.forEach(m.ds,_=>h.persistence.referenceDelegate.removeReference(f,m.targetId,_)))))}catch(f){if(!bi(f))throw f;Q(hv,"Failed to update sequence numbers: "+f)}for(const f of d){const m=f.targetId;if(!f.fromCache){const _=h.Ms.get(m),R=_.snapshotVersion,A=_.withLastLimboFreeSnapshotVersion(R);h.Ms=h.Ms.insert(m,A)}}}(r.localStore,i))}async function yM(t,e){const n=Te(t);if(!n.currentUser.isEqual(e)){Q(Iv,"User change. New user:",e.toKey());const r=await LC(n.localStore,e);n.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(c=>{c.reject(new X(q.CANCELLED,o))})}),i.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await au(n,r.Ls)}}function vM(t,e){const n=Te(t),r=n.Au.get(e);if(r&&r.hu)return Ve().add(r.key);{let s=Ve();const i=n.Iu.get(e);if(!i)return s;for(const o of i){const a=n.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}function eA(t){const e=Te(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=YC.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=vM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=fM.bind(null,e),e.Pu.H_=tM.bind(null,e.eventManager),e.Pu.yu=nM.bind(null,e.eventManager),e}function tA(t){const e=Te(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=pM.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mM.bind(null,e),e}class Uc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=_f(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return OC(this.persistence,new jC,e.initialUser,this.serializer)}Cu(e){return new cv(vf.mi,this.serializer)}Du(e){return new MC}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Uc.provider={build:()=>new Uc};class _M extends Uc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){ve(this.persistence.referenceDelegate instanceof Eh,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new RC(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?on.withCacheSize(this.cacheSizeBytes):on.DEFAULT;return new cv(r=>Eh.mi(r,n),this.serializer)}}class wM extends Uc{constructor(e,n,r){super(),this.xu=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await tA(this.xu.syncEngine),await ou(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return OC(this.persistence,new jC,e.initialUser,this.serializer)}Fu(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new RC(r,e.asyncQueue,n)}Mu(e,n){const r=new bO(n,this.persistence);return new IO(e.asyncQueue,r)}Cu(e){const n=wV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?on.withCacheSize(this.cacheSizeBytes):on.DEFAULT;return new uv(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,OV(),Sd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new MC}}class Ih{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ox(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=yM.bind(null,this.syncEngine),await JV(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new eM}()}createDatastore(e){const n=_f(e.databaseInfo.databaseId),r=function(i){return new jV(i)}(e.databaseInfo);return function(i,o,a,c){return new FV(i,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,o,a){return new $V(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>Ox(this.syncEngine,n,0),function(){return Rx.v()?new Rx:new NV}())}createSyncEngine(e,n){return function(s,i,o,a,c,d,h){const f=new oM(s,i,o,a,c,d);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=Te(s);Q(vo,"RemoteStore shutting down."),i.Ea.add(5),await iu(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}Ih.provider={build:()=>new Ih};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):mn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yi="FirestoreClient";class EM{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=Xt.UNAUTHENTICATED,this.clientId=By.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Q(yi,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Q(yi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new xr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=vv(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Dp(t,e){t.asyncQueue.verifyOperationInProgress(),Q(yi,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await LC(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Vx(t,e){t.asyncQueue.verifyOperationInProgress();const n=await xM(t);Q(yi,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Px(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Px(e.remoteStore,s)),t._onlineComponents=e}async function xM(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Q(yi,"Using user provided OfflineComponentProvider");try{await Dp(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===q.FAILED_PRECONDITION||s.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;co("Error using user provided cache. Falling back to memory cache: "+n),await Dp(t,new Uc)}}else Q(yi,"Using default OfflineComponentProvider"),await Dp(t,new _M(void 0));return t._offlineComponents}async function Sv(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Q(yi,"Using user provided OnlineComponentProvider"),await Vx(t,t._uninitializedComponentsProvider._online)):(Q(yi,"Using default OnlineComponentProvider"),await Vx(t,new Ih))),t._onlineComponents}function IM(t){return Sv(t).then(e=>e.syncEngine)}function bM(t){return Sv(t).then(e=>e.datastore)}async function bh(t){const e=await Sv(t),n=e.eventManager;return n.onListen=aM.bind(null,e.syncEngine),n.onUnlisten=uM.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=lM.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=dM.bind(null,e.syncEngine),n}function TM(t,e,n={}){const r=new xr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,d){const h=new Tv({next:m=>{h.Nu(),o.enqueueAndForget(()=>wv(i,f));const _=m.docs.has(a);!_&&m.fromCache?d.reject(new X(q.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&m.fromCache&&c&&c.source==="server"?d.reject(new X(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(m)},error:m=>d.reject(m)}),f=new xv(nu(a.path),h,{includeMetadataChanges:!0,qa:!0});return _v(i,f)}(await bh(t),t.asyncQueue,e,n,r)),r.promise}function SM(t,e,n={}){const r=new xr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,d){const h=new Tv({next:m=>{h.Nu(),o.enqueueAndForget(()=>wv(i,f)),m.fromCache&&c.source==="server"?d.reject(new X(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(m)},error:m=>d.reject(m)}),f=new xv(a,h,{includeMetadataChanges:!0,qa:!0});return _v(i,f)}(await bh(t),t.asyncQueue,e,n,r)),r.promise}function CM(t,e,n){const r=new xr;return t.asyncQueue.enqueueAndForget(async()=>{try{const s=await bM(t);r.resolve(async function(o,a,c){var A;const d=Te(o),{request:h,gt:f,parent:m}=UL(d.serializer,hL(a),c);d.connection.$o||delete h.parent;const _=(await d.Ho("RunAggregationQuery",d.serializer.databaseId,m,h,1)).filter(N=>!!N.result);ve(_.length===1,64727);const R=(A=_[0].result)==null?void 0:A.aggregateFields;return Object.keys(R).reduce((N,b)=>(N[f[b]]=R[b],N),{})}(s,e,n))}catch(s){r.reject(s)}}),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nA(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mx=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rA="firestore.googleapis.com",Fx=!0;class Ux{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new X(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rA,this.ssl=Fx}else this.host=e.host,this.ssl=e.ssl??Fx;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=TC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<rV)throw new X(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}vO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nA(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new X(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new X(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new X(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ef{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ux({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new X(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new X(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ux(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new lO;switch(r.type){case"firstParty":return new hO(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new X(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=Mx.get(n);r&&(Q("ComponentProvider","Removing Datastore"),Mx.delete(n),r.terminate())}(this),Promise.resolve()}}function AM(t,e,n,r={}){var d;t=un(t,Ef);const s=Ei(e),i=t._getSettings(),o={...i,emulatorOptions:t._getEmulatorOptions()},a=`${e}:${n}`;s&&(Cy(`https://${a}`),Ay("Firestore",!0)),i.host!==rA&&i.host!==a&&co("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:a,ssl:s,emulatorOptions:r};if(!gs(c,o)&&(t._setSettings(c),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=Xt.MOCK_USER;else{h=hT(r.mockUserToken,(d=t._app)==null?void 0:d.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new X(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Xt(m)}t._authCredentials=new cO(new dS(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Rr(this.firestore,e,this._query)}}class It{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ui(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new It(this.firestore,e,this._key)}toJSON(){return{type:It._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Zc(n,It._jsonSchema))return new It(e,r||null,new se(Ge.fromString(n.referencePath)))}}It._jsonSchemaVersion="firestore/documentReference/1.0",It._jsonSchema={type:Ot("string",It._jsonSchemaVersion),referencePath:Ot("string")};class ui extends Rr{constructor(e,n,r){super(e,n,nu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new It(this.firestore,null,new se(e))}withConverter(e){return new ui(this.firestore,e,this._path)}}function Ce(t,e,...n){if(t=Xe(t),fS("collection","path",e),t instanceof Ef){const r=Ge.fromString(e,...n);return NE(r),new ui(t,null,r)}{if(!(t instanceof It||t instanceof ui))throw new X(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ge.fromString(e,...n));return NE(r),new ui(t.firestore,null,r)}}function ct(t,e,...n){if(t=Xe(t),arguments.length===1&&(e=By.newId()),fS("doc","path",e),t instanceof Ef){const r=Ge.fromString(e,...n);return RE(r),new It(t,null,new se(r))}{if(!(t instanceof It||t instanceof ui))throw new X(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ge.fromString(e,...n));return RE(r),new It(t.firestore,t instanceof ui?t.converter:null,new se(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $x="AsyncQueue";class Bx{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new FC(this,"async_queue_retry"),this._c=()=>{const r=Sd();r&&Q($x,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Sd();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Sd();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new xr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!bi(e))throw e;Q($x,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,mn("INTERNAL UNHANDLED ERROR: ",zx(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=yv.createAndSchedule(this,e,n,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&pe(47125,{Pc:zx(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function zx(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qx(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Sr extends Ef{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new Bx,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Bx(e),this._firestoreClient=void 0,await e}}}function sA(t,e){const n=typeof t=="object"?t:Qh(),r=typeof t=="string"?t:hh,s=xi(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=cT("firestore");i&&AM(s,...i)}return s}function lu(t){if(t._terminated)throw new X(q.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||iA(t),t._firestoreClient}function iA(t){var r,s,i;const e=t._freezeSettings(),n=function(a,c,d,h){return new eL(a,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,nA(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new EM(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(a){const c=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(c),_online:c}}(t._componentsProvider))}function RM(t,e){co("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return NM(t,Ih.provider,{build:r=>new wM(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function NM(t,e,n){if((t=un(t,Sr))._firestoreClient||t._terminated)throw new X(q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new X(q.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},iA(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PM{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class kM{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new tr(Lt.fromBase64String(e))}catch(n){throw new X(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new tr(Lt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:tr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Zc(e,tr._jsonSchema))return tr.fromBase64String(e.bytes)}}tr._jsonSchemaVersion="firestore/bytes/1.0",tr._jsonSchema={type:Ot("string",tr._jsonSchemaVersion),bytes:Ot("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new X(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new yt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kr{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new X(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new X(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ae(this._lat,e._lat)||Ae(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Kr._jsonSchemaVersion}}static fromJSON(e){if(Zc(e,Kr._jsonSchema))return new Kr(e.latitude,e.longitude)}}Kr._jsonSchemaVersion="firestore/geoPoint/1.0",Kr._jsonSchema={type:Ot("string",Kr._jsonSchemaVersion),latitude:Ot("number"),longitude:Ot("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qr{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Qr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Zc(e,Qr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new Qr(e.vectorValues);throw new X(q.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Qr._jsonSchemaVersion="firestore/vectorValue/1.0",Qr._jsonSchema={type:Ot("string",Qr._jsonSchemaVersion),vectorValues:Ot("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DM=/^__.*__$/;class jM{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new bs(e,this.data,this.fieldMask,n,this.fieldTransforms):new Za(e,this.data,n,this.fieldTransforms)}}class oA{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new bs(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function aA(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw pe(40011,{Ac:t})}}class If{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new If({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Th(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(aA(this.Ac)&&DM.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class OM{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||_f(e)}Cc(e,n,r,s=!1){return new If({Ac:e,methodName:n,Dc:r,path:yt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cu(t){const e=t._freezeSettings(),n=_f(t._databaseId);return new OM(t._databaseId,!!e.ignoreUndefinedProperties,n)}function lA(t,e,n,r,s,i={}){const o=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);Nv("Data must be an object, but it was:",o,r);const a=uA(r,o);let c,d;if(i.merge)c=new An(o.fieldMask),d=o.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=xg(e,f,n);if(!o.contains(m))throw new X(q.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);hA(h,m)||h.push(m)}c=new An(h),d=o.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,d=o.fieldTransforms;return new jM(new ln(a),c,d)}class bf extends tl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof bf}}function LM(t,e,n){return new If({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Cv extends tl{_toFieldTransform(e){return new hf(e.path,new Ma)}isEqual(e){return e instanceof Cv}}class Av extends tl{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=LM(this,e,!0),r=this.vc.map(i=>nl(i,n)),s=new po(r);return new hf(e.path,s)}isEqual(e){return e instanceof Av&&gs(this.vc,e.vc)}}class Rv extends tl{constructor(e,n){super(e),this.Fc=n}_toFieldTransform(e){const n=new Ua(e.serializer,ZS(e.serializer,this.Fc));return new hf(e.path,n)}isEqual(e){return e instanceof Rv&&this.Fc===e.Fc}}function VM(t,e,n,r){const s=t.Cc(1,e,n);Nv("Data must be an object, but it was:",s,r);const i=[],o=ln.empty();Ti(r,(c,d)=>{const h=Pv(e,c,n);d=Xe(d);const f=s.yc(h);if(d instanceof bf)i.push(h);else{const m=nl(d,f);m!=null&&(i.push(h),o.set(h,m))}});const a=new An(i);return new oA(o,a,s.fieldTransforms)}function MM(t,e,n,r,s,i){const o=t.Cc(1,e,n),a=[xg(e,r,n)],c=[s];if(i.length%2!=0)throw new X(q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(xg(e,i[m])),c.push(i[m+1]);const d=[],h=ln.empty();for(let m=a.length-1;m>=0;--m)if(!hA(d,a[m])){const _=a[m];let R=c[m];R=Xe(R);const A=o.yc(_);if(R instanceof bf)d.push(_);else{const N=nl(R,A);N!=null&&(d.push(_),h.set(_,N))}}const f=new An(d);return new oA(h,f,o.fieldTransforms)}function cA(t,e,n,r=!1){return nl(n,t.Cc(r?4:3,e))}function nl(t,e){if(dA(t=Xe(t)))return Nv("Unsupported field value:",e,t),uA(t,e);if(t instanceof tl)return function(r,s){if(!aA(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let c=nl(a,s.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=Xe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return ZS(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=qe.fromDate(r);return{timestampValue:$a(s.serializer,i)}}if(r instanceof qe){const i=new qe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:$a(s.serializer,i)}}if(r instanceof Kr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof tr)return{bytesValue:uC(s.serializer,r._byteString)};if(r instanceof It){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:sv(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Qr)return function(o,a){return{mapValue:{fields:{[Qy]:{stringValue:Yy},[Oa]:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw a.Sc("VectorValues must only contain numeric values.");return Zy(a.serializer,d)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${ef(r)}`)}(t,e)}function uA(t,e){const n={};return RS(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ti(t,(r,s)=>{const i=nl(s,e.mc(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function dA(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof qe||t instanceof Kr||t instanceof tr||t instanceof It||t instanceof tl||t instanceof Qr)}function Nv(t,e,n){if(!dA(n)||!pS(n)){const r=ef(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function xg(t,e,n){if((e=Xe(e))instanceof xf)return e._internalPath;if(typeof e=="string")return Pv(t,e);throw Th("Field path arguments must be of type string or ",t,!1,void 0,n)}const FM=new RegExp("[~\\*/\\[\\]]");function Pv(t,e,n){if(e.search(FM)>=0)throw Th(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new xf(...e.split("."))._internalPath}catch{throw Th(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Th(t,e,n,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new X(q.INVALID_ARGUMENT,a+t+c)}function hA(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kv{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new It(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new UM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Tf("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class UM extends kv{data(){return super.data()}}function Tf(t,e){return typeof e=="string"?Pv(t,e):e instanceof xf?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fA(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new X(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Dv{}class uu extends Dv{}function it(t,e,...n){let r=[];e instanceof Dv&&r.push(e),r=r.concat(n),function(i){const o=i.filter(c=>c instanceof jv).length,a=i.filter(c=>c instanceof Sf).length;if(o>1||o>0&&a>0)throw new X(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Sf extends uu{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Sf(e,n,r)}_apply(e){const n=this._parse(e);return mA(e._query,n),new Rr(e.firestore,e.converter,ug(e._query,n))}_parse(e){const n=cu(e.firestore);return function(i,o,a,c,d,h,f){let m;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new X(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){Kx(f,h);const R=[];for(const A of f)R.push(Gx(c,i,A));m={arrayValue:{values:R}}}else m=Gx(c,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||Kx(f,h),m=cA(a,o,f,h==="in"||h==="not-in");return Be.create(d,h,m)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Je(t,e,n){const r=e,s=Tf("where",t);return Sf._create(s,r,n)}class jv extends Dv{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new jv(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Ze.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const c of a)mA(o,c),o=ug(o,c)}(e._query,n),new Rr(e.firestore,e.converter,ug(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ov extends uu{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Ov(e,n)}_apply(e){const n=function(s,i,o){if(s.startAt!==null)throw new X(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new X(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Fc(i,o)}(e._query,this._field,this._direction);return new Rr(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Si(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function gn(t,e="asc"){const n=e,r=Tf("orderBy",t);return Ov._create(r,n)}class Lv extends uu{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new Lv(e,n,r)}_apply(e){return new Rr(e.firestore,e.converter,mh(e._query,this._limit,this._limitType))}}function wa(t){return _O("limit",t),Lv._create("limit",t,"F")}class Cf extends uu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Cf(e,n,r)}_apply(e){const n=pA(e,this.type,this._docOrFields,this._inclusive);return new Rr(e.firestore,e.converter,function(s,i){return new Si(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,n))}}function Hx(...t){return Cf._create("startAt",t,!0)}function $M(...t){return Cf._create("startAfter",t,!1)}class Vv extends uu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Vv(e,n,r)}_apply(e){const n=pA(e,this.type,this._docOrFields,this._inclusive);return new Rr(e.firestore,e.converter,function(s,i){return new Si(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,n))}}function Wx(...t){return Vv._create("endAt",t,!0)}function pA(t,e,n,r){if(n[0]=Xe(n[0]),n[0]instanceof kv)return function(i,o,a,c,d){if(!c)throw new X(q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const h=[];for(const f of va(i))if(f.field.isKeyField())h.push(ho(o,c.key));else{const m=c.data.field(f.field);if(af(m))throw new X(q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const _=f.field.canonicalString();throw new X(q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(m)}return new mi(h,d)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=cu(t.firestore);return function(o,a,c,d,h,f){const m=o.explicitOrderBy;if(h.length>m.length)throw new X(q.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let R=0;R<h.length;R++){const A=h[R];if(m[R].field.isKeyField()){if(typeof A!="string")throw new X(q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof A}`);if(!Jy(o)&&A.indexOf("/")!==-1)throw new X(q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${A}' contains a slash.`);const N=o.path.child(Ge.fromString(A));if(!se.isDocumentKey(N))throw new X(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);const b=new se(N);_.push(ho(a,b))}else{const N=cA(c,d,A);_.push(N)}}return new mi(_,f)}(t._query,t.firestore._databaseId,s,e,n,r)}}function Gx(t,e,n){if(typeof(n=Xe(n))=="string"){if(n==="")throw new X(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Jy(e)&&n.indexOf("/")!==-1)throw new X(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ge.fromString(n));if(!se.isDocumentKey(r))throw new X(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ho(t,new se(r))}if(n instanceof It)return ho(t,n._key);throw new X(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ef(n)}.`)}function Kx(t,e){if(!Array.isArray(t)||t.length===0)throw new X(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function mA(t,e){const n=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new X(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new X(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class BM{convertValue(e,n="none"){switch(fi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return dt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ws(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw pe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ti(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var r,s,i;const n=(i=(s=(r=e.fields)==null?void 0:r[Oa].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>dt(o.doubleValue));return new Qr(n)}convertGeoPoint(e){return new Kr(dt(e.latitude),dt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=lf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Lc(e));default:return null}}convertTimestamp(e){const n=_s(e);return new qe(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ge.fromString(e);ve(_C(r),9688,{name:e});const s=new uo(r.get(1),r.get(3)),i=new se(r.popFirst(5));return s.isEqual(n)||mn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gA(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}function zM(){return new PM("count")}class $l{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Zi extends kv{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Cd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Tf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new X(q.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Zi._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Zi._jsonSchemaVersion="firestore/documentSnapshot/1.0",Zi._jsonSchema={type:Ot("string",Zi._jsonSchemaVersion),bundleSource:Ot("string","DocumentSnapshot"),bundleName:Ot("string"),bundle:Ot("string")};class Cd extends Zi{data(e={}){return super.data(e)}}class eo{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new $l(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Cd(this._firestore,this._userDataWriter,r.key,r,new $l(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new X(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const c=new Cd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new $l(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const c=new Cd(s._firestore,s._userDataWriter,a.doc.key,a.doc,new $l(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return a.type!==0&&(d=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:qM(a.type),doc:c,oldIndex:d,newIndex:h}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new X(q.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=eo._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=By.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(n.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function qM(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return pe(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function za(t){t=un(t,It);const e=un(t.firestore,Sr);return TM(lu(e),t._key).then(n=>yA(e,t,n))}eo._jsonSchemaVersion="firestore/querySnapshot/1.0",eo._jsonSchema={type:Ot("string",eo._jsonSchemaVersion),bundleSource:Ot("string","QuerySnapshot"),bundleName:Ot("string"),bundle:Ot("string")};class Af extends BM{constructor(e){super(),this.firestore=e}convertBytes(e){return new tr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new It(this.firestore,null,n)}}function gt(t){t=un(t,Rr);const e=un(t.firestore,Sr),n=lu(e),r=new Af(e);return fA(t._query),SM(n,t._query).then(s=>new eo(e,r,t,s))}function $c(t,e,n){t=un(t,It);const r=un(t.firestore,Sr),s=gA(t.converter,e,n);return Nf(r,[lA(cu(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,cn.none())])}function us(t,e,n,...r){t=un(t,It);const s=un(t.firestore,Sr),i=cu(s);let o;return o=typeof(e=Xe(e))=="string"||e instanceof xf?MM(i,"updateDoc",t._key,e,n,r):VM(i,"updateDoc",t._key,e),Nf(s,[o.toMutation(t._key,cn.exists(!0))])}function Rf(t){return Nf(un(t.firestore,Sr),[new pf(t._key,cn.none())])}function _r(t,e){const n=un(t.firestore,Sr),r=ct(t),s=gA(t.converter,e);return Nf(n,[lA(cu(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,cn.exists(!1))]).then(()=>r)}function Un(t,...e){var c,d,h;t=Xe(t);let n={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||qx(e[r])||(n=e[r++]);const s={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(qx(e[r])){const f=e[r];e[r]=(c=f.next)==null?void 0:c.bind(f),e[r+1]=(d=f.error)==null?void 0:d.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,o,a;if(t instanceof It)o=un(t.firestore,Sr),a=nu(t._key.path),i={next:f=>{e[r]&&e[r](yA(o,t,f))},error:e[r+1],complete:e[r+2]};else{const f=un(t,Rr);o=un(f.firestore,Sr),a=f._query;const m=new Af(o);i={next:_=>{e[r]&&e[r](new eo(o,m,f,_))},error:e[r+1],complete:e[r+2]},fA(t._query)}return function(m,_,R,A){const N=new Tv(A),b=new xv(_,N,R);return m.asyncQueue.enqueueAndForget(async()=>_v(await bh(m),b)),()=>{N.Nu(),m.asyncQueue.enqueueAndForget(async()=>wv(await bh(m),b))}}(lu(o),a,s,i)}function Nf(t,e){return function(r,s){const i=new xr;return r.asyncQueue.enqueueAndForget(async()=>hM(await IM(r),s,i)),i.promise}(lu(t),e)}function yA(t,e,n){const r=n.docs.get(e._key),s=new Af(t);return new Zi(t,s,e._key,r,new $l(n.hasPendingWrites,n.fromCache),e.converter)}function HM(t){return WM(t,{count:zM()})}function WM(t,e){const n=un(t.firestore,Sr),r=lu(n),s=JO(e,(i,o)=>new SL(o,i.aggregateType,i._internalFieldPath));return CM(r,t._query,s).then(i=>function(a,c,d){const h=new Af(a);return new kM(c,h,d)}(n,t,i))}function Xn(){return new Cv("serverTimestamp")}function GM(...t){return new Av("arrayUnion",t)}function Qx(t){return new Rv("increment",t)}(function(e,n=!0){(function(s){Ja=s})(To),br(new cr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Sr(new uO(r.getProvider("auth-internal")),new fO(o,r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new X(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new uo(d.options.projectId,h)}(o,s),o);return i={useFetchStreams:n,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),kn(TE,SE,e),kn(TE,SE,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vA="firebasestorage.googleapis.com",_A="storageBucket",KM=2*60*1e3,QM=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt extends ur{constructor(e,n,r=0){super(jp(e),`Firebase Storage: ${n} (${jp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Tt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return jp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var bt;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(bt||(bt={}));function jp(t){return"storage/"+t}function Mv(){const t="An unknown error occurred, please check the error payload for server response.";return new Tt(bt.UNKNOWN,t)}function YM(t){return new Tt(bt.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function XM(t){return new Tt(bt.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function JM(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Tt(bt.UNAUTHENTICATED,t)}function ZM(){return new Tt(bt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function eF(t){return new Tt(bt.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function tF(){return new Tt(bt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function nF(){return new Tt(bt.CANCELED,"User canceled the upload/download.")}function rF(t){return new Tt(bt.INVALID_URL,"Invalid URL '"+t+"'.")}function sF(t){return new Tt(bt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function iF(){return new Tt(bt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+_A+"' property when initializing the app?")}function oF(){return new Tt(bt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function aF(){return new Tt(bt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function lF(t){return new Tt(bt.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ig(t){return new Tt(bt.INVALID_ARGUMENT,t)}function wA(){return new Tt(bt.APP_DELETED,"The Firebase app was deleted.")}function cF(t){return new Tt(bt.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function lc(t,e){return new Tt(bt.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Cl(t){throw new Tt(bt.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=yn.makeFromUrl(e,n)}catch{return new yn(e,"")}if(r.path==="")return r;throw sF(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(I){I.path.charAt(I.path.length-1)==="/"&&(I.path_=I.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),c={bucket:1,path:3};function d(I){I.path_=decodeURIComponent(I.path)}const h="v[A-Za-z0-9_]+",f=n.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",_=new RegExp(`^https?://${f}/${h}/b/${s}/o${m}`,"i"),R={bucket:1,path:3},A=n===vA?"(?:storage.googleapis.com|storage.cloud.google.com)":n,N="([^?#]*)",b=new RegExp(`^https?://${A}/${s}/${N}`,"i"),E=[{regex:a,indices:c,postModify:i},{regex:_,indices:R,postModify:d},{regex:b,indices:{bucket:1,path:2},postModify:d}];for(let I=0;I<E.length;I++){const O=E[I],F=O.regex.exec(e);if(F){const x=F[O.indices.bucket];let w=F[O.indices.path];w||(w=""),r=new yn(x,w),O.postModify(r);break}}if(r==null)throw rF(e);return r}}class uF{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dF(t,e,n){let r=1,s=null,i=null,o=!1,a=0;function c(){return a===2}let d=!1;function h(...N){d||(d=!0,e.apply(null,N))}function f(N){s=setTimeout(()=>{s=null,t(_,c())},N)}function m(){i&&clearTimeout(i)}function _(N,...b){if(d){m();return}if(N){m(),h.call(null,N,...b);return}if(c()||o){m(),h.call(null,N,...b);return}r<64&&(r*=2);let E;a===1?(a=2,E=0):E=(r+Math.random())*1e3,f(E)}let R=!1;function A(N){R||(R=!0,m(),!d&&(s!==null?(N||(a=2),clearTimeout(s),f(0)):N||(a=1)))}return f(0),i=setTimeout(()=>{o=!0,A(!0)},n),A}function hF(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fF(t){return t!==void 0}function pF(t){return typeof t=="object"&&!Array.isArray(t)}function Fv(t){return typeof t=="string"||t instanceof String}function Yx(t){return Uv()&&t instanceof Blob}function Uv(){return typeof Blob<"u"}function bg(t,e,n,r){if(r<e)throw Ig(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Ig(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function du(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function EA(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var to;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(to||(to={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mF(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gF{constructor(e,n,r,s,i,o,a,c,d,h,f,m=!0,_=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=f,this.retry=m,this.isUsingEmulator=_,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((R,A)=>{this.resolve_=R,this.reject_=A,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Ku(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const c=a.loaded,d=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===to.NO_ERROR,c=i.getStatus();if(!a||mF(c,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===to.ABORT;r(!1,new Ku(!1,null,h));return}const d=this.successCodes_.indexOf(c)!==-1;r(!0,new Ku(d,i))})},n=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(a,a.getResponse());fF(c)?i(c):i()}catch(c){o(c)}else if(a!==null){const c=Mv();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(s.canceled){const c=this.appDelete_?wA():nF();o(c)}else{const c=tF();o(c)}};this.canceled_?n(!1,new Ku(!1,null,!0)):this.backoffId_=dF(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&hF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Ku{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function yF(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function vF(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function _F(t,e){e&&(t["X-Firebase-GMPID"]=e)}function wF(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function EF(t,e,n,r,s,i,o=!0,a=!1){const c=EA(t.urlParams),d=t.url+c,h=Object.assign({},t.headers);return _F(h,e),yF(h,n),vF(h,i),wF(h,r),new gF(d,t.method,h,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xF(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function IF(...t){const e=xF();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(Uv())return new Blob(t);throw new Tt(bt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function bF(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TF(t){if(typeof atob>"u")throw lF("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zr={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Op{constructor(e,n){this.data=e,this.contentType=n||null}}function SF(t,e){switch(t){case zr.RAW:return new Op(xA(e));case zr.BASE64:case zr.BASE64URL:return new Op(IA(t,e));case zr.DATA_URL:return new Op(AF(e),RF(e))}throw Mv()}function xA(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=t.charCodeAt(++n);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function CF(t){let e;try{e=decodeURIComponent(t)}catch{throw lc(zr.DATA_URL,"Malformed data URL.")}return xA(e)}function IA(t,e){switch(t){case zr.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw lc(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case zr.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw lc(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=TF(e)}catch(s){throw s.message.includes("polyfill")?s:lc(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class bA{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw lc(zr.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=NF(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function AF(t){const e=new bA(t);return e.base64?IA(zr.BASE64,e.rest):CF(e.rest)}function RF(t){return new bA(t).contentType}function NF(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e,n){let r=0,s="";Yx(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(Yx(this.data_)){const r=this.data_,s=bF(r,e,n);return s===null?null:new Gs(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new Gs(r,!0)}}static getBlob(...e){if(Uv()){const n=e.map(r=>r instanceof Gs?r.data_:r);return new Gs(IF.apply(null,n))}else{const n=e.map(o=>Fv(o)?SF(zr.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new Gs(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v(t){let e;try{e=JSON.parse(t)}catch{return null}return pF(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PF(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function kF(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function TA(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DF(t,e){return e}class fn{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||DF}}let Qu=null;function jF(t){return!Fv(t)||t.length<2?t:TA(t)}function SA(){if(Qu)return Qu;const t=[];t.push(new fn("bucket")),t.push(new fn("generation")),t.push(new fn("metageneration")),t.push(new fn("name","fullPath",!0));function e(i,o){return jF(o)}const n=new fn("name");n.xform=e,t.push(n);function r(i,o){return o!==void 0?Number(o):o}const s=new fn("size");return s.xform=r,t.push(s),t.push(new fn("timeCreated")),t.push(new fn("updated")),t.push(new fn("md5Hash",null,!0)),t.push(new fn("cacheControl",null,!0)),t.push(new fn("contentDisposition",null,!0)),t.push(new fn("contentEncoding",null,!0)),t.push(new fn("contentLanguage",null,!0)),t.push(new fn("contentType",null,!0)),t.push(new fn("metadata","customMetadata",!0)),Qu=t,Qu}function OF(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new yn(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function LF(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const o=n[i];r[o.local]=o.xform(r,e[o.server])}return OF(r,t),r}function CA(t,e,n){const r=$v(e);return r===null?null:LF(t,r,n)}function VF(t,e,n,r){const s=$v(e);if(s===null||!Fv(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(d=>{const h=t.bucket,f=t.fullPath,m="/b/"+o(h)+"/o/"+o(f),_=du(m,n,r),R=EA({alt:"media",token:d});return _+R})[0]}function MF(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xx="prefixes",Jx="items";function FF(t,e,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[Xx])for(const s of n[Xx]){const i=s.replace(/\/$/,""),o=t._makeStorageReference(new yn(e,i));r.prefixes.push(o)}if(n[Jx])for(const s of n[Jx]){const i=t._makeStorageReference(new yn(e,s.name));r.items.push(i)}return r}function UF(t,e,n){const r=$v(n);return r===null?null:FF(t,e,r)}class Pf{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bv(t){if(!t)throw Mv()}function $F(t,e){function n(r,s){const i=CA(t,s,e);return Bv(i!==null),i}return n}function BF(t,e){function n(r,s){const i=UF(t,e,s);return Bv(i!==null),i}return n}function zF(t,e){function n(r,s){const i=CA(t,s,e);return Bv(i!==null),VF(i,s,t.host,t._protocol)}return n}function zv(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=ZM():s=JM():n.getStatus()===402?s=XM(t.bucket):n.getStatus()===403?s=eF(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function AA(t){const e=zv(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=YM(t.path)),i.serverResponse=s.serverResponse,i}return n}function qF(t,e,n,r,s){const i={};e.isRoot?i.prefix="":i.prefix=e.path+"/",n.length>0&&(i.delimiter=n),r&&(i.pageToken=r),s&&(i.maxResults=s);const o=e.bucketOnlyServerUrl(),a=du(o,t.host,t._protocol),c="GET",d=t.maxOperationRetryTime,h=new Pf(a,c,BF(t,e.bucket),d);return h.urlParams=i,h.errorHandler=zv(e),h}function HF(t,e,n){const r=e.fullServerUrl(),s=du(r,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,a=new Pf(s,i,zF(t,n),o);return a.errorHandler=AA(e),a}function WF(t,e){const n=e.fullServerUrl(),r=du(n,t.host,t._protocol),s="DELETE",i=t.maxOperationRetryTime;function o(c,d){}const a=new Pf(r,s,o,i);return a.successCodes=[200,204],a.errorHandler=AA(e),a}function GF(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function KF(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=GF(null,e)),r}function QF(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let E="";for(let I=0;I<2;I++)E=E+Math.random().toString().slice(2);return E}const c=a();o["Content-Type"]="multipart/related; boundary="+c;const d=KF(e,r,s),h=MF(d,n),f="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,m=`\r
--`+c+"--",_=Gs.getBlob(f,r,m);if(_===null)throw oF();const R={name:d.fullPath},A=du(i,t.host,t._protocol),N="POST",b=t.maxUploadRetryTime,y=new Pf(A,N,$F(t,n),b);return y.urlParams=R,y.headers=o,y.body=_.uploadData(),y.errorHandler=zv(e),y}class YF{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=to.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=to.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=to.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s,i){if(this.sent_)throw Cl("cannot .send() more than once");if(Ei(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Cl("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Cl("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Cl("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Cl("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class XF extends YF{initXhr(){this.xhr_.responseType="text"}}function kf(){return new XF}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e,n){this._service=e,n instanceof yn?this._location=n:this._location=yn.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new _o(e,n)}get root(){const e=new yn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return TA(this._location.path)}get storage(){return this._service}get parent(){const e=PF(this._location.path);if(e===null)return null;const n=new yn(this._location.bucket,e);return new _o(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw cF(e)}}function JF(t,e,n){t._throwIfRoot("uploadBytes");const r=QF(t.storage,t._location,SA(),new Gs(e,!0),n);return t.storage.makeRequestWithTokens(r,kf).then(s=>({metadata:s,ref:t}))}function ZF(t){const e={prefixes:[],items:[]};return RA(t,e).then(()=>e)}async function RA(t,e,n){const s=await e4(t,{pageToken:n});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await RA(t,e,s.nextPageToken)}function e4(t,e){e!=null&&typeof e.maxResults=="number"&&bg("options.maxResults",1,1e3,e.maxResults);const n=e||{},r=qF(t.storage,t._location,"/",n.pageToken,n.maxResults);return t.storage.makeRequestWithTokens(r,kf)}function t4(t){t._throwIfRoot("getDownloadURL");const e=HF(t.storage,t._location,SA());return t.storage.makeRequestWithTokens(e,kf).then(n=>{if(n===null)throw aF();return n})}function n4(t){t._throwIfRoot("deleteObject");const e=WF(t.storage,t._location);return t.storage.makeRequestWithTokens(e,kf)}function r4(t,e){const n=kF(t._location.path,e),r=new yn(t._location.bucket,n);return new _o(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s4(t){return/^[A-Za-z]+:\/\//.test(t)}function i4(t,e){return new _o(t,e)}function NA(t,e){if(t instanceof qv){const n=t;if(n._bucket==null)throw iF();const r=new _o(n,n._bucket);return e!=null?NA(r,e):r}else return e!==void 0?r4(t,e):t}function o4(t,e){if(e&&s4(e)){if(t instanceof qv)return i4(t,e);throw Ig("To use ref(service, url), the first argument must be a Storage instance.")}else return NA(t,e)}function Zx(t,e){const n=e==null?void 0:e[_A];return n==null?null:yn.makeFromBucketSpec(n,t)}function a4(t,e,n,r={}){t.host=`${e}:${n}`;const s=Ei(e);s&&(Cy(`https://${t.host}/b`),Ay("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:hT(i,t.app.options.projectId))}class qv{constructor(e,n,r,s,i,o=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=vA,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=KM,this._maxUploadRetryTime=QM,this._requests=new Set,s!=null?this._bucket=yn.makeFromBucketSpec(s,this._host):this._bucket=Zx(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=yn.makeFromBucketSpec(this._url,e):this._bucket=Zx(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){bg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){bg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(er(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new _o(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new uF(wA());{const o=EF(e,this._appId,r,s,n,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const eI="@firebase/storage",tI="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PA="storage";function nI(t,e,n){return t=Xe(t),JF(t,e,n)}function rI(t){return t=Xe(t),ZF(t)}function sI(t){return t=Xe(t),t4(t)}function Lp(t){return t=Xe(t),n4(t)}function Al(t,e){return t=Xe(t),o4(t,e)}function Bi(t=Qh(),e){t=Xe(t);const r=xi(t,PA).getImmediate({identifier:e}),s=cT("storage");return s&&l4(r,...s),r}function l4(t,e,n,r={}){a4(t,e,n,r)}function c4(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new qv(n,r,s,e,To)}function u4(){br(new cr(PA,c4,"PUBLIC").setMultipleInstances(!0)),kn(eI,tI,""),kn(eI,tI,"esm2020")}u4();const d4={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},Hv=Py(d4),iI=rS(Hv),oI=sA(Hv);Bi(Hv);const h4="/odontocloud-react/assets/fondo.png",kA="/odontocloud-react/assets/logo.png",aI=(t,e)=>{const n={email:t,rol:e,timestamp:Date.now()};localStorage.setItem("odc_session",JSON.stringify(n))},Vp=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},f4=()=>{const t=xs(),[e,n]=C.useState(""),[r,s]=C.useState(""),[i,o]=C.useState(""),[a,c]=C.useState(navigator.onLine);C.useEffect(()=>{const f=()=>c(!0),m=()=>c(!1);return window.addEventListener("online",f),window.addEventListener("offline",m),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",m)}},[]);const d=f=>{const m=(f||"").toLowerCase();m==="administrador"?t("/dashboard_admin",{replace:!0}):m==="doctor"?t("/dashboard_doctor",{replace:!0}):m==="recepcionista"?t("/dashboard_recepcion",{replace:!0}):o("Rol no reconocido. Contacte al administrador.")};C.useEffect(()=>{if(!navigator.onLine){const m=Vp();m!=null&&m.rol?d(m.rol):o("Sin conexin y no hay sesin guardada.");return}const f=My(iI,async m=>{if(m){const _=Vp();if(_!=null&&_.rol){d(_.rol);return}try{const R=it(Ce(oI,"users"),Je("correo","==",m.email||"")),A=await gt(R);if(!A.empty){const N=A.docs[0].data().rol||"sin_rol";aI(m.email||"",N),d(N)}}catch{d("administrador")}}});return()=>f()},[]);const h=async f=>{if(f.preventDefault(),o(""),!a){const m=Vp();m!=null&&m.rol?d(m.rol):o("Sin conexin y no hay sesin guardada.");return}try{const _=(await Gj(iI,e,r)).user,R=it(Ce(oI,"users"),Je("correo","==",e)),A=await gt(R);if(A.empty){o("Usuario no encontrado en la base de datos.");return}const b=A.docs[0].data().rol||"sin_rol";aI(e,b),d(b)}catch(m){switch(console.error("Error login:",m),m.code){case"auth/user-not-found":o("Usuario no registrado.");break;case"auth/wrong-password":o("Contrasea incorrecta.");break;case"auth/invalid-email":o("Correo no vlido.");break;case"auth/network-request-failed":o("Sin conexin. Usa la sesin guardada o reconecta.");break;default:o("Error al iniciar sesin.")}}};return l.jsx("div",{className:"login-root",style:{backgroundImage:`url(${h4})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed",width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:l.jsxs("div",{className:"container",children:[l.jsxs("div",{className:"left-panel",children:[l.jsx("img",{src:kA,alt:"OdontoCloud Logo",className:"logo"}),l.jsxs("h2",{children:["Su clnica, ",l.jsx("br",{})," ms conectada."]}),l.jsx("p",{children:"OdontoCloud optimiza cada detalle de su gestin."})]}),l.jsxs("div",{className:"right-panel",children:[l.jsx("h3",{children:"Acceso a la plataforma"}),l.jsxs("form",{onSubmit:h,children:[l.jsx("input",{type:"email",placeholder:"usuario@ejemplo.com",value:e,onChange:f=>n(f.target.value),required:a}),l.jsx("input",{type:"password",placeholder:"Contrasea",value:r,onChange:f=>s(f.target.value),required:a}),l.jsx("button",{type:"submit",children:a?"Iniciar sesin":"Entrar (modo offline)"}),i&&l.jsx("p",{style:{color:"red",marginTop:10},children:i}),!a&&l.jsx("p",{style:{color:"orange",marginTop:10},children:" Modo offline activado"})]})]})]})})},DA="@firebase/installations",Wv="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jA=1e4,OA=`w:${Wv}`,LA="FIS_v2",p4="https://firebaseinstallations.googleapis.com/v1",m4=60*60*1e3,g4="installations",y4="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},wo=new bo(g4,y4,v4);function VA(t){return t instanceof ur&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MA({projectId:t}){return`${p4}/projects/${t}/installations`}function FA(t){return{token:t.token,requestStatus:2,expiresIn:w4(t.expiresIn),creationTime:Date.now()}}async function UA(t,e){const r=(await e.json()).error;return wo.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function $A({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function _4(t,{refreshToken:e}){const n=$A(t);return n.append("Authorization",E4(e)),n}async function BA(t){const e=await t();return e.status>=500&&e.status<600?t():e}function w4(t){return Number(t.replace("s","000"))}function E4(t){return`${LA} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x4({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=MA(t),s=$A(t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={fid:n,authVersion:LA,appId:t.appId,sdkVersion:OA},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await BA(()=>fetch(r,a));if(c.ok){const d=await c.json();return{fid:d.fid||n,registrationStatus:2,refreshToken:d.refreshToken,authToken:FA(d.authToken)}}else throw await UA("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zA(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I4(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b4=/^[cdef][\w-]{21}$/,Tg="";function T4(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=S4(t);return b4.test(n)?n:Tg}catch{return Tg}}function S4(t){return I4(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qA=new Map;function HA(t,e){const n=Df(t);WA(n,e),C4(n,e)}function WA(t,e){const n=qA.get(t);if(n)for(const r of n)r(e)}function C4(t,e){const n=A4();n&&n.postMessage({key:t,fid:e}),R4()}let Gi=null;function A4(){return!Gi&&"BroadcastChannel"in self&&(Gi=new BroadcastChannel("[Firebase] FID Change"),Gi.onmessage=t=>{WA(t.data.key,t.data.fid)}),Gi}function R4(){qA.size===0&&Gi&&(Gi.close(),Gi=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N4="firebase-installations-database",P4=1,Eo="firebase-installations-store";let Mp=null;function Gv(){return Mp||(Mp=wT(N4,P4,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Eo)}}})),Mp}async function Sh(t,e){const n=Df(t),s=(await Gv()).transaction(Eo,"readwrite"),i=s.objectStore(Eo),o=await i.get(n);return await i.put(e,n),await s.done,(!o||o.fid!==e.fid)&&HA(t,e.fid),e}async function GA(t){const e=Df(t),r=(await Gv()).transaction(Eo,"readwrite");await r.objectStore(Eo).delete(e),await r.done}async function jf(t,e){const n=Df(t),s=(await Gv()).transaction(Eo,"readwrite"),i=s.objectStore(Eo),o=await i.get(n),a=e(o);return a===void 0?await i.delete(n):await i.put(a,n),await s.done,a&&(!o||o.fid!==a.fid)&&HA(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kv(t){let e;const n=await jf(t.appConfig,r=>{const s=k4(r),i=D4(t,s);return e=i.registrationPromise,i.installationEntry});return n.fid===Tg?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function k4(t){const e=t||{fid:T4(),registrationStatus:0};return KA(e)}function D4(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(wo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=j4(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:O4(t)}:{installationEntry:e}}async function j4(t,e){try{const n=await x4(t,e);return Sh(t.appConfig,n)}catch(n){throw VA(n)&&n.customData.serverCode===409?await GA(t.appConfig):await Sh(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function O4(t){let e=await lI(t.appConfig);for(;e.registrationStatus===1;)await zA(100),e=await lI(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await Kv(t);return r||n}return e}function lI(t){return jf(t,e=>{if(!e)throw wo.create("installation-not-found");return KA(e)})}function KA(t){return L4(t)?{fid:t.fid,registrationStatus:0}:t}function L4(t){return t.registrationStatus===1&&t.registrationTime+jA<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V4({appConfig:t,heartbeatServiceProvider:e},n){const r=M4(t,n),s=_4(t,n),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={installation:{sdkVersion:OA,appId:t.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await BA(()=>fetch(r,a));if(c.ok){const d=await c.json();return FA(d)}else throw await UA("Generate Auth Token",c)}function M4(t,{fid:e}){return`${MA(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qv(t,e=!1){let n;const r=await jf(t.appConfig,i=>{if(!QA(i))throw wo.create("not-registered");const o=i.authToken;if(!e&&$4(o))return i;if(o.requestStatus===1)return n=F4(t,e),i;{if(!navigator.onLine)throw wo.create("app-offline");const a=z4(i);return n=U4(t,a),a}});return n?await n:r.authToken}async function F4(t,e){let n=await cI(t.appConfig);for(;n.authToken.requestStatus===1;)await zA(100),n=await cI(t.appConfig);const r=n.authToken;return r.requestStatus===0?Qv(t,e):r}function cI(t){return jf(t,e=>{if(!QA(e))throw wo.create("not-registered");const n=e.authToken;return q4(n)?{...e,authToken:{requestStatus:0}}:e})}async function U4(t,e){try{const n=await V4(t,e),r={...e,authToken:n};return await Sh(t.appConfig,r),n}catch(n){if(VA(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await GA(t.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Sh(t.appConfig,r)}throw n}}function QA(t){return t!==void 0&&t.registrationStatus===2}function $4(t){return t.requestStatus===2&&!B4(t)}function B4(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+m4}function z4(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}function q4(t){return t.requestStatus===1&&t.requestTime+jA<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function H4(t){const e=t,{installationEntry:n,registrationPromise:r}=await Kv(e);return r?r.catch(console.error):Qv(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W4(t,e=!1){const n=t;return await G4(n),(await Qv(n,e)).token}async function G4(t){const{registrationPromise:e}=await Kv(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K4(t){if(!t||!t.options)throw Fp("App Configuration");if(!t.name)throw Fp("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Fp(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function Fp(t){return wo.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YA="installations",Q4="installations-internal",Y4=t=>{const e=t.getProvider("app").getImmediate(),n=K4(e),r=xi(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},X4=t=>{const e=t.getProvider("app").getImmediate(),n=xi(e,YA).getImmediate();return{getId:()=>H4(n),getToken:s=>W4(n,s)}};function J4(){br(new cr(YA,Y4,"PUBLIC")),br(new cr(Q4,X4,"PRIVATE"))}J4();kn(DA,Wv);kn(DA,Wv,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ch="analytics",Z4="firebase_id",eU="origin",tU=60*1e3,nU="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Yv="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wn=new Kh("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rU={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},qn=new bo("analytics","Analytics",rU);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sU(t){if(!t.startsWith(Yv)){const e=qn.create("invalid-gtag-resource",{gtagURL:t});return wn.warn(e.message),""}return t}function XA(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function iU(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function oU(t,e){const n=iU("firebase-js-sdk-policy",{createScriptURL:sU}),r=document.createElement("script"),s=`${Yv}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function aU(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function lU(t,e,n,r,s,i){const o=r[s];try{if(o)await e[o];else{const c=(await XA(n)).find(d=>d.measurementId===s);c&&await e[c.appId]}}catch(a){wn.error(a)}t("config",s,i)}async function cU(t,e,n,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await XA(n);for(const c of o){const d=a.find(f=>f.measurementId===c),h=d&&e[d.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),t("event",r,s||{})}catch(i){wn.error(i)}}function uU(t,e,n,r){async function s(i,...o){try{if(i==="event"){const[a,c]=o;await cU(t,e,n,a,c)}else if(i==="config"){const[a,c]=o;await lU(t,e,n,r,a,c)}else if(i==="consent"){const[a,c]=o;t("consent",a,c)}else if(i==="get"){const[a,c,d]=o;t("get",a,c,d)}else if(i==="set"){const[a]=o;t("set",a)}else t(i,...o)}catch(a){wn.error(a)}}return s}function dU(t,e,n,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=uU(i,t,e,n),{gtagCore:i,wrappedGtag:window[s]}}function hU(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Yv)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fU=30,pU=1e3;class mU{constructor(e={},n=pU){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const JA=new mU;function gU(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function yU(t){var o;const{appId:e,apiKey:n}=t,r={method:"GET",headers:gU(n)},s=nU.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let a="";try{const c=await i.json();(o=c.error)!=null&&o.message&&(a=c.error.message)}catch{}throw qn.create("config-fetch-failed",{httpStatus:i.status,responseMessage:a})}return i.json()}async function vU(t,e=JA,n){const{appId:r,apiKey:s,measurementId:i}=t.options;if(!r)throw qn.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw qn.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new EU;return setTimeout(async()=>{a.abort()},tU),ZA({appId:r,apiKey:s,measurementId:i},o,a,e)}async function ZA(t,{throttleEndTimeMillis:e,backoffCount:n},r,s=JA){var a;const{appId:i,measurementId:o}=t;try{await _U(r,e)}catch(c){if(o)return wn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:o};throw c}try{const c=await yU(t);return s.deleteThrottleMetadata(i),c}catch(c){const d=c;if(!wU(d)){if(s.deleteThrottleMetadata(i),o)return wn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:i,measurementId:o};throw c}const h=Number((a=d==null?void 0:d.customData)==null?void 0:a.httpStatus)===503?Qw(n,s.intervalMillis,fU):Qw(n,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:n+1};return s.setThrottleMetadata(i,f),wn.debug(`Calling attemptFetch again in ${h} millis`),ZA(t,f,r,s)}}function _U(t,e){return new Promise((n,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(n,s);t.addEventListener(()=>{clearTimeout(i),r(qn.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function wU(t){if(!(t instanceof ur)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class EU{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function xU(t,e,n,r,s){if(s&&s.global){t("event",n,r);return}else{const i=await e,o={...r,send_to:i};t("event",n,o)}}async function IU(t,e,n,r){if(r&&r.global){const s={};for(const i of Object.keys(n))s[`user_properties.${i}`]=n[i];return t("set",s),Promise.resolve()}else{const s=await e;t("config",s,{update:!0,user_properties:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bU(){if(Ry())try{await yT()}catch(t){return wn.warn(qn.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return wn.warn(qn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function TU(t,e,n,r,s,i,o){const a=vU(t);a.then(m=>{n[m.measurementId]=m.appId,t.options.measurementId&&m.measurementId!==t.options.measurementId&&wn.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>wn.error(m)),e.push(a);const c=bU().then(m=>{if(m)return r.getId()}),[d,h]=await Promise.all([a,c]);hU(i)||oU(i,d.measurementId),s("js",new Date);const f=(o==null?void 0:o.config)??{};return f[eU]="firebase",f.update=!0,h!=null&&(f[Z4]=h),s("config",d.measurementId,f),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SU{constructor(e){this.app=e}_delete(){return delete Ea[this.app.options.appId],Promise.resolve()}}let Ea={},uI=[];const dI={};let Up="dataLayer",CU="gtag",hI,Xv,fI=!1;function AU(){const t=[];if(pT()&&t.push("This is a browser extension environment."),Rk()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,s)=>`(${s+1}) ${r}`).join(" "),n=qn.create("invalid-analytics-context",{errorInfo:e});wn.warn(n.message)}}function RU(t,e,n){AU();const r=t.options.appId;if(!r)throw qn.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)wn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw qn.create("no-api-key");if(Ea[r]!=null)throw qn.create("already-exists",{id:r});if(!fI){aU(Up);const{wrappedGtag:i,gtagCore:o}=dU(Ea,uI,dI,Up,CU);Xv=i,hI=o,fI=!0}return Ea[r]=TU(t,uI,dI,e,hI,Up,n),new SU(t)}function NU(t=Qh()){t=Xe(t);const e=xi(t,Ch);return e.isInitialized()?e.getImmediate():PU(t)}function PU(t,e={}){const n=xi(t,Ch);if(n.isInitialized()){const s=n.getImmediate();if(gs(e,n.getOptions()))return s;throw qn.create("already-initialized")}return n.initialize({options:e})}function kU(t,e,n){t=Xe(t),IU(Xv,Ea[t.app.options.appId],e,n).catch(r=>wn.error(r))}function DU(t,e,n,r){t=Xe(t),xU(Xv,Ea[t.app.options.appId],e,n,r).catch(s=>wn.error(s))}const pI="@firebase/analytics",mI="0.10.19";function jU(){br(new cr(Ch,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return RU(r,s,n)},"PUBLIC")),br(new cr("analytics-internal",t,"PRIVATE")),kn(pI,mI),kn(pI,mI,"esm2020");function t(e){try{const n=e.getProvider(Ch).getImmediate();return{logEvent:(r,s,i)=>DU(n,r,s,i),setUserProperties:(r,s)=>kU(n,r,s)}}catch(n){throw qn.create("interop-component-reg-failed",{reason:n})}}}jU();const OU={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},Of=Py(OU),Ah=rS(Of),ue=sA(Of);Bi(Of);NU(Of);const Jv=(t,e="")=>{try{return localStorage.getItem(t)??e}catch{return e}},gI=()=>{var t;return((t=document.querySelector('meta[name="company-name"]'))==null?void 0:t.getAttribute("content"))||Jv("empresa_nombre","OdontoCloud")},LU=()=>{var t;return((t=document.querySelector('meta[name="company-logo"]'))==null?void 0:t.getAttribute("content"))||Jv("empresa_logo_url","")},yI=()=>{var t;return((t=document.querySelector('meta[name="software-footer"]'))==null?void 0:t.getAttribute("content"))||Jv("software_footer_text","Generado por OdontoCloud")},Yu=()=>{const t=new Date;return t.setHours(0,0,0,0),t},Ls=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e},$p=t=>{const e=new Date(t);return e.setHours(23,59,59,999),e},Lr=(t,e)=>{const n=new Date(t);return n.setDate(n.getDate()+e),n},vI=t=>{const e=new Date(t),n=e.getDay(),r=(n===0?-6:1)-n;return e.setDate(e.getDate()+r),e.setHours(0,0,0,0),e},_I=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();var CI;const Vn=typeof navigator<"u"&&((CI=navigator.language)!=null&&CI.startsWith("es"))?"es-ES":"en-US",Bp=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`},Fo=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),VU=t=>{try{const e=new URLSearchParams(t||""),n=e.get("date")||e.get("day")||e.get("d")||e.get("fecha")||e.get("selectedDate")||(typeof sessionStorage<"u"?sessionStorage.getItem("agenda.targetDate"):""),r=String(n||"").slice(0,10);if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return null;const[s,i,o]=r.split("-").map(c=>parseInt(c,10));return new Date(s,(i||1)-1,o||1,0,0,0,0)}catch{return null}};function MU(){const t=Dn(),[e,n]=C.useState("day"),[r,s]=C.useState(Yu()),[i,o]=C.useState(Yu()),[a,c]=C.useState(!0),[d,h]=C.useState([]),[f,m]=C.useState(""),[_,R]=C.useState(""),[A,N]=C.useState("");C.useEffect(()=>{const U=VU(t.search);if(U){const ie=Ls(U);s(ie),o(ie),n("day");try{sessionStorage.removeItem("agenda.targetDate")}catch{}}},[t.search]),C.useEffect(()=>{c(!0);const U=Ce(ue,"citas"),ie=it(U,gn("fecha","asc")),B=Un(ie,W=>{const re=W.docs.map(fe=>{const le=fe.data(),De=le.horaInicio||le.hora||"00:00",[Le="0",nt="0"]=De.split(":"),G=parseInt(Le,10)||0,ae=parseInt(nt,10)||0;let z;if(le.fecha&&le.fecha.toDate)z=le.fecha.toDate(),z.setHours(G,ae,0,0);else if(typeof le.fecha=="string"){const[xe,Ie,Ue]=le.fecha.split("-");z=new Date(parseInt(xe,10),parseInt(Ie,10)-1,parseInt(Ue,10),G,ae,0,0)}else le.fecha instanceof Date?(z=new Date(le.fecha),z.setHours(G,ae,0,0)):(z=new Date,z.setHours(G,ae,0,0));const oe=le.documentoPaciente||le.docPaciente||le.pacienteDocumento||le.documento||"",ce=le.celularPaciente||le.telefonoPaciente||le.celular||le.telefono||"";return{id:fe.id,raw:le,fecha:z,horaInicio:De,paciente:le.paciente||le.pacienteNombre||"Sin nombre",doctor:le.doctor||le.doctorNombre||"",sucursal:le.sucursal||"",espacio:le.espacio||le.consultorio||"",comentario:le.comentario||"",estado:le.estado||"En espera",recordatorio:le.recordatorio||"",documento:oe,telefono:ce}});let ge,he;if(e==="day")ge=Ls(r),he=$p(r);else if(e==="week"){const fe=vI(r),le=Lr(fe,6);ge=Ls(fe),he=$p(le)}else{const fe=Ls(r),le=Lr(fe,-30),De=Lr(fe,60);ge=Ls(le),he=$p(De)}const Oe=re.filter(fe=>fe.fecha>=ge&&fe.fecha<=he);h(Oe),c(!1)},W=>{console.error("Error leyendo citas:",W),h([]),c(!1)});return()=>B()},[e,r]);const b=C.useMemo(()=>{const U=new Set;return d.forEach(ie=>ie.sucursal&&U.add(ie.sucursal)),Array.from(U)},[d]),y=C.useMemo(()=>{const U=new Set;return d.forEach(ie=>ie.doctor&&U.add(ie.doctor)),Array.from(U)},[d]),E=C.useMemo(()=>{const U=A.trim().toLowerCase();return d.filter(ie=>{if(f&&ie.sucursal!==f||_&&ie.doctor!==_)return!1;if(!U)return!0;const B=[ie.paciente,ie.doctor,ie.comentario,ie.documento,ie.sucursal,ie.espacio,ie.estado],W=ie.raw?JSON.stringify(ie.raw):"";return[...B,W].filter(Boolean).some(ge=>String(ge).toLowerCase().includes(U))})},[d,f,_,A]),I=C.useMemo(()=>a?"Ocupacin: cargando...":E.length===0?"Ocupacin: sin citas para el rango seleccionado.":`Ocupacin: ${E.length} cita${E.length!==1?"s":""} en el rango actual.`,[E,a]),O=C.useMemo(()=>{const U=new Date(i.getFullYear(),i.getMonth(),1),ie=(U.getDay()+6)%7,B=new Date(U);B.setDate(B.getDate()-ie);const W=[];for(let re=0;re<6;re++){const ge=[];for(let he=0;he<7;he++){const Oe=new Date(B),fe=Oe.getMonth()===i.getMonth(),le=_I(Oe,Yu()),De=_I(Oe,r);ge.push({date:Oe,isCurrentMonth:fe,isToday:le,isSelected:De}),B.setDate(B.getDate()+1)}W.push(ge)}return W},[i,r]),F=()=>{const U=new Date(i);U.setMonth(U.getMonth()-1),o(U)},x=()=>{const U=new Date(i);U.setMonth(U.getMonth()+1),o(U)},w=U=>{s(Ls(U)),o(Ls(U)),n("day")},v=C.useMemo(()=>i.toLocaleDateString(Vn,{month:"long",year:"numeric"}),[i]),P=C.useMemo(()=>{if(e==="day")return r.toLocaleDateString(Vn,{weekday:"long",day:"2-digit",month:"long",year:"numeric"});if(e==="week"){const U=vI(r),ie=Lr(U,6);return U.toLocaleDateString(Vn,{day:"2-digit",month:"short"})+" - "+ie.toLocaleDateString(Vn,{day:"2-digit",month:"short",year:"numeric"})}return"ltimas citas (detalle)"},[e,r]),D=()=>{s(e==="day"?Lr(r,-1):e==="week"?Lr(r,-7):Lr(r,-1))},j=()=>{s(e==="day"?Lr(r,1):e==="week"?Lr(r,7):Lr(r,1))},k=()=>{const U=Yu();s(U),o(U),n("day")},K=()=>{var ae;const U=z=>String(z??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ie=gI(),B=LU(),W=yI(),re=f||"",ge=_||"",he=new Date;he.setHours(0,0,0,0);const Oe=E.length===0?'<tr class="empty"><td colspan="10">No hay citas registradas para este rango.</td></tr>':E.map((z,oe)=>{var ke,Se,M,J,te,Ne;const ce=z.fecha.toLocaleTimeString(Vn,{hour:"2-digit",minute:"2-digit",hour12:!0}),xe=z.documento||((ke=z.raw)==null?void 0:ke.documento)||((Se=z.raw)==null?void 0:Se.nroDocumento)||"",Ie=((M=z.raw)==null?void 0:M.celularPaciente)||((J=z.raw)==null?void 0:J.celular)||"",Ue=((te=z.raw)==null?void 0:te.telefonoPaciente)||((Ne=z.raw)==null?void 0:Ne.telefono)||"",Re=new Date(z.fecha.getFullYear(),z.fecha.getMonth(),z.fecha.getDate());let Me="Futura";return Re.getTime()===he.getTime()?Me="Hoy":Re.getTime()<he.getTime()&&(Me="Pasada"),`<tr class="${oe%2?"zebra":""}">
              <td class="mono">${U(ce)}</td>
              <td>${U(z.paciente)}</td>
              <td class="mono">${U(xe)}</td>
              <td class="mono">${U(Ie)}</td>
              <td class="mono">${U(Ue)}</td>
              <td>${U(z.doctor)}</td>
              <td>${U(z.espacio)}</td>
              <td>${U(z.comentario)}</td>
              <td class="status">${U(z.estado)}</td>
              <td class="actual">${U(Me)}</td>
            </tr>`}).join(""),le=`<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Agenda  ${U(ie)}</title>
  <style>
    @page { size: A4 portrait; margin: 14mm 16mm; }
    * { box-sizing: border-box; }
    html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    body { font-family: "Segoe UI", Roboto, Arial, sans-serif; color:#0f172a; line-height:1.35; }

    /* Cabecera */
    .hdr {
      display:flex; flex-direction:column; align-items:center; text-align:center;
      margin-bottom:14px;
    }
    .logo {
      max-height:120px; width:auto; max-width:100%; object-fit:contain;
      filter: drop-shadow(0 1px 0 rgba(0,0,0,.04));
    }
    .brand {
      margin-top:4px; font-weight:800; letter-spacing:.5px; text-transform:uppercase;
      font-size:26px; color:#0a86d8;
    }
    .sub { margin-top:2px; font-size:12px; color:#64748b; }

    /* Tarjeta info Sede/Doctor */
    .info-card {
      width:100%; display:flex; justify-content:center; margin:8px 0 16px;
    }
    .info {
      width:70%; border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; border-collapse:separate;
      font-size:12px;
    }
    .info-row { display:flex; border-top:1px solid #e5e7eb; }
    .info-row:first-child { border-top:0; }
    .label {
      width:22%; padding:8px 10px; background:#f8fafc; font-weight:600; color:#334155; border-right:1px solid #e5e7eb;
    }
    .value { flex:1; padding:8px 10px; }

    /* Tabla principal */
    table { width:100%; border-collapse:separate; border-spacing:0; font-size:12px; }
    thead th {
      background:#0f172a; color:#ffffff; text-align:center; font-weight:700;
      padding:9px 8px; position:relative;
    }
    thead th + th { box-shadow: inset 1px 0 0 rgba(255,255,255,.08); }
    tbody td {
      padding:8px 8px; vertical-align:top; border-bottom:1px solid #e5e7eb;
    }
    tbody tr.zebra td { background:#fafafa; }
    tbody tr.empty td {
      padding:16px; color:#6b7280; text-align:center; background:#fafafa;
      border:1px dashed #e5e7eb; border-radius:8px;
    }
    td.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    td.status { white-space:nowrap; }
    td.actual { font-weight:600; }
    /* Bordes exteriores suaves */
    .tbl-wrap { border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; }

    /* Notas pie */
    .note { margin-top:10px; font-size:10px; color:#6b7280; }

    /* Evitar cortes feos */
    tr, .hdr, .info-card { page-break-inside: avoid; }
  </style>
</head>
<body>
  <div class="hdr">
    ${B?`<img src="${B}" alt="Logo" class="logo">`:""}
    <div class="brand">${U(ie)}</div>
    <div class="sub">Agenda de citas  ${U(P)}</div>
  </div>

  <div class="info-card">
    <div class="info">
      <div class="info-row"><div class="label">Sede</div><div class="value">${U(re)}</div></div>
      <div class="info-row"><div class="label">Doctor</div><div class="value">${U(ge)}</div></div>
    </div>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th style="width:9%">Hora</th>
          <th style="width:17%">Nombre paciente</th>
          <th style="width:12%">Documento</th>
          <th style="width:12%">Celular</th>
          <th style="width:12%">Telfono</th>
          <th style="width:10%">Doctor</th>
          <th style="width:11%">Espacio</th>
          <th>Comentario</th>
          <th style="width:9%">Estado</th>
          <th style="width:9%">Actualidad</th>
        </tr>
      </thead>
      <tbody>${Oe}</tbody>
    </table>
  </div>

  <div class="note">
    ${U(W)}  ${U(new Date().toLocaleString(Vn))}
  </div>

  <script>
    window.addEventListener('load', function() {
      try { window.focus(); window.print(); } catch (e) {}
    });
  <\/script>
</body>
</html>`,De=new Blob([le],{type:"text/html;charset=utf-8"}),Le=URL.createObjectURL(De),nt=window.open(Le,"_blank","noopener,noreferrer,width=900,height=700");if(!nt){alert("El navegador bloque la ventana de impresin. Permite pop-ups para este sitio."),URL.revokeObjectURL(Le);return}const G=()=>{try{URL.revokeObjectURL(Le)}catch{}};(ae=nt.addEventListener)==null||ae.call(nt,"load",G),setTimeout(G,15e3)},We=()=>alert("Funcin de confirmar citas se integrar con n8n / correo."),At=()=>k(),Qt=()=>{if(E.length===0){alert("No hay citas para exportar.");return}const U=gI(),ie=yI(),B=[`Empresa: ${U}`],W=["Fecha","Hora","Paciente","Doctor","Espacio","Comentario"],re=E.map(Le=>{const nt=Le.fecha.toLocaleDateString(Vn),G=Le.fecha.toLocaleTimeString(Vn,{hour:"2-digit",minute:"2-digit",hour12:!0});return[nt,G,Le.paciente||"",Le.doctor||"",Le.espacio||"",(Le.comentario||"").replace(/\r?\n/g," ")]}),ge=[ie],he=[B,[],W,...re,[],ge].map(Le=>(Le||[]).map(nt=>`"${String(nt??"").replace(/"/g,'""')}"`).join(",")).join(`
`),Oe=`citas_${U.toLowerCase().replace(/\s+/g,"_")}_${Bp(Ls(r))}`+(e==="week"?"_semana":e==="detail"?"_detalle":"")+".csv",fe=new Blob(["\uFEFF"+he],{type:"text/csv;charset=utf-8;"}),le=URL.createObjectURL(fe),De=document.createElement("a");De.href=le,De.download=Oe,De.click(),URL.revokeObjectURL(le)},ee=async(U,ie)=>{try{const B=ct(ue,"citas",U);await us(B,{estado:ie})}catch(B){console.error("Error actualizando estado:",B),alert("No se pudo actualizar el estado de la cita.")}},me=(U,ie)=>{if(!U){alert("Este paciente no tiene celular registrado.");return}const B=String(U).replace(/\D/g,""),W=ie.fecha.toLocaleDateString(Vn),re=ie.fecha.toLocaleTimeString(Vn,{hour:"numeric",minute:"2-digit",hour12:!0}),ge=encodeURIComponent(`Hola ${ie.paciente}, le recordamos su cita odontolgica el ${W} a las ${re}. Por favor confirme su asistencia.`),he=`https://wa.me/${B}?text=${ge}`;window.open(he,"_blank")},_e=async U=>{if(window.confirm(`Seguro que deseas eliminar la cita de ${U.paciente} del ${U.fecha.toLocaleDateString(Vn)}?`))try{const B=ct(ue,"citas",U.id);await Rf(B)}catch(B){console.error("Error eliminando cita:",B),alert(" No se pudo eliminar la cita.")}},Pe=()=>{const U=document.createElement("div");Object.assign(U.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const ie=document.createElement("div");Object.assign(ie.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"}),ie.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Nueva Cita</h2>
      <form id="formNuevaCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label style="font-weight:600;">Paciente existente</label>
        <div style="position:relative;">
          <input type="text" id="buscarPaciente" placeholder="Buscar por nombre, apellido o documento..." autocomplete="off"/>
          <div id="acResultados" style="position:absolute;left:0;right:0;top:calc(100% + 6px);z-index:10000;display:none;background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 8px 22px rgba(0,0,0,.12);max-height:240px;overflow:auto;"></div>
        </div>
        <small style="color:gray;">Si el paciente no existe, marca Registrar nuevo paciente.</small>

        <label style="display:flex;align-items:center;gap:8px;margin-top:5px;">
          <input type="checkbox" id="esNuevoPaciente" />
          <span>Registrar nuevo paciente</span>
        </label>

        <div id="nuevoPacienteCampos" style="display:none;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border-radius:8px;background:#f9f9f9;border:1px solid #ddd;">
          <h4 style="margin:0;text-align:center;color:#0a86d8;">Datos del paciente</h4>
          <div style="display:flex;gap:8px;">
            <input type="text" id="npNombre" placeholder="Nombre" style="flex:1;" />
            <input type="text" id="npApellido" placeholder="Apellido" style="flex:1;" />
          </div>
          <select id="npTipoDocumento">
            <option value="">Tipo de documento</option>
            <option value="CC">Cdula de Ciudadana</option>
            <option value="CE">Cdula de Extranjera</option>
            <option value="TI">Tarjeta de Identidad</option>
            <option value="PA">Pasaporte</option>
            <option value="DI">Documento Internacional</option>
            <option value="OTRO">Otro</option>
          </select>
          <input type="text" id="npDocumento" placeholder="Nmero de documento" />
          <input type="email" id="npCorreo" placeholder="Correo electrnico" />
          <div style="display:flex;gap:5px;">
            <select id="npIndicativo" style="width:40%;">
              <option value="+57"> +57</option>
              <option value="+1"> +1</option>
              <option value="+34"> +34</option>
              <option value="+52"> +52</option>
              <option value="+54"> +54</option>
              <option value="+593"> +593</option>
              <option value="+56"> +56</option>
              <option value="+58"> +58</option>
            </select>
            <input type="tel" id="npCelular" placeholder="Celular (obligatorio)" style="flex:1;" />
          </div>
          <input type="tel" id="npTelefono" placeholder="Telfono fijo (opcional)" />
          <label style="font-weight:500;">Fecha de nacimiento:</label>
          <input type="date" id="npNacimiento" />
          <select id="npSexo">
            <option value="">Sexo</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
            <option value="Otro">Otro</option>
          </select>
          <textarea id="npComentario" placeholder="Comentario o antecedentes del paciente" rows="2"></textarea>
        </div>

        <hr style="margin:10px 0;border:none;border-top:1px solid #ddd;" />
        <h4 style="margin:0;text-align:center;color:#0a86d8;">Detalles de la cita</h4>
        <input type="text" id="ncDoctor" placeholder="Doctor asignado" required />
        <input type="date" id="ncFecha" required value="${Bp(r)}" />
        <input type="time" id="ncHora" required />
        <input type="text" id="ncEspacio" placeholder="Espacio fsico / Sala" />
        <textarea id="ncComentario" placeholder="Comentario sobre la cita" rows="3"></textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarModal" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    `;const B=document.createElement("style");B.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      input, select, textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      input:focus, select:focus, textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
      .ac-item { padding: 8px 10px; display:flex; gap:8px; align-items:baseline; cursor:pointer; }
      .ac-item:hover, .ac-item.active { background:#f5f7fb; }
      .ac-name { font-weight:600; } .ac-doc { color:#64748b; font-size:12px; } .ac-tel { margin-left:auto; font-size:12px; color:#0f172a; }
      .ac-empty { padding:10px; color:#9aa4b2; font-size:13px; }
    `,document.head.appendChild(B),U.appendChild(ie),document.body.appendChild(U);const W=ie.querySelector("#esNuevoPaciente"),re=ie.querySelector("#nuevoPacienteCampos"),ge=ie.querySelector("#buscarPaciente"),he=ie.querySelector("#acResultados");W.addEventListener("change",()=>{re.style.display=W.checked?"flex":"none",W.checked&&(he.style.display="none")}),ie.querySelector("#btnCancelarModal").addEventListener("click",()=>U.remove());let Oe=null,fe=null,le=-1,De=[];const Le=ce=>{if(De=ce||[],le=-1,!ce||ce.length===0){he.innerHTML='<div class="ac-empty">Sin resultados</div>',he.style.display="block";return}he.innerHTML=ce.map((xe,Ie)=>`
            <div class="ac-item" data-index="${Ie}" data-id="${xe.id}">
              <span class="ac-name">${xe.nombre}</span>
              <span class="ac-doc"> ${xe.documento||"s/doc"}</span>
              <span class="ac-tel">${xe.celular||xe.telefono||""}</span>
            </div>`).join(""),he.style.display="block",[...he.querySelectorAll(".ac-item")].forEach(xe=>{xe.addEventListener("click",()=>{const Ie=Number(xe.getAttribute("data-index"));nt(Ie)})})},nt=ce=>{const xe=De[ce];xe&&(fe=xe,ge.value=xe.nombre,he.style.display="none",W.checked=!1,re.style.display="none")},G=ce=>{De.length&&(le=(le+ce+De.length)%De.length,[...he.querySelectorAll(".ac-item")].forEach((xe,Ie)=>{Ie===le?xe.classList.add("active"):xe.classList.remove("active")}))},ae=(ce,xe)=>ce.nombreCompleto||ce.paciente||[ce.nombres,ce.apellidos].filter(Boolean).join(" ")||xe,z=async ce=>{const xe=(ce||"").toString().trim(),Ie=Fo(xe);if(!Ie||Ie.length<2)return[];if(/^\d{5,}$/.test(xe))try{const Ue=it(Ce(ue,"pacientes"),Je("documento","==",xe)),Re=it(Ce(ue,"pacientes"),Je("nroDocumento","==",xe)),[Me,ke]=await Promise.all([gt(Ue),gt(Re)]),Se=Me.empty?ke:Me;if(!Se.empty)return Se.docs.slice(0,10).map(M=>{const J=M.data()||{};return{id:M.id,nombre:ae(J,M.id),documento:J.documento||J.nroDocumento||M.id,celular:J.celularPaciente||J.celular||"",telefono:J.telefonoPaciente||J.telefono||""}})}catch{}try{const Ue=it(Ce(ue,"pacientes"),gn("nombre_busqueda"),Hx(Ie),Wx(Ie+""),wa(10)),Re=await gt(Ue);if(!Re.empty)return Re.docs.map(Me=>{const ke=Me.data()||{};return{id:Me.id,nombre:ae(ke,Me.id),documento:ke.documento||ke.nroDocumento||Me.id,celular:ke.celularPaciente||ke.celular||"",telefono:ke.telefonoPaciente||ke.telefono||""}})}catch{}try{const Ue=it(Ce(ue,"pacientes"),gn("creado","desc"),wa(50));return(await gt(Ue)).docs.map(Se=>({id:Se.id,...Se.data()||{}})).map(Se=>({id:Se.id,nombre:ae(Se,Se.id),documento:Se.documento||Se.nroDocumento||Se.id,celular:Se.celularPaciente||Se.celular||"",telefono:Se.telefonoPaciente||Se.telefono||"",_norm:Fo(`${Se.nombreCompleto||Se.paciente||""} ${Se.nombres||""} ${Se.apellidos||""} ${Se.documento||Se.nroDocumento||""}`)})).filter(Se=>Se._norm.includes(Ie)).slice(0,10).map(({_norm:Se,...M})=>M)}catch{}return[]};ge.addEventListener("input",()=>{fe=null;const ce=ge.value;if(clearTimeout(Oe),!ce||ce.trim().length<2){he.style.display="none";return}Oe=setTimeout(async()=>{const xe=await z(ce.trim());Le(xe)},220)}),ge.addEventListener("keydown",ce=>{he.style.display==="block"&&(ce.key==="ArrowDown"?(ce.preventDefault(),G(1)):ce.key==="ArrowUp"?(ce.preventDefault(),G(-1)):ce.key==="Enter"?le>=0&&(ce.preventDefault(),nt(le)):ce.key==="Escape"&&(he.style.display="none"))}),document.addEventListener("click",ce=>{ie.contains(ce.target)&&!he.contains(ce.target)&&ce.target!==ge&&(he.style.display="none")},{capture:!0});const oe=ie.querySelector("#formNuevaCita");oe.addEventListener("submit",async ce=>{ce.preventDefault();const xe=W.checked,Ie=(oe.querySelector("#buscarPaciente").value||"").trim(),Ue=oe.querySelector("#ncDoctor").value.trim(),Re=oe.querySelector("#ncFecha").value,Me=oe.querySelector("#ncHora").value,ke=oe.querySelector("#ncEspacio").value.trim(),Se=oe.querySelector("#ncComentario").value.trim();if(!Re||!Me){alert(" Debes seleccionar fecha y hora para la cita.");return}if(!Ue){alert(" Indica el doctor asignado.");return}try{let M=null,J=null,te="",Ne="",rt="";if(xe){const jn=(oe.querySelector("#npNombre").value||"").trim(),tn=(oe.querySelector("#npApellido").value||"").trim();if(te=`${jn} ${tn}`.trim(),!te){alert(" Debes indicar nombre y apellido para el nuevo paciente.");return}const Nt=(oe.querySelector("#npDocumento").value||"").trim(),Bt=(oe.querySelector("#npCelular").value||"").trim(),zt=(oe.querySelector("#npTelefono").value||"").trim();if(!Bt&&!zt){alert(" Debes registrar al menos un telfono (celular o fijo) del paciente o de un acudiente.");return}if(M=Nt||te.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"_"),J=ct(ue,"pacientes",M),!(await za(J)).exists()){const Pt=Fo(te);await $c(J,{nombres:jn,apellidos:tn,nombreCompleto:te,paciente:te,nombre_busqueda:Pt,variantes_busqueda:[Pt,Fo(jn),Fo(tn)],tipoDocumento:oe.querySelector("#npTipoDocumento").value,documento:Nt,correo:(oe.querySelector("#npCorreo").value||"").trim(),indicativo:oe.querySelector("#npIndicativo").value,celular:Bt,telefono:zt,celularPaciente:Bt,telefonoPaciente:zt,fechaNacimiento:oe.querySelector("#npNacimiento").value,sexo:oe.querySelector("#npSexo").value,notas:(oe.querySelector("#npComentario").value||"").trim(),creado:new Date().toISOString(),activo:!0,citas:[]},{merge:!0})}Ne=Bt,rt=zt}else if(fe)M=fe.id,te=fe.nombre,J=ct(ue,"pacientes",M),Ne=fe.celular||"",rt=fe.telefono||"";else{if(!Ie){alert(" Por favor, escribe o selecciona un paciente.");return}const jn=it(Ce(ue,"pacientes"),Je("documento","==",Ie)),tn=it(Ce(ue,"pacientes"),Je("nroDocumento","==",Ie)),[Nt,Bt]=await Promise.all([gt(jn),gt(tn)]),zt=Nt.empty?Bt:Nt;if(zt.empty){let Ye=null;try{const Pt=Fo(Ie),Pr=it(Ce(ue,"pacientes"),gn("nombre_busqueda"),Hx(Pt),Wx(Pt+""),wa(1)),dr=await gt(Pr);if(!dr.empty){const Ts=dr.docs[0],On=Ts.data()||{};Ye={id:Ts.id,ref:Ts.ref,nombre:On.nombreCompleto||On.paciente||[On.nombres,On.apellidos].filter(Boolean).join(" "),cel:On.celularPaciente||On.celular||"",tel:On.telefonoPaciente||On.telefono||""}}}catch{}Ye?(M=Ye.id,J=Ye.ref,te=Ye.nombre||Ie,Ne=Ye.cel||"",rt=Ye.tel||""):te=Ie}else{const Ye=zt.docs[0],Pt=Ye.data()||{};M=Ye.id,J=Ye.ref,te=Pt.nombreCompleto||Pt.paciente||[Pt.nombres,Pt.apellidos].filter(Boolean).join(" ")||Ie,Ne=Pt.celularPaciente||Pt.celular||"",rt=Pt.telefonoPaciente||Pt.telefono||""}}if(!(Ne||rt||"").trim()){alert(" Este paciente no tiene ningn telfono registrado. Edita sus datos y agrega un nmero antes de guardar la cita.");return}const Nr={paciente:te||"Paciente",pacienteId:M||null,doctor:Ue,fecha:Re,horaInicio:Me,espacio:ke,comentario:Se,estado:"En espera",creado:new Date().toISOString(),celularPaciente:Ne||"",telefonoPaciente:rt||""},In=await _r(Ce(ue,"citas"),Nr);J&&await $c(J,{citas:GM(In.id)},{merge:!0}),alert(" Cita registrada correctamente y vinculada al paciente."),U.remove()}catch(M){console.error(" Error al guardar cita:",M),alert(" Error al guardar la cita. Revisa la consola para ms detalles.")}})},Ke=U=>{var Oe,fe;const ie=document.createElement("div");Object.assign(ie.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const B=document.createElement("div");Object.assign(B.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"});const W=(Oe=U.raw)!=null&&Oe.fecha&&typeof U.raw.fecha=="string"?U.raw.fecha:Bp(U.fecha),re=((fe=U.raw)==null?void 0:fe.horaInicio)||U.fecha.toTimeString().slice(0,5);B.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Editar Cita</h2>
      <form id="formEditarCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label>Paciente</label>
        <input type="text" id="editPaciente" value="${U.paciente||""}" />

        <label>Doctor asignado</label>
        <input type="text" id="editDoctor" value="${U.doctor||""}" />

        <div style="display:flex;gap:8px;">
          <div style="flex:1;">
            <label>Fecha</label>
            <input type="date" id="editFecha" value="${W}" />
          </div>
          <div style="flex:1;">
            <label>Hora</label>
            <input type="time" id="editHora" value="${re}" />
          </div>
        </div>

        <label>Espacio fsico / Sala</label>
        <input type="text" id="editEspacio" value="${U.espacio||""}" />

        <label>Estado</label>
        <select id="editEstado" class="estado-select">
          <option value="En espera" ${U.estado==="En espera"?"selected":""}>En espera</option>
          <option value="En sala" ${U.estado==="En sala"?"selected":""}>En sala</option>
          <option value="Atendiendo" ${U.estado==="Atendiendo"?"selected":""}>Atendiendo</option>
          <option value="Finalizada" ${U.estado==="Finalizada"?"selected":""}>Finalizada</option>
          <option value="pendiente" ${U.estado==="pendiente"?"selected":""}>Pendiente</option>
          <option value="No asisti" ${U.estado==="No asisti"?"selected":""}>No asisti</option>
        </select>

        <label>Comentario</label>
        <textarea id="editComentario" rows="3">${U.comentario||""}</textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarEdit" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar cambios</button>
        </div>
      </form>
    `;const ge=document.createElement("style");ge.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      #formEditarCita input, #formEditarCita select, #formEditarCita textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      #formEditarCita input:focus, #formEditarCita select:focus, #formEditarCita textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
    `,document.head.appendChild(ge),ie.appendChild(B),document.body.appendChild(ie),B.querySelector("#btnCancelarEdit").addEventListener("click",()=>ie.remove());const he=B.querySelector("#formEditarCita");he.addEventListener("submit",async le=>{le.preventDefault();const De=he.querySelector("#editPaciente").value.trim(),Le=he.querySelector("#editDoctor").value.trim(),nt=he.querySelector("#editFecha").value,G=he.querySelector("#editHora").value,ae=he.querySelector("#editEspacio").value.trim(),z=he.querySelector("#editEstado").value,oe=he.querySelector("#editComentario").value.trim();if(!De)return alert(" El nombre del paciente es obligatorio.");if(!nt||!G)return alert(" Debes indicar fecha y hora.");try{const ce=ct(ue,"citas",U.id);await us(ce,{paciente:De,doctor:Le,fecha:nt,horaInicio:G,espacio:ae,estado:z,comentario:oe}),alert(" Cita actualizada correctamente."),ie.remove()}catch(ce){console.error(" Error al actualizar cita:",ce),alert(" Error al actualizar la cita. Revisa la consola para ms detalles.")}})},St=U=>{const ie=U.fecha.toLocaleDateString(Vn),B=U.fecha.toLocaleTimeString(Vn,{hour:"numeric",minute:"2-digit",hour12:!0}),W=`${ie}  ${B}`;return l.jsxs("tr",{className:"fade-in-row",onClick:()=>Ke(U),style:{cursor:"pointer"},children:[l.jsx("td",{children:W}),l.jsx("td",{children:U.paciente}),l.jsx("td",{children:U.doctor}),l.jsx("td",{children:U.espacio}),l.jsx("td",{children:U.comentario}),l.jsx("td",{onClick:re=>{re.stopPropagation()},children:l.jsxs("select",{className:"estado-select",value:U.estado,onChange:re=>ee(U.id,re.target.value),children:[l.jsx("option",{value:"En espera",children:"En espera"}),l.jsx("option",{value:"En sala",children:"En sala"}),l.jsx("option",{value:"Atendiendo",children:"Atendiendo"}),l.jsx("option",{value:"Finalizada",children:"Finalizada"}),l.jsx("option",{value:"pendiente",children:"Pendiente"}),l.jsx("option",{value:"No asisti",children:"No asisti"})]})}),l.jsxs("td",{className:"acciones-cell",onClick:re=>{re.stopPropagation()},children:[U.telefono?l.jsx("button",{type:"button",className:"btn-whatsapp",onClick:re=>{re.stopPropagation(),me(U.telefono,U)},children:"WhatsApp"}):l.jsx("span",{className:"acciones-texto",children:"Sin celular"}),l.jsx("button",{type:"button",className:"btn-delete",onClick:re=>{re.stopPropagation(),_e(U)},children:"Eliminar"}),U.recordatorio&&l.jsx("span",{className:"acciones-texto",children:U.recordatorio})]})]},U.id)};return l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"odc-topbar-green"}),l.jsx("div",{className:"odc-topbar-blue",children:"Agenda"}),l.jsx("section",{className:"odc-agenda-root",children:l.jsxs("div",{className:"odc-agenda-inner",children:[l.jsxs("aside",{className:"odc-left","aria-label":"Panel izquierdo - calendario y filtros",children:[l.jsxs("div",{className:"odc-mini-calendar-card",role:"region","aria-label":"Mini calendario",children:[l.jsxs("div",{className:"mini-cal-header",children:[l.jsx("button",{className:"cal-arrow",id:"miniCalPrev","aria-label":"Mes anterior",onClick:F,children:""}),l.jsx("div",{id:"miniCalMonthYear","aria-live":"polite",children:v}),l.jsx("button",{className:"cal-arrow",id:"miniCalNext","aria-label":"Mes siguiente",onClick:x,children:""})]}),l.jsxs("table",{className:"mini-month-table","aria-hidden":"false",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:"Lu"}),l.jsx("th",{children:"Ma"}),l.jsx("th",{children:"Mi"}),l.jsx("th",{children:"Ju"}),l.jsx("th",{children:"Vi"}),l.jsx("th",{children:"Sa"}),l.jsx("th",{children:"Do"})]})}),l.jsx("tbody",{id:"miniCalendar",children:O.map((U,ie)=>l.jsx("tr",{children:U.map((B,W)=>l.jsx("td",{className:[B.isCurrentMonth?"":"empty",B.isToday?"today":"",B.isSelected?"selected":""].filter(Boolean).join(" "),onClick:()=>B.isCurrentMonth&&w(B.date),children:B.date.getDate()},W))},ie))})]})]}),l.jsxs("div",{className:"odc-filters-card","aria-label":"Filtros de agenda",children:[l.jsx("label",{htmlFor:"filterSucursal",children:"Sucursal"}),l.jsxs("select",{id:"filterSucursal",value:f,onChange:U=>m(U.target.value),children:[l.jsx("option",{value:"",children:" Todas "}),b.map(U=>l.jsx("option",{value:U,children:U},U))]}),l.jsx("label",{htmlFor:"filterDoctor",children:"Doctores"}),l.jsxs("select",{id:"filterDoctor",value:_,onChange:U=>R(U.target.value),children:[l.jsx("option",{value:"",children:" Todos "}),y.map(U=>l.jsx("option",{value:U,children:U},U))]})]})]}),l.jsxs("main",{className:"odc-right","aria-label":"Panel principal - agenda",children:[l.jsxs("div",{className:"odc-header-bar",role:"region","aria-label":"Controles de la agenda",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[l.jsxs("div",{className:"odc-header-left",style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[l.jsx("h3",{className:"odc-title",style:{marginRight:8},children:"Agenda"}),l.jsxs("div",{className:"view-buttons",role:"tablist","aria-label":"Vistas",style:{display:"flex",gap:6},children:[l.jsx("button",{className:`btn view ${e==="day"?"active":""}`,"data-view":"day",role:"tab","aria-selected":e==="day",onClick:()=>n("day"),children:"Da"}),l.jsx("button",{className:`btn view ${e==="week"?"active":""}`,"data-view":"week",role:"tab","aria-selected":e==="week",onClick:()=>n("week"),children:"Semana"}),l.jsx("button",{className:`btn view ${e==="detail"?"active":""}`,"data-view":"detail",role:"tab","aria-selected":e==="detail",onClick:()=>n("detail"),children:"Detalle"})]}),l.jsxs("div",{className:"date-nav",style:{display:"flex",alignItems:"center",gap:6,flex:"0 0 auto"},children:[l.jsx("button",{className:"btn icon",id:"btnPrev","aria-label":"Anterior",onClick:D,children:""}),l.jsx("button",{className:"btn icon",id:"btnNext","aria-label":"Siguiente",onClick:j,children:""}),l.jsx("span",{id:"currentDateDisplay",className:"current-date","aria-live":"polite",style:{whiteSpace:"nowrap"},children:P}),l.jsx("button",{id:"btnHoy",className:"btn small",onClick:k,children:"Hoy"})]})]}),l.jsx("div",{className:"odc-header-right",style:{display:"flex",alignItems:"center",gap:8,flexShrink:0},children:l.jsxs("div",{className:"right-actions",style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{id:"searchCitas",placeholder:"Buscar...",className:"search-input","aria-label":"Buscar citas",value:A,onChange:U=>N(U.target.value)}),l.jsx("button",{id:"btnNuevaCita",className:"btn green","aria-label":"Nueva cita",onClick:Pe,children:"+ Nueva cita"})]})})]}),l.jsxs("div",{className:"odc-content-card",role:"region","aria-label":"Contenido agenda",children:[l.jsxs("div",{className:"tools-row",children:[l.jsx("div",{className:"tools-left",children:l.jsx("div",{id:"ocupacionInfo",className:"ocupacion-info",children:I})}),l.jsxs("div",{className:"tools-right",children:[l.jsx("button",{id:"btnPrint",className:"btn",title:"Imprimir agenda",onClick:K,children:" Imprimir"}),l.jsx("button",{id:"btnConfirmar",className:"btn blue",title:"Confirmar citas",onClick:We,children:" Confirmar"}),l.jsx("button",{id:"btnHoyCitas",className:"btn",title:"Ver citas de hoy",onClick:At,children:" Hoy"}),l.jsx("button",{id:"btnExportar",className:"btn",title:"Exportar citas a CSV",onClick:Qt,children:" Exportar"})]})]}),l.jsx("div",{className:"table-wrap",role:"region","aria-label":"Lista de citas",children:l.jsxs("table",{className:"appointments-table","aria-live":"polite",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{style:{width:"180px"},children:"Fecha / Hora"}),l.jsx("th",{children:"Paciente"}),l.jsx("th",{children:"Doctor"}),l.jsx("th",{children:"Espacio fsico"}),l.jsx("th",{children:"Comentario"}),l.jsx("th",{style:{width:"120px"},children:"Estado"}),l.jsx("th",{children:"Acciones"})]})}),l.jsx("tbody",{id:"citasTbody",children:a?l.jsx("tr",{children:l.jsx("td",{colSpan:7,className:"no-data",children:"Cargando citas..."})}):E.length===0?l.jsx("tr",{children:l.jsx("td",{colSpan:7,className:"no-data",children:"No hay citas registradas para este rango."})}):E.map(St)})]})})]})]})]})})]})}function FU(){return l.jsxs("div",{style:{padding:"20px"},children:[l.jsx("h2",{children:"Mdulo de Facturacin"}),l.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function UU(){return l.jsxs("div",{style:{padding:"20px"},children:[l.jsx("h2",{children:"Mdulo de Facturacin"}),l.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function $U(){return l.jsxs("div",{style:{padding:"20px"},children:[l.jsx("h2",{children:"Mdulo de Facturacin"}),l.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}const Xu={caja:"caja",pagos:"facturacion/pagos",facturas:"facturacion/facturas"};var AI;const Bl=typeof navigator<"u"&&((AI=navigator.language)!=null&&AI.startsWith("es"))?"es-ES":"en-US",BU=["Colombia","Argentina","Bolivia","Chile","Costa Rica","Cuba","Ecuador","El Salvador","Espaa","Guatemala","Honduras","Mxico","Nicaragua","Panam","Paraguay","Per","Puerto Rico","Repblica Dominicana","Uruguay","Venezuela","Estados Unidos","Canad"],zp={Colombia:["Bogot","Medelln","Cali","Barranquilla","Cartagena","Ccuta","Bucaramanga","Pereira","Santa Marta","Ibagu"],Mxico:["Ciudad de Mxico","Guadalajara","Monterrey","Puebla","Quertaro","Tijuana","Mrida","Len"],Per:["Lima","Arequipa","Trujillo","Chiclayo","Cusco","Piura"],Chile:["Santiago","Valparaso","Concepcin","La Serena","Antofagasta"],Argentina:["Buenos Aires","Crdoba","Rosario","Mendoza","La Plata"],Espaa:["Madrid","Barcelona","Valencia","Sevilla","Zaragoza","Bilbao"],"Estados Unidos":["Miami","New York","Los ngeles","Houston","Chicago"],Ecuador:["Quito","Guayaquil","Cuenca","Manta"],Venezuela:["Caracas","Maracaibo","Valencia","Barquisimeto","Maracay"]},zU=t=>{if(!t)return"";const[e,n,r]=t.split("-").map(c=>parseInt(c,10)),s=new Date(e,(n||1)-1,r||1),i=new Date;let o=i.getFullYear()-s.getFullYear();const a=i.getMonth()-s.getMonth();return(a<0||a===0&&i.getDate()<s.getDate())&&o--,isNaN(o)?"":String(o)};async function wI(t,{maxW:e=900,maxH:n=900,quality:r=.82}={}){var m;if(!t||!((m=t.type)!=null&&m.startsWith("image/")))return t;const s=await new Promise((_,R)=>{const A=new Image;A.onload=()=>_(A),A.onerror=R,A.src=URL.createObjectURL(t)});let{width:i,height:o}=s;const a=Math.min(e/i,n/o,1);i=Math.round(i*a),o=Math.round(o*a);const c=document.createElement("canvas");c.width=i,c.height=o,c.getContext("2d").drawImage(s,0,0,i,o);const h=await new Promise(_=>c.toBlob(_,"image/jpeg",r)),f=new File([h],(t.name||"foto.jpg").replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return URL.revokeObjectURL(s.src),f}const zl=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),qU=t=>zl([t.nombres,t.apellidos,t.nombreCompleto,t.nroDocumento,t.celular,t.email].filter(Boolean).join(" ")),HU=t=>{if(!t)return"";const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}-${r}-${s}T${i}:${o}`},WU=t=>{try{return new Date(t).toLocaleString(Bl,{dateStyle:"medium",timeStyle:"short"})}catch{return""}},Uo={tipoDocumento:"",nroDocumento:"",nroHistoria:"",nombres:"",apellidos:"",nombreCompleto:"",sexo:"",estadoCivil:"",paisNacimiento:"",ciudadNacimiento:"",fechaIngreso:"",fechaNacimiento:"",edad:"",paisDomicilio:"",ciudadDomicilio:"",barrio:"",lugarResidencia:"",estrato:"",zonaResidencial:"",esExtranjero:!1,permitePublicidad:!1,celular:"",telDomicilio:"",telOficina:"",extension:"",email:"",ocupacion:"",nombreResponsable:"",parentesco:"",celularResponsable:"",telefonoResponsable:"",emailResponsable:"",nombreAcompanante:"",telefonoAcompanante:"",convenioBeneficio:"",comoConocio:"",campania:"",remitidoPor:"",asesorComercial:"",tipoVinculacion:"",nombreEps:"",polizaSalud:"",doctor:"",notas:"",rxImagenes:[],historiaClinica:{antecedentes:"",alergias:"",medicamentos:"",motivoConsulta:"",notas:""},odontograma:[],periodontograma:[],presupuestos:[],evoluciones:[],facturacion:{saldoFavor:0,saldoCredito:0},fotoUrl:"",activo:!0},qp=20,$o=t=>Number(t||0);function GU(t){const[e,n]=C.useState(!1),[r,s]=C.useState([]),[i,o]=C.useState([]),[a,c]=C.useState("");C.useEffect(()=>{let N=!0;return(async()=>{if(!t){s([]),o([]);return}n(!0),c("");try{let y=it(Ce(ue,"facturas"),Je("patientId","==",t),gn("fechaISO","desc"));const O=(await gt(y)).docs.map(P=>({id:P.id,...P.data()})).map(P=>({...P,total:$o(P.total??P.valor??P.montoTotal),estado:(P.estado||"pendiente").toLowerCase(),fechaISO:P.fechaISO||P.fecha||null}));let F=it(Ce(ue,"pagos"),Je("patientId","==",t),gn("fechaISO","desc"));const v=(await gt(F)).docs.map(P=>({id:P.id,...P.data()})).map(P=>({...P,monto:$o(P.monto??P.valor??P.total),fechaISO:P.fechaISO||P.fecha||null,medio:P.medio||P.metodo||""}));if(!N)return;s(O),o(v)}catch(y){console.warn("Finanzas: no se pudo leer colecciones. Contino solo con saldos del paciente.",y),N&&c("No se pudieron leer facturas/pagos.")}finally{N&&n(!1)}})(),()=>{N=!1}},[t]);const d=r.reduce((N,b)=>N+$o(b.total),0),h=i.reduce((N,b)=>N+$o(b.monto),0),f=r.filter(N=>["pagada","pagado","paid"].includes((N.estado||"").toLowerCase())),m=r.filter(N=>["pendiente","abierta","open","deuda"].includes((N.estado||"").toLowerCase())),_=f.reduce((N,b)=>N+$o(b.total),0),R=m.reduce((N,b)=>N+$o(b.total),0);return{loading:e,error:a,facturas:r,pagos:i,totalFacturado:d,totalPagado:h,totalFacturasPendientes:R,totalFacturasPagadas:_}}function KU(t){const[e,n]=C.useState(!1),[r,s]=C.useState([]);return C.useEffect(()=>{if(!t){s([]);return}n(!0);const i=Ce(ue,"citas"),o=_=>{const R=_.data()||{},A=typeof R.fecha=="string"?R.fecha:"",N=(R.horaInicio||R.hora||"00:00").slice(0,5);let b=null;if(A){const[y,E,I]=A.split("-").map(w=>parseInt(w,10)),[O,F]=N.split(":").map(w=>parseInt(w,10)||0);b=new Date(y,(E||1)-1,I||1,O,F,0,0).toISOString()}return{id:_.id,...R,fechaISO:b,motivo:R.motivo||R.comentario||"",profesional:R.doctor||R.doctorNombre||"",fechaYYYYMMDD:A}};let a=new Map;const c=()=>{const _=Array.from(a.values());_.sort((R,A)=>{const N=R.fechaISO||"",b=A.fechaISO||"";if(N<b)return 1;if(N>b)return-1;const y=R.creado||"",E=A.creado||"";return y<E?1:y>E?-1:0}),s(_),n(!1)},d=it(i,Je("pacienteId","==",t)),h=it(i,Je("patientId","==",t)),f=Un(d,_=>{_.docChanges().forEach(R=>{R.type==="removed"?a.delete(R.doc.id):a.set(R.doc.id,o(R.doc))}),c()},()=>n(!1)),m=Un(h,_=>{_.docChanges().forEach(R=>{R.type==="removed"?a.delete(R.doc.id):a.set(R.doc.id,o(R.doc))}),c()},()=>n(!1));return()=>{try{f()}catch{}try{m()}catch{}}},[t]),{loading:e,citas:r}}function QU(){var Pr,dr,Ts,On,Xr,hu,fu,Ci,rl;const t=xs(),e=Dn(),n=FI.useMemo(()=>{const T=e.pathname.split("/").filter(Boolean),H=T.findIndex(Ee=>["pacientes","agenda","caja","facturacion","config","reportes","software"].includes(Ee)),ye="/"+T.slice(0,H>=0?H:T.length).join("/");return ye==="/"?"":ye},[e.pathname]),r=T=>{const H=String(T||"").replace(/^\//,""),Z=n?`${n}/`:"/";t(`${Z}${H}`)},s=(T,H)=>{const Z=String(T).replace(/^\//,""),ye=H?new URLSearchParams(H).toString():"";return`${n?`${n}/`:"/"}${Z}${ye?`?${ye}`:""}`},i=(T,H)=>{const Z=String(T||"").slice(0,10);if(!Z)return r("agenda");try{sessionStorage.setItem("agenda.targetDate",Z)}catch{}const ye=new URLSearchParams({date:Z,day:Z,d:Z,fecha:Z,selectedDate:Z,ts:String(new Date(Z+"T00:00:00").getTime()),patientId:H||""}).toString();r(`agenda?${ye}`)},[o,a]=C.useState(!0),[c,d]=C.useState([]),[h,f]=C.useState(""),[m,_]=C.useState(null),[R,A]=C.useState(!0),[N,b]=C.useState(!1),[y,E]=C.useState(null),[I,O]=C.useState(null),F=C.useRef(null),[x,w]=C.useState("datos"),[v,P]=C.useState(Uo),[D,j]=C.useState(null),[k,K]=C.useState(""),[We,At]=C.useState([]),[Qt,ee]=C.useState(!1),me=C.useRef(null),_e="comfy",[Pe,Ke]=C.useState(""),St=C.useMemo(()=>{switch(_e){case"comfy":return{thumbW:220,thumbH:165,colMin:240};case"cozy":return{thumbW:160,thumbH:120,colMin:180};default:return{thumbW:120,thumbH:90,colMin:140}}},[_e]),U=T=>{var Z,ye;if((ye=(Z=T==null?void 0:T.type)==null?void 0:Z.startsWith)!=null&&ye.call(Z,"image/"))return!0;const H=((T==null?void 0:T.name)||(T==null?void 0:T.title)||"").toLowerCase();return/\.(png|jpe?g|gif|bmp|webp|tiff?)$/.test(H)},ie=C.useMemo(()=>{const T=Pe.trim().toLowerCase(),H=Array.isArray(I==null?void 0:I.rxImagenes)?I.rxImagenes:[];let Z=H;return T?Z=H.filter(ye=>`${ye.name||""} ${ye.title||""} ${ye.desc||""}`.toLowerCase().includes(T)):Z=H.slice(),Z.sort((ye,Ee)=>{const Qe=ye.uploadedAtMS??ye.created??0;return(Ee.uploadedAtMS??Ee.created??0)-Qe}),Z},[I==null?void 0:I.rxImagenes,Pe]),B=async(T,H)=>{if(!(I!=null&&I.id))return;const Z=Array.isArray(I.rxImagenes)?[...I.rxImagenes]:[];Z[T]={...Z[T]||{},...H},await te({rxImagenes:Z})},W=()=>{const T=new Date,H=T.getFullYear(),Z=String(T.getMonth()+1).padStart(2,"0"),ye=String(T.getDate()).padStart(2,"0");return`${H}-${Z}-${ye}`},[re,ge]=C.useState(W()),[he,Oe]=C.useState(""),[fe,le]=C.useState(""),[De,Le]=C.useState(""),[nt,G]=C.useState("");C.useEffect(()=>{le((I==null?void 0:I.doctor)||"")},[I==null?void 0:I.doctor,I==null?void 0:I.id]);const ae=async()=>{if(!(I!=null&&I.id))return alert("Paciente no cargado.");if(!re)return alert("Selecciona la fecha.");if(!he)return alert("Selecciona la hora.");if(!fe.trim())return alert("Indica el doctor.");const T=I.nombreCompleto||I.paciente||"Paciente",H=I.celular||I.celularPaciente||"",Z=I.telDomicilio||I.telefonoPaciente||"";if(!H&&!Z)return alert("Este paciente no tiene telfono registrado (celular o fijo). Agrega uno antes de crear la cita.");try{const ye={paciente:T,pacienteId:I.id,doctor:fe.trim(),fecha:re,horaInicio:he,espacio:De||"",comentario:nt||"",estado:"En espera",creado:new Date().toISOString(),celularPaciente:H,telefonoPaciente:Z};await _r(Ce(ue,"citas"),ye),Oe(""),Le(""),G(""),alert(" Cita creada. Ya aparece en la lista y en Agenda.")}catch(ye){console.error("Error creando cita:",ye),alert("No se pudo crear la cita.")}};C.useMemo(()=>zp[v.paisNacimiento]||[],[v.paisNacimiento]),C.useEffect(()=>((async()=>{a(!0);try{const Z=(await gt(Ce(ue,"eps"))).docs.map(Ee=>{var Qe;return(Qe=Ee.data())==null?void 0:Qe.nombre}).filter(Boolean),ye=Array.from(new Map(Z.map(Ee=>[String(Ee).toLowerCase(),Ee])).values()).sort((Ee,Qe)=>Ee.localeCompare(Qe,"es"));At(ye),await xe(!0)}catch(H){console.error(H),alert("No se pudieron cargar pacientes/EPS.")}finally{a(!1)}})(),()=>{F.current&&(F.current(),F.current=null)}),[]),C.useEffect(()=>{P(T=>({...T,nombreCompleto:`${T.nombres} ${T.apellidos}`.trim()}))},[v.nombres,v.apellidos]),C.useEffect(()=>{P(T=>({...T,nroHistoria:T.nroDocumento}))},[v.nroDocumento]),C.useEffect(()=>{P(T=>({...T,edad:zU(T.fechaNacimiento)}))},[v.fechaNacimiento]),C.useEffect(()=>{const T=new Date,H=T.toLocaleDateString(Bl)+" - "+T.toLocaleTimeString(Bl,{hour:"2-digit",minute:"2-digit",hour12:!0});P(Z=>({...Z,fechaIngreso:H}))},[]);const z=(T,H)=>P(Z=>({...Z,[T]:H})),oe=()=>{P(Uo);const T=new Date,H=T.toLocaleDateString(Bl)+" - "+T.toLocaleTimeString(Bl,{hour:"2-digit",minute:"2-digit",hour12:!0});P(Z=>({...Z,fechaIngreso:H})),j(null),K(""),E(null)},ce=async T=>{if(!T){j(null),K("");return}try{const H=await wI(T,{maxW:900,maxH:900,quality:.82});j(H);const Z=new FileReader;Z.onload=ye=>K(ye.target.result),Z.readAsDataURL(H)}catch{j(T);const H=new FileReader;H.onload=Z=>K(Z.target.result),H.readAsDataURL(T)}},xe=async(T=!1)=>{a(!0);try{let H;T||!m?H=it(Ce(ue,"pacientes"),gn("creado","desc"),wa(qp)):H=it(Ce(ue,"pacientes"),gn("creado","desc"),$M(m),wa(qp));const Z=await gt(H),ye=Z.docs.map(Ee=>({id:Ee.id,...Ee.data()}));d(T?ye:Ee=>[...Ee,...ye]),_(Z.docs[Z.docs.length-1]||null),A(Z.size===qp)}catch(H){console.error(H),alert("No se pudo cargar pacientes.")}finally{a(!1)}},Ie=async T=>{if(T.preventDefault(),!v.nroDocumento.trim())return alert("El nmero de documento es obligatorio.");if(!v.nombres.trim())return alert("Los nombres son obligatorios.");if(!v.apellidos.trim())return alert("Los apellidos son obligatorios.");if(!v.sexo.trim())return alert("El sexo es obligatorio.");if(!v.fechaNacimiento.trim())return alert("La fecha de nacimiento es obligatoria.");if(!v.celular.trim())return alert("El celular es obligatorio.");if(!v.email.trim())return alert("El correo electrnico es obligatorio.");if(!v.tipoVinculacion.trim())return alert("El tipo de vinculacin es obligatorio.");if(!v.nombreEps.trim())return alert("El nombre de la EPS es obligatorio.");try{const H=v.nroDocumento.trim();if(!y&&(await za(ct(ue,"pacientes",H))).exists())return alert("Ya existe un paciente con ese nmero de documento.");const Z=(v.nombreEps||"").trim(),ye=We.map(kt=>kt.toLowerCase()).includes(Z.toLowerCase());if(Z&&!ye&&window.confirm(`La EPS "${Z}" no existe. Deseas guardarla para futuras selecciones?`)){const bn=Z.toLowerCase().replace(/\s+/g,"_");await $c(ct(ue,"eps",bn),{nombre:Z,nombreLower:Z.toLowerCase(),creado:Xn()},{merge:!0})}let Ee=v.fotoUrl||"",Qe="";if(D)try{const kt=Bi(),bn=(D.name||"foto.jpg").replace(/\s+/g,"_");Qe=`pacientes/${H}/${Date.now()}_${bn}`;const Tn=Al(kt,Qe),hr={contentType:D.type||"image/jpeg",cacheControl:"public, max-age=86400"};await nI(Tn,D,hr),Ee=await sI(Tn)}catch(kt){console.error("Foto (warning):",kt)}const kr=v.creado||null,Qn=y&&kr||Xn(),Yn={...v,fotoUrl:Ee,nombre_busqueda:qU({...v,fotoUrl:Ee}),nombresLower:zl(v.nombres),apellidosLower:zl(v.apellidos),documentoLower:zl(v.nroDocumento),emailLower:zl(v.email),creado:Qn,createdAt:Qn,actualizado:Xn(),updatedAt:Xn(),activo:v.activo??!0,celularPaciente:v.celular,telefonoPaciente:v.telDomicilio||"",documento:v.nroDocumento,paciente:v.nombreCompleto};if(await $c(ct(ue,"pacientes",H),Yn,{merge:!0}),Qe)try{const kt=Bi(),bn=Al(kt,`pacientes/${H}`),Tn=await rI(bn),hr=Qe,Jr=Tn.items.filter(Zr=>Zr.fullPath!==hr).map(Zr=>Lp(Zr).catch(()=>null));await Promise.allSettled(Jr)}catch(kt){console.warn("No se pudo limpiar fotos antiguas:",kt)}alert(y?" Paciente actualizado.":" Paciente guardado."),d(kt=>{const bn=kt.filter(Tn=>Tn.id!==H);return[{id:H,...Yn},...bn]}),b(!1),E(null),oe()}catch(H){console.error("Error guardando paciente:",H),alert(`No se pudo guardar el paciente.

`+((H==null?void 0:H.message)||H))}},Ue=()=>{oe(),b(!0)},Re=()=>{I&&(P({...Uo,...I,fotoUrl:I.fotoUrl||""}),j(null),K(I.fotoUrl||""),E(I.id),M(),b(!0))},Me=async T=>{if(window.confirm(`Eliminar al paciente "${T.nombreCompleto}"?`))try{await Rf(ct(ue,"pacientes",T.id)),d(H=>H.filter(Z=>Z.id!==T.id));try{const H=Bi(),Z=Al(H,`pacientes/${T.id}`),Ee=(await rI(Z)).items.map(Qe=>Lp(Qe).catch(()=>null));await Promise.allSettled(Ee)}catch(H){console.warn("No se pudo borrar la carpeta de fotos:",H)}}catch(H){console.error(H),alert("No se pudo eliminar.")}},ke=C.useMemo(()=>{const T=h.trim().toLowerCase();return T?c.filter(H=>`${H.nombreCompleto||H.paciente||""} ${H.nroDocumento||""} ${H.celular||H.celularPaciente||""} ${H.email||""}`.toLowerCase().includes(T)):c},[c,h]),Se=T=>{M();const H=ct(ue,"pacientes",T.id),Z=Un(H,ye=>{ye.exists()?O({id:ye.id,...J(ye.data())}):O(null)});F.current=Z,w("datos")},M=()=>{F.current&&(F.current(),F.current=null),O(null)},J=T=>({...Uo,...T,historiaClinica:{...Uo.historiaClinica,...T.historiaClinica||{}},facturacion:{...Uo.facturacion,...T.facturacion||{}},rxImagenes:Array.isArray(T.rxImagenes)?T.rxImagenes:[],odontograma:Array.isArray(T.odontograma)?T.odontograma:[],periodontograma:Array.isArray(T.periodontograma)?T.periodontograma:[],presupuestos:Array.isArray(T.presupuestos)?T.presupuestos:[],evoluciones:Array.isArray(T.evoluciones)?T.evoluciones:[]}),te=async T=>{if(I!=null&&I.id)try{await us(ct(ue,"pacientes",I.id),{...T,actualizado:Xn(),updatedAt:Xn()})}catch(H){console.error(H),alert("No se pudo actualizar.")}},Ne=async T=>{var Z;if(!(I!=null&&I.id)||!(T!=null&&T.length))return;const H=Bi();try{ee(!0);const ye=[];for(const Ee of T){let Qe=Ee;if((Z=Ee.type)!=null&&Z.startsWith("image/"))try{Qe=await wI(Ee,{maxW:1600,maxH:1600,quality:.85})}catch{Qe=Ee}const kr=(Qe.name||"archivo").replace(/\s+/g,"_"),Qn=`pacientes/${I.id}/rx/${Date.now()}_${kr}`,Yn=Al(H,Qn),kt={contentType:Qe.type||"application/octet-stream",cacheControl:"public, max-age=31536000"};await nI(Yn,Qe,kt);const bn=await sI(Yn),Tn=new Date().toISOString(),hr=Date.now();ye.push({url:bn,name:Ee.name,title:Ee.name.replace(/\.[^.]+$/,""),desc:"",type:Ee.type,size:Ee.size||0,created:hr,uploadedAtMS:hr,uploadedAtISO:Tn,path:Qn})}await te({rxImagenes:[...I.rxImagenes||[],...ye]})}catch(ye){console.error("RX upload error:",ye);const Ee=`No se pudo subir el/los archivo(s).
 Verifica que el usuario est autenticado.
 Revisa reglas de Storage para permitir escribir en 'pacientes/{id}/**'.
 Si usas Emulador, confirma que el bucket coincida.

`+((ye==null?void 0:ye.message)||"");alert(Ee)}finally{ee(!1);try{me.current&&(me.current.value="")}catch{}}},rt=async T=>{if(!(I!=null&&I.id))return;const H=I.rxImagenes[T],Z=I.rxImagenes.filter((ye,Ee)=>Ee!==T);await te({rxImagenes:Z});try{if(H!=null&&H.path){const ye=Bi();await Lp(Al(ye,H.path))}}catch(ye){console.warn("No se pudo borrar del Storage:",ye)}},Rt=(T,H)=>{const Z={...I.historiaClinica||{},[T]:H};te({historiaClinica:Z})},Nr=T=>{const H=[...I.presupuestos||[],{id:String(Date.now()),...T}];te({presupuestos:H})},In=T=>{te({presupuestos:(I.presupuestos||[]).filter(H=>H.id!==T)})},jn=T=>{const H=[...I.evoluciones||[],{id:String(Date.now()),fechaISO:new Date().toISOString(),nota:T}];te({evoluciones:H})},tn=T=>{te({evoluciones:(I.evoluciones||[]).filter(H=>H.id!==T)})},Nt=(T,H)=>{const Z=Array.isArray(I[T])?I[T]:[],ye=Z.find(Qe=>Qe.pieza===H);let Ee;ye?Ee=Z.filter(Qe=>Qe.pieza!==H):Ee=[...Z,{pieza:H,estado:"marcada"}],te({[T]:Ee})},Bt=(I==null?void 0:I.id)||null,zt=GU(Bt),{loading:Ye,citas:Pt}=KU(Bt);return l.jsxs("div",{className:"odc-container",children:[l.jsx("div",{className:"odc-topbar-green"}),l.jsx("div",{className:"odc-topbar-blue",children:l.jsx("div",{className:"odc-top-inner",children:l.jsx("div",{className:"odc-breadcrumbs",children:"Pacientes"})})}),l.jsxs("div",{className:"odc-card",children:[l.jsxs("div",{className:"odc-card-header",children:[l.jsx("h3",{className:"odc-title",children:"Pacientes"}),l.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[l.jsx("input",{className:"search-input",style:{minWidth:280},placeholder:"Buscar por nombre, documento o telfono",value:h,onChange:T=>f(T.target.value)}),l.jsx("button",{type:"button",className:"btn green",onClick:Ue,children:"+ Nuevo paciente"})]})]}),l.jsx("div",{className:"table-wrap",children:l.jsxs("table",{className:"appointments-table",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:"Foto"}),l.jsx("th",{children:"Nombre"}),l.jsx("th",{children:"Documento"}),l.jsx("th",{children:"Celular"}),l.jsx("th",{children:"Correo"}),l.jsx("th",{children:"Estado"})]})}),l.jsx("tbody",{children:o&&c.length===0?l.jsx("tr",{children:l.jsx("td",{className:"no-data",colSpan:6,children:"Cargando"})}):ke.length===0?l.jsx("tr",{children:l.jsx("td",{className:"no-data",colSpan:6,children:"No hay pacientes o no coinciden con la bsqueda."})}):ke.map(T=>l.jsxs("tr",{className:"row-click",onClick:()=>Se(T),children:[l.jsx("td",{onClick:H=>H.stopPropagation(),children:T.fotoUrl?l.jsx("img",{src:T.fotoUrl,alt:"Foto",style:{width:36,height:36,borderRadius:"50%",objectFit:"cover"}}):l.jsx("div",{className:"avatar-fallback",children:(T.nombreCompleto||"P")[0]})}),l.jsx("td",{children:T.nombreCompleto||T.paciente||""}),l.jsx("td",{children:T.nroDocumento||T.documento||""}),l.jsx("td",{children:T.celular||T.celularPaciente||""}),l.jsx("td",{children:T.email||""}),l.jsx("td",{children:l.jsx("span",{className:"pill pill-ok",children:T.activo?"Activo":"Inactivo"})})]},T.id))})]})}),l.jsxs("div",{className:"footer-actions",children:[l.jsx("button",{type:"button",className:"btn",disabled:o||!R,onClick:()=>xe(!1),children:R?"Cargar ms":"No hay ms"}),l.jsxs("div",{className:"hint",children:[c.length," registros cargados"]})]})]}),N&&l.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[l.jsx("div",{className:"odc-modal-backdrop",onClick:()=>b(!1)}),l.jsxs("div",{className:"odc-card",style:{width:1e3,maxWidth:"95%",maxHeight:"92vh",overflowY:"auto"},children:[l.jsxs("div",{className:"odc-card-header",children:[l.jsx("h3",{className:"odc-title",children:y?"Editar paciente":"Nuevo paciente"}),l.jsx("button",{type:"button",className:"btn",onClick:()=>b(!1),children:""})]}),l.jsxs("form",{onSubmit:Ie,children:[l.jsx("div",{className:"form-section-title",children:"Foto del paciente"}),l.jsxs("div",{className:"foto-row",children:[l.jsxs("label",{className:"foto-drop",children:[l.jsx("input",{type:"file",accept:"image/*",onChange:T=>{var H;return ce(((H=T.target.files)==null?void 0:H[0])||null)},style:{display:"none"}}),k?l.jsx("img",{src:k,alt:"Preview",className:"foto-preview"}):l.jsx("div",{className:"foto-empty",children:"Arrastra o haz clic para cargar"})]}),k&&l.jsx("button",{type:"button",className:"btn",onClick:()=>ce(null),children:"Quitar foto"})]}),l.jsx("div",{className:"form-section-title",children:"Datos de identificacin"}),l.jsxs("div",{className:"form-grid",children:[l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Tipo de documento *"}),l.jsxs("select",{className:"form-input",value:v.tipoDocumento,onChange:T=>z("tipoDocumento",T.target.value),children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{value:"CC",children:"Cdula"}),l.jsx("option",{value:"TI",children:"Tarjeta de identidad"}),l.jsx("option",{value:"PA",children:"Pasaporte"}),l.jsx("option",{value:"OTRO",children:"Otro"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Nro. de documento *"}),l.jsx("input",{className:"form-input",value:v.nroDocumento,onChange:T=>z("nroDocumento",T.target.value),placeholder:"Nmero de documento",required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Nmero de Historia"}),l.jsx("input",{className:"form-input",value:v.nroHistoria,readOnly:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Nombres *"}),l.jsx("input",{className:"form-input",value:v.nombres,onChange:T=>z("nombres",T.target.value),required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Apellidos *"}),l.jsx("input",{className:"form-input",value:v.apellidos,onChange:T=>z("apellidos",T.target.value),required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Nombre completo"}),l.jsx("input",{className:"form-input",value:v.nombreCompleto,readOnly:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Sexo *"}),l.jsxs("select",{className:"form-input",value:v.sexo,onChange:T=>z("sexo",T.target.value),required:!0,children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"Masculino"}),l.jsx("option",{children:"Femenino"}),l.jsx("option",{children:"Otro"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Estado civil *"}),l.jsxs("select",{className:"form-input",value:v.estadoCivil,onChange:T=>z("estadoCivil",T.target.value),required:!0,children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"Soltero"}),l.jsx("option",{children:"Casado"}),l.jsx("option",{children:"Unin libre"}),l.jsx("option",{children:"Divorciado"}),l.jsx("option",{children:"Viudo"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Pas de nacimiento *"}),l.jsx("input",{className:"form-input",list:"listCountries",value:v.paisNacimiento,onChange:T=>z("paisNacimiento",T.target.value),placeholder:"Escribe y elige",required:!0}),l.jsx("datalist",{id:"listCountries",children:BU.map(T=>l.jsx("option",{value:T},T))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Ciudad de nacimiento"}),l.jsx("input",{className:"form-input",list:"listCitiesBirth",value:v.ciudadNacimiento,onChange:T=>z("ciudadNacimiento",T.target.value),placeholder:"Escribe y elige"}),l.jsx("datalist",{id:"listCitiesBirth",children:(zp[v.paisNacimiento]||[]).map(T=>l.jsx("option",{value:T},T))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Fecha de ingreso"}),l.jsx("input",{className:"form-input",value:v.fechaIngreso,readOnly:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Fecha de nacimiento *"}),l.jsx("input",{type:"date",className:"form-input",value:v.fechaNacimiento,onChange:T=>z("fechaNacimiento",T.target.value),required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Edad"}),l.jsx("input",{className:"form-input",value:v.edad,readOnly:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Pas de domicilio *"}),l.jsx("input",{className:"form-input",list:"listCountries",value:v.paisDomicilio,onChange:T=>z("paisDomicilio",T.target.value),required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Ciudad de domicilio *"}),l.jsx("input",{className:"form-input",list:"listCitiesHome",value:v.ciudadDomicilio,onChange:T=>z("ciudadDomicilio",T.target.value),required:!0}),l.jsx("datalist",{id:"listCitiesHome",children:(zp[v.paisDomicilio]||[]).map(T=>l.jsx("option",{value:T},T))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Barrio *"}),l.jsx("input",{className:"form-input",value:v.barrio,onChange:T=>z("barrio",T.target.value),required:!0,placeholder:"Barrio"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Lugar de residencia *"}),l.jsx("input",{className:"form-input",value:v.lugarResidencia,onChange:T=>z("lugarResidencia",T.target.value),required:!0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Estrato"}),l.jsxs("select",{className:"form-input",value:v.estrato,onChange:T=>z("estrato",T.target.value),children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"1"}),l.jsx("option",{children:"2"}),l.jsx("option",{children:"3"}),l.jsx("option",{children:"4"}),l.jsx("option",{children:"5"}),l.jsx("option",{children:"6"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Zona residencial *"}),l.jsxs("select",{className:"form-input",value:v.zonaResidencial,onChange:T=>z("zonaResidencial",T.target.value),required:!0,children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"Urbana"}),l.jsx("option",{children:"Rural"})]})]}),l.jsxs("div",{className:"checkbox-cell",children:[l.jsx("label",{className:"form-label",children:"Es extranjero?"}),l.jsx("input",{type:"checkbox",checked:v.esExtranjero,onChange:T=>z("esExtranjero",T.target.checked)})]}),l.jsxs("div",{className:"checkbox-cell",children:[l.jsx("label",{className:"form-label",children:"Permite publicidad?"}),l.jsx("input",{type:"checkbox",checked:v.permitePublicidad,onChange:T=>z("permitePublicidad",T.target.checked)})]})]}),l.jsx("div",{className:"form-section-title",children:"Contacto"}),l.jsxs("div",{className:"form-grid",children:[l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Celular *"}),l.jsx("input",{className:"form-input",value:v.celular,onChange:T=>z("celular",T.target.value),required:!0,placeholder:"Celular del paciente"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Telfono de domicilio"}),l.jsx("input",{className:"form-input",value:v.telDomicilio,onChange:T=>z("telDomicilio",T.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Telfono de oficina"}),l.jsx("input",{className:"form-input",value:v.telOficina,onChange:T=>z("telOficina",T.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Extensin"}),l.jsx("input",{className:"form-input",value:v.extension,onChange:T=>z("extension",T.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Correo electrnico *"}),l.jsx("input",{type:"email",className:"form-input",value:v.email,onChange:T=>z("email",T.target.value),required:!0,placeholder:"correo@dominio.com"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Ocupacin *"}),l.jsx("input",{className:"form-input",value:v.ocupacion,onChange:T=>z("ocupacion",T.target.value),required:!0})]})]}),l.jsx("div",{className:"form-section-title",children:"Datos de facturacin"}),l.jsxs("div",{className:"form-grid",children:[l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Responsable"}),l.jsx("input",{className:"form-input",value:v.nombreResponsable,onChange:T=>z("nombreResponsable",T.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Parentesco"}),l.jsxs("select",{className:"form-input",value:v.parentesco,onChange:T=>z("parentesco",T.target.value),children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"Padre/Madre"}),l.jsx("option",{children:"Hermano"}),l.jsx("option",{children:"Esposo/a"}),l.jsx("option",{children:"Otro"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Celular"}),l.jsx("input",{className:"form-input",value:v.celularResponsable,onChange:T=>z("celularResponsable",T.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Telfono"}),l.jsx("input",{className:"form-input",value:v.telefonoResponsable,onChange:T=>z("telefonoResponsable",T.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Correo electrnico"}),l.jsx("input",{type:"email",className:"form-input",value:v.emailResponsable,onChange:T=>z("emailResponsable",T.target.value)})]})]}),l.jsx("div",{className:"form-section-title",children:"Acompaante"}),l.jsxs("div",{className:"form-grid",children:[l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Nombre"}),l.jsx("input",{className:"form-input",value:v.nombreAcompanante,onChange:T=>z("nombreAcompanante",T.target.value),placeholder:"Nombre acompaante"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Telfono"}),l.jsx("input",{className:"form-input",value:v.telefonoAcompanante,onChange:T=>z("telefonoAcompanante",T.target.value),placeholder:"Telfono acompaante"})]})]}),l.jsx("div",{className:"form-section-title",children:"Mercadeo"}),l.jsxs("div",{className:"form-grid",children:[l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Convenio beneficio"}),l.jsx("input",{className:"form-input",value:v.convenioBeneficio,onChange:T=>z("convenioBeneficio",T.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Cmo nos conoci?"}),l.jsxs("select",{className:"form-input",value:v.comoConocio,onChange:T=>z("comoConocio",T.target.value),children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"Redes sociales"}),l.jsx("option",{children:"Publicidad"}),l.jsx("option",{children:"Recomendacin"}),l.jsx("option",{children:"Otro"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Campaa"}),l.jsx("input",{className:"form-input",value:v.campania,onChange:T=>z("campania",T.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Remitido por"}),l.jsx("input",{className:"form-input",value:v.remitidoPor,onChange:T=>z("remitidoPor",T.target.value)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Asesor comercial"}),l.jsx("input",{className:"form-input",value:v.asesorComercial,onChange:T=>z("asesorComercial",T.target.value)})]})]}),l.jsx("div",{className:"form-section-title",children:"EPS"}),l.jsxs("div",{className:"form-grid",children:[l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Tipo de vinculacin *"}),l.jsxs("select",{className:"form-input",value:v.tipoVinculacion,onChange:T=>z("tipoVinculacion",T.target.value),required:!0,children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"Contributivo"}),l.jsx("option",{children:"Subsidiado"}),l.jsx("option",{children:"Particular"}),l.jsx("option",{children:"Otro"})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Nombre de la EPS *"}),l.jsx("input",{className:"form-input",list:"listEps",value:v.nombreEps,onChange:T=>z("nombreEps",T.target.value),placeholder:"Escribe y selecciona",required:!0}),l.jsx("datalist",{id:"listEps",children:We.map(T=>l.jsx("option",{value:T},T))})]}),l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Pliza de salud"}),l.jsx("input",{className:"form-input",value:v.polizaSalud,onChange:T=>z("polizaSalud",T.target.value)})]})]}),l.jsx("div",{className:"form-section-title",children:"Doctor"}),l.jsx("div",{className:"form-grid",children:l.jsxs("div",{children:[l.jsx("label",{className:"form-label",children:"Doctor"}),l.jsx("input",{className:"form-input",value:v.doctor,onChange:T=>z("doctor",T.target.value),placeholder:"Usuario / Libre"})]})}),l.jsx("div",{className:"form-section-title",children:"Alertas y Notas"}),l.jsx("div",{className:"form-grid",children:l.jsx("textarea",{className:"form-input",rows:3,value:v.notas,onChange:T=>z("notas",T.target.value),placeholder:"Notas del paciente"})}),l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,marginTop:12},children:[y?l.jsx("button",{type:"button",className:"btn",onClick:()=>Me({id:y,nombreCompleto:v.nombreCompleto}),children:"Eliminar"}):l.jsx("div",{}),l.jsxs("div",{style:{display:"flex",gap:8},children:[l.jsx("button",{type:"button",className:"btn",onClick:()=>b(!1),children:"Cancelar"}),l.jsx("button",{type:"submit",className:"btn blue",children:y?"Actualizar":"Guardar paciente"})]})]})]})]})]}),I&&l.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[l.jsx("div",{className:"odc-modal-backdrop",onClick:M}),l.jsxs("div",{className:"odc-card ficha-card",children:[l.jsxs("div",{className:"ficha-header",children:[l.jsxs("div",{className:"ficha-header-left",children:[I.fotoUrl?l.jsx("img",{src:I.fotoUrl,alt:"Foto",className:"ficha-avatar"}):l.jsx("div",{className:"avatar-fallback ficha-avatar-fallback",children:(I.nombreCompleto||"P")[0]}),l.jsxs("div",{children:[l.jsx("div",{className:"ficha-nombre",children:I.nombreCompleto||""}),l.jsxs("div",{className:"ficha-doc",children:[I.tipoDocumento||""," ",I.nroDocumento||""]}),l.jsxs("div",{className:"ficha-badges",children:[l.jsx("span",{className:"ficha-badge blue",children:"En valoracin"}),l.jsx("span",{className:"ficha-badge green",children:"Sin deuda"})]})]})]}),l.jsx("div",{className:"ficha-header-right",children:l.jsxs("div",{className:"ficha-actions",children:[l.jsx("button",{type:"button",className:"btn",onClick:M,children:"Cerrar"}),l.jsx("button",{type:"button",className:"btn blue",onClick:Re,children:"Editar"}),l.jsx("button",{type:"button",className:"btn green",onClick:()=>t(s(Xu.caja,{cobro:1,patientId:I.id})),title:"Ir a Caja para cobrar a este paciente",children:"Cobrar"})]})})]}),l.jsxs("div",{className:"ficha-body",children:[l.jsxs("aside",{className:"ficha-sidebar",children:[l.jsx("div",{className:"ficha-sidebar-title",children:"Informacin general"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="datos"?"active":""}`,onClick:()=>w("datos"),children:"Datos personales"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="marketing"?"active":""}`,onClick:()=>w("marketing"),children:"Marketing"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="eps"?"active":""}`,onClick:()=>w("eps"),children:"EPS"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="prof"?"active":""}`,onClick:()=>w("prof"),children:"Profesionales"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="rx"?"active":""}`,onClick:()=>w("rx"),children:"Rx/Imgenes/Doc"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="citas"?"active":""}`,onClick:()=>w("citas"),children:"Citas"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="crm"?"active":""}`,onClick:()=>w("crm"),children:"CRM"}),l.jsx("div",{className:"ficha-sidebar-title mt",children:"Historia clnica"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="doc"?"active":""}`,onClick:()=>w("doc"),children:"Doc. Clnicos"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="odonto"?"active":""}`,onClick:()=>w("odonto"),children:"Odontogramas"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="perio"?"active":""}`,onClick:()=>w("perio"),children:"Periodontogramas"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="presu"?"active":""}`,onClick:()=>w("presu"),children:"Presupuestos"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="evo"?"active":""}`,onClick:()=>w("evo"),children:"Evoluciones"}),l.jsx("div",{className:"ficha-sidebar-title mt",children:"Facturacin"}),l.jsx("button",{type:"button",className:`ficha-link ${x==="fact"?"active":""}`,onClick:()=>w("fact"),children:"Resumen"}),l.jsxs("div",{className:"ficha-sidebar-actions",style:{display:"grid",gap:8,marginTop:8},children:[l.jsx("button",{type:"button",className:"btn pay",onClick:()=>t(s(Xu.caja,{cobro:1,patientId:I.id})),title:"Cobrar a este paciente",children:"Realizar pago"}),l.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${Xu.pagos}?patientId=${encodeURIComponent(I.id)}`),title:"Ver histrico de pagos",children:"Histrico de pagos"}),l.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${Xu.facturas}?patientId=${encodeURIComponent(I.id)}`),title:"Ver histrico de facturacin",children:"Histrico de facturacin"})]})]}),l.jsxs("main",{className:"ficha-content",children:[x==="datos"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Datos personales"}),l.jsx("div",{className:"ficha-grid",children:[["Tipo de documento",I.tipoDocumento],["Nro. de documento",I.nroDocumento],["Nmero de Historia",I.nroHistoria],["Fecha de ingreso",I.fechaIngreso],["Nombres",I.nombres],["Apellidos",I.apellidos],["Nombre completo",I.nombreCompleto],["Sexo",I.sexo],["Estado civil",I.estadoCivil],["Pas de nacimiento",I.paisNacimiento],["Ciudad de nacimiento",I.ciudadNacimiento],["Fecha de nacimiento",I.fechaNacimiento],["Edad",I.edad],["Pas de domicilio",I.paisDomicilio],["Ciudad de domicilio",I.ciudadDomicilio],["Barrio",I.barrio],["Lugar de residencia",I.lugarResidencia],["Estrato",I.estrato],["Zona residencial",I.zonaResidencial],["Extranjero",I.esExtranjero?"S":"No"],["Permite publicidad",I.permitePublicidad?"S":"No"],["Celular",I.celular||I.celularPaciente],["Telfono domicilio",I.telDomicilio||I.telefonoPaciente],["Telfono oficina",I.telOficina],["Extensin",I.extension],["Correo electrnico",I.email],["Ocupacin",I.ocupacion],["Responsable",I.nombreResponsable],["Parentesco",I.parentesco],["Cel. responsable",I.celularResponsable],["Tel. responsable",I.telefonoResponsable],["Email responsable",I.emailResponsable],["Acompaante",I.nombreAcompanante],["Tel. acompaante",I.telefonoAcompanante]].map(([T,H])=>l.jsxs("div",{className:"field",children:[l.jsx("label",{children:T}),l.jsx("input",{className:"form-input",value:H||"",readOnly:!0})]},T))})]}),x==="marketing"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Marketing"}),l.jsx("div",{className:"ficha-grid",children:[["Convenio beneficio",I.convenioBeneficio],["Cmo nos conoci?",I.comoConocio],["Campaa",I.campania],["Remitido por",I.remitidoPor],["Asesor comercial",I.asesorComercial]].map(([T,H])=>l.jsxs("div",{className:"field",children:[l.jsx("label",{children:T}),l.jsx("input",{className:"form-input",value:H||"",readOnly:!0})]},T))})]}),x==="eps"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"EPS"}),l.jsx("div",{className:"ficha-grid",children:[["Tipo de vinculacin",I.tipoVinculacion],["Nombre EPS",I.nombreEps],["Pliza de salud",I.polizaSalud]].map(([T,H])=>l.jsxs("div",{className:"field",children:[l.jsx("label",{children:T}),l.jsx("input",{className:"form-input",value:H||"",readOnly:!0})]},T))})]}),x==="prof"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Profesionales"}),l.jsx("div",{className:"ficha-grid",children:l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Doctor"}),l.jsx("input",{className:"form-input",value:I.doctor||"",readOnly:!0})]})})]}),x==="rx"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Rx / Imgenes / Documentos"}),l.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[l.jsxs("label",{className:"btn blue",children:["Subir archivos",l.jsx("input",{ref:me,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",style:{display:"none"},onChange:T=>Ne([...T.target.files||[]])})]}),Qt&&l.jsx("span",{className:"hint",children:"Subiendo"}),l.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:l.jsx("input",{className:"form-input",style:{width:200},placeholder:"Buscar en Rx",value:Pe,onChange:T=>Ke(T.target.value),title:"Filtra por nombre, ttulo o descripcin"})})]}),l.jsxs("div",{className:"hint",style:{marginTop:6},children:[ie.length," elemento(s)",Pe?"  filtrado(s)":"","."]}),l.jsxs("div",{className:"rx-grid",style:{display:"grid",gap:10,marginTop:12,gridTemplateColumns:`repeat(auto-fill, minmax(${St.colMin}px, 1fr))`,alignItems:"start"},children:[ie.length===0&&l.jsx("div",{className:"no-data",style:{gridColumn:"1 / -1"},children:Pe?"Sin coincidencias.":"Sin archivos an."}),ie.map((T,H)=>{var kr,Qn;const Z=U(T),ye=T.title||T.name||`archivo-${H}`,Ee=((kr=(T.name||"").split(".").pop())==null?void 0:kr.toUpperCase())||((Qn=(T.type||"").split("/").pop())==null?void 0:Qn.toUpperCase())||"",Qe=T.uploadedAtISO||(T.created?new Date(T.created).toISOString():null);return l.jsxs("div",{className:"rx-item mini-card",style:{padding:8,display:"grid",gap:8},title:ye,children:[l.jsx("a",{href:T.url,target:"_blank",rel:"noreferrer",style:{width:"100%",height:St.thumbH,borderRadius:8,overflow:"hidden",border:"1px solid #e5e7eb",display:"grid",placeItems:"center",background:"#fafafa"},children:Z?l.jsx("img",{src:T.url,alt:ye,style:{width:St.thumbW,height:St.thumbH,objectFit:"contain",display:"block"},loading:"lazy"}):l.jsxs("div",{style:{textAlign:"center",padding:10},children:[l.jsx("div",{style:{fontSize:24,fontWeight:700},children:Ee||"DOC"}),l.jsx("div",{style:{fontSize:12,opacity:.7},children:"Ver / descargar"})]})}),l.jsx("div",{style:{fontWeight:600,fontSize:13,lineHeight:1.2},children:ye.length>40?ye.slice(0,37)+"":ye}),l.jsxs("details",{children:[l.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#2563eb"},children:"Editar nombre y descripcin"}),l.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[l.jsx("label",{className:"form-label",style:{marginTop:4},children:"Nombre para mostrar"}),l.jsx("input",{id:`rx-title-${H}`,className:"form-input",defaultValue:T.title||T.name||"",placeholder:"Ej. Rx aleta derecha 2025-11-29"}),l.jsx("label",{className:"form-label",children:"Descripcin"}),l.jsx("textarea",{id:`rx-desc-${H}`,className:"form-input",rows:2,defaultValue:T.desc||"",placeholder:"Observaciones, regin, tcnica, etc."}),l.jsx("label",{className:"form-label",children:"Fecha de subida"}),l.jsx("input",{id:`rx-date-${H}`,type:"datetime-local",className:"form-input",defaultValue:HU(Qe)}),l.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"space-between"},children:[l.jsx("button",{type:"button",className:"btn blue",onClick:()=>{var Jr,Zr,Ro;const Yn=((Jr=document.getElementById(`rx-title-${H}`))==null?void 0:Jr.value)||"",kt=((Zr=document.getElementById(`rx-desc-${H}`))==null?void 0:Zr.value)||"",bn=((Ro=document.getElementById(`rx-date-${H}`))==null?void 0:Ro.value)||"";let Tn=Qe,hr=T.uploadedAtMS||T.created||null;if(bn){const es=new Date(bn);isNaN(es.getTime())||(Tn=es.toISOString(),hr=es.getTime())}B(H,{title:Yn,name:Yn||T.name,desc:kt,uploadedAtISO:Tn,uploadedAtMS:hr})},children:"Guardar"}),l.jsx("button",{type:"button",className:"btn",onClick:()=>rt(H),children:"Eliminar"})]}),l.jsxs("div",{className:"hint",style:{fontSize:11},children:["Tipo: ",T.type||"","  Tamao: ",(T.size||0).toLocaleString()," bytes",Qe?`  Subido: ${WU(Qe)}`:""]})]})]})]},`${T.url}-${H}`)})]})]}),x==="doc"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Doc. Clnicos"}),l.jsxs("div",{className:"ficha-grid",children:[l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Motivo de consulta"}),l.jsx("textarea",{className:"form-input",rows:3,value:((Pr=I.historiaClinica)==null?void 0:Pr.motivoConsulta)||"",onChange:T=>Rt("motivoConsulta",T.target.value)})]}),l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Antecedentes"}),l.jsx("textarea",{className:"form-input",rows:3,value:((dr=I.historiaClinica)==null?void 0:dr.antecedentes)||"",onChange:T=>Rt("antecedentes",T.target.value)})]}),l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Alergias"}),l.jsx("textarea",{className:"form-input",rows:2,value:((Ts=I.historiaClinica)==null?void 0:Ts.alergias)||"",onChange:T=>Rt("alergias",T.target.value)})]}),l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Medicamentos"}),l.jsx("textarea",{className:"form-input",rows:2,value:((On=I.historiaClinica)==null?void 0:On.medicamentos)||"",onChange:T=>Rt("medicamentos",T.target.value)})]}),l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Notas"}),l.jsx("textarea",{className:"form-input",rows:3,value:((Xr=I.historiaClinica)==null?void 0:Xr.notas)||"",onChange:T=>Rt("notas",T.target.value)})]})]})]}),x==="odonto"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Odontograma (placeholder)"}),l.jsx("div",{className:"odont-grid",children:Array.from({length:32},(T,H)=>H+1).map(T=>{const H=(I.odontograma||[]).some(Z=>Z.pieza===T);return l.jsx("button",{type:"button",className:`tooth ${H?"on":""}`,onClick:()=>Nt("odontograma",T),title:`Pieza ${T}`,children:T},T)})})]}),x==="perio"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Periodontograma (placeholder)"}),l.jsx("div",{className:"odont-grid",children:Array.from({length:32},(T,H)=>H+1).map(T=>{const H=(I.periodontograma||[]).some(Z=>Z.pieza===T);return l.jsx("button",{type:"button",className:`tooth ${H?"on":""}`,onClick:()=>Nt("periodontograma",T),title:`Pieza ${T}`,children:T},T)})})]}),x==="presu"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Presupuestos & planes"}),l.jsx(YU,{onAdd:Nr}),l.jsxs("div",{className:"presu-list",children:[(I.presupuestos||[]).map(T=>l.jsxs("div",{className:"presu-item",children:[l.jsxs("div",{children:[l.jsx("div",{className:"presu-title",children:T.titulo}),l.jsxs("div",{className:"presu-meta",children:["Costo: $",T.costo||0,"  Estado: ",T.estado||"Pendiente"]})]}),l.jsx("button",{type:"button",className:"btn small",onClick:()=>In(T.id),children:"Eliminar"})]},T.id)),(!I.presupuestos||I.presupuestos.length===0)&&l.jsx("div",{className:"no-data",children:"Sin presupuestos an."})]})]}),x==="evo"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Evoluciones & Remisiones"}),l.jsx(XU,{onAdd:jn}),l.jsxs("div",{className:"evo-list",children:[(I.evoluciones||[]).map(T=>l.jsxs("div",{className:"evo-item",children:[l.jsx("div",{className:"evo-date",children:new Date(T.fechaISO).toLocaleString()}),l.jsx("div",{className:"evo-note",children:T.nota}),l.jsx("button",{type:"button",className:"btn small",onClick:()=>tn(T.id),children:"Eliminar"})]},T.id)),(!I.evoluciones||I.evoluciones.length===0)&&l.jsx("div",{className:"no-data",children:"Sin evoluciones an."})]})]}),x==="fact"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Facturacin"}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px,1fr))",gap:12},children:[l.jsx(Bo,{title:"Total facturado",value:`$ ${zt.totalFacturado.toLocaleString()}`}),l.jsx(Bo,{title:"Total pagado",value:`$ ${zt.totalPagado.toLocaleString()}`}),l.jsx(Bo,{title:"Facturas pendientes",value:`$ ${zt.totalFacturasPendientes.toLocaleString()}`}),l.jsx(Bo,{title:"Saldo pendiente (facturas - pagos)",value:`$ ${(zt.totalFacturado-zt.totalPagado).toLocaleString()}`}),l.jsx(Bo,{title:"Saldo a favor",value:`$ ${(((hu=I.facturacion)==null?void 0:hu.saldoFavor)??0).toLocaleString()}`}),l.jsx(Bo,{title:"Saldo crdito",value:`$ ${(((fu=I.facturacion)==null?void 0:fu.saldoCredito)??0).toLocaleString()}`})]}),zt.error&&l.jsxs("div",{className:"hint",style:{marginTop:6},children:[" ",zt.error]}),l.jsxs("div",{className:"ficha-grid",style:{marginTop:12},children:[l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Saldo a favor"}),l.jsx("input",{type:"number",className:"form-input",value:((Ci=I.facturacion)==null?void 0:Ci.saldoFavor)??0,onChange:T=>te({facturacion:{...I.facturacion||{},saldoFavor:Number(T.target.value||0)}})})]}),l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Saldo crdito"}),l.jsx("input",{type:"number",className:"form-input",value:((rl=I.facturacion)==null?void 0:rl.saldoCredito)??0,onChange:T=>te({facturacion:{...I.facturacion||{},saldoCredito:Number(T.target.value||0)}})})]})]})]}),x==="citas"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"Citas"}),l.jsxs("div",{className:"mini-card",style:{marginBottom:12},children:[l.jsx("div",{className:"mini-card-title",children:"Crear cita para este paciente"}),l.jsxs("div",{className:"ficha-grid",style:{marginTop:8},children:[l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Fecha"}),l.jsx("input",{type:"date",className:"form-input",value:re,onChange:T=>ge(T.target.value)})]}),l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Hora"}),l.jsx("input",{type:"time",className:"form-input",value:he,onChange:T=>Oe(T.target.value)})]}),l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Doctor"}),l.jsx("input",{className:"form-input",value:fe,onChange:T=>le(T.target.value),placeholder:"Doctor asignado"})]}),l.jsxs("div",{className:"field",children:[l.jsx("label",{children:"Espacio / Sala"}),l.jsx("input",{className:"form-input",value:De,onChange:T=>Le(T.target.value),placeholder:"Consultorio / Silla"})]}),l.jsxs("div",{className:"field",style:{gridColumn:"1 / -1"},children:[l.jsx("label",{children:"Comentario"}),l.jsx("textarea",{className:"form-input",rows:2,value:nt,onChange:T=>G(T.target.value),placeholder:"Motivo / notas de la cita"})]})]}),l.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[l.jsx("button",{type:"button",className:"btn blue",onClick:ae,children:"Guardar cita"}),re&&l.jsx("button",{type:"button",className:"btn",onClick:()=>i(re,I.id),children:"Ver ese da en Agenda"})]})]}),l.jsx("div",{className:"table-wrap",children:l.jsxs("table",{className:"appointments-table",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:"Fecha"}),l.jsx("th",{children:"Estado"}),l.jsx("th",{children:"Motivo"}),l.jsx("th",{children:"Profesional / Acciones"})]})}),l.jsx("tbody",{children:Ye?l.jsx("tr",{children:l.jsx("td",{className:"no-data",colSpan:4,children:"Cargando"})}):Pt.length===0?l.jsx("tr",{children:l.jsx("td",{className:"no-data",colSpan:4,children:"Sin citas registradas."})}):Pt.map(T=>l.jsxs("tr",{children:[l.jsx("td",{children:T.fechaISO?new Date(T.fechaISO).toLocaleString():T.fechaYYYYMMDD||""}),l.jsx("td",{children:T.estado||""}),l.jsx("td",{children:T.motivo||""}),l.jsx("td",{children:l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("span",{children:T.profesional||""}),l.jsx("button",{type:"button",className:"btn small",onClick:()=>{const H=T.fechaYYYYMMDD||T.fecha||(T.fechaISO?new Date(T.fechaISO).toISOString().slice(0,10):"");i(H,I.id)},title:"Abrir en Agenda",children:"Ver en Agenda"})]})})]},T.id))})]})})]}),x==="crm"&&l.jsxs("section",{className:"ficha-section",children:[l.jsx("h4",{className:"ficha-section-title",children:"CRM"}),l.jsx("div",{className:"no-data",children:"Notas / recordatorios comerciales del paciente."})]}),l.jsx("div",{className:"ficha-footer"})]})]})]})]})]})}function Bo({title:t,value:e}){return l.jsxs("div",{className:"mini-card",children:[l.jsx("div",{className:"mini-card-title",children:t}),l.jsx("div",{style:{fontWeight:700,fontSize:20,marginTop:6},children:e})]})}function YU({onAdd:t}){const[e,n]=C.useState(""),[r,s]=C.useState(""),[i,o]=C.useState("Pendiente");return l.jsxs("div",{className:"presu-form",children:[l.jsx("input",{className:"form-input",placeholder:"Procedimiento / plan",value:e,onChange:a=>n(a.target.value)}),l.jsx("input",{type:"number",className:"form-input",placeholder:"Costo",value:r,onChange:a=>s(a.target.value)}),l.jsxs("select",{className:"form-input",value:i,onChange:a=>o(a.target.value),children:[l.jsx("option",{children:"Pendiente"}),l.jsx("option",{children:"Aprobado"}),l.jsx("option",{children:"Rechazado"})]}),l.jsx("button",{type:"button",className:"btn blue",onClick:()=>{if(!e)return alert("Ttulo requerido");t({titulo:e,costo:Number(r||0),estado:i}),n(""),s(""),o("Pendiente")},children:"Agregar"})]})}function XU({onAdd:t}){const[e,n]=C.useState("");return l.jsxs("div",{className:"evo-form",children:[l.jsx("textarea",{className:"form-input",rows:2,placeholder:"Escribe la evolucin / remisin",value:e,onChange:r=>n(r.target.value)}),l.jsx("button",{type:"button",className:"btn blue",onClick:()=>{e.trim()&&(t(e.trim()),n(""))},children:"Guardar evolucin"})]})}function JU(){return l.jsxs("div",{style:{padding:"20px"},children:[l.jsx("h2",{children:"Mdulo de Facturacin"}),l.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function ZU({basePath:t="",className:e=""}){const n=xs(),r=()=>{const s=String(t||"").replace(/\/+$/g,"");n(`${s}/config/datos-basicos`,{replace:!1})};return l.jsx("button",{type:"button",className:`oc-icon-btn ${e}`,title:"Configuracin","aria-label":"Abrir configuracin",onClick:r,children:""})}function e6(t,e){let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}function t6(){const[t,e]=C.useState({nombre:"",marca:"",pais:"Colombia",ciudad:"",tipoDocumento:"NIT",numeroDocumento:"",tipoPersona:"",telefono:"",celular:"",direccion:"",sitioWeb:"",urlAgendamiento:"",regimen:"",responsabilidadTributaria:"",correo:"",moneda:"Pesos colombianos (COP)",zonaHoraria:"Hora de Colombia",cuentaContable:"",esIPS:!1,usuarioSispro:"",tipoDocSispro:"Cdula de Ciudadana",passwordSispro:"",codigoPrestador:""});C.useEffect(()=>{var s;try{const i=localStorage.getItem("empresa_datos_basicos");if(i){const o=JSON.parse(i);e(a=>({...a,...o}))}else{const o=(s=document.querySelector('meta[name="company-name"]'))==null?void 0:s.getAttribute("content");o&&e(a=>({...a,nombre:o}))}}catch{}},[]);const n=s=>{const{name:i,type:o,value:a,checked:c}=s.target;e(d=>({...d,[i]:o==="checkbox"?c:a}))},r=async s=>{s.preventDefault();try{localStorage.setItem("empresa_datos_basicos",JSON.stringify(t)),localStorage.setItem("empresa_nombre",t.nombre||"OdontoCloud"),e6("company-name",t.nombre||"OdontoCloud")}catch{}console.log("Guardar Empresa  Datos bsicos:",t),alert("Datos bsicos guardados.")};return l.jsxs("div",{className:"oc-main-content",children:[l.jsx("div",{className:"oc-section-title",children:l.jsx("h2",{children:"Configuracin  Datos bsicos"})}),l.jsxs("div",{className:"emp-card",children:[l.jsx("div",{className:"emp-title",children:"Datos bsicos"}),l.jsxs("form",{className:"emp-form",onSubmit:r,children:[l.jsxs("div",{className:"oc-form-grid",children:[l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Nombre *"}),l.jsx("input",{name:"nombre",className:"emp-input",autoComplete:"organization",required:!0,value:t.nombre,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Marca"}),l.jsx("input",{name:"marca",className:"emp-input",value:t.marca,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Pas"}),l.jsxs("select",{name:"pais",className:"emp-select",value:t.pais,onChange:n,children:[l.jsx("option",{children:"Colombia"}),l.jsx("option",{children:"Mxico"}),l.jsx("option",{children:"Per"}),l.jsx("option",{children:"Chile"}),l.jsx("option",{children:"Argentina"}),l.jsx("option",{children:"Espaa"})]})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Ciudad"}),l.jsx("input",{name:"ciudad",className:"emp-input",value:t.ciudad,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Tipo documento *"}),l.jsxs("select",{name:"tipoDocumento",className:"emp-select",required:!0,value:t.tipoDocumento,onChange:n,children:[l.jsx("option",{children:"NIT"}),l.jsx("option",{children:"CC"}),l.jsx("option",{children:"CE"}),l.jsx("option",{children:"PA"})]})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Nmero de documento *"}),l.jsx("input",{name:"numeroDocumento",className:"emp-input",required:!0,value:t.numeroDocumento,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Tipo de persona"}),l.jsxs("select",{name:"tipoPersona",className:"emp-select",value:t.tipoPersona,onChange:n,children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"Natural"}),l.jsx("option",{children:"Jurdica"})]})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Telfono fijo"}),l.jsx("input",{name:"telefono",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.telefono,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Celular"}),l.jsx("input",{name:"celular",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.celular,onChange:n})]}),l.jsxs("div",{className:"oc-field oc-col-2",children:[l.jsx("label",{className:"emp-label",children:"Direccin"}),l.jsx("input",{name:"direccion",className:"emp-input",autoComplete:"street-address",value:t.direccion,onChange:n})]}),l.jsxs("div",{className:"oc-field oc-col-2",children:[l.jsx("label",{className:"emp-label",children:"Sitio web"}),l.jsx("input",{name:"sitioWeb",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.sitioWeb,onChange:n})]}),l.jsxs("div",{className:"oc-field oc-col-2",children:[l.jsx("label",{className:"emp-label",children:"Agendamiento (URL)"}),l.jsx("input",{name:"urlAgendamiento",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.urlAgendamiento,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Rgimen legal"}),l.jsxs("select",{name:"regimen",className:"emp-select",value:t.regimen,onChange:n,children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"Comn"}),l.jsx("option",{children:"Simplificado"})]})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Responsabilidad tributaria"}),l.jsxs("select",{name:"responsabilidadTributaria",className:"emp-select",value:t.responsabilidadTributaria,onChange:n,children:[l.jsx("option",{value:"",children:"Seleccione"}),l.jsx("option",{children:"No aplica"}),l.jsx("option",{children:"Autorretenedor"})]})]}),l.jsxs("div",{className:"oc-field oc-col-2",children:[l.jsx("label",{className:"emp-label",children:"Correo electrnico"}),l.jsx("input",{name:"correo",className:"emp-input",type:"email",autoComplete:"email",value:t.correo,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Moneda"}),l.jsxs("select",{name:"moneda",className:"emp-select",value:t.moneda,onChange:n,children:[l.jsx("option",{children:"Pesos colombianos (COP)"}),l.jsx("option",{children:"Dlares (USD)"}),l.jsx("option",{children:"Euros (EUR)"})]})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Zona horaria"}),l.jsxs("select",{name:"zonaHoraria",className:"emp-select",value:t.zonaHoraria,onChange:n,children:[l.jsx("option",{children:"Hora de Colombia"}),l.jsx("option",{children:"America/Bogota"}),l.jsx("option",{children:"UTC-5"})]})]}),l.jsxs("div",{className:"oc-field oc-col-2",children:[l.jsx("label",{className:"emp-label",children:"Cuenta contable"}),l.jsx("input",{name:"cuentaContable",className:"emp-input",value:t.cuentaContable,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Es una institucin prestadora de salud (IPS)?"}),l.jsxs("div",{className:"emp-inline",children:[l.jsx("input",{id:"esIPS",type:"checkbox",name:"esIPS",checked:t.esIPS,onChange:n}),l.jsx("label",{htmlFor:"esIPS",children:"S"})]})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Usuario SISPRO"}),l.jsx("input",{name:"usuarioSispro",className:"emp-input",value:t.usuarioSispro,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Tipo documento SISPRO"}),l.jsxs("select",{name:"tipoDocSispro",className:"emp-select",value:t.tipoDocSispro,onChange:n,children:[l.jsx("option",{children:"Cdula de Ciudadana"}),l.jsx("option",{children:"Cdula de Extranjera"}),l.jsx("option",{children:"NIT"})]})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Contrasea SISPRO"}),l.jsx("input",{name:"passwordSispro",className:"emp-input",type:"password",value:t.passwordSispro,onChange:n})]}),l.jsxs("div",{className:"oc-field",children:[l.jsx("label",{className:"emp-label",children:"Cdigo de prestador"}),l.jsx("input",{name:"codigoPrestador",className:"emp-input",value:t.codigoPrestador,onChange:n})]})]}),l.jsx("div",{className:"oc-form-actions",children:l.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})})]})]})]})}const Hp="empresa_logo_url";function EI(t,e){let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}function n6(){const[t,e]=C.useState(()=>{try{return localStorage.getItem(Hp)||""}catch{return""}}),[n,r]=C.useState(null),[s,i]=C.useState(!1),o=C.useRef(null),a=C.useCallback(A=>{const N=A==null?void 0:A[0];if(!N)return;if(!N.type.startsWith("image/")){alert("Por favor selecciona una imagen (PNG/JPG/SVG/WebP).");return}r(N);const b=new FileReader;b.onload=y=>{var E;return e(String(((E=y.target)==null?void 0:E.result)||""))},b.readAsDataURL(N)},[]),c=A=>a(A.target.files),d=A=>{A.preventDefault(),A.stopPropagation(),i(!1),a(A.dataTransfer.files)},h=A=>{A.preventDefault(),i(!0)},f=()=>i(!1),m=()=>{var A;return(A=o.current)==null?void 0:A.click()},_=()=>{r(null),e("")},R=async()=>{try{t?(localStorage.setItem(Hp,t),EI("company-logo",t)):(localStorage.removeItem(Hp),EI("company-logo","")),alert("Logo guardado.")}catch(A){console.error(A),alert("No se pudo guardar localmente.")}};return l.jsxs("div",{className:"oc-main-content",children:[l.jsx("div",{className:"oc-section-title",children:l.jsx("h2",{children:"Configuracin  Logo empresa"})}),l.jsxs("div",{className:"emp-card",children:[l.jsx("div",{className:"emp-title",children:"Logo"}),l.jsxs("div",{className:"logo-wrap",children:[l.jsxs("div",{className:"logo-current",children:[l.jsx("div",{className:"emp-label",children:"Logo actual"}),l.jsx("div",{className:"logo-preview","aria-live":"polite",children:t?l.jsx("img",{src:t,alt:"Logo actual de la empresa"}):l.jsx("div",{className:"logo-empty",children:"Sin logo"})}),l.jsx("div",{className:"logo-actions",children:l.jsx("button",{type:"button",className:"oc-btn danger",onClick:_,disabled:!t,children:"Eliminar"})})]}),l.jsxs("div",{className:"logo-uploader",children:[l.jsx("div",{className:"emp-label",children:"Cargar foto"}),l.jsxs("div",{className:`logo-drop ${s?"over":""}`,onDragOver:h,onDragLeave:f,onDrop:d,onClick:m,role:"button",tabIndex:0,onKeyDown:A=>(A.key==="Enter"||A.key===" ")&&m(),"aria-label":"Arrastra o haz click para cargar la imagen del logo",children:[l.jsx("input",{ref:o,type:"file",accept:"image/*",onChange:c,style:{display:"none"}}),l.jsxs("div",{className:"logo-drop-hint",children:["Arrastra o click para cargar la foto.",l.jsx("div",{className:"logo-subhint",children:"Solo archivos de imagen"})]})]}),n&&l.jsxs("div",{className:"logo-file-name",children:["Archivo seleccionado: ",l.jsx("b",{children:n.name})]})]})]}),l.jsx("div",{className:"oc-form-actions",children:l.jsx("button",{type:"button",className:"oc-btn primary",onClick:R,children:"Guardar"})})]})]})}const r6="modulepreload",s6=function(t){return"/odontocloud-react/"+t},xI={},e1=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=s6(c),c in xI)return;xI[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":r6,d||(f.as="script"),f.crossOrigin="",f.href=c,a&&f.setAttribute("nonce",a),document.head.appendChild(f),d)return new Promise((m,_)=>{f.addEventListener("load",m),f.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};function i6(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}const o6=(t,e)=>t.toLowerCase().endsWith(e.toLowerCase());async function a6(t="OdontoCloud-PriceList"){const e=["Categora","Cdigo","Nombre","Permite desc","Precio","Genera RIPS","Es consulta","Ver en la agenda","Nombre en la agenda","Tiempo","Identificador","Ver en agenda","Cuenta contable"];try{const n=await e1(()=>import("https://cdn.sheetjs.com/xlsx-0.20.3/package/xlsx.mjs"),[]),r=[e],s=n.utils.aoa_to_sheet(r),i=n.utils.book_new();n.utils.book_append_sheet(i,s,"Lista de precios");const o=n.utils.aoa_to_sheet([["Formato"]]);n.utils.book_append_sheet(i,o,"Formatos");const a=n.utils.aoa_to_sheet([["Identificador","Descripcin"]]);n.utils.book_append_sheet(i,a,"Identificadores de tipo de cita");const c=n.write(i,{bookType:"xlsx",type:"array"}),d=new Blob([c],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=URL.createObjectURL(d),f=document.createElement("a");f.href=h,f.download=`${t}.xlsx`,f.click(),URL.revokeObjectURL(h)}catch(n){console.warn("No se pudo cargar XLSX, exportando CSV.",n);const r=[e.join(",")].join(`
`),s=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(s),o=document.createElement("a");o.href=i,o.download=`${t}.csv`,o.click(),URL.revokeObjectURL(i)}}function l6({tipo:t="clinicos",onCancel:e,onSaved:n}){const[r,s]=C.useState(""),[i,o]=C.useState(!1),a=async()=>{if(!r.trim()){alert("Por favor, escribe el nombre de la lista.");return}o(!0);try{const c=new Date().toLocaleString("es-CO",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});await _r(Ce(ue,"listas_precios"),{nombre:r.trim(),tipo:t,creado:c,actualizado:c,enUso:!0}),n==null||n()}catch(c){console.error("Error creando lista:",c),alert("No se pudo crear la lista. Revisa consola.")}finally{o(!1)}};return l.jsxs("div",{className:"card",style:{position:"relative"},children:[l.jsx("button",{type:"button",title:"Exportar",className:"ghost-chip",style:{position:"absolute",right:16,top:16,height:34,padding:"0 12px",borderRadius:999,border:"1px solid #e5e7eb",background:"#eff6ff",fontWeight:600,cursor:"pointer",opacity:.9},onClick:()=>a6("OdontoCloud-PriceList"),children:"Exportar"}),l.jsxs("div",{className:"lp-formbox",style:{border:"1px solid #e5e7eb",borderRadius:10,padding:16,background:"#fff",maxWidth:720},children:[l.jsx("label",{htmlFor:"nombreLista",style:{display:"block",fontWeight:700,marginBottom:8},children:"Nombre *"}),l.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[l.jsx("input",{id:"nombreLista",type:"text",value:r,onChange:c=>s(c.target.value),placeholder:"Nombre de la lista",style:{flex:1,height:38,padding:"0 10px",borderRadius:8,border:`1px solid ${r?"#cbd5e1":"#fca5a5"}`,outline:"none"}}),l.jsx("button",{type:"button",title:"Sugerir nombre",className:"round-tip",onClick:()=>s("Lista de precios "+new Date().toLocaleDateString("es-CO")),style:{height:38,width:38,borderRadius:999,border:"1px solid #e5e7eb",background:"#f9fafb",cursor:"pointer",fontWeight:700},children:""})]}),l.jsxs("div",{style:{marginTop:16,display:"flex",gap:8},children:[l.jsx("button",{type:"button",onClick:a,disabled:i,className:"save-btn",style:{height:36,padding:"0 14px",borderRadius:8,border:0,background:"#22c55e",color:"#fff",fontWeight:700,cursor:"pointer"},children:i?"Guardando...":"Guardar"}),l.jsx("button",{type:"button",onClick:e,className:"neutral-btn",style:{height:36,padding:"0 14px",borderRadius:8,border:"1px solid #e5e7eb",background:"#fff",fontWeight:600,cursor:"pointer"},children:"Cancelar"})]})]})]})}function c6(){const{pathname:t}=Dn(),e=xs(),r=`${C.useMemo(()=>i6(t),[t])}/config/lista-de-precios`,s=o6(t,"/config/lista-de-precios/nuevo"),[i,o]=C.useState("clinicos"),[a,c]=C.useState([]),[d,h]=C.useState(!0),[f,m]=C.useState(0);C.useEffect(()=>{const y="lp-inline-styles-2";if(!document.getElementById(y)){const E=`
        .oc-main-content.lp { padding: 16px 20px !important; }
        .oc-section-title { margin-bottom: 16px !important; }
        .oc-section-title h2 { margin: 0 !important; font-weight: 800 !important; font-size: 20px !important; color: #0f172a !important; }
        .lp .card { background:#fff !important; border:1px solid #e5e7eb !important; border-radius:10px !important; padding:16px !important; box-shadow: 0 2px 8px rgba(0,0,0,.04) !important; }
        .lp .lp-formbox { width:100% !important; max-width: 900px !important; }
        .lp .card .lp-formbox input[type="text"] { width: 100% !important; }
        .lp .table-responsive { width:100% !important; overflow-x:auto !important; }
        .lp .table-responsive table { width:100% !important; border-collapse: collapse !important; }
        .lp .table-responsive th, .lp .table-responsive td { white-space: nowrap !important; }
        .lp .tabs-btn { padding: 8px 14px !important; border-radius: 8px !important; border: 1px solid #cbd5e1 !important; font-weight: 600 !important; cursor: pointer !important; }
        @media (max-width: 640px){ .oc-main-content.lp { padding: 12px !important; } .oc-section-title h2 { font-size: 18px !important; } }
      `,I=document.createElement("style");I.id=y,I.appendChild(document.createTextNode(E)),document.head.appendChild(I)}},[]),C.useEffect(()=>{const y="lp-solid-btns";if(document.getElementById(y))return;const E=`
      .lp .tabs-btn{appearance:none!important;-webkit-appearance:none!important;border:1px solid #cbd5e1!important;font-weight:600!important;cursor:pointer!important}
      .lp .tabs-btn{background:#f8fafc!important;color:#1e293b!important}
      .lp .tabs-btn.active{background:#2563eb!important;color:#fff!important;border-color:#1d4ed8!important}

      .lp .save-btn{appearance:none!important;-webkit-appearance:none!important;border:none!important;background:#22c55e!important;color:#fff!important}
      .lp .neutral-btn{appearance:none!important;-webkit-appearance:none!important;border:1px solid #e5e7eb!important;background:#fff!important;color:#111827!important}

      .lp .btn-blue{appearance:none!important;-webkit-appearance:none!important;border:none!important;background:#3b82f6!important;color:#fff!important}
      .lp .btn-sky{appearance:none!important;-webkit-appearance:none!important;border:none!important;background:#06b6d4!important;color:#fff!important}
      .lp .btn-red{appearance:none!important;-webkit-appearance:none!important;border:none!important;background:#ef4444!important;color:#fff!important}

      .lp .round-tip{appearance:none!important;-webkit-appearance:none!important;background:#f9fafb!important;border:1px solid #e5e7eb!important;color:#111827!important}
      .lp .ghost-chip{appearance:none!important;-webkit-appearance:none!important;background:#eff6ff!important;border:1px solid #e5e7eb!important;color:#0f172a!important;opacity:1!important}
    `,I=document.createElement("style");I.id=y,I.appendChild(document.createTextNode(E)),document.head.appendChild(I)},[]),C.useEffect(()=>{(async()=>{h(!0);try{const E=Ce(ue,"listas_precios"),O=(await gt(E)).docs.map(F=>({id:F.id,nombre:F.data().nombre||"Sin nombre",creado:F.data().creado||"",actualizado:F.data().actualizado||"",enUso:F.data().enUso??!0}));c(O)}catch(E){console.error("Error cargando listas:",E)}finally{h(!1)}})()},[f]);const _=y=>e(`${r}/editar/${y}`),R=async y=>{try{const E=ct(ue,"listas_precios",y),I=await za(E);if(!I.exists())return alert("No se encontr la lista para duplicar.");const O=I.data(),F=new Date().toLocaleString("es-CO");await _r(Ce(ue,"listas_precios"),{...O,nombre:`${O.nombre||"Lista"} (copia)`,creado:F,actualizado:F}),m(x=>x+1)}catch(E){console.error(E),alert("No se pudo duplicar la lista.")}},A=async y=>{if(confirm("Eliminar esta lista de precios?"))try{await Rf(ct(ue,"listas_precios",y)),c(E=>E.filter(I=>I.id!==y))}catch(E){console.error(E),alert("No se pudo eliminar.")}},N=()=>e(`${r}/nuevo`),b=()=>e(r);return l.jsxs("div",{className:"oc-main-content lp",children:[l.jsx("div",{className:"oc-section-title",children:l.jsxs("h2",{children:["Configuracin  ",s?"Nueva lista de precios":"Lista de precios"]})}),s?l.jsx(l6,{tipo:i,onCancel:b,onSaved:()=>{m(y=>y+1),b()}}):l.jsxs("div",{className:"card",children:[l.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16,flexWrap:"wrap"},children:[[{key:"clinicos",label:"Lista de precios clnicos"},{key:"productos",label:"Lista de precios productos"},{key:"servicios",label:"Lista de precios servicios"}].map(y=>l.jsx("button",{className:`tabs-btn ${i===y.key?"active":""}`,onClick:()=>o(y.key),style:{background:i===y.key?"#2563eb":"#f8fafc",color:i===y.key?"#fff":"#1e293b"},children:y.label},y.key)),l.jsx("button",{className:"tabs-btn active",style:{marginLeft:"auto",background:"#65a30d",color:"#fff",border:"none",borderRadius:8,padding:"8px 14px",cursor:"pointer",fontWeight:600},onClick:N,children:"+ Nuevo listado de precios"})]}),l.jsx("div",{className:"table-responsive",children:l.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:".9rem"},children:[l.jsx("thead",{children:l.jsxs("tr",{style:{background:"#f1f5f9"},children:[l.jsx("th",{style:Rl,children:"Nombre"}),l.jsx("th",{style:Rl,children:"Fecha de creacin"}),l.jsx("th",{style:Rl,children:"Fecha de actualizacin"}),l.jsx("th",{style:Rl,children:"En uso"}),l.jsx("th",{style:Rl,children:"Acciones"})]})}),l.jsx("tbody",{children:d?l.jsx("tr",{children:l.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):a.length===0?l.jsx("tr",{children:l.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"No hay listas registradas."})}):a.map(y=>l.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0"},children:[l.jsx("td",{style:Nl,children:y.nombre}),l.jsx("td",{style:Nl,children:y.creado}),l.jsx("td",{style:Nl,children:y.actualizado}),l.jsx("td",{style:Nl,children:l.jsx("span",{style:{color:y.enUso?"#15803d":"#dc2626",fontWeight:600},children:y.enUso?"En uso":"Inactivo"})}),l.jsxs("td",{style:Nl,children:[l.jsx("button",{className:"btn-blue",style:u6,title:"Editar",onClick:()=>_(y.id),children:""}),l.jsx("button",{className:"btn-sky",style:d6,title:"Duplicar",onClick:()=>R(y.id),children:""}),l.jsx("button",{className:"btn-red",style:h6,title:"Eliminar",onClick:()=>A(y.id),children:""})]})]},y.id))})]})})]})]})}const Rl={padding:"10px 12px",textAlign:"left",borderBottom:"1px solid #e2e8f0",color:"#475569",fontWeight:700},Nl={padding:"10px 12px",color:"#0f172a"},u6={background:"#3b82f6",border:"none",color:"#fff",padding:"4px 8px",borderRadius:6,marginRight:6,cursor:"pointer"},d6={background:"#06b6d4",border:"none",color:"#fff",padding:"4px 8px",borderRadius:6,marginRight:6,cursor:"pointer"},h6={background:"#ef4444",border:"none",color:"#fff",padding:"4px 8px",borderRadius:6,cursor:"pointer"};function f6(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}const Wp=[{nombre:"Rehabilitacin Oral",comentario:""},{nombre:"Implantologa",comentario:""},{nombre:"Ciruga Oral",comentario:""},{nombre:"Periodoncia",comentario:""},{nombre:"Endodoncia",comentario:""},{nombre:"Ortodoncia",comentario:""},{nombre:"Odontologa General",comentario:""},{nombre:"Radiologa",comentario:""},{nombre:"Psicologa",comentario:""}];function p6(){C.useEffect(()=>{const t="lp-edit-inline";if(document.getElementById(t))return;const e=`
      .oc-main-content.lp { padding:16px 20px }
      .oc-section-title { margin-bottom:16px }
      .oc-section-title h2 { margin:0; font-weight:800; font-size:20px; color:#0f172a }
      .card { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.04) }
      .toolbar { display:flex; gap:8px; align-items:center; }

      /* Chips / botones de la barra (slidos) */
      .chip { height:34px; padding:0 12px; border-radius:999px; border:1px solid #e5e7eb; cursor:pointer; font-weight:600; background:#f9fafb; transition:.15s }
      .chip:hover { background:#e5e7eb }
      .chip.blue  { background:#3b82f6; color:#fff; border:none }
      .chip.green { background:#22c55e; color:#fff; border:none }

      .name-row { display:flex; align-items:center; gap:8px; }
      .text-inp { height:38px; padding:0 10px; border-radius:8px; border:1px solid #cbd5e1; outline:none; width:280px }

      .table-responsive { width:100%; overflow-x:auto }
      table { width:100%; border-collapse:collapse; font-size:.9rem }
      thead tr { background:#f1f5f9 }
      th, td { padding:10px 12px; white-space:nowrap }
      th { text-align:left; border-bottom:1px solid #e2e8f0; color:#475569; font-weight:700 }
      tr + tr { border-top:1px solid #e2e8f0 }

      /* Botones fila (slidos) */
      .btn { padding:4px 8px; border:none; border-radius:6px; color:#fff; cursor:pointer; margin-right:6px; font-weight:600; transition:.12s }
      .btn:hover { opacity:.9 }
      .btn.blue   { background:#3b82f6 }
      .btn.sky    { background:#06b6d4 }
      .btn.green  { background:#22c55e }
      .btn.orange { background:#f59e0b }
      .btn.red    { background:#ef4444 }
      .btn.sm { height:32px; padding:0 10px; border-radius:8px }

      .status-pill { padding:2px 8px; border-radius:999px; font-weight:600 }
      .status-on { background:#dcfce7; color:#166534 }
      .status-off{ background:#fee2e2; color:#991b1b }
      .muted { color:#64748b }

      /* Modal base */
      .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:999}
      .modal{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(840px,92vw);padding:0;border:1px solid #e5e7eb}
      .modal .hd{padding:12px 16px;border-bottom:1px solid #e5e7eb;font-weight:700}
      .modal .bd{padding:16px}
      .modal .ft{padding:12px 16px;border-top:1px solid #e5e7eb;display:flex;gap:8px;justify-content:flex-end}

      .tabs{display:flex;gap:6px;border-bottom:1px solid #e5e7eb;margin-bottom:12px;padding:0 4px}
      .tab{padding:8px 10px;border-radius:8px 8px 0 0;border:1px solid #e5e7eb;border-bottom:none;background:#f8fafc;cursor:pointer;font-weight:600}
      .tab.active{background:#fff}

      .row{display:flex;gap:10px;align-items:center;margin-bottom:10px}
      .inp{height:36px;border:1px solid #cbd5e1;border-radius:8px;padding:0 10px;outline:none}
      .ta{border:1px solid #cbd5e1;border-radius:8px;padding:8px;min-height:80px;outline:none}

      @media (max-width:640px){ .text-inp{ width:100% } .row{flex-direction:column;align-items:stretch} }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}function m6(){p6();const{id:t}=xP(),{pathname:e}=Dn(),n=xs(),s=`${C.useMemo(()=>f6(e),[e])}/config/lista-de-precios`,[i,o]=C.useState(""),[a,c]=C.useState(!1),[d,h]=C.useState([]),[f,m]=C.useState(!0),[_,R]=C.useState(!1),[A,N]=C.useState(!1),[b,y]=C.useState(!1),[E,I]=C.useState(0),[O,F]=C.useState("none"),[x,w]=C.useState("existentes"),[v,P]=C.useState([]),[D,j]=C.useState(""),[k,K]=C.useState("");C.useEffect(()=>{async function B(){m(!0);try{const W=ct(ue,"listas_precios",t),re=await za(W);o(re.exists()&&re.data().nombre||"")}catch(W){console.error("[LP editar] getDoc",W==null?void 0:W.code,W==null?void 0:W.message),o("")}try{const W=Ce(ue,"listas_precios",t,"categorias"),ge=(await gt(W)).docs.map(he=>({id:he.id,...he.data(),activa:he.data().activa??!0}));ge.sort((he,Oe)=>(he.nombre||"").localeCompare(Oe.nombre||"")),h(ge)}catch(W){console.warn("[LP editar] categoras vacas o sin permiso",W==null?void 0:W.code,W==null?void 0:W.message),h([])}finally{m(!1)}}B()},[t]);async function We(){try{c(!0),await us(ct(ue,"listas_precios",t),{nombre:(i||"").trim(),actualizado:new Date().toLocaleString("es-CO")})}catch(B){console.error(B),alert("No se pudo actualizar el nombre.")}finally{c(!1)}}async function At(B){try{await us(ct(ue,"listas_precios",t,"categorias",B.id),{activa:!B.activa}),h(W=>W.map(re=>re.id===B.id?{...re,activa:!re.activa}:re))}catch(W){console.error(W),alert("No se pudo cambiar el estado.")}}async function Qt(B){try{const W=Ce(ue,"listas_precios",t,"categorias");await _r(W,{nombre:`${B.nombre||"Categora"} (copia)`,comentario:B.comentario||"",activa:!0,creado:new Date().toLocaleString("es-CO")});const re=await gt(W);h(re.docs.map(ge=>({id:ge.id,...ge.data(),activa:ge.data().activa??!0})))}catch(W){console.error(W),alert("No se pudo duplicar.")}}async function ee(B){if(confirm(`Eliminar categora "${B.nombre}"?`))try{await Rf(ct(ue,"listas_precios",t,"categorias",B.id)),h(W=>W.filter(re=>re.id!==B.id))}catch(W){console.error(W),alert("No se pudo eliminar.")}}async function me(){y(!0),w("existentes"),j(""),K("");try{const W=(await gt(Ce(ue,"catalogo_categorias"))).docs.map(re=>({id:re.id,...re.data()}));P(W.length?W:Wp.map((re,ge)=>({id:`def-${ge}`,...re})))}catch{P(Wp.map((B,W)=>({id:`def-${W}`,...B})))}}async function _e(B){try{const W=Ce(ue,"listas_precios",t,"categorias");await _r(W,{nombre:B.nombre,comentario:B.comentario||"",activa:!0,creado:new Date().toLocaleString("es-CO")});const re=await gt(W);h(re.docs.map(ge=>({id:ge.id,...ge.data(),activa:ge.data().activa??!0}))),alert("Categora agregada.")}catch(W){console.error(W),alert("No se pudo agregar la categora.")}}async function Pe(){if(!D.trim())return alert("Escribe el nombre de la categora.");try{const B=Ce(ue,"listas_precios",t,"categorias");await _r(B,{nombre:D.trim(),comentario:k.trim(),activa:!0,creado:new Date().toLocaleString("es-CO")});const W=await gt(B);h(W.docs.map(re=>({id:re.id,...re.data(),activa:re.data().activa??!0}))),y(!1)}catch(B){console.error(B),alert("No se pudo crear la categora.")}}async function Ke(){try{const B=Ce(ue,"catalogo_categorias");for(const W of Wp){const re=`${W.nombre}`.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-");await $c(ct(B,re),{nombre:W.nombre,comentario:W.comentario||""},{merge:!0})}alert("Catlogo base creado/actualizado. Vuelve a abrir 'Agregar categora'.")}catch(B){console.error(B),alert("No se pudo sembrar el catlogo base.")}}function St(B,W){return W==="up"?Math.ceil(B):W==="down"?Math.floor(B):B}async function U(){const B=Number(E);if(!Number.isFinite(B))return alert("Ingresa un porcentaje vlido.");try{for(const W of d){const re=Ce(ue,"listas_precios",t,"categorias",W.id,"items"),ge=await gt(re).catch(()=>null);if(ge)for(const he of ge.docs){const Oe=he.data()||{},fe=Number(Oe.precio||0),le=St(fe*(1+B/100),O);await us(ct(ue,"listas_precios",t,"categorias",W.id,"items",he.id),{precio:le,actualizado:new Date().toLocaleString("es-CO")})}}alert("Precios actualizados."),R(!1)}catch(W){console.error(W),alert("No se pudo aplicar el incremento.")}}async function ie(){try{const B=[];for(const re of d){const ge=Ce(ue,"listas_precios",t,"categorias",re.id,"items"),he=await gt(ge).catch(()=>null),Oe=he?he.docs.map(fe=>({id:fe.id,...fe.data()})):[{}];for(const fe of Oe)B.push({Categoria:re.nombre||"",Cdigo:fe.codigo||"",Nombre:fe.nombre||"","Permite desc":fe.permite_descuento?"SI":"No",Precio:Number(fe.precio||0),"Genera RIPS":fe.genera_rips?"SI":"No","Es consulta":fe.es_consulta?"SI":"No","Ver en agenda":fe.ver_en_agenda?"SI":"No","Nombre en la agenda":fe.nombre_en_agenda||"",Tiempo:fe.tiempo||"",Identificador:fe.identificador||"","Cuenta contable":fe.cuenta_contable||""})}const W=typeof window<"u"&&window.XLSX?window.XLSX:null;if(W&&W.utils&&B.length){const re=W.utils.book_new(),ge=W.utils.json_to_sheet(B);W.utils.book_append_sheet(re,ge,"Lista de precios");const he=W.write(re,{bookType:"xlsx",type:"array"}),Oe=new Blob([he],{type:"application/octet-stream"}),fe=document.createElement("a");fe.href=URL.createObjectURL(Oe),fe.download=`${i||"Lista"}.xlsx`,fe.click(),URL.revokeObjectURL(fe.href)}else{const re=Object.keys(B[0]||{Categoria:"",Cdigo:"",Nombre:"","Permite desc":"",Precio:"","Genera RIPS":"","Es consulta":"","Ver en agenda":"","Nombre en la agenda":"",Tiempo:"",Identificador:"","Cuenta contable":""}),ge=[re.join(","),...B.map(fe=>re.map(le=>{const De=fe[le]??"",Le=String(De).replace(/"/g,'""');return/[",\n]/.test(Le)?`"${Le}"`:Le}).join(","))].join(`
`),he=new Blob([ge],{type:"text/csv;charset=utf-8"}),Oe=document.createElement("a");Oe.href=URL.createObjectURL(he),Oe.download=`${i||"Lista"}.csv`,Oe.click(),URL.revokeObjectURL(Oe.href)}}catch(B){console.error(B),alert("No se pudo exportar.")}}return l.jsxs("div",{className:"oc-main-content lp",children:[l.jsx("div",{className:"oc-section-title",children:l.jsx("h2",{children:"Configuracin  Edicin Lista de precios"})}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"toolbar",style:{justifyContent:"space-between",marginBottom:12},children:[l.jsxs("div",{className:"name-row",children:[l.jsx("label",{style:{fontWeight:700},children:"Nombre*"}),l.jsx("input",{className:"text-inp",value:i,placeholder:"Principal",onChange:B=>o(B.target.value)}),l.jsx("button",{className:"btn green",onClick:We,disabled:a,title:"Guardar nombre",children:a?"Guardando":"Guardar"})]}),l.jsxs("div",{style:{display:"flex",gap:8},children:[l.jsx("button",{className:"chip blue",title:"Exportar",onClick:ie,children:"Exportar"}),l.jsx("button",{className:"chip",title:"Incrementar %",onClick:()=>{I(0),F("none"),R(!0)},children:"%"}),l.jsx("button",{className:"chip",title:"Opciones",onClick:()=>N(!0),children:""}),l.jsx("button",{className:"chip green",onClick:me,children:"+ Agregar categora"})]})]}),l.jsx("div",{className:"table-responsive",children:l.jsxs("table",{children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{style:{width:40}}),l.jsx("th",{children:"Categora"}),l.jsx("th",{children:"Comentario"}),l.jsx("th",{style:{width:140},children:"Estado"}),l.jsx("th",{style:{width:260,textAlign:"right"},children:"Acciones"})]})}),l.jsx("tbody",{children:f?l.jsx("tr",{children:l.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):d.length===0?l.jsx("tr",{children:l.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Sin categoras."})}):d.map(B=>l.jsxs("tr",{children:[l.jsx("td",{children:""}),l.jsx("td",{style:{fontWeight:700},children:B.nombre||"Categora"}),l.jsx("td",{className:"muted",children:B.comentario||""}),l.jsx("td",{children:l.jsx("span",{className:`status-pill ${B.activa?"status-on":"status-off"}`,children:B.activa?"Conectado":"Desconectado"})}),l.jsxs("td",{style:{textAlign:"right"},children:[l.jsx("button",{className:"btn green",title:"Agregar tem",onClick:()=>alert("Agregar tem"),children:""}),l.jsx("button",{className:"btn orange",title:"Descuento %",onClick:()=>alert("Descuento"),children:"%"}),l.jsx("button",{className:"btn sky",title:"Duplicar",onClick:()=>Qt(B),children:""}),l.jsx("button",{className:"btn red",title:"Eliminar",onClick:()=>ee(B),children:"B"}),l.jsx("button",{className:"btn blue",title:B.activa?"Desactivar":"Activar",onClick:()=>At(B),style:{marginLeft:6},children:B.activa?"":""})]})]},B.id))})]})}),l.jsx("div",{style:{marginTop:16},children:l.jsx("button",{className:"chip",onClick:()=>n(s),children:" Volver"})})]}),_&&l.jsx("div",{className:"modal-mask",onClick:()=>R(!1),children:l.jsxs("div",{className:"modal",onClick:B=>B.stopPropagation(),children:[l.jsx("div",{className:"hd",children:"Incrementar todos los precios"}),l.jsxs("div",{className:"bd",children:[l.jsxs("div",{className:"row",children:[l.jsx("label",{style:{minWidth:170},children:"Porcentaje de incremento"}),l.jsx("input",{className:"inp",type:"number",value:E,onChange:B=>I(B.target.value),placeholder:"Ej: 10"}),l.jsx("span",{className:"muted",children:"%"})]}),l.jsxs("div",{className:"row",children:[l.jsx("label",{style:{minWidth:170},children:"Redondeo"}),l.jsxs("select",{className:"inp",value:O,onChange:B=>F(B.target.value),children:[l.jsx("option",{value:"down",children:"Redondear hacia abajo"}),l.jsx("option",{value:"up",children:"Redondear hacia arriba"}),l.jsx("option",{value:"none",children:"No redondear"})]})]}),l.jsxs("p",{className:"muted",children:["Se recorren todas las categoras y sus tems y se actualiza el campo ",l.jsx("b",{children:"precio"}),"."]})]}),l.jsxs("div",{className:"ft",children:[l.jsx("button",{className:"chip",onClick:()=>R(!1),children:"Cerrar"}),l.jsx("button",{className:"chip green",onClick:U,children:"Incrementar"})]})]})}),A&&l.jsx("div",{className:"modal-mask",onClick:()=>N(!1),children:l.jsxs("div",{className:"modal",onClick:B=>B.stopPropagation(),children:[l.jsx("div",{className:"hd",children:"Opciones"}),l.jsxs("div",{className:"bd",children:[l.jsx("p",{className:"muted",style:{marginTop:0},children:"Acciones generales de la lista."}),l.jsx("button",{className:"chip green",onClick:Ke,children:"Sembrar catlogo base"})]}),l.jsx("div",{className:"ft",children:l.jsx("button",{className:"chip",onClick:()=>N(!1),children:"Cerrar"})})]})}),b&&l.jsx("div",{className:"modal-mask",onClick:()=>y(!1),children:l.jsxs("div",{className:"modal",onClick:B=>B.stopPropagation(),children:[l.jsx("div",{className:"hd",children:"Categora"}),l.jsxs("div",{className:"bd",children:[l.jsxs("div",{className:"tabs",children:[l.jsx("button",{className:`tab ${x==="existentes"?"active":""}`,onClick:()=>w("existentes"),children:"Categoras existentes"}),l.jsx("button",{className:`tab ${x==="nueva"?"active":""}`,onClick:()=>w("nueva"),children:"Editar categora / Nueva categora"})]}),x==="existentes"?l.jsx("div",{children:v.length===0?l.jsx("p",{className:"muted",children:"No hay catlogo disponible. Puedes crear una nueva categora en la pestaa de la derecha."}):l.jsxs("table",{children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:"Nombre"}),l.jsx("th",{children:"Comentario"}),l.jsx("th",{children:"Acciones"})]})}),l.jsx("tbody",{children:v.map(B=>l.jsxs("tr",{children:[l.jsx("td",{children:B.nombre}),l.jsx("td",{className:"muted",children:B.comentario||""}),l.jsx("td",{children:l.jsx("button",{className:"btn green sm",onClick:()=>_e(B),children:"Agregar"})})]},B.id))})]})}):l.jsxs("div",{children:[l.jsxs("div",{className:"row",children:[l.jsx("label",{style:{minWidth:140},children:"Nombre *"}),l.jsx("input",{className:"inp",placeholder:"Ingrese el nombre de la categora",value:D,onChange:B=>j(B.target.value)})]}),l.jsxs("div",{className:"row",style:{alignItems:"flex-start"},children:[l.jsx("label",{style:{minWidth:140,paddingTop:6},children:"Comentario"}),l.jsx("textarea",{className:"ta",placeholder:"",value:k,onChange:B=>K(B.target.value)})]})]})]}),l.jsxs("div",{className:"ft",children:[l.jsx("button",{className:"chip",onClick:()=>y(!1),children:"Cerrar"}),x==="nueva"&&l.jsx("button",{className:"chip green",onClick:Pe,children:"Guardar"})]})]})})]})}const g6={"datos-basicos":t6,logo:n6,"lista-de-precios":c6};function y6(t=""){const e=t.toLowerCase().indexOf("/config/");return e===-1?[]:t.slice(e+8).split("/").filter(Boolean)}function v6(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function _6({current:t,onNav:e}){const n=[{slug:"datos-basicos",label:"Datos bsicos"},{slug:"logo",label:"Logo"},{slug:"lista-de-precios",label:"Lista de precios"},{slug:"consecutivos",label:"Consecutivos",soon:!0},{slug:"sucursales",label:"Sucursales",soon:!0},{slug:"metodos-de-pago",label:"Mtodos de pago",soon:!0},{slug:"especialidades",label:"Especialidades",soon:!0},{slug:"usuarios",label:"Usuarios",soon:!0},{slug:"condiciones-de-pago",label:"Condiciones de pago",soon:!0},{slug:"plantillas-doc-clinicos",label:"Plantillas Doc. Clnicos",soon:!0},{slug:"impuestos",label:"Impuestos",soon:!0}];return l.jsxs("aside",{style:{width:300,flex:"0 0 300px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,position:"sticky",top:12,alignSelf:"flex-start",maxHeight:"calc(100vh - 24px)",overflow:"auto"},"aria-label":"Informacin general",children:[l.jsx("h4",{style:{margin:"4px 0 10px",color:"#64748b"},children:"Informacin general"}),l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.map(r=>{const s=r.slug===t;return l.jsxs("button",{type:"button",onClick:()=>!r.soon&&e(r.slug),title:r.soon?"Prximamente":r.label,style:{textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid "+(s?"#60a5fa":"#e5e7eb"),background:s?"#eff6ff":"#f9fafb",fontWeight:600,cursor:r.soon?"not-allowed":"pointer",color:r.soon?"#94a3b8":"#0f172a"},children:[r.label," ",r.soon?"  prximamente":""]},r.slug)})})]})}function II(){return l.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[l.jsx("h3",{style:{marginTop:0},children:"Configuracin"}),l.jsxs("p",{className:"oc-muted",style:{margin:0},children:["Selecciona una seccin del men de la izquierda para empezar (por ejemplo, ",l.jsx("b",{children:"Datos bsicos"}),")."]})]})}function w6(){const{pathname:t}=Dn(),e=xs(),n=y6(t),r=n[0]||"",s=n[1]||"",i=v6(t),a=r==="lista-de-precios"&&s==="editar"?m6:g6[r],c=d=>e(`${i}/config/${d}`);return C.useEffect(()=>{r||e(`${i}/config/datos-basicos`,{replace:!0})},[r,i,e]),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",gap:16,background:"#f8fafc",padding:16,borderRadius:12},children:[l.jsx(_6,{current:r,onNav:c}),l.jsx("div",{style:{minWidth:0,background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:r?a?l.jsx(a,{}):l.jsx(II,{}):l.jsx(II,{})})]})}const Vr=t=>(Number(t)||0).toLocaleString("es-CO",{maximumFractionDigits:0}),zo=()=>new Date().toISOString().slice(0,10),E6=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),x6=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0),bI=t=>qe.fromDate(t),I6=()=>{const[t,e]=C.useState(null);return C.useEffect(()=>{const n=My(Ah,r=>e(r||null));return()=>n()},[]),t},Ht=({children:t,align:e})=>l.jsx("th",{className:"oc-th",style:{position:"sticky",top:0,zIndex:1,textAlign:e||"left",background:"var(--oc-surface, #fff)"},children:t}),b6=()=>Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);function T6(){var Se;const t=I6(),e=[{key:"abrir",label:"Abrir caja",icon:""},{key:"abiertas",label:"Cajas abiertas",icon:""},{key:"cerradas",label:"Cajas cerradas",icon:""},{key:"mio",label:"Mi caja (hoy)",icon:""},{key:"simulados",label:"Cierres simulados",icon:""},{key:"bancos",label:"Bancos",icon:""}],[n,r]=C.useState("abiertas"),[s,i]=C.useState(""),[o,a]=C.useState(""),c=C.useRef(null),[d,h]=C.useState(!1),[f,m]=C.useState(""),[_,R]=C.useState([]),[A,N]=C.useState(!0),[b,y]=C.useState([]),[E,I]=C.useState(!0),[O,F]=C.useState(null),[x,w]=C.useState(!0),[v,P]=C.useState(""),[D,j]=C.useState([]),[k,K]=C.useState(null),[We,At]=C.useState(""),[Qt,ee]=C.useState("efectivo"),[me,_e]=C.useState(!1),[Pe,Ke]=C.useState("ingreso"),[St,U]=C.useState(""),[ie,B]=C.useState(""),[W,re]=C.useState(!1),[ge,he]=C.useState([]),[Oe,fe]=C.useState([]);C.useEffect(()=>{const M=it(Ce(ue,"cajas"),Je("estado","==","abierta"),gn("fechaApertura","desc")),J=Un(M,te=>{R(te.docs.map(Ne=>le(Ne.id,Ne.data()))),N(!1),i("")},te=>{console.error(te),i((te==null?void 0:te.code)==="failed-precondition"?"Falta ndice (estado, fechaApertura) en Firestore.":(te==null?void 0:te.code)==="permission-denied"?"Permiso denegado en Firestore (revisa reglas).":"No se pudieron leer las cajas."),N(!1)});return()=>J()},[]),C.useEffect(()=>{const M=it(Ce(ue,"cajas"),Je("estado","==","cerrada"),gn("fechaCierre","desc")),J=Un(M,te=>{y(te.docs.map(Ne=>le(Ne.id,Ne.data()))),I(!1)},te=>{console.error(te),I(!1)});return()=>J()},[]),C.useEffect(()=>{if(!t){F(null),w(!1);return}w(!0);const M=it(Ce(ue,"cajas"),Je("estado","==","abierta"),Je("usuarioId","==",t.uid),Je("fechaApertura",">=",bI(E6())),Je("fechaApertura","<",bI(x6()))),J=Un(M,te=>{const Ne=te.docs[0];F(Ne?le(Ne.id,Ne.data()):null),w(!1)},te=>{console.error(te),w(!1),(te==null?void 0:te.code)==="failed-precondition"&&i("Falta ndice (estado, usuarioId, fechaApertura) en Firestore.")});return()=>J()},[t]),C.useEffect(()=>{if(!(O!=null&&O.id)){he([]),fe([]);return}const M=it(Ce(ue,"movimientos"),Je("cashId","==",O.id),Je("dia","==",zo()),gn("fecha","desc")),J=Un(M,rt=>he(rt.docs.map(Rt=>({id:Rt.id,...Rt.data()}))),rt=>console.error(rt)),te=it(Ce(ue,"payments"),Je("cashId","==",O.id),Je("dia","==",zo()),gn("fecha","desc")),Ne=Un(te,rt=>fe(rt.docs.map(Rt=>({id:Rt.id,...Rt.data()}))),rt=>console.error(rt));return()=>{J(),Ne()}},[O==null?void 0:O.id]),C.useEffect(()=>{if(!(v!=null&&v.trim())){j([]);return}const M=it(Ce(ue,"patients"),Je("q",">=",z(v)),Je("q","<=",z(v)+""),gn("q","asc")),J=Un(M,te=>j(te.docs.map(Ne=>({id:Ne.id,...Ne.data()}))),te=>console.error(te));return()=>J()},[v]);function le(M,J={}){const te=Nt=>{var Bt;return((Bt=Nt==null?void 0:Nt.toDate)==null?void 0:Bt.call(Nt))||(typeof Nt=="string"?new Date(Nt):Nt||null)},Ne=te(J.fechaApertura),rt=te(J.fechaCierre),Rt=Number(J.baseInicial||0),Nr=Number(J.baseActual!==void 0?J.baseActual:Rt),In=Number(J.saldoInicial||0),jn=Number(J.saldoActual!==void 0?J.saldoActual:In),tn=[];return jn<0&&tn.push("Saldo negativo"),Nr<0&&tn.push("Base negativa"),{id:M,estado:J.estado||"abierta",usuarioId:J.usuarioId||"",usuarioNombre:J.usuarioNombre||"Usuario",nombre:J.nombre||J.usuarioNombre||"Caja",fechaApertura:Ne,fechaCierre:rt,baseInicial:Rt,baseActual:Nr,saldoInicial:In,saldoActual:jn,ia:tn}}const De=async M=>{var J;if((J=M==null?void 0:M.preventDefault)==null||J.call(M),!t){i("Debes iniciar sesin para abrir una caja.");return}h(!0);try{const te=Number(f||0);await _r(Ce(ue,"cajas"),{estado:"abierta",usuarioId:t.uid,usuarioNombre:t.displayName||t.email||"Usuario",fechaApertura:Xn(),baseInicial:te,baseActual:te,saldoInicial:0,saldoActual:0,dia:zo()}),m(""),r("mio"),i("")}catch(te){console.error(te),i("No se pudo abrir la caja.")}finally{h(!1)}},Le=async M=>{try{await us(ct(ue,"cajas",M),{estado:"cerrada",fechaCierre:Xn()}),r("cerradas")}catch(J){console.error(J),i("No se pudo cerrar la caja.")}},nt=async M=>{var te;if((te=M==null?void 0:M.preventDefault)==null||te.call(M),!(O!=null&&O.id)){i("Debes abrir tu caja para registrar movimientos.");return}const J=Number(ie||0);if(!(!J||J<=0)){re(!0);try{await _r(Ce(ue,"movimientos"),{cashId:O.id,tipo:Pe,concepto:St||(Pe==="ingreso"?"Ingreso":"Egreso"),valor:J,fecha:Xn(),dia:zo(),usuarioId:(t==null?void 0:t.uid)||null});const Ne=Pe==="ingreso"?J:-J;await us(ct(ue,"cajas",O.id),{saldoActual:Qx(Ne)}),U(""),B("")}catch(Ne){console.error(Ne),i("No se pudo registrar el movimiento.")}finally{re(!1)}}},G=async M=>{var te;if((te=M==null?void 0:M.preventDefault)==null||te.call(M),!(O!=null&&O.id))return i("Abre tu caja para cobrar.");const J=Number(We||0);if(!(!J||J<=0)){if(!k)return i("Selecciona un paciente.");_e(!0);try{const Ne=await _r(Ce(ue,"payments"),{cashId:O.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:J,medio:Qt,estado:"aprobado",fecha:Xn(),dia:zo()});await us(ct(ue,"cajas",O.id),{saldoActual:Qx(J)}),At(""),ee("efectivo"),i(`Pago registrado (${Ne.id}).`)}catch(Ne){console.error(Ne),i("No se pudo registrar el pago.")}finally{_e(!1)}}},ae=async M=>{var te;if((te=M==null?void 0:M.preventDefault)==null||te.call(M),!(O!=null&&O.id))return i("Abre tu caja para cobrar.");const J=Number(We||0);if(!(!J||J<=0)){if(!k)return i("Selecciona un paciente.");_e(!0);try{const rt=`https://pay.odontocloud/mock/${b6()}`,Rt=await _r(Ce(ue,"payments"),{cashId:O.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:J,medio:"link",estado:"pending",linkUrl:rt,fecha:Xn(),dia:zo()});i(`Link de pago generado: ${rt}`),At("")}catch(Ne){console.error(Ne),i("No se pudo generar link de pago.")}finally{_e(!1)}}},z=M=>(M||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),oe=C.useMemo(()=>{const M=z(o);return M?_.filter(J=>[J.nombre,J.usuarioNombre,Vr(J.saldoActual),Vr(J.baseActual)].map(z).some(te=>te.includes(M))):_},[o,_]),ce=()=>l.jsxs("div",{className:"card",children:[l.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:l.jsx("h3",{children:"Abrir caja"})}),l.jsxs("form",{className:"oc-form",onSubmit:De,style:{display:"flex",gap:12,alignItems:"end",flexWrap:"wrap"},children:[l.jsxs("label",{style:{display:"inline-flex",flexDirection:"column",gap:6},children:[l.jsx("span",{children:"Base inicial (COP)"}),l.jsx("input",{type:"number",className:"oc-input",min:"0",step:"1000",value:f,onChange:M=>m(M.target.value),placeholder:"0"})]}),l.jsx("button",{className:"oc-btn",type:"submit",disabled:d,children:d?"Abriendo...":"Abrir caja"})]}),l.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Se asociar a tu usuario y quedar visible en ",l.jsx("b",{children:"Mi caja (hoy)"}),"."]})]}),xe=()=>l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"card",style:{marginBottom:10},children:l.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("h3",{style:{margin:0},children:"Cajas Abiertas"}),l.jsx("span",{className:"oc-tag",children:oe.length}),s&&l.jsx("span",{className:"oc-tag oc-tag-danger",children:s})]}),l.jsx("input",{ref:c,className:"oc-input",style:{maxWidth:280},placeholder:"Buscar...",value:o,onChange:M=>a(M.target.value)})]})}),l.jsx("div",{className:"card",children:l.jsx("div",{className:"oc-table-wrap",children:l.jsxs("table",{className:"oc-table",children:[l.jsx("thead",{className:"oc-thead",children:l.jsxs("tr",{className:"oc-tr",children:[l.jsx(Ht,{children:"Caja"}),l.jsx(Ht,{children:"Fecha apertura"}),l.jsx(Ht,{align:"right",children:"Base actual"}),l.jsx(Ht,{align:"right",children:"Saldo inicial"}),l.jsx(Ht,{align:"right",children:"Saldo actual"}),l.jsx(Ht,{children:"Usuario"}),l.jsx(Ht,{children:"Acciones"})]})}),l.jsx("tbody",{className:"oc-tbody",children:A?l.jsx(TI,{cols:7}):oe.length===0?l.jsx("tr",{className:"oc-tr",children:l.jsx("td",{className:"oc-td",colSpan:7,children:l.jsx("span",{className:"oc-muted",children:"Sin cajas abiertas."})})}):oe.map(M=>{var J;return l.jsxs("tr",{className:"oc-tr",children:[l.jsxs("td",{className:"oc-td",children:[l.jsx("b",{children:M.nombre})," ",(J=M.ia)!=null&&J.length?l.jsx("span",{className:"oc-tag oc-tag-danger",title:M.ia.join("  "),children:"IA"}):null]}),l.jsx("td",{className:"oc-td",children:M.fechaApertura?M.fechaApertura.toLocaleString("es-CO"):""}),l.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Vr(M.baseActual)]}),l.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Vr(M.saldoInicial)]}),l.jsxs("td",{className:"oc-td",style:{textAlign:"right",color:M.saldoActual<0?"#b91c1c":void 0,fontWeight:600},children:["$",Vr(M.saldoActual)]}),l.jsx("td",{className:"oc-td",children:M.usuarioNombre}),l.jsxs("td",{className:"oc-td",style:{whiteSpace:"nowrap"},children:[l.jsx("button",{className:"oc-small-btn",onClick:()=>r("mio"),children:"Ver"})," ",l.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Le(M.id),children:"Cerrar"})]})]},M.id)})})]})})})]}),Ie=()=>l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[l.jsx("h3",{children:"Mi caja (hoy)"}),(O==null?void 0:O.estado)==="abierta"&&l.jsxs("div",{style:{display:"flex",gap:8},children:[l.jsx("span",{className:"oc-tag oc-tag-success",children:"Abierta"}),l.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Le(O.id),children:"Cerrar caja"})]})]}),x?l.jsx("div",{className:"oc-muted",children:"Cargando"}):O?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"oc-stats-row",style:{marginBottom:12},children:[l.jsxs("div",{className:"stat-card",children:[l.jsx("span",{className:"stat-label",children:"Base actual"}),l.jsxs("span",{className:"stat-value",children:["$",Vr(O.baseActual)]})]}),l.jsxs("div",{className:"stat-card",children:[l.jsx("span",{className:"stat-label",children:"Saldo actual"}),l.jsxs("span",{className:"stat-value",style:{color:O.saldoActual<0?"#b91c1c":void 0},children:["$",Vr(O.saldoActual)]})]})]}),l.jsxs("div",{className:"card",style:{marginBottom:12},children:[l.jsx("h4",{style:{marginBottom:8},children:"Cobro rpido"}),l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:8},children:[l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[l.jsx("label",{className:"oc-muted",children:"Paciente"}),l.jsx("input",{className:"oc-input",placeholder:"Buscar nombre o documento",value:v,onChange:M=>P(M.target.value)}),v&&D.length>0&&l.jsx("div",{className:"oc-dropdown",children:D.slice(0,6).map(M=>l.jsx("button",{className:`oc-menu-item ${(k==null?void 0:k.id)===M.id?"active":""}`,onClick:()=>{K(M),P(M.nombre||M.name||M.doc||"")},type:"button",children:(M.nombre||M.name||"Paciente")+(M.doc?`  ${M.doc}`:"")},M.id))})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[l.jsx("label",{className:"oc-muted",children:"Monto (COP)"}),l.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:We,onChange:M=>At(M.target.value)})]}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[l.jsx("label",{className:"oc-muted",children:"Medio"}),l.jsxs("select",{className:"oc-input",value:Qt,onChange:M=>ee(M.target.value),children:[l.jsx("option",{value:"efectivo",children:"Efectivo"}),l.jsx("option",{value:"tarjeta",children:"Tarjeta"}),l.jsx("option",{value:"transferencia",children:"Transferencia"}),l.jsx("option",{value:"link",children:"Link (en lnea)"})]})]}),l.jsx("div",{style:{display:"flex",alignItems:"end",gap:6},children:Qt==="link"?l.jsx("button",{className:"oc-btn",onClick:ae,disabled:me,children:me?"Creando":"Generar link"}):l.jsx("button",{className:"oc-btn",onClick:G,disabled:me,children:me?"Guardando":"Registrar pago"})})]}),l.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Para link, el saldo se actualiza cuando el pago pase a ",l.jsx("b",{children:"aprobado"})," (webhook)."]})]}),l.jsxs("div",{className:"card",style:{marginBottom:12},children:[l.jsx("h4",{style:{marginBottom:8},children:"Movimiento manual"}),l.jsxs("form",{onSubmit:nt,style:{display:"grid",gridTemplateColumns:"120px 1fr 180px auto",gap:8},children:[l.jsxs("select",{className:"oc-input",value:Pe,onChange:M=>Ke(M.target.value),children:[l.jsx("option",{value:"ingreso",children:"Ingreso"}),l.jsx("option",{value:"egreso",children:"Egreso"})]}),l.jsx("input",{className:"oc-input",placeholder:"Concepto (ej. Caja chica, Arriendo, etc.)",value:St,onChange:M=>U(M.target.value)}),l.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:ie,onChange:M=>B(M.target.value)}),l.jsx("button",{className:"oc-btn",disabled:W,children:W?"Guardando":"Agregar"})]})]}),l.jsxs("div",{className:"card",children:[l.jsx("h4",{style:{marginBottom:8},children:"Movimientos y pagos (hoy)"}),l.jsx("div",{className:"oc-table-wrap",style:{marginBottom:12},children:l.jsxs("table",{className:"oc-table",children:[l.jsx("thead",{className:"oc-thead",children:l.jsxs("tr",{className:"oc-tr",children:[l.jsx(Ht,{children:"Tipo"}),l.jsx(Ht,{children:"Concepto / Paciente"}),l.jsx(Ht,{children:"Medio"}),l.jsx(Ht,{children:"Estado"}),l.jsx(Ht,{align:"right",children:"Valor"}),l.jsx(Ht,{children:"Hora"})]})}),l.jsx("tbody",{className:"oc-tbody",children:ge.length===0&&Oe.length===0?l.jsx("tr",{className:"oc-tr",children:l.jsx("td",{className:"oc-td",colSpan:6,children:l.jsx("span",{className:"oc-muted",children:"Sin movimientos ni pagos an."})})}):l.jsxs(l.Fragment,{children:[Oe.map(M=>{var J,te;return l.jsxs("tr",{className:"oc-tr",children:[l.jsx("td",{className:"oc-td",children:"Pago"}),l.jsxs("td",{className:"oc-td",children:[M.patientName||"Paciente"," ",M.linkUrl?l.jsx("a",{href:M.linkUrl,target:"_blank",rel:"noreferrer",children:"(link)"}):null]}),l.jsx("td",{className:"oc-td",children:M.medio}),l.jsx("td",{className:"oc-td",children:l.jsx("span",{className:`oc-tag ${M.estado==="aprobado"?"oc-tag-success":M.estado==="pending"?"oc-tag-warning":"oc-tag-danger"}`,children:M.estado})}),l.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Vr(M.valor)]}),l.jsx("td",{className:"oc-td",children:(te=(J=M.fecha)==null?void 0:J.toDate)!=null&&te.call(J)?M.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`pay-${M.id}`)}),ge.map(M=>{var J,te;return l.jsxs("tr",{className:"oc-tr",children:[l.jsx("td",{className:"oc-td",children:M.tipo}),l.jsx("td",{className:"oc-td",children:M.concepto}),l.jsx("td",{className:"oc-td",children:""}),l.jsx("td",{className:"oc-td",children:l.jsx("span",{className:"oc-tag",children:(M.tipo==="ingreso","ok")})}),l.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Vr(M.valor)]}),l.jsx("td",{className:"oc-td",children:(te=(J=M.fecha)==null?void 0:J.toDate)!=null&&te.call(J)?M.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`mov-${M.id}`)})]})})]})}),l.jsx("p",{className:"oc-muted",children:"Sugerencia: crea ndice compuesto para `movimientos(cashId, dia, fecha)` y `payments(cashId, dia, fecha)` para rendimiento."})]})]}):l.jsxs("div",{className:"oc-empty",children:[l.jsx("p",{className:"oc-muted",children:"No tienes una caja abierta hoy."}),l.jsx("button",{className:"oc-btn",onClick:()=>r("abrir"),children:"Abrir caja"})]})]}),Ue=()=>l.jsxs("div",{className:"card",children:[l.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:l.jsxs("h3",{children:["Cajas cerradas ",l.jsx("span",{className:"oc-tag",children:b.length})]})}),l.jsx("div",{className:"oc-table-wrap",children:l.jsxs("table",{className:"oc-table",children:[l.jsx("thead",{className:"oc-thead",children:l.jsxs("tr",{className:"oc-tr",children:[l.jsx(Ht,{children:"Caja"}),l.jsx(Ht,{children:"Usuario"}),l.jsx(Ht,{children:"Apertura"}),l.jsx(Ht,{children:"Cierre"}),l.jsx(Ht,{align:"right",children:"Saldo final"})]})}),l.jsx("tbody",{className:"oc-tbody",children:E?l.jsx(TI,{cols:5}):b.length===0?l.jsx("tr",{className:"oc-tr",children:l.jsx("td",{className:"oc-td",colSpan:5,children:l.jsx("span",{className:"oc-muted",children:"Sin cajas cerradas."})})}):b.map(M=>l.jsxs("tr",{className:"oc-tr",children:[l.jsx("td",{className:"oc-td",children:M.nombre}),l.jsx("td",{className:"oc-td",children:M.usuarioNombre}),l.jsx("td",{className:"oc-td",children:M.fechaApertura?M.fechaApertura.toLocaleString("es-CO"):""}),l.jsx("td",{className:"oc-td",children:M.fechaCierre?M.fechaCierre.toLocaleString("es-CO"):""}),l.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Vr(M.saldoActual)]})]},M.id))})]})})]}),Re=()=>l.jsxs("div",{className:"card",children:[l.jsx("h3",{children:"Cierres simulados"}),l.jsx("p",{className:"oc-muted",children:"El cierre hipottico compara ventas y movimientos detectando errores y descuadres con IA. (Conectar fuente de datos para activarlo)."})]}),Me=()=>l.jsxs("div",{className:"card",children:[l.jsx("h3",{children:"Bancos"}),l.jsx("p",{className:"oc-muted",children:"Conciliacin de consignaciones/pagos electrnicos contra caja del da. (Conectar pasarela o extractos para habilitar)."})]}),ke=({m:M})=>l.jsxs("button",{type:"button",onClick:()=>r(M.key),className:`oc-menu-item ${n===M.key?"active":""}`,style:{width:"100%",textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid transparent",background:n===M.key?"var(--oc-surface-2, #f3f6ff)":"transparent",fontWeight:600},title:M.label,children:[l.jsx("span",{style:{opacity:.8,marginRight:6},children:M.icon}),M.label]});return l.jsxs("div",{className:"oc-main-content",style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:16},children:[l.jsx("aside",{className:"card",role:"navigation","aria-label":"Men de caja",style:{height:"fit-content",padding:12},children:l.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:e.map(M=>l.jsx(ke,{m:M},M.key))})}),l.jsxs("section",{children:[l.jsx("div",{className:"card",style:{marginBottom:12,padding:12},children:l.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[l.jsxs("div",{className:"oc-breadcrumb",children:[l.jsx("span",{children:"Caja"}),l.jsx("span",{children:""}),l.jsx("b",{children:(Se=e.find(M=>M.key===n))==null?void 0:Se.label})]}),n==="abiertas"&&l.jsx("input",{ref:c,className:"oc-input",placeholder:"Buscar...",value:o,onChange:M=>a(M.target.value),style:{maxWidth:300}})]})}),n==="abrir"&&l.jsx(ce,{}),n==="abiertas"&&l.jsx(xe,{}),n==="cerradas"&&l.jsx(Ue,{}),n==="mio"&&l.jsx(Ie,{}),n==="simulados"&&l.jsx(Re,{}),n==="bancos"&&l.jsx(Me,{})]})]})}function TI({cols:t=6,n:e=3}){return l.jsx(l.Fragment,{children:Array.from({length:e}).map((n,r)=>l.jsx("tr",{className:"oc-tr",children:Array.from({length:t}).map((s,i)=>l.jsx("td",{className:"oc-td",children:l.jsx("div",{style:{height:12,width:i===0?160:100+i%3*40,background:"var(--oc-skeleton, #e5e7eb)",borderRadius:6}})},i))},r))})}function S6({items:t=[]}){return l.jsxs("div",{className:"card activity-card",children:[l.jsx("h4",{children:"Actividad reciente"}),l.jsx("ul",{className:"activity-list",children:t.map(e=>l.jsxs("li",{children:[l.jsx("strong",{children:e.title}),l.jsx("div",{className:"time",children:e.time})]},e.id))})]})}function C6({status:t}){return t?l.jsxs("div",{className:"card",children:[l.jsx("h4",{children:"Automatizaciones (N8N)"}),l.jsxs("div",{className:"n8n-line",children:[l.jsx("strong",{children:"Conectado:"})," ",t.connected?"S":"No"]}),l.jsxs("div",{className:"n8n-line",children:[l.jsx("strong",{children:"Flujos activos:"})," ",t.flowsRunning]}),t.lastError&&l.jsxs("div",{className:"n8n-error",children:["Error: ",t.lastError]})]}):null}const Gp={es:{nav_home:"Inicio",nav_agenda:"Agenda",nav_patients:"Pacientes",nav_billing:"Facturacin",nav_inventory:"Inventario",nav_odontogram:"Odontograma",nav_reports:"Reportes",nav_cash:"Caja",nav_admin:"Administracin",welcomeTitle:"Bienvenido a OdontoCloud",welcomeSubtitle:"Administra tus pacientes, agenda, inventario y facturacin de manera inteligente y moderna.",clinicLabel:"Clnica",userLabel:"Usuario",roleLabel:"Rol",searchPlaceholder:"Buscar acciones o ir a",stats_patientsToday:"Pacientes totales",stats_appointmentsToday:"Citas hoy",stats_revenueToday:"Facturacin hoy",stats_waiting:"En espera",stats_currency:"COP",n8n_title:"Automatizaciones (n8n)",recent_title:"Actividad reciente",recent_empty:"Sin actividad registrada.",loading:"Cargando...",logout:"Cerrar sesin",module_coming:"Mdulo prximamente.",todays_appts:"Citas de hoy",see_schedule:"Ir a Agenda",no_appts_today:"No hay citas programadas hoy.",at:"a las"},en:{nav_home:"Overview",nav_agenda:"Schedule",nav_patients:"Patients",nav_billing:"Billing",nav_inventory:"Inventory",nav_odontogram:"Odontogram",nav_reports:"Reports",nav_cash:"Cash",nav_admin:"Administration",welcomeTitle:"Welcome to OdontoCloud",welcomeSubtitle:"Manage your patients, schedule, inventory and billing in a smart and modern way.",clinicLabel:"Clinic",userLabel:"User",roleLabel:"Role",searchPlaceholder:"Search actions or go to",stats_patientsToday:"Total patients",stats_appointmentsToday:"Appointments today",stats_revenueToday:"Revenue today",stats_waiting:"In waiting room",stats_currency:"COP",n8n_title:"Automations (n8n)",recent_title:"Recent activity",recent_empty:"No activity yet.",loading:"Loading...",logout:"Log out",module_coming:"Module coming soon.",todays_appts:"Today's appointments",see_schedule:"Open Schedule",no_appts_today:"No appointments today.",at:"at"}},t1=()=>typeof navigator>"u"||(navigator.language||navigator.userLanguage||"es").toLowerCase().startsWith("es")?"es":"en",A6=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},R6=()=>C.useMemo(()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0);return{startToday:qe.fromDate(e),endToday:qe.fromDate(n),startTodayJS:e}},[]),N6=t=>`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,P6=(t,e)=>t.toLocaleTimeString(e==="es"?"es-CO":"en-US",{hour:"2-digit",minute:"2-digit"}),k6=(t,e)=>{try{const[n,r,s]=(t||"").split("-").map(a=>parseInt(a,10)),[i=0,o=0]=(e||"00:00").split(":").map(a=>parseInt(a,10));return new Date(n,(r||1)-1,s||1,i,o,0,0)}catch{return new Date}};function D6({data:t=[]}){const s=Math.max(1,...t.map(d=>Number(d.value)||0)),i=t.length||7,o=10,a=Math.max(16,Math.min(44,(640-o*(i+1))/i)),c=(a+o)*i+o;return l.jsx("div",{style:{width:"100%",overflowX:"auto"},children:l.jsxs("svg",{width:c,height:240,role:"img","aria-label":"Pacientes registrados por da en la ltima semana",children:[[.25,.5,.75,1].map((d,h)=>{const f=18+(1-d)*182;return l.jsx("line",{x1:0,x2:c,y1:f,y2:f,stroke:"#e5e7eb",strokeDasharray:"4 4"},h)}),t.map((d,h)=>{const f=Number(d.value)||0,m=Math.round(f/s*182),_=o+h*(a+o),R=200-m;return l.jsxs("g",{children:[l.jsx("rect",{x:_,y:R,width:a,height:m,rx:"6",ry:"6",fill:f>0?"#0ea5e9":"#cbd5e1",children:l.jsx("title",{children:`${d.label||d.shortLabel||""}  ${f} paciente${f!==1?"s":""}`})}),f>0&&m>14&&l.jsx("text",{x:_+a/2,y:R-6,textAnchor:"middle",fontSize:"11",fill:"#0f172a",children:f}),l.jsx("text",{x:_+a/2,y:214,textAnchor:"middle",fontSize:"11",fill:"#64748b",children:d.shortLabel||""})]},h)})]})})}function j6({onNavigate:t,onAction:e,placeholder:n}){const[r,s]=C.useState(""),[i,o]=C.useState(!1),[a,c]=C.useState(0),d=C.useRef(null),h=C.useMemo(()=>[{group:"Navegacin",label:"Ir a Inicio",keywords:"inicio home overview",run:()=>t==null?void 0:t("Inicio")},{group:"Navegacin",label:"Ir a Agenda",keywords:"agenda calendario schedule",run:()=>t==null?void 0:t("Agenda")},{group:"Navegacin",label:"Ir a Pacientes",keywords:"pacientes",run:()=>t==null?void 0:t("Pacientes")},{group:"Navegacin",label:"Ir a Facturacin",keywords:"facturacion facturas billing",run:()=>t==null?void 0:t("Facturacin")},{group:"Navegacin",label:"Ir a Inventario",keywords:"inventario stock",run:()=>t==null?void 0:t("Inventario")},{group:"Navegacin",label:"Ir a Odontograma",keywords:"odontograma",run:()=>t==null?void 0:t("Odontograma")},{group:"Navegacin",label:"Ir a Reportes",keywords:"reportes informes",run:()=>t==null?void 0:t("Reportes")},{group:"Acciones",label:"Nueva cita",keywords:"nueva cita agendar",run:()=>e==null?void 0:e("new_appointment")},{group:"Acciones",label:"Nuevo paciente",keywords:"nuevo paciente alta",run:()=>e==null?void 0:e("new_patient")},{group:"Acciones",label:"Nueva factura",keywords:"nueva factura",run:()=>e==null?void 0:e("new_invoice")},{group:"Acciones",label:"Exportar agenda",keywords:"exportar agenda",run:()=>e==null?void 0:e("export_agenda")},{group:"Acciones",label:"Ir a hoy (Agenda)",keywords:"hoy today",run:()=>e==null?void 0:e("agenda_today")},{group:"Acciones",label:"Cambiar modo oscuro",keywords:"oscuro dark mode",run:()=>e==null?void 0:e("toggle_dark")},{group:"Acciones",label:"Cerrar sesin",keywords:"logout salir cerrar",run:()=>e==null?void 0:e("logout")},{group:"Ayuda",label:"Ver atajos de teclado",keywords:"atajos ayuda",run:()=>e==null?void 0:e("show_shortcuts")},{group:"Ayuda",label:"Soporte / Contacto",keywords:"soporte ayuda contacto",run:()=>e==null?void 0:e("support")}],[t,e]),f=C.useMemo(()=>{const A=r.toLowerCase().trim();return A?h.filter(N=>N.label.toLowerCase().includes(A)||N.keywords.includes(A)):[]},[r,h]);C.useEffect(()=>{const A=N=>{d.current&&(d.current.contains(N.target)||o(!1))};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]);const m=A=>{var N;(N=A.run)==null||N.call(A),s(""),o(!1)},_=A=>{!i||f.length===0||(A.key==="ArrowDown"&&(A.preventDefault(),c(N=>(N+1)%f.length)),A.key==="ArrowUp"&&(A.preventDefault(),c(N=>(N-1+f.length)%f.length)),A.key==="Enter"&&(A.preventDefault(),f[a]&&m(f[a])),A.key==="Escape"&&o(!1))},R=C.useMemo(()=>{const A=new Map;return f.forEach(N=>{A.has(N.group)||A.set(N.group,[]),A.get(N.group).push(N)}),Array.from(A.entries())},[f]);return l.jsxs("div",{className:"oc-search-wrap",ref:d,children:[l.jsx("input",{className:"oc-search",type:"search",inputMode:"search",placeholder:n,"aria-label":n,value:r,onChange:A=>{s(A.target.value),o(!!A.target.value),c(0)},onFocus:()=>o(!!r),onKeyDown:_}),i&&l.jsx("div",{className:"oc-search-dropdown",role:"listbox","aria-label":"Resultados de comandos",children:R.length===0?l.jsx("div",{className:"oc-search-item empty",children:"Escribe para ver opciones"}):R.map(([A,N])=>l.jsxs("div",{children:[l.jsx("div",{className:"oc-search-group",children:A}),N.map(b=>{const y=f.indexOf(b);return l.jsx("button",{className:`oc-search-item ${y===a?"active":""}`,onMouseEnter:()=>c(y),onClick:()=>m(b),role:"option",children:l.jsx("span",{className:"oc-search-title",children:b.label})},b.label)})]},A))})]})}function O6({open:t,anchorRect:e,onClose:n,onSoon:r,onNavigatePath:s,onSetFactView:i,dark:o}){const[a,c]=C.useState(null),d=C.useRef(null);if(C.useEffect(()=>{if(!t)return;const K=At=>At.key==="Escape"&&(n==null?void 0:n()),We=()=>n==null?void 0:n();return window.addEventListener("keydown",K),window.addEventListener("scroll",We,!0),()=>{window.removeEventListener("keydown",K),window.removeEventListener("scroll",We,!0)}},[t,n]),!t)return null;const h=((e==null?void 0:e.bottom)||60)+8,f=Math.max(12,Math.min(((e==null?void 0:e.left)||300)-160,window.innerWidth-920)),m=10,_=f+360+m,R=o?"#0b1220":"#ffffff",A=o?"#e5e7eb":"#0f172a",N=o?"#0f1a32":"#f3f6ff",b=o?"#1f2a44":"#e2e8f0",y=o?"#b6c1d1":"#475569",E={position:"fixed",top:h,left:f,width:880,maxWidth:"calc(100vw - 24px)",background:R,color:A,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${b}`,zIndex:400,padding:12},I={position:"fixed",top:h,left:_,width:420,maxWidth:"calc(100vw - 24px)",background:R,color:A,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${b}`,zIndex:410,padding:12},O={display:"flex",flexDirection:"column",gap:6,padding:"8px 10px"},F={height:38,borderRadius:10,padding:"0 12px",display:"flex",alignItems:"center",gap:8,fontSize:".92rem",cursor:"pointer",border:"1px solid transparent",background:"transparent",color:A,fontWeight:500,textAlign:"left"},x=(K,We=!0)=>Object.assign(K.currentTarget.style,We?{background:N,borderColor:b}:{background:"transparent",borderColor:"transparent"}),w=()=>{d.current&&clearTimeout(d.current)},v=()=>{w(),d.current=setTimeout(()=>n==null?void 0:n(),180)},P={position:"fixed",top:h,left:f+360,width:m,height:520,zIndex:405},D=[{label:"Recibo de caja",key:"recibo",path:"facturacion/recibo"},{label:"Saldo a favor",key:"saldo",path:"facturacion/saldo"},{label:"Nota crdito",key:"nc",path:"facturacion/nc"},{label:"Nota dbito",key:"nd",path:"facturacion/nd"},{label:"Liquidaciones",key:"liq",path:"facturacion/liq"},{label:"Traslados",key:"tras",path:"facturacion/tras"},{label:"Pagos",key:"pagos",path:"facturacion/pagos"},{label:"rdenes de compra",key:"oc",path:"facturacion/oc"},{label:"Factura de venta",key:"fv",path:"facturacion/facturas"},{label:"Facturas de compra",key:"fc",path:"facturacion/fc"}],j=[{label:"RIPS anteriores (RS-3374)",key:"rips3374"},{label:"RIPS nuevo (RS-2275)",key:"rips2275"}],k=K=>{i==null||i(K.key),s==null||s(K.path),n==null||n()};return l.jsxs(l.Fragment,{children:[l.jsx("div",{onClick:n,style:{position:"fixed",inset:0,background:"transparent",zIndex:399}}),l.jsx("div",{style:E,onMouseEnter:w,onMouseLeave:v,children:l.jsxs("div",{style:{display:"grid",gridTemplateColumns:"360px 1fr",gap:8,alignItems:"start"},children:[l.jsxs("div",{style:O,children:[l.jsx("button",{type:"button",style:F,onMouseEnter:()=>{w(),c("facturacion")},onFocus:()=>{w(),c("facturacion")},onClick:()=>c(K=>K==="facturacion"?null:"facturacion"),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Facturacin "}),l.jsx("button",{type:"button",style:F,onMouseEnter:()=>{w(),c("rips")},onFocus:()=>{w(),c("rips")},onClick:()=>c(K=>K==="rips"?null:"rips"),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" RIPS "}),l.jsx("button",{type:"button",style:F,onClick:()=>s==null?void 0:s("agenda"),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Gestin de agenda"}),l.jsx("button",{type:"button",style:F,onClick:()=>s==null?void 0:s("inventario"),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Inventario"}),l.jsx("button",{type:"button",style:F,onClick:()=>r==null?void 0:r(),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Convenios"}),l.jsx("button",{type:"button",style:F,onClick:()=>r==null?void 0:r(),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Terceros"}),l.jsx("button",{type:"button",style:F,onClick:()=>r==null?void 0:r(),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Campaas"}),l.jsx("button",{type:"button",style:F,onClick:()=>r==null?void 0:r(),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Temperatura y humedad"}),l.jsx("button",{type:"button",style:F,onClick:()=>r==null?void 0:r(),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Residuos"}),l.jsx("button",{type:"button",style:F,onClick:()=>r==null?void 0:r(),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Medicamentos y planes"}),l.jsx("button",{type:"button",style:F,onClick:()=>r==null?void 0:r(),onMouseOver:K=>x(K,!0),onMouseOut:K=>x(K,!1),children:" Esterilizacin"})]}),l.jsx("div",{style:O,children:l.jsxs("div",{style:{fontSize:".85rem",color:y},children:["Accesos rpidos a mdulos de administracin. Pasa el mouse por ",l.jsx("b",{children:"Facturacin"})," o ",l.jsx("b",{children:"RIPS"})," para ver sus acciones."]})})]})}),l.jsx("div",{style:P,onMouseEnter:w,onMouseLeave:v}),a&&l.jsx("div",{style:I,onMouseEnter:w,onMouseLeave:v,children:l.jsx("div",{style:{...O,display:"grid",gridTemplateColumns:"1fr"},children:(a==="facturacion"?D:j).map(K=>l.jsx("button",{type:"button",style:F,onClick:()=>a==="facturacion"?k(K):r==null?void 0:r(),onMouseOver:We=>x(We,!0),onMouseOut:We=>x(We,!1),children:K.label},K.label))})})]})}function L6({t,companyName:e,userName:n,role:r,darkMode:s,weeklySeries:i,weekRangeLabel:o,todaysAppointments:a,todaysLoading:c,metrics:d,metricsLoading:h,n8nState:f,n8nLoading:m,recent:_,recentLoading:R,onGoAgenda:A}){return l.jsxs("div",{className:"oc-main-content",children:[l.jsxs("section",{className:"oc-hero","aria-label":"Resumen general",children:[l.jsxs("div",{className:"oc-hero-text",children:[l.jsx("h1",{children:t("welcomeTitle")}),l.jsx("p",{children:t("welcomeSubtitle")}),l.jsxs("p",{className:"oc-hero-meta",children:[t("clinicLabel"),": ",e,"  ",t("userLabel"),": ",n,"  ",t("roleLabel"),": ",r||""]})]}),l.jsxs("div",{className:"oc-hero-badge","aria-live":"polite",children:[l.jsx("span",{className:"oc-hero-badge-title",children:t("stats_appointmentsToday")}),l.jsx("span",{className:"oc-hero-badge-value",children:h&&c?"":d.citasHoy}),l.jsxs("span",{className:"oc-hero-badge-sub",children:[t("stats_patientsToday"),": ",h?"":d.pacientesHoy]})]})]}),l.jsxs("section",{className:"oc-stats-row","aria-label":"Indicadores del da",children:[l.jsxs("div",{className:"stat-card",children:[l.jsx("span",{className:"stat-label",children:t("stats_patientsToday")}),l.jsx("span",{className:"stat-value",children:d.pacientesHoy})]}),l.jsxs("div",{className:"stat-card",children:[l.jsx("span",{className:"stat-label",children:t("stats_appointmentsToday")}),l.jsx("span",{className:"stat-value",children:d.citasHoy})]}),l.jsxs("div",{className:"stat-card",children:[l.jsx("span",{className:"stat-label",children:t("stats_revenueToday")}),l.jsxs("span",{className:"stat-value",children:[d.facturacionHoy.toLocaleString("es-CO")," ",l.jsx("span",{className:"stat-currency",children:t("stats_currency")})]})]}),l.jsxs("div",{className:"stat-card",children:[l.jsx("span",{className:"stat-label",children:t("stats_waiting")}),l.jsx("span",{className:"stat-value",children:d.enEspera})]})]}),l.jsxs("section",{className:"oc-grid","aria-label":"Contenido principal del dashboard",children:[l.jsx("div",{className:"oc-grid-main",children:l.jsxs("div",{className:"card card-quickcharts",children:[l.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[l.jsx("h3",{children:"Pacientes registrados  ltimos 7 das"}),l.jsx("span",{className:"oc-muted",style:{marginLeft:8,fontSize:12},children:o})]}),i.length===0||i.every(N=>((N==null?void 0:N.value)||0)===0)?l.jsx("p",{className:"oc-weekly-empty",children:"Sin pacientes registrados en la ltima semana."}):l.jsx(D6,{data:i})]})}),l.jsxs("aside",{className:"oc-grid-side","aria-label":"Panel lateral",children:[l.jsxs("div",{className:"card",children:[l.jsx("h3",{children:t("n8n_title")}),m?l.jsx("span",{className:"oc-muted",children:t("loading")}):l.jsx(C6,{status:f})]}),l.jsxs("div",{className:"card",children:[l.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[l.jsx("h3",{children:t("todays_appts")}),l.jsx("button",{className:"oc-small-link",type:"button",onClick:A,children:t("see_schedule")})]}),c?l.jsx("span",{className:"oc-muted",children:t("loading")}):a.length===0?l.jsx("p",{className:"oc-muted",children:t("no_appts_today")}):l.jsx("ul",{className:"oc-list",children:a.slice(0,5).map(N=>l.jsxs("li",{className:"oc-list-item",children:[l.jsxs("div",{className:"oc-list-main",children:[l.jsx("b",{children:N.pacienteNombre||"Paciente"})," ",l.jsxs("span",{className:"oc-muted",children:[t("at")," ",P6(N.fecha,t1())]})]}),l.jsx("div",{className:`oc-tag oc-tag-${(N.estado||"programada").toLowerCase().replace(/\s+/g,"-")}`,children:N.estado||"programada"})]},N.id))})]}),l.jsxs("div",{className:"card",children:[l.jsx("h3",{children:"Actividad reciente"}),R?l.jsx("span",{className:"oc-muted",children:t("loading")}):_.length===0?l.jsx("p",{className:"oc-muted",children:t("recent_empty")}):l.jsx(S6,{items:_})]})]})]}),l.jsxs("footer",{className:"oc-footer",children:[" ",new Date().getFullYear()," OdontoCloud | Creado por Ingeniero Juan Madrid"]})]})}function Kp(){const t=xs(),e=Dn(),[n]=C.useState(t1()),r=G=>Gp[n][G]||G,[s,i]=C.useState("Inicio"),[o,a]=C.useState("recibo"),[c,d]=C.useState(()=>{try{return localStorage.getItem("odontocloud:dark")==="1"}catch{return!1}});C.useEffect(()=>{try{localStorage.setItem("odontocloud:dark",c?"1":"0")}catch{}document.documentElement.classList.toggle("dark",c)},[c]);const[h]=C.useState(()=>A6()),[f]=C.useState((h==null?void 0:h.rol)||""),[m]=C.useState((h==null?void 0:h.email)||""),[_,R]=C.useState("OdontoCloud"),[A,N]=C.useState(m||"Usuario"),[b,y]=C.useState(!0);C.useEffect(()=>{const G=My(Ah,async ae=>{try{if(!ae){N(m||"Usuario"),R("OdontoCloud"),y(!1);return}N(ae.displayName||ae.email||m||"Usuario");const z=ct(ue,"empresas",ae.uid),oe=await za(z);R(oe.exists()&&oe.data().nombre||"OdontoCloud")}catch(z){console.error("Error cargando empresa/usuario:",z)}finally{y(!1)}});return()=>G()},[m]);const[E,I]=C.useState({pacientesHoy:0,citasHoy:0,facturacionHoy:0,enEspera:0}),[O,F]=C.useState(!0),[x,w]=C.useState([]),[v,P]=C.useState([]),[D,j]=C.useState(!0),{startToday:k,endToday:K,startTodayJS:We}=R6(),At=C.useMemo(()=>N6(We),[We]),Qt=C.useMemo(()=>{const G=new Date,ae=new Date(G.getFullYear(),G.getMonth(),G.getDate()-6),z=G,oe=ce=>ce.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit",month:"short"}).replace(".","");return`${oe(ae)}  ${oe(z)}`},[n]),ee=G=>{var xe;const ae=G.data()||{};let z;if((xe=ae.fecha)!=null&&xe.toDate){z=ae.fecha.toDate();const Ie=ae.horaInicio||ae.hora;if(Ie&&typeof Ie=="string"){const[Ue=0,Re=0]=Ie.split(":").map(Me=>parseInt(Me,10));z.setHours(Ue||0,Re||0,0,0)}}else if(typeof ae.fecha=="string"){const Ie=ae.horaInicio||ae.hora||"00:00";z=k6(ae.fecha,Ie)}else z=new Date;const oe=ae.pacienteNombre||ae.paciente||"Paciente",ce=ae.estado&&String(ae.estado)||"programada";return{id:G.id,fecha:z,pacienteId:ae.pacienteId||"",pacienteNombre:oe,estado:ce,motivo:ae.motivo||""}};C.useEffect(()=>{const G=it(Ce(ue,"citas"),Je("fecha",">=",k),Je("fecha","<",K),gn("fecha","asc")),ae=it(Ce(ue,"citas"),Je("fecha","==",At));let z=new Map,oe=!1,ce=!1;const xe=()=>{const Re=Array.from(z.values()).sort((ke,Se)=>ke.fecha.getTime()-Se.fecha.getTime()),Me=Re.filter(ke=>String(ke.estado).toLowerCase().trim()==="en espera").length;P(Re),I(ke=>({...ke,citasHoy:Re.length,enEspera:Me})),oe&&ce&&j(!1)},Ie=Un(G,Re=>{oe=!0;const Me=new Map(z);Re.docs.forEach(ke=>Me.set(ke.id,ee(ke))),z=Me,xe()},Re=>{console.error("Realtime citas hoy (TS):",Re),oe=!0,xe()}),Ue=Un(ae,Re=>{ce=!0;const Me=new Map(z);Re.docs.forEach(ke=>Me.set(ke.id,ee(ke))),z=Me,xe()},Re=>{console.error("Realtime citas hoy (STR):",Re),ce=!0,xe()});return()=>{try{Ie(),Ue()}catch{}}},[k,K,At]),C.useEffect(()=>{(async()=>{try{const z=(await HM(Ce(ue,"pacientes"))).data().count||0;let oe=0;try{const ce=it(Ce(ue,"facturas"),Je("fecha",">=",k),Je("fecha","<",K));(await gt(ce)).forEach(Ie=>{const Ue=Ie.data();typeof Ue.monto=="number"&&(oe+=Ue.monto)})}catch{oe=0}I(ce=>({...ce,pacientesHoy:z,facturacionHoy:oe}))}catch(ae){console.error("Error cargando mtricas:",ae),I(z=>({...z,pacientesHoy:0,facturacionHoy:0}))}finally{F(!1)}})()},[k,K]),C.useEffect(()=>{const G=new Date,ae=new Date(G.getFullYear(),G.getMonth(),G.getDate()-6),z=new Date(G.getFullYear(),G.getMonth(),G.getDate()+1),oe=new Map;for(let Ie=0;Ie<7;Ie++){const Ue=new Date(G.getFullYear(),G.getMonth(),G.getDate()-(6-Ie)),Re=Ue.toISOString().slice(0,10),Me=Ue.toLocaleDateString(n==="es"?"es-ES":"en-US"),ke=Ue.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit"}).replace(".","");oe.set(Re,{label:Me,shortLabel:ke,value:0})}const ce=it(Ce(ue,"pacientes"),Je("createdAt",">=",qe.fromDate(ae)),Je("createdAt","<",qe.fromDate(z))),xe=Un(ce,Ie=>{const Ue=new Map(oe);Ie.docs.forEach(Re=>{var J;const Me=Re.data()||{},ke=(J=Re.data().createdAt)!=null&&J.toDate?Re.data().createdAt.toDate():Me.createdAt?new Date(Me.createdAt):null;if(!ke||isNaN(ke))return;const Se=ke.toISOString().slice(0,10);if(!Ue.has(Se))return;const M=Ue.get(Se);M.value+=1,Ue.set(Se,M)}),w(Array.from(Ue.values()))},Ie=>{console.error("Error realtime serie semanal (pacientes):",Ie),w(Array.from(oe.values()))});return()=>{try{xe()}catch{}}},[n]);const[me,_e]=C.useState([]),[Pe,Ke]=C.useState(!0);C.useEffect(()=>{(async()=>{try{const ae=it(Ce(ue,"actividad"),gn("fecha","desc"),wa(5)),z=await gt(ae);_e(z.docs.map(oe=>({id:oe.id,title:oe.data().descripcion||oe.data().titulo||"Actividad",time:oe.data().resumenTiempo||""})))}catch(ae){console.error("Error cargando actividad:",ae),_e([])}finally{Ke(!1)}})()},[]);const[St,U]=C.useState(null),[ie,B]=C.useState(!0);C.useEffect(()=>{(async()=>{try{const ae=ct(ue,"integraciones","n8n"),z=await za(ae);U(z.exists()?{connected:!!z.data().connected,flowsRunning:z.data().flowsRunning||0,lastError:z.data().lastError||null}:{connected:!1,flowsRunning:0,lastError:null})}catch(ae){console.error("Error cargando estado n8n:",ae),U({connected:!1,flowsRunning:0,lastError:"No se pudo leer el estado desde Firebase."})}finally{B(!1)}})()},[]);const W=async()=>{try{localStorage.removeItem("odc_session")}catch{}try{await Xj(Ah)}catch(G){console.error("Error al cerrar sesin:",G)}window.location.href="/"},[re,ge]=C.useState(!1),[he,Oe]=C.useState(null),fe=C.useRef(null);C.useRef(null);const le=()=>{var ae,z;const G=(z=(ae=fe.current)==null?void 0:ae.getBoundingClientRect)==null?void 0:z.call(ae);Oe(G),ge(!0)};C.useEffect(()=>{const G=e.pathname.toLowerCase(),ae=G.includes("/pacientes"),z=G.includes("/caja"),oe=G.includes("/agenda"),ce=G.includes("/facturacion"),xe=G.includes("/inventario"),Ie=G.includes("/odontograma"),Ue=G.includes("/reportes"),Re=G.includes("/config");i(ae?"Pacientes":z?"Caja":oe?"Agenda":xe?"Inventario":Ie?"Odontograma":Ue?"Reportes":Re?"Config":"Inicio"),ce&&(i("Facturacin"),G.includes("/pagos")?a("pagos"):G.includes("/facturas")?a("fv"):G.includes("/recibo")?a("recibo"):G.includes("/saldo")?a("saldo"):G.includes("/nc")?a("nc"):G.includes("/nd")?a("nd"):G.includes("/liq")?a("liq"):G.includes("/tras")?a("tras"):G.includes("/oc")?a("oc"):G.includes("/fc")?a("fc"):a("recibo"))},[e.pathname]);const De=C.useMemo(()=>{const G=e.pathname.split("/").filter(Boolean),ae=G.findIndex(z=>z.startsWith("dashboard_"));return ae>=0?`/${G.slice(0,ae+1).join("/")}`:""},[e.pathname]),Le=(G="")=>{const ae=String(G).replace(/^\/+|\/+$/g,""),z=ae?`${De}/${ae}`:De||"/",oe=e.pathname.toLowerCase()===z.toLowerCase();t(z,{replace:oe})},nt=()=>{switch(s){case"Agenda":return l.jsx(MU,{});case"Pacientes":return l.jsx(C.Suspense,{fallback:l.jsx("div",{style:{padding:16},children:"Cargando"}),children:l.jsx(QU,{})});case"Facturacin":return l.jsx(FU,{view:o});case"Inventario":return l.jsx(UU,{});case"Odontograma":return l.jsx($U,{});case"Reportes":return l.jsx(JU,{});case"Caja":return l.jsx(T6,{});case"Config":case"Config":return l.jsx(w6,{});case"Inicio":default:return null}};return l.jsxs("div",{className:`oc-shell ${c?"oc-dark":""}`,children:[l.jsx("a",{href:"#oc-main",className:"oc-skip-link",children:"Saltar al contenido"}),l.jsxs("header",{className:"oc-header",role:"banner",children:[l.jsxs("div",{className:"oc-header-left",children:[l.jsx("img",{src:kA,alt:"OdontoCloud",className:"oc-logo"}),l.jsxs("div",{className:"oc-brand-text",children:[l.jsx("span",{className:"oc-brand-main",children:"OdontoCloud"}),l.jsx("span",{className:"oc-brand-sub",children:b?"...":_})]})]}),l.jsxs("nav",{className:"oc-nav",role:"navigation","aria-label":"Navegacin principal",children:[l.jsx(Ho,{to:De,end:!0,className:({isActive:G})=>G&&s==="Inicio"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_home"),children:r("nav_home")}),l.jsx(Ho,{to:`${De}/agenda`,className:({isActive:G})=>G||s==="Agenda"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_agenda"),children:r("nav_agenda")}),l.jsx(Ho,{to:`${De}/pacientes`,className:({isActive:G})=>G||s==="Pacientes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_patients"),children:r("nav_patients")}),l.jsx(Ho,{to:`${De}/caja`,className:({isActive:G})=>G||s==="Caja"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_cash"),children:r("nav_cash")}),l.jsx("button",{type:"button",ref:fe,className:"oc-nav-btn",title:r("nav_admin"),"aria-haspopup":"true","aria-expanded":re,onClick:()=>re?ge(!1):le(),onMouseEnter:()=>le(),onFocus:()=>le(),children:r("nav_admin")}),l.jsx(Ho,{to:`${De}/reportes`,className:({isActive:G})=>G||s==="Reportes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_reports"),children:r("nav_reports")})]}),l.jsxs("div",{className:"oc-header-right",children:[l.jsx(j6,{placeholder:r("searchPlaceholder"),onNavigate:G=>{G==="Inicio"?Le(""):G==="Facturacin"?(a("recibo"),Le("facturacion/recibo")):Le(G.toLowerCase())},onAction:G=>{switch(G){case"new_appointment":case"agenda_today":case"export_agenda":Le("agenda");break;case"new_patient":Le("pacientes");break;case"new_invoice":a("fv"),Le("facturacion/facturas");break;case"toggle_dark":d(ae=>!ae);break;case"logout":W();break;case"show_shortcuts":alert("Atajos: Ctrl/Cmd + K para abrir bsqueda, / para moverse, Enter para ejecutar.");break;case"support":window.open("https://tu-soporte.odc","_blank");break}}}),l.jsx(ZU,{basePath:De,className:"ml-2"}),l.jsx("button",{className:"oc-icon-btn",type:"button",onClick:()=>d(G=>!G),"aria-pressed":c,title:c?"Activar modo claro":"Activar modo oscuro",children:c?"":""}),l.jsx("button",{className:"oc-icon-btn",type:"button",onClick:W,title:Gp[n].logout,children:Gp[n].logout})]})]}),l.jsx(O6,{open:re,anchorRect:he,dark:c,onClose:()=>ge(!1),onSoon:()=>{alert("Prximamente"),ge(!1)},onNavigatePath:G=>{Le(G),ge(!1)},onSetFactView:G=>a(G)}),l.jsxs("main",{id:"oc-main",className:"oc-main-wrapper",role:"main",children:[s!=="Inicio"&&nt(),s==="Inicio"&&l.jsx(L6,{t:r,companyName:_,userName:A,role:f,darkMode:c,weeklySeries:x,weekRangeLabel:Qt,todaysAppointments:v,todaysLoading:D,metrics:E,metricsLoading:O,n8nState:St,n8nLoading:ie,recent:me,recentLoading:Pe,onGoAgenda:()=>Le("agenda")})]})]})}const n1=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},r1=t=>{const e=(t||"").toLowerCase();return e==="administrador"?"/dashboard_admin":e==="doctor"?"/dashboard_doctor":e==="recepcionista"?"/dashboard_recepcion":"/"};function Qp({allowedRoles:t,children:e}){var s;const n=n1();if(!n)return l.jsx(Zd,{to:"/",replace:!0});const r=(s=n.rol)==null?void 0:s.toLowerCase();return t.map(i=>i.toLowerCase()).includes(r)?e:l.jsx(Zd,{to:r1(n.rol),replace:!0})}function V6(){const t=n1();return l.jsxs(VP,{children:[l.jsx(qo,{path:"/",element:t?l.jsx(Zd,{to:r1(t.rol),replace:!0}):l.jsx(f4,{})}),l.jsx(qo,{path:"/dashboard_admin/*",element:l.jsx(Qp,{allowedRoles:["administrador"],children:l.jsx(Kp,{})})}),l.jsx(qo,{path:"/dashboard_doctor/*",element:l.jsx(Qp,{allowedRoles:["doctor"],children:l.jsx(Kp,{})})}),l.jsx(qo,{path:"/dashboard_recepcion/*",element:l.jsx(Qp,{allowedRoles:["recepcionista"],children:l.jsx(Kp,{})})}),l.jsx(qo,{path:"*",element:l.jsx(Zd,{to:"/",replace:!0})})]})}async function M6(){try{await Kj(Ah,KT),await RM(ue),console.log(" Firebase listo con sesin persistente y modo offline.")}catch(t){console.warn(" Firebase offline/persistencia fall:",t.message)}}function F6(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=t;let a,c;const d=async(f=!0)=>{await c};async function h(){if("serviceWorker"in navigator){if(a=await e1(async()=>{const{Workbox:f}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:f}},[]).then(({Workbox:f})=>new f("/odontocloud-react/sw.js",{scope:"/odontocloud-react/",type:"classic"})).catch(f=>{o==null||o(f)}),!a)return;a.addEventListener("activated",f=>{(f.isUpdate||f.isExternal)&&window.location.reload()}),a.addEventListener("installed",f=>{f.isUpdate||r==null||r()}),a.register({immediate:e}).then(f=>{i?i("/odontocloud-react/sw.js",f):s==null||s(f)}).catch(f=>{o==null||o(f)})}}return c=h(),d}const U6="empresa_logo_url",SI="empresa_nombre",$6=C.createContext(null);function B6({children:t}){const[e,n]=C.useState(""),[r,s]=C.useState("OdontoCloud"),[i,o]=C.useState(!0);C.useEffect(()=>{var f;let d="";try{d=localStorage.getItem(U6)||""}catch{}d||(d="/assets/logo.png"),n(d);let h="OdontoCloud";try{h=localStorage.getItem(SI)||((f=document.querySelector('meta[name="company-name"]'))==null?void 0:f.getAttribute("content"))||"OdontoCloud"}catch{}s(h),o(!1)},[]);const c={logoUrl:e,clinicName:r,loading:i,setLogoUrl:n,setClinicName:d=>{const h=d||"OdontoCloud";try{localStorage.setItem(SI,h)}catch{}let f=document.querySelector('meta[name="company-name"]');f||(f=document.createElement("meta"),f.setAttribute("name","company-name"),document.head.appendChild(f)),f.setAttribute("content",h),s(h)}};return l.jsx($6.Provider,{value:c,children:t})}const z6="/odontocloud-react/";M6();F6({immediate:!0});B0(document.getElementById("root")).render(l.jsx(FI.StrictMode,{children:l.jsx(B6,{children:l.jsx(ok,{basename:z6,children:l.jsx(V6,{})})})}));
