(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function F1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Q0={exports:{}},Mh={},Y0={exports:{}},et={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jc=Symbol.for("react.element"),U1=Symbol.for("react.portal"),$1=Symbol.for("react.fragment"),B1=Symbol.for("react.strict_mode"),z1=Symbol.for("react.profiler"),q1=Symbol.for("react.provider"),H1=Symbol.for("react.context"),W1=Symbol.for("react.forward_ref"),G1=Symbol.for("react.suspense"),K1=Symbol.for("react.memo"),Q1=Symbol.for("react.lazy"),K_=Symbol.iterator;function Y1(t){return t===null||typeof t!="object"?null:(t=K_&&t[K_]||t["@@iterator"],typeof t=="function"?t:null)}var X0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},J0=Object.assign,Z0={};function tl(t,e,n){this.props=t,this.context=e,this.refs=Z0,this.updater=n||X0}tl.prototype.isReactComponent={};tl.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};tl.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function eE(){}eE.prototype=tl.prototype;function Ug(t,e,n){this.props=t,this.context=e,this.refs=Z0,this.updater=n||X0}var $g=Ug.prototype=new eE;$g.constructor=Ug;J0($g,tl.prototype);$g.isPureReactComponent=!0;var Q_=Array.isArray,tE=Object.prototype.hasOwnProperty,Bg={current:null},nE={key:!0,ref:!0,__self:!0,__source:!0};function rE(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)tE.call(e,r)&&!nE.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Jc,type:t,key:i,ref:a,props:s,_owner:Bg.current}}function X1(t,e){return{$$typeof:Jc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function zg(t){return typeof t=="object"&&t!==null&&t.$$typeof===Jc}function J1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Y_=/\/+/g;function tp(t,e){return typeof t=="object"&&t!==null&&t.key!=null?J1(""+t.key):e.toString(36)}function od(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Jc:case U1:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+tp(a,0):r,Q_(s)?(n="",t!=null&&(n=t.replace(Y_,"$&/")+"/"),od(s,e,n,"",function(d){return d})):s!=null&&(zg(s)&&(s=X1(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(Y_,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",Q_(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+tp(i,l);a+=od(i,e,n,c,s)}else if(c=Y1(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+tp(i,l++),a+=od(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Au(t,e,n){if(t==null)return t;var r=[],s=0;return od(t,r,"","",function(i){return e.call(n,i,s++)}),r}function Z1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ln={current:null},ad={transition:null},ej={ReactCurrentDispatcher:Ln,ReactCurrentBatchConfig:ad,ReactCurrentOwner:Bg};function sE(){throw Error("act(...) is not supported in production builds of React.")}et.Children={map:Au,forEach:function(t,e,n){Au(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Au(t,function(){e++}),e},toArray:function(t){return Au(t,function(e){return e})||[]},only:function(t){if(!zg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};et.Component=tl;et.Fragment=$1;et.Profiler=z1;et.PureComponent=Ug;et.StrictMode=B1;et.Suspense=G1;et.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ej;et.act=sE;et.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=J0({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=Bg.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)tE.call(e,c)&&!nE.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Jc,type:t.type,key:s,ref:i,props:r,_owner:a}};et.createContext=function(t){return t={$$typeof:H1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:q1,_context:t},t.Consumer=t};et.createElement=rE;et.createFactory=function(t){var e=rE.bind(null,t);return e.type=t,e};et.createRef=function(){return{current:null}};et.forwardRef=function(t){return{$$typeof:W1,render:t}};et.isValidElement=zg;et.lazy=function(t){return{$$typeof:Q1,_payload:{_status:-1,_result:t},_init:Z1}};et.memo=function(t,e){return{$$typeof:K1,type:t,compare:e===void 0?null:e}};et.startTransition=function(t){var e=ad.transition;ad.transition={};try{t()}finally{ad.transition=e}};et.unstable_act=sE;et.useCallback=function(t,e){return Ln.current.useCallback(t,e)};et.useContext=function(t){return Ln.current.useContext(t)};et.useDebugValue=function(){};et.useDeferredValue=function(t){return Ln.current.useDeferredValue(t)};et.useEffect=function(t,e){return Ln.current.useEffect(t,e)};et.useId=function(){return Ln.current.useId()};et.useImperativeHandle=function(t,e,n){return Ln.current.useImperativeHandle(t,e,n)};et.useInsertionEffect=function(t,e){return Ln.current.useInsertionEffect(t,e)};et.useLayoutEffect=function(t,e){return Ln.current.useLayoutEffect(t,e)};et.useMemo=function(t,e){return Ln.current.useMemo(t,e)};et.useReducer=function(t,e,n){return Ln.current.useReducer(t,e,n)};et.useRef=function(t){return Ln.current.useRef(t)};et.useState=function(t){return Ln.current.useState(t)};et.useSyncExternalStore=function(t,e,n){return Ln.current.useSyncExternalStore(t,e,n)};et.useTransition=function(){return Ln.current.useTransition()};et.version="18.3.1";Y0.exports=et;var b=Y0.exports;const Fh=F1(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tj=b,nj=Symbol.for("react.element"),rj=Symbol.for("react.fragment"),sj=Object.prototype.hasOwnProperty,ij=tj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,oj={key:!0,ref:!0,__self:!0,__source:!0};function iE(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)sj.call(e,r)&&!oj.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:nj,type:t,key:i,ref:a,props:s,_owner:ij.current}}Mh.Fragment=rj;Mh.jsx=iE;Mh.jsxs=iE;Q0.exports=Mh;var o=Q0.exports,oE={exports:{}},or={},aE={exports:{}},lE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Q,le){var ce=Q.length;Q.push(le);e:for(;0<ce;){var _e=ce-1>>>1,Ie=Q[_e];if(0<s(Ie,le))Q[_e]=le,Q[ce]=Ie,ce=_e;else break e}}function n(Q){return Q.length===0?null:Q[0]}function r(Q){if(Q.length===0)return null;var le=Q[0],ce=Q.pop();if(ce!==le){Q[0]=ce;e:for(var _e=0,Ie=Q.length,fe=Ie>>>1;_e<fe;){var ye=2*(_e+1)-1,Le=Q[ye],We=ye+1,Re=Q[We];if(0>s(Le,ce))We<Ie&&0>s(Re,Le)?(Q[_e]=Re,Q[We]=ce,_e=We):(Q[_e]=Le,Q[ye]=ce,_e=ye);else if(We<Ie&&0>s(Re,ce))Q[_e]=Re,Q[We]=ce,_e=We;else break e}}return le}function s(Q,le){var ce=Q.sortIndex-le.sortIndex;return ce!==0?ce:Q.id-le.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],d=[],h=1,f=null,m=3,x=!1,T=!1,N=!1,C=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(Q){for(var le=n(d);le!==null;){if(le.callback===null)r(d);else if(le.startTime<=Q)r(d),le.sortIndex=le.expirationTime,e(c,le);else break;le=n(d)}}function _(Q){if(N=!1,g(Q),!T)if(n(c)!==null)T=!0,oe(O);else{var le=n(d);le!==null&&Oe(_,le.startTime-Q)}}function O(Q,le){T=!1,N&&(N=!1,S(w),w=-1),x=!0;var ce=m;try{for(g(le),f=n(c);f!==null&&(!(f.expirationTime>le)||Q&&!P());){var _e=f.callback;if(typeof _e=="function"){f.callback=null,m=f.priorityLevel;var Ie=_e(f.expirationTime<=le);le=t.unstable_now(),typeof Ie=="function"?f.callback=Ie:f===n(c)&&r(c),g(le)}else r(c);f=n(c)}if(f!==null)var fe=!0;else{var ye=n(d);ye!==null&&Oe(_,ye.startTime-le),fe=!1}return fe}finally{f=null,m=ce,x=!1}}var L=!1,v=null,w=-1,I=5,R=-1;function P(){return!(t.unstable_now()-R<I)}function V(){if(v!==null){var Q=t.unstable_now();R=Q;var le=!0;try{le=v(!0,Q)}finally{le?k():(L=!1,v=null)}}else L=!1}var k;if(typeof E=="function")k=function(){E(V)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,ge=M.port2;M.port1.onmessage=V,k=function(){ge.postMessage(null)}}else k=function(){C(V,0)};function oe(Q){v=Q,L||(L=!0,k())}function Oe(Q,le){w=C(function(){Q(t.unstable_now())},le)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Q){Q.callback=null},t.unstable_continueExecution=function(){T||x||(T=!0,oe(O))},t.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<Q?Math.floor(1e3/Q):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(Q){switch(m){case 1:case 2:case 3:var le=3;break;default:le=m}var ce=m;m=le;try{return Q()}finally{m=ce}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Q,le){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var ce=m;m=Q;try{return le()}finally{m=ce}},t.unstable_scheduleCallback=function(Q,le,ce){var _e=t.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?_e+ce:_e):ce=_e,Q){case 1:var Ie=-1;break;case 2:Ie=250;break;case 5:Ie=1073741823;break;case 4:Ie=1e4;break;default:Ie=5e3}return Ie=ce+Ie,Q={id:h++,callback:le,priorityLevel:Q,startTime:ce,expirationTime:Ie,sortIndex:-1},ce>_e?(Q.sortIndex=ce,e(d,Q),n(c)===null&&Q===n(d)&&(N?(S(w),w=-1):N=!0,Oe(_,ce-_e))):(Q.sortIndex=Ie,e(c,Q),T||x||(T=!0,oe(O))),Q},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(Q){var le=m;return function(){var ce=m;m=le;try{return Q.apply(this,arguments)}finally{m=ce}}}})(lE);aE.exports=lE;var aj=aE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lj=b,sr=aj;function re(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var cE=new Set,xc={};function Po(t,e){Da(t,e),Da(t+"Capture",e)}function Da(t,e){for(xc[t]=e,t=0;t<e.length;t++)cE.add(e[t])}var xs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cm=Object.prototype.hasOwnProperty,cj=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,X_={},J_={};function uj(t){return cm.call(J_,t)?!0:cm.call(X_,t)?!1:cj.test(t)?J_[t]=!0:(X_[t]=!0,!1)}function dj(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function hj(t,e,n,r){if(e===null||typeof e>"u"||dj(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Vn(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var pn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){pn[t]=new Vn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];pn[e]=new Vn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){pn[t]=new Vn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){pn[t]=new Vn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){pn[t]=new Vn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){pn[t]=new Vn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){pn[t]=new Vn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){pn[t]=new Vn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){pn[t]=new Vn(t,5,!1,t.toLowerCase(),null,!1,!1)});var qg=/[\-:]([a-z])/g;function Hg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(qg,Hg);pn[e]=new Vn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(qg,Hg);pn[e]=new Vn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(qg,Hg);pn[e]=new Vn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){pn[t]=new Vn(t,1,!1,t.toLowerCase(),null,!1,!1)});pn.xlinkHref=new Vn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){pn[t]=new Vn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Wg(t,e,n,r){var s=pn.hasOwnProperty(e)?pn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(hj(e,n,s,r)&&(n=null),r||s===null?uj(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var As=lj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ru=Symbol.for("react.element"),la=Symbol.for("react.portal"),ca=Symbol.for("react.fragment"),Gg=Symbol.for("react.strict_mode"),um=Symbol.for("react.profiler"),uE=Symbol.for("react.provider"),dE=Symbol.for("react.context"),Kg=Symbol.for("react.forward_ref"),dm=Symbol.for("react.suspense"),hm=Symbol.for("react.suspense_list"),Qg=Symbol.for("react.memo"),qs=Symbol.for("react.lazy"),hE=Symbol.for("react.offscreen"),Z_=Symbol.iterator;function Il(t){return t===null||typeof t!="object"?null:(t=Z_&&t[Z_]||t["@@iterator"],typeof t=="function"?t:null)}var Ot=Object.assign,np;function Bl(t){if(np===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);np=e&&e[1]||""}return`
`+np+t}var rp=!1;function sp(t,e){if(!t||rp)return"";rp=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var c=`
`+s[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=l);break}}}finally{rp=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Bl(t):""}function fj(t){switch(t.tag){case 5:return Bl(t.type);case 16:return Bl("Lazy");case 13:return Bl("Suspense");case 19:return Bl("SuspenseList");case 0:case 2:case 15:return t=sp(t.type,!1),t;case 11:return t=sp(t.type.render,!1),t;case 1:return t=sp(t.type,!0),t;default:return""}}function fm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ca:return"Fragment";case la:return"Portal";case um:return"Profiler";case Gg:return"StrictMode";case dm:return"Suspense";case hm:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case dE:return(t.displayName||"Context")+".Consumer";case uE:return(t._context.displayName||"Context")+".Provider";case Kg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Qg:return e=t.displayName||null,e!==null?e:fm(t.type)||"Memo";case qs:e=t._payload,t=t._init;try{return fm(t(e))}catch{}}return null}function pj(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return fm(e);case 8:return e===Gg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function vi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function fE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function mj(t){var e=fE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Pu(t){t._valueTracker||(t._valueTracker=mj(t))}function pE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=fE(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Vd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function pm(t,e){var n=e.checked;return Ot({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ex(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=vi(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function mE(t,e){e=e.checked,e!=null&&Wg(t,"checked",e,!1)}function mm(t,e){mE(t,e);var n=vi(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?gm(t,e.type,n):e.hasOwnProperty("defaultValue")&&gm(t,e.type,vi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function tx(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function gm(t,e,n){(e!=="number"||Vd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var zl=Array.isArray;function ba(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+vi(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function ym(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(re(91));return Ot({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function nx(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(re(92));if(zl(n)){if(1<n.length)throw Error(re(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:vi(n)}}function gE(t,e){var n=vi(e.value),r=vi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function rx(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function yE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function vm(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?yE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ku,vE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ku=ku||document.createElement("div"),ku.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ku.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function bc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var tc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gj=["Webkit","ms","Moz","O"];Object.keys(tc).forEach(function(t){gj.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),tc[e]=tc[t]})});function _E(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||tc.hasOwnProperty(t)&&tc[t]?(""+e).trim():e+"px"}function xE(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=_E(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var yj=Ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _m(t,e){if(e){if(yj[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(re(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(re(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(re(61))}if(e.style!=null&&typeof e.style!="object")throw Error(re(62))}}function xm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bm=null;function Yg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var wm=null,wa=null,Ea=null;function sx(t){if(t=tu(t)){if(typeof wm!="function")throw Error(re(280));var e=t.stateNode;e&&(e=qh(e),wm(t.stateNode,t.type,e))}}function bE(t){wa?Ea?Ea.push(t):Ea=[t]:wa=t}function wE(){if(wa){var t=wa,e=Ea;if(Ea=wa=null,sx(t),e)for(t=0;t<e.length;t++)sx(e[t])}}function EE(t,e){return t(e)}function IE(){}var ip=!1;function SE(t,e,n){if(ip)return t(e,n);ip=!0;try{return EE(t,e,n)}finally{ip=!1,(wa!==null||Ea!==null)&&(IE(),wE())}}function wc(t,e){var n=t.stateNode;if(n===null)return null;var r=qh(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(re(231,e,typeof n));return n}var Em=!1;if(xs)try{var Sl={};Object.defineProperty(Sl,"passive",{get:function(){Em=!0}}),window.addEventListener("test",Sl,Sl),window.removeEventListener("test",Sl,Sl)}catch{Em=!1}function vj(t,e,n,r,s,i,a,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var nc=!1,Md=null,Fd=!1,Im=null,_j={onError:function(t){nc=!0,Md=t}};function xj(t,e,n,r,s,i,a,l,c){nc=!1,Md=null,vj.apply(_j,arguments)}function bj(t,e,n,r,s,i,a,l,c){if(xj.apply(this,arguments),nc){if(nc){var d=Md;nc=!1,Md=null}else throw Error(re(198));Fd||(Fd=!0,Im=d)}}function ko(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function TE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ix(t){if(ko(t)!==t)throw Error(re(188))}function wj(t){var e=t.alternate;if(!e){if(e=ko(t),e===null)throw Error(re(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return ix(s),t;if(i===r)return ix(s),e;i=i.sibling}throw Error(re(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a)throw Error(re(189))}}if(n.alternate!==r)throw Error(re(190))}if(n.tag!==3)throw Error(re(188));return n.stateNode.current===n?t:e}function CE(t){return t=wj(t),t!==null?NE(t):null}function NE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=NE(t);if(e!==null)return e;t=t.sibling}return null}var jE=sr.unstable_scheduleCallback,ox=sr.unstable_cancelCallback,Ej=sr.unstable_shouldYield,Ij=sr.unstable_requestPaint,Wt=sr.unstable_now,Sj=sr.unstable_getCurrentPriorityLevel,Xg=sr.unstable_ImmediatePriority,AE=sr.unstable_UserBlockingPriority,Ud=sr.unstable_NormalPriority,Tj=sr.unstable_LowPriority,RE=sr.unstable_IdlePriority,Uh=null,Jr=null;function Cj(t){if(Jr&&typeof Jr.onCommitFiberRoot=="function")try{Jr.onCommitFiberRoot(Uh,t,void 0,(t.current.flags&128)===128)}catch{}}var Rr=Math.clz32?Math.clz32:Aj,Nj=Math.log,jj=Math.LN2;function Aj(t){return t>>>=0,t===0?32:31-(Nj(t)/jj|0)|0}var Du=64,Ou=4194304;function ql(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function $d(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~s;l!==0?r=ql(l):(i&=a,i!==0&&(r=ql(i)))}else a=n&~s,a!==0?r=ql(a):i!==0&&(r=ql(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Rr(e),s=1<<n,r|=t[n],e&=~s;return r}function Rj(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pj(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-Rr(i),l=1<<a,c=s[a];c===-1?(!(l&n)||l&r)&&(s[a]=Rj(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Sm(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function PE(){var t=Du;return Du<<=1,!(Du&4194240)&&(Du=64),t}function op(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Zc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Rr(e),t[e]=n}function kj(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Rr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Jg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Rr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var pt=0;function kE(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var DE,Zg,OE,LE,VE,Tm=!1,Lu=[],si=null,ii=null,oi=null,Ec=new Map,Ic=new Map,Ws=[],Dj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ax(t,e){switch(t){case"focusin":case"focusout":si=null;break;case"dragenter":case"dragleave":ii=null;break;case"mouseover":case"mouseout":oi=null;break;case"pointerover":case"pointerout":Ec.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ic.delete(e.pointerId)}}function Tl(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=tu(e),e!==null&&Zg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Oj(t,e,n,r,s){switch(e){case"focusin":return si=Tl(si,t,e,n,r,s),!0;case"dragenter":return ii=Tl(ii,t,e,n,r,s),!0;case"mouseover":return oi=Tl(oi,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Ec.set(i,Tl(Ec.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ic.set(i,Tl(Ic.get(i)||null,t,e,n,r,s)),!0}return!1}function ME(t){var e=Yi(t.target);if(e!==null){var n=ko(e);if(n!==null){if(e=n.tag,e===13){if(e=TE(n),e!==null){t.blockedOn=e,VE(t.priority,function(){OE(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ld(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Cm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);bm=r,n.target.dispatchEvent(r),bm=null}else return e=tu(n),e!==null&&Zg(e),t.blockedOn=n,!1;e.shift()}return!0}function lx(t,e,n){ld(t)&&n.delete(e)}function Lj(){Tm=!1,si!==null&&ld(si)&&(si=null),ii!==null&&ld(ii)&&(ii=null),oi!==null&&ld(oi)&&(oi=null),Ec.forEach(lx),Ic.forEach(lx)}function Cl(t,e){t.blockedOn===e&&(t.blockedOn=null,Tm||(Tm=!0,sr.unstable_scheduleCallback(sr.unstable_NormalPriority,Lj)))}function Sc(t){function e(s){return Cl(s,t)}if(0<Lu.length){Cl(Lu[0],t);for(var n=1;n<Lu.length;n++){var r=Lu[n];r.blockedOn===t&&(r.blockedOn=null)}}for(si!==null&&Cl(si,t),ii!==null&&Cl(ii,t),oi!==null&&Cl(oi,t),Ec.forEach(e),Ic.forEach(e),n=0;n<Ws.length;n++)r=Ws[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ws.length&&(n=Ws[0],n.blockedOn===null);)ME(n),n.blockedOn===null&&Ws.shift()}var Ia=As.ReactCurrentBatchConfig,Bd=!0;function Vj(t,e,n,r){var s=pt,i=Ia.transition;Ia.transition=null;try{pt=1,ey(t,e,n,r)}finally{pt=s,Ia.transition=i}}function Mj(t,e,n,r){var s=pt,i=Ia.transition;Ia.transition=null;try{pt=4,ey(t,e,n,r)}finally{pt=s,Ia.transition=i}}function ey(t,e,n,r){if(Bd){var s=Cm(t,e,n,r);if(s===null)gp(t,e,r,zd,n),ax(t,r);else if(Oj(s,t,e,n,r))r.stopPropagation();else if(ax(t,r),e&4&&-1<Dj.indexOf(t)){for(;s!==null;){var i=tu(s);if(i!==null&&DE(i),i=Cm(t,e,n,r),i===null&&gp(t,e,r,zd,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else gp(t,e,r,null,n)}}var zd=null;function Cm(t,e,n,r){if(zd=null,t=Yg(r),t=Yi(t),t!==null)if(e=ko(t),e===null)t=null;else if(n=e.tag,n===13){if(t=TE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return zd=t,null}function FE(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Sj()){case Xg:return 1;case AE:return 4;case Ud:case Tj:return 16;case RE:return 536870912;default:return 16}default:return 16}}var ti=null,ty=null,cd=null;function UE(){if(cd)return cd;var t,e=ty,n=e.length,r,s="value"in ti?ti.value:ti.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return cd=s.slice(t,1<r?1-r:void 0)}function ud(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Vu(){return!0}function cx(){return!1}function ar(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Vu:cx,this.isPropagationStopped=cx,this}return Ot(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Vu)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Vu)},persist:function(){},isPersistent:Vu}),e}var nl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ny=ar(nl),eu=Ot({},nl,{view:0,detail:0}),Fj=ar(eu),ap,lp,Nl,$h=Ot({},eu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ry,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Nl&&(Nl&&t.type==="mousemove"?(ap=t.screenX-Nl.screenX,lp=t.screenY-Nl.screenY):lp=ap=0,Nl=t),ap)},movementY:function(t){return"movementY"in t?t.movementY:lp}}),ux=ar($h),Uj=Ot({},$h,{dataTransfer:0}),$j=ar(Uj),Bj=Ot({},eu,{relatedTarget:0}),cp=ar(Bj),zj=Ot({},nl,{animationName:0,elapsedTime:0,pseudoElement:0}),qj=ar(zj),Hj=Ot({},nl,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Wj=ar(Hj),Gj=Ot({},nl,{data:0}),dx=ar(Gj),Kj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xj(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Yj[t])?!!e[t]:!1}function ry(){return Xj}var Jj=Ot({},eu,{key:function(t){if(t.key){var e=Kj[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ud(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Qj[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ry,charCode:function(t){return t.type==="keypress"?ud(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ud(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Zj=ar(Jj),eA=Ot({},$h,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hx=ar(eA),tA=Ot({},eu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ry}),nA=ar(tA),rA=Ot({},nl,{propertyName:0,elapsedTime:0,pseudoElement:0}),sA=ar(rA),iA=Ot({},$h,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),oA=ar(iA),aA=[9,13,27,32],sy=xs&&"CompositionEvent"in window,rc=null;xs&&"documentMode"in document&&(rc=document.documentMode);var lA=xs&&"TextEvent"in window&&!rc,$E=xs&&(!sy||rc&&8<rc&&11>=rc),fx=" ",px=!1;function BE(t,e){switch(t){case"keyup":return aA.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zE(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ua=!1;function cA(t,e){switch(t){case"compositionend":return zE(e);case"keypress":return e.which!==32?null:(px=!0,fx);case"textInput":return t=e.data,t===fx&&px?null:t;default:return null}}function uA(t,e){if(ua)return t==="compositionend"||!sy&&BE(t,e)?(t=UE(),cd=ty=ti=null,ua=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return $E&&e.locale!=="ko"?null:e.data;default:return null}}var dA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!dA[t.type]:e==="textarea"}function qE(t,e,n,r){bE(r),e=qd(e,"onChange"),0<e.length&&(n=new ny("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var sc=null,Tc=null;function hA(t){tI(t,0)}function Bh(t){var e=fa(t);if(pE(e))return t}function fA(t,e){if(t==="change")return e}var HE=!1;if(xs){var up;if(xs){var dp="oninput"in document;if(!dp){var gx=document.createElement("div");gx.setAttribute("oninput","return;"),dp=typeof gx.oninput=="function"}up=dp}else up=!1;HE=up&&(!document.documentMode||9<document.documentMode)}function yx(){sc&&(sc.detachEvent("onpropertychange",WE),Tc=sc=null)}function WE(t){if(t.propertyName==="value"&&Bh(Tc)){var e=[];qE(e,Tc,t,Yg(t)),SE(hA,e)}}function pA(t,e,n){t==="focusin"?(yx(),sc=e,Tc=n,sc.attachEvent("onpropertychange",WE)):t==="focusout"&&yx()}function mA(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Bh(Tc)}function gA(t,e){if(t==="click")return Bh(e)}function yA(t,e){if(t==="input"||t==="change")return Bh(e)}function vA(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Dr=typeof Object.is=="function"?Object.is:vA;function Cc(t,e){if(Dr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!cm.call(e,s)||!Dr(t[s],e[s]))return!1}return!0}function vx(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function _x(t,e){var n=vx(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=vx(n)}}function GE(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?GE(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function KE(){for(var t=window,e=Vd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Vd(t.document)}return e}function iy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function _A(t){var e=KE(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&GE(n.ownerDocument.documentElement,n)){if(r!==null&&iy(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=_x(n,i);var a=_x(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var xA=xs&&"documentMode"in document&&11>=document.documentMode,da=null,Nm=null,ic=null,jm=!1;function xx(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;jm||da==null||da!==Vd(r)||(r=da,"selectionStart"in r&&iy(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ic&&Cc(ic,r)||(ic=r,r=qd(Nm,"onSelect"),0<r.length&&(e=new ny("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=da)))}function Mu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ha={animationend:Mu("Animation","AnimationEnd"),animationiteration:Mu("Animation","AnimationIteration"),animationstart:Mu("Animation","AnimationStart"),transitionend:Mu("Transition","TransitionEnd")},hp={},QE={};xs&&(QE=document.createElement("div").style,"AnimationEvent"in window||(delete ha.animationend.animation,delete ha.animationiteration.animation,delete ha.animationstart.animation),"TransitionEvent"in window||delete ha.transitionend.transition);function zh(t){if(hp[t])return hp[t];if(!ha[t])return t;var e=ha[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in QE)return hp[t]=e[n];return t}var YE=zh("animationend"),XE=zh("animationiteration"),JE=zh("animationstart"),ZE=zh("transitionend"),eI=new Map,bx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Si(t,e){eI.set(t,e),Po(e,[t])}for(var fp=0;fp<bx.length;fp++){var pp=bx[fp],bA=pp.toLowerCase(),wA=pp[0].toUpperCase()+pp.slice(1);Si(bA,"on"+wA)}Si(YE,"onAnimationEnd");Si(XE,"onAnimationIteration");Si(JE,"onAnimationStart");Si("dblclick","onDoubleClick");Si("focusin","onFocus");Si("focusout","onBlur");Si(ZE,"onTransitionEnd");Da("onMouseEnter",["mouseout","mouseover"]);Da("onMouseLeave",["mouseout","mouseover"]);Da("onPointerEnter",["pointerout","pointerover"]);Da("onPointerLeave",["pointerout","pointerover"]);Po("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Po("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Po("onBeforeInput",["compositionend","keypress","textInput","paste"]);Po("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Po("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Po("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),EA=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hl));function wx(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,bj(r,e,void 0,t),t.currentTarget=null}function tI(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;wx(s,l,d),i=c}else for(a=0;a<r.length;a++){if(l=r[a],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;wx(s,l,d),i=c}}}if(Fd)throw t=Im,Fd=!1,Im=null,t}function Et(t,e){var n=e[Dm];n===void 0&&(n=e[Dm]=new Set);var r=t+"__bubble";n.has(r)||(nI(e,t,2,!1),n.add(r))}function mp(t,e,n){var r=0;e&&(r|=4),nI(n,t,r,e)}var Fu="_reactListening"+Math.random().toString(36).slice(2);function Nc(t){if(!t[Fu]){t[Fu]=!0,cE.forEach(function(n){n!=="selectionchange"&&(EA.has(n)||mp(n,!1,t),mp(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Fu]||(e[Fu]=!0,mp("selectionchange",!1,e))}}function nI(t,e,n,r){switch(FE(e)){case 1:var s=Vj;break;case 4:s=Mj;break;default:s=ey}n=s.bind(null,e,n,t),s=void 0,!Em||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function gp(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;a=a.return}for(;l!==null;){if(a=Yi(l),a===null)return;if(c=a.tag,c===5||c===6){r=i=a;continue e}l=l.parentNode}}r=r.return}SE(function(){var d=i,h=Yg(n),f=[];e:{var m=eI.get(t);if(m!==void 0){var x=ny,T=t;switch(t){case"keypress":if(ud(n)===0)break e;case"keydown":case"keyup":x=Zj;break;case"focusin":T="focus",x=cp;break;case"focusout":T="blur",x=cp;break;case"beforeblur":case"afterblur":x=cp;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=ux;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=$j;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=nA;break;case YE:case XE:case JE:x=qj;break;case ZE:x=sA;break;case"scroll":x=Fj;break;case"wheel":x=oA;break;case"copy":case"cut":case"paste":x=Wj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=hx}var N=(e&4)!==0,C=!N&&t==="scroll",S=N?m!==null?m+"Capture":null:m;N=[];for(var E=d,g;E!==null;){g=E;var _=g.stateNode;if(g.tag===5&&_!==null&&(g=_,S!==null&&(_=wc(E,S),_!=null&&N.push(jc(E,_,g)))),C)break;E=E.return}0<N.length&&(m=new x(m,T,null,n,h),f.push({event:m,listeners:N}))}}if(!(e&7)){e:{if(m=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",m&&n!==bm&&(T=n.relatedTarget||n.fromElement)&&(Yi(T)||T[bs]))break e;if((x||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,x?(T=n.relatedTarget||n.toElement,x=d,T=T?Yi(T):null,T!==null&&(C=ko(T),T!==C||T.tag!==5&&T.tag!==6)&&(T=null)):(x=null,T=d),x!==T)){if(N=ux,_="onMouseLeave",S="onMouseEnter",E="mouse",(t==="pointerout"||t==="pointerover")&&(N=hx,_="onPointerLeave",S="onPointerEnter",E="pointer"),C=x==null?m:fa(x),g=T==null?m:fa(T),m=new N(_,E+"leave",x,n,h),m.target=C,m.relatedTarget=g,_=null,Yi(h)===d&&(N=new N(S,E+"enter",T,n,h),N.target=g,N.relatedTarget=C,_=N),C=_,x&&T)t:{for(N=x,S=T,E=0,g=N;g;g=Bo(g))E++;for(g=0,_=S;_;_=Bo(_))g++;for(;0<E-g;)N=Bo(N),E--;for(;0<g-E;)S=Bo(S),g--;for(;E--;){if(N===S||S!==null&&N===S.alternate)break t;N=Bo(N),S=Bo(S)}N=null}else N=null;x!==null&&Ex(f,m,x,N,!1),T!==null&&C!==null&&Ex(f,C,T,N,!0)}}e:{if(m=d?fa(d):window,x=m.nodeName&&m.nodeName.toLowerCase(),x==="select"||x==="input"&&m.type==="file")var O=fA;else if(mx(m))if(HE)O=yA;else{O=mA;var L=pA}else(x=m.nodeName)&&x.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(O=gA);if(O&&(O=O(t,d))){qE(f,O,n,h);break e}L&&L(t,m,d),t==="focusout"&&(L=m._wrapperState)&&L.controlled&&m.type==="number"&&gm(m,"number",m.value)}switch(L=d?fa(d):window,t){case"focusin":(mx(L)||L.contentEditable==="true")&&(da=L,Nm=d,ic=null);break;case"focusout":ic=Nm=da=null;break;case"mousedown":jm=!0;break;case"contextmenu":case"mouseup":case"dragend":jm=!1,xx(f,n,h);break;case"selectionchange":if(xA)break;case"keydown":case"keyup":xx(f,n,h)}var v;if(sy)e:{switch(t){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else ua?BE(t,n)&&(w="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(w="onCompositionStart");w&&($E&&n.locale!=="ko"&&(ua||w!=="onCompositionStart"?w==="onCompositionEnd"&&ua&&(v=UE()):(ti=h,ty="value"in ti?ti.value:ti.textContent,ua=!0)),L=qd(d,w),0<L.length&&(w=new dx(w,t,null,n,h),f.push({event:w,listeners:L}),v?w.data=v:(v=zE(n),v!==null&&(w.data=v)))),(v=lA?cA(t,n):uA(t,n))&&(d=qd(d,"onBeforeInput"),0<d.length&&(h=new dx("onBeforeInput","beforeinput",null,n,h),f.push({event:h,listeners:d}),h.data=v))}tI(f,e)})}function jc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function qd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=wc(t,n),i!=null&&r.unshift(jc(t,i,s)),i=wc(t,e),i!=null&&r.push(jc(t,i,s))),t=t.return}return r}function Bo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ex(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=wc(n,i),c!=null&&a.unshift(jc(n,c,l))):s||(c=wc(n,i),c!=null&&a.push(jc(n,c,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var IA=/\r\n?/g,SA=/\u0000|\uFFFD/g;function Ix(t){return(typeof t=="string"?t:""+t).replace(IA,`
`).replace(SA,"")}function Uu(t,e,n){if(e=Ix(e),Ix(t)!==e&&n)throw Error(re(425))}function Hd(){}var Am=null,Rm=null;function Pm(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var km=typeof setTimeout=="function"?setTimeout:void 0,TA=typeof clearTimeout=="function"?clearTimeout:void 0,Sx=typeof Promise=="function"?Promise:void 0,CA=typeof queueMicrotask=="function"?queueMicrotask:typeof Sx<"u"?function(t){return Sx.resolve(null).then(t).catch(NA)}:km;function NA(t){setTimeout(function(){throw t})}function yp(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Sc(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Sc(e)}function ai(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Tx(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var rl=Math.random().toString(36).slice(2),Kr="__reactFiber$"+rl,Ac="__reactProps$"+rl,bs="__reactContainer$"+rl,Dm="__reactEvents$"+rl,jA="__reactListeners$"+rl,AA="__reactHandles$"+rl;function Yi(t){var e=t[Kr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[bs]||n[Kr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Tx(t);t!==null;){if(n=t[Kr])return n;t=Tx(t)}return e}t=n,n=t.parentNode}return null}function tu(t){return t=t[Kr]||t[bs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function fa(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(re(33))}function qh(t){return t[Ac]||null}var Om=[],pa=-1;function Ti(t){return{current:t}}function It(t){0>pa||(t.current=Om[pa],Om[pa]=null,pa--)}function _t(t,e){pa++,Om[pa]=t.current,t.current=e}var _i={},Cn=Ti(_i),qn=Ti(!1),uo=_i;function Oa(t,e){var n=t.type.contextTypes;if(!n)return _i;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Hn(t){return t=t.childContextTypes,t!=null}function Wd(){It(qn),It(Cn)}function Cx(t,e,n){if(Cn.current!==_i)throw Error(re(168));_t(Cn,e),_t(qn,n)}function rI(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(re(108,pj(t)||"Unknown",s));return Ot({},n,r)}function Gd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||_i,uo=Cn.current,_t(Cn,t),_t(qn,qn.current),!0}function Nx(t,e,n){var r=t.stateNode;if(!r)throw Error(re(169));n?(t=rI(t,e,uo),r.__reactInternalMemoizedMergedChildContext=t,It(qn),It(Cn),_t(Cn,t)):It(qn),_t(qn,n)}var hs=null,Hh=!1,vp=!1;function sI(t){hs===null?hs=[t]:hs.push(t)}function RA(t){Hh=!0,sI(t)}function Ci(){if(!vp&&hs!==null){vp=!0;var t=0,e=pt;try{var n=hs;for(pt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}hs=null,Hh=!1}catch(s){throw hs!==null&&(hs=hs.slice(t+1)),jE(Xg,Ci),s}finally{pt=e,vp=!1}}return null}var ma=[],ga=0,Kd=null,Qd=0,lr=[],cr=0,ho=null,fs=1,ps="";function Ui(t,e){ma[ga++]=Qd,ma[ga++]=Kd,Kd=t,Qd=e}function iI(t,e,n){lr[cr++]=fs,lr[cr++]=ps,lr[cr++]=ho,ho=t;var r=fs;t=ps;var s=32-Rr(r)-1;r&=~(1<<s),n+=1;var i=32-Rr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,fs=1<<32-Rr(e)+s|n<<s|r,ps=i+t}else fs=1<<i|n<<s|r,ps=t}function oy(t){t.return!==null&&(Ui(t,1),iI(t,1,0))}function ay(t){for(;t===Kd;)Kd=ma[--ga],ma[ga]=null,Qd=ma[--ga],ma[ga]=null;for(;t===ho;)ho=lr[--cr],lr[cr]=null,ps=lr[--cr],lr[cr]=null,fs=lr[--cr],lr[cr]=null}var nr=null,er=null,Ct=!1,Nr=null;function oI(t,e){var n=hr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function jx(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,nr=t,er=ai(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,nr=t,er=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ho!==null?{id:fs,overflow:ps}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=hr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,nr=t,er=null,!0):!1;default:return!1}}function Lm(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Vm(t){if(Ct){var e=er;if(e){var n=e;if(!jx(t,e)){if(Lm(t))throw Error(re(418));e=ai(n.nextSibling);var r=nr;e&&jx(t,e)?oI(r,n):(t.flags=t.flags&-4097|2,Ct=!1,nr=t)}}else{if(Lm(t))throw Error(re(418));t.flags=t.flags&-4097|2,Ct=!1,nr=t}}}function Ax(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;nr=t}function $u(t){if(t!==nr)return!1;if(!Ct)return Ax(t),Ct=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Pm(t.type,t.memoizedProps)),e&&(e=er)){if(Lm(t))throw aI(),Error(re(418));for(;e;)oI(t,e),e=ai(e.nextSibling)}if(Ax(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(re(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){er=ai(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}er=null}}else er=nr?ai(t.stateNode.nextSibling):null;return!0}function aI(){for(var t=er;t;)t=ai(t.nextSibling)}function La(){er=nr=null,Ct=!1}function ly(t){Nr===null?Nr=[t]:Nr.push(t)}var PA=As.ReactCurrentBatchConfig;function jl(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(re(309));var r=n.stateNode}if(!r)throw Error(re(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(re(284));if(!n._owner)throw Error(re(290,t))}return t}function Bu(t,e){throw t=Object.prototype.toString.call(e),Error(re(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Rx(t){var e=t._init;return e(t._payload)}function lI(t){function e(S,E){if(t){var g=S.deletions;g===null?(S.deletions=[E],S.flags|=16):g.push(E)}}function n(S,E){if(!t)return null;for(;E!==null;)e(S,E),E=E.sibling;return null}function r(S,E){for(S=new Map;E!==null;)E.key!==null?S.set(E.key,E):S.set(E.index,E),E=E.sibling;return S}function s(S,E){return S=di(S,E),S.index=0,S.sibling=null,S}function i(S,E,g){return S.index=g,t?(g=S.alternate,g!==null?(g=g.index,g<E?(S.flags|=2,E):g):(S.flags|=2,E)):(S.flags|=1048576,E)}function a(S){return t&&S.alternate===null&&(S.flags|=2),S}function l(S,E,g,_){return E===null||E.tag!==6?(E=Sp(g,S.mode,_),E.return=S,E):(E=s(E,g),E.return=S,E)}function c(S,E,g,_){var O=g.type;return O===ca?h(S,E,g.props.children,_,g.key):E!==null&&(E.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===qs&&Rx(O)===E.type)?(_=s(E,g.props),_.ref=jl(S,E,g),_.return=S,_):(_=yd(g.type,g.key,g.props,null,S.mode,_),_.ref=jl(S,E,g),_.return=S,_)}function d(S,E,g,_){return E===null||E.tag!==4||E.stateNode.containerInfo!==g.containerInfo||E.stateNode.implementation!==g.implementation?(E=Tp(g,S.mode,_),E.return=S,E):(E=s(E,g.children||[]),E.return=S,E)}function h(S,E,g,_,O){return E===null||E.tag!==7?(E=ro(g,S.mode,_,O),E.return=S,E):(E=s(E,g),E.return=S,E)}function f(S,E,g){if(typeof E=="string"&&E!==""||typeof E=="number")return E=Sp(""+E,S.mode,g),E.return=S,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Ru:return g=yd(E.type,E.key,E.props,null,S.mode,g),g.ref=jl(S,null,E),g.return=S,g;case la:return E=Tp(E,S.mode,g),E.return=S,E;case qs:var _=E._init;return f(S,_(E._payload),g)}if(zl(E)||Il(E))return E=ro(E,S.mode,g,null),E.return=S,E;Bu(S,E)}return null}function m(S,E,g,_){var O=E!==null?E.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return O!==null?null:l(S,E,""+g,_);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Ru:return g.key===O?c(S,E,g,_):null;case la:return g.key===O?d(S,E,g,_):null;case qs:return O=g._init,m(S,E,O(g._payload),_)}if(zl(g)||Il(g))return O!==null?null:h(S,E,g,_,null);Bu(S,g)}return null}function x(S,E,g,_,O){if(typeof _=="string"&&_!==""||typeof _=="number")return S=S.get(g)||null,l(E,S,""+_,O);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Ru:return S=S.get(_.key===null?g:_.key)||null,c(E,S,_,O);case la:return S=S.get(_.key===null?g:_.key)||null,d(E,S,_,O);case qs:var L=_._init;return x(S,E,g,L(_._payload),O)}if(zl(_)||Il(_))return S=S.get(g)||null,h(E,S,_,O,null);Bu(E,_)}return null}function T(S,E,g,_){for(var O=null,L=null,v=E,w=E=0,I=null;v!==null&&w<g.length;w++){v.index>w?(I=v,v=null):I=v.sibling;var R=m(S,v,g[w],_);if(R===null){v===null&&(v=I);break}t&&v&&R.alternate===null&&e(S,v),E=i(R,E,w),L===null?O=R:L.sibling=R,L=R,v=I}if(w===g.length)return n(S,v),Ct&&Ui(S,w),O;if(v===null){for(;w<g.length;w++)v=f(S,g[w],_),v!==null&&(E=i(v,E,w),L===null?O=v:L.sibling=v,L=v);return Ct&&Ui(S,w),O}for(v=r(S,v);w<g.length;w++)I=x(v,S,w,g[w],_),I!==null&&(t&&I.alternate!==null&&v.delete(I.key===null?w:I.key),E=i(I,E,w),L===null?O=I:L.sibling=I,L=I);return t&&v.forEach(function(P){return e(S,P)}),Ct&&Ui(S,w),O}function N(S,E,g,_){var O=Il(g);if(typeof O!="function")throw Error(re(150));if(g=O.call(g),g==null)throw Error(re(151));for(var L=O=null,v=E,w=E=0,I=null,R=g.next();v!==null&&!R.done;w++,R=g.next()){v.index>w?(I=v,v=null):I=v.sibling;var P=m(S,v,R.value,_);if(P===null){v===null&&(v=I);break}t&&v&&P.alternate===null&&e(S,v),E=i(P,E,w),L===null?O=P:L.sibling=P,L=P,v=I}if(R.done)return n(S,v),Ct&&Ui(S,w),O;if(v===null){for(;!R.done;w++,R=g.next())R=f(S,R.value,_),R!==null&&(E=i(R,E,w),L===null?O=R:L.sibling=R,L=R);return Ct&&Ui(S,w),O}for(v=r(S,v);!R.done;w++,R=g.next())R=x(v,S,w,R.value,_),R!==null&&(t&&R.alternate!==null&&v.delete(R.key===null?w:R.key),E=i(R,E,w),L===null?O=R:L.sibling=R,L=R);return t&&v.forEach(function(V){return e(S,V)}),Ct&&Ui(S,w),O}function C(S,E,g,_){if(typeof g=="object"&&g!==null&&g.type===ca&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case Ru:e:{for(var O=g.key,L=E;L!==null;){if(L.key===O){if(O=g.type,O===ca){if(L.tag===7){n(S,L.sibling),E=s(L,g.props.children),E.return=S,S=E;break e}}else if(L.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===qs&&Rx(O)===L.type){n(S,L.sibling),E=s(L,g.props),E.ref=jl(S,L,g),E.return=S,S=E;break e}n(S,L);break}else e(S,L);L=L.sibling}g.type===ca?(E=ro(g.props.children,S.mode,_,g.key),E.return=S,S=E):(_=yd(g.type,g.key,g.props,null,S.mode,_),_.ref=jl(S,E,g),_.return=S,S=_)}return a(S);case la:e:{for(L=g.key;E!==null;){if(E.key===L)if(E.tag===4&&E.stateNode.containerInfo===g.containerInfo&&E.stateNode.implementation===g.implementation){n(S,E.sibling),E=s(E,g.children||[]),E.return=S,S=E;break e}else{n(S,E);break}else e(S,E);E=E.sibling}E=Tp(g,S.mode,_),E.return=S,S=E}return a(S);case qs:return L=g._init,C(S,E,L(g._payload),_)}if(zl(g))return T(S,E,g,_);if(Il(g))return N(S,E,g,_);Bu(S,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,E!==null&&E.tag===6?(n(S,E.sibling),E=s(E,g),E.return=S,S=E):(n(S,E),E=Sp(g,S.mode,_),E.return=S,S=E),a(S)):n(S,E)}return C}var Va=lI(!0),cI=lI(!1),Yd=Ti(null),Xd=null,ya=null,cy=null;function uy(){cy=ya=Xd=null}function dy(t){var e=Yd.current;It(Yd),t._currentValue=e}function Mm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Sa(t,e){Xd=t,cy=ya=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Bn=!0),t.firstContext=null)}function gr(t){var e=t._currentValue;if(cy!==t)if(t={context:t,memoizedValue:e,next:null},ya===null){if(Xd===null)throw Error(re(308));ya=t,Xd.dependencies={lanes:0,firstContext:t}}else ya=ya.next=t;return e}var Xi=null;function hy(t){Xi===null?Xi=[t]:Xi.push(t)}function uI(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,hy(e)):(n.next=s.next,s.next=n),e.interleaved=n,ws(t,r)}function ws(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Hs=!1;function fy(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function vs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function li(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,at&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ws(t,n)}return s=r.interleaved,s===null?(e.next=e,hy(r)):(e.next=s.next,s.next=e),r.interleaved=e,ws(t,n)}function dd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jg(t,n)}}function Px(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Jd(t,e,n,r){var s=t.updateQueue;Hs=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var h=t.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==a&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(i!==null){var f=s.baseState;a=0,h=d=c=null,l=i;do{var m=l.lane,x=l.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var T=t,N=l;switch(m=e,x=n,N.tag){case 1:if(T=N.payload,typeof T=="function"){f=T.call(x,f,m);break e}f=T;break e;case 3:T.flags=T.flags&-65537|128;case 0:if(T=N.payload,m=typeof T=="function"?T.call(x,f,m):T,m==null)break e;f=Ot({},f,m);break e;case 2:Hs=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,m=s.effects,m===null?s.effects=[l]:m.push(l))}else x={eventTime:x,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=x,c=f):h=h.next=x,a|=m;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;m=l,l=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(!0);if(h===null&&(c=f),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);po|=a,t.lanes=a,t.memoizedState=f}}function kx(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(re(191,s));s.call(r)}}}var nu={},Zr=Ti(nu),Rc=Ti(nu),Pc=Ti(nu);function Ji(t){if(t===nu)throw Error(re(174));return t}function py(t,e){switch(_t(Pc,e),_t(Rc,t),_t(Zr,nu),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:vm(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=vm(e,t)}It(Zr),_t(Zr,e)}function Ma(){It(Zr),It(Rc),It(Pc)}function hI(t){Ji(Pc.current);var e=Ji(Zr.current),n=vm(e,t.type);e!==n&&(_t(Rc,t),_t(Zr,n))}function my(t){Rc.current===t&&(It(Zr),It(Rc))}var Rt=Ti(0);function Zd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _p=[];function gy(){for(var t=0;t<_p.length;t++)_p[t]._workInProgressVersionPrimary=null;_p.length=0}var hd=As.ReactCurrentDispatcher,xp=As.ReactCurrentBatchConfig,fo=0,Dt=null,Jt=null,on=null,eh=!1,oc=!1,kc=0,kA=0;function yn(){throw Error(re(321))}function yy(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Dr(t[n],e[n]))return!1;return!0}function vy(t,e,n,r,s,i){if(fo=i,Dt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,hd.current=t===null||t.memoizedState===null?VA:MA,t=n(r,s),oc){i=0;do{if(oc=!1,kc=0,25<=i)throw Error(re(301));i+=1,on=Jt=null,e.updateQueue=null,hd.current=FA,t=n(r,s)}while(oc)}if(hd.current=th,e=Jt!==null&&Jt.next!==null,fo=0,on=Jt=Dt=null,eh=!1,e)throw Error(re(300));return t}function _y(){var t=kc!==0;return kc=0,t}function Wr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return on===null?Dt.memoizedState=on=t:on=on.next=t,on}function yr(){if(Jt===null){var t=Dt.alternate;t=t!==null?t.memoizedState:null}else t=Jt.next;var e=on===null?Dt.memoizedState:on.next;if(e!==null)on=e,Jt=t;else{if(t===null)throw Error(re(310));Jt=t,t={memoizedState:Jt.memoizedState,baseState:Jt.baseState,baseQueue:Jt.baseQueue,queue:Jt.queue,next:null},on===null?Dt.memoizedState=on=t:on=on.next=t}return on}function Dc(t,e){return typeof e=="function"?e(t):e}function bp(t){var e=yr(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var r=Jt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,c=null,d=i;do{var h=d.lane;if((fo&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=f,a=r):c=c.next=f,Dt.lanes|=h,po|=h}d=d.next}while(d!==null&&d!==i);c===null?a=r:c.next=l,Dr(r,e.memoizedState)||(Bn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Dt.lanes|=i,po|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function wp(t){var e=yr(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);Dr(i,e.memoizedState)||(Bn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function fI(){}function pI(t,e){var n=Dt,r=yr(),s=e(),i=!Dr(r.memoizedState,s);if(i&&(r.memoizedState=s,Bn=!0),r=r.queue,xy(yI.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||on!==null&&on.memoizedState.tag&1){if(n.flags|=2048,Oc(9,gI.bind(null,n,r,s,e),void 0,null),ln===null)throw Error(re(349));fo&30||mI(n,e,s)}return s}function mI(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Dt.updateQueue,e===null?(e={lastEffect:null,stores:null},Dt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function gI(t,e,n,r){e.value=n,e.getSnapshot=r,vI(e)&&_I(t)}function yI(t,e,n){return n(function(){vI(e)&&_I(t)})}function vI(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Dr(t,n)}catch{return!0}}function _I(t){var e=ws(t,1);e!==null&&Pr(e,t,1,-1)}function Dx(t){var e=Wr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Dc,lastRenderedState:t},e.queue=t,t=t.dispatch=LA.bind(null,Dt,t),[e.memoizedState,t]}function Oc(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Dt.updateQueue,e===null?(e={lastEffect:null,stores:null},Dt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function xI(){return yr().memoizedState}function fd(t,e,n,r){var s=Wr();Dt.flags|=t,s.memoizedState=Oc(1|e,n,void 0,r===void 0?null:r)}function Wh(t,e,n,r){var s=yr();r=r===void 0?null:r;var i=void 0;if(Jt!==null){var a=Jt.memoizedState;if(i=a.destroy,r!==null&&yy(r,a.deps)){s.memoizedState=Oc(e,n,i,r);return}}Dt.flags|=t,s.memoizedState=Oc(1|e,n,i,r)}function Ox(t,e){return fd(8390656,8,t,e)}function xy(t,e){return Wh(2048,8,t,e)}function bI(t,e){return Wh(4,2,t,e)}function wI(t,e){return Wh(4,4,t,e)}function EI(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function II(t,e,n){return n=n!=null?n.concat([t]):null,Wh(4,4,EI.bind(null,e,t),n)}function by(){}function SI(t,e){var n=yr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&yy(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function TI(t,e){var n=yr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&yy(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function CI(t,e,n){return fo&21?(Dr(n,e)||(n=PE(),Dt.lanes|=n,po|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Bn=!0),t.memoizedState=n)}function DA(t,e){var n=pt;pt=n!==0&&4>n?n:4,t(!0);var r=xp.transition;xp.transition={};try{t(!1),e()}finally{pt=n,xp.transition=r}}function NI(){return yr().memoizedState}function OA(t,e,n){var r=ui(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},jI(t))AI(e,n);else if(n=uI(t,e,n,r),n!==null){var s=kn();Pr(n,t,r,s),RI(n,e,r)}}function LA(t,e,n){var r=ui(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(jI(t))AI(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,n);if(s.hasEagerState=!0,s.eagerState=l,Dr(l,a)){var c=e.interleaved;c===null?(s.next=s,hy(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=uI(t,e,s,r),n!==null&&(s=kn(),Pr(n,t,r,s),RI(n,e,r))}}function jI(t){var e=t.alternate;return t===Dt||e!==null&&e===Dt}function AI(t,e){oc=eh=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function RI(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Jg(t,n)}}var th={readContext:gr,useCallback:yn,useContext:yn,useEffect:yn,useImperativeHandle:yn,useInsertionEffect:yn,useLayoutEffect:yn,useMemo:yn,useReducer:yn,useRef:yn,useState:yn,useDebugValue:yn,useDeferredValue:yn,useTransition:yn,useMutableSource:yn,useSyncExternalStore:yn,useId:yn,unstable_isNewReconciler:!1},VA={readContext:gr,useCallback:function(t,e){return Wr().memoizedState=[t,e===void 0?null:e],t},useContext:gr,useEffect:Ox,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,fd(4194308,4,EI.bind(null,e,t),n)},useLayoutEffect:function(t,e){return fd(4194308,4,t,e)},useInsertionEffect:function(t,e){return fd(4,2,t,e)},useMemo:function(t,e){var n=Wr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Wr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=OA.bind(null,Dt,t),[r.memoizedState,t]},useRef:function(t){var e=Wr();return t={current:t},e.memoizedState=t},useState:Dx,useDebugValue:by,useDeferredValue:function(t){return Wr().memoizedState=t},useTransition:function(){var t=Dx(!1),e=t[0];return t=DA.bind(null,t[1]),Wr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Dt,s=Wr();if(Ct){if(n===void 0)throw Error(re(407));n=n()}else{if(n=e(),ln===null)throw Error(re(349));fo&30||mI(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Ox(yI.bind(null,r,i,t),[t]),r.flags|=2048,Oc(9,gI.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Wr(),e=ln.identifierPrefix;if(Ct){var n=ps,r=fs;n=(r&~(1<<32-Rr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=kc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kA++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},MA={readContext:gr,useCallback:SI,useContext:gr,useEffect:xy,useImperativeHandle:II,useInsertionEffect:bI,useLayoutEffect:wI,useMemo:TI,useReducer:bp,useRef:xI,useState:function(){return bp(Dc)},useDebugValue:by,useDeferredValue:function(t){var e=yr();return CI(e,Jt.memoizedState,t)},useTransition:function(){var t=bp(Dc)[0],e=yr().memoizedState;return[t,e]},useMutableSource:fI,useSyncExternalStore:pI,useId:NI,unstable_isNewReconciler:!1},FA={readContext:gr,useCallback:SI,useContext:gr,useEffect:xy,useImperativeHandle:II,useInsertionEffect:bI,useLayoutEffect:wI,useMemo:TI,useReducer:wp,useRef:xI,useState:function(){return wp(Dc)},useDebugValue:by,useDeferredValue:function(t){var e=yr();return Jt===null?e.memoizedState=t:CI(e,Jt.memoizedState,t)},useTransition:function(){var t=wp(Dc)[0],e=yr().memoizedState;return[t,e]},useMutableSource:fI,useSyncExternalStore:pI,useId:NI,unstable_isNewReconciler:!1};function Sr(t,e){if(t&&t.defaultProps){e=Ot({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Fm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ot({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Gh={isMounted:function(t){return(t=t._reactInternals)?ko(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=kn(),s=ui(t),i=vs(r,s);i.payload=e,n!=null&&(i.callback=n),e=li(t,i,s),e!==null&&(Pr(e,t,s,r),dd(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=kn(),s=ui(t),i=vs(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=li(t,i,s),e!==null&&(Pr(e,t,s,r),dd(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=kn(),r=ui(t),s=vs(n,r);s.tag=2,e!=null&&(s.callback=e),e=li(t,s,r),e!==null&&(Pr(e,t,r,n),dd(e,t,r))}};function Lx(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Cc(n,r)||!Cc(s,i):!0}function PI(t,e,n){var r=!1,s=_i,i=e.contextType;return typeof i=="object"&&i!==null?i=gr(i):(s=Hn(e)?uo:Cn.current,r=e.contextTypes,i=(r=r!=null)?Oa(t,s):_i),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Gh,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Vx(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Gh.enqueueReplaceState(e,e.state,null)}function Um(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},fy(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=gr(i):(i=Hn(e)?uo:Cn.current,s.context=Oa(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Fm(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Gh.enqueueReplaceState(s,s.state,null),Jd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Fa(t,e){try{var n="",r=e;do n+=fj(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Ep(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function $m(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var UA=typeof WeakMap=="function"?WeakMap:Map;function kI(t,e,n){n=vs(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){rh||(rh=!0,Xm=r),$m(t,e)},n}function DI(t,e,n){n=vs(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){$m(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){$m(t,e),typeof r!="function"&&(ci===null?ci=new Set([this]):ci.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function Mx(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new UA;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=eR.bind(null,t,e,n),e.then(t,t))}function Fx(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ux(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=vs(-1,1),e.tag=2,li(n,e,1))),n.lanes|=1),t)}var $A=As.ReactCurrentOwner,Bn=!1;function An(t,e,n,r){e.child=t===null?cI(e,null,n,r):Va(e,t.child,n,r)}function $x(t,e,n,r,s){n=n.render;var i=e.ref;return Sa(e,s),r=vy(t,e,n,r,i,s),n=_y(),t!==null&&!Bn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Es(t,e,s)):(Ct&&n&&oy(e),e.flags|=1,An(t,e,r,s),e.child)}function Bx(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!jy(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,OI(t,e,i,r,s)):(t=yd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Cc,n(a,r)&&t.ref===e.ref)return Es(t,e,s)}return e.flags|=1,t=di(i,r),t.ref=e.ref,t.return=e,e.child=t}function OI(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Cc(i,r)&&t.ref===e.ref)if(Bn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Bn=!0);else return e.lanes=t.lanes,Es(t,e,s)}return Bm(t,e,n,r,s)}function LI(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_t(_a,Jn),Jn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,_t(_a,Jn),Jn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,_t(_a,Jn),Jn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,_t(_a,Jn),Jn|=r;return An(t,e,s,n),e.child}function VI(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Bm(t,e,n,r,s){var i=Hn(n)?uo:Cn.current;return i=Oa(e,i),Sa(e,s),n=vy(t,e,n,r,i,s),r=_y(),t!==null&&!Bn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Es(t,e,s)):(Ct&&r&&oy(e),e.flags|=1,An(t,e,n,s),e.child)}function zx(t,e,n,r,s){if(Hn(n)){var i=!0;Gd(e)}else i=!1;if(Sa(e,s),e.stateNode===null)pd(t,e),PI(e,n,r),Um(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=gr(d):(d=Hn(n)?uo:Cn.current,d=Oa(e,d));var h=n.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Vx(e,a,r,d),Hs=!1;var m=e.memoizedState;a.state=m,Jd(e,r,a,s),c=e.memoizedState,l!==r||m!==c||qn.current||Hs?(typeof h=="function"&&(Fm(e,n,h,r),c=e.memoizedState),(l=Hs||Lx(e,n,l,r,m,c,d))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),a.props=r,a.state=c,a.context=d,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,dI(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:Sr(e.type,l),a.props=d,f=e.pendingProps,m=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=gr(c):(c=Hn(n)?uo:Cn.current,c=Oa(e,c));var x=n.getDerivedStateFromProps;(h=typeof x=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==f||m!==c)&&Vx(e,a,r,c),Hs=!1,m=e.memoizedState,a.state=m,Jd(e,r,a,s);var T=e.memoizedState;l!==f||m!==T||qn.current||Hs?(typeof x=="function"&&(Fm(e,n,x,r),T=e.memoizedState),(d=Hs||Lx(e,n,d,r,m,T,c)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,T,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,T,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=T),a.props=r,a.state=T,a.context=c,r=d):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),r=!1)}return zm(t,e,n,r,i,s)}function zm(t,e,n,r,s,i){VI(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&Nx(e,n,!1),Es(t,e,i);r=e.stateNode,$A.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Va(e,t.child,null,i),e.child=Va(e,null,l,i)):An(t,e,l,i),e.memoizedState=r.state,s&&Nx(e,n,!0),e.child}function MI(t){var e=t.stateNode;e.pendingContext?Cx(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Cx(t,e.context,!1),py(t,e.containerInfo)}function qx(t,e,n,r,s){return La(),ly(s),e.flags|=256,An(t,e,n,r),e.child}var qm={dehydrated:null,treeContext:null,retryLane:0};function Hm(t){return{baseLanes:t,cachePool:null,transitions:null}}function FI(t,e,n){var r=e.pendingProps,s=Rt.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),_t(Rt,s&1),t===null)return Vm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Yh(a,r,0,null),t=ro(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Hm(n),e.memoizedState=qm,t):wy(e,a));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return BA(t,e,a,r,l,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=di(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=di(l,i):(i=ro(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?Hm(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=qm,r}return i=t.child,t=i.sibling,r=di(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function wy(t,e){return e=Yh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function zu(t,e,n,r){return r!==null&&ly(r),Va(e,t.child,null,n),t=wy(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function BA(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=Ep(Error(re(422))),zu(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Yh({mode:"visible",children:r.children},s,0,null),i=ro(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Va(e,t.child,null,a),e.child.memoizedState=Hm(a),e.memoizedState=qm,i);if(!(e.mode&1))return zu(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(re(419)),r=Ep(i,r,void 0),zu(t,e,a,r)}if(l=(a&t.childLanes)!==0,Bn||l){if(r=ln,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ws(t,s),Pr(r,t,s,-1))}return Ny(),r=Ep(Error(re(421))),zu(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=tR.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,er=ai(s.nextSibling),nr=e,Ct=!0,Nr=null,t!==null&&(lr[cr++]=fs,lr[cr++]=ps,lr[cr++]=ho,fs=t.id,ps=t.overflow,ho=e),e=wy(e,r.children),e.flags|=4096,e)}function Hx(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Mm(t.return,e,n)}function Ip(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function UI(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(An(t,e,r.children,n),r=Rt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Hx(t,n,e);else if(t.tag===19)Hx(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(_t(Rt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Zd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Ip(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Zd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Ip(e,!0,n,null,i);break;case"together":Ip(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function pd(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Es(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),po|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(re(153));if(e.child!==null){for(t=e.child,n=di(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=di(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function zA(t,e,n){switch(e.tag){case 3:MI(e),La();break;case 5:hI(e);break;case 1:Hn(e.type)&&Gd(e);break;case 4:py(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;_t(Yd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(_t(Rt,Rt.current&1),e.flags|=128,null):n&e.child.childLanes?FI(t,e,n):(_t(Rt,Rt.current&1),t=Es(t,e,n),t!==null?t.sibling:null);_t(Rt,Rt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return UI(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),_t(Rt,Rt.current),r)break;return null;case 22:case 23:return e.lanes=0,LI(t,e,n)}return Es(t,e,n)}var $I,Wm,BI,zI;$I=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Wm=function(){};BI=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Ji(Zr.current);var i=null;switch(n){case"input":s=pm(t,s),r=pm(t,r),i=[];break;case"select":s=Ot({},s,{value:void 0}),r=Ot({},r,{value:void 0}),i=[];break;case"textarea":s=ym(t,s),r=ym(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Hd)}_m(n,r);var a;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(xc.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(xc.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Et("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};zI=function(t,e,n,r){n!==r&&(e.flags|=4)};function Al(t,e){if(!Ct)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function vn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function qA(t,e,n){var r=e.pendingProps;switch(ay(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vn(e),null;case 1:return Hn(e.type)&&Wd(),vn(e),null;case 3:return r=e.stateNode,Ma(),It(qn),It(Cn),gy(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&($u(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Nr!==null&&(eg(Nr),Nr=null))),Wm(t,e),vn(e),null;case 5:my(e);var s=Ji(Pc.current);if(n=e.type,t!==null&&e.stateNode!=null)BI(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(re(166));return vn(e),null}if(t=Ji(Zr.current),$u(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Kr]=e,r[Ac]=i,t=(e.mode&1)!==0,n){case"dialog":Et("cancel",r),Et("close",r);break;case"iframe":case"object":case"embed":Et("load",r);break;case"video":case"audio":for(s=0;s<Hl.length;s++)Et(Hl[s],r);break;case"source":Et("error",r);break;case"img":case"image":case"link":Et("error",r),Et("load",r);break;case"details":Et("toggle",r);break;case"input":ex(r,i),Et("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Et("invalid",r);break;case"textarea":nx(r,i),Et("invalid",r)}_m(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Uu(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Uu(r.textContent,l,t),s=["children",""+l]):xc.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&Et("scroll",r)}switch(n){case"input":Pu(r),tx(r,i,!0);break;case"textarea":Pu(r),rx(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Hd)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=yE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Kr]=e,t[Ac]=r,$I(t,e,!1,!1),e.stateNode=t;e:{switch(a=xm(n,r),n){case"dialog":Et("cancel",t),Et("close",t),s=r;break;case"iframe":case"object":case"embed":Et("load",t),s=r;break;case"video":case"audio":for(s=0;s<Hl.length;s++)Et(Hl[s],t);s=r;break;case"source":Et("error",t),s=r;break;case"img":case"image":case"link":Et("error",t),Et("load",t),s=r;break;case"details":Et("toggle",t),s=r;break;case"input":ex(t,r),s=pm(t,r),Et("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ot({},r,{value:void 0}),Et("invalid",t);break;case"textarea":nx(t,r),s=ym(t,r),Et("invalid",t);break;default:s=r}_m(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?xE(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&vE(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&bc(t,c):typeof c=="number"&&bc(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(xc.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Et("scroll",t):c!=null&&Wg(t,i,c,a))}switch(n){case"input":Pu(t),tx(t,r,!1);break;case"textarea":Pu(t),rx(t);break;case"option":r.value!=null&&t.setAttribute("value",""+vi(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ba(t,!!r.multiple,i,!1):r.defaultValue!=null&&ba(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Hd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return vn(e),null;case 6:if(t&&e.stateNode!=null)zI(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(re(166));if(n=Ji(Pc.current),Ji(Zr.current),$u(e)){if(r=e.stateNode,n=e.memoizedProps,r[Kr]=e,(i=r.nodeValue!==n)&&(t=nr,t!==null))switch(t.tag){case 3:Uu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Uu(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Kr]=e,e.stateNode=r}return vn(e),null;case 13:if(It(Rt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ct&&er!==null&&e.mode&1&&!(e.flags&128))aI(),La(),e.flags|=98560,i=!1;else if(i=$u(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(re(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(re(317));i[Kr]=e}else La(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;vn(e),i=!1}else Nr!==null&&(eg(Nr),Nr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Rt.current&1?Zt===0&&(Zt=3):Ny())),e.updateQueue!==null&&(e.flags|=4),vn(e),null);case 4:return Ma(),Wm(t,e),t===null&&Nc(e.stateNode.containerInfo),vn(e),null;case 10:return dy(e.type._context),vn(e),null;case 17:return Hn(e.type)&&Wd(),vn(e),null;case 19:if(It(Rt),i=e.memoizedState,i===null)return vn(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Al(i,!1);else{if(Zt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=Zd(t),a!==null){for(e.flags|=128,Al(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return _t(Rt,Rt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Wt()>Ua&&(e.flags|=128,r=!0,Al(i,!1),e.lanes=4194304)}else{if(!r)if(t=Zd(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Al(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Ct)return vn(e),null}else 2*Wt()-i.renderingStartTime>Ua&&n!==1073741824&&(e.flags|=128,r=!0,Al(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Wt(),e.sibling=null,n=Rt.current,_t(Rt,r?n&1|2:n&1),e):(vn(e),null);case 22:case 23:return Cy(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Jn&1073741824&&(vn(e),e.subtreeFlags&6&&(e.flags|=8192)):vn(e),null;case 24:return null;case 25:return null}throw Error(re(156,e.tag))}function HA(t,e){switch(ay(e),e.tag){case 1:return Hn(e.type)&&Wd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ma(),It(qn),It(Cn),gy(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return my(e),null;case 13:if(It(Rt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(re(340));La()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return It(Rt),null;case 4:return Ma(),null;case 10:return dy(e.type._context),null;case 22:case 23:return Cy(),null;case 24:return null;default:return null}}var qu=!1,bn=!1,WA=typeof WeakSet=="function"?WeakSet:Set,Ee=null;function va(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Mt(t,e,r)}else n.current=null}function Gm(t,e,n){try{n()}catch(r){Mt(t,e,r)}}var Wx=!1;function GA(t,e){if(Am=Bd,t=KE(),iy(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,d=0,h=0,f=t,m=null;t:for(;;){for(var x;f!==n||s!==0&&f.nodeType!==3||(l=a+s),f!==i||r!==0&&f.nodeType!==3||(c=a+r),f.nodeType===3&&(a+=f.nodeValue.length),(x=f.firstChild)!==null;)m=f,f=x;for(;;){if(f===t)break t;if(m===n&&++d===s&&(l=a),m===i&&++h===r&&(c=a),(x=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=x}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Rm={focusedElem:t,selectionRange:n},Bd=!1,Ee=e;Ee!==null;)if(e=Ee,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ee=t;else for(;Ee!==null;){e=Ee;try{var T=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var N=T.memoizedProps,C=T.memoizedState,S=e.stateNode,E=S.getSnapshotBeforeUpdate(e.elementType===e.type?N:Sr(e.type,N),C);S.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var g=e.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(re(163))}}catch(_){Mt(e,e.return,_)}if(t=e.sibling,t!==null){t.return=e.return,Ee=t;break}Ee=e.return}return T=Wx,Wx=!1,T}function ac(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Gm(e,n,i)}s=s.next}while(s!==r)}}function Kh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Km(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function qI(t){var e=t.alternate;e!==null&&(t.alternate=null,qI(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Kr],delete e[Ac],delete e[Dm],delete e[jA],delete e[AA])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function HI(t){return t.tag===5||t.tag===3||t.tag===4}function Gx(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||HI(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Qm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Hd));else if(r!==4&&(t=t.child,t!==null))for(Qm(t,e,n),t=t.sibling;t!==null;)Qm(t,e,n),t=t.sibling}function Ym(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Ym(t,e,n),t=t.sibling;t!==null;)Ym(t,e,n),t=t.sibling}var un=null,Tr=!1;function Ms(t,e,n){for(n=n.child;n!==null;)WI(t,e,n),n=n.sibling}function WI(t,e,n){if(Jr&&typeof Jr.onCommitFiberUnmount=="function")try{Jr.onCommitFiberUnmount(Uh,n)}catch{}switch(n.tag){case 5:bn||va(n,e);case 6:var r=un,s=Tr;un=null,Ms(t,e,n),un=r,Tr=s,un!==null&&(Tr?(t=un,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):un.removeChild(n.stateNode));break;case 18:un!==null&&(Tr?(t=un,n=n.stateNode,t.nodeType===8?yp(t.parentNode,n):t.nodeType===1&&yp(t,n),Sc(t)):yp(un,n.stateNode));break;case 4:r=un,s=Tr,un=n.stateNode.containerInfo,Tr=!0,Ms(t,e,n),un=r,Tr=s;break;case 0:case 11:case 14:case 15:if(!bn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Gm(n,e,a),s=s.next}while(s!==r)}Ms(t,e,n);break;case 1:if(!bn&&(va(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Mt(n,e,l)}Ms(t,e,n);break;case 21:Ms(t,e,n);break;case 22:n.mode&1?(bn=(r=bn)||n.memoizedState!==null,Ms(t,e,n),bn=r):Ms(t,e,n);break;default:Ms(t,e,n)}}function Kx(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new WA),e.forEach(function(r){var s=nR.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Er(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:un=l.stateNode,Tr=!1;break e;case 3:un=l.stateNode.containerInfo,Tr=!0;break e;case 4:un=l.stateNode.containerInfo,Tr=!0;break e}l=l.return}if(un===null)throw Error(re(160));WI(i,a,s),un=null,Tr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Mt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)GI(e,t),e=e.sibling}function GI(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Er(e,t),zr(t),r&4){try{ac(3,t,t.return),Kh(3,t)}catch(N){Mt(t,t.return,N)}try{ac(5,t,t.return)}catch(N){Mt(t,t.return,N)}}break;case 1:Er(e,t),zr(t),r&512&&n!==null&&va(n,n.return);break;case 5:if(Er(e,t),zr(t),r&512&&n!==null&&va(n,n.return),t.flags&32){var s=t.stateNode;try{bc(s,"")}catch(N){Mt(t,t.return,N)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&mE(s,i),xm(l,a);var d=xm(l,i);for(a=0;a<c.length;a+=2){var h=c[a],f=c[a+1];h==="style"?xE(s,f):h==="dangerouslySetInnerHTML"?vE(s,f):h==="children"?bc(s,f):Wg(s,h,f,d)}switch(l){case"input":mm(s,i);break;case"textarea":gE(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?ba(s,!!i.multiple,x,!1):m!==!!i.multiple&&(i.defaultValue!=null?ba(s,!!i.multiple,i.defaultValue,!0):ba(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ac]=i}catch(N){Mt(t,t.return,N)}}break;case 6:if(Er(e,t),zr(t),r&4){if(t.stateNode===null)throw Error(re(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(N){Mt(t,t.return,N)}}break;case 3:if(Er(e,t),zr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Sc(e.containerInfo)}catch(N){Mt(t,t.return,N)}break;case 4:Er(e,t),zr(t);break;case 13:Er(e,t),zr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Sy=Wt())),r&4&&Kx(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(bn=(d=bn)||h,Er(e,t),bn=d):Er(e,t),zr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(Ee=t,h=t.child;h!==null;){for(f=Ee=h;Ee!==null;){switch(m=Ee,x=m.child,m.tag){case 0:case 11:case 14:case 15:ac(4,m,m.return);break;case 1:va(m,m.return);var T=m.stateNode;if(typeof T.componentWillUnmount=="function"){r=m,n=m.return;try{e=r,T.props=e.memoizedProps,T.state=e.memoizedState,T.componentWillUnmount()}catch(N){Mt(r,n,N)}}break;case 5:va(m,m.return);break;case 22:if(m.memoizedState!==null){Yx(f);continue}}x!==null?(x.return=m,Ee=x):Yx(f)}h=h.sibling}e:for(h=null,f=t;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=f.stateNode,c=f.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=_E("display",a))}catch(N){Mt(t,t.return,N)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(N){Mt(t,t.return,N)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Er(e,t),zr(t),r&4&&Kx(t);break;case 21:break;default:Er(e,t),zr(t)}}function zr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(HI(n)){var r=n;break e}n=n.return}throw Error(re(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(bc(s,""),r.flags&=-33);var i=Gx(t);Ym(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=Gx(t);Qm(t,l,a);break;default:throw Error(re(161))}}catch(c){Mt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function KA(t,e,n){Ee=t,KI(t)}function KI(t,e,n){for(var r=(t.mode&1)!==0;Ee!==null;){var s=Ee,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||qu;if(!a){var l=s.alternate,c=l!==null&&l.memoizedState!==null||bn;l=qu;var d=bn;if(qu=a,(bn=c)&&!d)for(Ee=s;Ee!==null;)a=Ee,c=a.child,a.tag===22&&a.memoizedState!==null?Xx(s):c!==null?(c.return=a,Ee=c):Xx(s);for(;i!==null;)Ee=i,KI(i),i=i.sibling;Ee=s,qu=l,bn=d}Qx(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,Ee=i):Qx(t)}}function Qx(t){for(;Ee!==null;){var e=Ee;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bn||Kh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Sr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&kx(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}kx(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Sc(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(re(163))}bn||e.flags&512&&Km(e)}catch(m){Mt(e,e.return,m)}}if(e===t){Ee=null;break}if(n=e.sibling,n!==null){n.return=e.return,Ee=n;break}Ee=e.return}}function Yx(t){for(;Ee!==null;){var e=Ee;if(e===t){Ee=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Ee=n;break}Ee=e.return}}function Xx(t){for(;Ee!==null;){var e=Ee;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Kh(4,e)}catch(c){Mt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Mt(e,s,c)}}var i=e.return;try{Km(e)}catch(c){Mt(e,i,c)}break;case 5:var a=e.return;try{Km(e)}catch(c){Mt(e,a,c)}}}catch(c){Mt(e,e.return,c)}if(e===t){Ee=null;break}var l=e.sibling;if(l!==null){l.return=e.return,Ee=l;break}Ee=e.return}}var QA=Math.ceil,nh=As.ReactCurrentDispatcher,Ey=As.ReactCurrentOwner,pr=As.ReactCurrentBatchConfig,at=0,ln=null,Kt=null,fn=0,Jn=0,_a=Ti(0),Zt=0,Lc=null,po=0,Qh=0,Iy=0,lc=null,$n=null,Sy=0,Ua=1/0,ds=null,rh=!1,Xm=null,ci=null,Hu=!1,ni=null,sh=0,cc=0,Jm=null,md=-1,gd=0;function kn(){return at&6?Wt():md!==-1?md:md=Wt()}function ui(t){return t.mode&1?at&2&&fn!==0?fn&-fn:PA.transition!==null?(gd===0&&(gd=PE()),gd):(t=pt,t!==0||(t=window.event,t=t===void 0?16:FE(t.type)),t):1}function Pr(t,e,n,r){if(50<cc)throw cc=0,Jm=null,Error(re(185));Zc(t,n,r),(!(at&2)||t!==ln)&&(t===ln&&(!(at&2)&&(Qh|=n),Zt===4&&Gs(t,fn)),Wn(t,r),n===1&&at===0&&!(e.mode&1)&&(Ua=Wt()+500,Hh&&Ci()))}function Wn(t,e){var n=t.callbackNode;Pj(t,e);var r=$d(t,t===ln?fn:0);if(r===0)n!==null&&ox(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&ox(n),e===1)t.tag===0?RA(Jx.bind(null,t)):sI(Jx.bind(null,t)),CA(function(){!(at&6)&&Ci()}),n=null;else{switch(kE(r)){case 1:n=Xg;break;case 4:n=AE;break;case 16:n=Ud;break;case 536870912:n=RE;break;default:n=Ud}n=nS(n,QI.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function QI(t,e){if(md=-1,gd=0,at&6)throw Error(re(327));var n=t.callbackNode;if(Ta()&&t.callbackNode!==n)return null;var r=$d(t,t===ln?fn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=ih(t,r);else{e=r;var s=at;at|=2;var i=XI();(ln!==t||fn!==e)&&(ds=null,Ua=Wt()+500,no(t,e));do try{JA();break}catch(l){YI(t,l)}while(!0);uy(),nh.current=i,at=s,Kt!==null?e=0:(ln=null,fn=0,e=Zt)}if(e!==0){if(e===2&&(s=Sm(t),s!==0&&(r=s,e=Zm(t,s))),e===1)throw n=Lc,no(t,0),Gs(t,r),Wn(t,Wt()),n;if(e===6)Gs(t,r);else{if(s=t.current.alternate,!(r&30)&&!YA(s)&&(e=ih(t,r),e===2&&(i=Sm(t),i!==0&&(r=i,e=Zm(t,i))),e===1))throw n=Lc,no(t,0),Gs(t,r),Wn(t,Wt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(re(345));case 2:$i(t,$n,ds);break;case 3:if(Gs(t,r),(r&130023424)===r&&(e=Sy+500-Wt(),10<e)){if($d(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){kn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=km($i.bind(null,t,$n,ds),e);break}$i(t,$n,ds);break;case 4:if(Gs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-Rr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Wt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*QA(r/1960))-r,10<r){t.timeoutHandle=km($i.bind(null,t,$n,ds),r);break}$i(t,$n,ds);break;case 5:$i(t,$n,ds);break;default:throw Error(re(329))}}}return Wn(t,Wt()),t.callbackNode===n?QI.bind(null,t):null}function Zm(t,e){var n=lc;return t.current.memoizedState.isDehydrated&&(no(t,e).flags|=256),t=ih(t,e),t!==2&&(e=$n,$n=n,e!==null&&eg(e)),t}function eg(t){$n===null?$n=t:$n.push.apply($n,t)}function YA(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Dr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Gs(t,e){for(e&=~Iy,e&=~Qh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Rr(e),r=1<<n;t[n]=-1,e&=~r}}function Jx(t){if(at&6)throw Error(re(327));Ta();var e=$d(t,0);if(!(e&1))return Wn(t,Wt()),null;var n=ih(t,e);if(t.tag!==0&&n===2){var r=Sm(t);r!==0&&(e=r,n=Zm(t,r))}if(n===1)throw n=Lc,no(t,0),Gs(t,e),Wn(t,Wt()),n;if(n===6)throw Error(re(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,$i(t,$n,ds),Wn(t,Wt()),null}function Ty(t,e){var n=at;at|=1;try{return t(e)}finally{at=n,at===0&&(Ua=Wt()+500,Hh&&Ci())}}function mo(t){ni!==null&&ni.tag===0&&!(at&6)&&Ta();var e=at;at|=1;var n=pr.transition,r=pt;try{if(pr.transition=null,pt=1,t)return t()}finally{pt=r,pr.transition=n,at=e,!(at&6)&&Ci()}}function Cy(){Jn=_a.current,It(_a)}function no(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,TA(n)),Kt!==null)for(n=Kt.return;n!==null;){var r=n;switch(ay(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Wd();break;case 3:Ma(),It(qn),It(Cn),gy();break;case 5:my(r);break;case 4:Ma();break;case 13:It(Rt);break;case 19:It(Rt);break;case 10:dy(r.type._context);break;case 22:case 23:Cy()}n=n.return}if(ln=t,Kt=t=di(t.current,null),fn=Jn=e,Zt=0,Lc=null,Iy=Qh=po=0,$n=lc=null,Xi!==null){for(e=0;e<Xi.length;e++)if(n=Xi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}Xi=null}return t}function YI(t,e){do{var n=Kt;try{if(uy(),hd.current=th,eh){for(var r=Dt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}eh=!1}if(fo=0,on=Jt=Dt=null,oc=!1,kc=0,Ey.current=null,n===null||n.return===null){Zt=1,Lc=e,Kt=null;break}e:{var i=t,a=n.return,l=n,c=e;if(e=fn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var x=Fx(a);if(x!==null){x.flags&=-257,Ux(x,a,l,i,e),x.mode&1&&Mx(i,d,e),e=x,c=d;var T=e.updateQueue;if(T===null){var N=new Set;N.add(c),e.updateQueue=N}else T.add(c);break e}else{if(!(e&1)){Mx(i,d,e),Ny();break e}c=Error(re(426))}}else if(Ct&&l.mode&1){var C=Fx(a);if(C!==null){!(C.flags&65536)&&(C.flags|=256),Ux(C,a,l,i,e),ly(Fa(c,l));break e}}i=c=Fa(c,l),Zt!==4&&(Zt=2),lc===null?lc=[i]:lc.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var S=kI(i,c,e);Px(i,S);break e;case 1:l=c;var E=i.type,g=i.stateNode;if(!(i.flags&128)&&(typeof E.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(ci===null||!ci.has(g)))){i.flags|=65536,e&=-e,i.lanes|=e;var _=DI(i,l,e);Px(i,_);break e}}i=i.return}while(i!==null)}ZI(n)}catch(O){e=O,Kt===n&&n!==null&&(Kt=n=n.return);continue}break}while(!0)}function XI(){var t=nh.current;return nh.current=th,t===null?th:t}function Ny(){(Zt===0||Zt===3||Zt===2)&&(Zt=4),ln===null||!(po&268435455)&&!(Qh&268435455)||Gs(ln,fn)}function ih(t,e){var n=at;at|=2;var r=XI();(ln!==t||fn!==e)&&(ds=null,no(t,e));do try{XA();break}catch(s){YI(t,s)}while(!0);if(uy(),at=n,nh.current=r,Kt!==null)throw Error(re(261));return ln=null,fn=0,Zt}function XA(){for(;Kt!==null;)JI(Kt)}function JA(){for(;Kt!==null&&!Ej();)JI(Kt)}function JI(t){var e=tS(t.alternate,t,Jn);t.memoizedProps=t.pendingProps,e===null?ZI(t):Kt=e,Ey.current=null}function ZI(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=HA(n,e),n!==null){n.flags&=32767,Kt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Zt=6,Kt=null;return}}else if(n=qA(n,e,Jn),n!==null){Kt=n;return}if(e=e.sibling,e!==null){Kt=e;return}Kt=e=t}while(e!==null);Zt===0&&(Zt=5)}function $i(t,e,n){var r=pt,s=pr.transition;try{pr.transition=null,pt=1,ZA(t,e,n,r)}finally{pr.transition=s,pt=r}return null}function ZA(t,e,n,r){do Ta();while(ni!==null);if(at&6)throw Error(re(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(re(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(kj(t,i),t===ln&&(Kt=ln=null,fn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Hu||(Hu=!0,nS(Ud,function(){return Ta(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=pr.transition,pr.transition=null;var a=pt;pt=1;var l=at;at|=4,Ey.current=null,GA(t,n),GI(n,t),_A(Rm),Bd=!!Am,Rm=Am=null,t.current=n,KA(n),Ij(),at=l,pt=a,pr.transition=i}else t.current=n;if(Hu&&(Hu=!1,ni=t,sh=s),i=t.pendingLanes,i===0&&(ci=null),Cj(n.stateNode),Wn(t,Wt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(rh)throw rh=!1,t=Xm,Xm=null,t;return sh&1&&t.tag!==0&&Ta(),i=t.pendingLanes,i&1?t===Jm?cc++:(cc=0,Jm=t):cc=0,Ci(),null}function Ta(){if(ni!==null){var t=kE(sh),e=pr.transition,n=pt;try{if(pr.transition=null,pt=16>t?16:t,ni===null)var r=!1;else{if(t=ni,ni=null,sh=0,at&6)throw Error(re(331));var s=at;for(at|=4,Ee=t.current;Ee!==null;){var i=Ee,a=i.child;if(Ee.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(Ee=d;Ee!==null;){var h=Ee;switch(h.tag){case 0:case 11:case 15:ac(8,h,i)}var f=h.child;if(f!==null)f.return=h,Ee=f;else for(;Ee!==null;){h=Ee;var m=h.sibling,x=h.return;if(qI(h),h===d){Ee=null;break}if(m!==null){m.return=x,Ee=m;break}Ee=x}}}var T=i.alternate;if(T!==null){var N=T.child;if(N!==null){T.child=null;do{var C=N.sibling;N.sibling=null,N=C}while(N!==null)}}Ee=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,Ee=a;else e:for(;Ee!==null;){if(i=Ee,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ac(9,i,i.return)}var S=i.sibling;if(S!==null){S.return=i.return,Ee=S;break e}Ee=i.return}}var E=t.current;for(Ee=E;Ee!==null;){a=Ee;var g=a.child;if(a.subtreeFlags&2064&&g!==null)g.return=a,Ee=g;else e:for(a=E;Ee!==null;){if(l=Ee,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Kh(9,l)}}catch(O){Mt(l,l.return,O)}if(l===a){Ee=null;break e}var _=l.sibling;if(_!==null){_.return=l.return,Ee=_;break e}Ee=l.return}}if(at=s,Ci(),Jr&&typeof Jr.onPostCommitFiberRoot=="function")try{Jr.onPostCommitFiberRoot(Uh,t)}catch{}r=!0}return r}finally{pt=n,pr.transition=e}}return!1}function Zx(t,e,n){e=Fa(n,e),e=kI(t,e,1),t=li(t,e,1),e=kn(),t!==null&&(Zc(t,1,e),Wn(t,e))}function Mt(t,e,n){if(t.tag===3)Zx(t,t,n);else for(;e!==null;){if(e.tag===3){Zx(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ci===null||!ci.has(r))){t=Fa(n,t),t=DI(e,t,1),e=li(e,t,1),t=kn(),e!==null&&(Zc(e,1,t),Wn(e,t));break}}e=e.return}}function eR(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=kn(),t.pingedLanes|=t.suspendedLanes&n,ln===t&&(fn&n)===n&&(Zt===4||Zt===3&&(fn&130023424)===fn&&500>Wt()-Sy?no(t,0):Iy|=n),Wn(t,e)}function eS(t,e){e===0&&(t.mode&1?(e=Ou,Ou<<=1,!(Ou&130023424)&&(Ou=4194304)):e=1);var n=kn();t=ws(t,e),t!==null&&(Zc(t,e,n),Wn(t,n))}function tR(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),eS(t,n)}function nR(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(re(314))}r!==null&&r.delete(e),eS(t,n)}var tS;tS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||qn.current)Bn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Bn=!1,zA(t,e,n);Bn=!!(t.flags&131072)}else Bn=!1,Ct&&e.flags&1048576&&iI(e,Qd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;pd(t,e),t=e.pendingProps;var s=Oa(e,Cn.current);Sa(e,n),s=vy(null,e,r,t,s,n);var i=_y();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Hn(r)?(i=!0,Gd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,fy(e),s.updater=Gh,e.stateNode=s,s._reactInternals=e,Um(e,r,t,n),e=zm(null,e,r,!0,i,n)):(e.tag=0,Ct&&i&&oy(e),An(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(pd(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=sR(r),t=Sr(r,t),s){case 0:e=Bm(null,e,r,t,n);break e;case 1:e=zx(null,e,r,t,n);break e;case 11:e=$x(null,e,r,t,n);break e;case 14:e=Bx(null,e,r,Sr(r.type,t),n);break e}throw Error(re(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Sr(r,s),Bm(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Sr(r,s),zx(t,e,r,s,n);case 3:e:{if(MI(e),t===null)throw Error(re(387));r=e.pendingProps,i=e.memoizedState,s=i.element,dI(t,e),Jd(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Fa(Error(re(423)),e),e=qx(t,e,r,n,s);break e}else if(r!==s){s=Fa(Error(re(424)),e),e=qx(t,e,r,n,s);break e}else for(er=ai(e.stateNode.containerInfo.firstChild),nr=e,Ct=!0,Nr=null,n=cI(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(La(),r===s){e=Es(t,e,n);break e}An(t,e,r,n)}e=e.child}return e;case 5:return hI(e),t===null&&Vm(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,Pm(r,s)?a=null:i!==null&&Pm(r,i)&&(e.flags|=32),VI(t,e),An(t,e,a,n),e.child;case 6:return t===null&&Vm(e),null;case 13:return FI(t,e,n);case 4:return py(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Va(e,null,r,n):An(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Sr(r,s),$x(t,e,r,s,n);case 7:return An(t,e,e.pendingProps,n),e.child;case 8:return An(t,e,e.pendingProps.children,n),e.child;case 12:return An(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,_t(Yd,r._currentValue),r._currentValue=a,i!==null)if(Dr(i.value,a)){if(i.children===s.children&&!qn.current){e=Es(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=vs(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Mm(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(re(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),Mm(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}An(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Sa(e,n),s=gr(s),r=r(s),e.flags|=1,An(t,e,r,n),e.child;case 14:return r=e.type,s=Sr(r,e.pendingProps),s=Sr(r.type,s),Bx(t,e,r,s,n);case 15:return OI(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Sr(r,s),pd(t,e),e.tag=1,Hn(r)?(t=!0,Gd(e)):t=!1,Sa(e,n),PI(e,r,s),Um(e,r,s,n),zm(null,e,r,!0,t,n);case 19:return UI(t,e,n);case 22:return LI(t,e,n)}throw Error(re(156,e.tag))};function nS(t,e){return jE(t,e)}function rR(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hr(t,e,n,r){return new rR(t,e,n,r)}function jy(t){return t=t.prototype,!(!t||!t.isReactComponent)}function sR(t){if(typeof t=="function")return jy(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Kg)return 11;if(t===Qg)return 14}return 2}function di(t,e){var n=t.alternate;return n===null?(n=hr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function yd(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")jy(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case ca:return ro(n.children,s,i,e);case Gg:a=8,s|=8;break;case um:return t=hr(12,n,e,s|2),t.elementType=um,t.lanes=i,t;case dm:return t=hr(13,n,e,s),t.elementType=dm,t.lanes=i,t;case hm:return t=hr(19,n,e,s),t.elementType=hm,t.lanes=i,t;case hE:return Yh(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case uE:a=10;break e;case dE:a=9;break e;case Kg:a=11;break e;case Qg:a=14;break e;case qs:a=16,r=null;break e}throw Error(re(130,t==null?t:typeof t,""))}return e=hr(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function ro(t,e,n,r){return t=hr(7,t,r,e),t.lanes=n,t}function Yh(t,e,n,r){return t=hr(22,t,r,e),t.elementType=hE,t.lanes=n,t.stateNode={isHidden:!1},t}function Sp(t,e,n){return t=hr(6,t,null,e),t.lanes=n,t}function Tp(t,e,n){return e=hr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function iR(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=op(0),this.expirationTimes=op(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=op(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Ay(t,e,n,r,s,i,a,l,c){return t=new iR(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=hr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},fy(i),t}function oR(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:la,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function rS(t){if(!t)return _i;t=t._reactInternals;e:{if(ko(t)!==t||t.tag!==1)throw Error(re(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Hn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(re(171))}if(t.tag===1){var n=t.type;if(Hn(n))return rI(t,n,e)}return e}function sS(t,e,n,r,s,i,a,l,c){return t=Ay(n,r,!0,t,s,i,a,l,c),t.context=rS(null),n=t.current,r=kn(),s=ui(n),i=vs(r,s),i.callback=e??null,li(n,i,s),t.current.lanes=s,Zc(t,s,r),Wn(t,r),t}function Xh(t,e,n,r){var s=e.current,i=kn(),a=ui(s);return n=rS(n),e.context===null?e.context=n:e.pendingContext=n,e=vs(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=li(s,e,a),t!==null&&(Pr(t,s,a,i),dd(t,s,a)),a}function oh(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function eb(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ry(t,e){eb(t,e),(t=t.alternate)&&eb(t,e)}function aR(){return null}var iS=typeof reportError=="function"?reportError:function(t){console.error(t)};function Py(t){this._internalRoot=t}Jh.prototype.render=Py.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(re(409));Xh(t,e,null,null)};Jh.prototype.unmount=Py.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;mo(function(){Xh(null,t,null,null)}),e[bs]=null}};function Jh(t){this._internalRoot=t}Jh.prototype.unstable_scheduleHydration=function(t){if(t){var e=LE();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ws.length&&e!==0&&e<Ws[n].priority;n++);Ws.splice(n,0,t),n===0&&ME(t)}};function ky(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Zh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function tb(){}function lR(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=oh(a);i.call(d)}}var a=sS(e,r,t,0,null,!1,!1,"",tb);return t._reactRootContainer=a,t[bs]=a.current,Nc(t.nodeType===8?t.parentNode:t),mo(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=oh(c);l.call(d)}}var c=Ay(t,0,!1,null,null,!1,!1,"",tb);return t._reactRootContainer=c,t[bs]=c.current,Nc(t.nodeType===8?t.parentNode:t),mo(function(){Xh(e,c,n,r)}),c}function ef(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var c=oh(a);l.call(c)}}Xh(e,a,t,s)}else a=lR(n,e,t,s,r);return oh(a)}DE=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ql(e.pendingLanes);n!==0&&(Jg(e,n|1),Wn(e,Wt()),!(at&6)&&(Ua=Wt()+500,Ci()))}break;case 13:mo(function(){var r=ws(t,1);if(r!==null){var s=kn();Pr(r,t,1,s)}}),Ry(t,1)}};Zg=function(t){if(t.tag===13){var e=ws(t,134217728);if(e!==null){var n=kn();Pr(e,t,134217728,n)}Ry(t,134217728)}};OE=function(t){if(t.tag===13){var e=ui(t),n=ws(t,e);if(n!==null){var r=kn();Pr(n,t,e,r)}Ry(t,e)}};LE=function(){return pt};VE=function(t,e){var n=pt;try{return pt=t,e()}finally{pt=n}};wm=function(t,e,n){switch(e){case"input":if(mm(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=qh(r);if(!s)throw Error(re(90));pE(r),mm(r,s)}}}break;case"textarea":gE(t,n);break;case"select":e=n.value,e!=null&&ba(t,!!n.multiple,e,!1)}};EE=Ty;IE=mo;var cR={usingClientEntryPoint:!1,Events:[tu,fa,qh,bE,wE,Ty]},Rl={findFiberByHostInstance:Yi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},uR={bundleType:Rl.bundleType,version:Rl.version,rendererPackageName:Rl.rendererPackageName,rendererConfig:Rl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:As.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=CE(t),t===null?null:t.stateNode},findFiberByHostInstance:Rl.findFiberByHostInstance||aR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wu.isDisabled&&Wu.supportsFiber)try{Uh=Wu.inject(uR),Jr=Wu}catch{}}or.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cR;or.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ky(e))throw Error(re(200));return oR(t,e,null,n)};or.createRoot=function(t,e){if(!ky(t))throw Error(re(299));var n=!1,r="",s=iS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Ay(t,1,!1,null,null,n,!1,r,s),t[bs]=e.current,Nc(t.nodeType===8?t.parentNode:t),new Py(e)};or.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(re(188)):(t=Object.keys(t).join(","),Error(re(268,t)));return t=CE(e),t=t===null?null:t.stateNode,t};or.flushSync=function(t){return mo(t)};or.hydrate=function(t,e,n){if(!Zh(e))throw Error(re(200));return ef(null,t,e,!0,n)};or.hydrateRoot=function(t,e,n){if(!ky(t))throw Error(re(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=iS;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=sS(e,null,t,1,n??null,s,!1,i,a),t[bs]=e.current,Nc(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Jh(e)};or.render=function(t,e,n){if(!Zh(e))throw Error(re(200));return ef(null,t,e,!1,n)};or.unmountComponentAtNode=function(t){if(!Zh(t))throw Error(re(40));return t._reactRootContainer?(mo(function(){ef(null,null,t,!1,function(){t._reactRootContainer=null,t[bs]=null})}),!0):!1};or.unstable_batchedUpdates=Ty;or.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Zh(n))throw Error(re(200));if(t==null||t._reactInternals===void 0)throw Error(re(38));return ef(t,e,n,!1,r)};or.version="18.3.1-next-f1338f8080-20240426";function oS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(oS)}catch(t){console.error(t)}}oS(),oE.exports=or;var dR=oE.exports,aS,nb=dR;aS=nb.createRoot,nb.hydrateRoot;/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var rb="popstate";function hR(t={}){function e(r,s){let{pathname:i,search:a,hash:l}=r.location;return tg("",{pathname:i,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Vc(s)}return pR(e,n,null,t)}function Nt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function vr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function fR(){return Math.random().toString(36).substring(2,10)}function sb(t,e){return{usr:t.state,key:t.key,idx:e}}function tg(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?sl(e):e,state:n,key:e&&e.key||r||fR()}}function Vc({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function sl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function pR(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,l="POP",c=null,d=h();d==null&&(d=0,a.replaceState({...a.state,idx:d},""));function h(){return(a.state||{idx:null}).idx}function f(){l="POP";let C=h(),S=C==null?null:C-d;d=C,c&&c({action:l,location:N.location,delta:S})}function m(C,S){l="PUSH";let E=tg(N.location,C,S);d=h()+1;let g=sb(E,d),_=N.createHref(E);try{a.pushState(g,"",_)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;s.location.assign(_)}i&&c&&c({action:l,location:N.location,delta:1})}function x(C,S){l="REPLACE";let E=tg(N.location,C,S);d=h();let g=sb(E,d),_=N.createHref(E);a.replaceState(g,"",_),i&&c&&c({action:l,location:N.location,delta:0})}function T(C){return mR(C)}let N={get action(){return l},get location(){return t(s,a)},listen(C){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(rb,f),c=C,()=>{s.removeEventListener(rb,f),c=null}},createHref(C){return e(s,C)},createURL:T,encodeLocation(C){let S=T(C);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:m,replace:x,go(C){return a.go(C)}};return N}function mR(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Nt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Vc(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function lS(t,e,n="/"){return gR(t,e,n,!1)}function gR(t,e,n,r){let s=typeof e=="string"?sl(e):e,i=Is(s.pathname||"/",n);if(i==null)return null;let a=cS(t);yR(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let d=NR(i);l=TR(a[c],d,r)}return l}function cS(t,e=[],n=[],r="",s=!1){let i=(a,l,c=s,d)=>{let h={relativePath:d===void 0?a.path||"":d,caseSensitive:a.caseSensitive===!0,childrenIndex:l,route:a};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(r)&&c)return;Nt(h.relativePath.startsWith(r),`Absolute route path "${h.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(r.length)}let f=_s([r,h.relativePath]),m=n.concat(h);a.children&&a.children.length>0&&(Nt(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),cS(a.children,e,m,f,c)),!(a.path==null&&!a.index)&&e.push({path:f,score:IR(f,a.index),routesMeta:m})};return t.forEach((a,l)=>{var c;if(a.path===""||!((c=a.path)!=null&&c.includes("?")))i(a,l);else for(let d of uS(a.path))i(a,l,!0,d)}),e}function uS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=uS(r.join("/")),l=[];return l.push(...a.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...a),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function yR(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:SR(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var vR=/^:[\w-]+$/,_R=3,xR=2,bR=1,wR=10,ER=-2,ib=t=>t==="*";function IR(t,e){let n=t.split("/"),r=n.length;return n.some(ib)&&(r+=ER),e&&(r+=xR),n.filter(s=>!ib(s)).reduce((s,i)=>s+(vR.test(i)?_R:i===""?bR:wR),r)}function SR(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function TR(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",a=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",f=ah({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),m=c.route;if(!f&&d&&n&&!r[r.length-1].route.index&&(f=ah({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!f)return null;Object.assign(s,f.params),a.push({params:s,pathname:_s([i,f.pathname]),pathnameBase:kR(_s([i,f.pathnameBase])),route:m}),f.pathnameBase!=="/"&&(i=_s([i,f.pathnameBase]))}return a}function ah(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=CR(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,{paramName:h,isOptional:f},m)=>{if(h==="*"){let T=l[m]||"";a=i.slice(0,i.length-T.length).replace(/(.)\/+$/,"$1")}const x=l[m];return f&&!x?d[h]=void 0:d[h]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:t}}function CR(t,e=!1,n=!0){vr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function NR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return vr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Is(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var jR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,AR=t=>jR.test(t);function RR(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?sl(t):t,i;if(n)if(AR(n))i=n;else{if(n.includes("//")){let a=n;n=n.replace(/\/\/+/g,"/"),vr(!1,`Pathnames cannot have embedded double slashes - normalizing ${a} -> ${n}`)}n.startsWith("/")?i=ob(n.substring(1),"/"):i=ob(n,e)}else i=e;return{pathname:i,search:DR(r),hash:OR(s)}}function ob(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Cp(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function PR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Dy(t){let e=PR(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Oy(t,e,n,r=!1){let s;typeof t=="string"?s=sl(t):(s={...t},Nt(!s.pathname||!s.pathname.includes("?"),Cp("?","pathname","search",s)),Nt(!s.pathname||!s.pathname.includes("#"),Cp("#","pathname","hash",s)),Nt(!s.search||!s.search.includes("#"),Cp("#","search","hash",s)));let i=t===""||s.pathname==="",a=i?"/":s.pathname,l;if(a==null)l=n;else{let f=e.length-1;if(!r&&a.startsWith("..")){let m=a.split("/");for(;m[0]==="..";)m.shift(),f-=1;s.pathname=m.join("/")}l=f>=0?e[f]:"/"}let c=RR(s,l),d=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}var _s=t=>t.join("/").replace(/\/\/+/g,"/"),kR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),DR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,OR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function LR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var dS=["POST","PUT","PATCH","DELETE"];new Set(dS);var VR=["GET",...dS];new Set(VR);var il=b.createContext(null);il.displayName="DataRouter";var tf=b.createContext(null);tf.displayName="DataRouterState";b.createContext(!1);var hS=b.createContext({isTransitioning:!1});hS.displayName="ViewTransition";var MR=b.createContext(new Map);MR.displayName="Fetchers";var FR=b.createContext(null);FR.displayName="Await";var Mr=b.createContext(null);Mr.displayName="Navigation";var ru=b.createContext(null);ru.displayName="Location";var Fr=b.createContext({outlet:null,matches:[],isDataRoute:!1});Fr.displayName="Route";var Ly=b.createContext(null);Ly.displayName="RouteError";function UR(t,{relative:e}={}){Nt(ol(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=b.useContext(Mr),{hash:s,pathname:i,search:a}=su(t,{relative:e}),l=i;return n!=="/"&&(l=i==="/"?n:_s([n,i])),r.createHref({pathname:l,search:a,hash:s})}function ol(){return b.useContext(ru)!=null}function Mn(){return Nt(ol(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(ru).location}var fS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function pS(t){b.useContext(Mr).static||b.useLayoutEffect(t)}function is(){let{isDataRoute:t}=b.useContext(Fr);return t?eP():$R()}function $R(){Nt(ol(),"useNavigate() may be used only in the context of a <Router> component.");let t=b.useContext(il),{basename:e,navigator:n}=b.useContext(Mr),{matches:r}=b.useContext(Fr),{pathname:s}=Mn(),i=JSON.stringify(Dy(r)),a=b.useRef(!1);return pS(()=>{a.current=!0}),b.useCallback((c,d={})=>{if(vr(a.current,fS),!a.current)return;if(typeof c=="number"){n.go(c);return}let h=Oy(c,JSON.parse(i),s,d.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:_s([e,h.pathname])),(d.replace?n.replace:n.push)(h,d.state,d)},[e,n,i,s,t])}b.createContext(null);function BR(){let{matches:t}=b.useContext(Fr),e=t[t.length-1];return e?e.params:{}}function su(t,{relative:e}={}){let{matches:n}=b.useContext(Fr),{pathname:r}=Mn(),s=JSON.stringify(Dy(n));return b.useMemo(()=>Oy(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function zR(t,e){return mS(t,e)}function mS(t,e,n,r,s){var E;Nt(ol(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=b.useContext(Mr),{matches:a}=b.useContext(Fr),l=a[a.length-1],c=l?l.params:{},d=l?l.pathname:"/",h=l?l.pathnameBase:"/",f=l&&l.route;{let g=f&&f.path||"";gS(d,!f||g.endsWith("*")||g.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${g}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${g}"> to <Route path="${g==="/"?"*":`${g}/*`}">.`)}let m=Mn(),x;if(e){let g=typeof e=="string"?sl(e):e;Nt(h==="/"||((E=g.pathname)==null?void 0:E.startsWith(h)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${g.pathname}" was given in the \`location\` prop.`),x=g}else x=m;let T=x.pathname||"/",N=T;if(h!=="/"){let g=h.replace(/^\//,"").split("/");N="/"+T.replace(/^\//,"").split("/").slice(g.length).join("/")}let C=lS(t,{pathname:N});vr(f||C!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),vr(C==null||C[C.length-1].route.element!==void 0||C[C.length-1].route.Component!==void 0||C[C.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let S=KR(C&&C.map(g=>Object.assign({},g,{params:Object.assign({},c,g.params),pathname:_s([h,i.encodeLocation?i.encodeLocation(g.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?h:_s([h,i.encodeLocation?i.encodeLocation(g.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:g.pathnameBase])})),a,n,r,s);return e&&S?b.createElement(ru.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},S):S}function qR(){let t=ZR(),e=LR(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",t),a=b.createElement(b.Fragment,null,b.createElement("p",null," Hey developer "),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:i},"ErrorBoundary")," or"," ",b.createElement("code",{style:i},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},e),n?b.createElement("pre",{style:s},n):null,a)}var HR=b.createElement(qR,null),WR=class extends b.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?b.createElement(Fr.Provider,{value:this.props.routeContext},b.createElement(Ly.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function GR({routeContext:t,match:e,children:n}){let r=b.useContext(il);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),b.createElement(Fr.Provider,{value:t},n)}function KR(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,a=n==null?void 0:n.errors;if(a!=null){let h=i.findIndex(f=>f.route.id&&(a==null?void 0:a[f.route.id])!==void 0);Nt(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),i=i.slice(0,Math.min(i.length,h+1))}let l=!1,c=-1;if(n)for(let h=0;h<i.length;h++){let f=i[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(c=h),f.route.id){let{loaderData:m,errors:x}=n,T=f.route.loader&&!m.hasOwnProperty(f.route.id)&&(!x||x[f.route.id]===void 0);if(f.route.lazy||T){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}let d=n&&r?(h,f)=>{var m,x;r(h,{location:n.location,params:((x=(m=n.matches)==null?void 0:m[0])==null?void 0:x.params)??{},errorInfo:f})}:void 0;return i.reduceRight((h,f,m)=>{let x,T=!1,N=null,C=null;n&&(x=a&&f.route.id?a[f.route.id]:void 0,N=f.route.errorElement||HR,l&&(c<0&&m===0?(gS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),T=!0,C=null):c===m&&(T=!0,C=f.route.hydrateFallbackElement||null)));let S=e.concat(i.slice(0,m+1)),E=()=>{let g;return x?g=N:T?g=C:f.route.Component?g=b.createElement(f.route.Component,null):f.route.element?g=f.route.element:g=h,b.createElement(GR,{match:f,routeContext:{outlet:h,matches:S,isDataRoute:n!=null},children:g})};return n&&(f.route.ErrorBoundary||f.route.errorElement||m===0)?b.createElement(WR,{location:n.location,revalidation:n.revalidation,component:N,error:x,children:E(),routeContext:{outlet:null,matches:S,isDataRoute:!0},onError:d}):E()},null)}function Vy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function QR(t){let e=b.useContext(il);return Nt(e,Vy(t)),e}function YR(t){let e=b.useContext(tf);return Nt(e,Vy(t)),e}function XR(t){let e=b.useContext(Fr);return Nt(e,Vy(t)),e}function My(t){let e=XR(t),n=e.matches[e.matches.length-1];return Nt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function JR(){return My("useRouteId")}function ZR(){var r;let t=b.useContext(Ly),e=YR("useRouteError"),n=My("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function eP(){let{router:t}=QR("useNavigate"),e=My("useNavigate"),n=b.useRef(!1);return pS(()=>{n.current=!0}),b.useCallback(async(s,i={})=>{vr(n.current,fS),n.current&&(typeof s=="number"?t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var ab={};function gS(t,e,n){!e&&!ab[t]&&(ab[t]=!0,vr(!1,n))}b.memo(tP);function tP({routes:t,future:e,state:n,unstable_onError:r}){return mS(t,void 0,n,r,e)}function lh({to:t,replace:e,state:n,relative:r}){Nt(ol(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=b.useContext(Mr);vr(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=b.useContext(Fr),{pathname:a}=Mn(),l=is(),c=Oy(t,Dy(i),a,r==="path"),d=JSON.stringify(c);return b.useEffect(()=>{l(JSON.parse(d),{replace:e,state:n,relative:r})},[l,d,r,e,n]),null}function na(t){Nt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function nP({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1}){Nt(!ol(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=b.useMemo(()=>({basename:a,navigator:s,static:i,future:{}}),[a,s,i]);typeof n=="string"&&(n=sl(n));let{pathname:c="/",search:d="",hash:h="",state:f=null,key:m="default"}=n,x=b.useMemo(()=>{let T=Is(c,a);return T==null?null:{location:{pathname:T,search:d,hash:h,state:f,key:m},navigationType:r}},[a,c,d,h,f,m,r]);return vr(x!=null,`<Router basename="${a}"> is not able to match the URL "${c}${d}${h}" because it does not start with the basename, so the <Router> won't render anything.`),x==null?null:b.createElement(Mr.Provider,{value:l},b.createElement(ru.Provider,{children:e,value:x}))}function rP({children:t,location:e}){return zR(ng(t),e)}function ng(t,e=[]){let n=[];return b.Children.forEach(t,(r,s)=>{if(!b.isValidElement(r))return;let i=[...e,s];if(r.type===b.Fragment){n.push.apply(n,ng(r.props.children,i));return}Nt(r.type===na,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Nt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=ng(r.props.children,i)),n.push(a)}),n}var vd="get",_d="application/x-www-form-urlencoded";function nf(t){return t!=null&&typeof t.tagName=="string"}function sP(t){return nf(t)&&t.tagName.toLowerCase()==="button"}function iP(t){return nf(t)&&t.tagName.toLowerCase()==="form"}function oP(t){return nf(t)&&t.tagName.toLowerCase()==="input"}function aP(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function lP(t,e){return t.button===0&&(!e||e==="_self")&&!aP(t)}var Gu=null;function cP(){if(Gu===null)try{new FormData(document.createElement("form"),0),Gu=!1}catch{Gu=!0}return Gu}var uP=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Np(t){return t!=null&&!uP.has(t)?(vr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${_d}"`),null):t}function dP(t,e){let n,r,s,i,a;if(iP(t)){let l=t.getAttribute("action");r=l?Is(l,e):null,n=t.getAttribute("method")||vd,s=Np(t.getAttribute("enctype"))||_d,i=new FormData(t)}else if(sP(t)||oP(t)&&(t.type==="submit"||t.type==="image")){let l=t.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||l.getAttribute("action");if(r=c?Is(c,e):null,n=t.getAttribute("formmethod")||l.getAttribute("method")||vd,s=Np(t.getAttribute("formenctype"))||Np(l.getAttribute("enctype"))||_d,i=new FormData(l,t),!cP()){let{name:d,type:h,value:f}=t;if(h==="image"){let m=d?`${d}.`:"";i.append(`${m}x`,"0"),i.append(`${m}y`,"0")}else d&&i.append(d,f)}}else{if(nf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=vd,r=null,s=_d,a=t}return i&&s==="text/plain"&&(a=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Fy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function hP(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Is(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function fP(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function pP(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function mP(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let a=await fP(i,n);return a.links?a.links():[]}return[]}));return _P(r.flat(1).filter(pP).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function lb(t,e,n,r,s,i){let a=(c,d)=>n[d]?c.route.id!==n[d].route.id:!0,l=(c,d)=>{var h;return n[d].pathname!==c.pathname||((h=n[d].route.path)==null?void 0:h.endsWith("*"))&&n[d].params["*"]!==c.params["*"]};return i==="assets"?e.filter((c,d)=>a(c,d)||l(c,d)):i==="data"?e.filter((c,d)=>{var f;let h=r.routes[c.route.id];if(!h||!h.hasLoader)return!1;if(a(c,d)||l(c,d))return!0;if(c.route.shouldRevalidate){let m=c.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function gP(t,e,{includeHydrateFallback:n}={}){return yP(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function yP(t){return[...new Set(t)]}function vP(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function _P(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let i=JSON.stringify(vP(s));return n.has(i)||(n.add(i),r.push({key:i,link:s})),r},[])}function yS(){let t=b.useContext(il);return Fy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function xP(){let t=b.useContext(tf);return Fy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Uy=b.createContext(void 0);Uy.displayName="FrameworkContext";function vS(){let t=b.useContext(Uy);return Fy(t,"You must render this element inside a <HydratedRouter> element"),t}function bP(t,e){let n=b.useContext(Uy),[r,s]=b.useState(!1),[i,a]=b.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:d,onMouseLeave:h,onTouchStart:f}=e,m=b.useRef(null);b.useEffect(()=>{if(t==="render"&&a(!0),t==="viewport"){let N=S=>{S.forEach(E=>{a(E.isIntersecting)})},C=new IntersectionObserver(N,{threshold:.5});return m.current&&C.observe(m.current),()=>{C.disconnect()}}},[t]),b.useEffect(()=>{if(r){let N=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(N)}}},[r]);let x=()=>{s(!0)},T=()=>{s(!1),a(!1)};return n?t!=="intent"?[i,m,{}]:[i,m,{onFocus:Pl(l,x),onBlur:Pl(c,T),onMouseEnter:Pl(d,x),onMouseLeave:Pl(h,T),onTouchStart:Pl(f,x)}]:[!1,m,{}]}function Pl(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function wP({page:t,...e}){let{router:n}=yS(),r=b.useMemo(()=>lS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?b.createElement(IP,{page:t,matches:r,...e}):null}function EP(t){let{manifest:e,routeModules:n}=vS(),[r,s]=b.useState([]);return b.useEffect(()=>{let i=!1;return mP(t,e,n).then(a=>{i||s(a)}),()=>{i=!0}},[t,e,n]),r}function IP({page:t,matches:e,...n}){let r=Mn(),{manifest:s,routeModules:i}=vS(),{basename:a}=yS(),{loaderData:l,matches:c}=xP(),d=b.useMemo(()=>lb(t,e,c,s,r,"data"),[t,e,c,s,r]),h=b.useMemo(()=>lb(t,e,c,s,r,"assets"),[t,e,c,s,r]),f=b.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let T=new Set,N=!1;if(e.forEach(S=>{var g;let E=s.routes[S.route.id];!E||!E.hasLoader||(!d.some(_=>_.route.id===S.route.id)&&S.route.id in l&&((g=i[S.route.id])!=null&&g.shouldRevalidate)||E.hasClientLoader?N=!0:T.add(S.route.id))}),T.size===0)return[];let C=hP(t,a,"data");return N&&T.size>0&&C.searchParams.set("_routes",e.filter(S=>T.has(S.route.id)).map(S=>S.route.id).join(",")),[C.pathname+C.search]},[a,l,r,s,d,e,t,i]),m=b.useMemo(()=>gP(h,s),[h,s]),x=EP(h);return b.createElement(b.Fragment,null,f.map(T=>b.createElement("link",{key:T,rel:"prefetch",as:"fetch",href:T,...n})),m.map(T=>b.createElement("link",{key:T,rel:"modulepreload",href:T,...n})),x.map(({key:T,link:N})=>b.createElement("link",{key:T,nonce:n.nonce,...N})))}function SP(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var _S=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{_S&&(window.__reactRouterVersion="7.9.6")}catch{}function TP({basename:t,children:e,window:n}){let r=b.useRef();r.current==null&&(r.current=hR({window:n,v5Compat:!0}));let s=r.current,[i,a]=b.useState({action:s.action,location:s.location}),l=b.useCallback(c=>{b.startTransition(()=>a(c))},[a]);return b.useLayoutEffect(()=>s.listen(l),[s,l]),b.createElement(nP,{basename:t,children:e,location:i.location,navigationType:i.action,navigator:s})}var xS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,bS=b.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:a,state:l,target:c,to:d,preventScrollReset:h,viewTransition:f,...m},x){let{basename:T}=b.useContext(Mr),N=typeof d=="string"&&xS.test(d),C,S=!1;if(typeof d=="string"&&N&&(C=d,_S))try{let I=new URL(window.location.href),R=d.startsWith("//")?new URL(I.protocol+d):new URL(d),P=Is(R.pathname,T);R.origin===I.origin&&P!=null?d=P+R.search+R.hash:S=!0}catch{vr(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let E=UR(d,{relative:s}),[g,_,O]=bP(r,m),L=jP(d,{replace:a,state:l,target:c,preventScrollReset:h,relative:s,viewTransition:f});function v(I){e&&e(I),I.defaultPrevented||L(I)}let w=b.createElement("a",{...m,...O,href:C||E,onClick:S||i?e:v,ref:SP(x,_),target:c,"data-discover":!N&&n==="render"?"true":void 0});return g&&!N?b.createElement(b.Fragment,null,w,b.createElement(wP,{page:E})):w});bS.displayName="Link";var ra=b.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:a,viewTransition:l,children:c,...d},h){let f=su(a,{relative:d.relative}),m=Mn(),x=b.useContext(tf),{navigator:T,basename:N}=b.useContext(Mr),C=x!=null&&DP(f)&&l===!0,S=T.encodeLocation?T.encodeLocation(f).pathname:f.pathname,E=m.pathname,g=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;n||(E=E.toLowerCase(),g=g?g.toLowerCase():null,S=S.toLowerCase()),g&&N&&(g=Is(g,N)||g);const _=S!=="/"&&S.endsWith("/")?S.length-1:S.length;let O=E===S||!s&&E.startsWith(S)&&E.charAt(_)==="/",L=g!=null&&(g===S||!s&&g.startsWith(S)&&g.charAt(S.length)==="/"),v={isActive:O,isPending:L,isTransitioning:C},w=O?e:void 0,I;typeof r=="function"?I=r(v):I=[r,O?"active":null,L?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let R=typeof i=="function"?i(v):i;return b.createElement(bS,{...d,"aria-current":w,className:I,ref:h,style:R,to:a,viewTransition:l},typeof c=="function"?c(v):c)});ra.displayName="NavLink";var CP=b.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:a=vd,action:l,onSubmit:c,relative:d,preventScrollReset:h,viewTransition:f,...m},x)=>{let T=PP(),N=kP(l,{relative:d}),C=a.toLowerCase()==="get"?"get":"post",S=typeof l=="string"&&xS.test(l),E=g=>{if(c&&c(g),g.defaultPrevented)return;g.preventDefault();let _=g.nativeEvent.submitter,O=(_==null?void 0:_.getAttribute("formmethod"))||a;T(_||g.currentTarget,{fetcherKey:e,method:O,navigate:n,replace:s,state:i,relative:d,preventScrollReset:h,viewTransition:f})};return b.createElement("form",{ref:x,method:C,action:N,onSubmit:r?c:E,...m,"data-discover":!S&&t==="render"?"true":void 0})});CP.displayName="Form";function NP(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function wS(t){let e=b.useContext(il);return Nt(e,NP(t)),e}function jP(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:a}={}){let l=is(),c=Mn(),d=su(t,{relative:i});return b.useCallback(h=>{if(lP(h,e)){h.preventDefault();let f=n!==void 0?n:Vc(c)===Vc(d);l(t,{replace:f,state:r,preventScrollReset:s,relative:i,viewTransition:a})}},[c,l,d,n,r,e,t,s,i,a])}var AP=0,RP=()=>`__${String(++AP)}__`;function PP(){let{router:t}=wS("useSubmit"),{basename:e}=b.useContext(Mr),n=JR();return b.useCallback(async(r,s={})=>{let{action:i,method:a,encType:l,formData:c,body:d}=dP(r,e);if(s.navigate===!1){let h=s.fetcherKey||RP();await t.fetch(h,n,s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||a,formEncType:s.encType||l,flushSync:s.flushSync})}else await t.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||a,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:n,flushSync:s.flushSync,viewTransition:s.viewTransition})},[t,e,n])}function kP(t,{relative:e}={}){let{basename:n}=b.useContext(Mr),r=b.useContext(Fr);Nt(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...su(t||".",{relative:e})},a=Mn();if(t==null){i.search=a.search;let l=new URLSearchParams(i.search),c=l.getAll("index");if(c.some(h=>h==="")){l.delete("index"),c.filter(f=>f).forEach(f=>l.append("index",f));let h=l.toString();i.search=h?`?${h}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:_s([n,i.pathname])),Vc(i)}function DP(t,{relative:e}={}){let n=b.useContext(hS);Nt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=wS("useViewTransitionState"),s=su(t,{relative:e});if(!n.isTransitioning)return!1;let i=Is(n.currentLocation.pathname,r)||n.currentLocation.pathname,a=Is(n.nextLocation.pathname,r)||n.nextLocation.pathname;return ah(s.pathname,a)!=null||ah(s.pathname,i)!=null}const OP=()=>{};var cb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ES=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},LP=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],a=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],a=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},IS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],a=s+1<t.length,l=a?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,h=i>>2,f=(i&3)<<4|l>>4;let m=(l&15)<<2|d>>6,x=d&63;c||(x=64,a||(m=64)),r.push(n[h],n[f],n[m],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ES(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):LP(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const f=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||f==null)throw new VP;const m=i<<2|l>>4;if(r.push(m),d!==64){const x=l<<4&240|d>>2;if(r.push(x),f!==64){const T=d<<6&192|f;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class VP extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const MP=function(t){const e=ES(t);return IS.encodeByteArray(e,!0)},ch=function(t){return MP(t).replace(/\./g,"")},SS=function(t){try{return IS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FP=()=>TS().__FIREBASE_DEFAULTS__,UP=()=>{if(typeof process>"u"||typeof cb>"u")return;const t=cb.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},$P=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&SS(t[1]);return e&&JSON.parse(e)},rf=()=>{try{return OP()||FP()||UP()||$P()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},CS=t=>{var e,n;return(n=(e=rf())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},NS=t=>{const e=CS(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},jS=()=>{var t;return(t=rf())==null?void 0:t.config},AS=t=>{var e;return(e=rf())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ni(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function $y(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RS(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[ch(JSON.stringify(n)),ch(JSON.stringify(a)),""].join(".")}const uc={};function zP(){const t={prod:[],emulator:[]};for(const e of Object.keys(uc))uc[e]?t.emulator.push(e):t.prod.push(e);return t}function qP(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let ub=!1;function By(t,e){if(typeof window>"u"||typeof document>"u"||!Ni(window.location.host)||uc[t]===e||uc[t]||ub)return;uc[t]=e;function n(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=zP().prod.length>0;function a(){const m=document.getElementById(r);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,x){m.setAttribute("width","24"),m.setAttribute("id",x),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function d(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{ub=!0,a()},m}function h(m,x){m.setAttribute("id",x),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=qP(r),x=n("text"),T=document.getElementById(x)||document.createElement("span"),N=n("learnmore"),C=document.getElementById(N)||document.createElement("a"),S=n("preprendIcon"),E=document.getElementById(S)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const g=m.element;l(g),h(C,N);const _=d();c(E,S),g.append(E,T,C,_),document.body.appendChild(g)}i?(T.innerText="Preview backend disconnected.",E.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(E.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,T.innerText="Preview backend running in this workspace."),T.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function en(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function HP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(en())}function PS(){var e;const t=(e=rf())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function WP(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function kS(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function GP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function KP(){const t=en();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function DS(){return!PS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function OS(){return!PS()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function zy(){try{return typeof indexedDB=="object"}catch{return!1}}function LS(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}function QP(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YP="FirebaseError";class xr extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=YP,Object.setPrototypeOf(this,xr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Do.prototype.create)}}class Do{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?XP(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new xr(s,l,r)}}function XP(t,e){return t.replace(JP,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const JP=/\{\$([^}]+)}/g;function ZP(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ss(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],a=e[s];if(db(i)&&db(a)){if(!Ss(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function db(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Wl(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Gl(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function ek(t,e){const n=new tk(t,e);return n.subscribe.bind(n)}class tk{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");nk(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=jp),s.error===void 0&&(s.error=jp),s.complete===void 0&&(s.complete=jp);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nk(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function jp(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rk=1e3,sk=2,ik=4*60*60*1e3,ok=.5;function hb(t,e=rk,n=sk){const r=e*Math.pow(n,t),s=Math.round(ok*r*(Math.random()-.5)*2);return Math.min(ik,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ht(t){return t&&t._delegate?t._delegate:t}class _r{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ak{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new BP;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ck(e))try{this.getOrInitializeService({instanceIdentifier:Bi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Bi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Bi){return this.instances.has(e)}getOptions(e=Bi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:lk(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Bi){return this.component?this.component.multipleInstances?e:Bi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function lk(t){return t===Bi?void 0:t}function ck(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new ak(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(tt||(tt={}));const dk={debug:tt.DEBUG,verbose:tt.VERBOSE,info:tt.INFO,warn:tt.WARN,error:tt.ERROR,silent:tt.SILENT},hk=tt.INFO,fk={[tt.DEBUG]:"log",[tt.VERBOSE]:"log",[tt.INFO]:"info",[tt.WARN]:"warn",[tt.ERROR]:"error"},pk=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=fk[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class sf{constructor(e){this.name=e,this._logLevel=hk,this._logHandler=pk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in tt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?dk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,tt.DEBUG,...e),this._logHandler(this,tt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,tt.VERBOSE,...e),this._logHandler(this,tt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,tt.INFO,...e),this._logHandler(this,tt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,tt.WARN,...e),this._logHandler(this,tt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,tt.ERROR,...e),this._logHandler(this,tt.ERROR,...e)}}const mk=(t,e)=>e.some(n=>t instanceof n);let fb,pb;function gk(){return fb||(fb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function yk(){return pb||(pb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const VS=new WeakMap,rg=new WeakMap,MS=new WeakMap,Ap=new WeakMap,qy=new WeakMap;function vk(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(hi(t.result)),s()},a=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&VS.set(n,t)}).catch(()=>{}),qy.set(e,t),e}function _k(t){if(rg.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});rg.set(t,e)}let sg={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return rg.get(t);if(e==="objectStoreNames")return t.objectStoreNames||MS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return hi(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function xk(t){sg=t(sg)}function bk(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Rp(this),e,...n);return MS.set(r,e.sort?e.sort():[e]),hi(r)}:yk().includes(t)?function(...e){return t.apply(Rp(this),e),hi(VS.get(this))}:function(...e){return hi(t.apply(Rp(this),e))}}function wk(t){return typeof t=="function"?bk(t):(t instanceof IDBTransaction&&_k(t),mk(t,gk())?new Proxy(t,sg):t)}function hi(t){if(t instanceof IDBRequest)return vk(t);if(Ap.has(t))return Ap.get(t);const e=wk(t);return e!==t&&(Ap.set(t,e),qy.set(e,t)),e}const Rp=t=>qy.get(t);function FS(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),l=hi(a);return r&&a.addEventListener("upgradeneeded",c=>{r(hi(a.result),c.oldVersion,c.newVersion,hi(a.transaction),c)}),n&&a.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const Ek=["get","getKey","getAll","getAllKeys","count"],Ik=["put","add","delete","clear"],Pp=new Map;function mb(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Pp.get(e))return Pp.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=Ik.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Ek.includes(n)))return;const i=async function(a,...l){const c=this.transaction(a,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return Pp.set(e,i),i}xk(t=>({...t,get:(e,n,r)=>mb(e,n)||t.get(e,n,r),has:(e,n)=>!!mb(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Tk(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function Tk(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ig="@firebase/app",gb="0.14.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ts=new sf("@firebase/app"),Ck="@firebase/app-compat",Nk="@firebase/analytics-compat",jk="@firebase/analytics",Ak="@firebase/app-check-compat",Rk="@firebase/app-check",Pk="@firebase/auth",kk="@firebase/auth-compat",Dk="@firebase/database",Ok="@firebase/data-connect",Lk="@firebase/database-compat",Vk="@firebase/functions",Mk="@firebase/functions-compat",Fk="@firebase/installations",Uk="@firebase/installations-compat",$k="@firebase/messaging",Bk="@firebase/messaging-compat",zk="@firebase/performance",qk="@firebase/performance-compat",Hk="@firebase/remote-config",Wk="@firebase/remote-config-compat",Gk="@firebase/storage",Kk="@firebase/storage-compat",Qk="@firebase/firestore",Yk="@firebase/ai",Xk="@firebase/firestore-compat",Jk="firebase",Zk="12.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const og="[DEFAULT]",eD={[ig]:"fire-core",[Ck]:"fire-core-compat",[jk]:"fire-analytics",[Nk]:"fire-analytics-compat",[Rk]:"fire-app-check",[Ak]:"fire-app-check-compat",[Pk]:"fire-auth",[kk]:"fire-auth-compat",[Dk]:"fire-rtdb",[Ok]:"fire-data-connect",[Lk]:"fire-rtdb-compat",[Vk]:"fire-fn",[Mk]:"fire-fn-compat",[Fk]:"fire-iid",[Uk]:"fire-iid-compat",[$k]:"fire-fcm",[Bk]:"fire-fcm-compat",[zk]:"fire-perf",[qk]:"fire-perf-compat",[Hk]:"fire-rc",[Wk]:"fire-rc-compat",[Gk]:"fire-gcs",[Kk]:"fire-gcs-compat",[Qk]:"fire-fst",[Xk]:"fire-fst-compat",[Yk]:"fire-vertex","fire-js":"fire-js",[Jk]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uh=new Map,tD=new Map,ag=new Map;function yb(t,e){try{t.container.addComponent(e)}catch(n){Ts.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Or(t){const e=t.name;if(ag.has(e))return Ts.debug(`There were multiple attempts to register component ${e}.`),!1;ag.set(e,t);for(const n of uh.values())yb(n,t);for(const n of tD.values())yb(n,t);return!0}function ji(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ur(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},fi=new Do("app","Firebase",nD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _r("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw fi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oo=Zk;function Hy(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:og,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw fi.create("bad-app-name",{appName:String(s)});if(n||(n=jS()),!n)throw fi.create("no-options");const i=uh.get(s);if(i){if(Ss(n,i.options)&&Ss(r,i.config))return i;throw fi.create("duplicate-app",{appName:s})}const a=new uk(s);for(const c of ag.values())a.addComponent(c);const l=new rD(n,r,a);return uh.set(s,l),l}function of(t=og){const e=uh.get(t);if(!e&&t===og&&jS())return Hy();if(!e)throw fi.create("no-app",{appName:t});return e}function Gn(t,e,n){let r=eD[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ts.warn(a.join(" "));return}Or(new _r(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD="firebase-heartbeat-database",iD=1,Mc="firebase-heartbeat-store";let kp=null;function US(){return kp||(kp=FS(sD,iD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Mc)}catch(n){console.warn(n)}}}}).catch(t=>{throw fi.create("idb-open",{originalErrorMessage:t.message})})),kp}async function oD(t){try{const n=(await US()).transaction(Mc),r=await n.objectStore(Mc).get($S(t));return await n.done,r}catch(e){if(e instanceof xr)Ts.warn(e.message);else{const n=fi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ts.warn(n.message)}}}async function vb(t,e){try{const r=(await US()).transaction(Mc,"readwrite");await r.objectStore(Mc).put(e,$S(t)),await r.done}catch(n){if(n instanceof xr)Ts.warn(n.message);else{const r=fi.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Ts.warn(r.message)}}}function $S(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aD=1024,lD=30;class cD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new dD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=_b();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>lD){const a=hD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ts.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=_b(),{heartbeatsToSend:r,unsentEntries:s}=uD(this._heartbeatsCache.heartbeats),i=ch(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Ts.warn(n),""}}}function _b(){return new Date().toISOString().substring(0,10)}function uD(t,e=aD){const n=[];let r=t.slice();for(const s of t){const i=n.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),xb(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),xb(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class dD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return zy()?LS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await oD(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return vb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return vb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function xb(t){return ch(JSON.stringify({version:2,heartbeats:t})).length}function hD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fD(t){Or(new _r("platform-logger",e=>new Sk(e),"PRIVATE")),Or(new _r("heartbeat",e=>new cD(e),"PRIVATE")),Gn(ig,gb,t),Gn(ig,gb,"esm2020"),Gn("fire-js","")}fD("");var pD="firebase",mD="12.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Gn(pD,mD,"app");function BS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const gD=BS,zS=new Do("auth","Firebase",BS());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dh=new sf("@firebase/auth");function yD(t,...e){dh.logLevel<=tt.WARN&&dh.warn(`Auth (${Oo}): ${t}`,...e)}function xd(t,...e){dh.logLevel<=tt.ERROR&&dh.error(`Auth (${Oo}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lr(t,...e){throw Wy(t,...e)}function es(t,...e){return Wy(t,...e)}function qS(t,e,n){const r={...gD(),[e]:n};return new Do("auth","Firebase",r).create(e,{appName:t.name})}function pi(t){return qS(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return zS.create(t,...e)}function Ve(t,e,...n){if(!t)throw Wy(e,...n)}function ms(t){const e="INTERNAL ASSERTION FAILED: "+t;throw xd(e),new Error(e)}function Cs(t,e){t||ms(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lg(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function vD(){return bb()==="http:"||bb()==="https:"}function bb(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _D(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(vD()||kS()||"connection"in navigator)?navigator.onLine:!0}function xD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou{constructor(e,n){this.shortDelay=e,this.longDelay=n,Cs(n>e,"Short delay should be less than long delay!"),this.isMobile=HP()||GP()}get(){return _D()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gy(t,e){Cs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HS{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ms("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ms("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ms("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],ED=new ou(3e4,6e4);function Lo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ai(t,e,n,r,s={}){return WS(t,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=iu({key:t.config.apiKey,...a}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return WP()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&Ni(t.emulatorConfig.host)&&(d.credentials="include"),HS.fetch()(await GS(t,t.config.apiHost,n,l),d)})}async function WS(t,e,n){t._canInitEmulator=!1;const r={...bD,...e};try{const s=new SD(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Ku(t,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ku(t,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw Ku(t,"email-already-in-use",a);if(c==="USER_DISABLED")throw Ku(t,"user-disabled",a);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw qS(t,h,d);Lr(t,h)}}catch(s){if(s instanceof xr)throw s;Lr(t,"network-request-failed",{message:String(s)})}}async function af(t,e,n,r,s={}){const i=await Ai(t,e,n,r,s);return"mfaPendingCredential"in i&&Lr(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function GS(t,e,n,r){const s=`${e}${n}?${r}`,i=t,a=i.config.emulator?Gy(t.config,s):`${t.config.apiScheme}://${s}`;return wD.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function ID(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class SD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(es(this.auth,"network-request-failed")),ED.get())})}}function Ku(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=es(t,e,r);return s.customData._tokenResponse=n,s}function wb(t){return t!==void 0&&t.enterprise!==void 0}class TD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return ID(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function CD(t,e){return Ai(t,"GET","/v2/recaptchaConfig",Lo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ND(t,e){return Ai(t,"POST","/v1/accounts:delete",e)}async function hh(t,e){return Ai(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function jD(t,e=!1){const n=ht(t),r=await n.getIdToken(e),s=Ky(r);Ve(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:dc(Dp(s.auth_time)),issuedAtTime:dc(Dp(s.iat)),expirationTime:dc(Dp(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Dp(t){return Number(t)*1e3}function Ky(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return xd("JWT malformed, contained fewer than 3 sections"),null;try{const s=SS(n);return s?JSON.parse(s):(xd("Failed to decode base64 JWT payload"),null)}catch(s){return xd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Eb(t){const e=Ky(t);return Ve(e,"internal-error"),Ve(typeof e.exp<"u","internal-error"),Ve(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof xr&&AD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function AD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=dc(this.lastLoginAt),this.creationTime=dc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fh(t){var f;const e=t.auth,n=await t.getIdToken(),r=await Fc(t,hh(e,{idToken:n}));Ve(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?KS(s.providerUserInfo):[],a=kD(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new cg(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,h)}async function PD(t){const e=ht(t);await fh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function kD(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function KS(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DD(t,e){const n=await WS(t,{},async()=>{const r=iu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,a=await GS(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&Ni(t.emulatorConfig.host)&&(c.credentials="include"),HS.fetch()(a,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function OD(t,e){return Ai(t,"POST","/v2/accounts:revokeToken",Lo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ve(e.idToken,"internal-error"),Ve(typeof e.idToken<"u","internal-error"),Ve(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Eb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ve(e.length!==0,"internal-error");const n=Eb(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ve(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await DD(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,a=new Ca;return r&&(Ve(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(Ve(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(Ve(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ca,this.toJSON())}_performRefresh(){return ms("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fs(t,e){Ve(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Ar{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new RD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new cg(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Fc(this,this.stsTokenManager.getToken(this.auth,e));return Ve(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return jD(this,e)}reload(){return PD(this)}_assign(e){this!==e&&(Ve(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Ar({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ve(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await fh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ur(this.auth.app))return Promise.reject(pi(this.auth));const e=await this.getIdToken();return await Fc(this,ND(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,a=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,h=n.lastLoginAt??void 0,{uid:f,emailVerified:m,isAnonymous:x,providerData:T,stsTokenManager:N}=n;Ve(f&&N,e,"internal-error");const C=Ca.fromJSON(this.name,N);Ve(typeof f=="string",e,"internal-error"),Fs(r,e.name),Fs(s,e.name),Ve(typeof m=="boolean",e,"internal-error"),Ve(typeof x=="boolean",e,"internal-error"),Fs(i,e.name),Fs(a,e.name),Fs(l,e.name),Fs(c,e.name),Fs(d,e.name),Fs(h,e.name);const S=new Ar({uid:f,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:x,photoURL:a,phoneNumber:i,tenantId:l,stsTokenManager:C,createdAt:d,lastLoginAt:h});return T&&Array.isArray(T)&&(S.providerData=T.map(E=>({...E}))),c&&(S._redirectEventId=c),S}static async _fromIdTokenResponse(e,n,r=!1){const s=new Ca;s.updateFromServerResponse(n);const i=new Ar({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await fh(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ve(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?KS(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new Ca;l.updateFromIdToken(r);const c=new Ar({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new cg(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ib=new Map;function gs(t){Cs(t instanceof Function,"Expected a class definition");let e=Ib.get(t);return e?(Cs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Ib.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QS{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}QS.type="NONE";const Sb=QS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bd(t,e,n){return`firebase:${t}:${e}:${n}`}class Na{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=bd(this.userKey,s.apiKey,i),this.fullPersistenceKey=bd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await hh(this.auth,{idToken:e}).catch(()=>{});return n?Ar._fromGetAccountInfoResponse(this.auth,n,e):null}return Ar._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Na(gs(Sb),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||gs(Sb);const a=bd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const h=await d._get(a);if(h){let f;if(typeof h=="string"){const m=await hh(e,{idToken:h}).catch(()=>{});if(!m)break;f=await Ar._fromGetAccountInfoResponse(e,m,h)}else f=Ar._fromJSON(e,h);d!==i&&(l=f),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Na(i,e,r):(i=c[0],l&&await i._set(a,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new Na(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tb(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ZS(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(YS(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(tT(e))return"Blackberry";if(nT(e))return"Webos";if(XS(e))return"Safari";if((e.includes("chrome/")||JS(e))&&!e.includes("edge/"))return"Chrome";if(eT(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function YS(t=en()){return/firefox\//i.test(t)}function XS(t=en()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function JS(t=en()){return/crios\//i.test(t)}function ZS(t=en()){return/iemobile/i.test(t)}function eT(t=en()){return/android/i.test(t)}function tT(t=en()){return/blackberry/i.test(t)}function nT(t=en()){return/webos/i.test(t)}function Qy(t=en()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function LD(t=en()){var e;return Qy(t)&&!!((e=window.navigator)!=null&&e.standalone)}function VD(){return KP()&&document.documentMode===10}function rT(t=en()){return Qy(t)||eT(t)||nT(t)||tT(t)||/windows phone/i.test(t)||ZS(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sT(t,e=[]){let n;switch(t){case"Browser":n=Tb(en());break;case"Worker":n=`${Tb(en())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Oo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((a,l)=>{try{const c=e(i);a(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FD(t,e={}){return Ai(t,"GET","/v2/passwordPolicy",Lo(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UD=6;class $D{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??UD,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BD{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Cb(this),this.idTokenSubscription=new Cb(this),this.beforeStateQueue=new MD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=zS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=gs(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Na.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await hh(this,{idToken:e}),r=await Ar._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(ur(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(a){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ve(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await fh(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=xD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ur(this.app))return Promise.reject(pi(this));const n=e?ht(e):null;return n&&Ve(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ve(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ur(this.app)?Promise.reject(pi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ur(this.app)?Promise.reject(pi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(gs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await FD(this),n=new $D(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Do("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await OD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&gs(e)||this._popupRedirectResolver;Ve(n,this,"argument-error"),this.redirectPersistenceManager=await Na.create(this,[gs(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ve(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{a=!0,c()}}else{const c=e.addObserver(n);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ve(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=sT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(ur(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&yD(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function al(t){return ht(t)}class Cb{constructor(e){this.auth=e,this.observer=null,this.addObserver=ek(n=>this.observer=n)}get next(){return Ve(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function zD(t){lf=t}function iT(t){return lf.loadJS(t)}function qD(){return lf.recaptchaEnterpriseScript}function HD(){return lf.gapiScript}function WD(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class GD{constructor(){this.enterprise=new KD}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class KD{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const QD="recaptcha-enterprise",oT="NO_RECAPTCHA";class YD{constructor(e){this.type=QD,this.auth=al(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{CD(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new TD(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,a,l){const c=window.grecaptcha;wb(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(oT)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new GD().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(l=>{if(!n&&wb(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=qD();c.length!==0&&(c+=l),iT(c).then(()=>{s(l,i,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function Nb(t,e,n,r=!1,s=!1){const i=new YD(t);let a;if(s)a=oT;else try{a=await i.verify(n)}catch{a=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function jb(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Nb(t,e,n,n==="getOobCode");return r(t,a)}else return r(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Nb(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XD(t,e){const n=ji(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Ss(i,e??{}))return s;Lr(s,"already-initialized")}return n.initialize({options:e})}function JD(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(gs);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function ZD(t,e,n){const r=al(t);Ve(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=aT(e),{host:a,port:l}=e2(e),c=l===null?"":`:${l}`,d={url:`${i}//${a}${c}/`},h=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Ve(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ve(Ss(d,r.config.emulator)&&Ss(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Ni(a)?($y(`${i}//${a}${c}`),By("Auth",!0)):t2()}function aT(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function e2(t){const e=aT(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Ab(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Ab(a)}}}function Ab(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function t2(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return ms("not implemented")}_getIdTokenResponse(e){return ms("not implemented")}_linkToIdToken(e,n){return ms("not implemented")}_getReauthenticationResolver(e){return ms("not implemented")}}async function n2(t,e){return Ai(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r2(t,e){return af(t,"POST","/v1/accounts:signInWithPassword",Lo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s2(t,e){return af(t,"POST","/v1/accounts:signInWithEmailLink",Lo(t,e))}async function i2(t,e){return af(t,"POST","/v1/accounts:signInWithEmailLink",Lo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc extends Yy{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Uc(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Uc(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jb(e,n,"signInWithPassword",r2);case"emailLink":return s2(e,{email:this._email,oobCode:this._password});default:Lr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jb(e,r,"signUpPassword",n2);case"emailLink":return i2(e,{idToken:n,email:this._email,oobCode:this._password});default:Lr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ja(t,e){return af(t,"POST","/v1/accounts:signInWithIdp",Lo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o2="http://localhost";class go extends Yy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new go(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Lr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const a=new go(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return ja(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,ja(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,ja(e,n)}buildRequest(){const e={requestUri:o2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=iu(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a2(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function l2(t){const e=Wl(Gl(t)).link,n=e?Wl(Gl(e)).deep_link_id:null,r=Wl(Gl(t)).deep_link_id;return(r?Wl(Gl(r)).link:null)||r||n||e||t}class Xy{constructor(e){const n=Wl(Gl(e)),r=n.apiKey??null,s=n.oobCode??null,i=a2(n.mode??null);Ve(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=l2(e);try{return new Xy(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(){this.providerId=ll.PROVIDER_ID}static credential(e,n){return Uc._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Xy.parseLink(n);return Ve(r,"argument-error"),Uc._fromEmailAndCode(e,r.code,r.tenantId)}}ll.PROVIDER_ID="password";ll.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ll.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au extends lT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks extends au{constructor(){super("facebook.com")}static credential(e){return go._fromParams({providerId:Ks.PROVIDER_ID,signInMethod:Ks.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ks.credentialFromTaggedObject(e)}static credentialFromError(e){return Ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ks.credential(e.oauthAccessToken)}catch{return null}}}Ks.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ks.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs extends au{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return go._fromParams({providerId:Qs.PROVIDER_ID,signInMethod:Qs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Qs.credentialFromTaggedObject(e)}static credentialFromError(e){return Qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Qs.credential(n,r)}catch{return null}}}Qs.GOOGLE_SIGN_IN_METHOD="google.com";Qs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys extends au{constructor(){super("github.com")}static credential(e){return go._fromParams({providerId:Ys.PROVIDER_ID,signInMethod:Ys.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ys.credentialFromTaggedObject(e)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ys.credential(e.oauthAccessToken)}catch{return null}}}Ys.GITHUB_SIGN_IN_METHOD="github.com";Ys.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs extends au{constructor(){super("twitter.com")}static credential(e,n){return go._fromParams({providerId:Xs.PROVIDER_ID,signInMethod:Xs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Xs.credentialFromTaggedObject(e)}static credentialFromError(e){return Xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Xs.credential(n,r)}catch{return null}}}Xs.TWITTER_SIGN_IN_METHOD="twitter.com";Xs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Ar._fromIdTokenResponse(e,r,s),a=Rb(r);return new $a({user:i,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=Rb(r);return new $a({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function Rb(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph extends xr{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ph.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new ph(e,n,r,s)}}function cT(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ph._fromErrorAndOperation(t,i,e,r):i})}async function c2(t,e,n=!1){const r=await Fc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return $a._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u2(t,e,n=!1){const{auth:r}=t;if(ur(r.app))return Promise.reject(pi(r));const s="reauthenticate";try{const i=await Fc(t,cT(r,s,e,t),n);Ve(i.idToken,r,"internal-error");const a=Ky(i.idToken);Ve(a,r,"internal-error");const{sub:l}=a;return Ve(t.uid===l,r,"user-mismatch"),$a._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Lr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uT(t,e,n=!1){if(ur(t.app))return Promise.reject(pi(t));const r="signIn",s=await cT(t,r,e),i=await $a._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function d2(t,e){return uT(al(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h2(t){const e=al(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function f2(t,e,n){return ur(t.app)?Promise.reject(pi(t)):d2(ht(t),ll.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&h2(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p2(t,e){return ht(t).setPersistence(e)}function m2(t,e,n,r){return ht(t).onIdTokenChanged(e,n,r)}function g2(t,e,n){return ht(t).beforeAuthStateChanged(e,n)}function Jy(t,e,n,r){return ht(t).onAuthStateChanged(e,n,r)}function y2(t){return ht(t).signOut()}const mh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dT{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(mh,"1"),this.storage.removeItem(mh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v2=1e3,_2=10;class hT extends dT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=rT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,l,c)=>{this.notifyListeners(a,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);VD()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,_2):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},v2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}hT.type="LOCAL";const fT=hT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pT extends dT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}pT.type="SESSION";const mT=pT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new cf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(n.origin,i)),c=await x2(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}cf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,c)=>{const d=Zy("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===d)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(m.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ts(){return window}function w2(t){ts().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gT(){return typeof ts().WorkerGlobalScope<"u"&&typeof ts().importScripts=="function"}async function E2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function I2(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function S2(){return gT()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yT="firebaseLocalStorageDb",T2=1,gh="firebaseLocalStorage",vT="fbase_key";class lu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function uf(t,e){return t.transaction([gh],e?"readwrite":"readonly").objectStore(gh)}function C2(){const t=indexedDB.deleteDatabase(yT);return new lu(t).toPromise()}function ug(){const t=indexedDB.open(yT,T2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(gh,{keyPath:vT})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(gh)?e(r):(r.close(),await C2(),e(await ug()))})})}async function Pb(t,e,n){const r=uf(t,!0).put({[vT]:e,value:n});return new lu(r).toPromise()}async function N2(t,e){const n=uf(t,!1).get(e),r=await new lu(n).toPromise();return r===void 0?null:r.value}function kb(t,e){const n=uf(t,!0).delete(e);return new lu(n).toPromise()}const j2=800,A2=3;class _T{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ug(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>A2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return gT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=cf._getInstance(S2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await E2(),!this.activeServiceWorker)return;this.sender=new b2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||I2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ug();return await Pb(e,mh,"1"),await kb(e,mh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Pb(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>N2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>kb(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=uf(s,!1).getAll();return new lu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),j2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}_T.type="LOCAL";const R2=_T;new ou(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P2(t,e){return e?gs(e):(Ve(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev extends Yy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ja(e,this._buildIdpRequest())}_linkToIdToken(e,n){return ja(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return ja(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function k2(t){return uT(t.auth,new ev(t),t.bypassAuthState)}function D2(t){const{auth:e,user:n}=t;return Ve(n,e,"internal-error"),u2(n,new ev(t),t.bypassAuthState)}async function O2(t){const{auth:e,user:n}=t;return Ve(n,e,"internal-error"),c2(n,new ev(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xT{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return k2;case"linkViaPopup":case"linkViaRedirect":return O2;case"reauthViaPopup":case"reauthViaRedirect":return D2;default:Lr(this.auth,"internal-error")}}resolve(e){Cs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Cs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L2=new ou(2e3,1e4);class xa extends xT{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,xa.currentPopupAction&&xa.currentPopupAction.cancel(),xa.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ve(e,this.auth,"internal-error"),e}async onExecution(){Cs(this.filter.length===1,"Popup operations only handle one event");const e=Zy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(es(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(es(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xa.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(es(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,L2.get())};e()}}xa.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V2="pendingRedirect",wd=new Map;class M2 extends xT{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=wd.get(this.auth._key());if(!e){try{const r=await F2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}wd.set(this.auth._key(),e)}return this.bypassAuthState||wd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function F2(t,e){const n=B2(e),r=$2(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function U2(t,e){wd.set(t._key(),e)}function $2(t){return gs(t._redirectPersistence)}function B2(t){return bd(V2,t.config.apiKey,t.name)}async function z2(t,e,n=!1){if(ur(t.app))return Promise.reject(pi(t));const r=al(t),s=P2(r,e),a=await new M2(r,s,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q2=10*60*1e3;class H2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!W2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!bT(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(es(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=q2&&this.cachedEventUids.clear(),this.cachedEventUids.has(Db(e))}saveEventToCache(e){this.cachedEventUids.add(Db(e)),this.lastProcessedEventTime=Date.now()}}function Db(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function bT({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function W2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return bT(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G2(t,e={}){return Ai(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Q2=/^https?/;async function Y2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await G2(t);for(const n of e)try{if(X2(n))return}catch{}Lr(t,"unauthorized-domain")}function X2(t){const e=lg(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!Q2.test(n))return!1;if(K2.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2=new ou(3e4,6e4);function Ob(){const t=ts().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function Z2(t){return new Promise((e,n)=>{var s,i,a;function r(){Ob(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Ob(),n(es(t,"network-request-failed"))},timeout:J2.get()})}if((i=(s=ts().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((a=ts().gapi)!=null&&a.load)r();else{const l=WD("iframefcb");return ts()[l]=()=>{gapi.load?r():n(es(t,"network-request-failed"))},iT(`${HD()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw Ed=null,e})}let Ed=null;function eO(t){return Ed=Ed||Z2(t),Ed}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tO=new ou(5e3,15e3),nO="__/auth/iframe",rO="emulator/auth/iframe",sO={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},iO=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function oO(t){const e=t.config;Ve(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Gy(e,rO):`https://${t.config.authDomain}/${nO}`,r={apiKey:e.apiKey,appName:t.name,v:Oo},s=iO.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${iu(r).slice(1)}`}async function aO(t){const e=await eO(t),n=ts().gapi;return Ve(n,t,"internal-error"),e.open({where:document.body,url:oO(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:sO,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=es(t,"network-request-failed"),l=ts().setTimeout(()=>{i(a)},tO.get());function c(){ts().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},cO=500,uO=600,dO="_blank",hO="http://localhost";class Lb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function fO(t,e,n,r=cO,s=uO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...lO,width:r.toString(),height:s.toString(),top:i,left:a},d=en().toLowerCase();n&&(l=JS(d)?dO:n),YS(d)&&(e=e||hO,c.scrollbars="yes");const h=Object.entries(c).reduce((m,[x,T])=>`${m}${x}=${T},`,"");if(LD(d)&&l!=="_self")return pO(e||"",l),new Lb(null);const f=window.open(e||"",l,h);Ve(f,t,"popup-blocked");try{f.focus()}catch{}return new Lb(f)}function pO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mO="__/auth/handler",gO="emulator/auth/handler",yO=encodeURIComponent("fac");async function Vb(t,e,n,r,s,i){Ve(t.config.authDomain,t,"auth-domain-config-required"),Ve(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Oo,eventId:s};if(e instanceof lT){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",ZP(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries({}))a[h]=f}if(e instanceof au){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(a.scopes=h.join(","))}t.tenantId&&(a.tid=t.tenantId);const l=a;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const c=await t._getAppCheckToken(),d=c?`#${yO}=${encodeURIComponent(c)}`:"";return`${vO(t)}?${iu(l).slice(1)}${d}`}function vO({config:t}){return t.emulator?Gy(t,gO):`https://${t.authDomain}/${mO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Op="webStorageSupport";class _O{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=mT,this._completeRedirectFn=z2,this._overrideRedirectResult=U2}async _openPopup(e,n,r,s){var a;Cs((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const i=await Vb(e,n,r,lg(),s);return fO(e,i,Zy())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Vb(e,n,r,lg(),s);return w2(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(Cs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await aO(e),r=new H2(e);return n.register("authEvent",s=>(Ve(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Op,{type:Op},s=>{var a;const i=(a=s==null?void 0:s[0])==null?void 0:a[Op];i!==void 0&&n(!!i),Lr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Y2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return rT()||XS()||Qy()}}const xO=_O;var Mb="@firebase/auth",Fb="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ve(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function EO(t){Or(new _r("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;Ve(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:sT(t)},d=new BD(r,s,i,c);return JD(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Or(new _r("auth-internal",e=>{const n=al(e.getProvider("auth").getImmediate());return(r=>new bO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Gn(Mb,Fb,wO(t)),Gn(Mb,Fb,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IO=5*60,SO=AS("authIdTokenMaxAge")||IO;let Ub=null;const TO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>SO)return;const s=n==null?void 0:n.token;Ub!==s&&(Ub=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function wT(t=of()){const e=ji(t,"auth");if(e.isInitialized())return e.getImmediate();const n=XD(t,{popupRedirectResolver:xO,persistence:[R2,fT,mT]}),r=AS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=TO(i.toString());g2(n,a,()=>a(n.currentUser)),m2(n,l=>a(l))}}const s=CS("auth");return s&&ZD(n,`http://${s}`),n}function CO(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}zD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=es("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",CO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});EO("Browser");var $b=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var mi,ET;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(v,w){function I(){}I.prototype=w.prototype,v.F=w.prototype,v.prototype=new I,v.prototype.constructor=v,v.D=function(R,P,V){for(var k=Array(arguments.length-2),M=2;M<arguments.length;M++)k[M-2]=arguments[M];return w.prototype[P].apply(R,k)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(v,w,I){I||(I=0);const R=Array(16);if(typeof w=="string")for(var P=0;P<16;++P)R[P]=w.charCodeAt(I++)|w.charCodeAt(I++)<<8|w.charCodeAt(I++)<<16|w.charCodeAt(I++)<<24;else for(P=0;P<16;++P)R[P]=w[I++]|w[I++]<<8|w[I++]<<16|w[I++]<<24;w=v.g[0],I=v.g[1],P=v.g[2];let V=v.g[3],k;k=w+(V^I&(P^V))+R[0]+3614090360&4294967295,w=I+(k<<7&4294967295|k>>>25),k=V+(P^w&(I^P))+R[1]+3905402710&4294967295,V=w+(k<<12&4294967295|k>>>20),k=P+(I^V&(w^I))+R[2]+606105819&4294967295,P=V+(k<<17&4294967295|k>>>15),k=I+(w^P&(V^w))+R[3]+3250441966&4294967295,I=P+(k<<22&4294967295|k>>>10),k=w+(V^I&(P^V))+R[4]+4118548399&4294967295,w=I+(k<<7&4294967295|k>>>25),k=V+(P^w&(I^P))+R[5]+1200080426&4294967295,V=w+(k<<12&4294967295|k>>>20),k=P+(I^V&(w^I))+R[6]+2821735955&4294967295,P=V+(k<<17&4294967295|k>>>15),k=I+(w^P&(V^w))+R[7]+4249261313&4294967295,I=P+(k<<22&4294967295|k>>>10),k=w+(V^I&(P^V))+R[8]+1770035416&4294967295,w=I+(k<<7&4294967295|k>>>25),k=V+(P^w&(I^P))+R[9]+2336552879&4294967295,V=w+(k<<12&4294967295|k>>>20),k=P+(I^V&(w^I))+R[10]+4294925233&4294967295,P=V+(k<<17&4294967295|k>>>15),k=I+(w^P&(V^w))+R[11]+2304563134&4294967295,I=P+(k<<22&4294967295|k>>>10),k=w+(V^I&(P^V))+R[12]+1804603682&4294967295,w=I+(k<<7&4294967295|k>>>25),k=V+(P^w&(I^P))+R[13]+4254626195&4294967295,V=w+(k<<12&4294967295|k>>>20),k=P+(I^V&(w^I))+R[14]+2792965006&4294967295,P=V+(k<<17&4294967295|k>>>15),k=I+(w^P&(V^w))+R[15]+1236535329&4294967295,I=P+(k<<22&4294967295|k>>>10),k=w+(P^V&(I^P))+R[1]+4129170786&4294967295,w=I+(k<<5&4294967295|k>>>27),k=V+(I^P&(w^I))+R[6]+3225465664&4294967295,V=w+(k<<9&4294967295|k>>>23),k=P+(w^I&(V^w))+R[11]+643717713&4294967295,P=V+(k<<14&4294967295|k>>>18),k=I+(V^w&(P^V))+R[0]+3921069994&4294967295,I=P+(k<<20&4294967295|k>>>12),k=w+(P^V&(I^P))+R[5]+3593408605&4294967295,w=I+(k<<5&4294967295|k>>>27),k=V+(I^P&(w^I))+R[10]+38016083&4294967295,V=w+(k<<9&4294967295|k>>>23),k=P+(w^I&(V^w))+R[15]+3634488961&4294967295,P=V+(k<<14&4294967295|k>>>18),k=I+(V^w&(P^V))+R[4]+3889429448&4294967295,I=P+(k<<20&4294967295|k>>>12),k=w+(P^V&(I^P))+R[9]+568446438&4294967295,w=I+(k<<5&4294967295|k>>>27),k=V+(I^P&(w^I))+R[14]+3275163606&4294967295,V=w+(k<<9&4294967295|k>>>23),k=P+(w^I&(V^w))+R[3]+4107603335&4294967295,P=V+(k<<14&4294967295|k>>>18),k=I+(V^w&(P^V))+R[8]+1163531501&4294967295,I=P+(k<<20&4294967295|k>>>12),k=w+(P^V&(I^P))+R[13]+2850285829&4294967295,w=I+(k<<5&4294967295|k>>>27),k=V+(I^P&(w^I))+R[2]+4243563512&4294967295,V=w+(k<<9&4294967295|k>>>23),k=P+(w^I&(V^w))+R[7]+1735328473&4294967295,P=V+(k<<14&4294967295|k>>>18),k=I+(V^w&(P^V))+R[12]+2368359562&4294967295,I=P+(k<<20&4294967295|k>>>12),k=w+(I^P^V)+R[5]+4294588738&4294967295,w=I+(k<<4&4294967295|k>>>28),k=V+(w^I^P)+R[8]+2272392833&4294967295,V=w+(k<<11&4294967295|k>>>21),k=P+(V^w^I)+R[11]+1839030562&4294967295,P=V+(k<<16&4294967295|k>>>16),k=I+(P^V^w)+R[14]+4259657740&4294967295,I=P+(k<<23&4294967295|k>>>9),k=w+(I^P^V)+R[1]+2763975236&4294967295,w=I+(k<<4&4294967295|k>>>28),k=V+(w^I^P)+R[4]+1272893353&4294967295,V=w+(k<<11&4294967295|k>>>21),k=P+(V^w^I)+R[7]+4139469664&4294967295,P=V+(k<<16&4294967295|k>>>16),k=I+(P^V^w)+R[10]+3200236656&4294967295,I=P+(k<<23&4294967295|k>>>9),k=w+(I^P^V)+R[13]+681279174&4294967295,w=I+(k<<4&4294967295|k>>>28),k=V+(w^I^P)+R[0]+3936430074&4294967295,V=w+(k<<11&4294967295|k>>>21),k=P+(V^w^I)+R[3]+3572445317&4294967295,P=V+(k<<16&4294967295|k>>>16),k=I+(P^V^w)+R[6]+76029189&4294967295,I=P+(k<<23&4294967295|k>>>9),k=w+(I^P^V)+R[9]+3654602809&4294967295,w=I+(k<<4&4294967295|k>>>28),k=V+(w^I^P)+R[12]+3873151461&4294967295,V=w+(k<<11&4294967295|k>>>21),k=P+(V^w^I)+R[15]+530742520&4294967295,P=V+(k<<16&4294967295|k>>>16),k=I+(P^V^w)+R[2]+3299628645&4294967295,I=P+(k<<23&4294967295|k>>>9),k=w+(P^(I|~V))+R[0]+4096336452&4294967295,w=I+(k<<6&4294967295|k>>>26),k=V+(I^(w|~P))+R[7]+1126891415&4294967295,V=w+(k<<10&4294967295|k>>>22),k=P+(w^(V|~I))+R[14]+2878612391&4294967295,P=V+(k<<15&4294967295|k>>>17),k=I+(V^(P|~w))+R[5]+4237533241&4294967295,I=P+(k<<21&4294967295|k>>>11),k=w+(P^(I|~V))+R[12]+1700485571&4294967295,w=I+(k<<6&4294967295|k>>>26),k=V+(I^(w|~P))+R[3]+2399980690&4294967295,V=w+(k<<10&4294967295|k>>>22),k=P+(w^(V|~I))+R[10]+4293915773&4294967295,P=V+(k<<15&4294967295|k>>>17),k=I+(V^(P|~w))+R[1]+2240044497&4294967295,I=P+(k<<21&4294967295|k>>>11),k=w+(P^(I|~V))+R[8]+1873313359&4294967295,w=I+(k<<6&4294967295|k>>>26),k=V+(I^(w|~P))+R[15]+4264355552&4294967295,V=w+(k<<10&4294967295|k>>>22),k=P+(w^(V|~I))+R[6]+2734768916&4294967295,P=V+(k<<15&4294967295|k>>>17),k=I+(V^(P|~w))+R[13]+1309151649&4294967295,I=P+(k<<21&4294967295|k>>>11),k=w+(P^(I|~V))+R[4]+4149444226&4294967295,w=I+(k<<6&4294967295|k>>>26),k=V+(I^(w|~P))+R[11]+3174756917&4294967295,V=w+(k<<10&4294967295|k>>>22),k=P+(w^(V|~I))+R[2]+718787259&4294967295,P=V+(k<<15&4294967295|k>>>17),k=I+(V^(P|~w))+R[9]+3951481745&4294967295,v.g[0]=v.g[0]+w&4294967295,v.g[1]=v.g[1]+(P+(k<<21&4294967295|k>>>11))&4294967295,v.g[2]=v.g[2]+P&4294967295,v.g[3]=v.g[3]+V&4294967295}r.prototype.v=function(v,w){w===void 0&&(w=v.length);const I=w-this.blockSize,R=this.C;let P=this.h,V=0;for(;V<w;){if(P==0)for(;V<=I;)s(this,v,V),V+=this.blockSize;if(typeof v=="string"){for(;V<w;)if(R[P++]=v.charCodeAt(V++),P==this.blockSize){s(this,R),P=0;break}}else for(;V<w;)if(R[P++]=v[V++],P==this.blockSize){s(this,R),P=0;break}}this.h=P,this.o+=w},r.prototype.A=function(){var v=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);v[0]=128;for(var w=1;w<v.length-8;++w)v[w]=0;w=this.o*8;for(var I=v.length-8;I<v.length;++I)v[I]=w&255,w/=256;for(this.v(v),v=Array(16),w=0,I=0;I<4;++I)for(let R=0;R<32;R+=8)v[w++]=this.g[I]>>>R&255;return v};function i(v,w){var I=l;return Object.prototype.hasOwnProperty.call(I,v)?I[v]:I[v]=w(v)}function a(v,w){this.h=w;const I=[];let R=!0;for(let P=v.length-1;P>=0;P--){const V=v[P]|0;R&&V==w||(I[P]=V,R=!1)}this.g=I}var l={};function c(v){return-128<=v&&v<128?i(v,function(w){return new a([w|0],w<0?-1:0)}):new a([v|0],v<0?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return f;if(v<0)return C(d(-v));const w=[];let I=1;for(let R=0;v>=I;R++)w[R]=v/I|0,I*=4294967296;return new a(w,0)}function h(v,w){if(v.length==0)throw Error("number format error: empty string");if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(v.charAt(0)=="-")return C(h(v.substring(1),w));if(v.indexOf("-")>=0)throw Error('number format error: interior "-" character');const I=d(Math.pow(w,8));let R=f;for(let V=0;V<v.length;V+=8){var P=Math.min(8,v.length-V);const k=parseInt(v.substring(V,V+P),w);P<8?(P=d(Math.pow(w,P)),R=R.j(P).add(d(k))):(R=R.j(I),R=R.add(d(k)))}return R}var f=c(0),m=c(1),x=c(16777216);t=a.prototype,t.m=function(){if(N(this))return-C(this).m();let v=0,w=1;for(let I=0;I<this.g.length;I++){const R=this.i(I);v+=(R>=0?R:4294967296+R)*w,w*=4294967296}return v},t.toString=function(v){if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(T(this))return"0";if(N(this))return"-"+C(this).toString(v);const w=d(Math.pow(v,6));var I=this;let R="";for(;;){const P=_(I,w).g;I=S(I,P.j(w));let V=((I.g.length>0?I.g[0]:I.h)>>>0).toString(v);if(I=P,T(I))return V+R;for(;V.length<6;)V="0"+V;R=V+R}},t.i=function(v){return v<0?0:v<this.g.length?this.g[v]:this.h};function T(v){if(v.h!=0)return!1;for(let w=0;w<v.g.length;w++)if(v.g[w]!=0)return!1;return!0}function N(v){return v.h==-1}t.l=function(v){return v=S(this,v),N(v)?-1:T(v)?0:1};function C(v){const w=v.g.length,I=[];for(let R=0;R<w;R++)I[R]=~v.g[R];return new a(I,~v.h).add(m)}t.abs=function(){return N(this)?C(this):this},t.add=function(v){const w=Math.max(this.g.length,v.g.length),I=[];let R=0;for(let P=0;P<=w;P++){let V=R+(this.i(P)&65535)+(v.i(P)&65535),k=(V>>>16)+(this.i(P)>>>16)+(v.i(P)>>>16);R=k>>>16,V&=65535,k&=65535,I[P]=k<<16|V}return new a(I,I[I.length-1]&-2147483648?-1:0)};function S(v,w){return v.add(C(w))}t.j=function(v){if(T(this)||T(v))return f;if(N(this))return N(v)?C(this).j(C(v)):C(C(this).j(v));if(N(v))return C(this.j(C(v)));if(this.l(x)<0&&v.l(x)<0)return d(this.m()*v.m());const w=this.g.length+v.g.length,I=[];for(var R=0;R<2*w;R++)I[R]=0;for(R=0;R<this.g.length;R++)for(let P=0;P<v.g.length;P++){const V=this.i(R)>>>16,k=this.i(R)&65535,M=v.i(P)>>>16,ge=v.i(P)&65535;I[2*R+2*P]+=k*ge,E(I,2*R+2*P),I[2*R+2*P+1]+=V*ge,E(I,2*R+2*P+1),I[2*R+2*P+1]+=k*M,E(I,2*R+2*P+1),I[2*R+2*P+2]+=V*M,E(I,2*R+2*P+2)}for(v=0;v<w;v++)I[v]=I[2*v+1]<<16|I[2*v];for(v=w;v<2*w;v++)I[v]=0;return new a(I,0)};function E(v,w){for(;(v[w]&65535)!=v[w];)v[w+1]+=v[w]>>>16,v[w]&=65535,w++}function g(v,w){this.g=v,this.h=w}function _(v,w){if(T(w))throw Error("division by zero");if(T(v))return new g(f,f);if(N(v))return w=_(C(v),w),new g(C(w.g),C(w.h));if(N(w))return w=_(v,C(w)),new g(C(w.g),w.h);if(v.g.length>30){if(N(v)||N(w))throw Error("slowDivide_ only works with positive integers.");for(var I=m,R=w;R.l(v)<=0;)I=O(I),R=O(R);var P=L(I,1),V=L(R,1);for(R=L(R,2),I=L(I,2);!T(R);){var k=V.add(R);k.l(v)<=0&&(P=P.add(I),V=k),R=L(R,1),I=L(I,1)}return w=S(v,P.j(w)),new g(P,w)}for(P=f;v.l(w)>=0;){for(I=Math.max(1,Math.floor(v.m()/w.m())),R=Math.ceil(Math.log(I)/Math.LN2),R=R<=48?1:Math.pow(2,R-48),V=d(I),k=V.j(w);N(k)||k.l(v)>0;)I-=R,V=d(I),k=V.j(w);T(V)&&(V=m),P=P.add(V),v=S(v,k)}return new g(P,v)}t.B=function(v){return _(this,v).h},t.and=function(v){const w=Math.max(this.g.length,v.g.length),I=[];for(let R=0;R<w;R++)I[R]=this.i(R)&v.i(R);return new a(I,this.h&v.h)},t.or=function(v){const w=Math.max(this.g.length,v.g.length),I=[];for(let R=0;R<w;R++)I[R]=this.i(R)|v.i(R);return new a(I,this.h|v.h)},t.xor=function(v){const w=Math.max(this.g.length,v.g.length),I=[];for(let R=0;R<w;R++)I[R]=this.i(R)^v.i(R);return new a(I,this.h^v.h)};function O(v){const w=v.g.length+1,I=[];for(let R=0;R<w;R++)I[R]=v.i(R)<<1|v.i(R-1)>>>31;return new a(I,v.h)}function L(v,w){const I=w>>5;w%=32;const R=v.g.length-I,P=[];for(let V=0;V<R;V++)P[V]=w>0?v.i(V+I)>>>w|v.i(V+I+1)<<32-w:v.i(V+I);return new a(P,v.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,ET=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=h,mi=a}).apply(typeof $b<"u"?$b:typeof self<"u"?self:typeof window<"u"?window:{});var Qu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var IT,Kl,ST,Id,dg,TT,CT,NT;(function(){var t,e=Object.defineProperty;function n(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Qu=="object"&&Qu];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=n(this);function s(u,p){if(p)e:{var y=r;u=u.split(".");for(var A=0;A<u.length-1;A++){var $=u[A];if(!($ in y))break e;y=y[$]}u=u[u.length-1],A=y[u],p=p(A),p!=A&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}s("Symbol.dispose",function(u){return u||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(u){return u||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(u){return u||function(p){var y=[],A;for(A in p)Object.prototype.hasOwnProperty.call(p,A)&&y.push([A,p[A]]);return y}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},a=this||self;function l(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function c(u,p,y){return u.call.apply(u.bind,arguments)}function d(u,p,y){return d=c,d.apply(null,arguments)}function h(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var A=y.slice();return A.push.apply(A,arguments),u.apply(this,A)}}function f(u,p){function y(){}y.prototype=p.prototype,u.Z=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Ob=function(A,$,H){for(var de=Array(arguments.length-2),Ye=2;Ye<arguments.length;Ye++)de[Ye-2]=arguments[Ye];return p.prototype[$].apply(A,de)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?u=>u&&AsyncContext.Snapshot.wrap(u):u=>u;function x(u){const p=u.length;if(p>0){const y=Array(p);for(let A=0;A<p;A++)y[A]=u[A];return y}return[]}function T(u,p){for(let A=1;A<arguments.length;A++){const $=arguments[A];var y=typeof $;if(y=y!="object"?y:$?Array.isArray($)?"array":y:"null",y=="array"||y=="object"&&typeof $.length=="number"){y=u.length||0;const H=$.length||0;u.length=y+H;for(let de=0;de<H;de++)u[y+de]=$[de]}else u.push($)}}class N{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function C(u){a.setTimeout(()=>{throw u},0)}function S(){var u=v;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class E{constructor(){this.h=this.g=null}add(p,y){const A=g.get();A.set(p,y),this.h?this.h.next=A:this.g=A,this.h=A}}var g=new N(()=>new _,u=>u.reset());class _{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let O,L=!1,v=new E,w=()=>{const u=Promise.resolve(void 0);O=()=>{u.then(I)}};function I(){for(var u;u=S();){try{u.h.call(u.g)}catch(y){C(y)}var p=g;p.j(u),p.h<100&&(p.h++,u.next=p.g,p.g=u)}L=!1}function R(){this.u=this.u,this.C=this.C}R.prototype.u=!1,R.prototype.dispose=function(){this.u||(this.u=!0,this.N())},R.prototype[Symbol.dispose]=function(){this.dispose()},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function P(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}P.prototype.h=function(){this.defaultPrevented=!0};var V=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return u}();function k(u){return/^[\s\xa0]*$/.test(u)}function M(u,p){P.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u&&this.init(u,p)}f(M,P),M.prototype.init=function(u,p){const y=this.type=u.type,A=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget,p||(y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement)),this.relatedTarget=p,A?(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=u.pointerType,this.state=u.state,this.i=u,u.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);const u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var ge="closure_listenable_"+(Math.random()*1e6|0),oe=0;function Oe(u,p,y,A,$){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!A,this.ha=$,this.key=++oe,this.da=this.fa=!1}function Q(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function le(u,p,y){for(const A in u)p.call(y,u[A],A,u)}function ce(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function _e(u){const p={};for(const y in u)p[y]=u[y];return p}const Ie="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function fe(u,p){let y,A;for(let $=1;$<arguments.length;$++){A=arguments[$];for(y in A)u[y]=A[y];for(let H=0;H<Ie.length;H++)y=Ie[H],Object.prototype.hasOwnProperty.call(A,y)&&(u[y]=A[y])}}function ye(u){this.src=u,this.g={},this.h=0}ye.prototype.add=function(u,p,y,A,$){const H=u.toString();u=this.g[H],u||(u=this.g[H]=[],this.h++);const de=We(u,p,A,$);return de>-1?(p=u[de],y||(p.fa=!1)):(p=new Oe(p,this.src,H,!!A,$),p.fa=y,u.push(p)),p};function Le(u,p){const y=p.type;if(y in u.g){var A=u.g[y],$=Array.prototype.indexOf.call(A,p,void 0),H;(H=$>=0)&&Array.prototype.splice.call(A,$,1),H&&(Q(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function We(u,p,y,A){for(let $=0;$<u.length;++$){const H=u[$];if(!H.da&&H.listener==p&&H.capture==!!y&&H.ha==A)return $}return-1}var Re="closure_lm_"+(Math.random()*1e6|0),Je={};function gt(u,p,y,A,$){if(Array.isArray(p)){for(let H=0;H<p.length;H++)gt(u,p[H],y,A,$);return null}return y=X(y),u&&u[ge]?u.J(p,y,l(A)?!!A.capture:!1,$):q(u,p,y,!1,A,$)}function q(u,p,y,A,$,H){if(!p)throw Error("Invalid event type");const de=l($)?!!$.capture:!!$;let Ye=ve(u);if(Ye||(u[Re]=Ye=new ye(u)),y=Ye.add(p,y,A,de,H),y.proxy)return y;if(A=pe(),y.proxy=A,A.src=u,A.listener=y,u.addEventListener)V||($=de),$===void 0&&($=!1),u.addEventListener(p.toString(),A,$);else if(u.attachEvent)u.attachEvent(Z(p.toString()),A);else if(u.addListener&&u.removeListener)u.addListener(A);else throw Error("addEventListener and attachEvent are unavailable.");return y}function pe(){function u(y){return p.call(u.src,u.listener,y)}const p=Te;return u}function xe(u,p,y,A,$){if(Array.isArray(p))for(var H=0;H<p.length;H++)xe(u,p[H],y,A,$);else A=l(A)?!!A.capture:!!A,y=X(y),u&&u[ge]?(u=u.i,H=String(p).toString(),H in u.g&&(p=u.g[H],y=We(p,y,A,$),y>-1&&(Q(p[y]),Array.prototype.splice.call(p,y,1),p.length==0&&(delete u.g[H],u.h--)))):u&&(u=ve(u))&&(p=u.g[p.toString()],u=-1,p&&(u=We(p,y,A,$)),(y=u>-1?p[u]:null)&&Y(y))}function Y(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[ge])Le(p.i,u);else{var y=u.type,A=u.proxy;p.removeEventListener?p.removeEventListener(y,A,u.capture):p.detachEvent?p.detachEvent(Z(y),A):p.addListener&&p.removeListener&&p.removeListener(A),(y=ve(p))?(Le(y,u),y.h==0&&(y.src=null,p[Re]=null)):Q(u)}}}function Z(u){return u in Je?Je[u]:Je[u]="on"+u}function Te(u,p){if(u.da)u=!0;else{p=new M(p,this);const y=u.listener,A=u.ha||u.src;u.fa&&Y(u),u=y.call(A,p)}return u}function ve(u){return u=u[Re],u instanceof ye?u:null}var K="__closure_events_fn_"+(Math.random()*1e9>>>0);function X(u){return typeof u=="function"?u:(u[K]||(u[K]=function(p){return u.handleEvent(p)}),u[K])}function B(){R.call(this),this.i=new ye(this),this.M=this,this.G=null}f(B,R),B.prototype[ge]=!0,B.prototype.removeEventListener=function(u,p,y,A){xe(this,u,p,y,A)};function me(u,p){var y,A=u.G;if(A)for(y=[];A;A=A.G)y.push(A);if(u=u.M,A=p.type||p,typeof p=="string")p=new P(p,u);else if(p instanceof P)p.target=p.target||u;else{var $=p;p=new P(A,u),fe(p,$)}$=!0;let H,de;if(y)for(de=y.length-1;de>=0;de--)H=p.g=y[de],$=Me(H,A,!0,p)&&$;if(H=p.g=u,$=Me(H,A,!0,p)&&$,$=Me(H,A,!1,p)&&$,y)for(de=0;de<y.length;de++)H=p.g=y[de],$=Me(H,A,!1,p)&&$}B.prototype.N=function(){if(B.Z.N.call(this),this.i){var u=this.i;for(const p in u.g){const y=u.g[p];for(let A=0;A<y.length;A++)Q(y[A]);delete u.g[p],u.h--}}this.G=null},B.prototype.J=function(u,p,y,A){return this.i.add(String(u),p,!1,y,A)},B.prototype.K=function(u,p,y,A){return this.i.add(String(u),p,!0,y,A)};function Me(u,p,y,A){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();let $=!0;for(let H=0;H<p.length;++H){const de=p[H];if(de&&!de.da&&de.capture==y){const Ye=de.listener,Xt=de.ha||de.src;de.fa&&Le(u.i,de),$=Ye.call(Xt,A)!==!1&&$}}return $&&!A.defaultPrevented}function ze(u,p){if(typeof u!="function")if(u&&typeof u.handleEvent=="function")u=d(u.handleEvent,u);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:a.setTimeout(u,p||0)}function Fe(u){u.g=ze(()=>{u.g=null,u.i&&(u.i=!1,Fe(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class Ke extends R{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Fe(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function we(u){R.call(this),this.h=u,this.g={}}f(we,R);var lt=[];function Ze(u){le(u.g,function(p,y){this.g.hasOwnProperty(y)&&Y(p)},u),u.g={}}we.prototype.N=function(){we.Z.N.call(this),Ze(this)},we.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xt=a.JSON.stringify,z=a.JSON.parse,ie=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function D(){}function U(){}var ee={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ae(){P.call(this,"d")}f(ae,P);function Pe(){P.call(this,"c")}f(Pe,P);var ke={},Be=null;function Ue(){return Be=Be||new B}ke.Ia="serverreachability";function rt(u){P.call(this,ke.Ia,u)}f(rt,P);function dt(u){const p=Ue();me(p,new rt(p))}ke.STAT_EVENT="statevent";function Lt(u,p){P.call(this,ke.STAT_EVENT,u),this.stat=p}f(Lt,P);function Qe(u){const p=Ue();me(p,new Lt(p,u))}ke.Ja="timingevent";function Kn(u,p){P.call(this,ke.Ja,u),this.size=p}f(Kn,P);function Ht(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function ut(){this.g=!0}ut.prototype.ua=function(){this.g=!1};function cn(u,p,y,A,$,H){u.info(function(){if(u.g)if(H){var de="",Ye=H.split("&");for(let vt=0;vt<Ye.length;vt++){var Xt=Ye[vt].split("=");if(Xt.length>1){const nn=Xt[0];Xt=Xt[1];const Br=nn.split("_");de=Br.length>=2&&Br[1]=="type"?de+(nn+"="+Xt+"&"):de+(nn+"=redacted&")}}}else de=null;else de=H;return"XMLHTTP REQ ("+A+") [attempt "+$+"]: "+p+`
`+y+`
`+de})}function mn(u,p,y,A,$,H,de){u.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+$+"]: "+p+`
`+y+`
`+H+" "+de})}function gn(u,p,y,A){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+pl(u,y)+(A?" "+A:"")})}function br(u,p){u.info(function(){return"TIMEOUT: "+p})}ut.prototype.info=function(){};function pl(u,p){if(!u.g)return p;if(!p)return null;try{const H=JSON.parse(p);if(H){for(u=0;u<H.length;u++)if(Array.isArray(H[u])){var y=H[u];if(!(y.length<2)){var A=y[1];if(Array.isArray(A)&&!(A.length<1)){var $=A[0];if($!="noop"&&$!="stop"&&$!="close")for(let de=1;de<A.length;de++)A[de]=""}}}}return xt(H)}catch{return p}}var os={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Di={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},j;function W(){}f(W,D),W.prototype.g=function(){return new XMLHttpRequest},j=new W;function ne(u){return encodeURIComponent(String(u))}function be(u){var p=1;u=u.split(":");const y=[];for(;p>0&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function Ce(u,p,y,A){this.j=u,this.i=p,this.l=y,this.S=A||1,this.V=new we(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ge}function Ge(){this.i=null,this.g="",this.h=!1}var bt={},Fn={};function Nn(u,p,y){u.M=1,u.A=wu($r(p)),u.u=y,u.R=!0,St(u,null)}function St(u,p){u.F=Date.now(),as(u),u.B=$r(u.A);var y=u.B,A=u.S;Array.isArray(A)||(A=[String(A)]),T_(y.i,"t",A),u.C=0,y=u.j.L,u.h=new Ge,u.g=q_(u.j,y?p:null,!u.u),u.P>0&&(u.O=new Ke(d(u.Y,u,u.g),u.P)),p=u.V,y=u.g,A=u.ba;var $="readystatechange";Array.isArray($)||($&&(lt[0]=$.toString()),$=lt);for(let H=0;H<$.length;H++){const de=gt(y,$[H],A||p.handleEvent,!1,p.h||p);if(!de)break;p.g[de.key]=de}p=u.J?_e(u.J):{},u.u?(u.v||(u.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.B,u.v,u.u,p)):(u.v="GET",u.g.ea(u.B,u.v,null,p)),dt(),cn(u.i,u.v,u.B,u.l,u.S,u.u)}Ce.prototype.ba=function(u){u=u.target;const p=this.O;p&&Os(u)==3?p.j():this.Y(u)},Ce.prototype.Y=function(u){try{if(u==this.g)e:{const Ye=Os(this.g),Xt=this.g.ya(),vt=this.g.ca();if(!(Ye<3)&&(Ye!=3||this.g&&(this.h.h||this.g.la()||k_(this.g)))){this.K||Ye!=4||Xt==7||(Xt==8||vt<=0?dt(3):dt(2)),Fo(this);var p=this.g.ca();this.X=p;var y=At(this);if(this.o=p==200,mn(this.i,this.v,this.B,this.l,this.S,Ye,p),this.o){if(this.U&&!this.L){t:{if(this.g){var A,$=this.g;if((A=$.g?$.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(A)){var H=A;break t}}H=null}if(u=H)gn(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Hf(this,u);else{this.o=!1,this.m=3,Qe(12),Oi(this),cs(this);break e}}if(this.R){u=!0;let nn;for(;!this.K&&this.C<y.length;)if(nn=wr(this,y),nn==Fn){Ye==4&&(this.m=4,Qe(14),u=!1),gn(this.i,this.l,null,"[Incomplete Response]");break}else if(nn==bt){this.m=4,Qe(15),gn(this.i,this.l,y,"[Invalid Chunk]"),u=!1;break}else gn(this.i,this.l,nn,null),Hf(this,nn);if(Un(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ye!=4||y.length!=0||this.h.h||(this.m=1,Qe(16),u=!1),this.o=this.o&&u,!u)gn(this.i,this.l,y,"[Invalid Chunked Response]"),Oi(this),cs(this);else if(y.length>0&&!this.W){this.W=!0;var de=this.j;de.g==this&&de.aa&&!de.P&&(de.j.info("Great, no buffering proxy detected. Bytes received: "+y.length),Zf(de),de.P=!0,Qe(11))}}else gn(this.i,this.l,y,null),Hf(this,y);Ye==4&&Oi(this),this.o&&!this.K&&(Ye==4?U_(this.j,this):(this.o=!1,as(this)))}else V1(this.g),p==400&&y.indexOf("Unknown SID")>0?(this.m=3,Qe(12)):(this.m=0,Qe(13)),Oi(this),cs(this)}}}catch{}finally{}};function At(u){if(!Un(u))return u.g.la();const p=k_(u.g);if(p==="")return"";let y="";const A=p.length,$=Os(u.g)==4;if(!u.h.i){if(typeof TextDecoder>"u")return Oi(u),cs(u),"";u.h.i=new a.TextDecoder}for(let H=0;H<A;H++)u.h.h=!0,y+=u.h.i.decode(p[H],{stream:!($&&H==A-1)});return p.length=0,u.h.g+=y,u.C=0,u.h.g}function Un(u){return u.g?u.v=="GET"&&u.M!=2&&u.j.Aa:!1}function wr(u,p){var y=u.C,A=p.indexOf(`
`,y);return A==-1?Fn:(y=Number(p.substring(y,A)),isNaN(y)?bt:(A+=1,A+y>p.length?Fn:(p=p.slice(A,A+y),u.C=A+y,p)))}Ce.prototype.cancel=function(){this.K=!0,Oi(this)};function as(u){u.T=Date.now()+u.H,ls(u,u.H)}function ls(u,p){if(u.D!=null)throw Error("WatchDog timer not null");u.D=Ht(d(u.aa,u),p)}function Fo(u){u.D&&(a.clearTimeout(u.D),u.D=null)}Ce.prototype.aa=function(){this.D=null;const u=Date.now();u-this.T>=0?(br(this.i,this.B),this.M!=2&&(dt(),Qe(17)),Oi(this),this.m=2,cs(this)):ls(this,this.T-u)};function cs(u){u.j.I==0||u.K||U_(u.j,u)}function Oi(u){Fo(u);var p=u.O;p&&typeof p.dispose=="function"&&p.dispose(),u.O=null,Ze(u.V),u.g&&(p=u.g,u.g=null,p.abort(),p.dispose())}function Hf(u,p){try{var y=u.j;if(y.I!=0&&(y.g==u||Wf(y.h,u))){if(!u.L&&Wf(y.h,u)&&y.I==3){try{var A=y.Ba.g.parse(p)}catch{A=null}if(Array.isArray(A)&&A.length==3){var $=A;if($[0]==0){e:if(!y.v){if(y.g)if(y.g.F+3e3<u.F)Cu(y),Su(y);else break e;Jf(y),Qe(18)}}else y.xa=$[1],0<y.xa-y.K&&$[2]<37500&&y.F&&y.A==0&&!y.C&&(y.C=Ht(d(y.Va,y),6e3));v_(y.h)<=1&&y.ta&&(y.ta=void 0)}else Vi(y,11)}else if((u.L||y.g==u)&&Cu(y),!k(p))for($=y.Ba.g.parse(p),p=0;p<$.length;p++){let vt=$[p];const nn=vt[0];if(!(nn<=y.K))if(y.K=nn,vt=vt[1],y.I==2)if(vt[0]=="c"){y.M=vt[1],y.ba=vt[2];const Br=vt[3];Br!=null&&(y.ka=Br,y.j.info("VER="+y.ka));const Mi=vt[4];Mi!=null&&(y.za=Mi,y.j.info("SVER="+y.za));const Ls=vt[5];Ls!=null&&typeof Ls=="number"&&Ls>0&&(A=1.5*Ls,y.O=A,y.j.info("backChannelRequestTimeoutMs_="+A)),A=y;const Vs=u.g;if(Vs){const ju=Vs.g?Vs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ju){var H=A.h;H.g||ju.indexOf("spdy")==-1&&ju.indexOf("quic")==-1&&ju.indexOf("h2")==-1||(H.j=H.l,H.g=new Set,H.h&&(Gf(H,H.h),H.h=null))}if(A.G){const ep=Vs.g?Vs.g.getResponseHeader("X-HTTP-Session-Id"):null;ep&&(A.wa=ep,wt(A.J,A.G,ep))}}y.I=3,y.l&&y.l.ra(),y.aa&&(y.T=Date.now()-u.F,y.j.info("Handshake RTT: "+y.T+"ms")),A=y;var de=u;if(A.na=z_(A,A.L?A.ba:null,A.W),de.L){__(A.h,de);var Ye=de,Xt=A.O;Xt&&(Ye.H=Xt),Ye.D&&(Fo(Ye),as(Ye)),A.g=de}else M_(A);y.i.length>0&&Tu(y)}else vt[0]!="stop"&&vt[0]!="close"||Vi(y,7);else y.I==3&&(vt[0]=="stop"||vt[0]=="close"?vt[0]=="stop"?Vi(y,7):Xf(y):vt[0]!="noop"&&y.l&&y.l.qa(vt),y.A=0)}}dt(4)}catch{}}var I1=class{constructor(u,p){this.g=u,this.map=p}};function g_(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=u.length>0&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function y_(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function v_(u){return u.h?1:u.g?u.g.size:0}function Wf(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Gf(u,p){u.g?u.g.add(p):u.h=p}function __(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}g_.prototype.cancel=function(){if(this.i=x_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function x_(u){if(u.h!=null)return u.i.concat(u.h.G);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.G);return p}return x(u.i)}var b_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function S1(u,p){if(u){u=u.split("&");for(let y=0;y<u.length;y++){const A=u[y].indexOf("=");let $,H=null;A>=0?($=u[y].substring(0,A),H=u[y].substring(A+1)):$=u[y],p($,H?decodeURIComponent(H.replace(/\+/g," ")):"")}}}function ks(u){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;u instanceof ks?(this.l=u.l,ml(this,u.j),this.o=u.o,this.g=u.g,gl(this,u.u),this.h=u.h,Kf(this,C_(u.i)),this.m=u.m):u&&(p=String(u).match(b_))?(this.l=!1,ml(this,p[1]||"",!0),this.o=yl(p[2]||""),this.g=yl(p[3]||"",!0),gl(this,p[4]),this.h=yl(p[5]||"",!0),Kf(this,p[6]||"",!0),this.m=yl(p[7]||"")):(this.l=!1,this.i=new _l(null,this.l))}ks.prototype.toString=function(){const u=[];var p=this.j;p&&u.push(vl(p,w_,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(vl(p,w_,!0),"@"),u.push(ne(y).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.u,y!=null&&u.push(":",String(y))),(y=this.h)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(vl(y,y.charAt(0)=="/"?N1:C1,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",vl(y,A1)),u.join("")},ks.prototype.resolve=function(u){const p=$r(this);let y=!!u.j;y?ml(p,u.j):y=!!u.o,y?p.o=u.o:y=!!u.g,y?p.g=u.g:y=u.u!=null;var A=u.h;if(y)gl(p,u.u);else if(y=!!u.h){if(A.charAt(0)!="/")if(this.g&&!this.h)A="/"+A;else{var $=p.h.lastIndexOf("/");$!=-1&&(A=p.h.slice(0,$+1)+A)}if($=A,$==".."||$==".")A="";else if($.indexOf("./")!=-1||$.indexOf("/.")!=-1){A=$.lastIndexOf("/",0)==0,$=$.split("/");const H=[];for(let de=0;de<$.length;){const Ye=$[de++];Ye=="."?A&&de==$.length&&H.push(""):Ye==".."?((H.length>1||H.length==1&&H[0]!="")&&H.pop(),A&&de==$.length&&H.push("")):(H.push(Ye),A=!0)}A=H.join("/")}else A=$}return y?p.h=A:y=u.i.toString()!=="",y?Kf(p,C_(u.i)):y=!!u.m,y&&(p.m=u.m),p};function $r(u){return new ks(u)}function ml(u,p,y){u.j=y?yl(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function gl(u,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);u.u=p}else u.u=null}function Kf(u,p,y){p instanceof _l?(u.i=p,R1(u.i,u.l)):(y||(p=vl(p,j1)),u.i=new _l(p,u.l))}function wt(u,p,y){u.i.set(p,y)}function wu(u){return wt(u,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),u}function yl(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function vl(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,T1),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function T1(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var w_=/[#\/\?@]/g,C1=/[#\?:]/g,N1=/[#\?]/g,j1=/[#\?@]/g,A1=/#/g;function _l(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Li(u){u.g||(u.g=new Map,u.h=0,u.i&&S1(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}t=_l.prototype,t.add=function(u,p){Li(this),this.i=null,u=Uo(this,u);let y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function E_(u,p){Li(u),p=Uo(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function I_(u,p){return Li(u),p=Uo(u,p),u.g.has(p)}t.forEach=function(u,p){Li(this),this.g.forEach(function(y,A){y.forEach(function($){u.call(p,$,A,this)},this)},this)};function S_(u,p){Li(u);let y=[];if(typeof p=="string")I_(u,p)&&(y=y.concat(u.g.get(Uo(u,p))));else for(u=Array.from(u.g.values()),p=0;p<u.length;p++)y=y.concat(u[p]);return y}t.set=function(u,p){return Li(this),this.i=null,u=Uo(this,u),I_(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},t.get=function(u,p){return u?(u=S_(this,u),u.length>0?String(u[0]):p):p};function T_(u,p,y){E_(u,p),y.length>0&&(u.i=null,u.g.set(Uo(u,p),x(y)),u.h+=y.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(let A=0;A<p.length;A++){var y=p[A];const $=ne(y);y=S_(this,y);for(let H=0;H<y.length;H++){let de=$;y[H]!==""&&(de+="="+ne(y[H])),u.push(de)}}return this.i=u.join("&")};function C_(u){const p=new _l;return p.i=u.i,u.g&&(p.g=new Map(u.g),p.h=u.h),p}function Uo(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function R1(u,p){p&&!u.j&&(Li(u),u.i=null,u.g.forEach(function(y,A){const $=A.toLowerCase();A!=$&&(E_(this,A),T_(this,$,y))},u)),u.j=p}function P1(u,p){const y=new ut;if(a.Image){const A=new Image;A.onload=h(Ds,y,"TestLoadImage: loaded",!0,p,A),A.onerror=h(Ds,y,"TestLoadImage: error",!1,p,A),A.onabort=h(Ds,y,"TestLoadImage: abort",!1,p,A),A.ontimeout=h(Ds,y,"TestLoadImage: timeout",!1,p,A),a.setTimeout(function(){A.ontimeout&&A.ontimeout()},1e4),A.src=u}else p(!1)}function k1(u,p){const y=new ut,A=new AbortController,$=setTimeout(()=>{A.abort(),Ds(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:A.signal}).then(H=>{clearTimeout($),H.ok?Ds(y,"TestPingServer: ok",!0,p):Ds(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout($),Ds(y,"TestPingServer: error",!1,p)})}function Ds(u,p,y,A,$){try{$&&($.onload=null,$.onerror=null,$.onabort=null,$.ontimeout=null),A(y)}catch{}}function D1(){this.g=new ie}function Qf(u){this.i=u.Sb||null,this.h=u.ab||!1}f(Qf,D),Qf.prototype.g=function(){return new Eu(this.i,this.h)};function Eu(u,p){B.call(this),this.H=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}f(Eu,B),t=Eu.prototype,t.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=u,this.D=p,this.readyState=1,bl(this)},t.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};u&&(p.body=u),(this.H||a).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,xl(this)),this.readyState=0},t.Pa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,bl(this)),this.g&&(this.readyState=3,bl(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;N_(this)}else u.text().then(this.Oa.bind(this),this.ga.bind(this))};function N_(u){u.j.read().then(u.Ma.bind(u)).catch(u.ga.bind(u))}t.Ma=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?xl(this):bl(this),this.readyState==3&&N_(this)}},t.Oa=function(u){this.g&&(this.response=this.responseText=u,xl(this))},t.Na=function(u){this.g&&(this.response=u,xl(this))},t.ga=function(){this.g&&xl(this)};function xl(u){u.readyState=4,u.l=null,u.j=null,u.B=null,bl(u)}t.setRequestHeader=function(u,p){this.A.append(u,p)},t.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function bl(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Eu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function j_(u){let p="";return le(u,function(y,A){p+=A,p+=":",p+=y,p+=`\r
`}),p}function Yf(u,p,y){e:{for(A in y){var A=!1;break e}A=!0}A||(y=j_(y),typeof u=="string"?y!=null&&ne(y):wt(u,p,y))}function Vt(u){B.call(this),this.headers=new Map,this.L=u||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}f(Vt,B);var O1=/^https?$/i,L1=["POST","PUT"];t=Vt.prototype,t.Fa=function(u){this.H=u},t.ea=function(u,p,y,A){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():j.g(),this.g.onreadystatechange=m(d(this.Ca,this));try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(H){A_(this,H);return}if(u=y||"",y=new Map(this.headers),A)if(Object.getPrototypeOf(A)===Object.prototype)for(var $ in A)y.set($,A[$]);else if(typeof A.keys=="function"&&typeof A.get=="function")for(const H of A.keys())y.set(H,A.get(H));else throw Error("Unknown input type for opt_headers: "+String(A));A=Array.from(y.keys()).find(H=>H.toLowerCase()=="content-type"),$=a.FormData&&u instanceof a.FormData,!(Array.prototype.indexOf.call(L1,p,void 0)>=0)||A||$||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[H,de]of y)this.g.setRequestHeader(H,de);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(u),this.v=!1}catch(H){A_(this,H)}};function A_(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.o=5,R_(u),Iu(u)}function R_(u){u.A||(u.A=!0,me(u,"complete"),me(u,"error"))}t.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=u||7,me(this,"complete"),me(this,"abort"),Iu(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Iu(this,!0)),Vt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?P_(this):this.Xa())},t.Xa=function(){P_(this)};function P_(u){if(u.h&&typeof i<"u"){if(u.v&&Os(u)==4)setTimeout(u.Ca.bind(u),0);else if(me(u,"readystatechange"),Os(u)==4){u.h=!1;try{const H=u.ca();e:switch(H){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var A;if(A=H===0){let de=String(u.D).match(b_)[1]||null;!de&&a.self&&a.self.location&&(de=a.self.location.protocol.slice(0,-1)),A=!O1.test(de?de.toLowerCase():"")}y=A}if(y)me(u,"complete"),me(u,"success");else{u.o=6;try{var $=Os(u)>2?u.g.statusText:""}catch{$=""}u.l=$+" ["+u.ca()+"]",R_(u)}}finally{Iu(u)}}}}function Iu(u,p){if(u.g){u.m&&(clearTimeout(u.m),u.m=null);const y=u.g;u.g=null,p||me(u,"ready");try{y.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Os(u){return u.g?u.g.readyState:0}t.ca=function(){try{return Os(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),z(p)}};function k_(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.F){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function V1(u){const p={};u=(u.g&&Os(u)>=2&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let A=0;A<u.length;A++){if(k(u[A]))continue;var y=be(u[A]);const $=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const H=p[$]||[];p[$]=H,H.push(y)}ce(p,function(A){return A.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function wl(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function D_(u){this.za=0,this.i=[],this.j=new ut,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=wl("failFast",!1,u),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=wl("baseRetryDelayMs",5e3,u),this.Za=wl("retryDelaySeedMs",1e4,u),this.Ta=wl("forwardChannelMaxRetries",2,u),this.va=wl("forwardChannelRequestTimeoutMs",2e4,u),this.ma=u&&u.xmlHttpFactory||void 0,this.Ua=u&&u.Rb||void 0,this.Aa=u&&u.useFetchStreams||!1,this.O=void 0,this.L=u&&u.supportsCrossDomainXhr||!1,this.M="",this.h=new g_(u&&u.concurrentRequestLimit),this.Ba=new D1,this.S=u&&u.fastHandshake||!1,this.R=u&&u.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=u&&u.Pb||!1,u&&u.ua&&this.j.ua(),u&&u.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&u&&u.detectBufferingProxy||!1,this.ia=void 0,u&&u.longPollingTimeout&&u.longPollingTimeout>0&&(this.ia=u.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=D_.prototype,t.ka=8,t.I=1,t.connect=function(u,p,y,A){Qe(0),this.W=u,this.H=p||{},y&&A!==void 0&&(this.H.OSID=y,this.H.OAID=A),this.F=this.X,this.J=z_(this,null,this.W),Tu(this)};function Xf(u){if(O_(u),u.I==3){var p=u.V++,y=$r(u.J);if(wt(y,"SID",u.M),wt(y,"RID",p),wt(y,"TYPE","terminate"),El(u,y),p=new Ce(u,u.j,p),p.M=2,p.A=wu($r(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.A.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.A,y=!0),y||(p.g=q_(p.j,null),p.g.ea(p.A)),p.F=Date.now(),as(p)}B_(u)}function Su(u){u.g&&(Zf(u),u.g.cancel(),u.g=null)}function O_(u){Su(u),u.v&&(a.clearTimeout(u.v),u.v=null),Cu(u),u.h.cancel(),u.m&&(typeof u.m=="number"&&a.clearTimeout(u.m),u.m=null)}function Tu(u){if(!y_(u.h)&&!u.m){u.m=!0;var p=u.Ea;O||w(),L||(O(),L=!0),v.add(p,u),u.D=0}}function M1(u,p){return v_(u.h)>=u.h.j-(u.m?1:0)?!1:u.m?(u.i=p.G.concat(u.i),!0):u.I==1||u.I==2||u.D>=(u.Sa?0:u.Ta)?!1:(u.m=Ht(d(u.Ea,u,p),$_(u,u.D)),u.D++,!0)}t.Ea=function(u){if(this.m)if(this.m=null,this.I==1){if(!u){this.V=Math.floor(Math.random()*1e5),u=this.V++;const $=new Ce(this,this.j,u);let H=this.o;if(this.U&&(H?(H=_e(H),fe(H,this.U)):H=this.U),this.u!==null||this.R||($.J=H,H=null),this.S)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var A=this.i[y];if("__data__"in A.map&&(A=A.map.__data__,typeof A=="string")){A=A.length;break t}A=void 0}if(A===void 0)break;if(p+=A,p>4096){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=V_(this,$,p),y=$r(this.J),wt(y,"RID",u),wt(y,"CVER",22),this.G&&wt(y,"X-HTTP-Session-Id",this.G),El(this,y),H&&(this.R?p="headers="+ne(j_(H))+"&"+p:this.u&&Yf(y,this.u,H)),Gf(this.h,$),this.Ra&&wt(y,"TYPE","init"),this.S?(wt(y,"$req",p),wt(y,"SID","null"),$.U=!0,Nn($,y,null)):Nn($,y,p),this.I=2}}else this.I==3&&(u?L_(this,u):this.i.length==0||y_(this.h)||L_(this))};function L_(u,p){var y;p?y=p.l:y=u.V++;const A=$r(u.J);wt(A,"SID",u.M),wt(A,"RID",y),wt(A,"AID",u.K),El(u,A),u.u&&u.o&&Yf(A,u.u,u.o),y=new Ce(u,u.j,y,u.D+1),u.u===null&&(y.J=u.o),p&&(u.i=p.G.concat(u.i)),p=V_(u,y,1e3),y.H=Math.round(u.va*.5)+Math.round(u.va*.5*Math.random()),Gf(u.h,y),Nn(y,A,p)}function El(u,p){u.H&&le(u.H,function(y,A){wt(p,A,y)}),u.l&&le({},function(y,A){wt(p,A,y)})}function V_(u,p,y){y=Math.min(u.i.length,y);const A=u.l?d(u.l.Ka,u.l,u):null;e:{var $=u.i;let Ye=-1;for(;;){const Xt=["count="+y];Ye==-1?y>0?(Ye=$[0].g,Xt.push("ofs="+Ye)):Ye=0:Xt.push("ofs="+Ye);let vt=!0;for(let nn=0;nn<y;nn++){var H=$[nn].g;const Br=$[nn].map;if(H-=Ye,H<0)Ye=Math.max(0,$[nn].g-100),vt=!1;else try{H="req"+H+"_"||"";try{var de=Br instanceof Map?Br:Object.entries(Br);for(const[Mi,Ls]of de){let Vs=Ls;l(Ls)&&(Vs=xt(Ls)),Xt.push(H+Mi+"="+encodeURIComponent(Vs))}}catch(Mi){throw Xt.push(H+"type="+encodeURIComponent("_badmap")),Mi}}catch{A&&A(Br)}}if(vt){de=Xt.join("&");break e}}de=void 0}return u=u.i.splice(0,y),p.G=u,de}function M_(u){if(!u.g&&!u.v){u.Y=1;var p=u.Da;O||w(),L||(O(),L=!0),v.add(p,u),u.A=0}}function Jf(u){return u.g||u.v||u.A>=3?!1:(u.Y++,u.v=Ht(d(u.Da,u),$_(u,u.A)),u.A++,!0)}t.Da=function(){if(this.v=null,F_(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var u=4*this.T;this.j.info("BP detection timer enabled: "+u),this.B=Ht(d(this.Wa,this),u)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Qe(10),Su(this),F_(this))};function Zf(u){u.B!=null&&(a.clearTimeout(u.B),u.B=null)}function F_(u){u.g=new Ce(u,u.j,"rpc",u.Y),u.u===null&&(u.g.J=u.o),u.g.P=0;var p=$r(u.na);wt(p,"RID","rpc"),wt(p,"SID",u.M),wt(p,"AID",u.K),wt(p,"CI",u.F?"0":"1"),!u.F&&u.ia&&wt(p,"TO",u.ia),wt(p,"TYPE","xmlhttp"),El(u,p),u.u&&u.o&&Yf(p,u.u,u.o),u.O&&(u.g.H=u.O);var y=u.g;u=u.ba,y.M=1,y.A=wu($r(p)),y.u=null,y.R=!0,St(y,u)}t.Va=function(){this.C!=null&&(this.C=null,Su(this),Jf(this),Qe(19))};function Cu(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function U_(u,p){var y=null;if(u.g==p){Cu(u),Zf(u),u.g=null;var A=2}else if(Wf(u.h,p))y=p.G,__(u.h,p),A=1;else return;if(u.I!=0){if(p.o)if(A==1){y=p.u?p.u.length:0,p=Date.now()-p.F;var $=u.D;A=Ue(),me(A,new Kn(A,y)),Tu(u)}else M_(u);else if($=p.m,$==3||$==0&&p.X>0||!(A==1&&M1(u,p)||A==2&&Jf(u)))switch(y&&y.length>0&&(p=u.h,p.i=p.i.concat(y)),$){case 1:Vi(u,5);break;case 4:Vi(u,10);break;case 3:Vi(u,6);break;default:Vi(u,2)}}}function $_(u,p){let y=u.Qa+Math.floor(Math.random()*u.Za);return u.isActive()||(y*=2),y*p}function Vi(u,p){if(u.j.info("Error code "+p),p==2){var y=d(u.bb,u),A=u.Ua;const $=!A;A=new ks(A||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ml(A,"https"),wu(A),$?P1(A.toString(),y):k1(A.toString(),y)}else Qe(2);u.I=0,u.l&&u.l.pa(p),B_(u),O_(u)}t.bb=function(u){u?(this.j.info("Successfully pinged google.com"),Qe(2)):(this.j.info("Failed to ping google.com"),Qe(1))};function B_(u){if(u.I=0,u.ja=[],u.l){const p=x_(u.h);(p.length!=0||u.i.length!=0)&&(T(u.ja,p),T(u.ja,u.i),u.h.i.length=0,x(u.i),u.i.length=0),u.l.oa()}}function z_(u,p,y){var A=y instanceof ks?$r(y):new ks(y);if(A.g!="")p&&(A.g=p+"."+A.g),gl(A,A.u);else{var $=a.location;A=$.protocol,p=p?p+"."+$.hostname:$.hostname,$=+$.port;const H=new ks(null);A&&ml(H,A),p&&(H.g=p),$&&gl(H,$),y&&(H.h=y),A=H}return y=u.G,p=u.wa,y&&p&&wt(A,y,p),wt(A,"VER",u.ka),El(u,A),A}function q_(u,p,y){if(p&&!u.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Aa&&!u.ma?new Vt(new Qf({ab:y})):new Vt(u.ma),p.Fa(u.L),p}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function H_(){}t=H_.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Nu(){}Nu.prototype.g=function(u,p){return new Qn(u,p)};function Qn(u,p){B.call(this),this.g=new D_(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(u?u["X-WebChannel-Client-Profile"]=p.sa:u={"X-WebChannel-Client-Profile":p.sa}),this.g.U=u,(u=p&&p.Qb)&&!k(u)&&(this.g.u=u),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!k(p)&&(this.g.G=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new $o(this)}f(Qn,B),Qn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Qn.prototype.close=function(){Xf(this.g)},Qn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.v&&(y={},y.__data__=xt(u),u=y);p.i.push(new I1(p.Ya++,u)),p.I==3&&Tu(p)},Qn.prototype.N=function(){this.g.l=null,delete this.j,Xf(this.g),delete this.g,Qn.Z.N.call(this)};function W_(u){ae.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}f(W_,ae);function G_(){Pe.call(this),this.status=1}f(G_,Pe);function $o(u){this.g=u}f($o,H_),$o.prototype.ra=function(){me(this.g,"a")},$o.prototype.qa=function(u){me(this.g,new W_(u))},$o.prototype.pa=function(u){me(this.g,new G_)},$o.prototype.oa=function(){me(this.g,"b")},Nu.prototype.createWebChannel=Nu.prototype.g,Qn.prototype.send=Qn.prototype.o,Qn.prototype.open=Qn.prototype.m,Qn.prototype.close=Qn.prototype.close,NT=function(){return new Nu},CT=function(){return Ue()},TT=ke,dg={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},os.NO_ERROR=0,os.TIMEOUT=8,os.HTTP_ERROR=6,Id=os,Di.COMPLETE="complete",ST=Di,U.EventType=ee,ee.OPEN="a",ee.CLOSE="b",ee.ERROR="c",ee.MESSAGE="d",B.prototype.listen=B.prototype.J,Kl=U,Vt.prototype.listenOnce=Vt.prototype.K,Vt.prototype.getLastError=Vt.prototype.Ha,Vt.prototype.getLastErrorCode=Vt.prototype.ya,Vt.prototype.getStatus=Vt.prototype.ca,Vt.prototype.getResponseJson=Vt.prototype.La,Vt.prototype.getResponseText=Vt.prototype.la,Vt.prototype.send=Vt.prototype.ea,Vt.prototype.setWithCredentials=Vt.prototype.Fa,IT=Vt}).apply(typeof Qu<"u"?Qu:typeof self<"u"?self:typeof window<"u"?window:{});const Bb="@firebase/firestore",zb="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}dn.UNAUTHENTICATED=new dn(null),dn.GOOGLE_CREDENTIALS=new dn("google-credentials-uid"),dn.FIRST_PARTY=new dn("first-party-uid"),dn.MOCK_USER=new dn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cl="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yo=new sf("@firebase/firestore");function sa(){return yo.logLevel}function te(t,...e){if(yo.logLevel<=tt.DEBUG){const n=e.map(tv);yo.debug(`Firestore (${cl}): ${t}`,...n)}}function Rn(t,...e){if(yo.logLevel<=tt.ERROR){const n=e.map(tv);yo.error(`Firestore (${cl}): ${t}`,...n)}}function vo(t,...e){if(yo.logLevel<=tt.WARN){const n=e.map(tv);yo.warn(`Firestore (${cl}): ${t}`,...n)}}function tv(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Se(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,jT(t,r,n)}function jT(t,e,n){let r=`FIRESTORE (${cl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Rn(r),new Error(r)}function Ne(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||jT(e,s,r)}function $e(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class se extends xr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AT{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class NO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(dn.UNAUTHENTICATED))}shutdown(){}}class jO{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class AO{constructor(e){this.t=e,this.currentUser=dn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Ne(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let i=new kr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new kr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{te("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(te("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new kr)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(te("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Ne(typeof r.accessToken=="string",31837,{l:r}),new AT(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Ne(e===null||typeof e=="string",2055,{h:e}),new dn(e)}}class RO{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=dn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class PO{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new RO(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(dn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class qb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class kO{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ur(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Ne(this.o===void 0,3512);const r=i=>{i.error!=null&&te("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,te("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{te("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):te("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new qb(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ne(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new qb(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DO(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=DO(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%62))}return r}}function He(t,e){return t<e?-1:t>e?1:0}function hg(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),i=e.charAt(r);if(s!==i)return Lp(s)===Lp(i)?He(s,i):Lp(s)?1:-1}return He(t.length,e.length)}const OO=55296,LO=57343;function Lp(t){const e=t.charCodeAt(0);return e>=OO&&e<=LO}function Ba(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function RT(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hb="__name__";class Gr{constructor(e,n,r){n===void 0?n=0:n>e.length&&Se(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Se(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Gr.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Gr?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=Gr.compareSegments(e.get(s),n.get(s));if(i!==0)return i}return He(e.length,n.length)}static compareSegments(e,n){const r=Gr.isNumericId(e),s=Gr.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?Gr.extractNumericId(e).compare(Gr.extractNumericId(n)):hg(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return mi.fromString(e.substring(4,e.length-2))}}class ct extends Gr{construct(e,n,r){return new ct(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new se(G.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new ct(n)}static emptyPath(){return new ct([])}}const VO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class kt extends Gr{construct(e,n,r){return new kt(e,n,r)}static isValidIdentifier(e){return VO.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),kt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Hb}static keyField(){return new kt([Hb])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new se(G.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new se(G.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new se(G.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new se(G.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new kt(n)}static emptyPath(){return new kt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{constructor(e){this.path=e}static fromPath(e){return new he(ct.fromString(e))}static fromName(e){return new he(ct.fromString(e).popFirst(5))}static empty(){return new he(ct.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ct.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ct.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new he(new ct(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PT(t,e,n){if(!n)throw new se(G.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function MO(t,e,n,r){if(e===!0&&r===!0)throw new se(G.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Wb(t){if(!he.isDocumentKey(t))throw new se(G.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Gb(t){if(he.isDocumentKey(t))throw new se(G.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function kT(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function df(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Se(12329,{type:typeof t})}function In(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new se(G.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=df(t);throw new se(G.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function FO(t,e){if(e<=0)throw new se(G.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qt(t,e){const n={typeString:t};return e&&(n.value=e),n}function cu(t,e){if(!kT(t))throw new se(G.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const a=t[r];if(s&&typeof a!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new se(G.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kb=-62135596800,Qb=1e6;class ot{static now(){return ot.fromMillis(Date.now())}static fromDate(e){return ot.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Qb);return new ot(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new se(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new se(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Kb)throw new se(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new se(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Qb}_compareTo(e){return this.seconds===e.seconds?He(this.nanoseconds,e.nanoseconds):He(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ot._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(cu(e,ot._jsonSchema))return new ot(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Kb;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ot._jsonSchemaVersion="firestore/timestamp/1.0",ot._jsonSchema={type:Qt("string",ot._jsonSchemaVersion),seconds:Qt("number"),nanoseconds:Qt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je{static fromTimestamp(e){return new je(e)}static min(){return new je(new ot(0,0))}static max(){return new je(new ot(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $c=-1;class yh{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function fg(t){return t.fields.find(e=>e.kind===2)}function zi(t){return t.fields.filter(e=>e.kind!==2)}yh.UNKNOWN_ID=-1;class Sd{constructor(e,n){this.fieldPath=e,this.kind=n}}class Bc{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Bc(0,ir.min())}}function UO(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=je.fromTimestamp(r===1e9?new ot(n+1,0):new ot(n,r));return new ir(s,he.empty(),e)}function DT(t){return new ir(t.readTime,t.key,$c)}class ir{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new ir(je.min(),he.empty(),$c)}static max(){return new ir(je.max(),he.empty(),$c)}}function rv(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=he.comparator(t.documentKey,e.documentKey),n!==0?n:He(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class LT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vo(t){if(t.code!==G.FAILED_PRECONDITION||t.message!==OT)throw t;te("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Se(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new F((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof F?n:F.resolve(n)}catch(n){return F.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):F.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):F.reject(n)}static resolve(e){return new F((n,r)=>{n(e)})}static reject(e){return new F((n,r)=>{r(e)})}static waitFor(e){return new F((n,r)=>{let s=0,i=0,a=!1;e.forEach(l=>{++s,l.next(()=>{++i,a&&i===s&&n()},c=>r(c))}),a=!0,i===s&&n()})}static or(e){let n=F.resolve(!1);for(const r of e)n=n.next(s=>s?F.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new F((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let c=0;c<i;c++){const d=c;n(e[d]).next(h=>{a[d]=h,++l,l===i&&r(a)},h=>s(h))}})}static doWhile(e,n){return new F((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zn="SimpleDb";class hf{static open(e,n,r,s){try{return new hf(n,e.transaction(s,r))}catch(i){throw new hc(n,i)}}constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.S=new kr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{n.error?this.S.reject(new hc(e,n.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=sv(r.target.error);this.S.reject(new hc(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(te(Zn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new BO(n)}}class gi{static delete(e){return te(Zn,"Removing database:",e),Hi(TS().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!zy())return!1;if(gi.F())return!0;const e=en(),n=gi.M(e),r=0<n&&n<10,s=VT(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,n){return e.store(n)}static M(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,n,r){this.name=e,this.version=n,this.N=r,this.B=null,gi.M(en())===12.2&&Rn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(te(Zn,"Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;n(a)},s.onblocked=()=>{r(new hc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?r(new se(G.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new se(G.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new hc(e,a))},s.onupgradeneeded=i=>{te(Zn,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next(()=>{te(Zn,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=n=>this.q(n)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let a=0;for(;;){++a;try{this.db=await this.L(e);const l=hf.open(this.db,e,i?"readonly":"readwrite",r),c=s(l).next(d=>(l.C(),d)).catch(d=>(l.abort(d),F.reject(d))).toPromise();return c.catch(()=>{}),await l.D,c}catch(l){const c=l,d=c.name!=="FirebaseError"&&a<3;if(te(Zn,"Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function VT(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class $O{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Hi(this.U.delete())}}class hc extends se{constructor(e,n){super(G.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function Ri(t){return t.name==="IndexedDbTransactionError"}class BO{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(te(Zn,"PUT",this.store.name,e,n),r=this.store.put(n,e)):(te(Zn,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Hi(r)}add(e){return te(Zn,"ADD",this.store.name,e,e),Hi(this.store.add(e))}get(e){return Hi(this.store.get(e)).next(n=>(n===void 0&&(n=null),te(Zn,"GET",this.store.name,e,n),n))}delete(e){return te(Zn,"DELETE",this.store.name,e),Hi(this.store.delete(e))}count(){return te(Zn,"COUNT",this.store.name),Hi(this.store.count())}J(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new F((a,l)=>{i.onerror=c=>{l(c.target.error)},i.onsuccess=c=>{a(c.target.result)}})}{const i=this.cursor(r),a=[];return this.H(i,(l,c)=>{a.push(c)}).next(()=>a)}}Y(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new F((s,i)=>{r.onerror=a=>{i(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}Z(e,n){te(Zn,"DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const s=this.cursor(r);return this.H(s,(i,a,l)=>l.delete())}ee(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.H(s,n)}te(e){const n=this.cursor({});return new F((r,s)=>{n.onerror=i=>{const a=sv(i.target.error);s(a)},n.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next(l=>{l?a.continue():r()}):r()}})}H(e,n){const r=[];return new F((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const l=a.target.result;if(!l)return void s();const c=new $O(l),d=n(l.primaryKey,l.value,c);if(d instanceof F){const h=d.catch(f=>(c.done(),F.reject(f)));r.push(h)}c.isDone?s():c.G===null?l.continue():l.continue(c.G)}}).next(()=>F.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function Hi(t){return new F((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=sv(r.target.error);n(s)}})}let Yb=!1;function sv(t){const e=gi.M(en());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new se("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Yb||(Yb=!0,setTimeout(()=>{throw r},0)),r}}return t}const fc="IndexBackfiller";class zO{constructor(e,n){this.asyncQueue=e,this.ne=n,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){te(fc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const n=await this.ne.ie();te(fc,`Documents written: ${n}`)}catch(n){Ri(n)?te(fc,"Ignoring IndexedDB error during index backfill: ",n):await Vo(n)}await this.re(6e4)})}}class qO{constructor(e,n){this.localStore=e,this.persistence=n}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.se(n,e))}se(e,n){const r=new Set;let s=n,i=!0;return F.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return te(fc,`Processing collection: ${a}`),this.oe(e,a,s).next(l=>{s-=l,r.add(a)});i=!1})).next(()=>n-s)}oe(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this._e(s,i)).next(l=>(te(fc,`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,n,l))).next(()=>a.size)}))}_e(e,n){let r=e;return n.changes.forEach((s,i)=>{const a=DT(i);rv(a,r)>0&&(r=a)}),new ir(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}fr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const so=-1;function ff(t){return t==null}function zc(t){return t===0&&1/t==-1/0}function HO(t){return typeof t=="number"&&Number.isInteger(t)&&!zc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vh="";function Sn(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Xb(e)),e=WO(t.get(n),e);return Xb(e)}function WO(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case vh:n+="";break;default:n+=i}}return n}function Xb(t){return t+vh+""}function Qr(t){const e=t.length;if(Ne(e>=2,64408,{path:t}),e===2)return Ne(t.charAt(0)===vh&&t.charAt(1)==="",56145,{path:t}),ct.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const a=t.indexOf(vh,i);switch((a<0||a>n)&&Se(50515,{path:t}),t.charAt(a+1)){case"":const l=t.substring(i,a);let c;s.length===0?c=l:(s+=l,c=s,s=""),r.push(c);break;case"":s+=t.substring(i,a),s+="\0";break;case"":s+=t.substring(i,a+1);break;default:Se(61167,{path:t})}i=a+2}return new ct(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qi="remoteDocuments",uu="owner",zo="owner",qc="mutationQueues",GO="userId",Cr="mutations",Jb="batchId",Zi="userMutationsIndex",Zb=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Td(t,e){return[t,Sn(e)]}function MT(t,e,n){return[t,Sn(e),n]}const KO={},za="documentMutations",_h="remoteDocumentsV14",QO=["prefixPath","collectionGroup","readTime","documentId"],Cd="documentKeyIndex",YO=["prefixPath","collectionGroup","documentId"],FT="collectionGroupIndex",XO=["collectionGroup","readTime","prefixPath","documentId"],Hc="remoteDocumentGlobal",pg="remoteDocumentGlobalKey",qa="targets",UT="queryTargetsIndex",JO=["canonicalId","targetId"],Ha="targetDocuments",ZO=["targetId","path"],iv="documentTargetsIndex",eL=["path","targetId"],xh="targetGlobalKey",io="targetGlobal",Wc="collectionParents",tL=["collectionId","parent"],Wa="clientMetadata",nL="clientId",pf="bundles",rL="bundleId",mf="namedQueries",sL="name",ov="indexConfiguration",iL="indexId",mg="collectionGroupIndex",oL="collectionGroup",pc="indexState",aL=["indexId","uid"],$T="sequenceNumberIndex",lL=["uid","sequenceNumber"],mc="indexEntries",cL=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],BT="documentKeyIndex",uL=["indexId","uid","orderedDocumentKey"],gf="documentOverlays",dL=["userId","collectionPath","documentId"],gg="collectionPathOverlayIndex",hL=["userId","collectionPath","largestBatchId"],zT="collectionGroupOverlayIndex",fL=["userId","collectionGroup","largestBatchId"],av="globals",pL="name",qT=[qc,Cr,za,qi,qa,uu,io,Ha,Wa,Hc,Wc,pf,mf],mL=[...qT,gf],HT=[qc,Cr,za,_h,qa,uu,io,Ha,Wa,Hc,Wc,pf,mf,gf],WT=HT,lv=[...WT,ov,pc,mc],gL=lv,GT=[...lv,av],yL=GT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg extends LT{constructor(e,n){super(),this.le=e,this.currentSequenceNumber=n}}function tn(t,e){const n=$e(t);return gi.O(n.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ew(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Pi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function vL(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function KT(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e,n){this.comparator=e,this.root=n||hn.EMPTY}insert(e,n){return new jt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,hn.BLACK,null,null))}remove(e){return new jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Yu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Yu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Yu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Yu(this.root,e,this.comparator,!0)}}class Yu{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class hn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??hn.RED,this.left=s??hn.EMPTY,this.right=i??hn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new hn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return hn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return hn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,hn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,hn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Se(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Se(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Se(27949);return e+(this.isRed()?0:1)}}hn.EMPTY=null,hn.RED=!0,hn.BLACK=!1;hn.EMPTY=new class{constructor(){this.size=0}get key(){throw Se(57766)}get value(){throw Se(16141)}get color(){throw Se(16727)}get left(){throw Se(29726)}get right(){throw Se(36894)}copy(e,n,r,s,i){return this}insert(e,n,r){return new hn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e){this.comparator=e,this.data=new jt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new tw(this.data.getIterator())}getIteratorFrom(e){return new tw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof mt)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new mt(this.comparator);return n.data=e,n}}class tw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function qo(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zn{constructor(e){this.fields=e,e.sort(kt.comparator)}static empty(){return new zn([])}unionWith(e){let n=new mt(kt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new zn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ba(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new QT("Invalid base64 string: "+i):i}}(e);return new Yt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Yt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return He(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Yt.EMPTY_BYTE_STRING=new Yt("");const _L=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ns(t){if(Ne(!!t,39018),typeof t=="string"){let e=0;const n=_L.exec(t);if(Ne(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Tt(t.seconds),nanos:Tt(t.nanos)}}function Tt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function js(t){return typeof t=="string"?Yt.fromBase64String(t):Yt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YT="server_timestamp",XT="__type__",JT="__previous_value__",ZT="__local_write_time__";function yf(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[XT])==null?void 0:r.stringValue)===YT}function vf(t){const e=t.mapValue.fields[JT];return yf(e)?vf(e):e}function Gc(t){const e=Ns(t.mapValue.fields[ZT].timestampValue);return new ot(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xL{constructor(e,n,r,s,i,a,l,c,d,h){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=h}}const bh="(default)";class _o{constructor(e,n){this.projectId=e,this.database=n||bh}static empty(){return new _o("","")}get isDefaultDatabase(){return this.database===bh}isEqual(e){return e instanceof _o&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cv="__type__",eC="__max__",ri={mapValue:{fields:{__type__:{stringValue:eC}}}},uv="__vector__",Ga="value",Nd={nullValue:"NULL_VALUE"};function xi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?yf(t)?4:tC(t)?9007199254740991:_f(t)?10:11:Se(28295,{value:t})}function ss(t,e){if(t===e)return!0;const n=xi(t);if(n!==xi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Gc(t).isEqual(Gc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=Ns(s.timestampValue),l=Ns(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return js(s.bytesValue).isEqual(js(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return Tt(s.geoPointValue.latitude)===Tt(i.geoPointValue.latitude)&&Tt(s.geoPointValue.longitude)===Tt(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Tt(s.integerValue)===Tt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=Tt(s.doubleValue),l=Tt(i.doubleValue);return a===l?zc(a)===zc(l):isNaN(a)&&isNaN(l)}return!1}(t,e);case 9:return Ba(t.arrayValue.values||[],e.arrayValue.values||[],ss);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(ew(a)!==ew(l))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(l[c]===void 0||!ss(a[c],l[c])))return!1;return!0}(t,e);default:return Se(52216,{left:t})}}function Kc(t,e){return(t.values||[]).find(n=>ss(n,e))!==void 0}function bi(t,e){if(t===e)return 0;const n=xi(t),r=xi(e);if(n!==r)return He(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return He(t.booleanValue,e.booleanValue);case 2:return function(i,a){const l=Tt(i.integerValue||i.doubleValue),c=Tt(a.integerValue||a.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return nw(t.timestampValue,e.timestampValue);case 4:return nw(Gc(t),Gc(e));case 5:return hg(t.stringValue,e.stringValue);case 6:return function(i,a){const l=js(i),c=js(a);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(i,a){const l=i.split("/"),c=a.split("/");for(let d=0;d<l.length&&d<c.length;d++){const h=He(l[d],c[d]);if(h!==0)return h}return He(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,a){const l=He(Tt(i.latitude),Tt(a.latitude));return l!==0?l:He(Tt(i.longitude),Tt(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return rw(t.arrayValue,e.arrayValue);case 10:return function(i,a){var m,x,T,N;const l=i.fields||{},c=a.fields||{},d=(m=l[Ga])==null?void 0:m.arrayValue,h=(x=c[Ga])==null?void 0:x.arrayValue,f=He(((T=d==null?void 0:d.values)==null?void 0:T.length)||0,((N=h==null?void 0:h.values)==null?void 0:N.length)||0);return f!==0?f:rw(d,h)}(t.mapValue,e.mapValue);case 11:return function(i,a){if(i===ri.mapValue&&a===ri.mapValue)return 0;if(i===ri.mapValue)return 1;if(a===ri.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),d=a.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let f=0;f<c.length&&f<h.length;++f){const m=hg(c[f],h[f]);if(m!==0)return m;const x=bi(l[c[f]],d[h[f]]);if(x!==0)return x}return He(c.length,h.length)}(t.mapValue,e.mapValue);default:throw Se(23264,{he:n})}}function nw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return He(t,e);const n=Ns(t),r=Ns(e),s=He(n.seconds,r.seconds);return s!==0?s:He(n.nanos,r.nanos)}function rw(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=bi(n[s],r[s]);if(i)return i}return He(n.length,r.length)}function Ka(t){return vg(t)}function vg(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Ns(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return js(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return he.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=vg(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${vg(n.fields[a])}`;return s+"}"}(t.mapValue):Se(61005,{value:t})}function jd(t){switch(xi(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=vf(t);return e?16+jd(e):16;case 5:return 2*t.stringValue.length;case 6:return js(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+jd(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return Pi(r.fields,(i,a)=>{s+=i.length+jd(a)}),s}(t.mapValue);default:throw Se(13486,{value:t})}}function xo(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function _g(t){return!!t&&"integerValue"in t}function Qc(t){return!!t&&"arrayValue"in t}function sw(t){return!!t&&"nullValue"in t}function iw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ad(t){return!!t&&"mapValue"in t}function _f(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[cv])==null?void 0:r.stringValue)===uv}function gc(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Pi(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=gc(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=gc(t.arrayValue.values[n]);return e}return{...t}}function tC(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===eC}const nC={mapValue:{fields:{[cv]:{stringValue:uv},[Ga]:{arrayValue:{}}}}};function bL(t){return"nullValue"in t?Nd:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?xo(_o.empty(),he.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?_f(t)?nC:{mapValue:{}}:Se(35942,{value:t})}function wL(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?xo(_o.empty(),he.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?nC:"mapValue"in t?_f(t)?{mapValue:{}}:ri:Se(61959,{value:t})}function ow(t,e){const n=bi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function aw(t,e){const n=bi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e){this.value=e}static empty(){return new wn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Ad(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=gc(n)}setAll(e){let n=kt.emptyPath(),r={},s=[];e.forEach((a,l)=>{if(!n.isImmediateParentOf(l)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=l.popLast()}a?r[l.lastSegment()]=gc(a):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Ad(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return ss(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Ad(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Pi(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new wn(gc(this.value))}}function rC(t){const e=[];return Pi(t.fields,(n,r)=>{const s=new kt([n]);if(Ad(r)){const i=rC(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new zn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e,n,r,s,i,a,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Ft(e,0,je.min(),je.min(),je.min(),wn.empty(),0)}static newFoundDocument(e,n,r,s){return new Ft(e,1,n,je.min(),r,s,0)}static newNoDocument(e,n){return new Ft(e,2,n,je.min(),je.min(),wn.empty(),0)}static newUnknownDocument(e,n){return new Ft(e,3,n,je.min(),je.min(),wn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(je.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=wn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=wn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=je.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ft&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ft(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e,n){this.position=e,this.inclusive=n}}function lw(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],a=t.position[s];if(i.field.isKeyField()?r=he.comparator(he.fromName(a.referenceValue),n.key):r=bi(a,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function cw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ss(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc{constructor(e,n="asc"){this.field=e,this.dir=n}}function EL(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sC{}class nt extends sC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new IL(e,n,r):n==="array-contains"?new CL(e,r):n==="in"?new uC(e,r):n==="not-in"?new NL(e,r):n==="array-contains-any"?new jL(e,r):new nt(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new SL(e,r):new TL(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(bi(n,this.value)):n!==null&&xi(this.value)===xi(n)&&this.matchesComparison(bi(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Se(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ft extends sC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ft(e,n)}matches(e){return Qa(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Qa(t){return t.op==="and"}function xg(t){return t.op==="or"}function dv(t){return iC(t)&&Qa(t)}function iC(t){for(const e of t.filters)if(e instanceof ft)return!1;return!0}function bg(t){if(t instanceof nt)return t.field.canonicalString()+t.op.toString()+Ka(t.value);if(dv(t))return t.filters.map(e=>bg(e)).join(",");{const e=t.filters.map(n=>bg(n)).join(",");return`${t.op}(${e})`}}function oC(t,e){return t instanceof nt?function(r,s){return s instanceof nt&&r.op===s.op&&r.field.isEqual(s.field)&&ss(r.value,s.value)}(t,e):t instanceof ft?function(r,s){return s instanceof ft&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,l)=>i&&oC(a,s.filters[l]),!0):!1}(t,e):void Se(19439)}function aC(t,e){const n=t.filters.concat(e);return ft.create(n,t.op)}function lC(t){return t instanceof nt?function(n){return`${n.field.canonicalString()} ${n.op} ${Ka(n.value)}`}(t):t instanceof ft?function(n){return n.op.toString()+" {"+n.getFilters().map(lC).join(" ,")+"}"}(t):"Filter"}class IL extends nt{constructor(e,n,r){super(e,n,r),this.key=he.fromName(r.referenceValue)}matches(e){const n=he.comparator(e.key,this.key);return this.matchesComparison(n)}}class SL extends nt{constructor(e,n){super(e,"in",n),this.keys=cC("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class TL extends nt{constructor(e,n){super(e,"not-in",n),this.keys=cC("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function cC(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>he.fromName(r.referenceValue))}class CL extends nt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Qc(n)&&Kc(n.arrayValue,this.value)}}class uC extends nt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Kc(this.value.arrayValue,n)}}class NL extends nt{constructor(e,n){super(e,"not-in",n)}matches(e){if(Kc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Kc(this.value.arrayValue,n)}}class jL extends nt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Qc(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Kc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(e,n=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Te=null}}function wg(t,e=null,n=[],r=[],s=null,i=null,a=null){return new AL(t,e,n,r,s,i,a)}function bo(t){const e=$e(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>bg(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),ff(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Ka(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Ka(r)).join(",")),e.Te=n}return e.Te}function du(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!EL(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!oC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!cw(t.startAt,e.startAt)&&cw(t.endAt,e.endAt)}function wh(t){return he.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function Eh(t,e){return t.filters.filter(n=>n instanceof nt&&n.field.isEqual(e))}function uw(t,e,n){let r=Nd,s=!0;for(const i of Eh(t,e)){let a=Nd,l=!0;switch(i.op){case"<":case"<=":a=bL(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,l=!1;break;case"!=":case"not-in":a=Nd}ow({value:r,inclusive:s},{value:a,inclusive:l})<0&&(r=a,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];ow({value:r,inclusive:s},{value:a,inclusive:n.inclusive})<0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}function dw(t,e,n){let r=ri,s=!0;for(const i of Eh(t,e)){let a=ri,l=!0;switch(i.op){case">=":case">":a=wL(i.value),l=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,l=!1;break;case"!=":case"not-in":a=ri}aw({value:r,inclusive:s},{value:a,inclusive:l})>0&&(r=a,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];aw({value:r,inclusive:s},{value:a,inclusive:n.inclusive})>0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(e,n=null,r=[],s=[],i=null,a="F",l=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function RL(t,e,n,r,s,i,a,l){return new ki(t,e,n,r,s,i,a,l)}function hu(t){return new ki(t)}function hw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function hv(t){return t.collectionGroup!==null}function Aa(t){const e=$e(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new mt(kt.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Yc(i,r))}),n.has(kt.keyField().canonicalString())||e.Ie.push(new Yc(kt.keyField(),r))}return e.Ie}function mr(t){const e=$e(t);return e.Ee||(e.Ee=dC(e,Aa(t))),e.Ee}function PL(t){const e=$e(t);return e.de||(e.de=dC(e,t.explicitOrderBy)),e.de}function dC(t,e){if(t.limitType==="F")return wg(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Yc(s.field,i)});const n=t.endAt?new wi(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new wi(t.startAt.position,t.startAt.inclusive):null;return wg(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Eg(t,e){const n=t.filters.concat([e]);return new ki(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Ih(t,e,n){return new ki(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function xf(t,e){return du(mr(t),mr(e))&&t.limitType===e.limitType}function hC(t){return`${bo(mr(t))}|lt:${t.limitType}`}function ia(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>lC(s)).join(", ")}]`),ff(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Ka(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Ka(s)).join(",")),`Target(${r})`}(mr(t))}; limitType=${t.limitType})`}function fu(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):he.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of Aa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(a,l,c){const d=lw(a,l,c);return a.inclusive?d<=0:d<0}(r.startAt,Aa(r),s)||r.endAt&&!function(a,l,c){const d=lw(a,l,c);return a.inclusive?d>=0:d>0}(r.endAt,Aa(r),s))}(t,e)}function kL(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function fC(t){return(e,n)=>{let r=!1;for(const s of Aa(t)){const i=DL(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function DL(t,e,n){const r=t.field.isKeyField()?he.comparator(e.key,n.key):function(i,a,l){const c=a.data.field(i),d=l.data.field(i);return c!==null&&d!==null?bi(c,d):Se(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Se(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Pi(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return KT(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OL=new jt(he.comparator);function tr(){return OL}const pC=new jt(he.comparator);function Ql(...t){let e=pC;for(const n of t)e=e.insert(n.key,n);return e}function mC(t){let e=pC;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Yr(){return yc()}function gC(){return yc()}function yc(){return new Rs(t=>t.toString(),(t,e)=>t.isEqual(e))}const LL=new jt(he.comparator),VL=new mt(he.comparator);function Xe(...t){let e=VL;for(const n of t)e=e.add(n);return e}const ML=new mt(He);function FL(){return ML}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fv(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zc(e)?"-0":e}}function yC(t){return{integerValue:""+t}}function vC(t,e){return HO(e)?yC(e):fv(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{constructor(){this._=void 0}}function UL(t,e,n){return t instanceof Ya?function(s,i){const a={fields:{[XT]:{stringValue:YT},[ZT]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&yf(i)&&(i=vf(i)),i&&(a.fields[JT]=i),{mapValue:a}}(n,e):t instanceof wo?xC(t,e):t instanceof Xa?bC(t,e):function(s,i){const a=_C(s,i),l=fw(a)+fw(s.Ae);return _g(a)&&_g(s.Ae)?yC(l):fv(s.serializer,l)}(t,e)}function $L(t,e,n){return t instanceof wo?xC(t,e):t instanceof Xa?bC(t,e):n}function _C(t,e){return t instanceof Ja?function(r){return _g(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Ya extends bf{}class wo extends bf{constructor(e){super(),this.elements=e}}function xC(t,e){const n=wC(e);for(const r of t.elements)n.some(s=>ss(s,r))||n.push(r);return{arrayValue:{values:n}}}class Xa extends bf{constructor(e){super(),this.elements=e}}function bC(t,e){let n=wC(e);for(const r of t.elements)n=n.filter(s=>!ss(s,r));return{arrayValue:{values:n}}}class Ja extends bf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function fw(t){return Tt(t.integerValue||t.doubleValue)}function wC(t){return Qc(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(e,n){this.field=e,this.transform=n}}function BL(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof wo&&s instanceof wo||r instanceof Xa&&s instanceof Xa?Ba(r.elements,s.elements,ss):r instanceof Ja&&s instanceof Ja?ss(r.Ae,s.Ae):r instanceof Ya&&s instanceof Ya}(t.transform,e.transform)}class zL{constructor(e,n){this.version=e,this.transformResults=n}}class En{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new En}static exists(e){return new En(void 0,e)}static updateTime(e){return new En(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Rd(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Ef{}function EC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new If(t.key,En.none()):new ul(t.key,t.data,En.none());{const n=t.data,r=wn.empty();let s=new mt(kt.comparator);for(let i of e.fields)if(!s.has(i)){let a=n.field(i);a===null&&i.length>1&&(i=i.popLast(),a=n.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Ps(t.key,r,new zn(s.toArray()),En.none())}}function qL(t,e,n){t instanceof ul?function(s,i,a){const l=s.value.clone(),c=mw(s.fieldTransforms,i,a.transformResults);l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Ps?function(s,i,a){if(!Rd(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=mw(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(IC(s)),c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(t,e,n):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function vc(t,e,n,r){return t instanceof ul?function(i,a,l,c){if(!Rd(i.precondition,a))return l;const d=i.value.clone(),h=gw(i.fieldTransforms,c,a);return d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ps?function(i,a,l,c){if(!Rd(i.precondition,a))return l;const d=gw(i.fieldTransforms,c,a),h=a.data;return h.setAll(IC(i)),h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(i,a,l){return Rd(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(t,e,n)}function HL(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=_C(r.transform,s||null);i!=null&&(n===null&&(n=wn.empty()),n.set(r.field,i))}return n||null}function pw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ba(r,s,(i,a)=>BL(i,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ul extends Ef{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ps extends Ef{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function IC(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function mw(t,e,n){const r=new Map;Ne(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,$L(a,l,n[s]))}return r}function gw(t,e,n){const r=new Map;for(const s of t){const i=s.transform,a=n.data.field(s.field);r.set(s.field,UL(i,a,e))}return r}class If extends Ef{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class SC extends Ef{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&qL(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=vc(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=vc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=gC();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=n.has(s.key)?null:l;const c=EC(a,l);c!==null&&r.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(je.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Xe())}isEqual(e){return this.batchId===e.batchId&&Ba(this.mutations,e.mutations,(n,r)=>pw(n,r))&&Ba(this.baseMutations,e.baseMutations,(n,r)=>pw(n,r))}}class mv{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Ne(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return LL}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new mv(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WL{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GL{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gt,st;function KL(t){switch(t){case G.OK:return Se(64938);case G.CANCELLED:case G.UNKNOWN:case G.DEADLINE_EXCEEDED:case G.RESOURCE_EXHAUSTED:case G.INTERNAL:case G.UNAVAILABLE:case G.UNAUTHENTICATED:return!1;case G.INVALID_ARGUMENT:case G.NOT_FOUND:case G.ALREADY_EXISTS:case G.PERMISSION_DENIED:case G.FAILED_PRECONDITION:case G.ABORTED:case G.OUT_OF_RANGE:case G.UNIMPLEMENTED:case G.DATA_LOSS:return!0;default:return Se(15467,{code:t})}}function TC(t){if(t===void 0)return Rn("GRPC error has no .code"),G.UNKNOWN;switch(t){case Gt.OK:return G.OK;case Gt.CANCELLED:return G.CANCELLED;case Gt.UNKNOWN:return G.UNKNOWN;case Gt.DEADLINE_EXCEEDED:return G.DEADLINE_EXCEEDED;case Gt.RESOURCE_EXHAUSTED:return G.RESOURCE_EXHAUSTED;case Gt.INTERNAL:return G.INTERNAL;case Gt.UNAVAILABLE:return G.UNAVAILABLE;case Gt.UNAUTHENTICATED:return G.UNAUTHENTICATED;case Gt.INVALID_ARGUMENT:return G.INVALID_ARGUMENT;case Gt.NOT_FOUND:return G.NOT_FOUND;case Gt.ALREADY_EXISTS:return G.ALREADY_EXISTS;case Gt.PERMISSION_DENIED:return G.PERMISSION_DENIED;case Gt.FAILED_PRECONDITION:return G.FAILED_PRECONDITION;case Gt.ABORTED:return G.ABORTED;case Gt.OUT_OF_RANGE:return G.OUT_OF_RANGE;case Gt.UNIMPLEMENTED:return G.UNIMPLEMENTED;case Gt.DATA_LOSS:return G.DATA_LOSS;default:return Se(39323,{code:t})}}(st=Gt||(Gt={}))[st.OK=0]="OK",st[st.CANCELLED=1]="CANCELLED",st[st.UNKNOWN=2]="UNKNOWN",st[st.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",st[st.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",st[st.NOT_FOUND=5]="NOT_FOUND",st[st.ALREADY_EXISTS=6]="ALREADY_EXISTS",st[st.PERMISSION_DENIED=7]="PERMISSION_DENIED",st[st.UNAUTHENTICATED=16]="UNAUTHENTICATED",st[st.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",st[st.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",st[st.ABORTED=10]="ABORTED",st[st.OUT_OF_RANGE=11]="OUT_OF_RANGE",st[st.UNIMPLEMENTED=12]="UNIMPLEMENTED",st[st.INTERNAL=13]="INTERNAL",st[st.UNAVAILABLE=14]="UNAVAILABLE",st[st.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YL=new mi([4294967295,4294967295],0);function yw(t){const e=QL().encode(t),n=new ET;return n.update(e),new Uint8Array(n.digest())}function vw(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new mi([n,r],0),new mi([s,i],0)]}class yv{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Yl(`Invalid padding: ${n}`);if(r<0)throw new Yl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Yl(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Yl(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=mi.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(mi.fromNumber(r)));return s.compare(YL)===1&&(s=new mi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=yw(e),[r,s]=vw(n);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new yv(i,s,n);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.ge===0)return;const n=yw(e),[r,s]=vw(n);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Yl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,pu.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Sf(je.min(),s,new jt(He),tr(),Xe())}}class pu{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new pu(r,n,Xe(),Xe(),Xe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class CC{constructor(e,n){this.targetId=e,this.Ce=n}}class NC{constructor(e,n,r=Yt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class _w{constructor(){this.ve=0,this.Fe=xw(),this.Me=Yt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Xe(),n=Xe(),r=Xe();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:Se(38017,{changeType:i})}}),new pu(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=xw()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Ne(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class XL{constructor(e){this.Ge=e,this.ze=new Map,this.je=tr(),this.Je=Xu(),this.He=Xu(),this.Ye=new jt(He)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Se(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,s)=>{this.rt(s)&&n(s)})}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const i=s.target;if(wh(i))if(r===0){const a=new he(i.path);this.et(n,a,Ft.newNoDocument(a,je.min()))}else Ne(r===1,20013,{expectedCount:r});else{const a=this._t(n);if(a!==r){const l=this.ut(e),c=l?this.ct(l,e,a):1;if(c!==0){this.it(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,d)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let a,l;try{a=js(r).toUint8Array()}catch(c){if(c instanceof QT)return vo("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new yv(a,s,i)}catch(c){return vo(c instanceof Yl?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(n,i,null),s++)}),s}Tt(e){const n=new Map;this.ze.forEach((i,a)=>{const l=this.ot(a);if(l){if(i.current&&wh(l.target)){const c=new he(l.target.path);this.It(c).has(a)||this.Et(a,c)||this.et(a,c,Ft.newNoDocument(c,e))}i.Be&&(n.set(a,i.ke()),i.qe())}});let r=Xe();this.He.forEach((i,a)=>{let l=!0;a.forEachWhile(c=>{const d=this.ot(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.je.forEach((i,a)=>a.setReadTime(e));const s=new Sf(e,n,this.Ye,this.je,r);return this.je=tr(),this.Je=Xu(),this.He=Xu(),this.Ye=new jt(He),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new _w,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new mt(He),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new mt(He),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||te("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new _w),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Xu(){return new jt(he.comparator)}function xw(){return new jt(he.comparator)}const JL={asc:"ASCENDING",desc:"DESCENDING"},ZL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eV={and:"AND",or:"OR"};class tV{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Ig(t,e){return t.useProto3Json||ff(e)?e:{value:e}}function Za(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function nV(t,e){return Za(t,e.toTimestamp())}function Dn(t){return Ne(!!t,49232),je.fromTimestamp(function(n){const r=Ns(n);return new ot(r.seconds,r.nanos)}(t))}function vv(t,e){return Sg(t,e).canonicalString()}function Sg(t,e){const n=function(s){return new ct(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function AC(t){const e=ct.fromString(t);return Ne(MC(e),10190,{key:e.toString()}),e}function Sh(t,e){return vv(t.databaseId,e.path)}function oo(t,e){const n=AC(e);if(n.get(1)!==t.databaseId.projectId)throw new se(G.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new se(G.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new he(kC(n))}function RC(t,e){return vv(t.databaseId,e)}function PC(t){const e=AC(t);return e.length===4?ct.emptyPath():kC(e)}function Tg(t){return new ct(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function kC(t){return Ne(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function bw(t,e,n){return{name:Sh(t,e),fields:n.value.mapValue.fields}}function rV(t,e,n){const r=oo(t,e.name),s=Dn(e.updateTime),i=e.createTime?Dn(e.createTime):je.min(),a=new wn({mapValue:{fields:e.fields}}),l=Ft.newFoundDocument(r,s,i,a);return n&&l.setHasCommittedMutations(),n?l.setHasCommittedMutations():l}function sV(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Se(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,h){return d.useProto3Json?(Ne(h===void 0||typeof h=="string",58123),Yt.fromBase64String(h||"")):(Ne(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Yt.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(d){const h=d.code===void 0?G.UNKNOWN:TC(d.code);return new se(h,d.message||"")}(a);n=new NC(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=oo(t,r.document.name),i=Dn(r.document.updateTime),a=r.document.createTime?Dn(r.document.createTime):je.min(),l=new wn({mapValue:{fields:r.document.fields}}),c=Ft.newFoundDocument(s,i,a,l),d=r.targetIds||[],h=r.removedTargetIds||[];n=new Pd(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=oo(t,r.document),i=r.readTime?Dn(r.readTime):je.min(),a=Ft.newNoDocument(s,i),l=r.removedTargetIds||[];n=new Pd([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=oo(t,r.document),i=r.removedTargetIds||[];n=new Pd([],i,s,null)}else{if(!("filter"in e))return Se(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new GL(s,i),l=r.targetId;n=new CC(l,a)}}return n}function Th(t,e){let n;if(e instanceof ul)n={update:bw(t,e.key,e.value)};else if(e instanceof If)n={delete:Sh(t,e.key)};else if(e instanceof Ps)n={update:bw(t,e.key,e.data),updateMask:dV(e.fieldMask)};else{if(!(e instanceof SC))return Se(16599,{Vt:e.type});n={verify:Sh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const l=a.transform;if(l instanceof Ya)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof wo)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Xa)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ja)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw Se(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:nV(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Se(27497)}(t,e.precondition)),n}function Cg(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?En.updateTime(Dn(i.updateTime)):i.exists!==void 0?En.exists(i.exists):En.none()}(e.currentDocument):En.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(a,l){let c=null;if("setToServerValue"in l)Ne(l.setToServerValue==="REQUEST_TIME",16630,{proto:l}),c=new Ya;else if("appendMissingElements"in l){const h=l.appendMissingElements.values||[];c=new wo(h)}else if("removeAllFromArray"in l){const h=l.removeAllFromArray.values||[];c=new Xa(h)}else"increment"in l?c=new Ja(a,l.increment):Se(16584,{proto:l});const d=kt.fromServerFormat(l.fieldPath);return new wf(d,c)}(t,s)):[];if(e.update){e.update.name;const s=oo(t,e.update.name),i=new wn({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(c){const d=c.fieldPaths||[];return new zn(d.map(h=>kt.fromServerFormat(h)))}(e.updateMask);return new Ps(s,i,a,n,r)}return new ul(s,i,n,r)}if(e.delete){const s=oo(t,e.delete);return new If(s,n)}if(e.verify){const s=oo(t,e.verify);return new SC(s,n)}return Se(1463,{proto:e})}function iV(t,e){return t&&t.length>0?(Ne(e!==void 0,14353),t.map(n=>function(s,i){let a=s.updateTime?Dn(s.updateTime):Dn(i);return a.isEqual(je.min())&&(a=Dn(i)),new zL(a,s.transformResults||[])}(n,e))):[]}function DC(t,e){return{documents:[RC(t,e.path)]}}function _v(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=RC(t,s);const i=function(d){if(d.length!==0)return VC(ft.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(h=>function(m){return{field:Js(m.field),direction:lV(m.dir)}}(h))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const l=Ig(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:n,parent:s}}function oV(t,e,n,r){const{ft:s,parent:i}=_v(t,e),a={},l=[];let c=0;return n.forEach(d=>{const h="aggregate_"+c++;a[h]=d.alias,d.aggregateType==="count"?l.push({alias:h,count:{}}):d.aggregateType==="avg"?l.push({alias:h,avg:{field:Js(d.fieldPath)}}):d.aggregateType==="sum"&&l.push({alias:h,sum:{field:Js(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:l,structuredQuery:s.structuredQuery},parent:s.parent},gt:a,parent:i}}function OC(t){let e=PC(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Ne(r===1,65062);const h=n.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];n.where&&(i=function(f){const m=LC(f);return m instanceof ft&&dv(m)?m.getFilters():[m]}(n.where));let a=[];n.orderBy&&(a=function(f){return f.map(m=>function(T){return new Yc(oa(T.field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(m))}(n.orderBy));let l=null;n.limit&&(l=function(f){let m;return m=typeof f=="object"?f.value:f,ff(m)?null:m}(n.limit));let c=null;n.startAt&&(c=function(f){const m=!!f.before,x=f.values||[];return new wi(x,m)}(n.startAt));let d=null;return n.endAt&&(d=function(f){const m=!f.before,x=f.values||[];return new wi(x,m)}(n.endAt)),RL(e,s,a,i,l,"F",c,d)}function aV(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Se(28987,{purpose:s})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function LC(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=oa(n.unaryFilter.field);return nt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=oa(n.unaryFilter.field);return nt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=oa(n.unaryFilter.field);return nt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=oa(n.unaryFilter.field);return nt.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Se(61313);default:return Se(60726)}}(t):t.fieldFilter!==void 0?function(n){return nt.create(oa(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Se(58110);default:return Se(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return ft.create(n.compositeFilter.filters.map(r=>LC(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Se(1026)}}(n.compositeFilter.op))}(t):Se(30097,{filter:t})}function lV(t){return JL[t]}function cV(t){return ZL[t]}function uV(t){return eV[t]}function Js(t){return{fieldPath:t.canonicalString()}}function oa(t){return kt.fromServerFormat(t.fieldPath)}function VC(t){return t instanceof nt?function(n){if(n.op==="=="){if(iw(n.value))return{unaryFilter:{field:Js(n.field),op:"IS_NAN"}};if(sw(n.value))return{unaryFilter:{field:Js(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(iw(n.value))return{unaryFilter:{field:Js(n.field),op:"IS_NOT_NAN"}};if(sw(n.value))return{unaryFilter:{field:Js(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Js(n.field),op:cV(n.op),value:n.value}}}(t):t instanceof ft?function(n){const r=n.getFilters().map(s=>VC(s));return r.length===1?r[0]:{compositeFilter:{op:uV(n.op),filters:r}}}(t):Se(54877,{filter:t})}function dV(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function MC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,n,r,s,i=je.min(),a=je.min(),l=Yt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new ys(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ys(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e){this.yt=e}}function hV(t,e){let n;if(e.document)n=rV(t.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=he.fromSegments(e.noDocument.path),s=Io(e.noDocument.readTime);n=Ft.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return Se(56709);{const r=he.fromSegments(e.unknownDocument.path),s=Io(e.unknownDocument.version);n=Ft.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new ot(s[0],s[1]);return je.fromTimestamp(i)}(e.readTime)),n}function ww(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Ch(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,a){return{name:Sh(i,a.key),fields:a.data.value.mapValue.fields,updateTime:Za(i,a.version.toTimestamp()),createTime:Za(i,a.createTime.toTimestamp())}}(t.yt,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Eo(e.version)};else{if(!e.isUnknownDocument())return Se(57904,{document:e});r.unknownDocument={path:n.path.toArray(),version:Eo(e.version)}}return r}function Ch(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Eo(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Io(t){const e=new ot(t.seconds,t.nanoseconds);return je.fromTimestamp(e)}function Wi(t,e){const n=(e.baseMutations||[]).map(i=>Cg(t.yt,i));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];a.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Cg(t.yt,i)),s=ot.fromMillis(e.localWriteTimeMs);return new pv(e.batchId,s,n,r)}function Xl(t){const e=Io(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?Io(t.lastLimboFreeSnapshotVersion):je.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){const a=i.documents.length;return Ne(a===1,1966,{count:a}),mr(hu(PC(i.documents[0])))}(t.query):function(i){return mr(OC(i))}(t.query),new ys(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,Yt.fromBase64String(t.resumeToken))}function UC(t,e){const n=Eo(e.snapshotVersion),r=Eo(e.lastLimboFreeSnapshotVersion);let s;s=wh(e.target)?DC(t.yt,e.target):_v(t.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:bo(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function $C(t){const e=OC({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Ih(e,e.limit,"L"):e}function Vp(t,e){return new gv(e.largestBatchId,Cg(t.yt,e.overlayMutation))}function Ew(t,e){const n=e.path.lastSegment();return[t,Sn(e.path.popLast()),n]}function Iw(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:Eo(r.readTime),documentKey:Sn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{getBundleMetadata(e,n){return Sw(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:Io(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return Sw(e).put(function(s){return{bundleId:s.id,createTime:Eo(Dn(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return Tw(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:$C(i.bundledQuery),readTime:Io(i.readTime)}}(r)})}saveNamedQuery(e,n){return Tw(e).put(function(s){return{name:s.name,readTime:Eo(Dn(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function Sw(t){return tn(t,pf)}function Tw(t){return tn(t,mf)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,n){this.serializer=e,this.userId=n}static wt(e,n){const r=n.uid||"";return new Tf(e,r)}getOverlay(e,n){return kl(e).get(Ew(this.userId,n)).next(r=>r?Vp(this.serializer,r):null)}getOverlays(e,n){const r=Yr();return F.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,a)=>{const l=new gv(n,a);s.push(this.St(e,l))}),F.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(a=>s.add(Sn(a.getCollectionPath())));const i=[];return s.forEach(a=>{const l=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);i.push(kl(e).Z(gg,l))}),F.waitFor(i)}getOverlaysForCollection(e,n,r){const s=Yr(),i=Sn(n),a=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return kl(e).J(gg,a).next(l=>{for(const c of l){const d=Vp(this.serializer,c);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=Yr();let a;const l=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return kl(e).ee({index:zT,range:l},(c,d,h)=>{const f=Vp(this.serializer,d);i.size()<s||f.largestBatchId===a?(i.set(f.getKey(),f),a=f.largestBatchId):h.done()}).next(()=>i)}St(e,n){return kl(e).put(function(s,i,a){const[l,c,d]=Ew(i,a.mutation.key);return{userId:i,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Th(s.yt,a.mutation)}}(this.serializer,this.userId,n))}}function kl(t){return tn(t,gf)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pV{bt(e){return tn(e,av)}getSessionToken(e){return this.bt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?Yt.fromUint8Array(r):Yt.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.bt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(Tt(e.integerValue));else if("doubleValue"in e){const r=Tt(e.doubleValue);isNaN(r)?this.Ft(n,13):(this.Ft(n,15),zc(r)?n.Mt(0):n.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(n,20),typeof r=="string"&&(r=Ns(r)),n.xt(`${r.seconds||""}`),n.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(js(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(n,45),n.Mt(r.latitude||0),n.Mt(r.longitude||0)}else"mapValue"in e?tC(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):_f(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):Se(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){const r=e.fields||{};this.Ft(n,55);for(const s of Object.keys(r))this.Ot(s,n),this.Ct(r[s],n)}kt(e,n){var a,l;const r=e.fields||{};this.Ft(n,53);const s=Ga,i=((l=(a=r[s].arrayValue)==null?void 0:a.values)==null?void 0:l.length)||0;this.Ft(n,15),n.Mt(Tt(i)),this.Ot(s,n),this.Ct(r[s],n)}Qt(e,n){const r=e.values||[];this.Ft(n,50);for(const s of r)this.Ct(s,n)}Lt(e,n){this.Ft(n,37),he.fromName(e).path.forEach(r=>{this.Ft(n,60),this.Ut(r,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}}Gi.Kt=new Gi;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ho=255;function mV(t){if(t===0)return 8;let e=0;return t>>4||(e+=4,t<<=4),t>>6||(e+=2,t<<=2),t>>7||(e+=1),e}function Cw(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const a=mV(255&r[i]);if(s+=a,a!==8)break}return s}(t);return Math.ceil(e/8)}class gV{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Gt(r.value),r=n.next();this.zt()}jt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Jt(r.value),r=n.next();this.Ht()}Yt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=n.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=n.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const n=this.en(e),r=Cw(n);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}nn(e){const n=this.en(e),r=Cw(n);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}rn(){this.sn(Ho),this.sn(255)}_n(){this.an(Ho),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const n=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(e),r=!!(128&n[0]);n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Gt(e){const n=255&e;n===0?(this.sn(0),this.sn(255)):n===Ho?(this.sn(Ho),this.sn(0)):this.sn(n)}Jt(e){const n=255&e;n===0?(this.an(0),this.an(255)):n===Ho?(this.an(Ho),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class yV{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class vV{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Dl{constructor(){this.cn=new gV,this.ln=new yV(this.cn),this.hn=new vV(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ki{constructor(e,n,r,s){this.Tn=e,this.In=n,this.En=r,this.dn=s}An(){const e=this.dn.length,n=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.dn,0),n!==e?r.set([0],this.dn.length):++r[r.length-1],new Ki(this.Tn,this.In,this.En,r)}Rn(e,n,r){return{indexId:this.Tn,uid:e,arrayValue:kd(this.En),directionalValue:kd(this.dn),orderedDocumentKey:kd(n),documentKey:r.path.toArray()}}Vn(e,n,r){const s=this.Rn(e,n,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Us(t,e){let n=t.Tn-e.Tn;return n!==0?n:(n=Nw(t.En,e.En),n!==0?n:(n=Nw(t.dn,e.dn),n!==0?n:he.comparator(t.In,e.In)))}function Nw(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}function kd(t){return OS()?function(n){let r="";for(let s=0;s<n.length;s++)r+=String.fromCharCode(n[s]);return r}(t):t}function jw(t){return typeof t!="string"?t:function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(t)}class Aw{constructor(e){this.mn=new mt((n,r)=>kt.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const n of e.filters){const r=n;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(Ne(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const n=fg(e);if(n!==void 0&&!this.wn(n))return!1;const r=zi(e);let s=new Set,i=0,a=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const l=this.mn.getIterator().getNext();if(!s.has(l.field.canonicalString())){const c=r[i];if(!this.Sn(l,c)||!this.bn(this.fn[a++],c))return!1}++i}for(;i<r.length;++i){const l=r[i];if(a>=this.fn.length||!this.bn(this.fn[a++],l))return!1}return!0}Dn(){if(this.pn)return null;let e=new mt(kt.comparator);const n=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new Sd(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new Sd(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new Sd(r.field,r.dir==="asc"?0:1)));return new yh(yh.UNKNOWN_ID,this.collectionId,n,Bc.empty())}wn(e){for(const n of this.gn)if(this.Sn(n,e))return!0;return!1}Sn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}bn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BC(t){var n,r;if(Ne(t instanceof nt||t instanceof ft,20012),t instanceof nt){if(t instanceof uC){const s=((r=(n=t.value.arrayValue)==null?void 0:n.values)==null?void 0:r.map(i=>nt.create(t.field,"==",i)))||[];return ft.create(s,"or")}return t}const e=t.filters.map(s=>BC(s));return ft.create(e,t.op)}function _V(t){if(t.getFilters().length===0)return[];const e=Ag(BC(t));return Ne(zC(e),7391),Ng(e)||jg(e)?[e]:e.getFilters()}function Ng(t){return t instanceof nt}function jg(t){return t instanceof ft&&dv(t)}function zC(t){return Ng(t)||jg(t)||function(n){if(n instanceof ft&&xg(n)){for(const r of n.getFilters())if(!Ng(r)&&!jg(r))return!1;return!0}return!1}(t)}function Ag(t){if(Ne(t instanceof nt||t instanceof ft,34018),t instanceof nt)return t;if(t.filters.length===1)return Ag(t.filters[0]);const e=t.filters.map(r=>Ag(r));let n=ft.create(e,t.op);return n=Nh(n),zC(n)?n:(Ne(n instanceof ft,64498),Ne(Qa(n),40251),Ne(n.filters.length>1,57927),n.filters.reduce((r,s)=>xv(r,s)))}function xv(t,e){let n;return Ne(t instanceof nt||t instanceof ft,38388),Ne(e instanceof nt||e instanceof ft,25473),n=t instanceof nt?e instanceof nt?function(s,i){return ft.create([s,i],"and")}(t,e):Rw(t,e):e instanceof nt?Rw(e,t):function(s,i){if(Ne(s.filters.length>0&&i.filters.length>0,48005),Qa(s)&&Qa(i))return aC(s,i.getFilters());const a=xg(s)?s:i,l=xg(s)?i:s,c=a.filters.map(d=>xv(d,l));return ft.create(c,"or")}(t,e),Nh(n)}function Rw(t,e){if(Qa(e))return aC(e,t.getFilters());{const n=e.filters.map(r=>xv(t,r));return ft.create(n,"or")}}function Nh(t){if(Ne(t instanceof nt||t instanceof ft,11850),t instanceof nt)return t;const e=t.getFilters();if(e.length===1)return Nh(e[0]);if(iC(t))return t;const n=e.map(s=>Nh(s)),r=[];return n.forEach(s=>{s instanceof nt?r.push(s):s instanceof ft&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:ft.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(){this.Cn=new bv}addToCollectionParentIndex(e,n){return this.Cn.add(n),F.resolve()}getCollectionParents(e,n){return F.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return F.resolve()}deleteFieldIndex(e,n){return F.resolve()}deleteAllFieldIndexes(e){return F.resolve()}createTargetIndexes(e,n){return F.resolve()}getDocumentsMatchingTarget(e,n){return F.resolve(null)}getIndexType(e,n){return F.resolve(0)}getFieldIndexes(e,n){return F.resolve([])}getNextCollectionGroupToUpdate(e){return F.resolve(null)}getMinOffset(e,n){return F.resolve(ir.min())}getMinOffsetFromCollectionGroup(e,n){return F.resolve(ir.min())}updateCollectionGroup(e,n,r){return F.resolve()}updateIndexEntries(e,n){return F.resolve()}}class bv{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new mt(ct.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new mt(ct.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pw="IndexedDbIndexManager",Ju=new Uint8Array(0);class bV{constructor(e,n){this.databaseId=n,this.vn=new bv,this.Fn=new Rs(r=>bo(r),(r,s)=>du(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.vn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.vn.add(n)});const i={collectionId:r,parent:Sn(s)};return kw(e).put(i)}return F.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[RT(n),""],!1,!0);return kw(e).J(s).next(i=>{for(const a of i){if(a.collectionId!==n)break;r.push(Qr(a.parent))}return r})}addFieldIndex(e,n){const r=Ol(e),s=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const a=Go(e);return i.next(l=>{a.put(Iw(l,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=Ol(e),s=Go(e),i=Wo(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=Ol(e),r=Wo(e),s=Go(e);return n.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,n){return F.forEach(this.Mn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Aw(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=Wo(e);let s=!0;const i=new Map;return F.forEach(this.Mn(n),a=>this.xn(e,a).next(l=>{s&&(s=!!l),i.set(a,l)})).next(()=>{if(s){let a=Xe();const l=[];return F.forEach(i,(c,d)=>{te(Pw,`Using index ${function(g){return`id=${g.indexId}|cg=${g.collectionGroup}|f=${g.fields.map(_=>`${_.fieldPath}:${_.kind}`).join(",")}`}(c)} to execute ${bo(n)}`);const h=function(g,_){const O=fg(_);if(O===void 0)return null;for(const L of Eh(g,O.fieldPath))switch(L.op){case"array-contains-any":return L.value.arrayValue.values||[];case"array-contains":return[L.value]}return null}(d,c),f=function(g,_){const O=new Map;for(const L of zi(_))for(const v of Eh(g,L.fieldPath))switch(v.op){case"==":case"in":O.set(L.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return O.set(L.fieldPath.canonicalString(),v.value),Array.from(O.values())}return null}(d,c),m=function(g,_){const O=[];let L=!0;for(const v of zi(_)){const w=v.kind===0?uw(g,v.fieldPath,g.startAt):dw(g,v.fieldPath,g.startAt);O.push(w.value),L&&(L=w.inclusive)}return new wi(O,L)}(d,c),x=function(g,_){const O=[];let L=!0;for(const v of zi(_)){const w=v.kind===0?dw(g,v.fieldPath,g.endAt):uw(g,v.fieldPath,g.endAt);O.push(w.value),L&&(L=w.inclusive)}return new wi(O,L)}(d,c),T=this.On(c,d,m),N=this.On(c,d,x),C=this.Nn(c,d,f),S=this.Bn(c.indexId,h,T,m.inclusive,N,x.inclusive,C);return F.forEach(S,E=>r.Y(E,n.limit).next(g=>{g.forEach(_=>{const O=he.fromSegments(_.documentKey);a.has(O)||(a=a.add(O),l.push(O))})}))}).next(()=>l)}return F.resolve(null)})}Mn(e){let n=this.Fn.get(e);return n||(e.filters.length===0?n=[e]:n=_V(ft.create(e.filters,"and")).map(r=>wg(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,n),n)}Bn(e,n,r,s,i,a,l){const c=(n!=null?n.length:1)*Math.max(r.length,i.length),d=c/(n!=null?n.length:1),h=[];for(let f=0;f<c;++f){const m=n?this.Ln(n[f/d]):Ju,x=this.kn(e,m,r[f%d],s),T=this.qn(e,m,i[f%d],a),N=l.map(C=>this.kn(e,m,C,!0));h.push(...this.createRange(x,T,N))}return h}kn(e,n,r,s){const i=new Ki(e,he.empty(),n,r);return s?i:i.An()}qn(e,n,r,s){const i=new Ki(e,he.empty(),n,r);return s?i.An():i}xn(e,n){const r=new Aw(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let a=null;for(const l of i)r.yn(l)&&(!a||l.fields.length>a.fields.length)&&(a=l);return a})}getIndexType(e,n){let r=2;const s=this.Mn(n);return F.forEach(s,i=>this.xn(e,i).next(a=>{a?r!==0&&a.fields.length<function(c){let d=new mt(kt.comparator),h=!1;for(const f of c.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:d=d.add(m.field));for(const f of c.orderBy)f.field.isKeyField()||(d=d.add(f.field));return d.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(n)&&s.length>1&&r===2?1:r)}Qn(e,n){const r=new Dl;for(const s of zi(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const a=r.Pn(s.kind);Gi.Kt.Dt(i,a)}return r.un()}Ln(e){const n=new Dl;return Gi.Kt.Dt(e,n.Pn(0)),n.un()}$n(e,n){const r=new Dl;return Gi.Kt.Dt(xo(this.databaseId,n),r.Pn(function(i){const a=zi(i);return a.length===0?0:a[a.length-1].kind}(e))),r.un()}Nn(e,n,r){if(r===null)return[];let s=[];s.push(new Dl);let i=0;for(const a of zi(e)){const l=r[i++];for(const c of s)if(this.Un(n,a.fieldPath)&&Qc(l))s=this.Kn(s,a,l);else{const d=c.Pn(a.kind);Gi.Kt.Dt(l,d)}}return this.Wn(s)}On(e,n,r){return this.Nn(e,n,r.position)}Wn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].un();return n}Kn(e,n,r){const s=[...e],i=[];for(const a of r.arrayValue.values||[])for(const l of s){const c=new Dl;c.seed(l.un()),Gi.Kt.Dt(a,c.Pn(n.kind)),i.push(c)}return i}Un(e,n){return!!e.filters.find(r=>r instanceof nt&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=Ol(e),s=Go(e);return(n?r.J(mg,IDBKeyRange.bound(n,n)):r.J()).next(i=>{const a=[];return F.forEach(i,l=>s.get([l.indexId,this.uid]).next(c=>{a.push(function(h,f){const m=f?new Bc(f.sequenceNumber,new ir(Io(f.readTime),new he(Qr(f.documentKey)),f.largestBatchId)):Bc.empty(),x=h.fields.map(([T,N])=>new Sd(kt.fromServerFormat(T),N));return new yh(h.indexId,h.collectionGroup,x,m)}(l,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:He(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Ol(e),i=Go(e);return this.Gn(e).next(a=>s.J(mg,IDBKeyRange.bound(n,n)).next(l=>F.forEach(l,c=>i.put(Iw(c.indexId,this.uid,a,r)))))}updateIndexEntries(e,n){const r=new Map;return F.forEach(n,(s,i)=>{const a=r.get(s.collectionGroup);return(a?F.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next(l=>(r.set(s.collectionGroup,l),F.forEach(l,c=>this.zn(e,s,c).next(d=>{const h=this.jn(i,c);return d.isEqual(h)?F.resolve():this.Jn(e,i,c,d,h)}))))})}Hn(e,n,r,s){return Wo(e).put(s.Rn(this.uid,this.$n(r,n.key),n.key))}Yn(e,n,r,s){return Wo(e).delete(s.Vn(this.uid,this.$n(r,n.key),n.key))}zn(e,n,r){const s=Wo(e);let i=new mt(Us);return s.ee({index:BT,range:IDBKeyRange.only([r.indexId,this.uid,kd(this.$n(r,n))])},(a,l)=>{i=i.add(new Ki(r.indexId,n,jw(l.arrayValue),jw(l.directionalValue)))}).next(()=>i)}jn(e,n){let r=new mt(Us);const s=this.Qn(n,e);if(s==null)return r;const i=fg(n);if(i!=null){const a=e.data.field(i.fieldPath);if(Qc(a))for(const l of a.arrayValue.values||[])r=r.add(new Ki(n.indexId,e.key,this.Ln(l),s))}else r=r.add(new Ki(n.indexId,e.key,Ju,s));return r}Jn(e,n,r,s,i){te(Pw,"Updating index entries for document '%s'",n.key);const a=[];return function(c,d,h,f,m){const x=c.getIterator(),T=d.getIterator();let N=qo(x),C=qo(T);for(;N||C;){let S=!1,E=!1;if(N&&C){const g=h(N,C);g<0?E=!0:g>0&&(S=!0)}else N!=null?E=!0:S=!0;S?(f(C),C=qo(T)):E?(m(N),N=qo(x)):(N=qo(x),C=qo(T))}}(s,i,Us,l=>{a.push(this.Hn(e,n,r,l))},l=>{a.push(this.Yn(e,n,r,l))}),F.waitFor(a)}Gn(e){let n=1;return Go(e).ee({index:$T,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((a,l)=>Us(a,l)).filter((a,l,c)=>!l||Us(a,c[l-1])!==0);const s=[];s.push(e);for(const a of r){const l=Us(a,e),c=Us(a,n);if(l===0)s[0]=e.An();else if(l>0&&c<0)s.push(a),s.push(a.An());else if(c>0)break}s.push(n);const i=[];for(let a=0;a<s.length;a+=2){if(this.Zn(s[a],s[a+1]))return[];const l=s[a].Vn(this.uid,Ju,he.empty()),c=s[a+1].Vn(this.uid,Ju,he.empty());i.push(IDBKeyRange.bound(l,c))}return i}Zn(e,n){return Us(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(Dw)}getMinOffset(e,n){return F.mapArray(this.Mn(n),r=>this.xn(e,r).next(s=>s||Se(44426))).next(Dw)}}function kw(t){return tn(t,Wc)}function Wo(t){return tn(t,mc)}function Ol(t){return tn(t,ov)}function Go(t){return tn(t,pc)}function Dw(t){Ne(t.length!==0,28825);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;rv(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new ir(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ow={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qC=41943040;class xn{static withCacheSize(e){return new xn(e,xn.DEFAULT_COLLECTION_PERCENTILE,xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HC(t,e,n){const r=t.store(Cr),s=t.store(za),i=[],a=IDBKeyRange.only(n.batchId);let l=0;const c=r.ee({range:a},(h,f,m)=>(l++,m.delete()));i.push(c.next(()=>{Ne(l===1,47070,{batchId:n.batchId})}));const d=[];for(const h of n.mutations){const f=MT(e,h.key.path,n.batchId);i.push(s.delete(f)),d.push(h.key)}return F.waitFor(i).next(()=>d)}function jh(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Se(14731);e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xn.DEFAULT_COLLECTION_PERCENTILE=10,xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,xn.DEFAULT=new xn(qC,xn.DEFAULT_COLLECTION_PERCENTILE,xn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),xn.DISABLED=new xn(-1,0,0);class Cf{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,n,r,s){Ne(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Cf(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $s(e).ee({index:Zi,range:r},(s,i,a)=>{n=!1,a.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=aa(e),a=$s(e);return a.add({}).next(l=>{Ne(typeof l=="number",49019);const c=new pv(l,n,r,s),d=function(x,T,N){const C=N.baseMutations.map(E=>Th(x.yt,E)),S=N.mutations.map(E=>Th(x.yt,E));return{userId:T,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:C,mutations:S}}(this.serializer,this.userId,c),h=[];let f=new mt((m,x)=>He(m.canonicalString(),x.canonicalString()));for(const m of s){const x=MT(this.userId,m.key.path,l);f=f.add(m.key.path.popLast()),h.push(a.put(d)),h.push(i.put(x,KO))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Xn[l]=c.keys()}),F.waitFor(h).next(()=>c)})}lookupMutationBatch(e,n){return $s(e).get(n).next(r=>r?(Ne(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:n}),Wi(this.serializer,r)):null)}er(e,n){return this.Xn[n]?F.resolve(this.Xn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Xn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return $s(e).ee({index:Zi,range:s},(a,l,c)=>{l.userId===this.userId&&(Ne(l.batchId>=r,47524,{tr:r}),i=Wi(this.serializer,l)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=so;return $s(e).ee({index:Zi,range:n,reverse:!0},(s,i,a)=>{r=i.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,so],[this.userId,Number.POSITIVE_INFINITY]);return $s(e).J(Zi,n).next(r=>r.map(s=>Wi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=Td(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return aa(e).ee({range:s},(a,l,c)=>{const[d,h,f]=a,m=Qr(h);if(d===this.userId&&n.path.isEqual(m))return $s(e).get(f).next(x=>{if(!x)throw Se(61480,{nr:a,batchId:f});Ne(x.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:x.userId,batchId:f}),i.push(Wi(this.serializer,x))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new mt(He);const s=[];return n.forEach(i=>{const a=Td(this.userId,i.path),l=IDBKeyRange.lowerBound(a),c=aa(e).ee({range:l},(d,h,f)=>{const[m,x,T]=d,N=Qr(x);m===this.userId&&i.path.isEqual(N)?r=r.add(T):f.done()});s.push(c)}),F.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=Td(this.userId,r),a=IDBKeyRange.lowerBound(i);let l=new mt(He);return aa(e).ee({range:a},(c,d,h)=>{const[f,m,x]=c,T=Qr(m);f===this.userId&&r.isPrefixOf(T)?T.length===s&&(l=l.add(x)):h.done()}).next(()=>this.rr(e,l))}rr(e,n){const r=[],s=[];return n.forEach(i=>{s.push($s(e).get(i).next(a=>{if(a===null)throw Se(35274,{batchId:i});Ne(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),r.push(Wi(this.serializer,a))}))}),F.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return HC(e.le,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.ir(n.batchId)}),F.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return F.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return aa(e).ee({range:r},(i,a,l)=>{if(i[0]===this.userId){const c=Qr(i[1]);s.push(c)}else l.done()}).next(()=>{Ne(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,n){return WC(e,this.userId,n)}_r(e){return GC(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:so,lastStreamToken:""})}}function WC(t,e,n){const r=Td(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return aa(t).ee({range:i,X:!0},(l,c,d)=>{const[h,f,m]=l;h===e&&f===s&&(a=!0),d.done()}).next(()=>a)}function $s(t){return tn(t,Cr)}function aa(t){return tn(t,za)}function GC(t){return tn(t,qc)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new So(0)}static cr(){return new So(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.lr(e).next(n=>{const r=new So(n.highestTargetId);return n.highestTargetId=r.next(),this.hr(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(n=>je.fromTimestamp(new ot(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.hr(e,s)))}addTargetData(e,n){return this.Pr(e,n).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(n,r),this.hr(e,r))))}updateTargetData(e,n){return this.Pr(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>Ko(e).delete(n.targetId)).next(()=>this.lr(e)).next(r=>(Ne(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return Ko(e).ee((a,l)=>{const c=Xl(l);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>F.waitFor(i)).next(()=>s)}forEachTarget(e,n){return Ko(e).ee((r,s)=>{const i=Xl(s);n(i)})}lr(e){return Lw(e).get(xh).next(n=>(Ne(n!==null,2888),n))}hr(e,n){return Lw(e).put(xh,n)}Pr(e,n){return Ko(e).put(UC(this.serializer,n))}Tr(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(n=>n.targetCount)}getTargetData(e,n){const r=bo(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Ko(e).ee({range:s,index:UT},(a,l,c)=>{const d=Xl(l);du(n,d.target)&&(i=d,c.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=Zs(e);return n.forEach(a=>{const l=Sn(a.path);s.push(i.put({targetId:r,path:l})),s.push(this.referenceDelegate.addReference(e,r,a))}),F.waitFor(s)}removeMatchingKeys(e,n,r){const s=Zs(e);return F.forEach(n,i=>{const a=Sn(i.path);return F.waitFor([s.delete([r,a]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=Zs(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=Zs(e);let i=Xe();return s.ee({range:r,X:!0},(a,l,c)=>{const d=Qr(a[1]),h=new he(d);i=i.add(h)}).next(()=>i)}containsKey(e,n){const r=Sn(n.path),s=IDBKeyRange.bound([r],[RT(r)],!1,!0);let i=0;return Zs(e).ee({index:iv,X:!0,range:s},([a,l],c,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}At(e,n){return Ko(e).get(n).next(r=>r?Xl(r):null)}}function Ko(t){return tn(t,qa)}function Lw(t){return tn(t,io)}function Zs(t){return tn(t,Ha)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vw="LruGarbageCollector",EV=1048576;function Mw([t,e],[n,r]){const s=He(t,n);return s===0?He(e,r):s}class IV{constructor(e){this.Ir=e,this.buffer=new mt(Mw),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();Mw(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class KC{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){te(Vw,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Ri(n)?te(Vw,"Ignoring IndexedDB error during garbage collection: ",n):await Vo(n)}await this.Vr(3e5)})}}class SV{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return F.resolve(fr.ce);const r=new IV(n);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(te("LruGarbageCollector","Garbage collection skipped; disabled"),F.resolve(Ow)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(te("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ow):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,i,a,l,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(te("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,a=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,l=Date.now(),this.removeTargets(e,r,n))).next(f=>(i=f,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(d=Date.now(),sa()<=tt.DEBUG&&te("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${f} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),F.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function QC(t,e){return new SV(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(e,n){this.db=e,this.garbageCollector=QC(this,n)}gr(e){const n=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}pr(e,n){return this.Sr(e,(r,s)=>n(s))}addReference(e,n,r){return Zu(e,r)}removeReference(e,n,r){return Zu(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Zu(e,n)}br(e,n){return function(s,i){let a=!1;return GC(s).te(l=>WC(s,l,i).next(c=>(c&&(a=!0),F.resolve(!c)))).next(()=>a)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(a,l)=>{if(l<=n){const c=this.br(e,a).next(d=>{if(!d)return i++,r.getEntry(e,a).next(()=>(r.removeEntry(a,je.min()),Zs(e).delete(function(f){return[0,Sn(f.path)]}(a))))});s.push(c)}}).next(()=>F.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Zu(e,n)}Sr(e,n){const r=Zs(e);let s,i=fr.ce;return r.ee({index:iv},([a,l],{path:c,sequenceNumber:d})=>{a===0?(i!==fr.ce&&n(new he(Qr(s)),i),i=d,s=c):i=fr.ce}).next(()=>{i!==fr.ce&&n(new he(Qr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Zu(t,e){return Zs(t).put(function(r,s){return{targetId:0,path:Sn(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(){this.changes=new Rs(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Ft.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?F.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CV{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return Fi(e).put(r)}removeEntry(e,n,r){return Fi(e).delete(function(i,a){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],Ch(a),l[l.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Dr(e,r)))}getEntry(e,n){let r=Ft.newInvalidDocument(n);return Fi(e).ee({index:Cd,range:IDBKeyRange.only(Ll(n))},(s,i)=>{r=this.Cr(n,i)}).next(()=>r)}vr(e,n){let r={size:0,document:Ft.newInvalidDocument(n)};return Fi(e).ee({index:Cd,range:IDBKeyRange.only(Ll(n))},(s,i)=>{r={document:this.Cr(n,i),size:jh(i)}}).next(()=>r)}getEntries(e,n){let r=tr();return this.Fr(e,n,(s,i)=>{const a=this.Cr(s,i);r=r.insert(s,a)}).next(()=>r)}Mr(e,n){let r=tr(),s=new jt(he.comparator);return this.Fr(e,n,(i,a)=>{const l=this.Cr(i,a);r=r.insert(i,l),s=s.insert(i,jh(a))}).next(()=>({documents:r,Or:s}))}Fr(e,n,r){if(n.isEmpty())return F.resolve();let s=new mt($w);n.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(Ll(s.first()),Ll(s.last())),a=s.getIterator();let l=a.getNext();return Fi(e).ee({index:Cd,range:i},(c,d,h)=>{const f=he.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;l&&$w(l,f)<0;)r(l,null),l=a.getNext();l&&l.isEqual(f)&&(r(l,d),l=a.hasNext()?a.getNext():null),l?h.j(Ll(l)):h.done()}).next(()=>{for(;l;)r(l,null),l=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const a=n.path,l=[a.popLast().toArray(),a.lastSegment(),Ch(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Fi(e).J(IDBKeyRange.bound(l,c,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let h=tr();for(const f of d){const m=this.Cr(he.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(fu(n,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,n,r,s){let i=tr();const a=Uw(n,r),l=Uw(n,ir.max());return Fi(e).ee({index:FT,range:IDBKeyRange.bound(a,l,!0)},(c,d,h)=>{const f=this.Cr(he.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new NV(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return Fw(e).get(pg).next(n=>(Ne(!!n,20021),n))}Dr(e,n){return Fw(e).put(pg,n)}Cr(e,n){if(n){const r=hV(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(je.min())))return r}return Ft.newInvalidDocument(e)}}function XC(t){return new CV(t)}class NV extends YC{constructor(e,n){super(),this.Nr=e,this.trackRemovals=n,this.Br=new Rs(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new mt((i,a)=>He(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const l=this.Br.get(i);if(n.push(this.Nr.removeEntry(e,i,l.readTime)),a.isValidDocument()){const c=ww(this.Nr.serializer,a);s=s.add(i.path.popLast());const d=jh(c);r+=d-l.size,n.push(this.Nr.addEntry(e,i,c))}else if(r-=l.size,this.trackRemovals){const c=ww(this.Nr.serializer,a.convertToNoDocument(je.min()));n.push(this.Nr.addEntry(e,i,c))}}),s.forEach(i=>{n.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.Nr.updateMetadata(e,r)),F.waitFor(n)}getFromCache(e,n){return this.Nr.vr(e,n).next(r=>(this.Br.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Nr.Mr(e,n).next(({documents:r,Or:s})=>(s.forEach((i,a)=>{this.Br.set(i,{size:a,readTime:r.get(i).readTime})}),r))}}function Fw(t){return tn(t,Hc)}function Fi(t){return tn(t,_h)}function Ll(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Uw(t,e){const n=e.documentKey.path.toArray();return[t,Ch(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function $w(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=He(n[i],r[i]),s)return s;return s=He(n.length,r.length),s||(s=He(n[n.length-2],r[r.length-2]),s||He(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jV{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&vc(r.mutation,s,zn.empty(),ot.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Xe()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Xe()){const s=Yr();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let a=Ql();return i.forEach((l,c)=>{a=a.insert(l,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=Yr();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Xe()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,l)=>{n.set(a,l)})})}computeViews(e,n,r,s){let i=tr();const a=yc(),l=function(){return yc()}();return n.forEach((c,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof Ps)?i=i.insert(d.key,d):h!==void 0?(a.set(d.key,h.mutation.getFieldMask()),vc(h.mutation,d,h.mutation.getFieldMask(),ot.now())):a.set(d.key,zn.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,h)=>a.set(d,h)),n.forEach((d,h)=>l.set(d,new jV(h,a.get(d)??null))),l))}recalculateAndSaveOverlays(e,n){const r=yc();let s=new jt((a,l)=>a-l),i=Xe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const l of a)l.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let h=r.get(c)||zn.empty();h=l.applyToLocalView(d,h),r.set(c,h);const f=(s.get(l.batchId)||Xe()).add(c);s=s.insert(l.batchId,f)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,h=c.value,f=gC();h.forEach(m=>{if(!i.has(m)){const x=EC(n.get(m),r.get(m));x!==null&&f.set(m,x),i=i.add(m)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,f))}return F.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(a){return he.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):hv(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):F.resolve(Yr());let l=$c,c=i;return a.next(d=>F.forEach(d,(h,f)=>(l<f.largestBatchId&&(l=f.largestBatchId),i.get(h)?F.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{c=c.insert(h,m)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,Xe())).next(h=>({batchId:l,changes:mC(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new he(n)).next(r=>{let s=Ql();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let a=Ql();return this.indexManager.getCollectionParents(e,i).next(l=>F.forEach(l,c=>{const d=function(f,m){return new ki(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((f,m)=>{a=a.insert(f,m)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(a=>{i.forEach((c,d)=>{const h=d.getKey();a.get(h)===null&&(a=a.insert(h,Ft.newInvalidDocument(h)))});let l=Ql();return a.forEach((c,d)=>{const h=i.get(c);h!==void 0&&vc(h.mutation,d,zn.empty(),ot.now()),fu(n,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AV{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return F.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:Dn(s.createTime)}}(n)),F.resolve()}getNamedQuery(e,n){return F.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(s){return{name:s.name,query:$C(s.bundledQuery),readTime:Dn(s.readTime)}}(n)),F.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RV{constructor(){this.overlays=new jt(he.comparator),this.qr=new Map}getOverlay(e,n){return F.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Yr();return F.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.St(e,n,i)}),F.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),F.resolve()}getOverlaysForCollection(e,n,r){const s=Yr(),i=n.length+1,a=new he(n.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return F.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new jt((d,h)=>d-h);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=Yr(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const l=Yr(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>l.set(d,h)),!(l.size()>=s)););return F.resolve(l)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new gv(n,r));let i=this.qr.get(n);i===void 0&&(i=Xe(),this.qr.set(n,i)),this.qr.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(){this.sessionToken=Yt.EMPTY_BYTE_STRING}getSessionToken(e){return F.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,F.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(){this.Qr=new mt(sn.$r),this.Ur=new mt(sn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new sn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new sn(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new he(new ct([])),r=new sn(n,e),s=new sn(n,e+1),i=[];return this.Ur.forEachInRange([r,s],a=>{this.Gr(a),i.push(a.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new he(new ct([])),r=new sn(n,e),s=new sn(n,e+1);let i=Xe();return this.Ur.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const n=new sn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class sn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return he.comparator(e.key,n.key)||He(e.Yr,n.Yr)}static Kr(e,n){return He(e.Yr,n.Yr)||he.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kV{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new mt(sn.$r)}checkEmpty(e){return F.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new pv(i,n,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new sn(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return F.resolve(a)}lookupMutationBatch(e,n){return F.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),i=s<0?0:s;return F.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return F.resolve(this.mutationQueue.length===0?so:this.tr-1)}getAllMutationBatches(e){return F.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new sn(n,0),s=new sn(n,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],a=>{const l=this.Xr(a.Yr);i.push(l)}),F.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new mt(He);return n.forEach(s=>{const i=new sn(s,0),a=new sn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],l=>{r=r.add(l.Yr)})}),F.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;he.isDocumentKey(i)||(i=i.child(""));const a=new sn(new he(i),0);let l=new mt(He);return this.Zr.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.Yr)),!0)},a),F.resolve(this.ti(l))}ti(e){const n=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Ne(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return F.forEach(n.mutations,s=>{const i=new sn(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new sn(n,0),s=this.Zr.firstAfterOrEqual(r);return F.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,F.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(e){this.ri=e,this.docs=function(){return new jt(he.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return F.resolve(r?r.document.mutableCopy():Ft.newInvalidDocument(n))}getEntries(e,n){let r=tr();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ft.newInvalidDocument(s))}),F.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=tr();const a=n.path,l=new he(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||rv(DT(h),r)<=0||(s.has(h.key)||fu(n,h))&&(i=i.insert(h.key,h.mutableCopy()))}return F.resolve(i)}getAllFromCollectionGroup(e,n,r,s){Se(9500)}ii(e,n){return F.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new OV(this)}getSize(e){return F.resolve(this.size)}}class OV extends YC{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),F.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{constructor(e){this.persistence=e,this.si=new Rs(n=>bo(n),du),this.lastRemoteSnapshotVersion=je.min(),this.highestTargetId=0,this.oi=0,this._i=new wv,this.targetCount=0,this.ai=So.ur()}forEachTarget(e,n){return this.si.forEach((r,s)=>n(s)),F.resolve()}getLastRemoteSnapshotVersion(e){return F.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return F.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),F.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),F.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new So(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,F.resolve()}updateTargetData(e,n){return this.Pr(n),F.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,F.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.si.forEach((a,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),F.waitFor(i).next(()=>s)}getTargetCount(e){return F.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return F.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),F.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),F.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),F.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return F.resolve(r)}containsKey(e,n){return F.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(e,n){this.ui={},this.overlays={},this.ci=new fr(0),this.li=!1,this.li=!0,this.hi=new PV,this.referenceDelegate=e(this),this.Pi=new LV(this),this.indexManager=new xV,this.remoteDocumentCache=function(s){return new DV(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new FC(n),this.Ii=new AV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new RV,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new kV(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){te("MemoryPersistence","Starting transaction:",e);const s=new VV(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,n){return F.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class VV extends LT{constructor(e){super(),this.currentSequenceNumber=e}}class Nf{constructor(e){this.persistence=e,this.Ri=new wv,this.Vi=null}static mi(e){return new Nf(e)}get fi(){if(this.Vi)return this.Vi;throw Se(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),F.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),F.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),F.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return F.forEach(this.fi,r=>{const s=he.fromPath(r);return this.gi(e,s).next(i=>{i||n.removeEntry(s,je.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return F.or([()=>F.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Ah{constructor(e,n){this.persistence=e,this.pi=new Rs(r=>Sn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=QC(this,n)}static mi(e,n){return new Ah(e,n)}Ei(){}di(e){return F.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return F.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?F.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,a=>this.br(e,a,n).next(l=>{l||(r++,i.removeEntry(a,je.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),F.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),F.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),F.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),F.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=jd(e.data.value)),n}br(e,n,r){return F.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return F.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{constructor(e){this.serializer=e}k(e,n,r,s){const i=new hf("createOrUpgrade",n);r<1&&s>=1&&(function(c){c.createObjectStore(uu)}(e),function(c){c.createObjectStore(qc,{keyPath:GO}),c.createObjectStore(Cr,{keyPath:Jb,autoIncrement:!0}).createIndex(Zi,Zb,{unique:!0}),c.createObjectStore(za)}(e),Bw(e),function(c){c.createObjectStore(qi)}(e));let a=F.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore(Ha),c.deleteObjectStore(qa),c.deleteObjectStore(io)}(e),Bw(e)),a=a.next(()=>function(c){const d=c.store(io),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:je.min().toTimestamp(),targetCount:0};return d.put(xh,h)}(i))),r<4&&s>=4&&(r!==0&&(a=a.next(()=>function(c,d){return d.store(Cr).J().next(f=>{c.deleteObjectStore(Cr),c.createObjectStore(Cr,{keyPath:Jb,autoIncrement:!0}).createIndex(Zi,Zb,{unique:!0});const m=d.store(Cr),x=f.map(T=>m.put(T));return F.waitFor(x)})}(e,i))),a=a.next(()=>{(function(c){c.createObjectStore(Wa,{keyPath:nL})})(e)})),r<5&&s>=5&&(a=a.next(()=>this.yi(i))),r<6&&s>=6&&(a=a.next(()=>(function(c){c.createObjectStore(Hc)}(e),this.wi(i)))),r<7&&s>=7&&(a=a.next(()=>this.Si(i))),r<8&&s>=8&&(a=a.next(()=>this.bi(e,i))),r<9&&s>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(a=a.next(()=>this.Di(i))),r<11&&s>=11&&(a=a.next(()=>{(function(c){c.createObjectStore(pf,{keyPath:rL})})(e),function(c){c.createObjectStore(mf,{keyPath:sL})}(e)})),r<12&&s>=12&&(a=a.next(()=>{(function(c){const d=c.createObjectStore(gf,{keyPath:dL});d.createIndex(gg,hL,{unique:!1}),d.createIndex(zT,fL,{unique:!1})})(e)})),r<13&&s>=13&&(a=a.next(()=>function(c){const d=c.createObjectStore(_h,{keyPath:QO});d.createIndex(Cd,YO),d.createIndex(FT,XO)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(qi))),r<14&&s>=14&&(a=a.next(()=>this.Fi(e,i))),r<15&&s>=15&&(a=a.next(()=>function(c){c.createObjectStore(ov,{keyPath:iL,autoIncrement:!0}).createIndex(mg,oL,{unique:!1}),c.createObjectStore(pc,{keyPath:aL}).createIndex($T,lL,{unique:!1}),c.createObjectStore(mc,{keyPath:cL}).createIndex(BT,uL,{unique:!1})}(e))),r<16&&s>=16&&(a=a.next(()=>{n.objectStore(pc).clear()}).next(()=>{n.objectStore(mc).clear()})),r<17&&s>=17&&(a=a.next(()=>{(function(c){c.createObjectStore(av,{keyPath:pL})})(e)})),r<18&&s>=18&&OS()&&(a=a.next(()=>{n.objectStore(pc).clear()}).next(()=>{n.objectStore(mc).clear()})),a}wi(e){let n=0;return e.store(qi).ee((r,s)=>{n+=jh(s)}).next(()=>{const r={byteSize:n};return e.store(Hc).put(pg,r)})}yi(e){const n=e.store(qc),r=e.store(Cr);return n.J().next(s=>F.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,so],[i.userId,i.lastAcknowledgedBatchId]);return r.J(Zi,a).next(l=>F.forEach(l,c=>{Ne(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const d=Wi(this.serializer,c);return HC(e,i.userId,d).next(()=>{})}))}))}Si(e){const n=e.store(Ha),r=e.store(qi);return e.store(io).get(xh).next(s=>{const i=[];return r.ee((a,l)=>{const c=new ct(a),d=function(f){return[0,Sn(f)]}(c);i.push(n.get(d).next(h=>h?F.resolve():(f=>n.put({targetId:0,path:Sn(f),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>F.waitFor(i))})}bi(e,n){e.createObjectStore(Wc,{keyPath:tL});const r=n.store(Wc),s=new bv,i=a=>{if(s.add(a)){const l=a.lastSegment(),c=a.popLast();return r.put({collectionId:l,parent:Sn(c)})}};return n.store(qi).ee({X:!0},(a,l)=>{const c=new ct(a);return i(c.popLast())}).next(()=>n.store(za).ee({X:!0},([a,l,c],d)=>{const h=Qr(l);return i(h.popLast())}))}Di(e){const n=e.store(qa);return n.ee((r,s)=>{const i=Xl(s),a=UC(this.serializer,i);return n.put(a)})}Ci(e,n){const r=n.store(qi),s=[];return r.ee((i,a)=>{const l=n.store(_h),c=function(f){return f.document?new he(ct.fromString(f.document.name).popFirst(5)):f.noDocument?he.fromSegments(f.noDocument.path):f.unknownDocument?he.fromSegments(f.unknownDocument.path):Se(36783)}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(l.put(d))}).next(()=>F.waitFor(s))}Fi(e,n){const r=n.store(Cr),s=XC(this.serializer),i=new Ev(Nf.mi,this.serializer.yt);return r.J().next(a=>{const l=new Map;return a.forEach(c=>{let d=l.get(c.userId)??Xe();Wi(this.serializer,c).keys().forEach(h=>d=d.add(h)),l.set(c.userId,d)}),F.forEach(l,(c,d)=>{const h=new dn(d),f=Tf.wt(this.serializer,h),m=i.getIndexManager(h),x=Cf.wt(h,this.serializer,m,i.referenceDelegate);return new JC(s,x,f,m).recalculateAndSaveOverlaysForDocumentKeys(new yg(n,fr.ce),c).next()})})}}function Bw(t){t.createObjectStore(Ha,{keyPath:ZO}).createIndex(iv,eL,{unique:!0}),t.createObjectStore(qa,{keyPath:"targetId"}).createIndex(UT,JO,{unique:!0}),t.createObjectStore(io)}const Bs="IndexedDbPersistence",Mp=18e5,Fp=5e3,Up="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",FV="main";class Iv{constructor(e,n,r,s,i,a,l,c,d,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Mi=i,this.window=a,this.document=l,this.xi=d,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=m=>Promise.resolve(),!Iv.v())throw new se(G.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new TV(this,s),this.$i=n+FV,this.serializer=new FC(c),this.Ui=new gi(this.$i,this.Ni,new MV(this.serializer)),this.hi=new pV,this.Pi=new wV(this.referenceDelegate,this.serializer),this.remoteDocumentCache=XC(this.serializer),this.Ii=new fV,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&Rn(Bs,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new se(G.FAILED_PRECONDITION,Up);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new fr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ed(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(n=>{n||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(n=>this.isPrimary&&!n?this.Zi(e).next(()=>!1):!!n&&this.Xi(e).next(()=>!0))).catch(e=>{if(Ri(e))return te(Bs,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return te(Bs,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Vl(e).get(zo).next(n=>F.resolve(this.es(n)))}ts(e){return ed(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Mp)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=tn(n,Wa);return r.J().next(s=>{const i=this.ss(s,Mp),a=s.filter(l=>i.indexOf(l)===-1);return F.forEach(a,l=>r.delete(l.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ki)for(const n of e)this.Ki.removeItem(this._s(n.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?F.resolve(!0):Vl(e).get(zo).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,Fp)&&!this.us(n.ownerId)){if(this.es(n)&&this.networkEnabled)return!0;if(!this.es(n)){if(!n.allowTabSynchronization)throw new se(G.FAILED_PRECONDITION,Up);return!1}}return!(!this.networkEnabled||!this.inForeground)||ed(e).J().next(r=>this.ss(r,Fp).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,l=this.networkEnabled===s.networkEnabled;if(i||a&&l)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&te(Bs,`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[uu,Wa],e=>{const n=new yg(e,fr.ce);return this.Zi(n).next(()=>this.ts(n))}),this.Ui.close(),this.Ps()}ss(e,n){return e.filter(r=>this.rs(r.updateTimeMs,n)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>ed(e).J().next(n=>this.ss(n,Mp).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,n){return Cf.wt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new bV(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Tf.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,n,r){te(Bs,"Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(c){return c===18?yL:c===17?GT:c===16?gL:c===15?lv:c===14?WT:c===13?HT:c===12?mL:c===11?qT:void Se(60245)}(this.Ni);let a;return this.Ui.runTransaction(e,s,i,l=>(a=new yg(l,this.ci?this.ci.next():fr.ce),n==="readwrite-primary"?this.Hi(a).next(c=>!!c||this.Yi(a)).next(c=>{if(!c)throw Rn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new se(G.FAILED_PRECONDITION,OT);return r(a)}).next(c=>this.Xi(a).next(()=>c)):this.Is(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Is(e){return Vl(e).get(zo).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,Fp)&&!this.us(n.ownerId)&&!this.es(n)&&!(this.Oi||this.allowTabSynchronization&&n.allowTabSynchronization))throw new se(G.FAILED_PRECONDITION,Up)})}Xi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Vl(e).put(zo,n)}static v(){return gi.v()}Zi(e){const n=Vl(e);return n.get(zo).next(r=>this.es(r)?(te(Bs,"Releasing primary lease."),n.delete(zo)):F.resolve())}rs(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(Rn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const n=/(?:Version|Mobile)\/1[456]/;DS()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var n;try{const r=((n=this.Ki)==null?void 0:n.getItem(this._s(e)))!==null;return te(Bs,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Rn(Bs,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Rn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Vl(t){return tn(t,uu)}function ed(t){return tn(t,Wa)}function UV(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sv{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=Xe(),s=Xe();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Sv(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $V{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return DS()?8:VT(en())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.ys(e,n).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ws(e,n,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new $V;return this.Ss(e,n,a).next(l=>{if(i.result=l,this.Vs)return this.bs(e,n,a,l.size)})}).next(()=>i.result)}bs(e,n,r,s){return r.documentReadCount<this.fs?(sa()<=tt.DEBUG&&te("QueryEngine","SDK will not create cache indexes for query:",ia(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),F.resolve()):(sa()<=tt.DEBUG&&te("QueryEngine","Query:",ia(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(sa()<=tt.DEBUG&&te("QueryEngine","The SDK decides to create cache indexes for query:",ia(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mr(n))):F.resolve())}ys(e,n){if(hw(n))return F.resolve(null);let r=mr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=Ih(n,null,"F"),r=mr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=Xe(...i);return this.ps.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.Ds(n,l);return this.Cs(n,d,a,c.readTime)?this.ys(e,Ih(n,null,"F")):this.vs(e,d,n,c)}))})))}ws(e,n,r,s){return hw(n)||s.isEqual(je.min())?F.resolve(null):this.ps.getDocuments(e,r).next(i=>{const a=this.Ds(n,i);return this.Cs(n,a,r,s)?F.resolve(null):(sa()<=tt.DEBUG&&te("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ia(n)),this.vs(e,a,n,UO(s,$c)).next(l=>l))})}Ds(e,n){let r=new mt(fC(e));return n.forEach((s,i)=>{fu(e,i)&&(r=r.add(i))}),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,n,r){return sa()<=tt.DEBUG&&te("QueryEngine","Using full collection scan to execute query:",ia(n)),this.ps.getDocumentsMatchingQuery(e,n,ir.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tv="LocalStore",BV=3e8;class zV{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new jt(He),this.xs=new Rs(i=>bo(i),du),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new JC(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function eN(t,e,n,r){return new zV(t,e,n,r)}async function tN(t,e){const n=$e(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],l=[];let c=Xe();for(const d of s){a.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of i){l.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return n.localDocuments.getDocuments(r,c).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:l}))})})}function qV(t,e){const n=$e(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(l,c,d,h){const f=d.batch,m=f.keys();let x=F.resolve();return m.forEach(T=>{x=x.next(()=>h.getEntry(c,T)).next(N=>{const C=d.docVersions.get(T);Ne(C!==null,48541),N.version.compareTo(C)<0&&(f.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),h.addEntry(N)))})}),x.next(()=>l.mutationQueue.removeMutationBatch(c,f))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=Xe();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function nN(t){const e=$e(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function HV(t,e){const n=$e(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const l=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;l.push(n.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>n.Pi.addMatchingKeys(i,h.addedDocuments,f)));let x=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?x=x.withResumeToken(Yt.EMPTY_BYTE_STRING,je.min()).withLastLimboFreeSnapshotVersion(je.min()):h.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(h.resumeToken,r)),s=s.insert(f,x),function(N,C,S){return N.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=BV?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0}(m,x,h)&&l.push(n.Pi.updateTargetData(i,x))});let c=tr(),d=Xe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,h))}),l.push(WV(i,a,e.documentUpdates).next(h=>{c=h.ks,d=h.qs})),!r.isEqual(je.min())){const h=n.Pi.getLastRemoteSnapshotVersion(i).next(f=>n.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(h)}return F.waitFor(l).next(()=>a.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(n.Ms=s,i))}function WV(t,e,n){let r=Xe(),s=Xe();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let a=tr();return n.forEach((l,c)=>{const d=i.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(je.min())?(e.removeEntry(l,c.readTime),a=a.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),a=a.insert(l,c)):te(Tv,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{ks:a,qs:s}})}function GV(t,e){const n=$e(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=so),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function KV(t,e){const n=$e(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Pi.getTargetData(r,e).next(i=>i?(s=i,F.resolve(s)):n.Pi.allocateTargetId(r).next(a=>(s=new ys(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r})}async function Rg(t,e,n){const r=$e(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!Ri(a))throw a;te(Tv,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function zw(t,e,n){const r=$e(t);let s=je.min(),i=Xe();return r.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,h){const f=$e(c),m=f.xs.get(h);return m!==void 0?F.resolve(f.Ms.get(m)):f.Pi.getTargetData(d,h)}(r,a,mr(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next(c=>{i=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(a,e,n?s:je.min(),n?i:Xe())).next(l=>(QV(r,kL(e),l),{documents:l,Qs:i})))}function QV(t,e,n){let r=t.Os.get(e)||je.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.Os.set(e,r)}class qw{constructor(){this.activeTargetIds=FL()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class rN{constructor(){this.Mo=new qw,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new qw,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YV{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hw="ConnectivityMonitor";class Ww{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){te(Hw,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){te(Hw,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let td=null;function Pg(){return td===null?td=function(){return 268435456+Math.round(2147483648*Math.random())}():td++,"0x"+td.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $p="RestConnection",XV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class JV{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===bh?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,i){const a=Pg(),l=this.zo(e,n.toUriEncodedString());te($p,`Sending RPC '${e}' ${a}:`,l,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:d}=new URL(l),h=Ni(d);return this.Jo(e,l,c,r,h).then(f=>(te($p,`Received RPC '${e}' ${a}: `,f),f),f=>{throw vo($p,`RPC '${e}' ${a} failed with error: `,f,"url: ",l,"request:",r),f})}Ho(e,n,r,s,i,a){return this.Go(e,n,r,s,i)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+cl}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,n){const r=XV[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZV{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _n="WebChannelConnection";class eM extends JV{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,i){const a=Pg();return new Promise((l,c)=>{const d=new IT;d.setWithCredentials(!0),d.listenOnce(ST.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Id.NO_ERROR:const f=d.getResponseJson();te(_n,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(f)),l(f);break;case Id.TIMEOUT:te(_n,`RPC '${e}' ${a} timed out`),c(new se(G.DEADLINE_EXCEEDED,"Request time out"));break;case Id.HTTP_ERROR:const m=d.getStatus();if(te(_n,`RPC '${e}' ${a} failed with status:`,m,"response text:",d.getResponseText()),m>0){let x=d.getResponseJson();Array.isArray(x)&&(x=x[0]);const T=x==null?void 0:x.error;if(T&&T.status&&T.message){const N=function(S){const E=S.toLowerCase().replace(/_/g,"-");return Object.values(G).indexOf(E)>=0?E:G.UNKNOWN}(T.status);c(new se(N,T.message))}else c(new se(G.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new se(G.UNAVAILABLE,"Connection failed."));break;default:Se(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{te(_n,`RPC '${e}' ${a} completed.`)}});const h=JSON.stringify(s);te(_n,`RPC '${e}' ${a} sending request:`,s),d.send(n,"POST",h,r,15)})}T_(e,n,r){const s=Pg(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=NT(),l=CT(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const h=i.join("");te(_n,`Creating RPC '${e}' stream ${s}: ${h}`,c);const f=a.createWebChannel(h,c);this.I_(f);let m=!1,x=!1;const T=new ZV({Yo:C=>{x?te(_n,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(m||(te(_n,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),te(_n,`RPC '${e}' stream ${s} sending:`,C),f.send(C))},Zo:()=>f.close()}),N=(C,S,E)=>{C.listen(S,g=>{try{E(g)}catch(_){setTimeout(()=>{throw _},0)}})};return N(f,Kl.EventType.OPEN,()=>{x||(te(_n,`RPC '${e}' stream ${s} transport opened.`),T.o_())}),N(f,Kl.EventType.CLOSE,()=>{x||(x=!0,te(_n,`RPC '${e}' stream ${s} transport closed`),T.a_(),this.E_(f))}),N(f,Kl.EventType.ERROR,C=>{x||(x=!0,vo(_n,`RPC '${e}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),T.a_(new se(G.UNAVAILABLE,"The operation could not be completed")))}),N(f,Kl.EventType.MESSAGE,C=>{var S;if(!x){const E=C.data[0];Ne(!!E,16349);const g=E,_=(g==null?void 0:g.error)||((S=g[0])==null?void 0:S.error);if(_){te(_n,`RPC '${e}' stream ${s} received error:`,_);const O=_.status;let L=function(I){const R=Gt[I];if(R!==void 0)return TC(R)}(O),v=_.message;L===void 0&&(L=G.INTERNAL,v="Unknown error status: "+O+" with message "+_.message),x=!0,T.a_(new se(L,v)),f.close()}else te(_n,`RPC '${e}' stream ${s} received:`,E),T.u_(E)}}),N(l,TT.STAT_EVENT,C=>{C.stat===dg.PROXY?te(_n,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===dg.NOPROXY&&te(_n,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{T.__()},0),T}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tM(){return typeof window<"u"?window:null}function Dd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jf(t){return new tV(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sN{constructor(e,n,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&te("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gw="PersistentStream";class iN{constructor(e,n,r,s,i,a,l,c){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new sN(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===G.RESOURCE_EXHAUSTED?(Rn(n.toString()),Rn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===G.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===n&&this.G_(r,s)},r=>{e(()=>{const s=new se(G.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return te(Gw,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(te(Gw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class nM extends iN{constructor(e,n,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=sV(this.serializer,e),r=function(i){if(!("targetChange"in i))return je.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?je.min():a.readTime?Dn(a.readTime):je.min()}(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Tg(this.serializer),n.addTarget=function(i,a){let l;const c=a.target;if(l=wh(c)?{documents:DC(i,c)}:{query:_v(i,c).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=jC(i,a.resumeToken);const d=Ig(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(je.min())>0){l.readTime=Za(i,a.snapshotVersion.toTimestamp());const d=Ig(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=aV(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Tg(this.serializer),n.removeTarget=e,this.q_(n)}}class rM extends iN{constructor(e,n,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Ne(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Ne(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Ne(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=iV(e.writeResults,e.commitTime),r=Dn(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Tg(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>Th(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sM{}class iM extends sM{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new se(G.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Go(e,Sg(n,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new se(G.UNKNOWN,i.toString())})}Ho(e,n,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Ho(e,Sg(n,r),s,a,l,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new se(G.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class oM{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Rn(n),this.aa=!1):te("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const To="RemoteStore";class aM{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(a=>{r.enqueueAndForget(async()=>{Mo(this)&&(te(To,"Restarting streams for network reachability change."),await async function(c){const d=$e(c);d.Ea.add(4),await mu(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Af(d)}(this))})}),this.Ra=new oM(r,s)}}async function Af(t){if(Mo(t))for(const e of t.da)await e(!0)}async function mu(t){for(const e of t.da)await e(!1)}function oN(t,e){const n=$e(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Av(n)?jv(n):dl(n).O_()&&Nv(n,e))}function Cv(t,e){const n=$e(t),r=dl(n);n.Ia.delete(e),r.O_()&&aN(n,e),n.Ia.size===0&&(r.O_()?r.L_():Mo(n)&&n.Ra.set("Unknown"))}function Nv(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(je.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}dl(t).Y_(e)}function aN(t,e){t.Va.Ue(e),dl(t).Z_(e)}function jv(t){t.Va=new XL({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),dl(t).start(),t.Ra.ua()}function Av(t){return Mo(t)&&!dl(t).x_()&&t.Ia.size>0}function Mo(t){return $e(t).Ea.size===0}function lN(t){t.Va=void 0}async function lM(t){t.Ra.set("Online")}async function cM(t){t.Ia.forEach((e,n)=>{Nv(t,e)})}async function uM(t,e){lN(t),Av(t)?(t.Ra.ha(e),jv(t)):t.Ra.set("Unknown")}async function dM(t,e,n){if(t.Ra.set("Online"),e instanceof NC&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))}(t,e)}catch(r){te(To,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Rh(t,r)}else if(e instanceof Pd?t.Va.Ze(e):e instanceof CC?t.Va.st(e):t.Va.tt(e),!n.isEqual(je.min()))try{const r=await nN(t.localStore);n.compareTo(r)>=0&&await function(i,a){const l=i.Va.Tt(a);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.Ia.get(d);h&&i.Ia.set(d,h.withResumeToken(c.resumeToken,a))}}),l.targetMismatches.forEach((c,d)=>{const h=i.Ia.get(c);if(!h)return;i.Ia.set(c,h.withResumeToken(Yt.EMPTY_BYTE_STRING,h.snapshotVersion)),aN(i,c);const f=new ys(h.target,c,d,h.sequenceNumber);Nv(i,f)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){te(To,"Failed to raise snapshot:",r),await Rh(t,r)}}async function Rh(t,e,n){if(!Ri(e))throw e;t.Ea.add(1),await mu(t),t.Ra.set("Offline"),n||(n=()=>nN(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{te(To,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await Af(t)})}function cN(t,e){return e().catch(n=>Rh(t,n,e))}async function gu(t){const e=$e(t),n=Ei(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:so;for(;hM(e);)try{const s=await GV(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,fM(e,s)}catch(s){await Rh(e,s)}uN(e)&&dN(e)}function hM(t){return Mo(t)&&t.Ta.length<10}function fM(t,e){t.Ta.push(e);const n=Ei(t);n.O_()&&n.X_&&n.ea(e.mutations)}function uN(t){return Mo(t)&&!Ei(t).x_()&&t.Ta.length>0}function dN(t){Ei(t).start()}async function pM(t){Ei(t).ra()}async function mM(t){const e=Ei(t);for(const n of t.Ta)e.ea(n.mutations)}async function gM(t,e,n){const r=t.Ta.shift(),s=mv.from(r,e,n);await cN(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await gu(t)}async function yM(t,e){e&&Ei(t).X_&&await async function(r,s){if(function(a){return KL(a)&&a!==G.ABORTED}(s.code)){const i=r.Ta.shift();Ei(r).B_(),await cN(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await gu(r)}}(t,e),uN(t)&&dN(t)}async function Kw(t,e){const n=$e(t);n.asyncQueue.verifyOperationInProgress(),te(To,"RemoteStore received new credentials");const r=Mo(n);n.Ea.add(3),await mu(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Af(n)}async function vM(t,e){const n=$e(t);e?(n.Ea.delete(2),await Af(n)):e||(n.Ea.add(2),await mu(n),n.Ra.set("Unknown"))}function dl(t){return t.ma||(t.ma=function(n,r,s){const i=$e(n);return i.sa(),new nM(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:lM.bind(null,t),t_:cM.bind(null,t),r_:uM.bind(null,t),H_:dM.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),Av(t)?jv(t):t.Ra.set("Unknown")):(await t.ma.stop(),lN(t))})),t.ma}function Ei(t){return t.fa||(t.fa=function(n,r,s){const i=$e(n);return i.sa(),new rM(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:pM.bind(null,t),r_:yM.bind(null,t),ta:mM.bind(null,t),na:gM.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await gu(t)):(await t.fa.stop(),t.Ta.length>0&&(te(To,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new kr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const a=Date.now()+r,l=new Rv(e,n,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new se(G.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Pv(t,e){if(Rn("AsyncQueue",`${e}: ${t}`),Ri(t))return new se(G.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ra{static emptySet(e){return new Ra(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||he.comparator(n.key,r.key):(n,r)=>he.comparator(n.key,r.key),this.keyedMap=Ql(),this.sortedSet=new jt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Ra)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Ra;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{constructor(){this.ga=new jt(he.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Se(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class el{constructor(e,n,r,s,i,a,l,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const a=[];return n.forEach(l=>{a.push({type:0,doc:l})}),new el(e,n,Ra.emptySet(n),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&xf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _M{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class xM{constructor(){this.queries=Yw(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=$e(n),i=s.queries;s.queries=Yw(),i.forEach((a,l)=>{for(const c of l.Sa)c.onError(r)})})(this,new se(G.ABORTED,"Firestore shutting down"))}}function Yw(){return new Rs(t=>hC(t),xf)}async function kv(t,e){const n=$e(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new _M,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(a){const l=Pv(a,`Initialization of query '${ia(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&Ov(n)}async function Dv(t,e){const n=$e(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function bM(t,e){const n=$e(t);let r=!1;for(const s of e){const i=s.query,a=n.queries.get(i);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&Ov(n)}function wM(t,e,n){const r=$e(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function Ov(t){t.Ca.forEach(e=>{e.next()})}var kg,Xw;(Xw=kg||(kg={})).Ma="default",Xw.Cache="cache";class Lv{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new el(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=el.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==kg.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(e){this.key=e}}class fN{constructor(e){this.key=e}}class EM{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Xe(),this.mutatedKeys=Xe(),this.eu=fC(e),this.tu=new Ra(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new Qw,s=n?n.tu:this.tu;let i=n?n.mutatedKeys:this.mutatedKeys,a=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),x=fu(this.query,f)?f:null,T=!!m&&this.mutatedKeys.has(m.key),N=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let C=!1;m&&x?m.data.isEqual(x.data)?T!==N&&(r.track({type:3,doc:x}),C=!0):this.su(m,x)||(r.track({type:2,doc:x}),C=!0,(c&&this.eu(x,c)>0||d&&this.eu(x,d)<0)&&(l=!0)):!m&&x?(r.track({type:0,doc:x}),C=!0):m&&!x&&(r.track({type:1,doc:m}),C=!0,(c||d)&&(l=!0)),C&&(x?(a=a.add(x),i=N?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:a,iu:r,Cs:l,mutatedKeys:i}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((h,f)=>function(x,T){const N=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Se(20277,{Rt:C})}};return N(x)-N(T)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const l=n&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,d=c!==this.Za;return this.Za=c,a.length!==0||d?{snapshot:new el(this.query,e.tu,i,a,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Qw,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Xe(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const n=[];return e.forEach(r=>{this.Xa.has(r)||n.push(new fN(r))}),this.Xa.forEach(r=>{e.has(r)||n.push(new hN(r))}),n}cu(e){this.Ya=e.Qs,this.Xa=Xe();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return el.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Vv="SyncEngine";class IM{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class SM{constructor(e){this.key=e,this.hu=!1}}class TM{constructor(e,n,r,s,i,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Rs(l=>hC(l),xf),this.Iu=new Map,this.Eu=new Set,this.du=new jt(he.comparator),this.Au=new Map,this.Ru=new wv,this.Vu={},this.mu=new Map,this.fu=So.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function CM(t,e,n=!0){const r=_N(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await pN(r,e,n,!0),s}async function NM(t,e){const n=_N(t);await pN(n,e,!0,!1)}async function pN(t,e,n,r){const s=await KV(t.localStore,mr(e)),i=s.targetId,a=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await jM(t,e,i,a==="current",s.resumeToken)),t.isPrimaryClient&&n&&oN(t.remoteStore,s),l}async function jM(t,e,n,r,s){t.pu=(f,m,x)=>async function(N,C,S,E){let g=C.view.ru(S);g.Cs&&(g=await zw(N.localStore,C.query,!1).then(({documents:v})=>C.view.ru(v,g)));const _=E&&E.targetChanges.get(C.targetId),O=E&&E.targetMismatches.get(C.targetId)!=null,L=C.view.applyChanges(g,N.isPrimaryClient,_,O);return Zw(N,C.targetId,L.au),L.snapshot}(t,f,m,x);const i=await zw(t.localStore,e,!0),a=new EM(e,i.Qs),l=a.ru(i.documents),c=pu.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=a.applyChanges(l,t.isPrimaryClient,c);Zw(t,n,d.au);const h=new IM(e,n,a);return t.Tu.set(e,h),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),d.snapshot}async function AM(t,e,n){const r=$e(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(a=>!xf(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Rg(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Cv(r.remoteStore,s.targetId),Dg(r,s.targetId)}).catch(Vo)):(Dg(r,s.targetId),await Rg(r.localStore,s.targetId,!0))}async function RM(t,e){const n=$e(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Cv(n.remoteStore,r.targetId))}async function PM(t,e,n){const r=xN(t);try{const s=await function(a,l){const c=$e(a),d=ot.now(),h=l.reduce((x,T)=>x.add(T.key),Xe());let f,m;return c.persistence.runTransaction("Locally write mutations","readwrite",x=>{let T=tr(),N=Xe();return c.Ns.getEntries(x,h).next(C=>{T=C,T.forEach((S,E)=>{E.isValidDocument()||(N=N.add(S))})}).next(()=>c.localDocuments.getOverlayedDocuments(x,T)).next(C=>{f=C;const S=[];for(const E of l){const g=HL(E,f.get(E.key).overlayedDocument);g!=null&&S.push(new Ps(E.key,g,rC(g.value.mapValue),En.exists(!0)))}return c.mutationQueue.addMutationBatch(x,d,S,l)}).next(C=>{m=C;const S=C.applyToLocalDocumentSet(f,N);return c.documentOverlayCache.saveOverlays(x,C.batchId,S)})}).then(()=>({batchId:m.batchId,changes:mC(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,c){let d=a.Vu[a.currentUser.toKey()];d||(d=new jt(He)),d=d.insert(l,c),a.Vu[a.currentUser.toKey()]=d}(r,s.batchId,n),await yu(r,s.changes),await gu(r.remoteStore)}catch(s){const i=Pv(s,"Failed to persist write");n.reject(i)}}async function mN(t,e){const n=$e(t);try{const r=await HV(n.localStore,e);e.targetChanges.forEach((s,i)=>{const a=n.Au.get(i);a&&(Ne(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Ne(a.hu,14607):s.removedDocuments.size>0&&(Ne(a.hu,42227),a.hu=!1))}),await yu(n,r,e)}catch(r){await Vo(r)}}function Jw(t,e,n){const r=$e(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach((i,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)}),function(a,l){const c=$e(a);c.onlineState=l;let d=!1;c.queries.forEach((h,f)=>{for(const m of f.Sa)m.va(l)&&(d=!0)}),d&&Ov(c)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function kM(t,e,n){const r=$e(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new jt(he.comparator);a=a.insert(i,Ft.newNoDocument(i,je.min()));const l=Xe().add(i),c=new Sf(je.min(),new Map,new jt(He),a,l);await mN(r,c),r.du=r.du.remove(i),r.Au.delete(e),Mv(r)}else await Rg(r.localStore,e,!1).then(()=>Dg(r,e,n)).catch(Vo)}async function DM(t,e){const n=$e(t),r=e.batch.batchId;try{const s=await qV(n.localStore,e);yN(n,r,null),gN(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await yu(n,s)}catch(s){await Vo(s)}}async function OM(t,e,n){const r=$e(t);try{const s=await function(a,l){const c=$e(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,l).next(f=>(Ne(f!==null,37113),h=f.keys(),c.mutationQueue.removeMutationBatch(d,f))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(r.localStore,e);yN(r,e,n),gN(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await yu(r,s)}catch(s){await Vo(s)}}function gN(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function yN(t,e,n){const r=$e(t);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Dg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(r=>{t.Ru.containsKey(r)||vN(t,r)})}function vN(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(Cv(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Mv(t))}function Zw(t,e,n){for(const r of n)r instanceof hN?(t.Ru.addReference(r.key,e),LM(t,r)):r instanceof fN?(te(Vv,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||vN(t,r.key)):Se(19791,{wu:r})}function LM(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(te(Vv,"New document in limbo: "+n),t.Eu.add(r),Mv(t))}function Mv(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new he(ct.fromString(e)),r=t.fu.next();t.Au.set(r,new SM(n)),t.du=t.du.insert(n,r),oN(t.remoteStore,new ys(mr(hu(n.path)),r,"TargetPurposeLimboResolution",fr.ce))}}async function yu(t,e,n){const r=$e(t),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((l,c)=>{a.push(r.pu(c,e,n).then(d=>{var h;if((d||n)&&r.isPrimaryClient){const f=d?!d.fromCache:(h=n==null?void 0:n.targetChanges.get(c.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(d){s.push(d);const f=Sv.As(c.targetId,d);i.push(f)}}))}),await Promise.all(a),r.Pu.H_(s),await async function(c,d){const h=$e(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>F.forEach(d,m=>F.forEach(m.Es,x=>h.persistence.referenceDelegate.addReference(f,m.targetId,x)).next(()=>F.forEach(m.ds,x=>h.persistence.referenceDelegate.removeReference(f,m.targetId,x)))))}catch(f){if(!Ri(f))throw f;te(Tv,"Failed to update sequence numbers: "+f)}for(const f of d){const m=f.targetId;if(!f.fromCache){const x=h.Ms.get(m),T=x.snapshotVersion,N=x.withLastLimboFreeSnapshotVersion(T);h.Ms=h.Ms.insert(m,N)}}}(r.localStore,i))}async function VM(t,e){const n=$e(t);if(!n.currentUser.isEqual(e)){te(Vv,"User change. New user:",e.toKey());const r=await tN(n.localStore,e);n.currentUser=e,function(i,a){i.mu.forEach(l=>{l.forEach(c=>{c.reject(new se(G.CANCELLED,a))})}),i.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await yu(n,r.Ls)}}function MM(t,e){const n=$e(t),r=n.Au.get(e);if(r&&r.hu)return Xe().add(r.key);{let s=Xe();const i=n.Iu.get(e);if(!i)return s;for(const a of i){const l=n.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function _N(t){const e=$e(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=mN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=MM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kM.bind(null,e),e.Pu.H_=bM.bind(null,e.eventManager),e.Pu.yu=wM.bind(null,e.eventManager),e}function xN(t){const e=$e(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=DM.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=OM.bind(null,e),e}class Xc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=jf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return eN(this.persistence,new ZC,e.initialUser,this.serializer)}Cu(e){return new Ev(Nf.mi,this.serializer)}Du(e){return new rN}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Xc.provider={build:()=>new Xc};class FM extends Xc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Ne(this.persistence.referenceDelegate instanceof Ah,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new KC(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?xn.withCacheSize(this.cacheSizeBytes):xn.DEFAULT;return new Ev(r=>Ah.mi(r,n),this.serializer)}}class UM extends Xc{constructor(e,n,r){super(),this.xu=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await xN(this.xu.syncEngine),await gu(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return eN(this.persistence,new ZC,e.initialUser,this.serializer)}Fu(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new KC(r,e.asyncQueue,n)}Mu(e,n){const r=new qO(n,this.persistence);return new zO(e.asyncQueue,r)}Cu(e){const n=UV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?xn.withCacheSize(this.cacheSizeBytes):xn.DEFAULT;return new Iv(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,tM(),Dd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new rN}}class Ph{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Jw(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=VM.bind(null,this.syncEngine),await vM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new xM}()}createDatastore(e){const n=jf(e.databaseInfo.databaseId),r=function(i){return new eM(i)}(e.databaseInfo);return function(i,a,l,c){return new iM(i,a,l,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,a,l){return new aM(r,s,i,a,l)}(this.localStore,this.datastore,e.asyncQueue,n=>Jw(this.syncEngine,n,0),function(){return Ww.v()?new Ww:new YV}())}createSyncEngine(e,n){return function(s,i,a,l,c,d,h){const f=new TM(s,i,a,l,c,d);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=$e(s);te(To,"RemoteStore shutting down."),i.Ea.add(5),await mu(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}Ph.provider={build:()=>new Ph};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fv{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Rn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ii="FirestoreClient";class $M{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=dn.UNAUTHENTICATED,this.clientId=nv.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{te(Ii,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(te(Ii,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new kr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Pv(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Bp(t,e){t.asyncQueue.verifyOperationInProgress(),te(Ii,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await tN(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function e0(t,e){t.asyncQueue.verifyOperationInProgress();const n=await BM(t);te(Ii,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Kw(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Kw(e.remoteStore,s)),t._onlineComponents=e}async function BM(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){te(Ii,"Using user provided OfflineComponentProvider");try{await Bp(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===G.FAILED_PRECONDITION||s.code===G.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;vo("Error using user provided cache. Falling back to memory cache: "+n),await Bp(t,new Xc)}}else te(Ii,"Using default OfflineComponentProvider"),await Bp(t,new FM(void 0));return t._offlineComponents}async function Uv(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(te(Ii,"Using user provided OnlineComponentProvider"),await e0(t,t._uninitializedComponentsProvider._online)):(te(Ii,"Using default OnlineComponentProvider"),await e0(t,new Ph))),t._onlineComponents}function zM(t){return Uv(t).then(e=>e.syncEngine)}function qM(t){return Uv(t).then(e=>e.datastore)}async function kh(t){const e=await Uv(t),n=e.eventManager;return n.onListen=CM.bind(null,e.syncEngine),n.onUnlisten=AM.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=NM.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=RM.bind(null,e.syncEngine),n}function HM(t,e,n={}){const r=new kr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const h=new Fv({next:m=>{h.Nu(),a.enqueueAndForget(()=>Dv(i,f));const x=m.docs.has(l);!x&&m.fromCache?d.reject(new se(G.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&m.fromCache&&c&&c.source==="server"?d.reject(new se(G.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(m)},error:m=>d.reject(m)}),f=new Lv(hu(l.path),h,{includeMetadataChanges:!0,qa:!0});return kv(i,f)}(await kh(t),t.asyncQueue,e,n,r)),r.promise}function WM(t,e,n={}){const r=new kr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const h=new Fv({next:m=>{h.Nu(),a.enqueueAndForget(()=>Dv(i,f)),m.fromCache&&c.source==="server"?d.reject(new se(G.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(m)},error:m=>d.reject(m)}),f=new Lv(l,h,{includeMetadataChanges:!0,qa:!0});return kv(i,f)}(await kh(t),t.asyncQueue,e,n,r)),r.promise}function GM(t,e,n){const r=new kr;return t.asyncQueue.enqueueAndForget(async()=>{try{const s=await qM(t);r.resolve(async function(a,l,c){var N;const d=$e(a),{request:h,gt:f,parent:m}=oV(d.serializer,PL(l),c);d.connection.$o||delete h.parent;const x=(await d.Ho("RunAggregationQuery",d.serializer.databaseId,m,h,1)).filter(C=>!!C.result);Ne(x.length===1,64727);const T=(N=x[0].result)==null?void 0:N.aggregateFields;return Object.keys(T).reduce((C,S)=>(C[f[S]]=T[S],C),{})}(s,e,n))}catch(s){r.reject(s)}}),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t0=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wN="firestore.googleapis.com",n0=!0;class r0{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new se(G.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=wN,this.ssl=n0}else this.host=e.host,this.ssl=e.ssl??n0;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=qC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<EV)throw new se(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}MO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bN(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new se(G.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new se(G.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new se(G.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Rf{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new r0({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new se(G.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new se(G.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new r0(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new NO;switch(r.type){case"firstParty":return new PO(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new se(G.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=t0.get(n);r&&(te("ComponentProvider","Removing Datastore"),t0.delete(n),r.terminate())}(this),Promise.resolve()}}function KM(t,e,n,r={}){var d;t=In(t,Rf);const s=Ni(e),i=t._getSettings(),a={...i,emulatorOptions:t._getEmulatorOptions()},l=`${e}:${n}`;s&&($y(`https://${l}`),By("Firestore",!0)),i.host!==wN&&i.host!==l&&vo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:l,ssl:s,emulatorOptions:r};if(!Ss(c,a)&&(t._setSettings(c),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=dn.MOCK_USER;else{h=RS(r.mockUserToken,(d=t._app)==null?void 0:d.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new se(G.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new dn(m)}t._authCredentials=new jO(new AT(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ur{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ur(this.firestore,e,this._query)}}class $t{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $t(this.firestore,e,this._key)}toJSON(){return{type:$t._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(cu(n,$t._jsonSchema))return new $t(e,r||null,new he(ct.fromString(n.referencePath)))}}$t._jsonSchemaVersion="firestore/documentReference/1.0",$t._jsonSchema={type:Qt("string",$t._jsonSchemaVersion),referencePath:Qt("string")};class yi extends Ur{constructor(e,n,r){super(e,n,hu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $t(this.firestore,null,new he(e))}withConverter(e){return new yi(this.firestore,e,this._path)}}function ue(t,e,...n){if(t=ht(t),PT("collection","path",e),t instanceof Rf){const r=ct.fromString(e,...n);return Gb(r),new yi(t,null,r)}{if(!(t instanceof $t||t instanceof yi))throw new se(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ct.fromString(e,...n));return Gb(r),new yi(t.firestore,null,r)}}function De(t,e,...n){if(t=ht(t),arguments.length===1&&(e=nv.newId()),PT("doc","path",e),t instanceof Rf){const r=ct.fromString(e,...n);return Wb(r),new $t(t,null,new he(r))}{if(!(t instanceof $t||t instanceof yi))throw new se(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ct.fromString(e,...n));return Wb(r),new $t(t.firestore,t instanceof yi?t.converter:null,new he(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s0="AsyncQueue";class i0{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new sN(this,"async_queue_retry"),this._c=()=>{const r=Dd();r&&te(s0,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Dd();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Dd();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new kr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ri(e))throw e;te(s0,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Rn("INTERNAL UNHANDLED ERROR: ",o0(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=Rv.createAndSchedule(this,e,n,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&Se(47125,{Pc:o0(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function o0(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a0(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Vr extends Rf{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new i0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new i0(e),this._firestoreClient=void 0,await e}}}function EN(t,e){const n=typeof t=="object"?t:of(),r=typeof t=="string"?t:bh,s=ji(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=NS("firestore");i&&KM(s,...i)}return s}function vu(t){if(t._terminated)throw new se(G.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||IN(t),t._firestoreClient}function IN(t){var r,s,i;const e=t._freezeSettings(),n=function(l,c,d,h){return new xL(l,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,bN(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new $M(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}function QM(t,e){vo("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return YM(t,Ph.provider,{build:r=>new UM(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function YM(t,e,n){if((t=In(t,Vr))._firestoreClient||t._terminated)throw new se(G.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new se(G.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},IN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XM{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class JM{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new dr(Yt.fromBase64String(e))}catch(n){throw new se(G.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new dr(Yt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:dr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(cu(e,dr._jsonSchema))return dr.fromBase64String(e.bytes)}}dr._jsonSchemaVersion="firestore/bytes/1.0",dr._jsonSchema={type:Qt("string",dr._jsonSchemaVersion),bytes:Qt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new se(G.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new kt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ns{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new se(G.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new se(G.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return He(this._lat,e._lat)||He(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ns._jsonSchemaVersion}}static fromJSON(e){if(cu(e,ns._jsonSchema))return new ns(e.latitude,e.longitude)}}ns._jsonSchemaVersion="firestore/geoPoint/1.0",ns._jsonSchema={type:Qt("string",ns._jsonSchemaVersion),latitude:Qt("number"),longitude:Qt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rs{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:rs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(cu(e,rs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new rs(e.vectorValues);throw new se(G.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}rs._jsonSchemaVersion="firestore/vectorValue/1.0",rs._jsonSchema={type:Qt("string",rs._jsonSchemaVersion),vectorValues:Qt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZM=/^__.*__$/;class eF{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ps(e,this.data,this.fieldMask,n,this.fieldTransforms):new ul(e,this.data,n,this.fieldTransforms)}}class SN{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ps(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function TN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Se(40011,{Ac:t})}}class kf{constructor(e,n,r,s,i,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new kf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Dh(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(TN(this.Ac)&&ZM.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class tF{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||jf(e)}Cc(e,n,r,s=!1){return new kf({Ac:e,methodName:n,Dc:r,path:kt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _u(t){const e=t._freezeSettings(),n=jf(t._databaseId);return new tF(t._databaseId,!!e.ignoreUndefinedProperties,n)}function CN(t,e,n,r,s,i={}){const a=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);qv("Data must be an object, but it was:",a,r);const l=jN(r,a);let c,d;if(i.merge)c=new zn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=Og(e,f,n);if(!a.contains(m))throw new se(G.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);RN(h,m)||h.push(m)}c=new zn(h),d=a.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,d=a.fieldTransforms;return new eF(new wn(l),c,d)}class Df extends hl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Df}}function nF(t,e,n){return new kf({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class $v extends hl{_toFieldTransform(e){return new wf(e.path,new Ya)}isEqual(e){return e instanceof $v}}class Bv extends hl{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=nF(this,e,!0),r=this.vc.map(i=>fl(i,n)),s=new wo(r);return new wf(e.path,s)}isEqual(e){return e instanceof Bv&&Ss(this.vc,e.vc)}}class zv extends hl{constructor(e,n){super(e),this.Fc=n}_toFieldTransform(e){const n=new Ja(e.serializer,vC(e.serializer,this.Fc));return new wf(e.path,n)}isEqual(e){return e instanceof zv&&this.Fc===e.Fc}}function rF(t,e,n,r){const s=t.Cc(1,e,n);qv("Data must be an object, but it was:",s,r);const i=[],a=wn.empty();Pi(r,(c,d)=>{const h=Hv(e,c,n);d=ht(d);const f=s.yc(h);if(d instanceof Df)i.push(h);else{const m=fl(d,f);m!=null&&(i.push(h),a.set(h,m))}});const l=new zn(i);return new SN(a,l,s.fieldTransforms)}function sF(t,e,n,r,s,i){const a=t.Cc(1,e,n),l=[Og(e,r,n)],c=[s];if(i.length%2!=0)throw new se(G.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)l.push(Og(e,i[m])),c.push(i[m+1]);const d=[],h=wn.empty();for(let m=l.length-1;m>=0;--m)if(!RN(d,l[m])){const x=l[m];let T=c[m];T=ht(T);const N=a.yc(x);if(T instanceof Df)d.push(x);else{const C=fl(T,N);C!=null&&(d.push(x),h.set(x,C))}}const f=new zn(d);return new SN(h,f,a.fieldTransforms)}function NN(t,e,n,r=!1){return fl(n,t.Cc(r?4:3,e))}function fl(t,e){if(AN(t=ht(t)))return qv("Unsupported field value:",e,t),jN(t,e);if(t instanceof hl)return function(r,s){if(!TN(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const l of r){let c=fl(l,s.wc(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=ht(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return vC(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=ot.fromDate(r);return{timestampValue:Za(s.serializer,i)}}if(r instanceof ot){const i=new ot(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Za(s.serializer,i)}}if(r instanceof ns)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof dr)return{bytesValue:jC(s.serializer,r._byteString)};if(r instanceof $t){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:vv(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof rs)return function(a,l){return{mapValue:{fields:{[cv]:{stringValue:uv},[Ga]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return fv(l.serializer,d)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${df(r)}`)}(t,e)}function jN(t,e){const n={};return KT(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pi(t,(r,s)=>{const i=fl(s,e.mc(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function AN(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ot||t instanceof ns||t instanceof dr||t instanceof $t||t instanceof hl||t instanceof rs)}function qv(t,e,n){if(!AN(n)||!kT(n)){const r=df(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Og(t,e,n){if((e=ht(e))instanceof Pf)return e._internalPath;if(typeof e=="string")return Hv(t,e);throw Dh("Field path arguments must be of type string or ",t,!1,void 0,n)}const iF=new RegExp("[~\\*/\\[\\]]");function Hv(t,e,n){if(e.search(iF)>=0)throw Dh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Pf(...e.split("."))._internalPath}catch{throw Dh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Dh(t,e,n,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${r}`),a&&(c+=` in document ${s}`),c+=")"),new se(G.INVALID_ARGUMENT,l+t+c)}function RN(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $t(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new oF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Of("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class oF extends Wv{data(){return super.data()}}function Of(t,e){return typeof e=="string"?Hv(t,e):e instanceof Pf?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PN(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new se(G.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Gv{}class xu extends Gv{}function qe(t,e,...n){let r=[];e instanceof Gv&&r.push(e),r=r.concat(n),function(i){const a=i.filter(c=>c instanceof Kv).length,l=i.filter(c=>c instanceof Lf).length;if(a>1||a>0&&l>0)throw new se(G.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Lf extends xu{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Lf(e,n,r)}_apply(e){const n=this._parse(e);return DN(e._query,n),new Ur(e.firestore,e.converter,Eg(e._query,n))}_parse(e){const n=_u(e.firestore);return function(i,a,l,c,d,h,f){let m;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new se(G.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){d0(f,h);const T=[];for(const N of f)T.push(u0(c,i,N));m={arrayValue:{values:T}}}else m=u0(c,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||d0(f,h),m=NN(l,a,f,h==="in"||h==="not-in");return nt.create(d,h,m)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function it(t,e,n){const r=e,s=Of("where",t);return Lf._create(s,r,n)}class Kv extends Gv{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Kv(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:ft.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let a=s;const l=i.getFlattenedFilters();for(const c of l)DN(a,c),a=Eg(a,c)}(e._query,n),new Ur(e.firestore,e.converter,Eg(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Qv extends xu{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Qv(e,n)}_apply(e){const n=function(s,i,a){if(s.startAt!==null)throw new se(G.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new se(G.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Yc(i,a)}(e._query,this._field,this._direction);return new Ur(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new ki(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function yt(t,e="asc"){const n=e,r=Of("orderBy",t);return Qv._create(r,n)}class Yv extends xu{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new Yv(e,n,r)}_apply(e){return new Ur(e.firestore,e.converter,Ih(e._query,this._limit,this._limitType))}}function Pa(t){return FO("limit",t),Yv._create("limit",t,"F")}class Vf extends xu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Vf(e,n,r)}_apply(e){const n=kN(e,this.type,this._docOrFields,this._inclusive);return new Ur(e.firestore,e.converter,function(s,i){return new ki(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,n))}}function l0(...t){return Vf._create("startAt",t,!0)}function aF(...t){return Vf._create("startAfter",t,!1)}class Xv extends xu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Xv(e,n,r)}_apply(e){const n=kN(e,this.type,this._docOrFields,this._inclusive);return new Ur(e.firestore,e.converter,function(s,i){return new ki(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,n))}}function c0(...t){return Xv._create("endAt",t,!0)}function kN(t,e,n,r){if(n[0]=ht(n[0]),n[0]instanceof Wv)return function(i,a,l,c,d){if(!c)throw new se(G.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const h=[];for(const f of Aa(i))if(f.field.isKeyField())h.push(xo(a,c.key));else{const m=c.data.field(f.field);if(yf(m))throw new se(G.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const x=f.field.canonicalString();throw new se(G.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${x}' (used as the orderBy) does not exist.`)}h.push(m)}return new wi(h,d)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=_u(t.firestore);return function(a,l,c,d,h,f){const m=a.explicitOrderBy;if(h.length>m.length)throw new se(G.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const x=[];for(let T=0;T<h.length;T++){const N=h[T];if(m[T].field.isKeyField()){if(typeof N!="string")throw new se(G.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof N}`);if(!hv(a)&&N.indexOf("/")!==-1)throw new se(G.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${N}' contains a slash.`);const C=a.path.child(ct.fromString(N));if(!he.isDocumentKey(C))throw new se(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${C}' is not because it contains an odd number of segments.`);const S=new he(C);x.push(xo(l,S))}else{const C=NN(c,d,N);x.push(C)}}return new wi(x,f)}(t._query,t.firestore._databaseId,s,e,n,r)}}function u0(t,e,n){if(typeof(n=ht(n))=="string"){if(n==="")throw new se(G.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!hv(e)&&n.indexOf("/")!==-1)throw new se(G.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ct.fromString(n));if(!he.isDocumentKey(r))throw new se(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return xo(t,new he(r))}if(n instanceof $t)return xo(t,n._key);throw new se(G.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${df(n)}.`)}function d0(t,e){if(!Array.isArray(t)||t.length===0)throw new se(G.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function DN(t,e){const n=function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new se(G.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new se(G.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class lF{convertValue(e,n="none"){switch(xi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Tt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(js(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Se(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Pi(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var r,s,i;const n=(i=(s=(r=e.fields)==null?void 0:r[Ga].arrayValue)==null?void 0:s.values)==null?void 0:i.map(a=>Tt(a.doubleValue));return new rs(n)}convertGeoPoint(e){return new ns(Tt(e.latitude),Tt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=vf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Gc(e));default:return null}}convertTimestamp(e){const n=Ns(e);return new ot(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=ct.fromString(e);Ne(MC(r),9688,{name:e});const s=new _o(r.get(1),r.get(3)),i=new he(r.popFirst(5));return s.isEqual(n)||Rn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ON(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}function cF(){return new XM("count")}class Jl{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ao extends Wv{constructor(e,n,r,s,i,a){super(e,n,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Od(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Of("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new se(G.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=ao._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}ao._jsonSchemaVersion="firestore/documentSnapshot/1.0",ao._jsonSchema={type:Qt("string",ao._jsonSchemaVersion),bundleSource:Qt("string","DocumentSnapshot"),bundleName:Qt("string"),bundle:Qt("string")};class Od extends ao{data(e={}){return super.data(e)}}class lo{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Jl(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Od(this._firestore,this._userDataWriter,r.key,r,new Jl(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new se(G.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const c=new Od(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Jl(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new Od(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Jl(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),h=a.indexOf(l.doc.key)),{type:uF(l.type),doc:c,oldIndex:d,newIndex:h}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new se(G.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=lo._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=nv.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(n.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function uF(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Se(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Co(t){t=In(t,$t);const e=In(t.firestore,Vr);return HM(vu(e),t._key).then(n=>LN(e,t,n))}lo._jsonSchemaVersion="firestore/querySnapshot/1.0",lo._jsonSchema={type:Qt("string",lo._jsonSchemaVersion),bundleSource:Qt("string","QuerySnapshot"),bundleName:Qt("string"),bundle:Qt("string")};class Mf extends lF{constructor(e){super(),this.firestore=e}convertBytes(e){return new dr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new $t(this.firestore,null,n)}}function Ae(t){t=In(t,Ur);const e=In(t.firestore,Vr),n=vu(e),r=new Mf(e);return PN(t._query),WM(n,t._query).then(s=>new lo(e,r,t,s))}function No(t,e,n){t=In(t,$t);const r=In(t.firestore,Vr),s=ON(t.converter,e,n);return Ff(r,[CN(_u(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,En.none())])}function Ut(t,e,n,...r){t=In(t,$t);const s=In(t.firestore,Vr),i=_u(s);let a;return a=typeof(e=ht(e))=="string"||e instanceof Pf?sF(i,"updateDoc",t._key,e,n,r):rF(i,"updateDoc",t._key,e),Ff(s,[a.toMutation(t._key,En.exists(!0))])}function Tn(t){return Ff(In(t.firestore,Vr),[new If(t._key,En.none())])}function Bt(t,e){const n=In(t.firestore,Vr),r=De(t),s=ON(t.converter,e);return Ff(n,[CN(_u(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,En.exists(!1))]).then(()=>r)}function an(t,...e){var c,d,h;t=ht(t);let n={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||a0(e[r])||(n=e[r++]);const s={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(a0(e[r])){const f=e[r];e[r]=(c=f.next)==null?void 0:c.bind(f),e[r+1]=(d=f.error)==null?void 0:d.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,a,l;if(t instanceof $t)a=In(t.firestore,Vr),l=hu(t._key.path),i={next:f=>{e[r]&&e[r](LN(a,t,f))},error:e[r+1],complete:e[r+2]};else{const f=In(t,Ur);a=In(f.firestore,Vr),l=f._query;const m=new Mf(a);i={next:x=>{e[r]&&e[r](new lo(a,m,f,x))},error:e[r+1],complete:e[r+2]},PN(t._query)}return function(m,x,T,N){const C=new Fv(N),S=new Lv(x,C,T);return m.asyncQueue.enqueueAndForget(async()=>kv(await kh(m),S)),()=>{C.Nu(),m.asyncQueue.enqueueAndForget(async()=>Dv(await kh(m),S))}}(vu(a),l,s,i)}function Ff(t,e){return function(r,s){const i=new kr;return r.asyncQueue.enqueueAndForget(async()=>PM(await zM(r),s,i)),i.promise}(vu(t),e)}function LN(t,e,n){const r=n.docs.get(e._key),s=new Mf(t);return new ao(t,s,e._key,r,new Jl(n.hasPendingWrites,n.fromCache),e.converter)}function dF(t){return hF(t,{count:cF()})}function hF(t,e){const n=In(t.firestore,Vr),r=vu(n),s=vL(e,(i,a)=>new WL(a,i.aggregateType,i._internalFieldPath));return GM(r,t._query,s).then(i=>function(l,c,d){const h=new Mf(l);return new JM(c,h,d)}(n,t,i))}function Pt(){return new $v("serverTimestamp")}function fF(...t){return new Bv("arrayUnion",t)}function h0(t){return new zv("increment",t)}(function(e,n=!0){(function(s){cl=s})(Oo),Or(new _r("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new Vr(new AO(r.getProvider("auth-internal")),new kO(a,r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new se(G.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _o(d.options.projectId,h)}(a,s),a);return i={useFetchStreams:n,...i},l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Gn(Bb,zb,e),Gn(Bb,zb,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VN="firebasestorage.googleapis.com",MN="storageBucket",pF=2*60*1e3,mF=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt extends xr{constructor(e,n,r=0){super(zp(e),`Firebase Storage: ${n} (${zp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,qt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return zp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var zt;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(zt||(zt={}));function zp(t){return"storage/"+t}function Jv(){const t="An unknown error occurred, please check the error payload for server response.";return new qt(zt.UNKNOWN,t)}function gF(t){return new qt(zt.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function yF(t){return new qt(zt.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function vF(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new qt(zt.UNAUTHENTICATED,t)}function _F(){return new qt(zt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function xF(t){return new qt(zt.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function bF(){return new qt(zt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function wF(){return new qt(zt.CANCELED,"User canceled the upload/download.")}function EF(t){return new qt(zt.INVALID_URL,"Invalid URL '"+t+"'.")}function IF(t){return new qt(zt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function SF(){return new qt(zt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+MN+"' property when initializing the app?")}function TF(){return new qt(zt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function CF(){return new qt(zt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function NF(t){return new qt(zt.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Lg(t){return new qt(zt.INVALID_ARGUMENT,t)}function FN(){return new qt(zt.APP_DELETED,"The Firebase app was deleted.")}function jF(t){return new qt(zt.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function _c(t,e){return new qt(zt.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Ml(t){throw new qt(zt.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=Pn.makeFromUrl(e,n)}catch{return new Pn(e,"")}if(r.path==="")return r;throw IF(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(_){_.path.charAt(_.path.length-1)==="/"&&(_.path_=_.path_.slice(0,-1))}const a="(/(.*))?$",l=new RegExp("^gs://"+s+a,"i"),c={bucket:1,path:3};function d(_){_.path_=decodeURIComponent(_.path)}const h="v[A-Za-z0-9_]+",f=n.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",x=new RegExp(`^https?://${f}/${h}/b/${s}/o${m}`,"i"),T={bucket:1,path:3},N=n===VN?"(?:storage.googleapis.com|storage.cloud.google.com)":n,C="([^?#]*)",S=new RegExp(`^https?://${N}/${s}/${C}`,"i"),g=[{regex:l,indices:c,postModify:i},{regex:x,indices:T,postModify:d},{regex:S,indices:{bucket:1,path:2},postModify:d}];for(let _=0;_<g.length;_++){const O=g[_],L=O.regex.exec(e);if(L){const v=L[O.indices.bucket];let w=L[O.indices.path];w||(w=""),r=new Pn(v,w),O.postModify(r);break}}if(r==null)throw EF(e);return r}}class AF{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RF(t,e,n){let r=1,s=null,i=null,a=!1,l=0;function c(){return l===2}let d=!1;function h(...C){d||(d=!0,e.apply(null,C))}function f(C){s=setTimeout(()=>{s=null,t(x,c())},C)}function m(){i&&clearTimeout(i)}function x(C,...S){if(d){m();return}if(C){m(),h.call(null,C,...S);return}if(c()||a){m(),h.call(null,C,...S);return}r<64&&(r*=2);let g;l===1?(l=2,g=0):g=(r+Math.random())*1e3,f(g)}let T=!1;function N(C){T||(T=!0,m(),!d&&(s!==null?(C||(l=2),clearTimeout(s),f(0)):C||(l=1)))}return f(0),i=setTimeout(()=>{a=!0,N(!0)},n),N}function PF(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kF(t){return t!==void 0}function DF(t){return typeof t=="object"&&!Array.isArray(t)}function Zv(t){return typeof t=="string"||t instanceof String}function f0(t){return e_()&&t instanceof Blob}function e_(){return typeof Blob<"u"}function Vg(t,e,n,r){if(r<e)throw Lg(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Lg(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bu(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function UN(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var co;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(co||(co={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OF(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{constructor(e,n,r,s,i,a,l,c,d,h,f,m=!0,x=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=f,this.retry=m,this.isUsingEmulator=x,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((T,N)=>{this.resolve_=T,this.reject_=N,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new nd(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const a=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;const l=i.getErrorCode()===co.NO_ERROR,c=i.getStatus();if(!l||OF(c,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===co.ABORT;r(!1,new nd(!1,null,h));return}const d=this.successCodes_.indexOf(c)!==-1;r(!0,new nd(d,i))})},n=(r,s)=>{const i=this.resolve_,a=this.reject_,l=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());kF(c)?i(c):i()}catch(c){a(c)}else if(l!==null){const c=Jv();c.serverResponse=l.getErrorText(),this.errorCallback_?a(this.errorCallback_(l,c)):a(c)}else if(s.canceled){const c=this.appDelete_?FN():wF();a(c)}else{const c=bF();a(c)}};this.canceled_?n(!1,new nd(!1,null,!0)):this.backoffId_=RF(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&PF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class nd{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function VF(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function MF(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function FF(t,e){e&&(t["X-Firebase-GMPID"]=e)}function UF(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function $F(t,e,n,r,s,i,a=!0,l=!1){const c=UN(t.urlParams),d=t.url+c,h=Object.assign({},t.headers);return FF(h,e),VF(h,n),MF(h,i),UF(h,r),new LF(d,t.method,h,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,a,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BF(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function zF(...t){const e=BF();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(e_())return new Blob(t);throw new qt(zt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function qF(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HF(t){if(typeof atob>"u")throw NF("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xr={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class qp{constructor(e,n){this.data=e,this.contentType=n||null}}function WF(t,e){switch(t){case Xr.RAW:return new qp($N(e));case Xr.BASE64:case Xr.BASE64URL:return new qp(BN(t,e));case Xr.DATA_URL:return new qp(KF(e),QF(e))}throw Jv()}function $N(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,a=t.charCodeAt(++n);r=65536|(i&1023)<<10|a&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function GF(t){let e;try{e=decodeURIComponent(t)}catch{throw _c(Xr.DATA_URL,"Malformed data URL.")}return $N(e)}function BN(t,e){switch(t){case Xr.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw _c(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Xr.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw _c(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=HF(e)}catch(s){throw s.message.includes("polyfill")?s:_c(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class zN{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw _c(Xr.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=YF(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function KF(t){const e=new zN(t);return e.base64?BN(Xr.BASE64,e.rest):GF(e.rest)}function QF(t){return new zN(t).contentType}function YF(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,n){let r=0,s="";f0(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(f0(this.data_)){const r=this.data_,s=qF(r,e,n);return s===null?null:new ei(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new ei(r,!0)}}static getBlob(...e){if(e_()){const n=e.map(r=>r instanceof ei?r.data_:r);return new ei(zF.apply(null,n))}else{const n=e.map(a=>Zv(a)?WF(Xr.RAW,a).data:a.data_);let r=0;n.forEach(a=>{r+=a.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(a=>{for(let l=0;l<a.length;l++)s[i++]=a[l]}),new ei(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t_(t){let e;try{e=JSON.parse(t)}catch{return null}return DF(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XF(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function JF(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function qN(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZF(t,e){return e}class jn{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||ZF}}let rd=null;function e4(t){return!Zv(t)||t.length<2?t:qN(t)}function HN(){if(rd)return rd;const t=[];t.push(new jn("bucket")),t.push(new jn("generation")),t.push(new jn("metageneration")),t.push(new jn("name","fullPath",!0));function e(i,a){return e4(a)}const n=new jn("name");n.xform=e,t.push(n);function r(i,a){return a!==void 0?Number(a):a}const s=new jn("size");return s.xform=r,t.push(s),t.push(new jn("timeCreated")),t.push(new jn("updated")),t.push(new jn("md5Hash",null,!0)),t.push(new jn("cacheControl",null,!0)),t.push(new jn("contentDisposition",null,!0)),t.push(new jn("contentEncoding",null,!0)),t.push(new jn("contentLanguage",null,!0)),t.push(new jn("contentType",null,!0)),t.push(new jn("metadata","customMetadata",!0)),rd=t,rd}function t4(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new Pn(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function n4(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const a=n[i];r[a.local]=a.xform(r,e[a.server])}return t4(r,t),r}function WN(t,e,n){const r=t_(e);return r===null?null:n4(t,r,n)}function r4(t,e,n,r){const s=t_(e);if(s===null||!Zv(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const a=encodeURIComponent;return i.split(",").map(d=>{const h=t.bucket,f=t.fullPath,m="/b/"+a(h)+"/o/"+a(f),x=bu(m,n,r),T=UN({alt:"media",token:d});return x+T})[0]}function s4(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p0="prefixes",m0="items";function i4(t,e,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[p0])for(const s of n[p0]){const i=s.replace(/\/$/,""),a=t._makeStorageReference(new Pn(e,i));r.prefixes.push(a)}if(n[m0])for(const s of n[m0]){const i=t._makeStorageReference(new Pn(e,s.name));r.items.push(i)}return r}function o4(t,e,n){const r=t_(n);return r===null?null:i4(t,e,r)}class Uf{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n_(t){if(!t)throw Jv()}function a4(t,e){function n(r,s){const i=WN(t,s,e);return n_(i!==null),i}return n}function l4(t,e){function n(r,s){const i=o4(t,e,s);return n_(i!==null),i}return n}function c4(t,e){function n(r,s){const i=WN(t,s,e);return n_(i!==null),r4(i,s,t.host,t._protocol)}return n}function r_(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=_F():s=vF():n.getStatus()===402?s=yF(t.bucket):n.getStatus()===403?s=xF(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function GN(t){const e=r_(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=gF(t.path)),i.serverResponse=s.serverResponse,i}return n}function u4(t,e,n,r,s){const i={};e.isRoot?i.prefix="":i.prefix=e.path+"/",n.length>0&&(i.delimiter=n),r&&(i.pageToken=r),s&&(i.maxResults=s);const a=e.bucketOnlyServerUrl(),l=bu(a,t.host,t._protocol),c="GET",d=t.maxOperationRetryTime,h=new Uf(l,c,l4(t,e.bucket),d);return h.urlParams=i,h.errorHandler=r_(e),h}function d4(t,e,n){const r=e.fullServerUrl(),s=bu(r,t.host,t._protocol),i="GET",a=t.maxOperationRetryTime,l=new Uf(s,i,c4(t,n),a);return l.errorHandler=GN(e),l}function h4(t,e){const n=e.fullServerUrl(),r=bu(n,t.host,t._protocol),s="DELETE",i=t.maxOperationRetryTime;function a(c,d){}const l=new Uf(r,s,a,i);return l.successCodes=[200,204],l.errorHandler=GN(e),l}function f4(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function p4(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=f4(null,e)),r}function m4(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function l(){let g="";for(let _=0;_<2;_++)g=g+Math.random().toString().slice(2);return g}const c=l();a["Content-Type"]="multipart/related; boundary="+c;const d=p4(e,r,s),h=s4(d,n),f="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,m=`\r
--`+c+"--",x=ei.getBlob(f,r,m);if(x===null)throw TF();const T={name:d.fullPath},N=bu(i,t.host,t._protocol),C="POST",S=t.maxUploadRetryTime,E=new Uf(N,C,a4(t,n),S);return E.urlParams=T,E.headers=a,E.body=x.uploadData(),E.errorHandler=r_(e),E}class g4{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=co.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=co.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=co.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s,i){if(this.sent_)throw Ml("cannot .send() more than once");if(Ni(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const a in i)i.hasOwnProperty(a)&&this.xhr_.setRequestHeader(a,i[a].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ml("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ml("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ml("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ml("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class y4 extends g4{initXhr(){this.xhr_.responseType="text"}}function $f(){return new y4}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e,n){this._service=e,n instanceof Pn?this._location=n:this._location=Pn.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new jo(e,n)}get root(){const e=new Pn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return qN(this._location.path)}get storage(){return this._service}get parent(){const e=XF(this._location.path);if(e===null)return null;const n=new Pn(this._location.bucket,e);return new jo(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw jF(e)}}function v4(t,e,n){t._throwIfRoot("uploadBytes");const r=m4(t.storage,t._location,HN(),new ei(e,!0),n);return t.storage.makeRequestWithTokens(r,$f).then(s=>({metadata:s,ref:t}))}function _4(t){const e={prefixes:[],items:[]};return KN(t,e).then(()=>e)}async function KN(t,e,n){const s=await x4(t,{pageToken:n});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await KN(t,e,s.nextPageToken)}function x4(t,e){e!=null&&typeof e.maxResults=="number"&&Vg("options.maxResults",1,1e3,e.maxResults);const n=e||{},r=u4(t.storage,t._location,"/",n.pageToken,n.maxResults);return t.storage.makeRequestWithTokens(r,$f)}function b4(t){t._throwIfRoot("getDownloadURL");const e=d4(t.storage,t._location,HN());return t.storage.makeRequestWithTokens(e,$f).then(n=>{if(n===null)throw CF();return n})}function w4(t){t._throwIfRoot("deleteObject");const e=h4(t.storage,t._location);return t.storage.makeRequestWithTokens(e,$f)}function E4(t,e){const n=JF(t._location.path,e),r=new Pn(t._location.bucket,n);return new jo(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I4(t){return/^[A-Za-z]+:\/\//.test(t)}function S4(t,e){return new jo(t,e)}function QN(t,e){if(t instanceof s_){const n=t;if(n._bucket==null)throw SF();const r=new jo(n,n._bucket);return e!=null?QN(r,e):r}else return e!==void 0?E4(t,e):t}function T4(t,e){if(e&&I4(e)){if(t instanceof s_)return S4(t,e);throw Lg("To use ref(service, url), the first argument must be a Storage instance.")}else return QN(t,e)}function g0(t,e){const n=e==null?void 0:e[MN];return n==null?null:Pn.makeFromBucketSpec(n,t)}function C4(t,e,n,r={}){t.host=`${e}:${n}`;const s=Ni(e);s&&($y(`https://${t.host}/b`),By("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:RS(i,t.app.options.projectId))}class s_{constructor(e,n,r,s,i,a=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=a,this._bucket=null,this._host=VN,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=pF,this._maxUploadRetryTime=mF,this._requests=new Set,s!=null?this._bucket=Pn.makeFromBucketSpec(s,this._host):this._bucket=g0(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Pn.makeFromBucketSpec(this._url,e):this._bucket=g0(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Vg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Vg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(ur(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new jo(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new AF(FN());{const a=$F(e,this._appId,r,s,n,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const y0="@firebase/storage",v0="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YN="storage";function _0(t,e,n){return t=ht(t),v4(t,e,n)}function x0(t){return t=ht(t),_4(t)}function b0(t){return t=ht(t),b4(t)}function Hp(t){return t=ht(t),w4(t)}function Fl(t,e){return t=ht(t),T4(t,e)}function Qi(t=of(),e){t=ht(t);const r=ji(t,YN).getImmediate({identifier:e}),s=NS("storage");return s&&N4(r,...s),r}function N4(t,e,n,r={}){C4(t,e,n,r)}function j4(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new s_(n,r,s,e,Oo)}function A4(){Or(new _r(YN,j4,"PUBLIC").setMultipleInstances(!0)),Gn(y0,v0,""),Gn(y0,v0,"esm2020")}A4();const R4={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},i_=Hy(R4),w0=wT(i_),E0=EN(i_);Qi(i_);const P4="/odontocloud-react/assets/fondo.png",XN="/odontocloud-react/assets/logo.png",I0=(t,e)=>{const n={email:t,rol:e,timestamp:Date.now()};localStorage.setItem("odc_session",JSON.stringify(n))},Wp=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},k4=()=>{const t=is(),[e,n]=b.useState(""),[r,s]=b.useState(""),[i,a]=b.useState(""),[l,c]=b.useState(navigator.onLine);b.useEffect(()=>{const f=()=>c(!0),m=()=>c(!1);return window.addEventListener("online",f),window.addEventListener("offline",m),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",m)}},[]);const d=f=>{const m=(f||"").toLowerCase();m==="administrador"?t("/dashboard_admin",{replace:!0}):m==="doctor"?t("/dashboard_doctor",{replace:!0}):m==="recepcionista"?t("/dashboard_recepcion",{replace:!0}):a("Rol no reconocido. Contacte al administrador.")};b.useEffect(()=>{if(!navigator.onLine){const m=Wp();m!=null&&m.rol?d(m.rol):a("Sin conexin y no hay sesin guardada.");return}const f=Jy(w0,async m=>{if(m){const x=Wp();if(x!=null&&x.rol){d(x.rol);return}try{const T=qe(ue(E0,"users"),it("correo","==",m.email||"")),N=await Ae(T);if(!N.empty){const C=N.docs[0].data().rol||"sin_rol";I0(m.email||"",C),d(C)}}catch{d("administrador")}}});return()=>f()},[]);const h=async f=>{if(f.preventDefault(),a(""),!l){const m=Wp();m!=null&&m.rol?d(m.rol):a("Sin conexin y no hay sesin guardada.");return}try{const x=(await f2(w0,e,r)).user,T=qe(ue(E0,"users"),it("correo","==",e)),N=await Ae(T);if(N.empty){a("Usuario no encontrado en la base de datos.");return}const S=N.docs[0].data().rol||"sin_rol";I0(e,S),d(S)}catch(m){switch(console.error("Error login:",m),m.code){case"auth/user-not-found":a("Usuario no registrado.");break;case"auth/wrong-password":a("Contrasea incorrecta.");break;case"auth/invalid-email":a("Correo no vlido.");break;case"auth/network-request-failed":a("Sin conexin. Usa la sesin guardada o reconecta.");break;default:a("Error al iniciar sesin.")}}};return o.jsx("div",{className:"login-root",style:{backgroundImage:`url(${P4})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed",width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:o.jsxs("div",{className:"container",children:[o.jsxs("div",{className:"left-panel",children:[o.jsx("img",{src:XN,alt:"OdontoCloud Logo",className:"logo"}),o.jsxs("h2",{children:["Su clnica, ",o.jsx("br",{})," ms conectada."]}),o.jsx("p",{children:"OdontoCloud optimiza cada detalle de su gestin."})]}),o.jsxs("div",{className:"right-panel",children:[o.jsx("h3",{children:"Acceso a la plataforma"}),o.jsxs("form",{onSubmit:h,children:[o.jsx("input",{type:"email",placeholder:"usuario@ejemplo.com",value:e,onChange:f=>n(f.target.value),required:l}),o.jsx("input",{type:"password",placeholder:"Contrasea",value:r,onChange:f=>s(f.target.value),required:l}),o.jsx("button",{type:"submit",children:l?"Iniciar sesin":"Entrar (modo offline)"}),i&&o.jsx("p",{style:{color:"red",marginTop:10},children:i}),!l&&o.jsx("p",{style:{color:"orange",marginTop:10},children:" Modo offline activado"})]})]})]})})},JN="@firebase/installations",o_="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZN=1e4,e1=`w:${o_}`,t1="FIS_v2",D4="https://firebaseinstallations.googleapis.com/v1",O4=60*60*1e3,L4="installations",V4="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ao=new Do(L4,V4,M4);function n1(t){return t instanceof xr&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r1({projectId:t}){return`${D4}/projects/${t}/installations`}function s1(t){return{token:t.token,requestStatus:2,expiresIn:U4(t.expiresIn),creationTime:Date.now()}}async function i1(t,e){const r=(await e.json()).error;return Ao.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function o1({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function F4(t,{refreshToken:e}){const n=o1(t);return n.append("Authorization",$4(e)),n}async function a1(t){const e=await t();return e.status>=500&&e.status<600?t():e}function U4(t){return Number(t.replace("s","000"))}function $4(t){return`${t1} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B4({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=r1(t),s=o1(t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={fid:n,authVersion:t1,appId:t.appId,sdkVersion:e1},l={method:"POST",headers:s,body:JSON.stringify(a)},c=await a1(()=>fetch(r,l));if(c.ok){const d=await c.json();return{fid:d.fid||n,registrationStatus:2,refreshToken:d.refreshToken,authToken:s1(d.authToken)}}else throw await i1("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l1(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z4(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q4=/^[cdef][\w-]{21}$/,Mg="";function H4(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=W4(t);return q4.test(n)?n:Mg}catch{return Mg}}function W4(t){return z4(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bf(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c1=new Map;function u1(t,e){const n=Bf(t);d1(n,e),G4(n,e)}function d1(t,e){const n=c1.get(t);if(n)for(const r of n)r(e)}function G4(t,e){const n=K4();n&&n.postMessage({key:t,fid:e}),Q4()}let eo=null;function K4(){return!eo&&"BroadcastChannel"in self&&(eo=new BroadcastChannel("[Firebase] FID Change"),eo.onmessage=t=>{d1(t.data.key,t.data.fid)}),eo}function Q4(){c1.size===0&&eo&&(eo.close(),eo=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y4="firebase-installations-database",X4=1,Ro="firebase-installations-store";let Gp=null;function a_(){return Gp||(Gp=FS(Y4,X4,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Ro)}}})),Gp}async function Oh(t,e){const n=Bf(t),s=(await a_()).transaction(Ro,"readwrite"),i=s.objectStore(Ro),a=await i.get(n);return await i.put(e,n),await s.done,(!a||a.fid!==e.fid)&&u1(t,e.fid),e}async function h1(t){const e=Bf(t),r=(await a_()).transaction(Ro,"readwrite");await r.objectStore(Ro).delete(e),await r.done}async function zf(t,e){const n=Bf(t),s=(await a_()).transaction(Ro,"readwrite"),i=s.objectStore(Ro),a=await i.get(n),l=e(a);return l===void 0?await i.delete(n):await i.put(l,n),await s.done,l&&(!a||a.fid!==l.fid)&&u1(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l_(t){let e;const n=await zf(t.appConfig,r=>{const s=J4(r),i=Z4(t,s);return e=i.registrationPromise,i.installationEntry});return n.fid===Mg?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function J4(t){const e=t||{fid:H4(),registrationStatus:0};return f1(e)}function Z4(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Ao.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=e6(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:t6(t)}:{installationEntry:e}}async function e6(t,e){try{const n=await B4(t,e);return Oh(t.appConfig,n)}catch(n){throw n1(n)&&n.customData.serverCode===409?await h1(t.appConfig):await Oh(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function t6(t){let e=await S0(t.appConfig);for(;e.registrationStatus===1;)await l1(100),e=await S0(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await l_(t);return r||n}return e}function S0(t){return zf(t,e=>{if(!e)throw Ao.create("installation-not-found");return f1(e)})}function f1(t){return n6(t)?{fid:t.fid,registrationStatus:0}:t}function n6(t){return t.registrationStatus===1&&t.registrationTime+ZN<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r6({appConfig:t,heartbeatServiceProvider:e},n){const r=s6(t,n),s=F4(t,n),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={installation:{sdkVersion:e1,appId:t.appId}},l={method:"POST",headers:s,body:JSON.stringify(a)},c=await a1(()=>fetch(r,l));if(c.ok){const d=await c.json();return s1(d)}else throw await i1("Generate Auth Token",c)}function s6(t,{fid:e}){return`${r1(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c_(t,e=!1){let n;const r=await zf(t.appConfig,i=>{if(!p1(i))throw Ao.create("not-registered");const a=i.authToken;if(!e&&a6(a))return i;if(a.requestStatus===1)return n=i6(t,e),i;{if(!navigator.onLine)throw Ao.create("app-offline");const l=c6(i);return n=o6(t,l),l}});return n?await n:r.authToken}async function i6(t,e){let n=await T0(t.appConfig);for(;n.authToken.requestStatus===1;)await l1(100),n=await T0(t.appConfig);const r=n.authToken;return r.requestStatus===0?c_(t,e):r}function T0(t){return zf(t,e=>{if(!p1(e))throw Ao.create("not-registered");const n=e.authToken;return u6(n)?{...e,authToken:{requestStatus:0}}:e})}async function o6(t,e){try{const n=await r6(t,e),r={...e,authToken:n};return await Oh(t.appConfig,r),n}catch(n){if(n1(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await h1(t.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Oh(t.appConfig,r)}throw n}}function p1(t){return t!==void 0&&t.registrationStatus===2}function a6(t){return t.requestStatus===2&&!l6(t)}function l6(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+O4}function c6(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}function u6(t){return t.requestStatus===1&&t.requestTime+ZN<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d6(t){const e=t,{installationEntry:n,registrationPromise:r}=await l_(e);return r?r.catch(console.error):c_(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h6(t,e=!1){const n=t;return await f6(n),(await c_(n,e)).token}async function f6(t){const{registrationPromise:e}=await l_(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p6(t){if(!t||!t.options)throw Kp("App Configuration");if(!t.name)throw Kp("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Kp(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function Kp(t){return Ao.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m1="installations",m6="installations-internal",g6=t=>{const e=t.getProvider("app").getImmediate(),n=p6(e),r=ji(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},y6=t=>{const e=t.getProvider("app").getImmediate(),n=ji(e,m1).getImmediate();return{getId:()=>d6(n),getToken:s=>h6(n,s)}};function v6(){Or(new _r(m1,g6,"PUBLIC")),Or(new _r(m6,y6,"PRIVATE"))}v6();Gn(JN,o_);Gn(JN,o_,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lh="analytics",_6="firebase_id",x6="origin",b6=60*1e3,w6="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",u_="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const On=new sf("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E6={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},rr=new Do("analytics","Analytics",E6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I6(t){if(!t.startsWith(u_)){const e=rr.create("invalid-gtag-resource",{gtagURL:t});return On.warn(e.message),""}return t}function g1(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function S6(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function T6(t,e){const n=S6("firebase-js-sdk-policy",{createScriptURL:I6}),r=document.createElement("script"),s=`${u_}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function C6(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function N6(t,e,n,r,s,i){const a=r[s];try{if(a)await e[a];else{const c=(await g1(n)).find(d=>d.measurementId===s);c&&await e[c.appId]}}catch(l){On.error(l)}t("config",s,i)}async function j6(t,e,n,r,s){try{let i=[];if(s&&s.send_to){let a=s.send_to;Array.isArray(a)||(a=[a]);const l=await g1(n);for(const c of a){const d=l.find(f=>f.measurementId===c),h=d&&e[d.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),t("event",r,s||{})}catch(i){On.error(i)}}function A6(t,e,n,r){async function s(i,...a){try{if(i==="event"){const[l,c]=a;await j6(t,e,n,l,c)}else if(i==="config"){const[l,c]=a;await N6(t,e,n,r,l,c)}else if(i==="consent"){const[l,c]=a;t("consent",l,c)}else if(i==="get"){const[l,c,d]=a;t("get",l,c,d)}else if(i==="set"){const[l]=a;t("set",l)}else t(i,...a)}catch(l){On.error(l)}}return s}function R6(t,e,n,r,s){let i=function(...a){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=A6(i,t,e,n),{gtagCore:i,wrappedGtag:window[s]}}function P6(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(u_)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k6=30,D6=1e3;class O6{constructor(e={},n=D6){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const y1=new O6;function L6(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function V6(t){var a;const{appId:e,apiKey:n}=t,r={method:"GET",headers:L6(n)},s=w6.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let l="";try{const c=await i.json();(a=c.error)!=null&&a.message&&(l=c.error.message)}catch{}throw rr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:l})}return i.json()}async function M6(t,e=y1,n){const{appId:r,apiKey:s,measurementId:i}=t.options;if(!r)throw rr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw rr.create("no-api-key")}const a=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new $6;return setTimeout(async()=>{l.abort()},b6),v1({appId:r,apiKey:s,measurementId:i},a,l,e)}async function v1(t,{throttleEndTimeMillis:e,backoffCount:n},r,s=y1){var l;const{appId:i,measurementId:a}=t;try{await F6(r,e)}catch(c){if(a)return On.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:a};throw c}try{const c=await V6(t);return s.deleteThrottleMetadata(i),c}catch(c){const d=c;if(!U6(d)){if(s.deleteThrottleMetadata(i),a)return On.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:i,measurementId:a};throw c}const h=Number((l=d==null?void 0:d.customData)==null?void 0:l.httpStatus)===503?hb(n,s.intervalMillis,k6):hb(n,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:n+1};return s.setThrottleMetadata(i,f),On.debug(`Calling attemptFetch again in ${h} millis`),v1(t,f,r,s)}}function F6(t,e){return new Promise((n,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(n,s);t.addEventListener(()=>{clearTimeout(i),r(rr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function U6(t){if(!(t instanceof xr)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class $6{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function B6(t,e,n,r,s){if(s&&s.global){t("event",n,r);return}else{const i=await e,a={...r,send_to:i};t("event",n,a)}}async function z6(t,e,n,r){if(r&&r.global){const s={};for(const i of Object.keys(n))s[`user_properties.${i}`]=n[i];return t("set",s),Promise.resolve()}else{const s=await e;t("config",s,{update:!0,user_properties:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q6(){if(zy())try{await LS()}catch(t){return On.warn(rr.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return On.warn(rr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function H6(t,e,n,r,s,i,a){const l=M6(t);l.then(m=>{n[m.measurementId]=m.appId,t.options.measurementId&&m.measurementId!==t.options.measurementId&&On.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>On.error(m)),e.push(l);const c=q6().then(m=>{if(m)return r.getId()}),[d,h]=await Promise.all([l,c]);P6(i)||T6(i,d.measurementId),s("js",new Date);const f=(a==null?void 0:a.config)??{};return f[x6]="firebase",f.update=!0,h!=null&&(f[_6]=h),s("config",d.measurementId,f),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W6{constructor(e){this.app=e}_delete(){return delete ka[this.app.options.appId],Promise.resolve()}}let ka={},C0=[];const N0={};let Qp="dataLayer",G6="gtag",j0,d_,A0=!1;function K6(){const t=[];if(kS()&&t.push("This is a browser extension environment."),QP()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,s)=>`(${s+1}) ${r}`).join(" "),n=rr.create("invalid-analytics-context",{errorInfo:e});On.warn(n.message)}}function Q6(t,e,n){K6();const r=t.options.appId;if(!r)throw rr.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)On.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw rr.create("no-api-key");if(ka[r]!=null)throw rr.create("already-exists",{id:r});if(!A0){C6(Qp);const{wrappedGtag:i,gtagCore:a}=R6(ka,C0,N0,Qp,G6);d_=i,j0=a,A0=!0}return ka[r]=H6(t,C0,N0,e,j0,Qp,n),new W6(t)}function Y6(t=of()){t=ht(t);const e=ji(t,Lh);return e.isInitialized()?e.getImmediate():X6(t)}function X6(t,e={}){const n=ji(t,Lh);if(n.isInitialized()){const s=n.getImmediate();if(Ss(e,n.getOptions()))return s;throw rr.create("already-initialized")}return n.initialize({options:e})}function J6(t,e,n){t=ht(t),z6(d_,ka[t.app.options.appId],e,n).catch(r=>On.error(r))}function Z6(t,e,n,r){t=ht(t),B6(d_,ka[t.app.options.appId],e,n,r).catch(s=>On.error(s))}const R0="@firebase/analytics",P0="0.10.19";function eU(){Or(new _r(Lh,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return Q6(r,s,n)},"PUBLIC")),Or(new _r("analytics-internal",t,"PRIVATE")),Gn(R0,P0),Gn(R0,P0,"esm2020");function t(e){try{const n=e.getProvider(Lh).getImmediate();return{logEvent:(r,s,i)=>Z6(n,r,s,i),setUserProperties:(r,s)=>J6(n,r,s)}}catch(n){throw rr.create("interop-component-reg-failed",{reason:n})}}}eU();const tU={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},qf=Hy(tU),Vh=wT(qf),J=EN(qf);Qi(qf);Y6(qf);const h_=(t,e="")=>{try{return localStorage.getItem(t)??e}catch{return e}},k0=()=>{var t;return((t=document.querySelector('meta[name="company-name"]'))==null?void 0:t.getAttribute("content"))||h_("empresa_nombre","OdontoCloud")},nU=()=>{var t;return((t=document.querySelector('meta[name="company-logo"]'))==null?void 0:t.getAttribute("content"))||h_("empresa_logo_url","")},D0=()=>{var t;return((t=document.querySelector('meta[name="software-footer"]'))==null?void 0:t.getAttribute("content"))||h_("software_footer_text","Generado por OdontoCloud")},sd=()=>{const t=new Date;return t.setHours(0,0,0,0),t},zs=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e},Yp=t=>{const e=new Date(t);return e.setHours(23,59,59,999),e},qr=(t,e)=>{const n=new Date(t);return n.setDate(n.getDate()+e),n},O0=t=>{const e=new Date(t),n=e.getDay(),r=(n===0?-6:1)-n;return e.setDate(e.getDate()+r),e.setHours(0,0,0,0),e},L0=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();var G0;const Yn=typeof navigator<"u"&&((G0=navigator.language)!=null&&G0.startsWith("es"))?"es-ES":"en-US",Xp=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`},Qo=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),rU=t=>{try{const e=new URLSearchParams(t||""),n=e.get("date")||e.get("day")||e.get("d")||e.get("fecha")||e.get("selectedDate")||(typeof sessionStorage<"u"?sessionStorage.getItem("agenda.targetDate"):""),r=String(n||"").slice(0,10);if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return null;const[s,i,a]=r.split("-").map(c=>parseInt(c,10));return new Date(s,(i||1)-1,a||1,0,0,0,0)}catch{return null}};function sU(){const t=Mn(),[e,n]=b.useState("day"),[r,s]=b.useState(sd()),[i,a]=b.useState(sd()),[l,c]=b.useState(!0),[d,h]=b.useState([]),[f,m]=b.useState(""),[x,T]=b.useState(""),[N,C]=b.useState(""),[S,E]=b.useState([]),[g,_]=b.useState([]),[O,L]=b.useState([]);b.useEffect(()=>{const q=qe(ue(J,"profesionales"),it("activo","==",!0)),pe=an(q,ve=>{E(ve.docs.map(K=>{const X=K.data()||{};return{id:K.id,nombre:X.nombre||X.nombres||X.nombreCompleto||K.id,especialidad:X.especialidad||X.especialidadNombre||"",activo:X.activo!==!1}}))},()=>E([])),xe=qe(ue(J,"consultorios"),it("activo","==",!0)),Y=an(xe,ve=>{_(ve.docs.map(K=>{const X=K.data()||{};return{id:K.id,nombre:X.nombre||X.descripcion||K.id,sucursalId:X.sucursalId||X.sedeId||"",sucursalNombre:X.sucursalNombre||X.sede||"",activo:X.activo!==!1}}))},()=>_([])),Z=qe(ue(J,"sucursales"),it("activo","==",!0)),Te=an(Z,ve=>{L(ve.docs.map(K=>{const X=K.data()||{};return{id:K.id,nombre:X.nombre||X.alias||K.id,activo:X.activo!==!1}}))},()=>L([]));return()=>{try{pe(),Y(),Te()}catch{}}},[]),b.useEffect(()=>{const q=rU(t.search);if(q){const pe=zs(q);s(pe),a(pe),n("day");try{sessionStorage.removeItem("agenda.targetDate")}catch{}}},[t.search]),b.useEffect(()=>{c(!0);const q=ue(J,"citas"),pe=qe(q,yt("fecha","asc")),xe=an(pe,Y=>{const Z=Y.docs.map(X=>{const B=X.data(),me=B.horaInicio||B.hora||"00:00",[Me="0",ze="0"]=me.split(":"),Fe=parseInt(Me,10)||0,Ke=parseInt(ze,10)||0;let we;if(B.fecha&&B.fecha.toDate)we=B.fecha.toDate(),we.setHours(Fe,Ke,0,0);else if(typeof B.fecha=="string"){const[xt,z,ie]=B.fecha.split("-");we=new Date(parseInt(xt,10),parseInt(z,10)-1,parseInt(ie,10),Fe,Ke,0,0)}else B.fecha instanceof Date?(we=new Date(B.fecha),we.setHours(Fe,Ke,0,0)):(we=new Date,we.setHours(Fe,Ke,0,0));const lt=B.documentoPaciente||B.docPaciente||B.pacienteDocumento||B.documento||"",Ze=B.celularPaciente||B.telefonoPaciente||B.celular||B.telefono||"";return{id:X.id,raw:B,fecha:we,horaInicio:me,paciente:B.paciente||B.pacienteNombre||"Sin nombre",doctor:B.doctor||B.doctorNombre||"",doctorId:B.doctorId||"",sucursal:B.sucursal||B.sucursalNombre||"",sucursalId:B.sucursalId||"",espacio:B.espacio||B.consultorio||B.consultorioNombre||"",consultorioId:B.consultorioId||"",comentario:B.comentario||"",estado:B.estado||"En espera",recordatorio:B.recordatorio||"",documento:lt,telefono:Ze}});let Te,ve;if(e==="day")Te=zs(r),ve=Yp(r);else if(e==="week"){const X=O0(r),B=qr(X,6);Te=zs(X),ve=Yp(B)}else{const X=zs(r),B=qr(X,-30),me=qr(X,60);Te=zs(B),ve=Yp(me)}const K=Z.filter(X=>X.fecha>=Te&&X.fecha<=ve);h(K),c(!1)},Y=>{console.error("Error leyendo citas:",Y),h([]),c(!1)});return()=>xe()},[e,r]);const v=b.useMemo(()=>{const q=O.map(xe=>xe.nombre).filter(Boolean);if(q.length)return q;const pe=new Set;return d.forEach(xe=>xe.sucursal&&pe.add(xe.sucursal)),Array.from(pe)},[d,O]),w=b.useMemo(()=>{const q=S.map(xe=>xe.nombre).filter(Boolean);if(q.length)return q;const pe=new Set;return d.forEach(xe=>xe.doctor&&pe.add(xe.doctor)),Array.from(pe)},[d,S]),I=b.useMemo(()=>{const q=N.trim().toLowerCase();return d.filter(pe=>{if(f&&pe.sucursal!==f||x&&pe.doctor!==x)return!1;if(!q)return!0;const xe=[pe.paciente,pe.doctor,pe.comentario,pe.documento,pe.sucursal,pe.espacio,pe.estado],Y=pe.raw?JSON.stringify(pe.raw):"";return[...xe,Y].filter(Boolean).some(Te=>String(Te).toLowerCase().includes(q))})},[d,f,x,N]),R=b.useMemo(()=>l?"Ocupacin: cargando...":I.length===0?"Ocupacin: sin citas para el rango seleccionado.":`Ocupacin: ${I.length} cita${I.length!==1?"s":""} en el rango actual.`,[I,l]),P=b.useMemo(()=>{const q=new Date(i.getFullYear(),i.getMonth(),1),pe=(q.getDay()+6)%7,xe=new Date(q);xe.setDate(xe.getDate()-pe);const Y=[];for(let Z=0;Z<6;Z++){const Te=[];for(let ve=0;ve<7;ve++){const K=new Date(xe),X=K.getMonth()===i.getMonth(),B=L0(K,sd()),me=L0(K,r);Te.push({date:K,isCurrentMonth:X,isToday:B,isSelected:me}),xe.setDate(xe.getDate()+1)}Y.push(Te)}return Y},[i,r]),V=()=>{const q=new Date(i);q.setMonth(q.getMonth()-1),a(q)},k=()=>{const q=new Date(i);q.setMonth(q.getMonth()+1),a(q)},M=q=>{s(zs(q)),a(zs(q)),n("day")},ge=b.useMemo(()=>i.toLocaleDateString(Yn,{month:"long",year:"numeric"}),[i]),oe=b.useMemo(()=>{if(e==="day")return r.toLocaleDateString(Yn,{weekday:"long",day:"2-digit",month:"long",year:"numeric"});if(e==="week"){const q=O0(r),pe=qr(q,6);return q.toLocaleDateString(Yn,{day:"2-digit",month:"short"})+" - "+pe.toLocaleDateString(Yn,{day:"2-digit",month:"short",year:"numeric"})}return"ltimas citas (detalle)"},[e,r]),Oe=()=>{s(e==="day"?qr(r,-1):e==="week"?qr(r,-7):qr(r,-1))},Q=()=>{s(e==="day"?qr(r,1):e==="week"?qr(r,7):qr(r,1))},le=()=>{const q=sd();s(q),a(q),n("day")},ce=()=>{var Ke;const q=we=>String(we??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),pe=k0(),xe=nU(),Y=D0(),Z=f||"",Te=x||"",ve=new Date;ve.setHours(0,0,0,0);const K=I.length===0?'<tr class="empty"><td colspan="10">No hay citas registradas para este rango.</td></tr>':I.map((we,lt)=>{var ee,ae,Pe,ke,Be,Ue;const Ze=we.fecha.toLocaleTimeString(Yn,{hour:"2-digit",minute:"2-digit",hour12:!0}),xt=we.documento||((ee=we.raw)==null?void 0:ee.documento)||((ae=we.raw)==null?void 0:ae.nroDocumento)||"",z=((Pe=we.raw)==null?void 0:Pe.celularPaciente)||((ke=we.raw)==null?void 0:ke.celular)||"",ie=((Be=we.raw)==null?void 0:Be.telefonoPaciente)||((Ue=we.raw)==null?void 0:Ue.telefono)||"",D=new Date(we.fecha.getFullYear(),we.fecha.getMonth(),we.fecha.getDate());let U="Futura";return D.getTime()===ve.getTime()?U="Hoy":D.getTime()<ve.getTime()&&(U="Pasada"),`<tr class="${lt%2?"zebra":""}">
                <td class="mono">${q(Ze)}</td>
                <td>${q(we.paciente)}</td>
                <td class="mono">${q(xt)}</td>
                <td class="mono">${q(z)}</td>
                <td class="mono">${q(ie)}</td>
                <td>${q(we.doctor)}</td>
                <td>${q(we.espacio)}</td>
                <td>${q(we.comentario)}</td>
                <td class="status">${q(we.estado)}</td>
                <td class="actual">${q(U)}</td>
              </tr>`}).join(""),B=`<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Agenda  ${q(pe)}</title>
  <style>
      @page { size: A4 portrait; margin: 14mm 16mm; }
      * { box-sizing: border-box; }
      html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      body { font-family: "Segoe UI", Roboto, Arial, sans-serif; color:#0f172a; line-height:1.35; }

      /* Cabecera */
      .hdr {
        display:flex; flex-direction:column; align-items:center; text-align:center;
        margin-bottom:14px;
      }
      .logo {
        max-height:120px; width:auto; max-width:100%; object-fit:contain;
        filter: drop-shadow(0 1px 0 rgba(0,0,0,.04));
      }
      .brand {
        margin-top:4px; font-weight:800; letter-spacing:.5px; text-transform:uppercase;
        font-size:26px; color:#0a86d8;
      }
      .sub { margin-top:2px; font-size:12px; color:#64748b; }

      /* Tarjeta info Sede/Doctor */
      .info-card {
        width:100%; display:flex; justify-content:center; margin:8px 0 16px;
      }
      .info {
        width:70%; border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; border-collapse:separate;
        font-size:12px;
      }
      .info-row { display:flex; border-top:1px solid #e5e7eb; }
      .info-row:first-child { border-top:0; }
      .label {
        width:22%; padding:8px 10px; background:#f8fafc; font-weight:600; color:#334155; border-right:1px solid #e5e7eb;
      }
      .value { flex:1; padding:8px 10px; }

      /* Tabla principal */
      table { width:100%; border-collapse:separate; border-spacing:0; font-size:12px; }
      thead th {
        background:#0f172a; color:#ffffff; text-align:center; font-weight:700;
        padding:9px 8px; position:relative;
      }
      thead th + th { box-shadow: inset 1px 0 0 rgba(255,255,255,.08); }
      tbody td {
        padding:8px 8px; vertical-align:top; border-bottom:1px solid #e5e7eb;
      }
      tbody tr.zebra td { background:#fafafa; }
      tbody tr.empty td {
        padding:16px; color:#6b7280; text-align:center; background:#fafafa;
        border:1px dashed #e5e7eb; border-radius:8px;
      }
      td.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
      td.status { white-space:nowrap; }
      td.actual { font-weight:600; }
      /* Bordes exteriores suaves */
      .tbl-wrap { border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; }

      /* Notas pie */
      .note { margin-top:10px; font-size:10px; color:#6b7280; }

      /* Evitar cortes feos */
      tr, .hdr, .info-card { page-break-inside: avoid; }
    </style>
</head>
<body>
  <div class="hdr">
    ${xe?`<img src="${xe}" alt="Logo" class="logo">`:""}
    <div class="brand">${q(pe)}</div>
    <div class="sub">Agenda de citas  ${q(oe)}</div>
  </div>

  <div class="info-card">
    <div class="info">
      <div class="info-row"><div class="label">Sede</div><div class="value">${q(Z)}</div></div>
      <div class="info-row"><div class="label">Doctor</div><div class="value">${q(Te)}</div></div>
    </div>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th style="width:9%">Hora</th>
          <th style="width:17%">Nombre paciente</th>
          <th style="width:12%">Documento</th>
          <th style="width:12%">Celular</th>
          <th style="width:12%">Telfono</th>
          <th style="width:10%">Doctor</th>
          <th style="width:11%">Espacio</th>
          <th>Comentario</th>
          <th style="width:9%">Estado</th>
          <th style="width:9%">Actualidad</th>
        </tr>
      </thead>
      <tbody>${K}</tbody>
    </table>
  </div>

  <div class="note">
    ${q(Y)}  ${q(new Date().toLocaleString(Yn))}
  </div>

  <script>
    window.addEventListener('load', function() {
      try { window.focus(); window.print(); } catch (e) {}
    });
  <\/script>
</body>
</html>`,me=new Blob([B],{type:"text/html;charset=utf-8"}),Me=URL.createObjectURL(me),ze=window.open(Me,"_blank","noopener,noreferrer,width=900,height=700");if(!ze){alert("El navegador bloque la ventana de impresin. Permite pop-ups para este sitio."),URL.revokeObjectURL(Me);return}const Fe=()=>{try{URL.revokeObjectURL(Me)}catch{}};(Ke=ze.addEventListener)==null||Ke.call(ze,"load",Fe),setTimeout(Fe,15e3)},_e=()=>alert("Funcin de confirmar citas se integrar con n8n / correo."),Ie=()=>le(),fe=()=>{if(I.length===0){alert("No hay citas para exportar.");return}const q=k0(),pe=D0(),xe=[`Empresa: ${q}`],Y=["Fecha","Hora","Paciente","Doctor","Espacio","Comentario"],Z=I.map(Me=>{const ze=Me.fecha.toLocaleDateString(Yn),Fe=Me.fecha.toLocaleTimeString(Yn,{hour:"2-digit",minute:"2-digit",hour12:!0});return[ze,Fe,Me.paciente||"",Me.doctor||"",Me.espacio||"",(Me.comentario||"").replace(/\r?\n/g," ")]}),Te=[pe],ve=[xe,[],Y,...Z,[],Te].map(Me=>(Me||[]).map(ze=>`"${String(ze??"").replace(/"/g,'""')}"`).join(",")).join(`
`),K=`citas_${q.toLowerCase().replace(/\s+/g,"_")}_${Xp(zs(r))}`+(e==="week"?"_semana":e==="detail"?"_detalle":"")+".csv",X=new Blob(["\uFEFF"+ve],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(X),me=document.createElement("a");me.href=B,me.download=K,me.click(),URL.revokeObjectURL(B)},ye=async(q,pe)=>{try{const xe=De(J,"citas",q);await Ut(xe,{estado:pe})}catch(xe){console.error("Error actualizando estado:",xe),alert("No se pudo actualizar el estado de la cita.")}},Le=(q,pe)=>{if(!q){alert("Este paciente no tiene celular registrado.");return}const xe=String(q).replace(/\D/g,""),Y=pe.fecha.toLocaleDateString(Yn),Z=pe.fecha.toLocaleTimeString(Yn,{hour:"numeric",minute:"2-digit",hour12:!0}),Te=encodeURIComponent(`Hola ${pe.paciente}, le recordamos su cita odontolgica el ${Y} a las ${Z}. Por favor confirme su asistencia.`),ve=`https://wa.me/${xe}?text=${Te}`;window.open(ve,"_blank")},We=async q=>{if(window.confirm(`Seguro que deseas eliminar la cita de ${q.paciente} del ${q.fecha.toLocaleDateString(Yn)}?`))try{const xe=De(J,"citas",q.id);await Tn(xe)}catch(xe){console.error("Error eliminando cita:",xe),alert(" No se pudo eliminar la cita.")}},Re=()=>{const q=document.createElement("div");Object.assign(q.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const pe=document.createElement("div");Object.assign(pe.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"}),pe.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Nueva Cita</h2>
      <form id="formNuevaCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label style="font-weight:600;">Paciente existente</label>
        <div style="position:relative;">
          <input type="text" id="buscarPaciente" placeholder="Buscar por nombre, apellido o documento..." autocomplete="off"/>
          <div id="acResultados" style="position:absolute;left:0;right:0;top:calc(100% + 6px);z-index:10000;display:none;background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 8px 22px rgba(0,0,0,.12);max-height:240px;overflow:auto;"></div>
        </div>
        <small style="color:gray;">Si el paciente no existe, marca Registrar nuevo paciente.</small>

        <label style="display:flex;align-items:center;gap:8px;margin-top:5px;">
          <input type="checkbox" id="esNuevoPaciente" />
          <span>Registrar nuevo paciente</span>
        </label>

        <div id="nuevoPacienteCampos" style="display:none;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border-radius:8px;background:#f9f9f9;border:1px solid #ddd;">
          <h4 style="margin:0;text-align:center;color:#0a86d8;">Datos del paciente</h4>
          <div style="display:flex;gap:8px;">
            <input type="text" id="npNombre" placeholder="Nombre" style="flex:1;" />
            <input type="text" id="npApellido" placeholder="Apellido" style="flex:1;" />
          </div>
          <select id="npTipoDocumento">
            <option value="">Tipo de documento</option>
            <option value="CC">Cdula de Ciudadana</option>
            <option value="CE">Cdula de Extranjera</option>
            <option value="TI">Tarjeta de Identidad</option>
            <option value="PA">Pasaporte</option>
            <option value="DI">Documento Internacional</option>
            <option value="OTRO">Otro</option>
          </select>
          <input type="text" id="npDocumento" placeholder="Nmero de documento" />
          <input type="email" id="npCorreo" placeholder="Correo electrnico" />
          <div style="display:flex;gap:5px;">
            <select id="npIndicativo" style="width:40%;">
              <option value="+57"> +57</option>
              <option value="+1"> +1</option>
              <option value="+34"> +34</option>
              <option value="+52"> +52</option>
              <option value="+54"> +54</option>
              <option value="+593"> +593</option>
              <option value="+56"> +56</option>
              <option value="+58"> +58</option>
            </select>
            <input type="tel" id="npCelular" placeholder="Celular (obligatorio)" style="flex:1;" />
          </div>
          <input type="tel" id="npTelefono" placeholder="Telfono fijo (opcional)" />
          <label style="font-weight:500;">Fecha de nacimiento:</label>
          <input type="date" id="npNacimiento" />
          <select id="npSexo">
            <option value="">Sexo</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
            <option value="Otro">Otro</option>
          </select>
          <textarea id="npComentario" placeholder="Comentario o antecedentes del paciente" rows="2"></textarea>
        </div>

        <hr style="margin:10px 0;border:none;border-top:1px solid #ddd;" />
        <h4 style="margin:0;text-align:center;color:#0a86d8;">Detalles de la cita</h4>

        <!--  Catlogos -->
        <label>Doctor asignado</label>
        <select id="ncDoctorSel" required>
          <option value="">Seleccione doctor</option>
        </select>

        <label>Fecha</label>
        <input type="date" id="ncFecha" required value="${Xp(r)}" />

        <label>Hora</label>
        <input type="time" id="ncHora" required />

        <label>Espacio fsico / Consultorio</label>
        <select id="ncConsultorioSel">
          <option value="">Seleccione consultorio</option>
        </select>

        <label>Sucursal</label>
        <select id="ncSucursalSel">
          <option value="">Seleccione sucursal</option>
        </select>

        <label>Comentario</label>
        <textarea id="ncComentario" placeholder="Comentario sobre la cita" rows="3"></textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarModal" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    `;const xe=document.createElement("style");xe.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      input, select, textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      input:focus, select:focus, textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
      .ac-item { padding: 8px 10px; display:flex; gap:8px; align-items:baseline; cursor:pointer; }
      .ac-item:hover, .ac-item.active { background:#f5f7fb; }
      .ac-name { font-weight:600; } .ac-doc { color:#64748b; font-size:12px; } .ac-tel { margin-left:auto; font-size:12px; color:#0f172a; }
      .ac-empty { padding:10px; color:#9aa4b2; font-size:13px; }
    `,document.head.appendChild(xe),q.appendChild(pe),document.body.appendChild(q);const Y=pe.querySelector("#esNuevoPaciente"),Z=pe.querySelector("#nuevoPacienteCampos"),Te=pe.querySelector("#buscarPaciente"),ve=pe.querySelector("#acResultados"),K=pe.querySelector("#ncDoctorSel"),X=pe.querySelector("#ncConsultorioSel"),B=pe.querySelector("#ncSucursalSel"),me=(D,U,ee)=>{const ae=document.createElement("option");ae.value=U,ae.textContent=ee,D.appendChild(ae)};(S||[]).forEach(D=>{const U=D.especialidad?`${D.nombre}  ${D.especialidad}`:D.nombre;me(K,D.id,U)}),(g||[]).forEach(D=>{const U=D.sucursalNombre?`${D.nombre}  ${D.sucursalNombre}`:D.nombre;me(X,D.id,U)}),(O||[]).forEach(D=>me(B,D.id,D.nombre)),Y.addEventListener("change",()=>{Z.style.display=Y.checked?"flex":"none",Y.checked&&(ve.style.display="none")}),pe.querySelector("#btnCancelarModal").addEventListener("click",()=>q.remove());let Me=null,ze=null,Fe=-1,Ke=[];const we=D=>{if(Ke=D||[],Fe=-1,!D||D.length===0){ve.innerHTML='<div class="ac-empty">Sin resultados</div>',ve.style.display="block";return}ve.innerHTML=D.map((U,ee)=>`
            <div class="ac-item" data-index="${ee}" data-id="${U.id}">
              <span class="ac-name">${U.nombre}</span>
              <span class="ac-doc"> ${U.documento||"s/doc"}</span>
              <span class="ac-tel">${U.celular||U.telefono||""}</span>
            </div>`).join(""),ve.style.display="block",[...ve.querySelectorAll(".ac-item")].forEach(U=>{U.addEventListener("click",()=>{const ee=Number(U.getAttribute("data-index"));lt(ee)})})},lt=D=>{const U=Ke[D];U&&(ze=U,Te.value=U.nombre,ve.style.display="none",Y.checked=!1,Z.style.display="none")},Ze=D=>{Ke.length&&(Fe=(Fe+D+Ke.length)%Ke.length,[...ve.querySelectorAll(".ac-item")].forEach((U,ee)=>{ee===Fe?U.classList.add("active"):U.classList.remove("active")}))},xt=(D,U)=>D.nombreCompleto||D.paciente||[D.nombres,D.apellidos].filter(Boolean).join(" ")||U,z=async D=>{const U=(D||"").toString().trim(),ee=Qo(U);if(!ee||ee.length<2)return[];if(/^\d{5,}$/.test(U))try{const ae=qe(ue(J,"pacientes"),it("documento","==",U)),Pe=qe(ue(J,"pacientes"),it("nroDocumento","==",U)),[ke,Be]=await Promise.all([Ae(ae),Ae(Pe)]),Ue=ke.empty?Be:ke;if(!Ue.empty)return Ue.docs.slice(0,10).map(rt=>{const dt=rt.data()||{};return{id:rt.id,nombre:xt(dt,rt.id),documento:dt.documento||dt.nroDocumento||rt.id,celular:dt.celularPaciente||dt.celular||"",telefono:dt.telefonoPaciente||dt.telefono||""}})}catch{}try{const ae=qe(ue(J,"pacientes"),yt("nombre_busqueda"),l0(ee),c0(ee+""),Pa(10)),Pe=await Ae(ae);if(!Pe.empty)return Pe.docs.map(ke=>{const Be=ke.data()||{};return{id:ke.id,nombre:xt(Be,ke.id),documento:Be.documento||Be.nroDocumento||ke.id,celular:Be.celularPaciente||Be.celular||"",telefono:Be.telefonoPaciente||Be.telefono||""}})}catch{}try{const ae=qe(ue(J,"pacientes"),yt("creado","desc"),Pa(50));return(await Ae(ae)).docs.map(Ue=>({id:Ue.id,...Ue.data()||{}})).map(Ue=>({id:Ue.id,nombre:xt(Ue,Ue.id),documento:Ue.documento||Ue.nroDocumento||Ue.id,celular:Ue.celularPaciente||Ue.celular||"",telefono:Ue.telefonoPaciente||Ue.telefono||"",_norm:Qo(`${Ue.nombreCompleto||Ue.paciente||""} ${Ue.nombres||""} ${Ue.apellidos||""} ${Ue.documento||Ue.nroDocumento||""}`)})).filter(Ue=>Ue._norm.includes(ee)).slice(0,10).map(({_norm:Ue,...rt})=>rt)}catch{}return[]};Te.addEventListener("input",()=>{ze=null;const D=Te.value;if(clearTimeout(Me),!D||D.trim().length<2){ve.style.display="none";return}Me=setTimeout(async()=>{const U=await z(D.trim());we(U)},220)}),Te.addEventListener("keydown",D=>{ve.style.display==="block"&&(D.key==="ArrowDown"?(D.preventDefault(),Ze(1)):D.key==="ArrowUp"?(D.preventDefault(),Ze(-1)):D.key==="Enter"?Fe>=0&&(D.preventDefault(),lt(Fe)):D.key==="Escape"&&(ve.style.display="none"))}),document.addEventListener("click",D=>{pe.contains(D.target)&&!ve.contains(D.target)&&D.target!==Te&&(ve.style.display="none")},{capture:!0});const ie=pe.querySelector("#formNuevaCita");ie.addEventListener("submit",async D=>{D.preventDefault();const U=Y.checked,ee=(ie.querySelector("#buscarPaciente").value||"").trim(),ae=K.value,Pe=ie.querySelector("#ncFecha").value,ke=ie.querySelector("#ncHora").value,Be=X.value,Ue=B.value,rt=(ie.querySelector("#ncComentario").value||"").trim();if(!Pe||!ke){alert(" Debes seleccionar fecha y hora para la cita.");return}if(!ae){alert(" Indica el doctor asignado.");return}const dt=(S||[]).find(ut=>ut.id===ae),Lt=(dt==null?void 0:dt.nombre)||"";let Qe="",Kn="";if(Be){const ut=(g||[]).find(cn=>cn.id===Be);Qe=(ut==null?void 0:ut.nombre)||"",Kn=(ut==null?void 0:ut.sucursalNombre)||""}let Ht="";if(Ue){const ut=(O||[]).find(cn=>cn.id===Ue);Ht=(ut==null?void 0:ut.nombre)||""}!Ue&&Kn&&(Ht=Kn);try{let ut=null,cn=null,mn="",gn="",br="";if(U){const j=(ie.querySelector("#npNombre").value||"").trim(),W=(ie.querySelector("#npApellido").value||"").trim();if(mn=`${j} ${W}`.trim(),!mn){alert(" Debes indicar nombre y apellido para el nuevo paciente.");return}const ne=(ie.querySelector("#npDocumento").value||"").trim(),be=(ie.querySelector("#npCelular").value||"").trim(),Ce=(ie.querySelector("#npTelefono").value||"").trim();if(!be&&!Ce){alert(" Debes registrar al menos un telfono (celular o fijo) del paciente o de un acudiente.");return}if(ut=ne||mn.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"_"),cn=De(J,"pacientes",ut),!(await Co(cn)).exists()){const bt=Qo(mn);await No(cn,{nombres:j,apellidos:W,nombreCompleto:mn,paciente:mn,nombre_busqueda:bt,variantes_busqueda:[bt,Qo(j),Qo(W)],tipoDocumento:ie.querySelector("#npTipoDocumento").value,documento:ne,correo:(ie.querySelector("#npCorreo").value||"").trim(),indicativo:ie.querySelector("#npIndicativo").value,celular:be,telefono:Ce,celularPaciente:be,telefonoPaciente:Ce,fechaNacimiento:ie.querySelector("#npNacimiento").value,sexo:ie.querySelector("#npSexo").value,notas:(ie.querySelector("#npComentario").value||"").trim(),creado:new Date().toISOString(),activo:!0,citas:[]},{merge:!0})}gn=be,br=Ce}else if(ze)ut=ze.id,mn=ze.nombre,cn=De(J,"pacientes",ut),gn=ze.celular||"",br=ze.telefono||"";else{if(!ee){alert(" Por favor, escribe o selecciona un paciente.");return}const j=qe(ue(J,"pacientes"),it("documento","==",ee)),W=qe(ue(J,"pacientes"),it("nroDocumento","==",ee)),[ne,be]=await Promise.all([Ae(j),Ae(W)]),Ce=ne.empty?be:ne;if(Ce.empty){let Ge=null;try{const bt=Qo(ee),Fn=qe(ue(J,"pacientes"),yt("nombre_busqueda"),l0(bt),c0(bt+""),Pa(1)),Nn=await Ae(Fn);if(!Nn.empty){const St=Nn.docs[0],At=St.data()||{};Ge={id:St.id,ref:St.ref,nombre:At.nombreCompleto||At.paciente||[At.nombres,At.apellidos].filter(Boolean).join(" "),cel:At.celularPaciente||At.celular||"",tel:At.telefonoPaciente||At.telefono||""}}}catch{}Ge?(ut=Ge.id,cn=Ge.ref,mn=Ge.nombre||ee,gn=Ge.cel||"",br=Ge.tel||""):mn=ee}else{const Ge=Ce.docs[0],bt=Ge.data()||{};ut=Ge.id,cn=Ge.ref,mn=bt.nombreCompleto||bt.paciente||[bt.nombres,bt.apellidos].filter(Boolean).join(" ")||ee,gn=bt.celularPaciente||bt.celular||"",br=bt.telefonoPaciente||bt.telefono||""}}if(!(gn||br||"").trim()){alert(" Este paciente no tiene ningn telfono registrado. Edita sus datos y agrega un nmero antes de guardar la cita.");return}const os={paciente:mn||"Paciente",pacienteId:ut||null,doctorId:ae,doctor:Lt||"Doctor",consultorioId:Be||"",consultorioNombre:Qe||"",sucursalId:Ue||"",sucursal:Ht||"",espacio:Qe||"",fecha:Pe,horaInicio:ke,comentario:rt,estado:"En espera",creado:new Date().toISOString(),celularPaciente:gn||"",telefonoPaciente:br||""},Di=await Bt(ue(J,"citas"),os);cn&&await No(cn,{citas:fF(Di.id)},{merge:!0}),alert(" Cita registrada correctamente y vinculada al paciente."),q.remove()}catch(ut){console.error(" Error al guardar cita:",ut),alert(" Error al guardar la cita. Revisa la consola para ms detalles.")}})},Je=q=>{var K,X;const pe=document.createElement("div");Object.assign(pe.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const xe=document.createElement("div");Object.assign(xe.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"});const Y=(K=q.raw)!=null&&K.fecha&&typeof q.raw.fecha=="string"?q.raw.fecha:Xp(q.fecha),Z=((X=q.raw)==null?void 0:X.horaInicio)||q.fecha.toTimeString().slice(0,5);xe.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Editar Cita</h2>
      <form id="formEditarCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label>Paciente</label>
        <input type="text" id="editPaciente" value="${q.paciente||""}" />

        <label>Doctor asignado</label>
        <input type="text" id="editDoctor" value="${q.doctor||""}" />

        <div style="display:flex;gap:8px;">
          <div style="flex:1;">
            <label>Fecha</label>
            <input type="date" id="editFecha" value="${Y}" />
          </div>
          <div style="flex:1;">
            <label>Hora</label>
            <input type="time" id="editHora" value="${Z}" />
          </div>
        </div>

        <label>Espacio fsico / Sala</label>
        <input type="text" id="editEspacio" value="${q.espacio||""}" />

        <label>Estado</label>
        <select id="editEstado" class="estado-select">
          <option value="En espera" ${q.estado==="En espera"?"selected":""}>En espera</option>
          <option value="En sala" ${q.estado==="En sala"?"selected":""}>En sala</option>
          <option value="Atendiendo" ${q.estado==="Atendiendo"?"selected":""}>Atendiendo</option>
          <option value="Finalizada" ${q.estado==="Finalizada"?"selected":""}>Finalizada</option>
          <option value="pendiente" ${q.estado==="pendiente"?"selected":""}>Pendiente</option>
          <option value="No asisti" ${q.estado==="No asisti"?"selected":""}>No asisti</option>
        </select>

        <label>Comentario</label>
        <textarea id="editComentario" rows="3">${q.comentario||""}</textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarEdit" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar cambios</button>
        </div>
      </form>
    `;const Te=document.createElement("style");Te.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      #formEditarCita input, #formEditarCita select, #formEditarCita textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      #formEditarCita input:focus, #formEditarCita select:focus, #formEditarCita textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
    `,document.head.appendChild(Te),pe.appendChild(xe),document.body.appendChild(pe),xe.querySelector("#btnCancelarEdit").addEventListener("click",()=>pe.remove());const ve=xe.querySelector("#formEditarCita");ve.addEventListener("submit",async B=>{B.preventDefault();const me=ve.querySelector("#editPaciente").value.trim(),Me=ve.querySelector("#editDoctor").value.trim(),ze=ve.querySelector("#editFecha").value,Fe=ve.querySelector("#editHora").value,Ke=ve.querySelector("#editEspacio").value.trim(),we=ve.querySelector("#editEstado").value,lt=ve.querySelector("#editComentario").value.trim();if(!me)return alert(" El nombre del paciente es obligatorio.");if(!ze||!Fe)return alert(" Debes indicar fecha y hora.");try{const Ze=De(J,"citas",q.id);await Ut(Ze,{paciente:me,doctor:Me,fecha:ze,horaInicio:Fe,espacio:Ke,estado:we,comentario:lt}),alert(" Cita actualizada correctamente."),pe.remove()}catch(Ze){console.error(" Error al actualizar cita:",Ze),alert(" Error al actualizar la cita. Revisa la consola para ms detalles.")}})},gt=q=>{const pe=q.fecha.toLocaleDateString(Yn),xe=q.fecha.toLocaleTimeString(Yn,{hour:"numeric",minute:"2-digit",hour12:!0}),Y=`${pe}  ${xe}`;return o.jsxs("tr",{className:"fade-in-row",onClick:()=>Je(q),style:{cursor:"pointer"},children:[o.jsx("td",{children:Y}),o.jsx("td",{children:q.paciente}),o.jsx("td",{children:q.doctor}),o.jsx("td",{children:q.espacio}),o.jsx("td",{children:q.comentario}),o.jsx("td",{onClick:Z=>{Z.stopPropagation()},children:o.jsxs("select",{className:"estado-select",value:q.estado,onChange:Z=>ye(q.id,Z.target.value),children:[o.jsx("option",{value:"En espera",children:"En espera"}),o.jsx("option",{value:"En sala",children:"En sala"}),o.jsx("option",{value:"Atendiendo",children:"Atendiendo"}),o.jsx("option",{value:"Finalizada",children:"Finalizada"}),o.jsx("option",{value:"pendiente",children:"Pendiente"}),o.jsx("option",{value:"No asisti",children:"No asisti"})]})}),o.jsxs("td",{className:"acciones-cell",onClick:Z=>{Z.stopPropagation()},children:[q.telefono?o.jsx("button",{type:"button",className:"btn-whatsapp",onClick:Z=>{Z.stopPropagation(),Le(q.telefono,q)},children:"WhatsApp"}):o.jsx("span",{className:"acciones-texto",children:"Sin celular"}),o.jsx("button",{type:"button",className:"btn-delete",onClick:Z=>{Z.stopPropagation(),We(q)},children:"Eliminar"}),q.recordatorio&&o.jsx("span",{className:"acciones-texto",children:q.recordatorio})]})]},q.id)};return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"odc-topbar-green"}),o.jsx("div",{className:"odc-topbar-blue",children:"Agenda"}),o.jsx("section",{className:"odc-agenda-root",children:o.jsxs("div",{className:"odc-agenda-inner",children:[o.jsxs("aside",{className:"odc-left","aria-label":"Panel izquierdo - calendario y filtros",children:[o.jsxs("div",{className:"odc-mini-calendar-card",role:"region","aria-label":"Mini calendario",children:[o.jsxs("div",{className:"mini-cal-header",children:[o.jsx("button",{className:"cal-arrow",id:"miniCalPrev","aria-label":"Mes anterior",onClick:V,children:""}),o.jsx("div",{id:"miniCalMonthYear","aria-live":"polite",children:ge}),o.jsx("button",{className:"cal-arrow",id:"miniCalNext","aria-label":"Mes siguiente",onClick:k,children:""})]}),o.jsxs("table",{className:"mini-month-table","aria-hidden":"false",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Lu"}),o.jsx("th",{children:"Ma"}),o.jsx("th",{children:"Mi"}),o.jsx("th",{children:"Ju"}),o.jsx("th",{children:"Vi"}),o.jsx("th",{children:"Sa"}),o.jsx("th",{children:"Do"})]})}),o.jsx("tbody",{id:"miniCalendar",children:P.map((q,pe)=>o.jsx("tr",{children:q.map((xe,Y)=>o.jsx("td",{className:[xe.isCurrentMonth?"":"empty",xe.isToday?"today":"",xe.isSelected?"selected":""].filter(Boolean).join(" "),onClick:()=>xe.isCurrentMonth&&M(xe.date),children:xe.date.getDate()},Y))},pe))})]})]}),o.jsxs("div",{className:"odc-filters-card","aria-label":"Filtros de agenda",children:[o.jsx("label",{htmlFor:"filterSucursal",children:"Sucursal"}),o.jsxs("select",{id:"filterSucursal",value:f,onChange:q=>m(q.target.value),children:[o.jsx("option",{value:"",children:" Todas "}),v.map(q=>o.jsx("option",{value:q,children:q},q))]}),o.jsx("label",{htmlFor:"filterDoctor",children:"Doctores"}),o.jsxs("select",{id:"filterDoctor",value:x,onChange:q=>T(q.target.value),children:[o.jsx("option",{value:"",children:" Todos "}),w.map(q=>o.jsx("option",{value:q,children:q},q))]})]})]}),o.jsxs("main",{className:"odc-right","aria-label":"Panel principal - agenda",children:[o.jsxs("div",{className:"odc-header-bar",role:"region","aria-label":"Controles de la agenda",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[o.jsxs("div",{className:"odc-header-left",style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[o.jsx("h3",{className:"odc-title",style:{marginRight:8},children:"Agenda"}),o.jsxs("div",{className:"view-buttons",role:"tablist","aria-label":"Vistas",style:{display:"flex",gap:6},children:[o.jsx("button",{className:`btn view ${e==="day"?"active":""}`,"data-view":"day",role:"tab","aria-selected":e==="day",onClick:()=>n("day"),children:"Da"}),o.jsx("button",{className:`btn view ${e==="week"?"active":""}`,"data-view":"week",role:"tab","aria-selected":e==="week",onClick:()=>n("week"),children:"Semana"}),o.jsx("button",{className:`btn view ${e==="detail"?"active":""}`,"data-view":"detail",role:"tab","aria-selected":e==="detail",onClick:()=>n("detail"),children:"Detalle"})]}),o.jsxs("div",{className:"date-nav",style:{display:"flex",alignItems:"center",gap:6,flex:"0 0 auto"},children:[o.jsx("button",{className:"btn icon",id:"btnPrev","aria-label":"Anterior",onClick:Oe,children:""}),o.jsx("button",{className:"btn icon",id:"btnNext","aria-label":"Siguiente",onClick:Q,children:""}),o.jsx("span",{id:"currentDateDisplay",className:"current-date","aria-live":"polite",style:{whiteSpace:"nowrap"},children:oe}),o.jsx("button",{id:"btnHoy",className:"btn small",onClick:le,children:"Hoy"})]})]}),o.jsx("div",{className:"odc-header-right",style:{display:"flex",alignItems:"center",gap:8,flexShrink:0},children:o.jsxs("div",{className:"right-actions",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{id:"searchCitas",placeholder:"Buscar...",className:"search-input","aria-label":"Buscar citas",value:N,onChange:q=>C(q.target.value)}),o.jsx("button",{id:"btnNuevaCita",className:"btn green","aria-label":"Nueva cita",onClick:Re,children:"+ Nueva cita"})]})})]}),o.jsxs("div",{className:"odc-content-card",role:"region","aria-label":"Contenido agenda",children:[o.jsxs("div",{className:"tools-row",children:[o.jsx("div",{className:"tools-left",children:o.jsx("div",{id:"ocupacionInfo",className:"ocupacion-info",children:R})}),o.jsxs("div",{className:"tools-right",children:[o.jsx("button",{id:"btnPrint",className:"btn",title:"Imprimir agenda",onClick:ce,children:" Imprimir"}),o.jsx("button",{id:"btnConfirmar",className:"btn blue",title:"Confirmar citas",onClick:_e,children:" Confirmar"}),o.jsx("button",{id:"btnHoyCitas",className:"btn",title:"Ver citas de hoy",onClick:Ie,children:" Hoy"}),o.jsx("button",{id:"btnExportar",className:"btn",title:"Exportar citas a CSV",onClick:fe,children:" Exportar"})]})]}),o.jsx("div",{className:"table-wrap",role:"region","aria-label":"Lista de citas",children:o.jsxs("table",{className:"appointments-table","aria-live":"polite",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:"180px"},children:"Fecha / Hora"}),o.jsx("th",{children:"Paciente"}),o.jsx("th",{children:"Doctor"}),o.jsx("th",{children:"Espacio fsico"}),o.jsx("th",{children:"Comentario"}),o.jsx("th",{style:{width:"120px"},children:"Estado"}),o.jsx("th",{children:"Acciones"})]})}),o.jsx("tbody",{id:"citasTbody",children:l?o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"no-data",children:"Cargando citas..."})}):I.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"no-data",children:"No hay citas registradas para este rango."})}):I.map(gt)})]})})]})]})]})})]})}function iU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function oU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function aU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}const id={caja:"caja",pagos:"facturacion/pagos",facturas:"facturacion/facturas"};var K0;const Zl=typeof navigator<"u"&&((K0=navigator.language)!=null&&K0.startsWith("es"))?"es-ES":"en-US",lU=["Colombia","Argentina","Bolivia","Chile","Costa Rica","Cuba","Ecuador","El Salvador","Espaa","Guatemala","Honduras","Mxico","Nicaragua","Panam","Paraguay","Per","Puerto Rico","Repblica Dominicana","Uruguay","Venezuela","Estados Unidos","Canad"],Jp={Colombia:["Bogot","Medelln","Cali","Barranquilla","Cartagena","Ccuta","Bucaramanga","Pereira","Santa Marta","Ibagu"],Mxico:["Ciudad de Mxico","Guadalajara","Monterrey","Puebla","Quertaro","Tijuana","Mrida","Len"],Per:["Lima","Arequipa","Trujillo","Chiclayo","Cusco","Piura"],Chile:["Santiago","Valparaso","Concepcin","La Serena","Antofagasta"],Argentina:["Buenos Aires","Crdoba","Rosario","Mendoza","La Plata"],Espaa:["Madrid","Barcelona","Valencia","Sevilla","Zaragoza","Bilbao"],"Estados Unidos":["Miami","New York","Los ngeles","Houston","Chicago"],Ecuador:["Quito","Guayaquil","Cuenca","Manta"],Venezuela:["Caracas","Maracaibo","Valencia","Barquisimeto","Maracay"]},cU=t=>{if(!t)return"";const[e,n,r]=t.split("-").map(c=>parseInt(c,10)),s=new Date(e,(n||1)-1,r||1),i=new Date;let a=i.getFullYear()-s.getFullYear();const l=i.getMonth()-s.getMonth();return(l<0||l===0&&i.getDate()<s.getDate())&&a--,isNaN(a)?"":String(a)};async function V0(t,{maxW:e=900,maxH:n=900,quality:r=.82}={}){var m;if(!t||!((m=t.type)!=null&&m.startsWith("image/")))return t;const s=await new Promise((x,T)=>{const N=new Image;N.onload=()=>x(N),N.onerror=T,N.src=URL.createObjectURL(t)});let{width:i,height:a}=s;const l=Math.min(e/i,n/a,1);i=Math.round(i*l),a=Math.round(a*l);const c=document.createElement("canvas");c.width=i,c.height=a,c.getContext("2d").drawImage(s,0,0,i,a);const h=await new Promise(x=>c.toBlob(x,"image/jpeg",r)),f=new File([h],(t.name||"foto.jpg").replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return URL.revokeObjectURL(s.src),f}const ec=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),uU=t=>ec([t.nombres,t.apellidos,t.nombreCompleto,t.nroDocumento,t.celular,t.email].filter(Boolean).join(" ")),dU=t=>{if(!t)return"";const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${n}-${r}-${s}T${i}:${a}`},hU=t=>{try{return new Date(t).toLocaleString(Zl,{dateStyle:"medium",timeStyle:"short"})}catch{return""}},Yo={tipoDocumento:"",nroDocumento:"",nroHistoria:"",nombres:"",apellidos:"",nombreCompleto:"",sexo:"",estadoCivil:"",paisNacimiento:"",ciudadNacimiento:"",fechaIngreso:"",fechaNacimiento:"",edad:"",paisDomicilio:"",ciudadDomicilio:"",barrio:"",lugarResidencia:"",estrato:"",zonaResidencial:"",esExtranjero:!1,permitePublicidad:!1,celular:"",telDomicilio:"",telOficina:"",extension:"",email:"",ocupacion:"",nombreResponsable:"",parentesco:"",celularResponsable:"",telefonoResponsable:"",emailResponsable:"",nombreAcompanante:"",telefonoAcompanante:"",convenioBeneficio:"",comoConocio:"",campania:"",remitidoPor:"",asesorComercial:"",tipoVinculacion:"",nombreEps:"",polizaSalud:"",doctor:"",notas:"",rxImagenes:[],historiaClinica:{antecedentes:"",alergias:"",medicamentos:"",motivoConsulta:"",notas:""},odontograma:[],periodontograma:[],presupuestos:[],evoluciones:[],facturacion:{saldoFavor:0,saldoCredito:0},fotoUrl:"",activo:!0},Zp=20,Xo=t=>Number(t||0);function fU(t){const[e,n]=b.useState(!1),[r,s]=b.useState([]),[i,a]=b.useState([]),[l,c]=b.useState("");b.useEffect(()=>{let C=!0;return(async()=>{if(!t){s([]),a([]);return}n(!0),c("");try{let E=qe(ue(J,"facturas"),it("patientId","==",t),yt("fechaISO","desc"));const O=(await Ae(E)).docs.map(R=>({id:R.id,...R.data()})).map(R=>({...R,total:Xo(R.total??R.valor??R.montoTotal),estado:(R.estado||"pendiente").toLowerCase(),fechaISO:R.fechaISO||R.fecha||null}));let L=qe(ue(J,"pagos"),it("patientId","==",t),yt("fechaISO","desc"));const I=(await Ae(L)).docs.map(R=>({id:R.id,...R.data()})).map(R=>({...R,monto:Xo(R.monto??R.valor??R.total),fechaISO:R.fechaISO||R.fecha||null,medio:R.medio||R.metodo||""}));if(!C)return;s(O),a(I)}catch(E){console.warn("Finanzas: no se pudo leer colecciones. Contino solo con saldos del paciente.",E),C&&c("No se pudieron leer facturas/pagos.")}finally{C&&n(!1)}})(),()=>{C=!1}},[t]);const d=r.reduce((C,S)=>C+Xo(S.total),0),h=i.reduce((C,S)=>C+Xo(S.monto),0),f=r.filter(C=>["pagada","pagado","paid"].includes((C.estado||"").toLowerCase())),m=r.filter(C=>["pendiente","abierta","open","deuda"].includes((C.estado||"").toLowerCase())),x=f.reduce((C,S)=>C+Xo(S.total),0),T=m.reduce((C,S)=>C+Xo(S.total),0);return{loading:e,error:l,facturas:r,pagos:i,totalFacturado:d,totalPagado:h,totalFacturasPendientes:T,totalFacturasPagadas:x}}function pU(t){const[e,n]=b.useState(!1),[r,s]=b.useState([]);return b.useEffect(()=>{if(!t){s([]);return}n(!0);const i=ue(J,"citas"),a=x=>{const T=x.data()||{},N=typeof T.fecha=="string"?T.fecha:"",C=(T.horaInicio||T.hora||"00:00").slice(0,5);let S=null;if(N){const[E,g,_]=N.split("-").map(w=>parseInt(w,10)),[O,L]=C.split(":").map(w=>parseInt(w,10)||0);S=new Date(E,(g||1)-1,_||1,O,L,0,0).toISOString()}return{id:x.id,...T,fechaISO:S,motivo:T.motivo||T.comentario||"",profesional:T.doctor||T.doctorNombre||"",fechaYYYYMMDD:N}};let l=new Map;const c=()=>{const x=Array.from(l.values());x.sort((T,N)=>{const C=T.fechaISO||"",S=N.fechaISO||"";if(C<S)return 1;if(C>S)return-1;const E=T.creado||"",g=N.creado||"";return E<g?1:E>g?-1:0}),s(x),n(!1)},d=qe(i,it("pacienteId","==",t)),h=qe(i,it("patientId","==",t)),f=an(d,x=>{x.docChanges().forEach(T=>{T.type==="removed"?l.delete(T.doc.id):l.set(T.doc.id,a(T.doc))}),c()},()=>n(!1)),m=an(h,x=>{x.docChanges().forEach(T=>{T.type==="removed"?l.delete(T.doc.id):l.set(T.doc.id,a(T.doc))}),c()},()=>n(!1));return()=>{try{f()}catch{}try{m()}catch{}}},[t]),{loading:e,citas:r}}function mU(){var Ht,ut,cn,mn,gn,br,pl,os,Di;const t=is(),e=Mn(),n=Fh.useMemo(()=>{const j=e.pathname.split("/").filter(Boolean),W=j.findIndex(Ce=>["pacientes","agenda","caja","facturacion","config","reportes","software"].includes(Ce)),be="/"+j.slice(0,W>=0?W:j.length).join("/");return be==="/"?"":be},[e.pathname]),r=j=>{const W=String(j||"").replace(/^\//,""),ne=n?`${n}/`:"/";t(`${ne}${W}`)},s=(j,W)=>{const ne=String(j).replace(/^\//,""),be=W?new URLSearchParams(W).toString():"";return`${n?`${n}/`:"/"}${ne}${be?`?${be}`:""}`},i=(j,W)=>{const ne=String(j||"").slice(0,10);if(!ne)return r("agenda");try{sessionStorage.setItem("agenda.targetDate",ne)}catch{}const be=new URLSearchParams({date:ne,day:ne,d:ne,fecha:ne,selectedDate:ne,ts:String(new Date(ne+"T00:00:00").getTime()),patientId:W||""}).toString();r(`agenda?${be}`)},[a,l]=b.useState(!0),[c,d]=b.useState([]),[h,f]=b.useState(""),[m,x]=b.useState(null),[T,N]=b.useState(!0),[C,S]=b.useState(!1),[E,g]=b.useState(null),[_,O]=b.useState(null),L=b.useRef(null),[v,w]=b.useState("datos"),[I,R]=b.useState(Yo),[P,V]=b.useState(null),[k,M]=b.useState(""),[ge,oe]=b.useState([]),[Oe,Q]=b.useState(!1),le=b.useRef(null),ce="comfy",[_e,Ie]=b.useState(""),fe=b.useMemo(()=>{switch(ce){case"comfy":return{thumbW:220,thumbH:165,colMin:240};case"cozy":return{thumbW:160,thumbH:120,colMin:180};default:return{thumbW:120,thumbH:90,colMin:140}}},[ce]),ye=j=>{var ne,be;if((be=(ne=j==null?void 0:j.type)==null?void 0:ne.startsWith)!=null&&be.call(ne,"image/"))return!0;const W=((j==null?void 0:j.name)||(j==null?void 0:j.title)||"").toLowerCase();return/\.(png|jpe?g|gif|bmp|webp|tiff?)$/.test(W)},Le=b.useMemo(()=>{const j=_e.trim().toLowerCase(),W=Array.isArray(_==null?void 0:_.rxImagenes)?_.rxImagenes:[];let ne=W;return j?ne=W.filter(be=>`${be.name||""} ${be.title||""} ${be.desc||""}`.toLowerCase().includes(j)):ne=W.slice(),ne.sort((be,Ce)=>{const Ge=be.uploadedAtMS??be.created??0;return(Ce.uploadedAtMS??Ce.created??0)-Ge}),ne},[_==null?void 0:_.rxImagenes,_e]),We=async(j,W)=>{if(!(_!=null&&_.id))return;const ne=Array.isArray(_.rxImagenes)?[..._.rxImagenes]:[];ne[j]={...ne[j]||{},...W},await D({rxImagenes:ne})},Re=()=>{const j=new Date,W=j.getFullYear(),ne=String(j.getMonth()+1).padStart(2,"0"),be=String(j.getDate()).padStart(2,"0");return`${W}-${ne}-${be}`},[Je,gt]=b.useState(Re()),[q,pe]=b.useState(""),[xe,Y]=b.useState(""),[Z,Te]=b.useState(""),[ve,K]=b.useState("");b.useEffect(()=>{Y((_==null?void 0:_.doctor)||"")},[_==null?void 0:_.doctor,_==null?void 0:_.id]);const X=async()=>{if(!(_!=null&&_.id))return alert("Paciente no cargado.");if(!Je)return alert("Selecciona la fecha.");if(!q)return alert("Selecciona la hora.");if(!xe.trim())return alert("Indica el doctor.");const j=_.nombreCompleto||_.paciente||"Paciente",W=_.celular||_.celularPaciente||"",ne=_.telDomicilio||_.telefonoPaciente||"";if(!W&&!ne)return alert("Este paciente no tiene telfono registrado (celular o fijo). Agrega uno antes de crear la cita.");try{const be={paciente:j,pacienteId:_.id,doctor:xe.trim(),fecha:Je,horaInicio:q,espacio:Z||"",comentario:ve||"",estado:"En espera",creado:new Date().toISOString(),celularPaciente:W,telefonoPaciente:ne};await Bt(ue(J,"citas"),be),pe(""),Te(""),K(""),alert(" Cita creada. Ya aparece en la lista y en Agenda.")}catch(be){console.error("Error creando cita:",be),alert("No se pudo crear la cita.")}};b.useMemo(()=>Jp[I.paisNacimiento]||[],[I.paisNacimiento]),b.useEffect(()=>((async()=>{l(!0);try{const ne=(await Ae(ue(J,"eps"))).docs.map(Ce=>{var Ge;return(Ge=Ce.data())==null?void 0:Ge.nombre}).filter(Boolean),be=Array.from(new Map(ne.map(Ce=>[String(Ce).toLowerCase(),Ce])).values()).sort((Ce,Ge)=>Ce.localeCompare(Ge,"es"));oe(be),await ze(!0)}catch(W){console.error(W),alert("No se pudieron cargar pacientes/EPS.")}finally{l(!1)}})(),()=>{L.current&&(L.current(),L.current=null)}),[]),b.useEffect(()=>{R(j=>({...j,nombreCompleto:`${j.nombres} ${j.apellidos}`.trim()}))},[I.nombres,I.apellidos]),b.useEffect(()=>{R(j=>({...j,nroHistoria:j.nroDocumento}))},[I.nroDocumento]),b.useEffect(()=>{R(j=>({...j,edad:cU(j.fechaNacimiento)}))},[I.fechaNacimiento]),b.useEffect(()=>{const j=new Date,W=j.toLocaleDateString(Zl)+" - "+j.toLocaleTimeString(Zl,{hour:"2-digit",minute:"2-digit",hour12:!0});R(ne=>({...ne,fechaIngreso:W}))},[]);const B=(j,W)=>R(ne=>({...ne,[j]:W})),me=()=>{R(Yo);const j=new Date,W=j.toLocaleDateString(Zl)+" - "+j.toLocaleTimeString(Zl,{hour:"2-digit",minute:"2-digit",hour12:!0});R(ne=>({...ne,fechaIngreso:W})),V(null),M(""),g(null)},Me=async j=>{if(!j){V(null),M("");return}try{const W=await V0(j,{maxW:900,maxH:900,quality:.82});V(W);const ne=new FileReader;ne.onload=be=>M(be.target.result),ne.readAsDataURL(W)}catch{V(j);const W=new FileReader;W.onload=ne=>M(ne.target.result),W.readAsDataURL(j)}},ze=async(j=!1)=>{l(!0);try{let W;j||!m?W=qe(ue(J,"pacientes"),yt("creado","desc"),Pa(Zp)):W=qe(ue(J,"pacientes"),yt("creado","desc"),aF(m),Pa(Zp));const ne=await Ae(W),be=ne.docs.map(Ce=>({id:Ce.id,...Ce.data()}));d(j?be:Ce=>[...Ce,...be]),x(ne.docs[ne.docs.length-1]||null),N(ne.size===Zp)}catch(W){console.error(W),alert("No se pudo cargar pacientes.")}finally{l(!1)}},Fe=async j=>{if(j.preventDefault(),!I.nroDocumento.trim())return alert("El nmero de documento es obligatorio.");if(!I.nombres.trim())return alert("Los nombres son obligatorios.");if(!I.apellidos.trim())return alert("Los apellidos son obligatorios.");if(!I.sexo.trim())return alert("El sexo es obligatorio.");if(!I.fechaNacimiento.trim())return alert("La fecha de nacimiento es obligatoria.");if(!I.celular.trim())return alert("El celular es obligatorio.");if(!I.email.trim())return alert("El correo electrnico es obligatorio.");if(!I.tipoVinculacion.trim())return alert("El tipo de vinculacin es obligatorio.");if(!I.nombreEps.trim())return alert("El nombre de la EPS es obligatorio.");try{const W=I.nroDocumento.trim();if(!E&&(await Co(De(J,"pacientes",W))).exists())return alert("Ya existe un paciente con ese nmero de documento.");const ne=(I.nombreEps||"").trim(),be=ge.map(St=>St.toLowerCase()).includes(ne.toLowerCase());if(ne&&!be&&window.confirm(`La EPS "${ne}" no existe. Deseas guardarla para futuras selecciones?`)){const At=ne.toLowerCase().replace(/\s+/g,"_");await No(De(J,"eps",At),{nombre:ne,nombreLower:ne.toLowerCase(),creado:Pt()},{merge:!0})}let Ce=I.fotoUrl||"",Ge="";if(P)try{const St=Qi(),At=(P.name||"foto.jpg").replace(/\s+/g,"_");Ge=`pacientes/${W}/${Date.now()}_${At}`;const Un=Fl(St,Ge),wr={contentType:P.type||"image/jpeg",cacheControl:"public, max-age=86400"};await _0(Un,P,wr),Ce=await b0(Un)}catch(St){console.error("Foto (warning):",St)}const bt=I.creado||null,Fn=E&&bt||Pt(),Nn={...I,fotoUrl:Ce,nombre_busqueda:uU({...I,fotoUrl:Ce}),nombresLower:ec(I.nombres),apellidosLower:ec(I.apellidos),documentoLower:ec(I.nroDocumento),emailLower:ec(I.email),creado:Fn,createdAt:Fn,actualizado:Pt(),updatedAt:Pt(),activo:I.activo??!0,celularPaciente:I.celular,telefonoPaciente:I.telDomicilio||"",documento:I.nroDocumento,paciente:I.nombreCompleto};if(await No(De(J,"pacientes",W),Nn,{merge:!0}),Ge)try{const St=Qi(),At=Fl(St,`pacientes/${W}`),Un=await x0(At),wr=Ge,as=Un.items.filter(ls=>ls.fullPath!==wr).map(ls=>Hp(ls).catch(()=>null));await Promise.allSettled(as)}catch(St){console.warn("No se pudo limpiar fotos antiguas:",St)}alert(E?" Paciente actualizado.":" Paciente guardado."),d(St=>{const At=St.filter(Un=>Un.id!==W);return[{id:W,...Nn},...At]}),S(!1),g(null),me()}catch(W){console.error("Error guardando paciente:",W),alert(`No se pudo guardar el paciente.

`+((W==null?void 0:W.message)||W))}},Ke=()=>{me(),S(!0)},we=()=>{_&&(R({...Yo,..._,fotoUrl:_.fotoUrl||""}),V(null),M(_.fotoUrl||""),g(_.id),z(),S(!0))},lt=async j=>{if(window.confirm(`Eliminar al paciente "${j.nombreCompleto}"?`))try{await Tn(De(J,"pacientes",j.id)),d(W=>W.filter(ne=>ne.id!==j.id));try{const W=Qi(),ne=Fl(W,`pacientes/${j.id}`),Ce=(await x0(ne)).items.map(Ge=>Hp(Ge).catch(()=>null));await Promise.allSettled(Ce)}catch(W){console.warn("No se pudo borrar la carpeta de fotos:",W)}}catch(W){console.error(W),alert("No se pudo eliminar.")}},Ze=b.useMemo(()=>{const j=h.trim().toLowerCase();return j?c.filter(W=>`${W.nombreCompleto||W.paciente||""} ${W.nroDocumento||""} ${W.celular||W.celularPaciente||""} ${W.email||""}`.toLowerCase().includes(j)):c},[c,h]),xt=j=>{z();const W=De(J,"pacientes",j.id),ne=an(W,be=>{be.exists()?O({id:be.id,...ie(be.data())}):O(null)});L.current=ne,w("datos")},z=()=>{L.current&&(L.current(),L.current=null),O(null)},ie=j=>({...Yo,...j,historiaClinica:{...Yo.historiaClinica,...j.historiaClinica||{}},facturacion:{...Yo.facturacion,...j.facturacion||{}},rxImagenes:Array.isArray(j.rxImagenes)?j.rxImagenes:[],odontograma:Array.isArray(j.odontograma)?j.odontograma:[],periodontograma:Array.isArray(j.periodontograma)?j.periodontograma:[],presupuestos:Array.isArray(j.presupuestos)?j.presupuestos:[],evoluciones:Array.isArray(j.evoluciones)?j.evoluciones:[]}),D=async j=>{if(_!=null&&_.id)try{await Ut(De(J,"pacientes",_.id),{...j,actualizado:Pt(),updatedAt:Pt()})}catch(W){console.error(W),alert("No se pudo actualizar.")}},U=async j=>{var ne;if(!(_!=null&&_.id)||!(j!=null&&j.length))return;const W=Qi();try{Q(!0);const be=[];for(const Ce of j){let Ge=Ce;if((ne=Ce.type)!=null&&ne.startsWith("image/"))try{Ge=await V0(Ce,{maxW:1600,maxH:1600,quality:.85})}catch{Ge=Ce}const bt=(Ge.name||"archivo").replace(/\s+/g,"_"),Fn=`pacientes/${_.id}/rx/${Date.now()}_${bt}`,Nn=Fl(W,Fn),St={contentType:Ge.type||"application/octet-stream",cacheControl:"public, max-age=31536000"};await _0(Nn,Ge,St);const At=await b0(Nn),Un=new Date().toISOString(),wr=Date.now();be.push({url:At,name:Ce.name,title:Ce.name.replace(/\.[^.]+$/,""),desc:"",type:Ce.type,size:Ce.size||0,created:wr,uploadedAtMS:wr,uploadedAtISO:Un,path:Fn})}await D({rxImagenes:[..._.rxImagenes||[],...be]})}catch(be){console.error("RX upload error:",be);const Ce=`No se pudo subir el/los archivo(s).
 Verifica que el usuario est autenticado.
 Revisa reglas de Storage para permitir escribir en 'pacientes/{id}/**'.
 Si usas Emulador, confirma que el bucket coincida.

`+((be==null?void 0:be.message)||"");alert(Ce)}finally{Q(!1);try{le.current&&(le.current.value="")}catch{}}},ee=async j=>{if(!(_!=null&&_.id))return;const W=_.rxImagenes[j],ne=_.rxImagenes.filter((be,Ce)=>Ce!==j);await D({rxImagenes:ne});try{if(W!=null&&W.path){const be=Qi();await Hp(Fl(be,W.path))}}catch(be){console.warn("No se pudo borrar del Storage:",be)}},ae=(j,W)=>{const ne={..._.historiaClinica||{},[j]:W};D({historiaClinica:ne})},Pe=j=>{const W=[..._.presupuestos||[],{id:String(Date.now()),...j}];D({presupuestos:W})},ke=j=>{D({presupuestos:(_.presupuestos||[]).filter(W=>W.id!==j)})},Be=j=>{const W=[..._.evoluciones||[],{id:String(Date.now()),fechaISO:new Date().toISOString(),nota:j}];D({evoluciones:W})},Ue=j=>{D({evoluciones:(_.evoluciones||[]).filter(W=>W.id!==j)})},rt=(j,W)=>{const ne=Array.isArray(_[j])?_[j]:[],be=ne.find(Ge=>Ge.pieza===W);let Ce;be?Ce=ne.filter(Ge=>Ge.pieza!==W):Ce=[...ne,{pieza:W,estado:"marcada"}],D({[j]:Ce})},dt=(_==null?void 0:_.id)||null,Lt=fU(dt),{loading:Qe,citas:Kn}=pU(dt);return o.jsxs("div",{className:"odc-container",children:[o.jsx("div",{className:"odc-topbar-green"}),o.jsx("div",{className:"odc-topbar-blue",children:o.jsx("div",{className:"odc-top-inner",children:o.jsx("div",{className:"odc-breadcrumbs",children:"Pacientes"})})}),o.jsxs("div",{className:"odc-card",children:[o.jsxs("div",{className:"odc-card-header",children:[o.jsx("h3",{className:"odc-title",children:"Pacientes"}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[o.jsx("input",{className:"search-input",style:{minWidth:280},placeholder:"Buscar por nombre, documento o telfono",value:h,onChange:j=>f(j.target.value)}),o.jsx("button",{type:"button",className:"btn green",onClick:Ke,children:"+ Nuevo paciente"})]})]}),o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Foto"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Documento"}),o.jsx("th",{children:"Celular"}),o.jsx("th",{children:"Correo"}),o.jsx("th",{children:"Estado"})]})}),o.jsx("tbody",{children:a&&c.length===0?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:6,children:"Cargando"})}):Ze.length===0?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:6,children:"No hay pacientes o no coinciden con la bsqueda."})}):Ze.map(j=>o.jsxs("tr",{className:"row-click",onClick:()=>xt(j),children:[o.jsx("td",{onClick:W=>W.stopPropagation(),children:j.fotoUrl?o.jsx("img",{src:j.fotoUrl,alt:"Foto",style:{width:36,height:36,borderRadius:"50%",objectFit:"cover"}}):o.jsx("div",{className:"avatar-fallback",children:(j.nombreCompleto||"P")[0]})}),o.jsx("td",{children:j.nombreCompleto||j.paciente||""}),o.jsx("td",{children:j.nroDocumento||j.documento||""}),o.jsx("td",{children:j.celular||j.celularPaciente||""}),o.jsx("td",{children:j.email||""}),o.jsx("td",{children:o.jsx("span",{className:"pill pill-ok",children:j.activo?"Activo":"Inactivo"})})]},j.id))})]})}),o.jsxs("div",{className:"footer-actions",children:[o.jsx("button",{type:"button",className:"btn",disabled:a||!T,onClick:()=>ze(!1),children:T?"Cargar ms":"No hay ms"}),o.jsxs("div",{className:"hint",children:[c.length," registros cargados"]})]})]}),C&&o.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[o.jsx("div",{className:"odc-modal-backdrop",onClick:()=>S(!1)}),o.jsxs("div",{className:"odc-card",style:{width:1e3,maxWidth:"95%",maxHeight:"92vh",overflowY:"auto"},children:[o.jsxs("div",{className:"odc-card-header",children:[o.jsx("h3",{className:"odc-title",children:E?"Editar paciente":"Nuevo paciente"}),o.jsx("button",{type:"button",className:"btn",onClick:()=>S(!1),children:""})]}),o.jsxs("form",{onSubmit:Fe,children:[o.jsx("div",{className:"form-section-title",children:"Foto del paciente"}),o.jsxs("div",{className:"foto-row",children:[o.jsxs("label",{className:"foto-drop",children:[o.jsx("input",{type:"file",accept:"image/*",onChange:j=>{var W;return Me(((W=j.target.files)==null?void 0:W[0])||null)},style:{display:"none"}}),k?o.jsx("img",{src:k,alt:"Preview",className:"foto-preview"}):o.jsx("div",{className:"foto-empty",children:"Arrastra o haz clic para cargar"})]}),k&&o.jsx("button",{type:"button",className:"btn",onClick:()=>Me(null),children:"Quitar foto"})]}),o.jsx("div",{className:"form-section-title",children:"Datos de identificacin"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Tipo de documento *"}),o.jsxs("select",{className:"form-input",value:I.tipoDocumento,onChange:j=>B("tipoDocumento",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{value:"CC",children:"Cdula"}),o.jsx("option",{value:"TI",children:"Tarjeta de identidad"}),o.jsx("option",{value:"PA",children:"Pasaporte"}),o.jsx("option",{value:"OTRO",children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nro. de documento *"}),o.jsx("input",{className:"form-input",value:I.nroDocumento,onChange:j=>B("nroDocumento",j.target.value),placeholder:"Nmero de documento",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nmero de Historia"}),o.jsx("input",{className:"form-input",value:I.nroHistoria,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombres *"}),o.jsx("input",{className:"form-input",value:I.nombres,onChange:j=>B("nombres",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Apellidos *"}),o.jsx("input",{className:"form-input",value:I.apellidos,onChange:j=>B("apellidos",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombre completo"}),o.jsx("input",{className:"form-input",value:I.nombreCompleto,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Sexo *"}),o.jsxs("select",{className:"form-input",value:I.sexo,onChange:j=>B("sexo",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Masculino"}),o.jsx("option",{children:"Femenino"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Estado civil *"}),o.jsxs("select",{className:"form-input",value:I.estadoCivil,onChange:j=>B("estadoCivil",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Soltero"}),o.jsx("option",{children:"Casado"}),o.jsx("option",{children:"Unin libre"}),o.jsx("option",{children:"Divorciado"}),o.jsx("option",{children:"Viudo"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Pas de nacimiento *"}),o.jsx("input",{className:"form-input",list:"listCountries",value:I.paisNacimiento,onChange:j=>B("paisNacimiento",j.target.value),placeholder:"Escribe y elige",required:!0}),o.jsx("datalist",{id:"listCountries",children:lU.map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Ciudad de nacimiento"}),o.jsx("input",{className:"form-input",list:"listCitiesBirth",value:I.ciudadNacimiento,onChange:j=>B("ciudadNacimiento",j.target.value),placeholder:"Escribe y elige"}),o.jsx("datalist",{id:"listCitiesBirth",children:(Jp[I.paisNacimiento]||[]).map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Fecha de ingreso"}),o.jsx("input",{className:"form-input",value:I.fechaIngreso,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Fecha de nacimiento *"}),o.jsx("input",{type:"date",className:"form-input",value:I.fechaNacimiento,onChange:j=>B("fechaNacimiento",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Edad"}),o.jsx("input",{className:"form-input",value:I.edad,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Pas de domicilio *"}),o.jsx("input",{className:"form-input",list:"listCountries",value:I.paisDomicilio,onChange:j=>B("paisDomicilio",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Ciudad de domicilio *"}),o.jsx("input",{className:"form-input",list:"listCitiesHome",value:I.ciudadDomicilio,onChange:j=>B("ciudadDomicilio",j.target.value),required:!0}),o.jsx("datalist",{id:"listCitiesHome",children:(Jp[I.paisDomicilio]||[]).map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Barrio *"}),o.jsx("input",{className:"form-input",value:I.barrio,onChange:j=>B("barrio",j.target.value),required:!0,placeholder:"Barrio"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Lugar de residencia *"}),o.jsx("input",{className:"form-input",value:I.lugarResidencia,onChange:j=>B("lugarResidencia",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Estrato"}),o.jsxs("select",{className:"form-input",value:I.estrato,onChange:j=>B("estrato",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"1"}),o.jsx("option",{children:"2"}),o.jsx("option",{children:"3"}),o.jsx("option",{children:"4"}),o.jsx("option",{children:"5"}),o.jsx("option",{children:"6"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Zona residencial *"}),o.jsxs("select",{className:"form-input",value:I.zonaResidencial,onChange:j=>B("zonaResidencial",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Urbana"}),o.jsx("option",{children:"Rural"})]})]}),o.jsxs("div",{className:"checkbox-cell",children:[o.jsx("label",{className:"form-label",children:"Es extranjero?"}),o.jsx("input",{type:"checkbox",checked:I.esExtranjero,onChange:j=>B("esExtranjero",j.target.checked)})]}),o.jsxs("div",{className:"checkbox-cell",children:[o.jsx("label",{className:"form-label",children:"Permite publicidad?"}),o.jsx("input",{type:"checkbox",checked:I.permitePublicidad,onChange:j=>B("permitePublicidad",j.target.checked)})]})]}),o.jsx("div",{className:"form-section-title",children:"Contacto"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Celular *"}),o.jsx("input",{className:"form-input",value:I.celular,onChange:j=>B("celular",j.target.value),required:!0,placeholder:"Celular del paciente"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono de domicilio"}),o.jsx("input",{className:"form-input",value:I.telDomicilio,onChange:j=>B("telDomicilio",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono de oficina"}),o.jsx("input",{className:"form-input",value:I.telOficina,onChange:j=>B("telOficina",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Extensin"}),o.jsx("input",{className:"form-input",value:I.extension,onChange:j=>B("extension",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Correo electrnico *"}),o.jsx("input",{type:"email",className:"form-input",value:I.email,onChange:j=>B("email",j.target.value),required:!0,placeholder:"correo@dominio.com"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Ocupacin *"}),o.jsx("input",{className:"form-input",value:I.ocupacion,onChange:j=>B("ocupacion",j.target.value),required:!0})]})]}),o.jsx("div",{className:"form-section-title",children:"Datos de facturacin"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Responsable"}),o.jsx("input",{className:"form-input",value:I.nombreResponsable,onChange:j=>B("nombreResponsable",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Parentesco"}),o.jsxs("select",{className:"form-input",value:I.parentesco,onChange:j=>B("parentesco",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Padre/Madre"}),o.jsx("option",{children:"Hermano"}),o.jsx("option",{children:"Esposo/a"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Celular"}),o.jsx("input",{className:"form-input",value:I.celularResponsable,onChange:j=>B("celularResponsable",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono"}),o.jsx("input",{className:"form-input",value:I.telefonoResponsable,onChange:j=>B("telefonoResponsable",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Correo electrnico"}),o.jsx("input",{type:"email",className:"form-input",value:I.emailResponsable,onChange:j=>B("emailResponsable",j.target.value)})]})]}),o.jsx("div",{className:"form-section-title",children:"Acompaante"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombre"}),o.jsx("input",{className:"form-input",value:I.nombreAcompanante,onChange:j=>B("nombreAcompanante",j.target.value),placeholder:"Nombre acompaante"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono"}),o.jsx("input",{className:"form-input",value:I.telefonoAcompanante,onChange:j=>B("telefonoAcompanante",j.target.value),placeholder:"Telfono acompaante"})]})]}),o.jsx("div",{className:"form-section-title",children:"Mercadeo"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Convenio beneficio"}),o.jsx("input",{className:"form-input",value:I.convenioBeneficio,onChange:j=>B("convenioBeneficio",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Cmo nos conoci?"}),o.jsxs("select",{className:"form-input",value:I.comoConocio,onChange:j=>B("comoConocio",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Redes sociales"}),o.jsx("option",{children:"Publicidad"}),o.jsx("option",{children:"Recomendacin"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Campaa"}),o.jsx("input",{className:"form-input",value:I.campania,onChange:j=>B("campania",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Remitido por"}),o.jsx("input",{className:"form-input",value:I.remitidoPor,onChange:j=>B("remitidoPor",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Asesor comercial"}),o.jsx("input",{className:"form-input",value:I.asesorComercial,onChange:j=>B("asesorComercial",j.target.value)})]})]}),o.jsx("div",{className:"form-section-title",children:"EPS"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Tipo de vinculacin *"}),o.jsxs("select",{className:"form-input",value:I.tipoVinculacion,onChange:j=>B("tipoVinculacion",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Contributivo"}),o.jsx("option",{children:"Subsidiado"}),o.jsx("option",{children:"Particular"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombre de la EPS *"}),o.jsx("input",{className:"form-input",list:"listEps",value:I.nombreEps,onChange:j=>B("nombreEps",j.target.value),placeholder:"Escribe y selecciona",required:!0}),o.jsx("datalist",{id:"listEps",children:ge.map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Pliza de salud"}),o.jsx("input",{className:"form-input",value:I.polizaSalud,onChange:j=>B("polizaSalud",j.target.value)})]})]}),o.jsx("div",{className:"form-section-title",children:"Doctor"}),o.jsx("div",{className:"form-grid",children:o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Doctor"}),o.jsx("input",{className:"form-input",value:I.doctor,onChange:j=>B("doctor",j.target.value),placeholder:"Usuario / Libre"})]})}),o.jsx("div",{className:"form-section-title",children:"Alertas y Notas"}),o.jsx("div",{className:"form-grid",children:o.jsx("textarea",{className:"form-input",rows:3,value:I.notas,onChange:j=>B("notas",j.target.value),placeholder:"Notas del paciente"})}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,marginTop:12},children:[E?o.jsx("button",{type:"button",className:"btn",onClick:()=>lt({id:E,nombreCompleto:I.nombreCompleto}),children:"Eliminar"}):o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{type:"button",className:"btn",onClick:()=>S(!1),children:"Cancelar"}),o.jsx("button",{type:"submit",className:"btn blue",children:E?"Actualizar":"Guardar paciente"})]})]})]})]})]}),_&&o.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[o.jsx("div",{className:"odc-modal-backdrop",onClick:z}),o.jsxs("div",{className:"odc-card ficha-card",children:[o.jsxs("div",{className:"ficha-header",children:[o.jsxs("div",{className:"ficha-header-left",children:[_.fotoUrl?o.jsx("img",{src:_.fotoUrl,alt:"Foto",className:"ficha-avatar"}):o.jsx("div",{className:"avatar-fallback ficha-avatar-fallback",children:(_.nombreCompleto||"P")[0]}),o.jsxs("div",{children:[o.jsx("div",{className:"ficha-nombre",children:_.nombreCompleto||""}),o.jsxs("div",{className:"ficha-doc",children:[_.tipoDocumento||""," ",_.nroDocumento||""]}),o.jsxs("div",{className:"ficha-badges",children:[o.jsx("span",{className:"ficha-badge blue",children:"En valoracin"}),o.jsx("span",{className:"ficha-badge green",children:"Sin deuda"})]})]})]}),o.jsx("div",{className:"ficha-header-right",children:o.jsxs("div",{className:"ficha-actions",children:[o.jsx("button",{type:"button",className:"btn",onClick:z,children:"Cerrar"}),o.jsx("button",{type:"button",className:"btn blue",onClick:we,children:"Editar"}),o.jsx("button",{type:"button",className:"btn green",onClick:()=>t(s(id.caja,{cobro:1,patientId:_.id})),title:"Ir a Caja para cobrar a este paciente",children:"Cobrar"})]})})]}),o.jsxs("div",{className:"ficha-body",children:[o.jsxs("aside",{className:"ficha-sidebar",children:[o.jsx("div",{className:"ficha-sidebar-title",children:"Informacin general"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="datos"?"active":""}`,onClick:()=>w("datos"),children:"Datos personales"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="marketing"?"active":""}`,onClick:()=>w("marketing"),children:"Marketing"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="eps"?"active":""}`,onClick:()=>w("eps"),children:"EPS"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="prof"?"active":""}`,onClick:()=>w("prof"),children:"Profesionales"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="rx"?"active":""}`,onClick:()=>w("rx"),children:"Rx/Imgenes/Doc"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="citas"?"active":""}`,onClick:()=>w("citas"),children:"Citas"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="crm"?"active":""}`,onClick:()=>w("crm"),children:"CRM"}),o.jsx("div",{className:"ficha-sidebar-title mt",children:"Historia clnica"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="doc"?"active":""}`,onClick:()=>w("doc"),children:"Doc. Clnicos"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="odonto"?"active":""}`,onClick:()=>w("odonto"),children:"Odontogramas"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="perio"?"active":""}`,onClick:()=>w("perio"),children:"Periodontogramas"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="presu"?"active":""}`,onClick:()=>w("presu"),children:"Presupuestos"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="evo"?"active":""}`,onClick:()=>w("evo"),children:"Evoluciones"}),o.jsx("div",{className:"ficha-sidebar-title mt",children:"Facturacin"}),o.jsx("button",{type:"button",className:`ficha-link ${v==="fact"?"active":""}`,onClick:()=>w("fact"),children:"Resumen"}),o.jsxs("div",{className:"ficha-sidebar-actions",style:{display:"grid",gap:8,marginTop:8},children:[o.jsx("button",{type:"button",className:"btn pay",onClick:()=>t(s(id.caja,{cobro:1,patientId:_.id})),title:"Cobrar a este paciente",children:"Realizar pago"}),o.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${id.pagos}?patientId=${encodeURIComponent(_.id)}`),title:"Ver histrico de pagos",children:"Histrico de pagos"}),o.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${id.facturas}?patientId=${encodeURIComponent(_.id)}`),title:"Ver histrico de facturacin",children:"Histrico de facturacin"})]})]}),o.jsxs("main",{className:"ficha-content",children:[v==="datos"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Datos personales"}),o.jsx("div",{className:"ficha-grid",children:[["Tipo de documento",_.tipoDocumento],["Nro. de documento",_.nroDocumento],["Nmero de Historia",_.nroHistoria],["Fecha de ingreso",_.fechaIngreso],["Nombres",_.nombres],["Apellidos",_.apellidos],["Nombre completo",_.nombreCompleto],["Sexo",_.sexo],["Estado civil",_.estadoCivil],["Pas de nacimiento",_.paisNacimiento],["Ciudad de nacimiento",_.ciudadNacimiento],["Fecha de nacimiento",_.fechaNacimiento],["Edad",_.edad],["Pas de domicilio",_.paisDomicilio],["Ciudad de domicilio",_.ciudadDomicilio],["Barrio",_.barrio],["Lugar de residencia",_.lugarResidencia],["Estrato",_.estrato],["Zona residencial",_.zonaResidencial],["Extranjero",_.esExtranjero?"S":"No"],["Permite publicidad",_.permitePublicidad?"S":"No"],["Celular",_.celular||_.celularPaciente],["Telfono domicilio",_.telDomicilio||_.telefonoPaciente],["Telfono oficina",_.telOficina],["Extensin",_.extension],["Correo electrnico",_.email],["Ocupacin",_.ocupacion],["Responsable",_.nombreResponsable],["Parentesco",_.parentesco],["Cel. responsable",_.celularResponsable],["Tel. responsable",_.telefonoResponsable],["Email responsable",_.emailResponsable],["Acompaante",_.nombreAcompanante],["Tel. acompaante",_.telefonoAcompanante]].map(([j,W])=>o.jsxs("div",{className:"field",children:[o.jsx("label",{children:j}),o.jsx("input",{className:"form-input",value:W||"",readOnly:!0})]},j))})]}),v==="marketing"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Marketing"}),o.jsx("div",{className:"ficha-grid",children:[["Convenio beneficio",_.convenioBeneficio],["Cmo nos conoci?",_.comoConocio],["Campaa",_.campania],["Remitido por",_.remitidoPor],["Asesor comercial",_.asesorComercial]].map(([j,W])=>o.jsxs("div",{className:"field",children:[o.jsx("label",{children:j}),o.jsx("input",{className:"form-input",value:W||"",readOnly:!0})]},j))})]}),v==="eps"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"EPS"}),o.jsx("div",{className:"ficha-grid",children:[["Tipo de vinculacin",_.tipoVinculacion],["Nombre EPS",_.nombreEps],["Pliza de salud",_.polizaSalud]].map(([j,W])=>o.jsxs("div",{className:"field",children:[o.jsx("label",{children:j}),o.jsx("input",{className:"form-input",value:W||"",readOnly:!0})]},j))})]}),v==="prof"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Profesionales"}),o.jsx("div",{className:"ficha-grid",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Doctor"}),o.jsx("input",{className:"form-input",value:_.doctor||"",readOnly:!0})]})})]}),v==="rx"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Rx / Imgenes / Documentos"}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{className:"btn blue",children:["Subir archivos",o.jsx("input",{ref:le,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",style:{display:"none"},onChange:j=>U([...j.target.files||[]])})]}),Oe&&o.jsx("span",{className:"hint",children:"Subiendo"}),o.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:o.jsx("input",{className:"form-input",style:{width:200},placeholder:"Buscar en Rx",value:_e,onChange:j=>Ie(j.target.value),title:"Filtra por nombre, ttulo o descripcin"})})]}),o.jsxs("div",{className:"hint",style:{marginTop:6},children:[Le.length," elemento(s)",_e?"  filtrado(s)":"","."]}),o.jsxs("div",{className:"rx-grid",style:{display:"grid",gap:10,marginTop:12,gridTemplateColumns:`repeat(auto-fill, minmax(${fe.colMin}px, 1fr))`,alignItems:"start"},children:[Le.length===0&&o.jsx("div",{className:"no-data",style:{gridColumn:"1 / -1"},children:_e?"Sin coincidencias.":"Sin archivos an."}),Le.map((j,W)=>{var bt,Fn;const ne=ye(j),be=j.title||j.name||`archivo-${W}`,Ce=((bt=(j.name||"").split(".").pop())==null?void 0:bt.toUpperCase())||((Fn=(j.type||"").split("/").pop())==null?void 0:Fn.toUpperCase())||"",Ge=j.uploadedAtISO||(j.created?new Date(j.created).toISOString():null);return o.jsxs("div",{className:"rx-item mini-card",style:{padding:8,display:"grid",gap:8},title:be,children:[o.jsx("a",{href:j.url,target:"_blank",rel:"noreferrer",style:{width:"100%",height:fe.thumbH,borderRadius:8,overflow:"hidden",border:"1px solid #e5e7eb",display:"grid",placeItems:"center",background:"#fafafa"},children:ne?o.jsx("img",{src:j.url,alt:be,style:{width:fe.thumbW,height:fe.thumbH,objectFit:"contain",display:"block"},loading:"lazy"}):o.jsxs("div",{style:{textAlign:"center",padding:10},children:[o.jsx("div",{style:{fontSize:24,fontWeight:700},children:Ce||"DOC"}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Ver / descargar"})]})}),o.jsx("div",{style:{fontWeight:600,fontSize:13,lineHeight:1.2},children:be.length>40?be.slice(0,37)+"":be}),o.jsxs("details",{children:[o.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#2563eb"},children:"Editar nombre y descripcin"}),o.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[o.jsx("label",{className:"form-label",style:{marginTop:4},children:"Nombre para mostrar"}),o.jsx("input",{id:`rx-title-${W}`,className:"form-input",defaultValue:j.title||j.name||"",placeholder:"Ej. Rx aleta derecha 2025-11-29"}),o.jsx("label",{className:"form-label",children:"Descripcin"}),o.jsx("textarea",{id:`rx-desc-${W}`,className:"form-input",rows:2,defaultValue:j.desc||"",placeholder:"Observaciones, regin, tcnica, etc."}),o.jsx("label",{className:"form-label",children:"Fecha de subida"}),o.jsx("input",{id:`rx-date-${W}`,type:"datetime-local",className:"form-input",defaultValue:dU(Ge)}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"space-between"},children:[o.jsx("button",{type:"button",className:"btn blue",onClick:()=>{var as,ls,Fo;const Nn=((as=document.getElementById(`rx-title-${W}`))==null?void 0:as.value)||"",St=((ls=document.getElementById(`rx-desc-${W}`))==null?void 0:ls.value)||"",At=((Fo=document.getElementById(`rx-date-${W}`))==null?void 0:Fo.value)||"";let Un=Ge,wr=j.uploadedAtMS||j.created||null;if(At){const cs=new Date(At);isNaN(cs.getTime())||(Un=cs.toISOString(),wr=cs.getTime())}We(W,{title:Nn,name:Nn||j.name,desc:St,uploadedAtISO:Un,uploadedAtMS:wr})},children:"Guardar"}),o.jsx("button",{type:"button",className:"btn",onClick:()=>ee(W),children:"Eliminar"})]}),o.jsxs("div",{className:"hint",style:{fontSize:11},children:["Tipo: ",j.type||"","  Tamao: ",(j.size||0).toLocaleString()," bytes",Ge?`  Subido: ${hU(Ge)}`:""]})]})]})]},`${j.url}-${W}`)})]})]}),v==="doc"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Doc. Clnicos"}),o.jsxs("div",{className:"ficha-grid",children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Motivo de consulta"}),o.jsx("textarea",{className:"form-input",rows:3,value:((Ht=_.historiaClinica)==null?void 0:Ht.motivoConsulta)||"",onChange:j=>ae("motivoConsulta",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Antecedentes"}),o.jsx("textarea",{className:"form-input",rows:3,value:((ut=_.historiaClinica)==null?void 0:ut.antecedentes)||"",onChange:j=>ae("antecedentes",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Alergias"}),o.jsx("textarea",{className:"form-input",rows:2,value:((cn=_.historiaClinica)==null?void 0:cn.alergias)||"",onChange:j=>ae("alergias",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Medicamentos"}),o.jsx("textarea",{className:"form-input",rows:2,value:((mn=_.historiaClinica)==null?void 0:mn.medicamentos)||"",onChange:j=>ae("medicamentos",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Notas"}),o.jsx("textarea",{className:"form-input",rows:3,value:((gn=_.historiaClinica)==null?void 0:gn.notas)||"",onChange:j=>ae("notas",j.target.value)})]})]})]}),v==="odonto"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Odontograma (placeholder)"}),o.jsx("div",{className:"odont-grid",children:Array.from({length:32},(j,W)=>W+1).map(j=>{const W=(_.odontograma||[]).some(ne=>ne.pieza===j);return o.jsx("button",{type:"button",className:`tooth ${W?"on":""}`,onClick:()=>rt("odontograma",j),title:`Pieza ${j}`,children:j},j)})})]}),v==="perio"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Periodontograma (placeholder)"}),o.jsx("div",{className:"odont-grid",children:Array.from({length:32},(j,W)=>W+1).map(j=>{const W=(_.periodontograma||[]).some(ne=>ne.pieza===j);return o.jsx("button",{type:"button",className:`tooth ${W?"on":""}`,onClick:()=>rt("periodontograma",j),title:`Pieza ${j}`,children:j},j)})})]}),v==="presu"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Presupuestos & planes"}),o.jsx(gU,{onAdd:Pe}),o.jsxs("div",{className:"presu-list",children:[(_.presupuestos||[]).map(j=>o.jsxs("div",{className:"presu-item",children:[o.jsxs("div",{children:[o.jsx("div",{className:"presu-title",children:j.titulo}),o.jsxs("div",{className:"presu-meta",children:["Costo: $",j.costo||0,"  Estado: ",j.estado||"Pendiente"]})]}),o.jsx("button",{type:"button",className:"btn small",onClick:()=>ke(j.id),children:"Eliminar"})]},j.id)),(!_.presupuestos||_.presupuestos.length===0)&&o.jsx("div",{className:"no-data",children:"Sin presupuestos an."})]})]}),v==="evo"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Evoluciones & Remisiones"}),o.jsx(yU,{onAdd:Be}),o.jsxs("div",{className:"evo-list",children:[(_.evoluciones||[]).map(j=>o.jsxs("div",{className:"evo-item",children:[o.jsx("div",{className:"evo-date",children:new Date(j.fechaISO).toLocaleString()}),o.jsx("div",{className:"evo-note",children:j.nota}),o.jsx("button",{type:"button",className:"btn small",onClick:()=>Ue(j.id),children:"Eliminar"})]},j.id)),(!_.evoluciones||_.evoluciones.length===0)&&o.jsx("div",{className:"no-data",children:"Sin evoluciones an."})]})]}),v==="fact"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Facturacin"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px,1fr))",gap:12},children:[o.jsx(Jo,{title:"Total facturado",value:`$ ${Lt.totalFacturado.toLocaleString()}`}),o.jsx(Jo,{title:"Total pagado",value:`$ ${Lt.totalPagado.toLocaleString()}`}),o.jsx(Jo,{title:"Facturas pendientes",value:`$ ${Lt.totalFacturasPendientes.toLocaleString()}`}),o.jsx(Jo,{title:"Saldo pendiente (facturas - pagos)",value:`$ ${(Lt.totalFacturado-Lt.totalPagado).toLocaleString()}`}),o.jsx(Jo,{title:"Saldo a favor",value:`$ ${(((br=_.facturacion)==null?void 0:br.saldoFavor)??0).toLocaleString()}`}),o.jsx(Jo,{title:"Saldo crdito",value:`$ ${(((pl=_.facturacion)==null?void 0:pl.saldoCredito)??0).toLocaleString()}`})]}),Lt.error&&o.jsxs("div",{className:"hint",style:{marginTop:6},children:[" ",Lt.error]}),o.jsxs("div",{className:"ficha-grid",style:{marginTop:12},children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Saldo a favor"}),o.jsx("input",{type:"number",className:"form-input",value:((os=_.facturacion)==null?void 0:os.saldoFavor)??0,onChange:j=>D({facturacion:{..._.facturacion||{},saldoFavor:Number(j.target.value||0)}})})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Saldo crdito"}),o.jsx("input",{type:"number",className:"form-input",value:((Di=_.facturacion)==null?void 0:Di.saldoCredito)??0,onChange:j=>D({facturacion:{..._.facturacion||{},saldoCredito:Number(j.target.value||0)}})})]})]})]}),v==="citas"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Citas"}),o.jsxs("div",{className:"mini-card",style:{marginBottom:12},children:[o.jsx("div",{className:"mini-card-title",children:"Crear cita para este paciente"}),o.jsxs("div",{className:"ficha-grid",style:{marginTop:8},children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Fecha"}),o.jsx("input",{type:"date",className:"form-input",value:Je,onChange:j=>gt(j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Hora"}),o.jsx("input",{type:"time",className:"form-input",value:q,onChange:j=>pe(j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Doctor"}),o.jsx("input",{className:"form-input",value:xe,onChange:j=>Y(j.target.value),placeholder:"Doctor asignado"})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Espacio / Sala"}),o.jsx("input",{className:"form-input",value:Z,onChange:j=>Te(j.target.value),placeholder:"Consultorio / Silla"})]}),o.jsxs("div",{className:"field",style:{gridColumn:"1 / -1"},children:[o.jsx("label",{children:"Comentario"}),o.jsx("textarea",{className:"form-input",rows:2,value:ve,onChange:j=>K(j.target.value),placeholder:"Motivo / notas de la cita"})]})]}),o.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[o.jsx("button",{type:"button",className:"btn blue",onClick:X,children:"Guardar cita"}),Je&&o.jsx("button",{type:"button",className:"btn",onClick:()=>i(Je,_.id),children:"Ver ese da en Agenda"})]})]}),o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Fecha"}),o.jsx("th",{children:"Estado"}),o.jsx("th",{children:"Motivo"}),o.jsx("th",{children:"Profesional / Acciones"})]})}),o.jsx("tbody",{children:Qe?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:4,children:"Cargando"})}):Kn.length===0?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:4,children:"Sin citas registradas."})}):Kn.map(j=>o.jsxs("tr",{children:[o.jsx("td",{children:j.fechaISO?new Date(j.fechaISO).toLocaleString():j.fechaYYYYMMDD||""}),o.jsx("td",{children:j.estado||""}),o.jsx("td",{children:j.motivo||""}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{children:j.profesional||""}),o.jsx("button",{type:"button",className:"btn small",onClick:()=>{const W=j.fechaYYYYMMDD||j.fecha||(j.fechaISO?new Date(j.fechaISO).toISOString().slice(0,10):"");i(W,_.id)},title:"Abrir en Agenda",children:"Ver en Agenda"})]})})]},j.id))})]})})]}),v==="crm"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"CRM"}),o.jsx("div",{className:"no-data",children:"Notas / recordatorios comerciales del paciente."})]}),o.jsx("div",{className:"ficha-footer"})]})]})]})]})]})}function Jo({title:t,value:e}){return o.jsxs("div",{className:"mini-card",children:[o.jsx("div",{className:"mini-card-title",children:t}),o.jsx("div",{style:{fontWeight:700,fontSize:20,marginTop:6},children:e})]})}function gU({onAdd:t}){const[e,n]=b.useState(""),[r,s]=b.useState(""),[i,a]=b.useState("Pendiente");return o.jsxs("div",{className:"presu-form",children:[o.jsx("input",{className:"form-input",placeholder:"Procedimiento / plan",value:e,onChange:l=>n(l.target.value)}),o.jsx("input",{type:"number",className:"form-input",placeholder:"Costo",value:r,onChange:l=>s(l.target.value)}),o.jsxs("select",{className:"form-input",value:i,onChange:l=>a(l.target.value),children:[o.jsx("option",{children:"Pendiente"}),o.jsx("option",{children:"Aprobado"}),o.jsx("option",{children:"Rechazado"})]}),o.jsx("button",{type:"button",className:"btn blue",onClick:()=>{if(!e)return alert("Ttulo requerido");t({titulo:e,costo:Number(r||0),estado:i}),n(""),s(""),a("Pendiente")},children:"Agregar"})]})}function yU({onAdd:t}){const[e,n]=b.useState("");return o.jsxs("div",{className:"evo-form",children:[o.jsx("textarea",{className:"form-input",rows:2,placeholder:"Escribe la evolucin / remisin",value:e,onChange:r=>n(r.target.value)}),o.jsx("button",{type:"button",className:"btn blue",onClick:()=>{e.trim()&&(t(e.trim()),n(""))},children:"Guardar evolucin"})]})}function vU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function _U({basePath:t="",className:e=""}){const n=is(),r=()=>{const s=String(t||"").replace(/\/+$/g,"");n(`${s}/config/datos-basicos`,{replace:!1})};return o.jsx("button",{type:"button",className:`oc-icon-btn ${e}`,title:"Configuracin","aria-label":"Abrir configuracin",onClick:r,children:""})}function xU(t,e){try{let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}catch{}}const M0="empresa_datos_basicos",bU="oc_company_name",wU="empresa_nombre";function EU(){const[t,e]=b.useState({nombre:"",marca:"",pais:"Colombia",ciudad:"",tipoDocumento:"NIT",numeroDocumento:"",tipoPersona:"",telefono:"",celular:"",direccion:"",sitioWeb:"",urlAgendamiento:"",regimen:"",responsabilidadTributaria:"",correo:"",moneda:"Pesos colombianos (COP)",zonaHoraria:"Hora de Colombia",cuentaContable:"",esIPS:!1,usuarioSispro:"",tipoDocSispro:"Cdula de Ciudadana",passwordSispro:"",codigoPrestador:""});b.useEffect(()=>{var s;try{const i=localStorage.getItem(M0);if(i){const l=JSON.parse(i);e(c=>({...c,...l}));return}const a=(s=document.querySelector('meta[name="company-name"]'))==null?void 0:s.getAttribute("content");a&&e(l=>({...l,nombre:a}))}catch{}},[]);const n=s=>{const{name:i,type:a,value:l,checked:c}=s.target;e(d=>({...d,[i]:a==="checkbox"?c:l}))},r=s=>{s.preventDefault();try{localStorage.setItem(M0,JSON.stringify(t))}catch{}const i=(t.nombre||"OdontoCloud").trim();try{localStorage.setItem(bU,i),localStorage.setItem(wU,i)}catch{}xU("company-name",i);try{window.dispatchEvent(new CustomEvent("oc-company-name-updated",{detail:{nombre:i}}));const a=document.querySelector(".oc-topbar-title");a&&(a.textContent=i)}catch{}console.log(" Datos bsicos guardados:",t),alert("Datos bsicos guardados.")};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Datos bsicos"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:"Datos bsicos"}),o.jsxs("form",{className:"emp-form",onSubmit:r,children:[o.jsxs("div",{className:"oc-form-grid",children:[o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Nombre *"}),o.jsx("input",{name:"nombre",className:"emp-input",autoComplete:"organization",required:!0,value:t.nombre,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Marca"}),o.jsx("input",{name:"marca",className:"emp-input",value:t.marca,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Pas"}),o.jsxs("select",{name:"pais",className:"emp-select",value:t.pais,onChange:n,children:[o.jsx("option",{children:"Colombia"}),o.jsx("option",{children:"Mxico"}),o.jsx("option",{children:"Per"}),o.jsx("option",{children:"Chile"}),o.jsx("option",{children:"Argentina"}),o.jsx("option",{children:"Espaa"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Ciudad"}),o.jsx("input",{name:"ciudad",className:"emp-input",value:t.ciudad,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo documento *"}),o.jsxs("select",{name:"tipoDocumento",className:"emp-select",required:!0,value:t.tipoDocumento,onChange:n,children:[o.jsx("option",{children:"NIT"}),o.jsx("option",{children:"CC"}),o.jsx("option",{children:"CE"}),o.jsx("option",{children:"PA"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Nmero de documento *"}),o.jsx("input",{name:"numeroDocumento",className:"emp-input",required:!0,value:t.numeroDocumento,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo de persona"}),o.jsxs("select",{name:"tipoPersona",className:"emp-select",value:t.tipoPersona,onChange:n,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Natural"}),o.jsx("option",{children:"Jurdica"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Telfono fijo"}),o.jsx("input",{name:"telefono",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.telefono,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Celular"}),o.jsx("input",{name:"celular",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.celular,onChange:n})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Direccin"}),o.jsx("input",{name:"direccion",className:"emp-input",autoComplete:"street-address",value:t.direccion,onChange:n})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Sitio web"}),o.jsx("input",{name:"sitioWeb",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.sitioWeb,onChange:n})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Agendamiento (URL)"}),o.jsx("input",{name:"urlAgendamiento",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.urlAgendamiento,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Rgimen legal"}),o.jsxs("select",{name:"regimen",className:"emp-select",value:t.regimen,onChange:n,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Comn"}),o.jsx("option",{children:"Simplificado"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Responsabilidad tributaria"}),o.jsxs("select",{name:"responsabilidadTributaria",className:"emp-select",value:t.responsabilidadTributaria,onChange:n,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"No aplica"}),o.jsx("option",{children:"Autorretenedor"})]})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Correo electrnico"}),o.jsx("input",{name:"correo",className:"emp-input",type:"email",autoComplete:"email",value:t.correo,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Moneda"}),o.jsxs("select",{name:"moneda",className:"emp-select",value:t.moneda,onChange:n,children:[o.jsx("option",{children:"Pesos colombianos (COP)"}),o.jsx("option",{children:"Dlares (USD)"}),o.jsx("option",{children:"Euros (EUR)"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Zona horaria"}),o.jsxs("select",{name:"zonaHoraria",className:"emp-select",value:t.zonaHoraria,onChange:n,children:[o.jsx("option",{children:"Hora de Colombia"}),o.jsx("option",{children:"America/Bogota"}),o.jsx("option",{children:"UTC-5"})]})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Cuenta contable"}),o.jsx("input",{name:"cuentaContable",className:"emp-input",value:t.cuentaContable,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Es una institucin prestadora de salud (IPS)?"}),o.jsxs("div",{className:"emp-inline",children:[o.jsx("input",{id:"esIPS",type:"checkbox",name:"esIPS",checked:t.esIPS,onChange:n}),o.jsx("label",{htmlFor:"esIPS",children:"S"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Usuario SISPRO"}),o.jsx("input",{name:"usuarioSispro",className:"emp-input",value:t.usuarioSispro,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo documento SISPRO"}),o.jsxs("select",{name:"tipoDocSispro",className:"emp-select",value:t.tipoDocSispro,onChange:n,children:[o.jsx("option",{children:"Cdula de Ciudadana"}),o.jsx("option",{children:"Cdula de Extranjera"}),o.jsx("option",{children:"NIT"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Contrasea SISPRO"}),o.jsx("input",{name:"passwordSispro",className:"emp-input",type:"password",value:t.passwordSispro,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Cdigo de prestador"}),o.jsx("input",{name:"codigoPrestador",className:"emp-input",value:t.codigoPrestador,onChange:n})]})]}),o.jsx("div",{className:"oc-form-actions",children:o.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})})]})]})]})}const em="empresa_logo_url";function F0(t,e){let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}function IU(){const[t,e]=b.useState(()=>{try{return localStorage.getItem(em)||""}catch{return""}}),[n,r]=b.useState(null),[s,i]=b.useState(!1),a=b.useRef(null),l=b.useCallback(N=>{const C=N==null?void 0:N[0];if(!C)return;if(!C.type.startsWith("image/")){alert("Por favor selecciona una imagen (PNG/JPG/SVG/WebP).");return}r(C);const S=new FileReader;S.onload=E=>{var g;return e(String(((g=E.target)==null?void 0:g.result)||""))},S.readAsDataURL(C)},[]),c=N=>l(N.target.files),d=N=>{N.preventDefault(),N.stopPropagation(),i(!1),l(N.dataTransfer.files)},h=N=>{N.preventDefault(),i(!0)},f=()=>i(!1),m=()=>{var N;return(N=a.current)==null?void 0:N.click()},x=()=>{r(null),e("")},T=async()=>{try{t?(localStorage.setItem(em,t),F0("company-logo",t)):(localStorage.removeItem(em),F0("company-logo","")),alert("Logo guardado.")}catch(N){console.error(N),alert("No se pudo guardar localmente.")}};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Logo empresa"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:"Logo"}),o.jsxs("div",{className:"logo-wrap",children:[o.jsxs("div",{className:"logo-current",children:[o.jsx("div",{className:"emp-label",children:"Logo actual"}),o.jsx("div",{className:"logo-preview","aria-live":"polite",children:t?o.jsx("img",{src:t,alt:"Logo actual de la empresa"}):o.jsx("div",{className:"logo-empty",children:"Sin logo"})}),o.jsx("div",{className:"logo-actions",children:o.jsx("button",{type:"button",className:"oc-btn danger",onClick:x,disabled:!t,children:"Eliminar"})})]}),o.jsxs("div",{className:"logo-uploader",children:[o.jsx("div",{className:"emp-label",children:"Cargar foto"}),o.jsxs("div",{className:`logo-drop ${s?"over":""}`,onDragOver:h,onDragLeave:f,onDrop:d,onClick:m,role:"button",tabIndex:0,onKeyDown:N=>(N.key==="Enter"||N.key===" ")&&m(),"aria-label":"Arrastra o haz click para cargar la imagen del logo",children:[o.jsx("input",{ref:a,type:"file",accept:"image/*",onChange:c,style:{display:"none"}}),o.jsxs("div",{className:"logo-drop-hint",children:["Arrastra o click para cargar la foto.",o.jsx("div",{className:"logo-subhint",children:"Solo archivos de imagen"})]})]}),n&&o.jsxs("div",{className:"logo-file-name",children:["Archivo seleccionado: ",o.jsx("b",{children:n.name})]})]})]}),o.jsx("div",{className:"oc-form-actions",children:o.jsx("button",{type:"button",className:"oc-btn primary",onClick:T,children:"Guardar"})})]})]})}function SU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function TU(){b.useEffect(()=>{var r,s;(r=document.getElementById("lp-acciones-unificadas-icons26"))==null||r.remove(),(s=document.getElementById("lp-acciones-unificadas-icons_v2"))==null||s.remove();const t="lp-acciones-unificadas-icons_v2",e=`
      .lp-wrap{padding:0;}
      .lp-h2{margin:0 0 12px;font-weight:800;font-size:20px;color:#0f172a;}

      .lp-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;}
      .lp-pill{padding:7px 16px;border-radius:999px;border:1px solid #d1d5db;background:#fff;
        font-weight:600;color:#374151;cursor:pointer;font-size:14px;transition:.2s;}
      .lp-pill:hover{background:#f3f4f6;}
      .lp-pill.active{background:#2b6cb0;color:#fff;border-color:#2b6cb0;}

      .lp-card{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:18px;box-shadow:0 1px 2px rgba(0,0,0,.04);}
      .lp-card-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:12px;}
      .lp-subtitle{font-size:16px;font-weight:800;color:#111827;margin:0 0 8px;border-bottom:1px solid #e5e7eb;padding-bottom:6px;}

      .chip{display:inline-flex;align-items:center;gap:8px;height:34px;padding:0 12px;border-radius:999px;border:1px solid #d1d5db;
        background:#fff;color:#374151;font-weight:600;cursor:pointer;transition:.2s;white-space:nowrap;}
      .chip:hover{background:#f3f4f6;}
      .btn-soft{display:inline-flex;align-items:center;gap:6px;height:32px;padding:0 12px;border-radius:999px;border:none;cursor:pointer;
        font-weight:700;font-size:13px;background:#22c55e;color:#fff;}
      .btn-soft.gray{background:#6b7280;}
      .btn-soft:hover{filter:brightness(.95);}

      .lp-table-wrap{overflow-x:hidden;width:100%;}
      .lp-card table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:14px;}
      thead tr{background:#f9fafb;}
      th,td{padding:8px 10px;white-space:normal;word-break:break-word;vertical-align:middle;}
      th{text-align:left;border-bottom:1px solid #e5e7eb;font-weight:700;color:#475569;}
      tbody tr{border-top:1px solid #f1f5f9;}
      .muted{color:#6b7280;}

      /* Acciones unificadas */
      th.actions, td.actions{width:140px;text-align:right;}
      .lp-actions{display:flex;gap:8px;justify-content:flex-end;align-items:center;flex-wrap:nowrap;}

      .iconbtn{
        display:inline-flex;align-items:center;justify-content:center;
        width:32px;height:32px;border-radius:10px;border:1px solid transparent;cursor:pointer;transition:.15s;
      }
      .iconbtn.green{background:#ecfdf5;color:#0f9d5b;border-color:#bbf7d0;}
      .iconbtn.blue {background:#eff6ff;color:#1e3a8a;border-color:#bfdbfe;}
      .iconbtn.red  {background:#fef2f2;color:#b91c1c;border-color:#fecaca;}
      .iconbtn:hover{filter:brightness(.97);}

      /* cono grande */
      .iconbtn > svg{
        width:38px !important;
        height:38px !important;
        display:block;
        stroke-width:2.4;
        vector-effect: non-scaling-stroke;
        pointer-events:none;
      }

      .badge{display:inline-block;padding:5px 10px;border-radius:999px;font-weight:700;font-size:12px;line-height:1;}
      .badge.green{background:#e8f7ee;color:#16a34a;border:1px solid #cbead7;}

      /* ---------- Form (nuevo/editar) ---------- */
      .np-grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:6px;}
      .np-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
      .np-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
      .np-field{display:flex;flex-direction:column;gap:6px;}
      .np-label{font-weight:700;color:#334155;font-size:13px;}
      .np-input, .np-select, .np-text{
        border:1px solid #d1d5db;border-radius:8px;padding:8px 10px;font-size:14px;background:#fff;
      }
      .np-text{min-height:72px;resize:vertical;}
      .np-toggle{display:flex;align-items:center;gap:10px;}
      .np-card-img{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:6px;}
      .np-avatar{width:140px;height:140px;border-radius:12px;background:#e5e7eb;display:flex;align-items:center;justify-content:center;color:#64748b;}
      .np-drop{border:2px dashed #d1d5db;border-radius:12px;padding:16px;text-align:center;color:#64748b;}
      .np-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;}

      @media (max-width:900px){
        .np-row, .np-row-3{grid-template-columns:1fr;}
      }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}const f_=()=>o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("path",{d:"M12 20h9"}),o.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5z"})]}),p_=()=>o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),o.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),m_=()=>o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("polyline",{points:"3 6 5 6 21 6"}),o.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),o.jsx("path",{d:"M10 11v6M14 11v6"})]}),CU=()=>o.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:o.jsx("path",{d:"M20 6L9 17l-5-5"})});function NU(){const[t,e]=b.useState(!0),[n,r]=b.useState([]),[s,i]=b.useState("list"),[a,l]=b.useState(""),{pathname:c}=Mn(),d=is(),h=b.useMemo(()=>SU(c),[c]);b.useEffect(()=>{(async()=>{e(!0);try{const S=(await Ae(ue(J,"listas_precios"))).docs.map(E=>({id:E.id,...E.data()}));S.sort((E,g)=>String(g.actualizado||g.creado||"").localeCompare(String(E.actualizado||E.creado||""))),r(S)}finally{e(!1)}})()},[]);const f=async()=>{if(!a.trim())return alert("Escribe el nombre de la lista.");const C=new Date().toLocaleString("es-CO"),S={nombre:a.trim(),creado:C,actualizado:C,en_uso:!1,tipo:"clinicos"},E=await Bt(ue(J,"listas_precios"),S);r(g=>[{id:E.id,...S},...g]),l(""),i("list")},m=async C=>{const S=await Ae(ue(J,"listas_precios"));await Promise.all(S.docs.map(E=>Ut(De(J,"listas_precios",E.id),{en_uso:E.id===C.id}))),r(E=>E.map(g=>({...g,en_uso:g.id===C.id})))},x=async C=>{window.confirm(`Eliminar "${C==null?void 0:C.nombre}"?`)&&(await Tn(De(J,"listas_precios",C.id)),r(S=>S.filter(E=>E.id!==C.id)))},T=async C=>{const S=new Date().toLocaleString("es-CO"),{id:E,...g}=C,_={...g,nombre:`${(C==null?void 0:C.nombre)||"Lista"} (copia)`,en_uso:!1,creado:S,actualizado:S},O=await Bt(ue(J,"listas_precios"),_);r(L=>[{id:O.id,..._},...L])},N=C=>d(`${h}/config/lista-de-precios/editar/${C.id}`);return o.jsxs("div",{className:"lp-card",children:[o.jsx("h3",{className:"lp-subtitle",children:"Lista de precios clnicos"}),s==="list"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsxs("button",{className:"chip",onClick:()=>i("nuevo"),children:[o.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de precios"]}),o.jsx("button",{className:"chip",onClick:()=>alert("Exportar plantilla (prximamente)"),children:"Exportar plantilla"})]})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Fecha de creacin"}),o.jsx("th",{children:"Fecha de actualizacin"}),o.jsx("th",{children:"En uso"}),o.jsx("th",{className:"actions",children:"Acciones"})]})}),o.jsx("tbody",{children:t?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center"},children:"Cargando"})}):n.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center"},className:"muted",children:"Sin datos"})}):n.map(C=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:600},children:(C==null?void 0:C.nombre)||""}),o.jsx("td",{children:(C==null?void 0:C.creado)||""}),o.jsx("td",{children:(C==null?void 0:C.actualizado)||""}),o.jsx("td",{children:C!=null&&C.en_uso?o.jsx("span",{className:"badge green",children:"En uso"}):o.jsxs("button",{className:"btn-soft",onClick:()=>m(C),title:"Usar esta lista",children:[o.jsx(CU,{})," Usar"]})}),o.jsx("td",{className:"actions",children:o.jsxs("div",{className:"lp-actions",children:[o.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>T(C),"aria-label":"Clonar",children:o.jsx(p_,{})}),o.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>N(C),"aria-label":"Editar",children:o.jsx(f_,{})}),o.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>x(C),"aria-label":"Eliminar",children:o.jsx(m_,{})})]})})]},C.id))})]})})]}):o.jsxs("div",{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("h4",{style:{margin:0,fontWeight:700},children:"Nueva lista de precios"}),o.jsx("button",{className:"chip",onClick:()=>i("list"),children:" Volver"})]}),o.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",maxWidth:560,marginTop:10},children:[o.jsx("input",{type:"text",placeholder:"Nombre de la lista",value:a,onChange:C=>l(C.target.value),style:{flex:1,border:"1px solid #d1d5db",borderRadius:8,padding:"8px 10px"}}),o.jsx("button",{type:"button",title:"Sugerir nombre automtico",className:"chip",onClick:()=>l("Lista de precios "+new Date().toLocaleDateString("es-CO")),children:""}),o.jsx("button",{className:"btn-soft",onClick:f,children:"Guardar"})]})]})]})}function jU(){const[t,e]=b.useState([]),[n,r]=b.useState("list"),[s,i]=b.useState(null),[a,l]=b.useState(null),c={nombre:"",referencia:"",descripcion:"",cuentaContable:"",categoria:"",esServicio:!1,precioCompra:"",marca:"",principioActivo:"",registroInvima:"",formaFarmaceutica:"",concentracion:"",presentacionComercial:"",tempAlmacenamiento:"",unidadTemperatura:"",humedadAlmacenamiento:"",unidadHumedad:"",esInventariable:!1,clasificacionRiesgo:"",vidaUtil:"",periodicidadMantenimiento:"",periodicidadCalibracion:"",extTexto1:"",extTexto2:"",extNumero1:"",extNumero2:"",extFecha1:"",extFecha2:""},[d,h]=b.useState(c);b.useEffect(()=>{(async()=>{try{const _=(await Ae(ue(J,"listas_precios_productos"))).docs.map(O=>({id:O.id,...O.data()}));e(_)}catch{e([])}})()},[]);const f=async g=>{const{id:_,...O}=g,L=await Bt(ue(J,"listas_precios_productos"),{...O,nombre:`${(g==null?void 0:g.nombre)||"Producto"} (copia)`,creado:new Date().toISOString()});e(v=>[{id:L.id,...O,nombre:`${(g==null?void 0:g.nombre)||"Producto"} (copia)`},...v])},m=async g=>{window.confirm(`Eliminar "${g==null?void 0:g.nombre}"?`)&&(await Tn(De(J,"listas_precios_productos",g.id)),e(_=>_.filter(O=>O.id!==g.id)))},x=g=>{var L;const _=(L=g.target.files)==null?void 0:L[0];if(!_)return;const O=new FileReader;O.onload=()=>i(O.result),O.readAsDataURL(_)},T=async()=>{if(!d.nombre.trim())return alert("El nombre es obligatorio.");const g={...d,precioCompra:d.precioCompra===""?0:Number(d.precioCompra),creado:new Date().toISOString(),imgPreview:s||null},_=await Bt(ue(J,"listas_precios_productos"),g);e(O=>[{id:_.id,...g},...O]),h(c),i(null),r("list"),alert("Producto guardado.")},N=g=>{l(g.id),h({nombre:g.nombre||"",referencia:g.referencia||"",descripcion:g.descripcion||"",cuentaContable:g.cuentaContable||"",categoria:g.categoria||"",esServicio:!!g.esServicio,precioCompra:g.precioCompra??"",marca:g.marca||"",principioActivo:g.principioActivo||"",registroInvima:g.registroInvima||"",formaFarmaceutica:g.formaFarmaceutica||"",concentracion:g.concentracion||"",presentacionComercial:g.presentacionComercial||"",tempAlmacenamiento:g.tempAlmacenamiento||"",unidadTemperatura:g.unidadTemperatura||"",humedadAlmacenamiento:g.humedadAlmacenamiento||"",unidadHumedad:g.unidadHumedad||"",esInventariable:!!g.esInventariable,clasificacionRiesgo:g.clasificacionRiesgo||"",vidaUtil:g.vidaUtil||"",periodicidadMantenimiento:g.periodicidadMantenimiento||"",periodicidadCalibracion:g.periodicidadCalibracion||"",extTexto1:g.extTexto1||"",extTexto2:g.extTexto2||"",extNumero1:g.extNumero1??"",extNumero2:g.extNumero2??"",extFecha1:g.extFecha1||"",extFecha2:g.extFecha2||""}),i(g.imgPreview||null),r("editar")},C=async()=>{if(!a)return;if(!d.nombre.trim())return alert("El nombre es obligatorio.");const g={...d,precioCompra:d.precioCompra===""?0:Number(d.precioCompra),actualizado:new Date().toISOString(),imgPreview:s||null};await Ut(De(J,"listas_precios_productos",a),g),e(_=>_.map(O=>O.id===a?{id:a,...g}:O)),l(null),h(c),i(null),r("list"),alert("Producto actualizado.")},S=n==="editar"?"Editar producto":"Nuevo producto",E=n==="editar"?C:T;return o.jsxs("div",{className:"lp-card",children:[o.jsx("h3",{className:"lp-subtitle",children:"Lista de precios productos"}),n==="list"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsxs("button",{className:"chip",onClick:()=>{h(c),i(null),r("nuevo")},children:[o.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo producto"]}),o.jsx("button",{className:"chip",onClick:()=>alert("Exportar plantilla (prximamente)"),children:"Exportar plantilla"})]})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Marca"}),o.jsx("th",{children:"Descripcin"}),o.jsx("th",{className:"actions",children:"Acciones"})]})}),o.jsx("tbody",{children:t.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(g=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:600},children:(g==null?void 0:g.nombre)||""}),o.jsx("td",{children:(g==null?void 0:g.marca)||""}),o.jsx("td",{children:(g==null?void 0:g.descripcion)||""}),o.jsx("td",{className:"actions",children:o.jsxs("div",{className:"lp-actions",children:[o.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>f(g),"aria-label":"Clonar",children:o.jsx(p_,{})}),o.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>N(g),"aria-label":"Editar",children:o.jsx(f_,{})}),o.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>m(g),"aria-label":"Eliminar",children:o.jsx(m_,{})})]})})]},g.id))})]})})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("h4",{style:{margin:0,fontWeight:700},children:S}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"btn-soft gray",onClick:()=>{r("list"),l(null),h(c),i(null)},children:" Volver"}),o.jsx("button",{className:"btn-soft",onClick:E,children:n==="editar"?"Actualizar":"Guardar"})]})]}),o.jsxs("div",{className:"np-card-img",children:[o.jsx("div",{className:"np-avatar",children:s?o.jsx("img",{src:s,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12}}):o.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[o.jsx("circle",{cx:"12",cy:"8",r:"4"}),o.jsx("path",{d:"M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6"})]})}),o.jsxs("div",{className:"np-drop",children:[o.jsxs("div",{style:{marginBottom:6},children:["Arrastra o haz click para cargar la foto.",o.jsx("br",{}),"Solo archivos de imgenes"]}),o.jsx("input",{type:"file",accept:"image/*",onChange:x})]})]}),o.jsxs("div",{className:"np-grid",children:[o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Nombre*"}),o.jsx("input",{className:"np-input",value:d.nombre,onChange:g=>h({...d,nombre:g.target.value}),placeholder:"Nombre del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Referencia"}),o.jsx("input",{className:"np-input",value:d.referencia,onChange:g=>h({...d,referencia:g.target.value}),placeholder:"Referencia del concepto"})]})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Descripcin"}),o.jsx("textarea",{className:"np-text",value:d.descripcion,onChange:g=>h({...d,descripcion:g.target.value}),placeholder:"Descripcin del concepto"})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Cuenta contable"}),o.jsx("input",{className:"np-input",value:d.cuentaContable,onChange:g=>h({...d,cuentaContable:g.target.value}),placeholder:"Buscar tem..."})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Categora*"}),o.jsxs("select",{className:"np-select",value:d.categoria,onChange:g=>h({...d,categoria:g.target.value}),children:[o.jsx("option",{value:"",children:"Seleccione..."}),o.jsx("option",{children:"Medicamentos"}),o.jsx("option",{children:"Insumos"}),o.jsx("option",{children:"Equipos"})]})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field np-toggle",children:[o.jsx("label",{className:"np-label",style:{margin:0},children:"Es servicio?"}),o.jsx("input",{type:"checkbox",checked:d.esServicio,onChange:g=>h({...d,esServicio:g.target.checked})})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Precio compra*"}),o.jsx("input",{className:"np-input",type:"number",value:d.precioCompra,onChange:g=>h({...d,precioCompra:g.target.value}),placeholder:"$0"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Marca"}),o.jsx("input",{className:"np-input",value:d.marca,onChange:g=>h({...d,marca:g.target.value}),placeholder:"Marca del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Principio activo"}),o.jsx("input",{className:"np-input",value:d.principioActivo,onChange:g=>h({...d,principioActivo:g.target.value}),placeholder:"Principio activo del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Registro Invima"}),o.jsx("input",{className:"np-input",value:d.registroInvima,onChange:g=>h({...d,registroInvima:g.target.value}),placeholder:"Informacin Invima del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Forma farmacutica"}),o.jsx("input",{className:"np-input",value:d.formaFarmaceutica,onChange:g=>h({...d,formaFarmaceutica:g.target.value}),placeholder:"Forma farmacutica del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Concentracin"}),o.jsx("input",{className:"np-input",value:d.concentracion,onChange:g=>h({...d,concentracion:g.target.value}),placeholder:"Concentracin del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Presentacin comercial"}),o.jsx("input",{className:"np-input",value:d.presentacionComercial,onChange:g=>h({...d,presentacionComercial:g.target.value}),placeholder:"Presentacin com. del concepto"})]})]}),o.jsxs("div",{className:"np-row-3",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Temperatura de almacenamiento"}),o.jsx("input",{className:"np-input",value:d.tempAlmacenamiento,onChange:g=>h({...d,tempAlmacenamiento:g.target.value}),placeholder:"Temperatura de almacenamiento"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Unidad de temperatura"}),o.jsx("input",{className:"np-input",value:d.unidadTemperatura,onChange:g=>h({...d,unidadTemperatura:g.target.value}),placeholder:"Unidad de temp. del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Humedad de almacenamiento"}),o.jsx("input",{className:"np-input",value:d.humedadAlmacenamiento,onChange:g=>h({...d,humedadAlmacenamiento:g.target.value}),placeholder:"Humedad de almacenamiento"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Unidad de humedad"}),o.jsx("input",{className:"np-input",value:d.unidadHumedad,onChange:g=>h({...d,unidadHumedad:g.target.value}),placeholder:"Unidad de hum. del concepto"})]}),o.jsxs("div",{className:"np-field np-toggle",children:[o.jsx("label",{className:"np-label",style:{margin:0},children:"Es inventariable?"}),o.jsx("input",{type:"checkbox",checked:d.esInventariable,onChange:g=>h({...d,esInventariable:g.target.checked})})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Clasificacin de riesgo"}),o.jsx("input",{className:"np-input",value:d.clasificacionRiesgo,onChange:g=>h({...d,clasificacionRiesgo:g.target.value}),placeholder:"Clasif. riesgo del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Vida til"}),o.jsx("input",{className:"np-input",value:d.vidaUtil,onChange:g=>h({...d,vidaUtil:g.target.value}),placeholder:"Vida til del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Periodicidad mantenimiento"}),o.jsx("input",{className:"np-input",value:d.periodicidadMantenimiento,onChange:g=>h({...d,periodicidadMantenimiento:g.target.value}),placeholder:"Periodicidad mant. del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Periodicidad calibracin"}),o.jsx("input",{className:"np-input",value:d.periodicidadCalibracion,onChange:g=>h({...d,periodicidadCalibracion:g.target.value}),placeholder:"Periodicidad cal. del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin texto 1"}),o.jsx("input",{className:"np-input",value:d.extTexto1,onChange:g=>h({...d,extTexto1:g.target.value}),placeholder:"Ext. texto 1 del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin texto 2"}),o.jsx("input",{className:"np-input",value:d.extTexto2,onChange:g=>h({...d,extTexto2:g.target.value}),placeholder:"Ext. texto 2 del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin nmero 1"}),o.jsx("input",{className:"np-input",type:"number",value:d.extNumero1,onChange:g=>h({...d,extNumero1:g.target.value}),placeholder:"Ext. nmero 1 del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin nmero 2"}),o.jsx("input",{className:"np-input",type:"number",value:d.extNumero2,onChange:g=>h({...d,extNumero2:g.target.value}),placeholder:"Ext. nmero 2 del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin fecha 1 (dd/mm/aaaa)"}),o.jsx("input",{className:"np-input",type:"date",value:d.extFecha1,onChange:g=>h({...d,extFecha1:g.target.value})})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin fecha 2 (dd/mm/aaaa)"}),o.jsx("input",{className:"np-input",type:"date",value:d.extFecha2,onChange:g=>h({...d,extFecha2:g.target.value})})]})]}),o.jsxs("div",{className:"np-actions",children:[o.jsx("button",{className:"btn-soft gray",onClick:()=>{r("list"),l(null),h(c),i(null)},children:"Cancelar"}),o.jsx("button",{className:"btn-soft",onClick:E,children:n==="editar"?"Actualizar":"Guardar"})]})]})]})]})}function AU(){const[t,e]=b.useState([]);b.useEffect(()=>{(async()=>{try{const i=(await Ae(ue(J,"listas_precios_servicios"))).docs.map(a=>({id:a.id,...a.data()}));e(i)}catch{e([])}})()},[]);const n=async s=>{const{id:i,...a}=s,l=await Bt(ue(J,"listas_precios_servicios"),{...a,nombre:`${(s==null?void 0:s.nombre)||"Servicio"} (copia)`});e(c=>[{id:l.id,...a,nombre:`${(s==null?void 0:s.nombre)||"Servicio"} (copia)`},...c])},r=async s=>{window.confirm(`Eliminar "${s==null?void 0:s.nombre}"?`)&&(await Tn(De(J,"listas_precios_servicios",s.id)),e(i=>i.filter(a=>a.id!==s.id)))};return o.jsxs("div",{className:"lp-card",children:[o.jsx("h3",{className:"lp-subtitle",children:"Lista de precios servicios"}),o.jsxs("div",{className:"lp-card-header",children:[o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsxs("button",{className:"chip",onClick:()=>alert("Nuevo listado de servicios (prximamente)"),children:[o.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de servicios"]}),o.jsx("button",{className:"chip",onClick:()=>alert("Exportar plantilla (prximamente)"),children:"Exportar plantilla"})]})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Marca"}),o.jsx("th",{children:"Descripcin"}),o.jsx("th",{className:"actions",children:"Acciones"})]})}),o.jsx("tbody",{children:t.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(s=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:600},children:(s==null?void 0:s.nombre)||""}),o.jsx("td",{children:(s==null?void 0:s.marca)||""}),o.jsx("td",{children:(s==null?void 0:s.descripcion)||""}),o.jsx("td",{className:"actions",children:o.jsxs("div",{className:"lp-actions",children:[o.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>n(s),"aria-label":"Clonar",children:o.jsx(p_,{})}),o.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>alert("Editar servicio (prx.)"),"aria-label":"Editar",children:o.jsx(f_,{})}),o.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>r(s),"aria-label":"Eliminar",children:o.jsx(m_,{})})]})})]},s.id))})]})})]})}function _1(){TU();const[t,e]=b.useState("clinicos");return o.jsxs("div",{className:"lp-wrap",children:[o.jsx("h2",{className:"lp-h2",children:"Configuracin  Lista de precios"}),o.jsxs("div",{className:"lp-tabs",children:[o.jsx("button",{className:`lp-pill ${t==="clinicos"?"active":""}`,onClick:()=>e("clinicos"),children:"Lista de precios clnicos"}),o.jsx("button",{className:`lp-pill ${t==="productos"?"active":""}`,onClick:()=>e("productos"),children:"Lista de precios productos"}),o.jsx("button",{className:`lp-pill ${t==="servicios"?"active":""}`,onClick:()=>e("servicios"),children:"Lista de precios servicios"})]}),t==="productos"?o.jsx(jU,{}):t==="servicios"?o.jsx(AU,{}):o.jsx(NU,{})]})}function RU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}const tm=[{nombre:"Rehabilitacin Oral",comentario:""},{nombre:"Implantologa",comentario:""},{nombre:"Ciruga Oral",comentario:""},{nombre:"Periodoncia",comentario:""},{nombre:"Endodoncia",comentario:""},{nombre:"Ortodoncia",comentario:""},{nombre:"Odontologa General",comentario:""},{nombre:"Radiologa",comentario:""},{nombre:"Psicologa",comentario:""}],U0=[{codigo:"1",nombre:"Activos"},{codigo:"2",nombre:"Pasivos"},{codigo:"3",nombre:"Patrimonio"},{codigo:"4",nombre:"Ingresos"},{codigo:"5",nombre:"Gastos"},{codigo:"6",nombre:"Costos de ventas"},{codigo:"7",nombre:"Costos de produccin"},{codigo:"8",nombre:"Cuentas de orden deudoras"},{codigo:"9",nombre:"Cuentas de orden acreedoras"}],$0=t=>De(J,"listas_precios",t),Ul=t=>ue(J,"listas_precios",t,"categorias"),Ir=(t,e)=>ue(J,"listas_precios",t,"categorias",e,"items");function PU(){b.useEffect(()=>{var r;const t="lp-edit-inline";(r=document.getElementById(t))==null||r.remove();const e=`
      .oc-main-content.lp { padding:16px 20px }
      .oc-section-title { margin-bottom:16px }
      .oc-section-title h2 { margin:0; font-weight:800; font-size:20px; color:#0f172a }
      .card { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.04) }
      .toolbar { display:flex; gap:8px; align-items:center; }

      .chip { height:34px; padding:0 12px; border-radius:999px; border:1px solid #e5e7eb; cursor:pointer; font-weight:600; background:#f9fafb; transition:.15s }
      .chip:hover { background:#e5e7eb }
      .chip.blue   { background:#3b82f6; color:#fff; border:none }
      .chip.green  { background:#22c55e; color:#fff; border:none }
      .chip.orange { background:#f59e0b; color:#fff; border:none }
      .chip.gray   { background:#64748b; color:#fff; border:none }

      .name-row { display:flex; align-items:center; gap:8px; }
      .text-inp { height:38px; padding:0 10px; border-radius:8px; border:1px solid #cbd5e1; outline:none; width:280px }

      .table-responsive { width:100%; overflow-x:auto }
      table { width:100%; border-collapse:collapse; font-size:.9rem }
      thead tr { background:#f1f5f9 }
      th, td { padding:10px 12px; white-space:nowrap; vertical-align:middle }
      th { text-align:left; border-bottom:1px solid #e2e8f0; color:#475569; font-weight:700 }
      tr + tr { border-top:1px solid #e2e8f0 }
      .muted { color:#64748b }
      .status-pill { padding:2px 8px; border-radius:999px; font-weight:600 }
      .status-on { background:#dcfce7; color:#166534 }
      .status-off{ background:#fee2e2; color:#991b1b }

      .btn { padding:4px 8px; border:none; border-radius:6px; color:#fff; cursor:pointer; margin-right:6px; font-weight:600; transition:.12s }
      .btn:hover { opacity:.9 }
      .btn.blue   { background:#3b82f6 }
      .btn.green  { background:#22c55e }
      .btn.orange { background:#f59e0b }
      .btn.red    { background:#ef4444 }
      .btn.sky    { background:#06b6d4 }
      .btn.sm { height:32px; padding:0 10px; border-radius:8px }

      .toggle-cell{width:34px}
      .arrow{font-weight:900;font-size:18px;opacity:.7;cursor:pointer;display:inline-block}
      .row-cat-actions{display:flex;gap:6px;justify-content:flex-end}

      .cat-details{background:#fafafa}
      .inner-table{width:100%; border-collapse:collapse; font-size:.88rem}
      .inner-table th, .inner-table td{padding:8px 10px}
      .inner-table thead tr{background:#f8fafc}
      .inner-actions{display:flex;gap:6px;justify-content:flex-end}
      .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

      /* Modal base */
      .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:999}
      .modal{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(880px,94vw);padding:0;border:1px solid #e5e7eb}
      .modal .hd{padding:12px 16px;border-bottom:1px solid #e5e7eb;font-weight:700}
      .modal .bd{padding:16px}
      .modal .ft{padding:12px 16px;border-top:1px solid #e5e7eb;display:flex;gap:8px;justify-content:flex-end}

      /*  Grilla de 3 columnas con field (label arriba, input abajo)  */
      .form-grid-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; align-items:start; }
      .field{ display:flex; flex-direction:column; gap:6px }
      .field label{ font-weight:700; color:#0f172a }

      .form-row-full{ margin-top:12px }

      .inp{height:36px;border:1px solid #cbd5e1;border-radius:8px;padding:0 10px;outline:none;width:100%}
      .ta{border:1px solid #cbd5e1;border-radius:8px;padding:8px;min-height:84px;outline:none;width:100%}

      /* Toggle simple / pill */
      .toggle{display:inline-flex;align-items:center;gap:10px}
      .toggle-pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #cbd5e1;border-radius:999px;padding:2px 8px;height:32px}
      .toggle-pill span{font-weight:700}

      /* Autocomplete */
      .ac-wrap{position:relative}
      .ac-list{
        position:absolute; z-index:1000; top:100%; left:0; right:0;
        background:#fff; border:1px solid #e5e7eb; border-radius:10px;
        box-shadow:0 8px 30px rgba(0,0,0,.12);
        max-height:240px; overflow:auto; margin-top:4px;
      }
      .ac-item{padding:8px 12px; cursor:pointer; display:flex; gap:8px; align-items:center}
      .ac-item:hover{background:#f1f5f9}
      .ac-code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-weight:700; color:#0f172a}
      .ac-name{color:#334155}
      .ac-empty{padding:10px 12px; color:#64748b}

      /*  Selector % | $ para Mximo descuento  */
      .seg-wrap{ display:flex; align-items:center; gap:8px; }
      .seg{ user-select:none; cursor:pointer; border:1px solid #cbd5e1; border-radius:8px; height:36px; min-width:44px; display:flex; align-items:center; justify-content:center; padding:0 10px; font-weight:700; color:#334155; background:#fff; }
      .seg.on{ background:#0ea5e9; color:#fff; border-color:#0ea5e9; }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}const us=(t="")=>t==null?void 0:t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function Zo(t){let e=String(t||"").replace(/\D/g,"");return e===""?"":(e=e.replace(/^0+(?=\d)/,""),e.replace(/\B(?=(\d{3})+(?!\d))/g,"."))}function nm({value:t,onChange:e,placeholder:n,suggestions:r=[],getLabel:s=c=>(c==null?void 0:c.nombre)||"",onPick:i,renderRow:a,minChars:l=1}){const[c,d]=b.useState(!1),h=b.useRef(null);b.useEffect(()=>{function m(x){h.current&&!h.current.contains(x.target)&&d(!1)}return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const f=c&&((t==null?void 0:t.length)||0)>=l;return o.jsxs("div",{className:"ac-wrap",ref:h,children:[o.jsx("input",{className:"inp",value:t,placeholder:n,onChange:m=>{e(m.target.value),d(!0)},onFocus:()=>d(!0)}),f&&o.jsx("div",{className:"ac-list",children:r.length===0?o.jsx("div",{className:"ac-empty",children:"Sin resultados"}):r.map((m,x)=>o.jsx("div",{className:"ac-item",onClick:()=>{i==null||i(m),d(!1)},children:a?a(m):o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",children:m.codigo}),o.jsx("span",{className:"ac-name",children:s(m)})]})},x))})]})}function kU(t){PU();const e=BR(),n=(t==null?void 0:t.listaId)??e.id??e.listaId??e.priceListId??e.listId??null,{pathname:r}=Mn(),s=is(),a=`${b.useMemo(()=>RU(r),[r])}/config/lista-de-precios`,[l,c]=b.useState(""),[d,h]=b.useState(!1),[f,m]=b.useState([]),[x,T]=b.useState(!0),[N,C]=b.useState(""),[S,E]=b.useState(!1),[g,_]=b.useState(!1),[O,L]=b.useState(!1),[v,w]=b.useState(null),[I,R]=b.useState("create"),[P,V]=b.useState(null),k={codigo:"",nombre:"",precio:"",observaciones:"",usa_pago_fijo:!1,pago_valor_fijo:"0",permite_descuento:!1,genera_rips:!1,es_consulta:!1,ver_en_agenda:!1,cuenta_contable:"",max_descuento_tipo:"pct",max_descuento_value:""},[M,ge]=b.useState(k),[oe,Oe]=b.useState([]),[Q]=b.useState(U0),[le,ce]=b.useState(0),[_e,Ie]=b.useState("none"),[fe,ye]=b.useState("existentes"),[Le,We]=b.useState([]),[Re,Je]=b.useState(""),[gt,q]=b.useState("");b.useEffect(()=>{async function D(){if(!n){C("Ruta invlida: falta el id de la lista."),T(!1);return}T(!0);try{const U=await Co($0(n));c(U.exists()&&U.data().nombre||"")}catch{c(""),C("No se pudo cargar la lista. Revisa la ruta y permisos.")}try{const ee=(await Ae(Ul(n))).docs.map(ae=>({id:ae.id,expanded:!1,itemsLoaded:!1,items:[],activa:ae.data().activa??!0,...ae.data()}));ee.sort((ae,Pe)=>(ae.nombre||"").localeCompare(Pe.nombre||"")),m(ee)}finally{T(!1)}}D()},[n]),b.useEffect(()=>{async function D(){try{const ee=(await Ae(ue(J,"catalogo_procedimientos"))).docs.map(ae=>({id:ae.id,...ae.data()})).filter(ae=>ae.codigo&&ae.nombre);Oe(ee)}catch{Oe([])}}D()},[]);async function pe(){try{if(!n)return;h(!0),await Ut($0(n),{nombre:(l||"").trim(),actualizado:new Date().toLocaleString("es-CO")})}catch{alert("No se pudo actualizar el nombre.")}finally{h(!1)}}async function xe(D){if(m(U=>U.map(ee=>ee.id===D.id?{...ee,expanded:!ee.expanded}:ee)),!D.itemsLoaded&&n){const U=await Ae(Ir(n,D.id)).catch(()=>null),ee=U?U.docs.map(ae=>({id:ae.id,...ae.data()})):[];m(ae=>ae.map(Pe=>Pe.id===D.id?{...Pe,items:ee,itemsLoaded:!0}:Pe))}}async function Y(D){if(!n)return;const U=(prompt("Editar nombre de la categora:",D.nombre)||"").trim();if(!U)return;const ee=(prompt("Comentario (opcional):",D.comentario||"")||"").trim();await Ut(De(Ul(n),D.id),{nombre:U,comentario:ee}),m(ae=>ae.map(Pe=>Pe.id===D.id?{...Pe,nombre:U,comentario:ee}:Pe))}async function Z(D){if(!n||!confirm(`Eliminar categora "${D.nombre}" y TODOS sus tems?`))return;const U=await Ae(Ir(n,D.id)).catch(()=>null);U&&await Promise.all(U.docs.map(ee=>Tn(De(Ir(n,D.id),ee.id)))),await Tn(De(Ul(n),D.id)),m(ee=>ee.filter(ae=>ae.id!==D.id))}async function Te(D){if(!n)return;const U=prompt("Ajuste porcentual (ej.: 5 para +5%, -10 para -10%)","5");if(U==null)return;const ee=Number(U);if(Number.isNaN(ee))return alert("Valor invlido.");const ae=await Ae(Ir(n,D.id)).catch(()=>null);ae&&(await Promise.all(ae.docs.map(async Pe=>{const ke=Pe.data()||{},Be=Math.round(Number(ke.precio||0)*(1+ee/100));await Ut(De(Ir(n,D.id),Pe.id),{precio:Be,actualizado:new Date().toLocaleString("es-CO")})})),m(Pe=>Pe.map(ke=>ke.id===D.id?{...ke,items:ke.items.map(Be=>({...Be,precio:Math.round(Number(Be.precio||0)*(1+ee/100))}))}:ke)),alert("Precios actualizados."))}function ve(D){w(D),R("create"),V(null),ge(k),L(!0)}function K(D,U){w(D),R("edit"),V(U.id);let ee="pct",ae="";const Pe=Number(U.max_descuento_pct||0),ke=Number(U.max_descuento_valor||0);ke>0?(ee="valor",ae=String(ke)):Pe>0&&(ee="pct",ae=String(Pe)),ge({codigo:U.codigo||"",nombre:U.nombre||"",precio:Zo(U.precio||0),observaciones:U.comentario||"",usa_pago_fijo:!!U.usa_pago_fijo,pago_valor_fijo:String(U.pago_valor_fijo??"0"),permite_descuento:!!U.permite_descuento,genera_rips:!!U.genera_rips,es_consulta:!!U.es_consulta,ver_en_agenda:!!U.ver_en_agenda,cuenta_contable:U.cuenta_contable||"",max_descuento_tipo:ee,max_descuento_value:ee==="valor"?Zo(ae):ae}),L(!0)}async function X(){if(!n||!v)return;if(!M.nombre.trim())return alert("El nombre es obligatorio.");const D=Pe=>Number(String(Pe).replace(/\D/g,""))||0;let U=0,ee=0;M.permite_descuento&&(M.max_descuento_tipo==="pct"?U=Math.max(0,Number(String(M.max_descuento_value).replace(",",".")||0)):ee=D(M.max_descuento_value));const ae={codigo:M.codigo.trim(),nombre:M.nombre.trim(),permite_descuento:!!M.permite_descuento,max_descuento_pct:U,max_descuento_valor:ee,genera_rips:!!M.genera_rips,es_consulta:!!M.es_consulta,ver_en_agenda:!!M.ver_en_agenda,cuenta_contable:M.cuenta_contable.trim(),comentario:M.observaciones.trim(),precio:D(M.precio),usa_pago_fijo:!!M.usa_pago_fijo,pago_valor_fijo:D(M.pago_valor_fijo),actualizado:new Date().toLocaleString("es-CO")};if(I==="create"){const Pe=await Bt(Ir(n,v.id),{...ae,creado:new Date().toLocaleString("es-CO")});m(ke=>ke.map(Be=>Be.id===v.id?{...Be,items:[...Be.items,{id:Pe.id,...ae}],expanded:!0}:Be))}else await Ut(De(Ir(n,v.id),P),ae),m(Pe=>Pe.map(ke=>ke.id===v.id?{...ke,items:ke.items.map(Be=>Be.id===P?{...Be,...ae,id:P}:Be)}:ke));L(!1)}async function B(D,U){n&&confirm(`Eliminar "${U.nombre}"?`)&&(await Tn(De(Ir(n,D.id),U.id)),m(ee=>ee.map(ae=>ae.id===D.id?{...ae,items:ae.items.filter(Pe=>Pe.id!==U.id)}:ae)))}async function me(){try{const D=ue(J,"catalogo_categorias");for(const U of tm){const ee=`${U.nombre}`.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-");await No(De(D,ee),{nombre:U.nombre,comentario:U.comentario||""},{merge:!0})}alert("Catlogo base creado/actualizado. Vuelve a abrir 'Categoras existentes'.")}catch{alert("No se pudo sembrar el catlogo base.")}}async function Me(){_(!0),ye("existentes"),Je(""),q("");try{const U=(await Ae(ue(J,"catalogo_categorias"))).docs.map(ee=>({id:ee.id,...ee.data()}));We(U.length?U:tm.map((ee,ae)=>({id:`def-${ae}`,...ee})))}catch{We(tm.map((D,U)=>({id:`def-${U}`,...D})))}}async function ze(D){if(n)try{const U=Ul(n);await Bt(U,{nombre:D.nombre,comentario:D.comentario||"",activa:!0,creado:new Date().toLocaleString("es-CO")});const ee=await Ae(U);m(ee.docs.map(ae=>({id:ae.id,...ae.data(),activa:ae.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),alert("Categora agregada.")}catch{alert("No se pudo agregar la categora.")}}async function Fe(){if(n){if(!Re.trim())return alert("Escribe el nombre de la categora.");try{const D=Ul(n);await Bt(D,{nombre:Re.trim(),comentario:gt.trim(),activa:!0,creado:new Date().toLocaleString("es-CO")});const U=await Ae(D);m(U.docs.map(ee=>({id:ee.id,...ee.data(),activa:ee.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),_(!1)}catch{alert("No se pudo crear la categora.")}}}function Ke(){return new Promise(D=>{if(typeof window<"u"&&window.XLSX)return D(window.XLSX);const U=document.createElement("script");U.src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js",U.onload=()=>D(window.XLSX||null),U.onerror=()=>D(null),document.head.appendChild(U)})}function we(D,U){return U==="up"?Math.ceil(D):U==="down"?Math.floor(D):D}async function lt(){if(!n)return;const D=Number(le);if(!Number.isFinite(D))return alert("Ingresa un porcentaje vlido.");try{for(const U of f){const ee=await Ae(Ir(n,U.id)).catch(()=>null);if(ee)for(const ae of ee.docs){const Pe=ae.data()||{},ke=we(Number(Pe.precio||0)*(1+D/100),_e);await Ut(De(Ir(n,U.id),ae.id),{precio:ke,actualizado:new Date().toLocaleString("es-CO")})}}alert("Precios actualizados."),E(!1)}catch{alert("No se pudo aplicar el incremento.")}}async function Ze(){try{if(!n)return;const D=["Categora","Cdigo","Nombre","Permite desc","Precio","Genera RIPS","Es consulta","Ver en agenda","Nombre en la agenda","Tiempo","Identificador","Cuenta contable"],U=[],ee=`OdontoCloud  Lista de precios  ${l||"Principal"}`,ae=`Exportado: ${new Date().toLocaleString("es-CO")}`;U.push([ee]),U.push([ae]),U.push([]),U.push(D);const Pe=4,ke=rt=>rt?"si":"no";for(const rt of f){const dt=await Ae(Ir(n,rt.id)).catch(()=>null),Lt=dt?dt.docs.map(Qe=>({id:Qe.id,...Qe.data()})):[];for(const Qe of Lt)U.push([rt.nombre||"",Qe.codigo||"",Qe.nombre||"",ke(!!Qe.permite_descuento),Number(Qe.precio||0),ke(!!Qe.genera_rips),ke(!!Qe.es_consulta),ke(!!Qe.ver_en_agenda),Qe.nombre_en_agenda||"",Number(Qe.tiempo||0),Qe.identificador||"",Qe.cuenta_contable||""])}const Be=await Ke(),Ue=`OdontoCloud-ListaPrecios-${l||"Principal"}`;if(Be&&Be.utils&&U.length>Pe-1){const rt=Be.utils.aoa_to_sheet(U);rt["!cols"]=[{wch:22},{wch:14},{wch:36},{wch:12},{wch:14},{wch:12},{wch:12},{wch:14},{wch:28},{wch:10},{wch:16},{wch:18}],rt["!merges"]=[{s:{r:0,c:0},e:{r:0,c:11}},{s:{r:1,c:0},e:{r:1,c:11}}];const dt=U.length;rt["!autofilter"]={ref:`A${Pe}:L${dt}`};const Lt=Be.utils.book_new();Be.utils.book_append_sheet(Lt,rt,"Lista de precios");const Qe=Be.write(Lt,{bookType:"xlsx",type:"array"}),Kn=new Blob([Qe],{type:"application/octet-stream"}),Ht=document.createElement("a");Ht.href=URL.createObjectURL(Kn),Ht.download=`${Ue}.xlsx`,Ht.click(),URL.revokeObjectURL(Ht.href)}else{const rt=U.map(Qe=>Qe.map(Kn=>{const Ht=String(Kn??"").replace(/"/g,'""');return/[",\n]/.test(Ht)?`"${Ht}"`:Ht}).join(",")).join(`
`),dt=new Blob([rt],{type:"text/csv;charset=utf-8"}),Lt=document.createElement("a");Lt.href=URL.createObjectURL(dt),Lt.download=`${Ue}.csv`,Lt.click(),URL.revokeObjectURL(Lt.href)}}catch{alert("No se pudo exportar.")}}const xt=b.useMemo(()=>{const D=us(M.nombre);return D?oe.filter(U=>us(U.nombre).includes(D)||us(U.codigo).startsWith(D)).slice(0,12):[]},[M.nombre,oe]),z=b.useMemo(()=>{const D=us(M.codigo);return D?oe.filter(U=>us(U.codigo).startsWith(D)||us(U.nombre).includes(D)).slice(0,12):[]},[M.codigo,oe]),ie=b.useMemo(()=>{const D=us(M.cuenta_contable);return D?Q.filter(U=>us(U.codigo).startsWith(D)||us(U.nombre).includes(D)).slice(0,20):U0.slice(0,12)},[M.cuenta_contable,Q]);return o.jsxs("div",{className:"oc-main-content lp",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Edicin Lista de precios"})}),N&&o.jsx("div",{style:{marginBottom:12,padding:"8px 12px",border:"1px solid #fecaca",background:"#fef2f2",color:"#991b1b",borderRadius:8},children:N}),o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"toolbar",style:{justifyContent:"space-between",marginBottom:12},children:[o.jsxs("div",{className:"name-row",children:[o.jsx("label",{style:{fontWeight:700},children:"Nombre*"}),o.jsx("input",{className:"text-inp",value:l,placeholder:"Principal",onChange:D=>c(D.target.value)}),o.jsx("button",{className:"btn green",onClick:pe,disabled:d,title:"Guardar nombre",children:d?"Guardando":"Guardar"})]}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"chip orange",title:"Incrementar %",onClick:()=>{ce(0),Ie("none"),E(!0)},children:"%"}),o.jsx("button",{className:"chip green",onClick:Me,children:"+ Agregar categora"}),o.jsx("button",{className:"chip blue",title:"Exportar",onClick:Ze,children:"Exportar"})]})]}),o.jsx("div",{className:"table-responsive",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{className:"toggle-cell"}),o.jsx("th",{children:"Categora"}),o.jsx("th",{children:"Comentario"}),o.jsx("th",{style:{width:140},children:"Estado"}),o.jsx("th",{style:{width:360,textAlign:"right"},children:"Acciones"})]})}),o.jsx("tbody",{children:x?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):f.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Sin categoras."})}):f.map(D=>o.jsxs(Fh.Fragment,{children:[o.jsxs("tr",{children:[o.jsx("td",{className:"toggle-cell",children:o.jsx("span",{className:"arrow",onClick:()=>xe(D),children:D.expanded?"":""})}),o.jsx("td",{style:{fontWeight:700},children:D.nombre||"Categora"}),o.jsx("td",{className:"muted",children:D.comentario||""}),o.jsx("td",{children:o.jsx("span",{className:`status-pill ${D.activa?"status-on":"status-off"}`,children:D.activa?"Conectado":"Desconectado"})}),o.jsx("td",{style:{textAlign:"right"},children:o.jsxs("div",{className:"row-cat-actions",children:[o.jsx("button",{className:"btn green sm",title:"Nuevo tem",onClick:()=>ve(D),children:""}),o.jsx("button",{className:"btn orange sm",title:"Actualizar precios %",onClick:()=>Te(D),children:"%"}),o.jsx("button",{className:"btn sky sm",title:"Editar categora",onClick:()=>Y(D),children:""}),o.jsx("button",{className:"btn red sm",title:"Eliminar categora",onClick:()=>Z(D),children:""})]})})]}),D.expanded&&o.jsxs("tr",{className:"cat-details",children:[o.jsx("td",{}),o.jsx("td",{colSpan:4,children:o.jsx("div",{className:"table-responsive",children:o.jsxs("table",{className:"inner-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Lista de precios"}),o.jsx("th",{style:{width:160},children:"Permite descuento"}),o.jsx("th",{style:{width:140},children:"Precio"}),o.jsx("th",{style:{width:140,textAlign:"right"},children:"Acciones"})]})}),o.jsx("tbody",{children:!D.items||D.items.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"muted",style:{textAlign:"center",padding:12},children:"Sin tems en esta categora."})}):D.items.map(U=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:U.codigo||""}),o.jsx("td",{style:{fontWeight:600},children:U.nombre||""}),o.jsx("td",{children:U.permite_descuento?"S":"No"}),o.jsxs("td",{className:"mono",children:["$",Number(U.precio||0).toLocaleString("es-CO")]}),o.jsx("td",{style:{textAlign:"right"},children:o.jsxs("div",{className:"inner-actions",children:[o.jsx("button",{className:"btn sky sm",onClick:()=>K(D,U),children:""}),o.jsx("button",{className:"btn red sm",onClick:()=>B(D,U),children:""})]})})]},U.id))})]})})})]})]},D.id))})]})}),o.jsx("div",{style:{marginTop:16},children:o.jsx("button",{className:"chip gray",onClick:()=>s(a),children:" Volver"})})]}),g&&o.jsx("div",{className:"modal-mask",onClick:()=>_(!1),children:o.jsxs("div",{className:"modal",onClick:D=>D.stopPropagation(),children:[o.jsx("div",{className:"hd",children:"Categora"}),o.jsxs("div",{className:"bd",children:[o.jsxs("div",{className:"row",style:{gap:6,marginBottom:12},children:[o.jsx("button",{className:`chip ${fe==="existentes"?"blue":""}`,onClick:()=>ye("existentes"),children:"Categoras existentes"}),o.jsx("button",{className:`chip ${fe==="nueva"?"blue":""}`,onClick:()=>ye("nueva"),children:"Editar/Nueva categora"}),o.jsx("button",{className:"chip green",onClick:me,children:"Sembrar catlogo base"})]}),fe==="existentes"?o.jsx("div",{children:Le.length===0?o.jsx("p",{className:"muted",children:"No hay catlogo disponible. Puedes crear una nueva categora en la pestaa de la derecha."}):o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Comentario"}),o.jsx("th",{children:"Acciones"})]})}),o.jsx("tbody",{children:Le.map(D=>o.jsxs("tr",{children:[o.jsx("td",{children:D.nombre}),o.jsx("td",{className:"muted",children:D.comentario||""}),o.jsx("td",{children:o.jsx("button",{className:"btn green sm",onClick:()=>ze(D),children:"Agregar"})})]},D.id))})]})}):o.jsxs("div",{children:[o.jsxs("div",{className:"row",children:[o.jsx("label",{style:{minWidth:140},children:"Nombre *"}),o.jsx("input",{className:"inp",placeholder:"Ingrese el nombre de la categora",value:Re,onChange:D=>Je(D.target.value)})]}),o.jsxs("div",{className:"row",style:{alignItems:"flex-start"},children:[o.jsx("label",{style:{minWidth:140,paddingTop:6},children:"Comentario"}),o.jsx("textarea",{className:"ta",placeholder:"",value:gt,onChange:D=>q(D.target.value)})]})]})]}),o.jsxs("div",{className:"ft",children:[o.jsx("button",{className:"chip gray",onClick:()=>_(!1),children:"Cerrar"}),fe==="nueva"&&o.jsx("button",{className:"chip green",onClick:Fe,children:"Guardar"})]})]})}),S&&o.jsx("div",{className:"modal-mask",onClick:()=>E(!1),children:o.jsxs("div",{className:"modal",onClick:D=>D.stopPropagation(),children:[o.jsx("div",{className:"hd",children:"Incrementar todos los precios"}),o.jsx("div",{className:"bd",children:o.jsxs("div",{className:"col",children:[o.jsx("label",{className:"label-strong",children:"Porcentaje de incremento *"}),o.jsx("div",{className:"row",children:o.jsx("input",{className:"inp",style:{maxWidth:160},type:"number",min:"0",step:"0.01",placeholder:"0",value:le,onChange:D=>ce(D.target.value)})}),o.jsxs("div",{className:"col",style:{gap:8},children:[o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"radio",name:"round",checked:_e==="down",onChange:()=>Ie("down")})," Redondear hacia abajo"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"radio",name:"round",checked:_e==="up",onChange:()=>Ie("up")})," Redondear hacia arriba"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"radio",name:"round",checked:_e==="none",onChange:()=>Ie("none")})," No redondear"]})]})]})}),o.jsxs("div",{className:"ft",children:[o.jsx("button",{className:"chip gray",onClick:()=>E(!1),children:"Cerrar"}),o.jsx("button",{className:"chip green",onClick:lt,children:"Incrementar"})]})]})}),O&&o.jsx("div",{className:"modal-mask",onClick:()=>L(!1),children:o.jsxs("div",{className:"modal",onClick:D=>D.stopPropagation(),children:[o.jsx("div",{className:"hd",children:I==="edit"?o.jsxs(o.Fragment,{children:["Editar producto",v?`  ${v.nombre}`:""]}):o.jsxs(o.Fragment,{children:["Agregar producto",v?`  ${v.nombre}`:""]})}),o.jsxs("div",{className:"bd",children:[o.jsxs("div",{className:"form-grid-3",children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Cdigo *"}),o.jsx(nm,{value:M.codigo,onChange:D=>ge({...M,codigo:D}),placeholder:"Cdigo (ej. 890203)",suggestions:z,onPick:D=>ge({...M,codigo:D.codigo,nombre:D.nombre}),renderRow:D=>o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",children:D.codigo}),o.jsx("span",{className:"ac-name",children:D.nombre})]}),minChars:1})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Nombre *"}),o.jsx(nm,{value:M.nombre,onChange:D=>ge({...M,nombre:D}),placeholder:"Nombre del procedimiento",suggestions:xt,onPick:D=>ge({...M,codigo:D.codigo,nombre:D.nombre}),renderRow:D=>o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",children:D.codigo}),o.jsx("span",{className:"ac-name",children:D.nombre})]}),minChars:1})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Precio *"}),o.jsx("input",{className:"inp",type:"text",inputMode:"numeric",pattern:"\\\\d*",placeholder:"$0",value:M.precio,onChange:D=>ge({...M,precio:Zo(D.target.value)})})]})]}),o.jsx("div",{className:"form-row-full",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Observaciones"}),o.jsx("textarea",{className:"ta",value:M.observaciones,onChange:D=>ge({...M,observaciones:D.target.value})})]})}),o.jsxs("div",{className:"form-row-full",style:{display:"grid",gridTemplateColumns:"160px auto auto",gap:"12px",alignItems:"center"},children:[o.jsxs("div",{className:"field",style:{margin:0},children:[o.jsx("label",{children:"Pago valor fijo a doctores"}),o.jsx("input",{className:"inp",type:"number",min:"0",value:M.pago_valor_fijo,onChange:D=>ge({...M,pago_valor_fijo:D.target.value})})]}),o.jsxs("label",{className:"toggle",style:{marginTop:18},children:[o.jsx("input",{type:"checkbox",checked:M.usa_pago_fijo,onChange:D=>ge({...M,usa_pago_fijo:D.target.checked})}),"Usar valor fijo"]}),o.jsx("div",{className:"muted",children:"Use este campo para no liquidar a los doctores por su % configurado sino por un valor fijo en dinero $"})]}),o.jsxs("div",{className:"form-row-full",style:{display:"flex",gap:18,flexWrap:"wrap"},children:[o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"checkbox",checked:M.permite_descuento,onChange:D=>ge({...M,permite_descuento:D.target.checked,...D.target.checked?{}:{max_descuento_value:""}})}),"Permite descuento"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"checkbox",checked:M.genera_rips,onChange:D=>ge({...M,genera_rips:D.target.checked})}),"Genera RIPS"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"checkbox",checked:M.es_consulta,onChange:D=>ge({...M,es_consulta:D.target.checked})}),"Es consulta"]}),o.jsxs("div",{className:"toggle",children:[o.jsx("span",{children:"Ver en agenda"}),o.jsxs("label",{className:"toggle-pill",children:[o.jsx("input",{type:"checkbox",checked:M.ver_en_agenda,onChange:D=>ge({...M,ver_en_agenda:D.target.checked})}),o.jsx("span",{children:M.ver_en_agenda?"S":"No"})]})]})]}),M.permite_descuento&&o.jsx("div",{className:"form-row-full",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Mximo descuento"}),o.jsxs("div",{className:"seg-wrap",children:[o.jsx("div",{className:`seg ${M.max_descuento_tipo==="pct"?"on":""}`,onClick:()=>ge({...M,max_descuento_tipo:"pct",max_descuento_value:String(M.max_descuento_value).replace(/\D+/g,"")}),title:"Porcentaje",children:"%"}),o.jsx("div",{className:`seg ${M.max_descuento_tipo==="valor"?"on":""}`,onClick:()=>ge({...M,max_descuento_tipo:"valor",max_descuento_value:Zo(M.max_descuento_value)}),title:"Valor en $",children:"$"}),M.max_descuento_tipo==="pct"?o.jsx("input",{className:"inp",type:"number",min:"0",step:"0.01",placeholder:"0",value:String(M.max_descuento_value).replace(/[^\d.,-]/g,""),onChange:D=>ge({...M,max_descuento_value:D.target.value})}):o.jsx("input",{className:"inp",type:"text",inputMode:"numeric",placeholder:"$0",value:Zo(M.max_descuento_value),onChange:D=>ge({...M,max_descuento_value:Zo(D.target.value)})})]})]})}),o.jsx("div",{className:"form-row-full",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Cuenta contable"}),o.jsx(nm,{value:M.cuenta_contable,onChange:D=>ge({...M,cuenta_contable:D}),placeholder:"Buscar tem...",suggestions:ie,onPick:D=>ge({...M,cuenta_contable:`${D.codigo}  ${D.nombre}`}),renderRow:D=>o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",style:{minWidth:72},children:D.codigo}),o.jsx("span",{className:"ac-name",children:D.nombre})]}),minChars:0})]})})]}),o.jsxs("div",{className:"ft",children:[o.jsx("button",{className:"chip gray",onClick:()=>L(!1),children:"Cerrar"}),o.jsx("button",{className:"chip green",onClick:X,children:I==="edit"?"Actualizar":"Guardar"})]})]})})]})}const $l="listas_precios_productos";function DU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function OU(){const[t,e]=b.useState(!0),[n,r]=b.useState([]),{pathname:s}=Mn(),i=is(),a=b.useMemo(()=>DU(s),[s]),l=f=>i(`${a}/config/lista-de-precios/productos/editar/${f.id}`);b.useEffect(()=>{async function f(){e(!0);try{const x=(await Ae(ue(J,$l))).docs.map(T=>({id:T.id,...T.data()}));x.sort((T,N)=>{const C=T.actualizado||T.creado||"",S=N.actualizado||N.creado||"";return C&&S?String(S).localeCompare(String(C)):((T==null?void 0:T.nombre)||"").localeCompare((N==null?void 0:N.nombre)||"")}),r(x)}catch(m){console.error("[LP Productos] cargar:",m==null?void 0:m.code,m==null?void 0:m.message),r([])}finally{e(!1)}}f()},[]);async function c(){try{const m={nombre:`Lista de productos ${new Date().toLocaleDateString("es-CO")}`,creado:new Date().toLocaleString("es-CO"),actualizado:new Date().toLocaleString("es-CO"),en_uso:!1,tipo:"productos"},x=await Bt(ue(J,$l),m);r(T=>[{id:x.id,...m},...T])}catch(f){console.error(f),alert("No se pudo crear el listado de productos.")}}async function d(f){try{const x=(await Ae(ue(J,$l))).docs.map(T=>Ut(De(J,$l,T.id),{en_uso:T.id===f.id}));await Promise.all(x),r(T=>T.map(N=>({...N,en_uso:N.id===f.id})))}catch(m){console.error(m),alert("No se pudo cambiar el estado de uso.")}}async function h(f){if(window.confirm(`Eliminar "${f==null?void 0:f.nombre}"?`))try{await Tn(De(J,$l,f.id)),r(m=>m.filter(x=>x.id!==f.id))}catch(m){console.error(m),alert("No se pudo eliminar.")}}return o.jsxs("div",{className:"lp-card",children:[o.jsxs("div",{className:"lp-tabs",style:{justifyContent:"space-between"},children:[o.jsx("div",{style:{display:"flex",gap:8},children:o.jsx("span",{className:"lp-pill active",children:"Lista de precios productos"})}),o.jsx("button",{className:"btn blue",onClick:c,children:"+ Nuevo listado de productos"})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Fecha de creacin"}),o.jsx("th",{children:"Fecha de actualizacin"}),o.jsx("th",{children:"En uso"}),o.jsx("th",{children:"Acciones"})]})}),o.jsx("tbody",{children:t?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):n.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:o.jsx("span",{className:"muted",children:"Sin datos"})})}):n.map(f=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:700},children:(f==null?void 0:f.nombre)||""}),o.jsx("td",{children:(f==null?void 0:f.creado)||""}),o.jsx("td",{children:(f==null?void 0:f.actualizado)||""}),o.jsx("td",{style:{color:f!=null&&f.en_uso?"#16a34a":"#64748b"},children:f!=null&&f.en_uso?"En uso":""}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"btn blue",onClick:()=>l(f),children:"Editar"}),o.jsx("button",{className:"btn green",onClick:()=>d(f),children:"Usar"}),o.jsx("button",{className:"btn red",onClick:()=>h(f),children:"Eliminar"})]})})]},f.id))})]})})]})}function LU(){const[t,e]=b.useState(null),[n,r]=b.useState([]),[s,i]=b.useState(!1),[a,l]=b.useState(0),[c,d]=b.useState(0),h=m=>r(x=>[...x,m]);async function f(){if(!t)return alert("Selecciona el CSV primero.");i(!0),l(0),d(0),r([]);try{const x=(await t.text()).split(/\r?\n/).filter(Boolean),T=x.shift()||"";if(!/codigo\s*;\s*nombre/i.test(T)){h('Encabezado invlido. Usa: "codigo;nombre" o "codigo;nombre;categoria" (separado por ;)'),i(!1);return}const N=250;for(let C=0;C<x.length;C+=N){const S=x.slice(C,C+N);await Promise.all(S.map(async E=>{const g=E.split(";"),_=(g[0]||"").trim().replace(/\./g,""),O=(g[1]||"").trim().replace(/^"|"$/g,""),L=(g[2]||"").trim();if(!_||!O){d(v=>v+1);return}try{await No(De(J,"catalogo_procedimientos",_),{codigo:_,nombre:O,...L?{categoria:L}:{},area:"Odontologa",activo:!0,fuente:"CUPS",version:"2024",updatedAt:new Date().toISOString()},{merge:!0}),l(v=>v+1)}catch(v){d(w=>w+1),h(`Error ${_}: ${(v==null?void 0:v.message)||v}`)}})),h(`Cargado ${Math.min(C+N,x.length)} / ${x.length}`)}h(" Importacin finalizada.")}catch(m){h(` Error: ${(m==null?void 0:m.message)||m}`)}finally{i(!1)}}return o.jsxs("div",{style:{maxWidth:760,margin:"24px auto",background:"#fff",padding:16,borderRadius:12,border:"1px solid #e5e7eb"},children:[o.jsx("h2",{style:{marginTop:0},children:"Importar procedimientos (Odontologa  CUPS 2024)"}),o.jsxs("p",{children:["Sube tu CSV con columnas ",o.jsx("b",{children:"codigo;nombre"})," o ",o.jsx("b",{children:"codigo;nombre;categoria"})," (punto y coma)."]}),o.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[o.jsx("input",{type:"file",accept:".csv",onChange:m=>{var x;return e(((x=m.target.files)==null?void 0:x[0])||null)}}),o.jsx("button",{disabled:!t||s,onClick:f,style:{padding:"8px 12px",borderRadius:8,background:"#22c55e",color:"#fff",border:"none",fontWeight:700},children:s?"Cargando...":"Cargar"})]}),o.jsxs("div",{style:{marginTop:12,display:"flex",gap:12},children:[o.jsxs("span",{children:[" OK: ",a]}),o.jsxs("span",{children:[" Fallidos: ",c]}),s&&o.jsx("span",{children:" Procesando"})]}),o.jsx("pre",{style:{background:"#f8fafc",padding:12,borderRadius:8,marginTop:12,maxHeight:260,overflow:"auto",fontSize:12},children:n.join(`
`)})]})}const Fg=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),jr=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),to=(t,e,n)=>Math.min(n,Math.max(e,Number.isFinite(+t)?+t:e)),x1=(t,e)=>{const n=jr(t),r=jr(e);return!n||!r?!1:n===r||n.includes(r)||r.includes(n)};function VU(){b.useEffect(()=>{const t="oc-planes-styles-v3";if(document.getElementById(t))return;const e=`
      :root{
        --oc-primary:#3b82f6; --oc-primary-600:#2563eb;
        --oc-green:#22c55e; --oc-green-600:#16a34a;
        --oc-red:#ef4444; --oc-red-600:#dc2626;
        --oc-gray:#e5e7eb; --oc-muted:#64748b;
      }
      .oc-muted{color:var(--oc-muted)} .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
      .oc-input,.oc-select{height:34px;border:1px solid #d6dbe6;border-radius:8px;background:#fff;padding:0 10px;font-size:14px}
      .oc-input:focus,.oc-select:focus{outline:none;border-color:#60a5fa;box-shadow:0 0 0 2px rgba(96,165,250,.15)}
      .oc-btn{display:inline-flex;align-items:center;justify-content:center;height:30px;padding:0 10px;border-radius:8px;border:1px solid var(--oc-gray);background:#fff;color:#0f172a;font-weight:700;font-size:12px;cursor:pointer;transition:.15s}
      .oc-btn:hover{background:#f8fafc} .oc-btn.small{height:26px;padding:0 8px}
      .oc-btn.primary{background:var(--oc-primary);border-color:var(--oc-primary-600);color:#fff}
      .oc-btn.primary:hover{background:var(--oc-primary-600)}
      .oc-btn.success{background:var(--oc-green);border-color:var(--oc-green-600);color:#fff}
      .oc-btn.success:hover{background:var(--oc-green-600)}
      .oc-btn.danger{background:var(--oc-red);border-color:var(--oc-red-600);color:#fff}
      .oc-btn.danger:hover{background:var(--oc-red-600)}
      .oc-btn.outline{background:#fff;color:var(--oc-primary);border-color:var(--oc-primary)}
      .oc-btn.outline:hover{background:#eff6ff}
      .oc-tbl{width:100%;border-collapse:separate;border-spacing:0;border:1px solid #e6e9ef;border-radius:10px;overflow:hidden}
      .oc-tbl thead th{background:#f8fafc;text-align:left;padding:8px 10px;border-bottom:1px solid #e6e9ef;font-weight:700}
      .oc-tbl tbody td{padding:8px 10px;border-bottom:1px solid #f0f3f8}
      .oc-tbl tbody tr:last-child td{border-bottom:0}
      .oc-mask{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:999999;display:flex;align-items:center;justify-content:center}
      .oc-modal{width:min(1200px,96vw);max-height:92vh;background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 22px 60px rgba(0,0,0,.28);display:flex;flex-direction:column}
      .oc-modal-h,.oc-modal-f{padding:10px 12px;border-bottom:1px solid #eef2f7;display:flex;align-items:center;justify-content:space-between}
      .oc-modal-f{border-top:1px solid #eef2f7;border-bottom:0;gap:8;justify-content:flex-end}
      .oc-modal-t{padding:10px 12px;border-bottom:1px solid #eef2f7;display:grid;grid-template-columns:minmax(180px,260px) 1fr minmax(120px,160px) auto;gap:8px;align-items:center}
      .oc-modal-b{padding:12px;overflow:auto}
      .oc-sug{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #e5e7eb;border-radius:10px;margin-top:4px;max-height:260px;overflow:auto;box-shadow:0 12px 28px rgba(0,0,0,.15);z-index:99}
      .oc-sug-item{padding:8px 10px;display:flex;justify-content:space-between;gap:10px;cursor:pointer}
      .oc-sug-item:hover,.oc-sug-item.is-active{background:#eff6ff}
    `,n=document.createElement("style");n.id=t,n.textContent=e,document.head.appendChild(n)},[])}const MU={"Ciruga Oral":["cirugia","quirurg","exodon","alveolo","fenestr","colgajo","apicect"],Endodoncia:["endodon","conducto","pulpar","apex","biopul","necros"],Implantologa:["implante","implanto","pilar","injerto","osteointeg"],"Odontologa General":["profilaxis","resina","amalgama","sellante","consulta","control"],Ortodoncia:["ortodon","bracket","alinead","arco","retencion"],Periodoncia:["periodon","curet","raspaje","aliser","flap"],Psicologa:["psicol","terap","sesion"],Radiologa:["radio","rx","radiogr","periap","panoram","cefalo"],"Rehabilitacin Oral":["rehabil","corona","puente","carilla","incrusta","protes"]},FU=t=>jr(t).replace(/[^a-z0-9 ]/gi," ").split(/\s+/).filter(Boolean),UU=(t="",e="",n=MU)=>{const r=n[e]||[];if(!r.length)return"";const s=FU(t);return r.some(i=>s.some(a=>a.includes(i)))?e:""},ea=(t="",e="",n="",r=[])=>{const s=(t||"").toString();if(r&&r.length&&n){const a=r.find(l=>x1(l.nombre,n));if(a&&Array.isArray(a.prefijos)&&a.prefijos.some(l=>l&&s.startsWith((l||"").replace(/\./g,""))))return a.nombre}const i=UU(e,n);return i||""};function $U({listaId:t,onClose:e,onLoadLines:n}){const[r,s]=b.useState(["*"]),[i,a]=b.useState("*"),[l,c]=b.useState(""),[d,h]=b.useState(1),[f,m]=b.useState([]),[x,T]=b.useState(!1),[N,C]=b.useState(!1),[S,E]=b.useState(-1),g=b.useRef(null),[_,O]=b.useState([]),[L,v]=b.useState([]),w=["*","Ciruga Oral","Endodoncia","Implantologa","Odontologa General","Ortodoncia","Periodoncia","Psicologa","Radiologa","Rehabilitacin Oral"];b.useEffect(()=>{let oe=!0;return(async()=>{const Oe=new Set;let Q=[];try{const le=await Ae(ue(J,"catalogo_categorias")).catch(()=>null);if(le&&!le.empty&&(Oe.add("*"),le.forEach(ce=>{const _e=ce.data()||{},Ie=(_e.nombre||"").toString().trim(),fe=Array.isArray(_e.prefijos)?_e.prefijos.map(ye=>(ye||"").toString()):[];Ie&&(Oe.add(Ie),Q.push({nombre:Ie,prefijos:fe}))})),t){const ce=await Ae(ue(J,"listas_precios",t,"items")).catch(()=>null);ce==null||ce.forEach(fe=>{var Le,We,Re;const ye=(((Le=fe.data())==null?void 0:Le.categoria)||((We=fe.data())==null?void 0:We.categoriaNombre)||((Re=fe.data())==null?void 0:Re.grupo)||"").toString().trim();ye&&Oe.add(ye)});const _e=qe(ue(J,"listas_precios_productos"),it("listaId","==",t)),Ie=await Ae(_e).catch(()=>null);Ie==null||Ie.forEach(fe=>{var Le,We,Re;const ye=(((Le=fe.data())==null?void 0:Le.categoria)||((We=fe.data())==null?void 0:We.categoriaNombre)||((Re=fe.data())==null?void 0:Re.grupo)||"").toString().trim();ye&&Oe.add(ye)})}}finally{Oe.size===0&&w.forEach(le=>Oe.add(le)),Oe.has("*")||Oe.add("*"),oe&&(s(Array.from(Oe)),v(Q))}})(),()=>{oe=!1}},[t]),b.useEffect(()=>{i!=="*"?(C(!0),E(-1)):C(!1)},[i]),b.useEffect(()=>{let oe=!0;if(!(jr(l).length>=2||i!=="*")){m([]);return}return(async()=>{T(!0);try{let Q=[];if(t){const _e=await Ae(ue(J,"listas_precios",t,"items")).catch(()=>null);_e&&!_e.empty&&(Q=_e.docs.map(Ie=>{const fe=Ie.data()||{},ye=(fe.codigo||"").toString().trim()||Ie.id,Le=(fe.nombre||fe.descripcion||ye).toString().trim(),We=Number(fe.precio??fe.valor??0)||0;let Re=(fe.categoria||fe.categoriaNombre||fe.grupo||"").toString().trim();if(!Re){if(i!=="*"&&(Re=ea(ye,Le,i,L)),!Re&&L.length)for(const Je of L){const gt=ea(ye,Le,Je.nombre,L);if(gt){Re=gt;break}}Re||(Re="Sin categora")}return{id:Ie.id,codigo:ye,nombre:Le,precio:We,categoria:Re,max_desc_pct:Number(fe.max_desc_pct||0),max_desc_valor:Number(fe.max_desc_valor||0),permite_desc:!!(fe.permite_desc??!0),genera_rips:!!fe.genera_rips,es_consulta:!!fe.es_consulta,ver_en_agenda:!!fe.ver_en_agenda,_norm:jr(`${ye} ${Le} ${Re}`)}}))}if(!Q.length&&t){const _e=qe(ue(J,"listas_precios_productos"),it("listaId","==",t)),Ie=await Ae(_e).catch(()=>null);Q=((Ie==null?void 0:Ie.docs)||[]).map(fe=>{const ye=fe.data()||{},Le=(ye.codigo||"").toString().trim()||fe.id,We=(ye.nombre||ye.descripcion||Le).toString().trim(),Re=Number(ye.precio??ye.valor??0)||0;let Je=(ye.categoria||ye.categoriaNombre||ye.grupo||"").toString().trim();if(!Je){if(i!=="*"&&(Je=ea(Le,We,i,L)),!Je&&L.length)for(const gt of L){const q=ea(Le,We,gt.nombre,L);if(q){Je=q;break}}Je||(Je="Sin categora")}return{id:fe.id,codigo:Le,nombre:We,precio:Re,categoria:Je,max_desc_pct:Number(ye.max_desc_pct||0),max_desc_valor:Number(ye.max_desc_valor||0),permite_desc:!!(ye.permite_desc??!0),genera_rips:!!ye.genera_rips,es_consulta:!!ye.es_consulta,ver_en_agenda:!!ye.ver_en_agenda,_norm:jr(`${Le} ${We} ${Je}`)}})}if(!Q.length){const _e=await Ae(ue(J,"catalogo_procedimientos")).catch(()=>null);_e==null||_e.forEach(Ie=>{const fe=Ie.data()||{},ye=(fe.codigo||"").toString().trim()||Ie.id,Le=(fe.nombre||fe.descripcion||ye).toString().trim(),We=Number(fe.precio??fe.valor??0)||0;let Re=(fe.categoria||fe.grupo||"").toString().trim();if(!Re){if(i!=="*"&&(Re=ea(ye,Le,i,L)),!Re&&L.length)for(const Je of L){const gt=ea(ye,Le,Je.nombre,L);if(gt){Re=gt;break}}Re||(Re="Sin categora")}Q.push({id:Ie.id,codigo:ye,nombre:Le,precio:We,categoria:Re,max_desc_pct:Number(fe.max_desc_pct||0),max_desc_valor:Number(fe.max_desc_valor||0),permite_desc:!!(fe.permite_desc??!0),genera_rips:!!fe.genera_rips,es_consulta:!!fe.es_consulta,ver_en_agenda:!!fe.ver_en_agenda,_norm:jr(`${ye} ${Le} ${Re}`)})})}const le=jr(l);let ce=Q.filter(_e=>!(i!=="*"&&!x1(_e.categoria||"",i)||le&&!_e._norm.includes(le)));ce.sort((_e,Ie)=>(_e.codigo||"").localeCompare(Ie.codigo||"")||(_e.nombre||"").localeCompare(Ie.nombre||"")),i!=="*"&&!le&&(ce=ce.slice(0,70)),oe&&m(ce)}finally{oe&&T(!1)}})(),()=>{oe=!1}},[t,i,l,L]);const I=oe=>{const Oe=Math.max(1,Number(d)||1);O(Q=>{const le=Q.findIndex(fe=>fe.codigo===oe.codigo),ce={codigo:oe.codigo,nombre:oe.nombre,precio:Number(oe.precio||0),cantidad:Oe,descuentoPct:0,observaciones:"",_max_desc_pct:Number(oe.max_desc_pct||0),_max_desc_valor:Number(oe.max_desc_valor||0),_permite_desc:!!(oe.permite_desc??!0),_flags:{genera_rips:!!oe.genera_rips,es_consulta:!!oe.es_consulta,ver_en_agenda:!!oe.ver_en_agenda}};if(le>=0){const fe=[...Q],ye={...fe[le]};ye.cantidad=to((ye.cantidad||1)+Oe,1,999999);const Le=to(ye.descuentoPct||0,0,ce._max_desc_pct||100),We=ye.precio||ce.precio||0;return ye.total=Math.max(0,We*ye.cantidad*(Le>=100?0:1-Le/100)),fe[le]=ye,fe}const Ie=Math.max(0,ce.precio*Oe*(1-0/100));return[...Q,{...ce,total:Ie}]})},R=(oe,Oe)=>{O(Q=>{const le=[...Q],ce={...le[oe],...Oe},_e=Number.isFinite(ce._max_desc_pct)?ce._max_desc_pct:100,Ie=to(ce.descuentoPct,0,_e),fe=to(ce.cantidad,1,999999),ye=Number(ce.precio||0);return ce.descuentoPct=Ie,ce.cantidad=fe,ce.precio=ye,ce.total=Math.max(0,ye*fe*(Ie>=100?0:1-Ie/100)),le[oe]=ce,le})},P=oe=>O(Oe=>Oe.filter((Q,le)=>le!==oe)),V=()=>{if(!_.length&&f.length){const oe=Math.max(1,Number(d)||1),Oe=f.map(Q=>({codigo:Q.codigo,nombre:Q.nombre,precio:Number(Q.precio||0),cantidad:oe,descuentoPct:0,observaciones:"",_max_desc_pct:Number(Q.max_desc_pct||0),_max_desc_valor:Number(Q.max_desc_valor||0),_permite_desc:!!(Q.permite_desc??!0),_flags:{genera_rips:!!Q.genera_rips,es_consulta:!!Q.es_consulta,ver_en_agenda:!!Q.ver_en_agenda},total:Number(Q.precio||0)*oe}));n(Oe),e();return}_.length&&n(_),e()},k=N&&(x||f.length>0),M=f.length===0&&jr(l).length<2&&i==="*",ge=!k&&i==="*";return o.jsx("div",{className:"oc-mask",role:"dialog","aria-modal":"true",children:o.jsxs("div",{className:"oc-modal",children:[o.jsxs("div",{className:"oc-modal-h",children:[o.jsx("b",{children:"Agregar productos"}),o.jsx("button",{className:"oc-btn",onClick:e,children:"Cerrar"})]}),o.jsxs("div",{className:"oc-modal-t",children:[o.jsx("select",{className:"oc-select",value:i,onChange:oe=>a(oe.target.value),children:r.map(oe=>o.jsx("option",{value:oe,children:oe==="*"?"Todas las categoras":oe},oe))}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("input",{ref:g,className:"oc-input",placeholder:"Buscar tem por cdigo o nombre",value:l,onChange:oe=>{c(oe.target.value),C(!0)},onFocus:()=>{i!=="*"&&C(!0)}}),k&&o.jsx("div",{className:"oc-sug",children:x?o.jsx("div",{className:"oc-muted",style:{padding:10},children:"Cargando"}):f.length===0?o.jsx("div",{className:"oc-muted",style:{padding:10},children:"Sin resultados."}):f.map((oe,Oe)=>o.jsxs("div",{className:"oc-sug-item",onMouseDown:Q=>{Q.preventDefault(),I(oe)},children:[o.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:oe.nombre}),o.jsx("div",{className:"mono",style:{opacity:.85},children:oe.codigo})]},`${oe.id}-${oe.codigo}`))})]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,justifySelf:"start"},children:[o.jsx("span",{className:"oc-muted",style:{fontSize:12,fontWeight:700},children:"Cantidad"}),o.jsx("input",{type:"number",min:1,value:d,onChange:oe=>h(oe.target.value),className:"oc-input",style:{width:90}})]}),o.jsx("button",{className:"oc-btn success",onClick:V,children:"Agregar"})]}),o.jsxs("div",{className:"oc-modal-b",children:[M?o.jsx("div",{className:"oc-muted",children:"Escribe al menos 2 caracteres o elige una categora para ver resultados."}):x?o.jsx("div",{className:"oc-muted",children:"Cargando"}):f.length===0?o.jsx("div",{className:"oc-muted",children:"Sin resultados."}):ge&&o.jsxs("table",{className:"oc-tbl",style:{marginBottom:10},children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:140},children:"Valor unit."}),o.jsx("th",{style:{width:160},children:"Categora"}),o.jsx("th",{style:{width:120},children:"Acciones"})]})}),o.jsx("tbody",{children:f.map(oe=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:oe.codigo}),o.jsx("td",{children:oe.nombre}),o.jsx("td",{className:"mono",children:Fg.format(oe.precio||0)}),o.jsx("td",{children:oe.categoria||""}),o.jsx("td",{children:o.jsx("button",{className:"oc-btn success small",onClick:()=>I(oe),children:"Agregar"})})]},`${oe.id}-${oe.codigo}`))})]}),!!_.length&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{margin:"6px 0 8px",fontWeight:700},className:"oc-muted",children:"tems a cargar"}),o.jsxs("table",{className:"oc-tbl",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:120},children:"Valor unit."}),o.jsx("th",{style:{width:80},children:"Cant."}),o.jsx("th",{style:{width:90},children:"Desc. %"}),o.jsx("th",{children:"Observaciones"}),o.jsx("th",{style:{width:120},children:"Total"}),o.jsx("th",{style:{width:100},children:"Acciones"})]})}),o.jsx("tbody",{children:_.map((oe,Oe)=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:oe.codigo}),o.jsx("td",{children:oe.nombre}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:Number.isFinite(oe.precio)?oe.precio:0,onChange:Q=>R(Oe,{precio:Q.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:1,value:oe.cantidad,onChange:Q=>R(Oe,{cantidad:Q.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,max:100,value:oe.descuentoPct,onChange:Q=>R(Oe,{descuentoPct:Q.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{value:oe.observaciones||"",onChange:Q=>R(Oe,{observaciones:Q.target.value}),className:"oc-input"})}),o.jsx("td",{className:"mono",children:Fg.format(oe.total||0)}),o.jsx("td",{children:o.jsx("button",{className:"oc-btn danger small",onClick:()=>P(Oe),children:"Quitar"})})]},Oe))})]})]})]}),o.jsxs("div",{className:"oc-modal-f",children:[o.jsx("button",{className:"oc-btn",onClick:e,children:"Cerrar"}),o.jsx("button",{className:"oc-btn success",onClick:V,disabled:!_.length&&!f.length,children:"Cargar"})]})]})})}function BU({planId:t,onBack:e}){const[n,r]=b.useState(null),[s,i]=b.useState([]),[a,l]=b.useState([]),[c,d]=b.useState(!1),[h,f]=b.useState(!1);b.useEffect(()=>{let g=!0;return(async()=>{const _=await Ae(qe(ue(J,"listas_precios"),yt("nombre","asc"))).catch(()=>null);g&&i(_?_.docs.map(I=>({id:I.id,...I.data()||{}})):[]);const O=await Co(De(J,"planes",t));if(!O.exists())return;const L={id:O.id,...O.data()||{}};g&&r(L);const w=(await Ae(ue(J,"planes",t,"planes_items"))).docs.map(I=>({id:I.id,...I.data()||{}}));g&&l(w)})(),()=>{g=!1}},[t]);const m=(n==null?void 0:n.listaId)||"",x=g=>r(_=>({..._||{},...g})),T=g=>{const _=to(g.cantidad,1,999999),O=Number.isFinite(g._max_desc_pct)?g._max_desc_pct:100,L=to(g.descuentoPct,0,O),v=Number(g.precio||0),w=Math.max(0,v*_*(L>=100?0:1-L/100));return{...g,cantidad:_,descuentoPct:L,precio:v,total:w}},N=g=>{l(_=>{const O=new Map(_.map(L=>[L.codigo,{...L}]));for(const L of g)if(O.has(L.codigo)){const v={...O.get(L.codigo)};v.cantidad=to((v.cantidad||1)+(Number(L.cantidad)||1),1,999999),v.precio=Number(L.precio||v.precio||0),v.descuentoPct=Number(v.descuentoPct||0),v.observaciones=v.observaciones||"",v._max_desc_pct=Number(v._max_desc_pct??L._max_desc_pct??0),v._max_desc_valor=Number(v._max_desc_valor??L._max_desc_valor??0),v._permite_desc=v._permite_desc??L._permite_desc??!0,v._flags=v._flags||L._flags||{},O.set(L.codigo,T(v))}else O.set(L.codigo,T({...L}));return Array.from(O.values())})},C=(g,_)=>{l(O=>{const L=[...O];return L[g]=T({...L[g],..._}),L})},S=async(g,_)=>{if(!(n!=null&&n.id)){l(O=>O.filter((L,v)=>v!==_));return}g&&await Tn(De(J,"planes",n.id,"planes_items",g)),l(O=>g?O.filter(L=>L.id!==g):O.filter((L,v)=>v!==_))},E=async()=>{var g;if(!((g=n==null?void 0:n.nombre)!=null&&g.trim()))return alert("El nombre del plan es obligatorio.");if(!(n!=null&&n.listaId))return alert("Selecciona la lista de precios.");d(!0);try{await Ut(De(J,"planes",n.id),{nombre:n.nombre.trim(),listaId:n.listaId,actualizado:Pt()});const _=ue(J,"planes",n.id,"planes_items");await Promise.all(a.map(async O=>{const L={codigo:O.codigo||"",nombre:O.nombre||"",precio:Number(O.precio||0),cantidad:Number(O.cantidad||1),descuentoPct:Number(O.descuentoPct||0),observaciones:O.observaciones||"",total:Number(T(O).total||0),_max_desc_pct:Number(O._max_desc_pct||0),_max_desc_valor:Number(O._max_desc_valor||0),_permite_desc:!!(O._permite_desc??!0),_flags:O._flags||{},actualizado:Pt()};O.id?await Ut(De(_,O.id),L):await Bt(_,{...L,creado:Pt()})})),alert(" Plan guardado.")}catch(_){console.error(_),alert(" No se pudo guardar el plan.")}finally{d(!1)}};return n?o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("h3",{style:{margin:0},children:"Edicin de plan"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:e,children:"Volver"}),o.jsx("button",{className:"oc-btn primary",onClick:E,disabled:c,children:c?"Guardando":"Guardar cambios"})]})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:10,alignItems:"center",marginBottom:8},children:[o.jsx("label",{children:"Nombre"}),o.jsx("input",{className:"oc-input",value:n.nombre||"",onChange:g=>x({nombre:g.target.value})})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr auto",gap:10,alignItems:"center",marginBottom:16},children:[o.jsx("label",{children:"Lista de precios"}),o.jsxs("select",{className:"oc-select",value:n.listaId||"",onChange:g=>x({listaId:g.target.value}),children:[o.jsx("option",{value:"",children:"Seleccione"}),s.map(g=>o.jsx("option",{value:g.id,children:g.nombre||g.id},g.id))]}),o.jsx("button",{className:"oc-btn outline small",onClick:()=>f(!0),children:"+ Productos"})]}),o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"oc-tbl",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:120},children:"Valor unit."}),o.jsx("th",{style:{width:80},children:"Cant."}),o.jsx("th",{style:{width:90},children:"Desc. %"}),o.jsx("th",{children:"Observaciones"}),o.jsx("th",{style:{width:120},children:"Total"}),o.jsx("th",{style:{width:160},children:"Acciones"})]})}),o.jsx("tbody",{children:a.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:8,className:"oc-muted",children:"Sin productos en el plan."})}):a.map((g,_)=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:g.codigo}),o.jsx("td",{children:g.nombre}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:Number.isFinite(g.precio)?g.precio:0,onChange:O=>C(_,{precio:O.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:1,value:g.cantidad||1,onChange:O=>C(_,{cantidad:O.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,max:100,value:g.descuentoPct||0,onChange:O=>C(_,{descuentoPct:O.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{className:"oc-input",value:g.observaciones||"",onChange:O=>C(_,{observaciones:O.target.value})})}),o.jsx("td",{className:"mono",children:Fg.format(Number(g.precio||0)*(g.cantidad||1)*((g.descuentoPct||0)>=100?0:1-(g.descuentoPct||0)/100)||0)}),o.jsx("td",{children:o.jsx("button",{className:"oc-btn danger small",onClick:()=>S(g.id,_),children:"Eliminar"})})]},g.id||`new-${_}`))})]})}),h&&o.jsx($U,{listaId:m,onClose:()=>f(!1),onLoadLines:N})]}):o.jsx("div",{className:"oc-muted",children:"Cargando plan"})}function Ld({mode:t,planId:e}){VU();const[n,r]=b.useState(t||"list"),[s,i]=b.useState(e||null),[a,l]=b.useState(""),[c,d]=b.useState([]),[h,f]=b.useState(!0),[m,x]=b.useState([]),[T,N]=b.useState({nombre:"",listaId:""});b.useEffect(()=>{let g=!0;return(async()=>{f(!0);try{const _=await Ae(qe(ue(J,"listas_precios"),yt("nombre","asc"))).catch(()=>null);g&&x(_?_.docs.map(L=>({id:L.id,...L.data()||{}})):[]);const O=await Ae(qe(ue(J,"planes"),yt("nombre","asc")));g&&d(O.docs.map(L=>({id:L.id,...L.data()||{}})))}finally{g&&f(!1)}})(),()=>{g=!1}},[]),b.useEffect(()=>{t&&r(t)},[t]),b.useEffect(()=>{e&&i(e)},[e]);const C=b.useMemo(()=>{const g=jr(a);return g?c.filter(_=>jr(`${_.nombre} ${_.listaNombre||""}`).includes(g)):c},[c,a]),S=async()=>{var O;if(!((O=T.nombre)!=null&&O.trim()))return alert("El nombre es obligatorio.");if(!T.listaId)return alert("Selecciona una lista de precios.");const g=m.find(L=>L.id===T.listaId),_=await Bt(ue(J,"planes"),{nombre:T.nombre.trim(),listaId:T.listaId,listaNombre:(g==null?void 0:g.nombre)||"",creado:Pt(),actualizado:Pt()});d(L=>[...L,{id:_.id,nombre:T.nombre.trim(),listaId:T.listaId,listaNombre:(g==null?void 0:g.nombre)||""}]),N({nombre:"",listaId:""}),i(_.id),r("edit")},E=async g=>{window.confirm(`Eliminar el plan "${g.nombre}"?`)&&(await Tn(De(J,"planes",g.id)),d(_=>_.filter(O=>O.id!==g.id)))};return n==="edit"&&s?o.jsx(BU,{planId:s,onBack:()=>{r("list"),i(null)}}):n==="new"?o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Nuevo plan"}),o.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,marginBottom:12},children:o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(220px, 1fr) minmax(240px, 1fr) auto",gap:8,alignItems:"center"},children:[o.jsx("input",{className:"oc-input",placeholder:"Nombre del plan",value:T.nombre,onChange:g=>N(_=>({..._,nombre:g.target.value}))}),o.jsxs("select",{className:"oc-select",value:T.listaId,onChange:g=>N(_=>({..._,listaId:g.target.value})),children:[o.jsx("option",{value:"",children:"Seleccione lista de precios"}),m.map(g=>o.jsx("option",{value:g.id,children:g.nombre||g.id},g.id))]}),o.jsx("button",{className:"oc-btn primary",onClick:S,children:"Crear"})]})}),o.jsx("button",{className:"oc-btn",onClick:()=>r("list"),children:"Volver"})]}):o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Planes"}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,marginBottom:12},children:[o.jsx("h3",{style:{marginTop:0},children:"Nuevo plan"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(220px, 1fr) minmax(240px, 1fr) auto",gap:8,alignItems:"center"},children:[o.jsx("input",{className:"oc-input",placeholder:"Nombre del plan",value:T.nombre,onChange:g=>N(_=>({..._,nombre:g.target.value}))}),o.jsxs("select",{className:"oc-select",value:T.listaId,onChange:g=>N(_=>({..._,listaId:g.target.value})),children:[o.jsx("option",{value:"",children:"Seleccione lista de precios"}),m.map(g=>o.jsx("option",{value:g.id,children:g.nombre||g.id},g.id))]}),o.jsx("button",{className:"oc-btn primary",onClick:S,children:"Crear"})]})]}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[o.jsx("h3",{style:{margin:0},children:"Listado"}),o.jsx("input",{className:"oc-input",placeholder:"Buscar",value:a,onChange:g=>l(g.target.value),style:{minWidth:240}})]}),h?o.jsx("div",{className:"oc-muted",children:"Cargando"}):C.length===0?o.jsx("div",{className:"oc-muted",children:"Sin planes."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"oc-tbl",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Lista de precios"}),o.jsx("th",{style:{width:220},children:"Acciones"})]})}),o.jsx("tbody",{children:C.map(g=>o.jsxs("tr",{children:[o.jsx("td",{children:g.nombre}),o.jsx("td",{children:g.listaNombre||g.listaId||""}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[o.jsx("button",{className:"oc-btn outline small",onClick:()=>{i(g.id),r("edit")},children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>E(g),children:"Eliminar"})]})})]},g.id))})]})})]})]})}const rm=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),Xn=t=>{const e=parseInt(String(t||"0").replace(/\D/g,""),10);return isNaN(e)||e<0?0:e};function zU(){const[t,e]=b.useState([]),[n,r]=b.useState(!0),[s,i]=b.useState(""),[a,l]=b.useState("list"),[c,d]=b.useState(null),[h,f]=b.useState({nombre:"",contReciboCaja:0,contNotaCredito:0,contNotaDebito:0,contEgresos:0,contPresupuestos:0,contPlanTratamiento:0,contOrdenesCompra:0,contCuentasPorCobrar:0,contUsoSaldoAFavor:0,contUsoNotasCredito:0,contRipsAutomatizados:0,numRipsRes2275:0,datosManuales:!1,facturaCompra:!1,facturaVenta:!1,facturacionElectronica:!1,enUso:!1}),m=()=>f({nombre:"",contReciboCaja:0,contNotaCredito:0,contNotaDebito:0,contEgresos:0,contPresupuestos:0,contPlanTratamiento:0,contOrdenesCompra:0,contCuentasPorCobrar:0,contUsoSaldoAFavor:0,contUsoNotasCredito:0,contRipsAutomatizados:0,numRipsRes2275:0,datosManuales:!1,facturaCompra:!1,facturaVenta:!1,facturacionElectronica:!1,enUso:!1}),x=async()=>{r(!0);try{const P=qe(ue(J,"consecutivos"),yt("nombre","asc")),k=(await Ae(P)).docs.map(M=>({id:M.id,...M.data()||{}}));e(k)}catch(P){console.error("Error leyendo consecutivos:",P),e([])}finally{r(!1)}};b.useEffect(()=>{x()},[]);const T=b.useMemo(()=>{const P=rm(s);return P?t.filter(V=>rm(`${V.nombre}`).includes(P)):t},[t,s]),N=P=>V=>f(k=>({...k,[P]:!!V.target.checked})),C=P=>V=>f(k=>({...k,[P]:Xn(V.target.value)})),S=P=>{const{name:V,value:k}=P.target;f(M=>({...M,[V]:k}))},E=()=>{d(null),m(),l("form"),window.scrollTo({top:0,behavior:"smooth"})},g=P=>{d(P.id),f({nombre:P.nombre||"",contReciboCaja:P.contReciboCaja??0,contNotaCredito:P.contNotaCredito??0,contNotaDebito:P.contNotaDebito??0,contEgresos:P.contEgresos??0,contPresupuestos:P.contPresupuestos??0,contPlanTratamiento:P.contPlanTratamiento??0,contOrdenesCompra:P.contOrdenesCompra??0,contCuentasPorCobrar:P.contCuentasPorCobrar??0,contUsoSaldoAFavor:P.contUsoSaldoAFavor??0,contUsoNotasCredito:P.contUsoNotasCredito??0,contRipsAutomatizados:P.contRipsAutomatizados??0,numRipsRes2275:P.numRipsRes2275??0,datosManuales:!!P.datosManuales,facturaCompra:!!P.facturaCompra,facturaVenta:!!P.facturaVenta,facturacionElectronica:!!P.facturacionElectronica,enUso:!!P.enUso}),l("form"),window.scrollTo({top:0,behavior:"smooth"})},_=()=>{d(null),m(),l("list")},O=async P=>{var k,M;(k=P==null?void 0:P.preventDefault)==null||k.call(P);const V={...h,contReciboCaja:Xn(h.contReciboCaja),contNotaCredito:Xn(h.contNotaCredito),contNotaDebito:Xn(h.contNotaDebito),contEgresos:Xn(h.contEgresos),contPresupuestos:Xn(h.contPresupuestos),contPlanTratamiento:Xn(h.contPlanTratamiento),contOrdenesCompra:Xn(h.contOrdenesCompra),contCuentasPorCobrar:Xn(h.contCuentasPorCobrar),contUsoSaldoAFavor:Xn(h.contUsoSaldoAFavor),contUsoNotasCredito:Xn(h.contUsoNotasCredito),contRipsAutomatizados:Xn(h.contRipsAutomatizados),numRipsRes2275:Xn(h.numRipsRes2275),nombre_busqueda:rm(h.nombre),actualizado:Pt()};if(!((M=V.nombre)!=null&&M.trim()))return alert("El nombre del consecutivo es obligatorio.");try{if(c?await Ut(De(J,"consecutivos",c),V):await Bt(ue(J,"consecutivos"),{...V,creado:Pt()}),V.enUso)try{const ge=await Ae(ue(J,"consecutivos"));await Promise.all(ge.docs.filter(oe=>oe.id!==(c||"")).map(oe=>Ut(oe.ref,{enUso:!1})))}catch{}await x(),_(),alert(" Consecutivo guardado.")}catch(ge){console.error("Error guardando consecutivo:",ge),alert(" No se pudo guardar el consecutivo.")}},L=async P=>{if(window.confirm(`Eliminar el consecutivo "${P.nombre}"?`))try{await Tn(De(J,"consecutivos",P.id)),await x(),alert(" Consecutivo eliminado.")}catch(V){console.error("Error eliminando consecutivo:",V),alert(" No se pudo eliminar.")}},v=({label:P,name:V,value:k,onChange:M})=>o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:P}),o.jsx("input",{name:V,value:String(k??0),onChange:M,inputMode:"numeric",pattern:"[0-9]*",placeholder:"0"})]}),w=({label:P,name:V,checked:k,onChange:M})=>o.jsxs("label",{className:"oc-switch",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{type:"checkbox",checked:!!k,onChange:M}),o.jsx("span",{children:P})]}),I=()=>o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsx("h3",{style:{marginTop:0},children:c?"Editar consecutivo":"Nuevo consecutivo"}),o.jsxs("form",{onSubmit:O,className:"oc-form-grid",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:12},children:[o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Nombre *"}),o.jsx("input",{name:"nombre",value:h.nombre,onChange:S,required:!0,placeholder:"Nombre del consecutivo"})]}),o.jsx(v,{label:"Cont. Recibo de caja",name:"contReciboCaja",value:h.contReciboCaja,onChange:C("contReciboCaja")}),o.jsx(v,{label:"Cont. Nota crdito",name:"contNotaCredito",value:h.contNotaCredito,onChange:C("contNotaCredito")}),o.jsx(v,{label:"Cont. Nota dbito",name:"contNotaDebito",value:h.contNotaDebito,onChange:C("contNotaDebito")}),o.jsx(v,{label:"Cont. Egresos",name:"contEgresos",value:h.contEgresos,onChange:C("contEgresos")}),o.jsx(v,{label:"Cont. Presupuestos",name:"contPresupuestos",value:h.contPresupuestos,onChange:C("contPresupuestos")}),o.jsx(v,{label:"Cont. Plan de tratamiento",name:"contPlanTratamiento",value:h.contPlanTratamiento,onChange:C("contPlanTratamiento")}),o.jsx(v,{label:"Cont. rdenes de compra",name:"contOrdenesCompra",value:h.contOrdenesCompra,onChange:C("contOrdenesCompra")}),o.jsx(v,{label:"Cont. Cuentas por cobrar",name:"contCuentasPorCobrar",value:h.contCuentasPorCobrar,onChange:C("contCuentasPorCobrar")}),o.jsx(v,{label:"Cont. uso saldo a favor",name:"contUsoSaldoAFavor",value:h.contUsoSaldoAFavor,onChange:C("contUsoSaldoAFavor")}),o.jsx(v,{label:"Cont. uso notas crdito",name:"contUsoNotasCredito",value:h.contUsoNotasCredito,onChange:C("contUsoNotasCredito")}),o.jsx(v,{label:"Cont. RIPS automatizados",name:"contRipsAutomatizados",value:h.contRipsAutomatizados,onChange:C("contRipsAutomatizados")}),o.jsx(v,{label:"Num. RIPS (Res. 2275)",name:"numRipsRes2275",value:h.numRipsRes2275,onChange:C("numRipsRes2275")}),o.jsx("div",{className:"oc-col-2"}),o.jsxs("div",{className:"oc-col-2",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:12},children:[o.jsx(w,{label:"Datos manuales consecutivo?",name:"datosManuales",checked:h.datosManuales,onChange:N("datosManuales")}),o.jsx(w,{label:"Factura de compra",name:"facturaCompra",checked:h.facturaCompra,onChange:N("facturaCompra")}),o.jsx(w,{label:"Factura de venta",name:"facturaVenta",checked:h.facturaVenta,onChange:N("facturaVenta")}),o.jsx(w,{label:"Facturacin electrnica",name:"facturacionElectronica",checked:h.facturacionElectronica,onChange:N("facturacionElectronica")}),o.jsx(w,{label:"Marcar como 'En uso' (por defecto)",name:"enUso",checked:h.enUso,onChange:N("enUso")})]}),o.jsxs("div",{className:"oc-form-actions oc-col-2",style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8},children:[o.jsx("button",{type:"button",className:"oc-btn",onClick:_,children:"Cancelar"}),o.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})]})]})]}),R=()=>o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:10},children:[o.jsx("h3",{style:{margin:0},children:"Consecutivos"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("input",{placeholder:"Buscar por nombre",value:s,onChange:P=>i(P.target.value),className:"search-input",style:{minWidth:240}}),o.jsx("button",{className:"oc-btn primary",onClick:E,children:"+ Nuevo consecutivo"})]})]}),n?o.jsx("div",{className:"oc-muted",children:"Cargando"}):T.length===0?o.jsx("div",{className:"oc-muted",children:"Sin consecutivos."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{className:"mono",style:{width:110},children:"RIPS 2275"}),o.jsx("th",{style:{width:90},children:"En uso"}),o.jsx("th",{style:{width:180},children:"Acciones"})]})}),o.jsx("tbody",{children:T.map(P=>o.jsxs("tr",{children:[o.jsx("td",{children:P.nombre}),o.jsx("td",{className:"mono",children:P.numRipsRes2275??0}),o.jsx("td",{children:P.enUso?"S":"No"}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn small",onClick:()=>g(P),children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>L(P),children:"Eliminar"})]})})]},P.id))})]})})]});return o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Consecutivos"}),a==="form"?I():R()]})}const sm=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function qU(){const[t,e]=b.useState("list"),[n,r]=b.useState([]),[s,i]=b.useState(!0),[a,l]=b.useState(""),[c,d]=b.useState([]),[h,f]=b.useState([]),[m,x]=b.useState([]),[T,N]=b.useState([]),[C,S]=b.useState(null),[E,g]=b.useState(!1),[_,O]=b.useState(V()),[L,v]=b.useState(!1),[w,I]=b.useState(null),[R,P]=b.useState(!1);function V(){return{nombre:"",telefonoFijo:"",celular:"",ciudad:"",direccion:"",codigoPostal:"",email:"",consecutivoId:"",listaPreciosId:"",almacenIds:[],pieHabilitado:!1,piePersonalizado:"",codigoPrestador:"",entidadExtranj:"000000",entidadNacional:"000000",centroCostos:"",usuarioSoporteId:"",codigoPrestadorPropio:"",activo:!0}}b.useEffect(()=>{(async()=>{i(!0);try{const[Y,Z,Te,ve,K]=await Promise.all([Ae(qe(ue(J,"sucursales"),yt("nombre","asc"))),Ae(qe(ue(J,"almacenes"),yt("nombre","asc"))),Ae(qe(ue(J,"listas_precios"),yt("nombre","asc"))),Ae(qe(ue(J,"consecutivos"),yt("nombre","asc"))),Ae(qe(ue(J,"usuarios"),yt("displayName","asc"))).catch(()=>({empty:!0,docs:[]}))]);r(Y.docs.map(X=>({id:X.id,...X.data()||{}}))),d(Z.docs.map(X=>({id:X.id,...X.data()||{}}))),f(Te.docs.map(X=>({id:X.id,...X.data()||{}}))),x(ve.docs.map(X=>({id:X.id,...X.data()||{}}))),N(K.empty?[]:K.docs.map(X=>({id:X.id,...X.data()||{}})))}catch(Y){console.error("Error cargando datos:",Y),r([]),d([]),f([]),x([]),N([])}finally{i(!1)}})()},[]);const k=async()=>{const Y=await Ae(qe(ue(J,"sucursales"),yt("nombre","asc")));r(Y.docs.map(Z=>({id:Z.id,...Z.data()||{}})))},M=b.useMemo(()=>{const Y=sm(a);return Y?n.filter(Z=>sm(`${Z.nombre} ${Z.telefonoFijo} ${Z.celular} ${Z.direccion} ${Z.ciudad} ${Z.email}`).includes(Y)):n},[n,a]),ge=Y=>{const{name:Z,type:Te,checked:ve,value:K}=Y.target;O(X=>({...X,[Z]:Te==="checkbox"?ve:K}))},oe=()=>{S(null),O(V()),e("new"),window.scrollTo({top:0,behavior:"smooth"})},Oe=async Y=>{S(Y.id),O({nombre:Y.nombre||"",telefonoFijo:Y.telefonoFijo||"",celular:Y.celular||"",ciudad:Y.ciudad||"",direccion:Y.direccion||"",codigoPostal:Y.codigoPostal||"",email:Y.email||"",consecutivoId:Y.consecutivoId||"",listaPreciosId:Y.listaPreciosId||"",almacenIds:Array.isArray(Y.almacenIds)?Y.almacenIds:[],pieHabilitado:!!Y.pieHabilitado,piePersonalizado:Y.piePersonalizado||"",codigoPrestador:Y.codigoPrestador||"",entidadExtranj:Y.entidadExtranj||"000000",entidadNacional:Y.entidadNacional||"000000",centroCostos:Y.centroCostos||"",usuarioSoporteId:Y.usuarioSoporteId||"",codigoPrestadorPropio:Y.codigoPrestadorPropio||"",activo:typeof Y.activo=="boolean"?Y.activo:!0}),e("edit"),window.scrollTo({top:0,behavior:"smooth"})},Q=()=>{S(null),O(V()),e("list")},le=()=>_.nombre.trim()?_.telefonoFijo.trim()?_.celular.trim()?_.ciudad.trim()?_.direccion.trim()?_.email.trim()?_.consecutivoId?_.listaPreciosId?null:"Selecciona una lista de precios.":"Selecciona un consecutivo.":"El correo electrnico es obligatorio.":"La direccin es obligatoria.":"La ciudad es obligatoria.":"El celular es obligatorio.":"El telfono fijo es obligatorio.":"El nombre es obligatorio.",ce=async Y=>{Y.preventDefault();const Z=le();if(Z)return alert(" "+Z);g(!0);const Te={..._,nombre_busqueda:sm(_.nombre),actualizado:Pt()};try{C?await Ut(De(J,"sucursales",C),Te):await Bt(ue(J,"sucursales"),{...Te,creado:Pt()}),await k(),Q(),alert(" Sucursal guardada.")}catch(ve){console.error("Error guardando sucursal:",ve),alert(" No se pudo guardar la sucursal.")}finally{g(!1)}},_e=async Y=>{if(window.confirm(`Eliminar la sucursal "${Y.nombre}"?`))try{await Tn(De(J,"sucursales",Y.id)),await k(),alert(" Sucursal eliminada.")}catch(Z){console.error("Error eliminando sucursal:",Z),alert(" No se pudo eliminar.")}},Ie=async Y=>{I(Y),v(!0)},fe=async(Y,Z)=>{N(Te=>Te.map(ve=>ve.id===Y?{...ve,sucursalIds:Z?Array.from(new Set([...ve.sucursalIds||[],w])):(ve.sucursalIds||[]).filter(K=>K!==w)}:ve))},ye=async()=>{if(w){P(!0);try{const Y=T.map(async Z=>{const Te=Array.isArray(Z.sucursalIds)?Z.sucursalIds:[],ve=De(J,"usuarios",Z.id),K=await Co(ve).catch(()=>null),X=K!=null&&K.exists()?K.data():{},B=Array.isArray(X==null?void 0:X.sucursalIds)?X.sucursalIds:[],me=Array.isArray(Z.sucursalIds)?Z.sucursalIds:[];(B.length!==me.length||B.some(ze=>!me.includes(ze)))&&await No(ve,{sucursalIds:me},{merge:!0})});await Promise.all(Y),alert(" Usuarios asociados actualizados."),v(!1)}catch(Y){console.error("Error guardando usuarios por oficina:",Y),alert(" No se pudo actualizar la asociacin de usuarios.")}finally{P(!1)}}},[Le,We]=b.useState([]),[Re,Je]=b.useState([]);b.useEffect(()=>{We([]),Je([])},[t,_.almacenIds]);const gt=b.useMemo(()=>c.filter(Y=>!(_.almacenIds||[]).includes(Y.id)),[c,_.almacenIds]),q=b.useMemo(()=>(_.almacenIds||[]).map(Y=>c.find(Z=>Z.id===Y)).filter(Boolean),[c,_.almacenIds]),pe=()=>{O(Y=>({...Y,almacenIds:Array.from(new Set([...Y.almacenIds||[],...Le]))})),We([])},xe=()=>{O(Y=>({...Y,almacenIds:(Y.almacenIds||[]).filter(Z=>!Re.includes(Z))})),Je([])};if(t==="new"||t==="edit"){const Y=t==="new"?"Nueva sucursal":"Editar sucursal";return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("h2",{style:{margin:0},children:Y}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:Q,children:"Volver"}),o.jsx("button",{className:"oc-btn primary",form:"frmSucursal",disabled:E,children:E?"Guardando...":"Guardar"})]})]}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsx("h3",{style:{marginTop:0},children:"Informacin bsica"}),o.jsxs("form",{id:"frmSucursal",onSubmit:ce,className:"oc-form-grid",style:{display:"grid",gridTemplateColumns:"repeat(2,minmax(0,1fr))",gap:12},children:[o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Nombre *"}),o.jsx("input",{name:"nombre",value:_.nombre,onChange:ge,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Telfono fijo *"}),o.jsx("input",{name:"telefonoFijo",value:_.telefonoFijo,onChange:ge,required:!0,inputMode:"tel"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Celular *"}),o.jsx("input",{name:"celular",value:_.celular,onChange:ge,required:!0,inputMode:"tel"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Ciudad *"}),o.jsx("input",{name:"ciudad",value:_.ciudad,onChange:ge,required:!0})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Direccin *"}),o.jsx("input",{name:"direccion",value:_.direccion,onChange:ge,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo postal"}),o.jsx("input",{name:"codigoPostal",value:_.codigoPostal,onChange:ge})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Correo electrnico *"}),o.jsx("input",{type:"email",name:"email",value:_.email,onChange:ge,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Consecutivo *"}),o.jsxs("select",{name:"consecutivoId",value:_.consecutivoId,onChange:ge,required:!0,children:[o.jsx("option",{value:"",children:"Seleccione..."}),m.length===0&&o.jsx("option",{value:"",disabled:!0,children:"(Sin consecutivos)"}),m.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Lista de precios *"}),o.jsxs("select",{name:"listaPreciosId",value:_.listaPreciosId,onChange:ge,required:!0,children:[o.jsx("option",{value:"",children:"Seleccione..."}),h.length===0&&o.jsx("option",{value:"",disabled:!0,children:"(Sin listas de precios)"}),h.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))]})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Almacenes *"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:8},children:[o.jsx("select",{multiple:!0,size:8,value:Le,onChange:Z=>We([...Z.target.selectedOptions].map(Te=>Te.value)),children:gt.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,alignItems:"center",justifyContent:"center"},children:[o.jsx("button",{type:"button",className:"oc-btn",onClick:pe,title:"Agregar ",children:">"}),o.jsx("button",{type:"button",className:"oc-btn",onClick:xe,title:" Quitar",children:"<"})]}),o.jsx("select",{multiple:!0,size:8,value:Re,onChange:Z=>Je([...Z.target.selectedOptions].map(Te=>Te.value)),children:q.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))})]}),o.jsx("small",{className:"oc-muted",children:"Usa los botones para mover almacenes entre disponibles y seleccionados."})]}),o.jsx("div",{className:"oc-col-2",children:o.jsx("hr",{style:{border:"none",borderTop:"1px solid #e5e7eb",margin:"6px 0 2px"}})}),o.jsx("h4",{className:"oc-col-2",style:{margin:"6px 0"},children:"Pie de pgina en documentos clnicos"}),o.jsxs("div",{className:"oc-field",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{id:"pieHabilitado",type:"checkbox",name:"pieHabilitado",checked:_.pieHabilitado,onChange:ge}),o.jsx("label",{htmlFor:"pieHabilitado",children:"Datos de sucursal en pie de pg. doc. clnicos"})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Pie de pgina personalizado doc. clnicos"}),o.jsx("input",{name:"piePersonalizado",value:_.piePersonalizado,onChange:ge,placeholder:"Texto opcional que se mostrar en el pie de pgina"})]}),o.jsx("div",{className:"oc-col-2",children:o.jsx("hr",{style:{border:"none",borderTop:"1px solid #e5e7eb",margin:"6px 0 2px"}})}),o.jsx("h4",{className:"oc-col-2",style:{margin:"6px 0"},children:"Informacin administrativa"}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo del prestador de servicio"}),o.jsx("input",{name:"codigoPrestador",value:_.codigoPrestador,onChange:ge})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo de prestador propio"}),o.jsx("input",{name:"codigoPrestadorPropio",value:_.codigoPrestadorPropio,onChange:ge})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Entidad Administradora Extranjeros"}),o.jsx("input",{name:"entidadExtranj",value:_.entidadExtranj,onChange:ge})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Entidad Administradora Nacionales"}),o.jsx("input",{name:"entidadNacional",value:_.entidadNacional,onChange:ge})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Centro de costos"}),o.jsx("input",{name:"centroCostos",value:_.centroCostos,onChange:ge})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Usuario para soporte"}),o.jsxs("select",{name:"usuarioSoporteId",value:_.usuarioSoporteId,onChange:ge,children:[o.jsx("option",{value:"",children:"Ninguno"}),T.map(Z=>o.jsx("option",{value:Z.id,children:Z.displayName||Z.nombre||Z.email||Z.id},Z.id))]})]})]})]})]})}return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("h2",{style:{margin:0},children:"Sucursales"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("input",{placeholder:"Buscar por nombre, telfono, direccin, ciudad, correo",value:a,onChange:Y=>l(Y.target.value),className:"search-input",style:{minWidth:260}}),o.jsx("button",{className:"oc-btn primary",onClick:oe,children:"+ Nueva sucursal"})]})]}),o.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:s?o.jsx("div",{className:"oc-muted",children:"Cargando"}):M.length===0?o.jsx("div",{className:"oc-muted",children:"Sin sucursales."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:120},children:"Telfono"}),o.jsx("th",{children:"Direccin"}),o.jsx("th",{children:"Correo"}),o.jsx("th",{style:{width:140},children:"Usuarios por oficina"}),o.jsx("th",{style:{width:180},children:"Acciones"})]})}),o.jsx("tbody",{children:M.map(Y=>{const Z=(T||[]).filter(Te=>(Te.sucursalIds||[]).includes(Y.id)).length;return o.jsxs("tr",{children:[o.jsx("td",{children:Y.nombre}),o.jsx("td",{className:"mono",children:Y.telefonoFijo||Y.celular||""}),o.jsx("td",{children:Y.direccion}),o.jsx("td",{className:"mono",children:Y.email}),o.jsx("td",{children:o.jsxs("button",{className:"oc-btn small",onClick:()=>Ie(Y.id),children:[" Ver (",Z,")"]})}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn small",onClick:()=>Oe(Y),children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>_e(Y),children:"Eliminar"})]})})]},Y.id)})})]})})}),L&&o.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:o.jsxs("div",{style:{background:"#fff",borderRadius:12,width:560,maxWidth:"95%",maxHeight:"90vh",overflow:"auto",padding:16,border:"1px solid #e5e7eb"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[o.jsx("h3",{style:{margin:0},children:"Usuarios asociados"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:()=>v(!1),children:"Cerrar"}),o.jsx("button",{className:"oc-btn primary",onClick:ye,disabled:R,children:R?"Guardando...":"Guardar"})]})]}),T.length===0?o.jsx("div",{className:"oc-muted",children:"No hay usuarios para asociar."}):o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 120px",gap:8},children:T.map(Y=>{const Z=(Y.sucursalIds||[]).includes(w);return o.jsxs(Fh.Fragment,{children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{type:"checkbox",checked:Z,onChange:Te=>fe(Y.id,Te.target.checked)}),o.jsx("span",{children:Y.displayName||Y.nombre||Y.email||Y.id})]}),o.jsx("span",{className:"oc-muted mono",style:{alignSelf:"center"},children:Y.email||""})]},Y.id)})})]})})]})}const im=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function HU(){const[t,e]=b.useState([]),[n,r]=b.useState(!0),[s,i]=b.useState(""),[a,l]=b.useState(null),[c,d]=b.useState({codigo:"",nombre:"",color:"#38a169",orden:1,activo:!0,descripcion:""}),h=()=>d({codigo:"",nombre:"",color:"#38a169",orden:((t==null?void 0:t.length)||0)+1,activo:!0,descripcion:""}),f=async()=>{r(!0);try{const E=qe(ue(J,"especialidades"),yt("orden","asc")),g=await Ae(E);e(g.docs.map(_=>({id:_.id,..._.data()||{}})))}catch(E){console.error("Error leyendo especialidades:",E),e([])}finally{r(!1)}};b.useEffect(()=>{f()},[]);const m=b.useMemo(()=>{const E=im(s);return E?t.filter(g=>im(`${g.codigo} ${g.nombre} ${g.descripcion}`).includes(E)):t},[t,s]),x=E=>{const{name:g,type:_,value:O,checked:L}=E.target;d(v=>({...v,[g]:_==="checkbox"?L:O}))},T=E=>{l(E.id),d({codigo:E.codigo||"",nombre:E.nombre||"",color:E.color||"#38a169",orden:E.orden??1,activo:!!E.activo,descripcion:E.descripcion||""}),window.scrollTo({top:0,behavior:"smooth"})},N=()=>{l(null),h()},C=async E=>{var _,O;E.preventDefault();const g={...c,nombre_busqueda:im(`${c.nombre} ${c.codigo}`),actualizado:Pt()};if(!((_=g.nombre)!=null&&_.trim()))return alert("El nombre es obligatorio.");if(!((O=g.codigo)!=null&&O.trim()))return alert("El cdigo es obligatorio.");try{a?await Ut(De(J,"especialidades",a),g):await Bt(ue(J,"especialidades"),{...g,creado:Pt()}),await f(),N(),alert(" Especialidad guardada.")}catch(L){console.error("Error guardando especialidad:",L),alert(" No se pudo guardar la especialidad.")}},S=async E=>{if(window.confirm(`Eliminar la especialidad "${E.nombre}"?`))try{await Tn(De(J,"especialidades",E.id)),await f(),alert(" Especialidad eliminada.")}catch(g){console.error("Error eliminando especialidad:",g),alert(" No se pudo eliminar.")}};return o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Especialidades"}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16,marginBottom:16},children:[o.jsx("h3",{style:{marginTop:0},children:a?"Editar especialidad":"Nueva especialidad"}),o.jsxs("form",{onSubmit:C,className:"oc-form-grid",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:12},children:[o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo *"}),o.jsx("input",{name:"codigo",value:c.codigo,onChange:x,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Nombre *"}),o.jsx("input",{name:"nombre",value:c.nombre,onChange:x,required:!0})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Descripcin"}),o.jsx("textarea",{name:"descripcion",value:c.descripcion,onChange:x,rows:2})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Color"}),o.jsx("input",{name:"color",value:c.color,onChange:x,type:"color"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Orden"}),o.jsx("input",{name:"orden",value:c.orden,onChange:x,type:"number"})]}),o.jsxs("div",{className:"oc-field",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{id:"activoEsp",name:"activo",checked:c.activo,onChange:x,type:"checkbox"}),o.jsx("label",{htmlFor:"activoEsp",children:"Activo"})]}),o.jsxs("div",{className:"oc-form-actions oc-col-2",style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8},children:[a&&o.jsx("button",{type:"button",className:"oc-btn",onClick:N,children:"Cancelar"}),o.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})]})]})]}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:10},children:[o.jsx("h3",{style:{margin:0},children:"Listado"}),o.jsx("input",{placeholder:"Buscar por nombre o cdigo",value:s,onChange:E=>i(E.target.value),className:"search-input",style:{minWidth:240}})]}),n?o.jsx("div",{className:"oc-muted",children:"Cargando"}):m.length===0?o.jsx("div",{className:"oc-muted",children:"Sin especialidades."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:90},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Descripcin"}),o.jsx("th",{style:{width:70},children:"Color"}),o.jsx("th",{style:{width:70},children:"Orden"}),o.jsx("th",{style:{width:90},children:"Activo"}),o.jsx("th",{style:{width:160},children:"Acciones"})]})}),o.jsx("tbody",{children:m.map(E=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:E.codigo}),o.jsx("td",{children:E.nombre}),o.jsx("td",{children:E.descripcion}),o.jsx("td",{children:o.jsx("div",{style:{width:18,height:18,borderRadius:4,background:E.color||"#999",border:"1px solid #e5e7eb"}})}),o.jsx("td",{className:"mono",children:E.orden??""}),o.jsx("td",{children:E.activo?"S":"No"}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn small",onClick:()=>T(E),children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>S(E),children:"Eliminar"})]})})]},E.id))})]})})]})]})}function WU(){const[t,e]=b.useState([]),[n,r]=b.useState({nombre:"",tipo:"Consultorio",sucursal:"",capacidad:1,profesionalesPermitidos:"",activo:!0}),[s,i]=b.useState(null),[a,l]=b.useState(!1);b.useEffect(()=>{const x=qe(ue(J,"recursos"),yt("nombre","asc")),T=an(x,N=>{e(N.docs.map(C=>({id:C.id,...C.data()})))});return()=>T()},[]);const c=x=>{const{name:T,value:N,type:C,checked:S}=x.target;r(E=>({...E,[T]:C==="checkbox"?S:N}))},d=()=>{r({nombre:"",tipo:"Consultorio",sucursal:"",capacidad:1,profesionalesPermitidos:"",activo:!0}),i(null)},h=async x=>{if(x.preventDefault(),!n.nombre.trim()){alert("El nombre es obligatorio.");return}l(!0);try{const T={nombre:n.nombre.trim(),tipo:n.tipo,sucursal:n.sucursal.trim(),capacidad:Number(n.capacidad)||1,profesionalesPermitidos:n.profesionalesPermitidos.split(",").map(N=>N.trim()).filter(Boolean),activo:n.activo};s?await Ut(De(J,"recursos",s),T):await Bt(ue(J,"recursos"),T),d()}catch(T){console.error("Error al guardar consultorio:",T),alert("Error al guardar.")}l(!1)},f=x=>{i(x.id),r({nombre:x.nombre||"",tipo:x.tipo||"Consultorio",sucursal:x.sucursal||"",capacidad:x.capacidad||1,profesionalesPermitidos:(x.profesionalesPermitidos||[]).join(", "),activo:x.activo??!0}),window.scrollTo({top:0,behavior:"smooth"})},m=async x=>{if(window.confirm("Eliminar este consultorio?"))try{await Tn(De(J,"recursos",x))}catch(T){console.error("Error al eliminar:",T),alert("No se pudo eliminar.")}};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Consultorios"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:s?"Editar consultorio":"Nuevo consultorio"}),o.jsxs("form",{className:"emp-form",onSubmit:h,children:[o.jsxs("div",{className:"oc-form-grid",children:[o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Nombre *"}),o.jsx("input",{name:"nombre",className:"emp-input",required:!0,value:n.nombre,onChange:c})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo"}),o.jsxs("select",{name:"tipo",className:"emp-select",value:n.tipo,onChange:c,children:[o.jsx("option",{children:"Consultorio"}),o.jsx("option",{children:"Sala"}),o.jsx("option",{children:"Silla"}),o.jsx("option",{children:"Equipo"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Sucursal"}),o.jsx("input",{name:"sucursal",className:"emp-input",value:n.sucursal,onChange:c})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Capacidad"}),o.jsx("input",{name:"capacidad",className:"emp-input",inputMode:"numeric",value:n.capacidad,onChange:c})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Profesionales permitidos"}),o.jsx("input",{name:"profesionalesPermitidos",className:"emp-input",placeholder:"IDs o nombres separados por coma",value:n.profesionalesPermitidos,onChange:c}),o.jsx("small",{style:{color:"#666"},children:"(solo informativo por ahora, se enlaza con doctores ms adelante)"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Activo"}),o.jsx("input",{name:"activo",type:"checkbox",checked:n.activo,onChange:c})]})]}),o.jsxs("div",{className:"oc-form-actions",children:[o.jsx("button",{type:"submit",className:"oc-btn primary",disabled:a,children:a?"Guardando...":s?"Actualizar":"Guardar"}),s&&o.jsx("button",{type:"button",className:"oc-btn secondary",onClick:d,children:"Cancelar"})]})]})]}),o.jsxs("div",{className:"emp-card",style:{marginTop:"1.5rem"},children:[o.jsx("div",{className:"emp-title",children:"Listado de consultorios"}),t.length===0?o.jsx("p",{style:{padding:"0.5rem 1rem"},children:"No hay consultorios registrados."}):o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Tipo"}),o.jsx("th",{children:"Sucursal"}),o.jsx("th",{children:"Capacidad"}),o.jsx("th",{children:"Activo"}),o.jsx("th",{style:{width:120},children:"Acciones"})]})}),o.jsx("tbody",{children:t.map(x=>o.jsxs("tr",{children:[o.jsx("td",{children:x.nombre}),o.jsx("td",{children:x.tipo}),o.jsx("td",{children:x.sucursal}),o.jsx("td",{children:x.capacidad}),o.jsx("td",{children:x.activo?"S":"No"}),o.jsxs("td",{children:[o.jsx("button",{className:"oc-btn small",onClick:()=>f(x),title:"Editar",children:""}),o.jsx("button",{className:"oc-btn small danger",onClick:()=>m(x.id),title:"Eliminar",children:""})]})]},x.id))})]})]})]})}function GU(){const[t,e]=b.useState([]),[n,r]=b.useState([]),[s,i]=b.useState([]),[a,l]=b.useState({nombreCompleto:"",identificacion:"",registroProfesional:"",entidadRegistro:"",correo:"",telefono:"",especialidades:[],sucursal:"",consultoriosPermitidos:[],disponibilidad:[],activo:!0}),[c,d]=b.useState(null),[h,f]=b.useState(!1),[m,x]=b.useState({dia:"Lunes",desde:"08:00",hasta:"12:00"});b.useEffect(()=>{const v=an(qe(ue(J,"profesionales"),yt("nombreCompleto")),w=>e(w.docs.map(I=>({id:I.id,...I.data()}))));return Ae(ue(J,"especialidades")).then(w=>r(w.docs.map(I=>({id:I.id,...I.data()})))),Ae(ue(J,"recursos")).then(w=>i(w.docs.map(I=>({id:I.id,...I.data()})))),()=>v()},[]);const T=v=>{const{name:w,value:I,type:R,checked:P}=v.target;l(V=>({...V,[w]:R==="checkbox"?P:I}))},N=v=>{l(w=>{const I=w.especialidades.includes(v)?w.especialidades.filter(R=>R!==v):[...w.especialidades,v];return{...w,especialidades:I}})},C=v=>{l(w=>{const I=w.consultoriosPermitidos.includes(v)?w.consultoriosPermitidos.filter(R=>R!==v):[...w.consultoriosPermitidos,v];return{...w,consultoriosPermitidos:I}})},S=()=>{l(v=>({...v,disponibilidad:[...v.disponibilidad,{...m}]})),x({dia:"Lunes",desde:"08:00",hasta:"12:00"})},E=v=>{l(w=>({...w,disponibilidad:w.disponibilidad.filter((I,R)=>R!==v)}))},g=()=>{l({nombreCompleto:"",identificacion:"",registroProfesional:"",entidadRegistro:"",correo:"",telefono:"",especialidades:[],sucursal:"",consultoriosPermitidos:[],disponibilidad:[],activo:!0}),d(null)},_=async v=>{if(v.preventDefault(),!a.nombreCompleto.trim())return alert("El nombre es obligatorio.");f(!0);try{const w={...a,nombreCompleto:a.nombreCompleto.trim()};c?await Ut(De(J,"profesionales",c),w):await Bt(ue(J,"profesionales"),w),g()}catch(w){console.error(w),alert("Error al guardar profesional.")}f(!1)},O=v=>{d(v.id),l({...v}),window.scrollTo({top:0,behavior:"smooth"})},L=async v=>{if(window.confirm("Eliminar este profesional?"))try{await Tn(De(J,"profesionales",v))}catch(w){console.error(w),alert("Error al eliminar.")}};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Profesionales"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:c?"Editar profesional":"Nuevo profesional"}),o.jsxs("form",{className:"emp-form",onSubmit:_,children:[o.jsxs("div",{className:"oc-form-grid",children:[o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Nombre completo *"}),o.jsx("input",{name:"nombreCompleto",className:"emp-input",required:!0,value:a.nombreCompleto,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Identificacin"}),o.jsx("input",{name:"identificacion",className:"emp-input",value:a.identificacion,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Registro profesional"}),o.jsx("input",{name:"registroProfesional",className:"emp-input",value:a.registroProfesional,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Entidad de registro"}),o.jsx("input",{name:"entidadRegistro",className:"emp-input",value:a.entidadRegistro,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Correo"}),o.jsx("input",{name:"correo",type:"email",className:"emp-input",value:a.correo,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Telfono"}),o.jsx("input",{name:"telefono",className:"emp-input",value:a.telefono,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Sucursal"}),o.jsx("input",{name:"sucursal",className:"emp-input",value:a.sucursal,onChange:T})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Especialidades"}),o.jsx("div",{className:"emp-checkbox-list",children:n.map(v=>o.jsxs("label",{style:{marginRight:"1rem"},children:[o.jsx("input",{type:"checkbox",checked:a.especialidades.includes(v.id),onChange:()=>N(v.id)})," ",v.nombre]},v.id))})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Consultorios permitidos"}),o.jsx("div",{className:"emp-checkbox-list",children:s.map(v=>o.jsxs("label",{style:{marginRight:"1rem"},children:[o.jsx("input",{type:"checkbox",checked:a.consultoriosPermitidos.includes(v.id),onChange:()=>C(v.id)})," ",v.nombre]},v.id))})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Disponibilidad semanal"}),o.jsxs("div",{style:{marginBottom:"0.5rem"},children:[o.jsx("select",{name:"dia",value:m.dia,onChange:v=>x(w=>({...w,dia:v.target.value})),children:["Lunes","Martes","Mircoles","Jueves","Viernes","Sbado"].map(v=>o.jsx("option",{children:v},v))})," ",o.jsx("input",{type:"time",value:m.desde,onChange:v=>x(w=>({...w,desde:v.target.value}))})," ","a"," ",o.jsx("input",{type:"time",value:m.hasta,onChange:v=>x(w=>({...w,hasta:v.target.value}))})," ",o.jsx("button",{type:"button",className:"oc-btn small",onClick:S,children:""})]}),a.disponibilidad.length>0&&o.jsx("ul",{style:{marginLeft:"1rem"},children:a.disponibilidad.map((v,w)=>o.jsxs("li",{children:[v.dia,": ",v.desde," - ",v.hasta," ",o.jsx("button",{type:"button",className:"oc-btn small danger",onClick:()=>E(w),children:""})]},w))})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Activo"}),o.jsx("input",{name:"activo",type:"checkbox",checked:a.activo,onChange:T})]})]}),o.jsxs("div",{className:"oc-form-actions",children:[o.jsx("button",{type:"submit",className:"oc-btn primary",disabled:h,children:h?"Guardando...":c?"Actualizar":"Guardar"}),c&&o.jsx("button",{type:"button",className:"oc-btn secondary",onClick:g,children:"Cancelar"})]})]})]}),o.jsxs("div",{className:"emp-card",style:{marginTop:"1.5rem"},children:[o.jsx("div",{className:"emp-title",children:"Listado de profesionales"}),t.length===0?o.jsx("p",{style:{padding:"0.5rem 1rem"},children:"No hay profesionales registrados."}):o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Registro"}),o.jsx("th",{children:"Especialidades"}),o.jsx("th",{children:"Sucursal"}),o.jsx("th",{children:"Activo"}),o.jsx("th",{style:{width:120},children:"Acciones"})]})}),o.jsx("tbody",{children:t.map(v=>{var w;return o.jsxs("tr",{children:[o.jsx("td",{children:v.nombreCompleto}),o.jsx("td",{children:v.registroProfesional}),o.jsx("td",{children:(w=v.especialidades)==null?void 0:w.map(I=>{var R;return((R=n.find(P=>P.id===I))==null?void 0:R.nombre)||""}).join(", ")}),o.jsx("td",{children:v.sucursal||""}),o.jsx("td",{children:v.activo?"S":"No"}),o.jsxs("td",{children:[o.jsx("button",{className:"oc-btn small",onClick:()=>O(v),title:"Editar",children:""}),o.jsx("button",{className:"oc-btn small danger",onClick:()=>L(v.id),title:"Eliminar",children:""})]})]},v.id)})})]})]})]})}const KU={"datos-basicos":EU,logo:IU,"lista-de-precios":_1,planes:Ld,consecutivos:zU,almacenes:void 0,"categorias-inventario":void 0,sucursales:qU,"metodos-de-pago":void 0,bancos:void 0,"formulario-de-pacientes":void 0,especialidades:HU,perfiles:void 0,usuarios:void 0,"condiciones-de-pago":void 0,parametros:void 0,"recursos-fisicos":void 0,"plantillas-doc-clinicos":void 0,"pestanas-consulta-med":void 0,cargos:void 0,impuestos:void 0,"catalogo-de-cuentas":void 0,suscripcion:void 0,consultorios:WU,profesionales:GU,"importar-procedimientos":LU};function QU(t=""){const e=t.toLowerCase().indexOf("/config/");return e===-1?[]:t.slice(e+8).split("/").filter(Boolean)}function YU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function XU({current:t,onNav:e}){const n=[{slug:"datos-basicos",label:"Datos bsicos"},{slug:"logo",label:"Logo"},{slug:"lista-de-precios",label:"Lista de precios"},{slug:"planes",label:"Planes"},{slug:"consecutivos",label:"Consecutivos"},{slug:"almacenes",label:"Almacenes",soon:!0},{slug:"categorias-inventario",label:"Categoras inventario",soon:!0},{slug:"sucursales",label:"Sucursales"},{slug:"metodos-de-pago",label:"Mtodos de pago",soon:!0},{slug:"bancos",label:"Bancos",soon:!0},{slug:"formulario-de-pacientes",label:"Formulario de pacientes",soon:!0},{slug:"especialidades",label:"Especialidades"},{slug:"perfiles",label:"Perfiles",soon:!0},{slug:"usuarios",label:"Usuarios",soon:!0},{slug:"condiciones-de-pago",label:"Condiciones de pago",soon:!0},{slug:"parametros",label:"Parmetros",soon:!0},{slug:"recursos-fisicos",label:"Recursos fsicos",soon:!0},{slug:"plantillas-doc-clinicos",label:"Plantillas Doc. Clnicos",soon:!0},{slug:"pestanas-consulta-med",label:"Pestaas Consulta Med.",soon:!0},{slug:"cargos",label:"Cargos",soon:!0},{slug:"impuestos",label:"Impuestos",soon:!0},{slug:"catalogo-de-cuentas",label:"Catlogo de cuentas",soon:!0},{slug:"suscripcion",label:"Suscripcin",soon:!0},{slug:"consultorios",label:"Consultorios"},{slug:"profesionales",label:"Profesionales"}];return o.jsxs("aside",{style:{width:300,flex:"0 0 300px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,position:"sticky",top:12,alignSelf:"flex-start",maxHeight:"calc(100vh - 24px)",overflow:"auto"},"aria-label":"Informacin general",children:[o.jsx("h4",{style:{margin:"4px 0 10px",color:"#64748b"},children:"Informacin general"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.map(r=>{const s=r.slug===t;return o.jsxs("button",{type:"button",onClick:()=>!r.soon&&e(r.slug),title:r.soon?"Prximamente":r.label,style:{textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid "+(s?"#60a5fa":"#e5e7eb"),background:s?"#eff6ff":"#f9fafb",fontWeight:600,cursor:r.soon?"not-allowed":"pointer",color:r.soon?"#94a3b8":"#0f172a"},children:[r.label," ",r.soon?"  prximamente":""]},r.slug)})})]})}function B0(){return o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsx("h3",{style:{marginTop:0},children:"Configuracin"}),o.jsxs("p",{className:"oc-muted",style:{margin:0},children:["Selecciona una seccin del men de la izquierda para empezar (por ejemplo, ",o.jsx("b",{children:"Datos bsicos"}),")."]})]})}function JU(){const{pathname:t}=Mn(),e=is(),n=QU(t),r=n[0]||"",s=n[1]||"",i=YU(t),a=r==="lista-de-precios"&&!s,l=r==="lista-de-precios"&&s==="productos",c=r==="lista-de-precios"&&s==="editar",d=r==="planes"&&!s,h=r==="planes"&&s==="nuevo",f=r==="planes"&&s==="editar";let m=KU[r]||B0,x={};if(c){const N=n[2]||null;m=kU,x={listaId:N,key:`lpedit-${N||"none"}`}}else l?m=OU:a&&(m=_1);if(r==="planes")if(h)m=Ld,x={mode:"new"};else if(f){const N=n[2]||null;m=Ld,x={mode:"edit",planId:N,key:`pl-edit-${N||"none"}`}}else d&&(m=Ld,x={mode:"list"});const T=N=>e(`${i}/config/${N}`);return b.useEffect(()=>{const N=t.toLowerCase();(N.endsWith("/config")||N.endsWith("/config/"))&&!r&&e(`${i}/config/datos-basicos`,{replace:!0})},[t,r,i,e]),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",gap:16,background:"#f8fafc",padding:16,borderRadius:12},children:[o.jsx(XU,{current:r,onNav:T}),o.jsx("div",{style:{minWidth:0,background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:r?o.jsx(m,{...x}):o.jsx(B0,{})})]})}const Hr=t=>(Number(t)||0).toLocaleString("es-CO",{maximumFractionDigits:0}),ta=()=>new Date().toISOString().slice(0,10),ZU=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),e3=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0),z0=t=>ot.fromDate(t),t3=()=>{const[t,e]=b.useState(null);return b.useEffect(()=>{const n=Jy(Vh,r=>e(r||null));return()=>n()},[]),t},rn=({children:t,align:e})=>o.jsx("th",{className:"oc-th",style:{position:"sticky",top:0,zIndex:1,textAlign:e||"left",background:"var(--oc-surface, #fff)"},children:t}),n3=()=>Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);function r3(){var xt;const t=t3(),e=[{key:"abrir",label:"Abrir caja",icon:""},{key:"abiertas",label:"Cajas abiertas",icon:""},{key:"cerradas",label:"Cajas cerradas",icon:""},{key:"mio",label:"Mi caja (hoy)",icon:""},{key:"simulados",label:"Cierres simulados",icon:""},{key:"bancos",label:"Bancos",icon:""}],[n,r]=b.useState("abiertas"),[s,i]=b.useState(""),[a,l]=b.useState(""),c=b.useRef(null),[d,h]=b.useState(!1),[f,m]=b.useState(""),[x,T]=b.useState([]),[N,C]=b.useState(!0),[S,E]=b.useState([]),[g,_]=b.useState(!0),[O,L]=b.useState(null),[v,w]=b.useState(!0),[I,R]=b.useState(""),[P,V]=b.useState([]),[k,M]=b.useState(null),[ge,oe]=b.useState(""),[Oe,Q]=b.useState("efectivo"),[le,ce]=b.useState(!1),[_e,Ie]=b.useState("ingreso"),[fe,ye]=b.useState(""),[Le,We]=b.useState(""),[Re,Je]=b.useState(!1),[gt,q]=b.useState([]),[pe,xe]=b.useState([]);b.useEffect(()=>{const z=qe(ue(J,"cajas"),it("estado","==","abierta"),yt("fechaApertura","desc")),ie=an(z,D=>{T(D.docs.map(U=>Y(U.id,U.data()))),C(!1),i("")},D=>{console.error(D),i((D==null?void 0:D.code)==="failed-precondition"?"Falta ndice (estado, fechaApertura) en Firestore.":(D==null?void 0:D.code)==="permission-denied"?"Permiso denegado en Firestore (revisa reglas).":"No se pudieron leer las cajas."),C(!1)});return()=>ie()},[]),b.useEffect(()=>{const z=qe(ue(J,"cajas"),it("estado","==","cerrada"),yt("fechaCierre","desc")),ie=an(z,D=>{E(D.docs.map(U=>Y(U.id,U.data()))),_(!1)},D=>{console.error(D),_(!1)});return()=>ie()},[]),b.useEffect(()=>{if(!t){L(null),w(!1);return}w(!0);const z=qe(ue(J,"cajas"),it("estado","==","abierta"),it("usuarioId","==",t.uid),it("fechaApertura",">=",z0(ZU())),it("fechaApertura","<",z0(e3()))),ie=an(z,D=>{const U=D.docs[0];L(U?Y(U.id,U.data()):null),w(!1)},D=>{console.error(D),w(!1),(D==null?void 0:D.code)==="failed-precondition"&&i("Falta ndice (estado, usuarioId, fechaApertura) en Firestore.")});return()=>ie()},[t]),b.useEffect(()=>{if(!(O!=null&&O.id)){q([]),xe([]);return}const z=qe(ue(J,"movimientos"),it("cashId","==",O.id),it("dia","==",ta()),yt("fecha","desc")),ie=an(z,ee=>q(ee.docs.map(ae=>({id:ae.id,...ae.data()}))),ee=>console.error(ee)),D=qe(ue(J,"payments"),it("cashId","==",O.id),it("dia","==",ta()),yt("fecha","desc")),U=an(D,ee=>xe(ee.docs.map(ae=>({id:ae.id,...ae.data()}))),ee=>console.error(ee));return()=>{ie(),U()}},[O==null?void 0:O.id]),b.useEffect(()=>{if(!(I!=null&&I.trim())){V([]);return}const z=qe(ue(J,"patients"),it("q",">=",B(I)),it("q","<=",B(I)+""),yt("q","asc")),ie=an(z,D=>V(D.docs.map(U=>({id:U.id,...U.data()}))),D=>console.error(D));return()=>ie()},[I]);function Y(z,ie={}){const D=rt=>{var dt;return((dt=rt==null?void 0:rt.toDate)==null?void 0:dt.call(rt))||(typeof rt=="string"?new Date(rt):rt||null)},U=D(ie.fechaApertura),ee=D(ie.fechaCierre),ae=Number(ie.baseInicial||0),Pe=Number(ie.baseActual!==void 0?ie.baseActual:ae),ke=Number(ie.saldoInicial||0),Be=Number(ie.saldoActual!==void 0?ie.saldoActual:ke),Ue=[];return Be<0&&Ue.push("Saldo negativo"),Pe<0&&Ue.push("Base negativa"),{id:z,estado:ie.estado||"abierta",usuarioId:ie.usuarioId||"",usuarioNombre:ie.usuarioNombre||"Usuario",nombre:ie.nombre||ie.usuarioNombre||"Caja",fechaApertura:U,fechaCierre:ee,baseInicial:ae,baseActual:Pe,saldoInicial:ke,saldoActual:Be,ia:Ue}}const Z=async z=>{var ie;if((ie=z==null?void 0:z.preventDefault)==null||ie.call(z),!t){i("Debes iniciar sesin para abrir una caja.");return}h(!0);try{const D=Number(f||0);await Bt(ue(J,"cajas"),{estado:"abierta",usuarioId:t.uid,usuarioNombre:t.displayName||t.email||"Usuario",fechaApertura:Pt(),baseInicial:D,baseActual:D,saldoInicial:0,saldoActual:0,dia:ta()}),m(""),r("mio"),i("")}catch(D){console.error(D),i("No se pudo abrir la caja.")}finally{h(!1)}},Te=async z=>{try{await Ut(De(J,"cajas",z),{estado:"cerrada",fechaCierre:Pt()}),r("cerradas")}catch(ie){console.error(ie),i("No se pudo cerrar la caja.")}},ve=async z=>{var D;if((D=z==null?void 0:z.preventDefault)==null||D.call(z),!(O!=null&&O.id)){i("Debes abrir tu caja para registrar movimientos.");return}const ie=Number(Le||0);if(!(!ie||ie<=0)){Je(!0);try{await Bt(ue(J,"movimientos"),{cashId:O.id,tipo:_e,concepto:fe||(_e==="ingreso"?"Ingreso":"Egreso"),valor:ie,fecha:Pt(),dia:ta(),usuarioId:(t==null?void 0:t.uid)||null});const U=_e==="ingreso"?ie:-ie;await Ut(De(J,"cajas",O.id),{saldoActual:h0(U)}),ye(""),We("")}catch(U){console.error(U),i("No se pudo registrar el movimiento.")}finally{Je(!1)}}},K=async z=>{var D;if((D=z==null?void 0:z.preventDefault)==null||D.call(z),!(O!=null&&O.id))return i("Abre tu caja para cobrar.");const ie=Number(ge||0);if(!(!ie||ie<=0)){if(!k)return i("Selecciona un paciente.");ce(!0);try{const U=await Bt(ue(J,"payments"),{cashId:O.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:ie,medio:Oe,estado:"aprobado",fecha:Pt(),dia:ta()});await Ut(De(J,"cajas",O.id),{saldoActual:h0(ie)}),oe(""),Q("efectivo"),i(`Pago registrado (${U.id}).`)}catch(U){console.error(U),i("No se pudo registrar el pago.")}finally{ce(!1)}}},X=async z=>{var D;if((D=z==null?void 0:z.preventDefault)==null||D.call(z),!(O!=null&&O.id))return i("Abre tu caja para cobrar.");const ie=Number(ge||0);if(!(!ie||ie<=0)){if(!k)return i("Selecciona un paciente.");ce(!0);try{const ee=`https://pay.odontocloud/mock/${n3()}`,ae=await Bt(ue(J,"payments"),{cashId:O.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:ie,medio:"link",estado:"pending",linkUrl:ee,fecha:Pt(),dia:ta()});i(`Link de pago generado: ${ee}`),oe("")}catch(U){console.error(U),i("No se pudo generar link de pago.")}finally{ce(!1)}}},B=z=>(z||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),me=b.useMemo(()=>{const z=B(a);return z?x.filter(ie=>[ie.nombre,ie.usuarioNombre,Hr(ie.saldoActual),Hr(ie.baseActual)].map(B).some(D=>D.includes(z))):x},[a,x]),Me=()=>o.jsxs("div",{className:"card",children:[o.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:o.jsx("h3",{children:"Abrir caja"})}),o.jsxs("form",{className:"oc-form",onSubmit:Z,style:{display:"flex",gap:12,alignItems:"end",flexWrap:"wrap"},children:[o.jsxs("label",{style:{display:"inline-flex",flexDirection:"column",gap:6},children:[o.jsx("span",{children:"Base inicial (COP)"}),o.jsx("input",{type:"number",className:"oc-input",min:"0",step:"1000",value:f,onChange:z=>m(z.target.value),placeholder:"0"})]}),o.jsx("button",{className:"oc-btn",type:"submit",disabled:d,children:d?"Abriendo...":"Abrir caja"})]}),o.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Se asociar a tu usuario y quedar visible en ",o.jsx("b",{children:"Mi caja (hoy)"}),"."]})]}),ze=()=>o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"card",style:{marginBottom:10},children:o.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("h3",{style:{margin:0},children:"Cajas Abiertas"}),o.jsx("span",{className:"oc-tag",children:me.length}),s&&o.jsx("span",{className:"oc-tag oc-tag-danger",children:s})]}),o.jsx("input",{ref:c,className:"oc-input",style:{maxWidth:280},placeholder:"Buscar...",value:a,onChange:z=>l(z.target.value)})]})}),o.jsx("div",{className:"card",children:o.jsx("div",{className:"oc-table-wrap",children:o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{className:"oc-thead",children:o.jsxs("tr",{className:"oc-tr",children:[o.jsx(rn,{children:"Caja"}),o.jsx(rn,{children:"Fecha apertura"}),o.jsx(rn,{align:"right",children:"Base actual"}),o.jsx(rn,{align:"right",children:"Saldo inicial"}),o.jsx(rn,{align:"right",children:"Saldo actual"}),o.jsx(rn,{children:"Usuario"}),o.jsx(rn,{children:"Acciones"})]})}),o.jsx("tbody",{className:"oc-tbody",children:N?o.jsx(q0,{cols:7}):me.length===0?o.jsx("tr",{className:"oc-tr",children:o.jsx("td",{className:"oc-td",colSpan:7,children:o.jsx("span",{className:"oc-muted",children:"Sin cajas abiertas."})})}):me.map(z=>{var ie;return o.jsxs("tr",{className:"oc-tr",children:[o.jsxs("td",{className:"oc-td",children:[o.jsx("b",{children:z.nombre})," ",(ie=z.ia)!=null&&ie.length?o.jsx("span",{className:"oc-tag oc-tag-danger",title:z.ia.join("  "),children:"IA"}):null]}),o.jsx("td",{className:"oc-td",children:z.fechaApertura?z.fechaApertura.toLocaleString("es-CO"):""}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Hr(z.baseActual)]}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Hr(z.saldoInicial)]}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right",color:z.saldoActual<0?"#b91c1c":void 0,fontWeight:600},children:["$",Hr(z.saldoActual)]}),o.jsx("td",{className:"oc-td",children:z.usuarioNombre}),o.jsxs("td",{className:"oc-td",style:{whiteSpace:"nowrap"},children:[o.jsx("button",{className:"oc-small-btn",onClick:()=>r("mio"),children:"Ver"})," ",o.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Te(z.id),children:"Cerrar"})]})]},z.id)})})]})})})]}),Fe=()=>o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("h3",{children:"Mi caja (hoy)"}),(O==null?void 0:O.estado)==="abierta"&&o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("span",{className:"oc-tag oc-tag-success",children:"Abierta"}),o.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Te(O.id),children:"Cerrar caja"})]})]}),v?o.jsx("div",{className:"oc-muted",children:"Cargando"}):O?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"oc-stats-row",style:{marginBottom:12},children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:"Base actual"}),o.jsxs("span",{className:"stat-value",children:["$",Hr(O.baseActual)]})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:"Saldo actual"}),o.jsxs("span",{className:"stat-value",style:{color:O.saldoActual<0?"#b91c1c":void 0},children:["$",Hr(O.saldoActual)]})]})]}),o.jsxs("div",{className:"card",style:{marginBottom:12},children:[o.jsx("h4",{style:{marginBottom:8},children:"Cobro rpido"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:8},children:[o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("label",{className:"oc-muted",children:"Paciente"}),o.jsx("input",{className:"oc-input",placeholder:"Buscar nombre o documento",value:I,onChange:z=>R(z.target.value)}),I&&P.length>0&&o.jsx("div",{className:"oc-dropdown",children:P.slice(0,6).map(z=>o.jsx("button",{className:`oc-menu-item ${(k==null?void 0:k.id)===z.id?"active":""}`,onClick:()=>{M(z),R(z.nombre||z.name||z.doc||"")},type:"button",children:(z.nombre||z.name||"Paciente")+(z.doc?`  ${z.doc}`:"")},z.id))})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("label",{className:"oc-muted",children:"Monto (COP)"}),o.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:ge,onChange:z=>oe(z.target.value)})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("label",{className:"oc-muted",children:"Medio"}),o.jsxs("select",{className:"oc-input",value:Oe,onChange:z=>Q(z.target.value),children:[o.jsx("option",{value:"efectivo",children:"Efectivo"}),o.jsx("option",{value:"tarjeta",children:"Tarjeta"}),o.jsx("option",{value:"transferencia",children:"Transferencia"}),o.jsx("option",{value:"link",children:"Link (en lnea)"})]})]}),o.jsx("div",{style:{display:"flex",alignItems:"end",gap:6},children:Oe==="link"?o.jsx("button",{className:"oc-btn",onClick:X,disabled:le,children:le?"Creando":"Generar link"}):o.jsx("button",{className:"oc-btn",onClick:K,disabled:le,children:le?"Guardando":"Registrar pago"})})]}),o.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Para link, el saldo se actualiza cuando el pago pase a ",o.jsx("b",{children:"aprobado"})," (webhook)."]})]}),o.jsxs("div",{className:"card",style:{marginBottom:12},children:[o.jsx("h4",{style:{marginBottom:8},children:"Movimiento manual"}),o.jsxs("form",{onSubmit:ve,style:{display:"grid",gridTemplateColumns:"120px 1fr 180px auto",gap:8},children:[o.jsxs("select",{className:"oc-input",value:_e,onChange:z=>Ie(z.target.value),children:[o.jsx("option",{value:"ingreso",children:"Ingreso"}),o.jsx("option",{value:"egreso",children:"Egreso"})]}),o.jsx("input",{className:"oc-input",placeholder:"Concepto (ej. Caja chica, Arriendo, etc.)",value:fe,onChange:z=>ye(z.target.value)}),o.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:Le,onChange:z=>We(z.target.value)}),o.jsx("button",{className:"oc-btn",disabled:Re,children:Re?"Guardando":"Agregar"})]})]}),o.jsxs("div",{className:"card",children:[o.jsx("h4",{style:{marginBottom:8},children:"Movimientos y pagos (hoy)"}),o.jsx("div",{className:"oc-table-wrap",style:{marginBottom:12},children:o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{className:"oc-thead",children:o.jsxs("tr",{className:"oc-tr",children:[o.jsx(rn,{children:"Tipo"}),o.jsx(rn,{children:"Concepto / Paciente"}),o.jsx(rn,{children:"Medio"}),o.jsx(rn,{children:"Estado"}),o.jsx(rn,{align:"right",children:"Valor"}),o.jsx(rn,{children:"Hora"})]})}),o.jsx("tbody",{className:"oc-tbody",children:gt.length===0&&pe.length===0?o.jsx("tr",{className:"oc-tr",children:o.jsx("td",{className:"oc-td",colSpan:6,children:o.jsx("span",{className:"oc-muted",children:"Sin movimientos ni pagos an."})})}):o.jsxs(o.Fragment,{children:[pe.map(z=>{var ie,D;return o.jsxs("tr",{className:"oc-tr",children:[o.jsx("td",{className:"oc-td",children:"Pago"}),o.jsxs("td",{className:"oc-td",children:[z.patientName||"Paciente"," ",z.linkUrl?o.jsx("a",{href:z.linkUrl,target:"_blank",rel:"noreferrer",children:"(link)"}):null]}),o.jsx("td",{className:"oc-td",children:z.medio}),o.jsx("td",{className:"oc-td",children:o.jsx("span",{className:`oc-tag ${z.estado==="aprobado"?"oc-tag-success":z.estado==="pending"?"oc-tag-warning":"oc-tag-danger"}`,children:z.estado})}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Hr(z.valor)]}),o.jsx("td",{className:"oc-td",children:(D=(ie=z.fecha)==null?void 0:ie.toDate)!=null&&D.call(ie)?z.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`pay-${z.id}`)}),gt.map(z=>{var ie,D;return o.jsxs("tr",{className:"oc-tr",children:[o.jsx("td",{className:"oc-td",children:z.tipo}),o.jsx("td",{className:"oc-td",children:z.concepto}),o.jsx("td",{className:"oc-td",children:""}),o.jsx("td",{className:"oc-td",children:o.jsx("span",{className:"oc-tag",children:(z.tipo==="ingreso","ok")})}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Hr(z.valor)]}),o.jsx("td",{className:"oc-td",children:(D=(ie=z.fecha)==null?void 0:ie.toDate)!=null&&D.call(ie)?z.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`mov-${z.id}`)})]})})]})}),o.jsx("p",{className:"oc-muted",children:"Sugerencia: crea ndice compuesto para `movimientos(cashId, dia, fecha)` y `payments(cashId, dia, fecha)` para rendimiento."})]})]}):o.jsxs("div",{className:"oc-empty",children:[o.jsx("p",{className:"oc-muted",children:"No tienes una caja abierta hoy."}),o.jsx("button",{className:"oc-btn",onClick:()=>r("abrir"),children:"Abrir caja"})]})]}),Ke=()=>o.jsxs("div",{className:"card",children:[o.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:o.jsxs("h3",{children:["Cajas cerradas ",o.jsx("span",{className:"oc-tag",children:S.length})]})}),o.jsx("div",{className:"oc-table-wrap",children:o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{className:"oc-thead",children:o.jsxs("tr",{className:"oc-tr",children:[o.jsx(rn,{children:"Caja"}),o.jsx(rn,{children:"Usuario"}),o.jsx(rn,{children:"Apertura"}),o.jsx(rn,{children:"Cierre"}),o.jsx(rn,{align:"right",children:"Saldo final"})]})}),o.jsx("tbody",{className:"oc-tbody",children:g?o.jsx(q0,{cols:5}):S.length===0?o.jsx("tr",{className:"oc-tr",children:o.jsx("td",{className:"oc-td",colSpan:5,children:o.jsx("span",{className:"oc-muted",children:"Sin cajas cerradas."})})}):S.map(z=>o.jsxs("tr",{className:"oc-tr",children:[o.jsx("td",{className:"oc-td",children:z.nombre}),o.jsx("td",{className:"oc-td",children:z.usuarioNombre}),o.jsx("td",{className:"oc-td",children:z.fechaApertura?z.fechaApertura.toLocaleString("es-CO"):""}),o.jsx("td",{className:"oc-td",children:z.fechaCierre?z.fechaCierre.toLocaleString("es-CO"):""}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Hr(z.saldoActual)]})]},z.id))})]})})]}),we=()=>o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Cierres simulados"}),o.jsx("p",{className:"oc-muted",children:"El cierre hipottico compara ventas y movimientos detectando errores y descuadres con IA. (Conectar fuente de datos para activarlo)."})]}),lt=()=>o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Bancos"}),o.jsx("p",{className:"oc-muted",children:"Conciliacin de consignaciones/pagos electrnicos contra caja del da. (Conectar pasarela o extractos para habilitar)."})]}),Ze=({m:z})=>o.jsxs("button",{type:"button",onClick:()=>r(z.key),className:`oc-menu-item ${n===z.key?"active":""}`,style:{width:"100%",textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid transparent",background:n===z.key?"var(--oc-surface-2, #f3f6ff)":"transparent",fontWeight:600},title:z.label,children:[o.jsx("span",{style:{opacity:.8,marginRight:6},children:z.icon}),z.label]});return o.jsxs("div",{className:"oc-main-content",style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:16},children:[o.jsx("aside",{className:"card",role:"navigation","aria-label":"Men de caja",style:{height:"fit-content",padding:12},children:o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:e.map(z=>o.jsx(Ze,{m:z},z.key))})}),o.jsxs("section",{children:[o.jsx("div",{className:"card",style:{marginBottom:12,padding:12},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[o.jsxs("div",{className:"oc-breadcrumb",children:[o.jsx("span",{children:"Caja"}),o.jsx("span",{children:""}),o.jsx("b",{children:(xt=e.find(z=>z.key===n))==null?void 0:xt.label})]}),n==="abiertas"&&o.jsx("input",{ref:c,className:"oc-input",placeholder:"Buscar...",value:a,onChange:z=>l(z.target.value),style:{maxWidth:300}})]})}),n==="abrir"&&o.jsx(Me,{}),n==="abiertas"&&o.jsx(ze,{}),n==="cerradas"&&o.jsx(Ke,{}),n==="mio"&&o.jsx(Fe,{}),n==="simulados"&&o.jsx(we,{}),n==="bancos"&&o.jsx(lt,{})]})]})}function q0({cols:t=6,n:e=3}){return o.jsx(o.Fragment,{children:Array.from({length:e}).map((n,r)=>o.jsx("tr",{className:"oc-tr",children:Array.from({length:t}).map((s,i)=>o.jsx("td",{className:"oc-td",children:o.jsx("div",{style:{height:12,width:i===0?160:100+i%3*40,background:"var(--oc-skeleton, #e5e7eb)",borderRadius:6}})},i))},r))})}function s3({items:t=[]}){return o.jsxs("div",{className:"card activity-card",children:[o.jsx("h4",{children:"Actividad reciente"}),o.jsx("ul",{className:"activity-list",children:t.map(e=>o.jsxs("li",{children:[o.jsx("strong",{children:e.title}),o.jsx("div",{className:"time",children:e.time})]},e.id))})]})}function i3({status:t}){return t?o.jsxs("div",{className:"card",children:[o.jsx("h4",{children:"Automatizaciones (N8N)"}),o.jsxs("div",{className:"n8n-line",children:[o.jsx("strong",{children:"Conectado:"})," ",t.connected?"S":"No"]}),o.jsxs("div",{className:"n8n-line",children:[o.jsx("strong",{children:"Flujos activos:"})," ",t.flowsRunning]}),t.lastError&&o.jsxs("div",{className:"n8n-error",children:["Error: ",t.lastError]})]}):null}const om={es:{nav_home:"Inicio",nav_agenda:"Agenda",nav_patients:"Pacientes",nav_billing:"Facturacin",nav_inventory:"Inventario",nav_odontogram:"Odontograma",nav_reports:"Reportes",nav_cash:"Caja",nav_admin:"Administracin",welcomeTitle:"Bienvenido a OdontoCloud",welcomeSubtitle:"Administra tus pacientes, agenda, inventario y facturacin de manera inteligente y moderna.",clinicLabel:"Clnica",userLabel:"Usuario",roleLabel:"Rol",searchPlaceholder:"Buscar acciones o ir a",stats_patientsToday:"Pacientes totales",stats_appointmentsToday:"Citas hoy",stats_revenueToday:"Facturacin hoy",stats_waiting:"En espera",stats_currency:"COP",n8n_title:"Automatizaciones (n8n)",recent_title:"Actividad reciente",recent_empty:"Sin actividad registrada.",loading:"Cargando...",logout:"Cerrar sesin",module_coming:"Mdulo prximamente.",todays_appts:"Citas de hoy",see_schedule:"Ir a Agenda",no_appts_today:"No hay citas programadas hoy.",at:"a las"},en:{nav_home:"Overview",nav_agenda:"Schedule",nav_patients:"Patients",nav_billing:"Billing",nav_inventory:"Inventory",nav_odontogram:"Odontogram",nav_reports:"Reports",nav_cash:"Cash",nav_admin:"Administration",welcomeTitle:"Welcome to OdontoCloud",welcomeSubtitle:"Manage your patients, schedule, inventory and billing in a smart and modern way.",clinicLabel:"Clinic",userLabel:"User",roleLabel:"Role",searchPlaceholder:"Search actions or go to",stats_patientsToday:"Total patients",stats_appointmentsToday:"Appointments today",stats_revenueToday:"Revenue today",stats_waiting:"In waiting room",stats_currency:"COP",n8n_title:"Automations (n8n)",recent_title:"Recent activity",recent_empty:"No activity yet.",loading:"Loading...",logout:"Log out",module_coming:"Module coming soon.",todays_appts:"Today's appointments",see_schedule:"Open Schedule",no_appts_today:"No appointments today.",at:"at"}},b1=()=>typeof navigator>"u"||(navigator.language||navigator.userLanguage||"es").toLowerCase().startsWith("es")?"es":"en",o3=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},a3=()=>b.useMemo(()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0);return{startToday:ot.fromDate(e),endToday:ot.fromDate(n),startTodayJS:e}},[]),l3=t=>`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,c3=(t,e)=>t.toLocaleTimeString(e==="es"?"es-CO":"en-US",{hour:"2-digit",minute:"2-digit"}),u3=(t,e)=>{try{const[n,r,s]=(t||"").split("-").map(l=>parseInt(l,10)),[i=0,a=0]=(e||"00:00").split(":").map(l=>parseInt(l,10));return new Date(n,(r||1)-1,s||1,i,a,0,0)}catch{return new Date}};function d3({data:t=[]}){const s=Math.max(1,...t.map(d=>Number(d.value)||0)),i=t.length||7,a=10,l=Math.max(16,Math.min(44,(640-a*(i+1))/i)),c=(l+a)*i+a;return o.jsx("div",{style:{width:"100%",overflowX:"auto"},children:o.jsxs("svg",{width:c,height:240,role:"img","aria-label":"Pacientes registrados por da en la ltima semana",children:[[.25,.5,.75,1].map((d,h)=>{const f=18+(1-d)*182;return o.jsx("line",{x1:0,x2:c,y1:f,y2:f,stroke:"#e5e7eb",strokeDasharray:"4 4"},h)}),t.map((d,h)=>{const f=Number(d.value)||0,m=Math.round(f/s*182),x=a+h*(l+a),T=200-m;return o.jsxs("g",{children:[o.jsx("rect",{x,y:T,width:l,height:m,rx:"6",ry:"6",fill:f>0?"#0ea5e9":"#cbd5e1",children:o.jsx("title",{children:`${d.label||d.shortLabel||""}  ${f} paciente${f!==1?"s":""}`})}),f>0&&m>14&&o.jsx("text",{x:x+l/2,y:T-6,textAnchor:"middle",fontSize:"11",fill:"#0f172a",children:f}),o.jsx("text",{x:x+l/2,y:214,textAnchor:"middle",fontSize:"11",fill:"#64748b",children:d.shortLabel||""})]},h)})]})})}function h3({onNavigate:t,onAction:e,placeholder:n}){const[r,s]=b.useState(""),[i,a]=b.useState(!1),[l,c]=b.useState(0),d=b.useRef(null),h=b.useMemo(()=>[{group:"Navegacin",label:"Ir a Inicio",keywords:"inicio home overview",run:()=>t==null?void 0:t("Inicio")},{group:"Navegacin",label:"Ir a Agenda",keywords:"agenda calendario schedule",run:()=>t==null?void 0:t("Agenda")},{group:"Navegacin",label:"Ir a Pacientes",keywords:"pacientes",run:()=>t==null?void 0:t("Pacientes")},{group:"Navegacin",label:"Ir a Facturacin",keywords:"facturacion facturas billing",run:()=>t==null?void 0:t("Facturacin")},{group:"Navegacin",label:"Ir a Inventario",keywords:"inventario stock",run:()=>t==null?void 0:t("Inventario")},{group:"Navegacin",label:"Ir a Odontograma",keywords:"odontograma",run:()=>t==null?void 0:t("Odontograma")},{group:"Navegacin",label:"Ir a Reportes",keywords:"reportes informes",run:()=>t==null?void 0:t("Reportes")},{group:"Acciones",label:"Nueva cita",keywords:"nueva cita agendar",run:()=>e==null?void 0:e("new_appointment")},{group:"Acciones",label:"Nuevo paciente",keywords:"nuevo paciente alta",run:()=>e==null?void 0:e("new_patient")},{group:"Acciones",label:"Nueva factura",keywords:"nueva factura",run:()=>e==null?void 0:e("new_invoice")},{group:"Acciones",label:"Exportar agenda",keywords:"exportar agenda",run:()=>e==null?void 0:e("export_agenda")},{group:"Acciones",label:"Ir a hoy (Agenda)",keywords:"hoy today",run:()=>e==null?void 0:e("agenda_today")},{group:"Acciones",label:"Cambiar modo oscuro",keywords:"oscuro dark mode",run:()=>e==null?void 0:e("toggle_dark")},{group:"Acciones",label:"Cerrar sesin",keywords:"logout salir cerrar",run:()=>e==null?void 0:e("logout")},{group:"Ayuda",label:"Ver atajos de teclado",keywords:"atajos ayuda",run:()=>e==null?void 0:e("show_shortcuts")},{group:"Ayuda",label:"Soporte / Contacto",keywords:"soporte ayuda contacto",run:()=>e==null?void 0:e("support")}],[t,e]),f=b.useMemo(()=>{const N=r.toLowerCase().trim();return N?h.filter(C=>C.label.toLowerCase().includes(N)||C.keywords.includes(N)):[]},[r,h]);b.useEffect(()=>{const N=C=>{d.current&&(d.current.contains(C.target)||a(!1))};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[]);const m=N=>{var C;(C=N.run)==null||C.call(N),s(""),a(!1)},x=N=>{!i||f.length===0||(N.key==="ArrowDown"&&(N.preventDefault(),c(C=>(C+1)%f.length)),N.key==="ArrowUp"&&(N.preventDefault(),c(C=>(C-1+f.length)%f.length)),N.key==="Enter"&&(N.preventDefault(),f[l]&&m(f[l])),N.key==="Escape"&&a(!1))},T=b.useMemo(()=>{const N=new Map;return f.forEach(C=>{N.has(C.group)||N.set(C.group,[]),N.get(C.group).push(C)}),Array.from(N.entries())},[f]);return o.jsxs("div",{className:"oc-search-wrap",ref:d,children:[o.jsx("input",{className:"oc-search",type:"search",inputMode:"search",placeholder:n,"aria-label":n,value:r,onChange:N=>{s(N.target.value),a(!!N.target.value),c(0)},onFocus:()=>a(!!r),onKeyDown:x}),i&&o.jsx("div",{className:"oc-search-dropdown",role:"listbox","aria-label":"Resultados de comandos",children:T.length===0?o.jsx("div",{className:"oc-search-item empty",children:"Escribe para ver opciones"}):T.map(([N,C])=>o.jsxs("div",{children:[o.jsx("div",{className:"oc-search-group",children:N}),C.map(S=>{const E=f.indexOf(S);return o.jsx("button",{className:`oc-search-item ${E===l?"active":""}`,onMouseEnter:()=>c(E),onClick:()=>m(S),role:"option",children:o.jsx("span",{className:"oc-search-title",children:S.label})},S.label)})]},N))})]})}function f3({open:t,anchorRect:e,onClose:n,onSoon:r,onNavigatePath:s,onSetFactView:i,dark:a}){const[l,c]=b.useState(null),d=b.useRef(null);if(b.useEffect(()=>{if(!t)return;const M=oe=>oe.key==="Escape"&&(n==null?void 0:n()),ge=()=>n==null?void 0:n();return window.addEventListener("keydown",M),window.addEventListener("scroll",ge,!0),()=>{window.removeEventListener("keydown",M),window.removeEventListener("scroll",ge,!0)}},[t,n]),!t)return null;const h=((e==null?void 0:e.bottom)||60)+8,f=Math.max(12,Math.min(((e==null?void 0:e.left)||300)-160,window.innerWidth-920)),m=10,x=f+360+m,T=a?"#0b1220":"#ffffff",N=a?"#e5e7eb":"#0f172a",C=a?"#0f1a32":"#f3f6ff",S=a?"#1f2a44":"#e2e8f0",E=a?"#b6c1d1":"#475569",g={position:"fixed",top:h,left:f,width:880,maxWidth:"calc(100vw - 24px)",background:T,color:N,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${S}`,zIndex:400,padding:12},_={position:"fixed",top:h,left:x,width:420,maxWidth:"calc(100vw - 24px)",background:T,color:N,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${S}`,zIndex:410,padding:12},O={display:"flex",flexDirection:"column",gap:6,padding:"8px 10px"},L={height:38,borderRadius:10,padding:"0 12px",display:"flex",alignItems:"center",gap:8,fontSize:".92rem",cursor:"pointer",border:"1px solid transparent",background:"transparent",color:N,fontWeight:500,textAlign:"left"},v=(M,ge=!0)=>Object.assign(M.currentTarget.style,ge?{background:C,borderColor:S}:{background:"transparent",borderColor:"transparent"}),w=()=>{d.current&&clearTimeout(d.current)},I=()=>{w(),d.current=setTimeout(()=>n==null?void 0:n(),180)},R={position:"fixed",top:h,left:f+360,width:m,height:520,zIndex:405},P=[{label:"Recibo de caja",key:"recibo",path:"facturacion/recibo"},{label:"Saldo a favor",key:"saldo",path:"facturacion/saldo"},{label:"Nota crdito",key:"nc",path:"facturacion/nc"},{label:"Nota dbito",key:"nd",path:"facturacion/nd"},{label:"Liquidaciones",key:"liq",path:"facturacion/liq"},{label:"Traslados",key:"tras",path:"facturacion/tras"},{label:"Pagos",key:"pagos",path:"facturacion/pagos"},{label:"rdenes de compra",key:"oc",path:"facturacion/oc"},{label:"Factura de venta",key:"fv",path:"facturacion/facturas"},{label:"Facturas de compra",key:"fc",path:"facturacion/fc"}],V=[{label:"RIPS anteriores (RS-3374)",key:"rips3374"},{label:"RIPS nuevo (RS-2275)",key:"rips2275"}],k=M=>{i==null||i(M.key),s==null||s(M.path),n==null||n()};return o.jsxs(o.Fragment,{children:[o.jsx("div",{onClick:n,style:{position:"fixed",inset:0,background:"transparent",zIndex:399}}),o.jsx("div",{style:g,onMouseEnter:w,onMouseLeave:I,children:o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"360px 1fr",gap:8,alignItems:"start"},children:[o.jsxs("div",{style:O,children:[o.jsx("button",{type:"button",style:L,onMouseEnter:()=>{w(),c("facturacion")},onFocus:()=>{w(),c("facturacion")},onClick:()=>c(M=>M==="facturacion"?null:"facturacion"),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Facturacin "}),o.jsx("button",{type:"button",style:L,onMouseEnter:()=>{w(),c("rips")},onFocus:()=>{w(),c("rips")},onClick:()=>c(M=>M==="rips"?null:"rips"),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" RIPS "}),o.jsx("button",{type:"button",style:L,onClick:()=>s==null?void 0:s("agenda"),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Gestin de agenda"}),o.jsx("button",{type:"button",style:L,onClick:()=>s==null?void 0:s("inventario"),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Inventario"}),o.jsx("button",{type:"button",style:L,onClick:()=>r==null?void 0:r(),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Convenios"}),o.jsx("button",{type:"button",style:L,onClick:()=>r==null?void 0:r(),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Terceros"}),o.jsx("button",{type:"button",style:L,onClick:()=>r==null?void 0:r(),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Campaas"}),o.jsx("button",{type:"button",style:L,onClick:()=>r==null?void 0:r(),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Temperatura y humedad"}),o.jsx("button",{type:"button",style:L,onClick:()=>r==null?void 0:r(),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Residuos"}),o.jsx("button",{type:"button",style:L,onClick:()=>r==null?void 0:r(),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Medicamentos y planes"}),o.jsx("button",{type:"button",style:L,onClick:()=>r==null?void 0:r(),onMouseOver:M=>v(M,!0),onMouseOut:M=>v(M,!1),children:" Esterilizacin"})]}),o.jsx("div",{style:O,children:o.jsxs("div",{style:{fontSize:".85rem",color:E},children:["Accesos rpidos a mdulos de administracin. Pasa el mouse por ",o.jsx("b",{children:"Facturacin"})," o ",o.jsx("b",{children:"RIPS"})," para ver sus acciones."]})})]})}),o.jsx("div",{style:R,onMouseEnter:w,onMouseLeave:I}),l&&o.jsx("div",{style:_,onMouseEnter:w,onMouseLeave:I,children:o.jsx("div",{style:{...O,display:"grid",gridTemplateColumns:"1fr"},children:(l==="facturacion"?P:V).map(M=>o.jsx("button",{type:"button",style:L,onClick:()=>l==="facturacion"?k(M):r==null?void 0:r(),onMouseOver:ge=>v(ge,!0),onMouseOut:ge=>v(ge,!1),children:M.label},M.label))})})]})}function p3({t,companyName:e,userName:n,role:r,darkMode:s,weeklySeries:i,weekRangeLabel:a,todaysAppointments:l,todaysLoading:c,metrics:d,metricsLoading:h,n8nState:f,n8nLoading:m,recent:x,recentLoading:T,onGoAgenda:N}){return o.jsxs("div",{className:"oc-main-content",children:[o.jsxs("section",{className:"oc-hero","aria-label":"Resumen general",children:[o.jsxs("div",{className:"oc-hero-text",children:[o.jsx("h1",{children:t("welcomeTitle")}),o.jsx("p",{children:t("welcomeSubtitle")}),o.jsxs("p",{className:"oc-hero-meta",children:[t("clinicLabel"),": ",e,"  ",t("userLabel"),": ",n,"  ",t("roleLabel"),": ",r||""]})]}),o.jsxs("div",{className:"oc-hero-badge","aria-live":"polite",children:[o.jsx("span",{className:"oc-hero-badge-title",children:t("stats_appointmentsToday")}),o.jsx("span",{className:"oc-hero-badge-value",children:h&&c?"":d.citasHoy}),o.jsxs("span",{className:"oc-hero-badge-sub",children:[t("stats_patientsToday"),": ",h?"":d.pacientesHoy]})]})]}),o.jsxs("section",{className:"oc-stats-row","aria-label":"Indicadores del da",children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_patientsToday")}),o.jsx("span",{className:"stat-value",children:d.pacientesHoy})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_appointmentsToday")}),o.jsx("span",{className:"stat-value",children:d.citasHoy})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_revenueToday")}),o.jsxs("span",{className:"stat-value",children:[d.facturacionHoy.toLocaleString("es-CO")," ",o.jsx("span",{className:"stat-currency",children:t("stats_currency")})]})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_waiting")}),o.jsx("span",{className:"stat-value",children:d.enEspera})]})]}),o.jsxs("section",{className:"oc-grid","aria-label":"Contenido principal del dashboard",children:[o.jsx("div",{className:"oc-grid-main",children:o.jsxs("div",{className:"card card-quickcharts",children:[o.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[o.jsx("h3",{children:"Pacientes registrados  ltimos 7 das"}),o.jsx("span",{className:"oc-muted",style:{marginLeft:8,fontSize:12},children:a})]}),i.length===0||i.every(C=>((C==null?void 0:C.value)||0)===0)?o.jsx("p",{className:"oc-weekly-empty",children:"Sin pacientes registrados en la ltima semana."}):o.jsx(d3,{data:i})]})}),o.jsxs("aside",{className:"oc-grid-side","aria-label":"Panel lateral",children:[o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:t("n8n_title")}),m?o.jsx("span",{className:"oc-muted",children:t("loading")}):o.jsx(i3,{status:f})]}),o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[o.jsx("h3",{children:t("todays_appts")}),o.jsx("button",{className:"oc-small-link",type:"button",onClick:N,children:t("see_schedule")})]}),c?o.jsx("span",{className:"oc-muted",children:t("loading")}):l.length===0?o.jsx("p",{className:"oc-muted",children:t("no_appts_today")}):o.jsx("ul",{className:"oc-list",children:l.slice(0,5).map(C=>o.jsxs("li",{className:"oc-list-item",children:[o.jsxs("div",{className:"oc-list-main",children:[o.jsx("b",{children:C.pacienteNombre||"Paciente"})," ",o.jsxs("span",{className:"oc-muted",children:[t("at")," ",c3(C.fecha,b1())]})]}),o.jsx("div",{className:`oc-tag oc-tag-${(C.estado||"programada").toLowerCase().replace(/\s+/g,"-")}`,children:C.estado||"programada"})]},C.id))})]}),o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Actividad reciente"}),T?o.jsx("span",{className:"oc-muted",children:t("loading")}):x.length===0?o.jsx("p",{className:"oc-muted",children:t("recent_empty")}):o.jsx(s3,{items:x})]})]})]}),o.jsxs("footer",{className:"oc-footer",children:[" ",new Date().getFullYear()," OdontoCloud | Creado por Ingeniero Juan Madrid"]})]})}function am(){const t=is(),e=Mn(),[n]=b.useState(b1()),r=K=>om[n][K]||K,[s,i]=b.useState("Inicio"),[a,l]=b.useState("recibo"),[c,d]=b.useState(()=>{try{return localStorage.getItem("odontocloud:dark")==="1"}catch{return!1}});b.useEffect(()=>{try{localStorage.setItem("odontocloud:dark",c?"1":"0")}catch{}document.documentElement.classList.toggle("dark",c)},[c]);const[h]=b.useState(()=>o3()),[f]=b.useState((h==null?void 0:h.rol)||""),[m]=b.useState((h==null?void 0:h.email)||""),[x,T]=b.useState("OdontoCloud"),[N,C]=b.useState(m||"Usuario"),[S,E]=b.useState(!0);b.useEffect(()=>{const K=Jy(Vh,async X=>{try{if(!X){C(m||"Usuario"),T("OdontoCloud"),E(!1);return}C(X.displayName||X.email||m||"Usuario");const B=De(J,"empresas",X.uid),me=await Co(B);T(me.exists()&&me.data().nombre||"OdontoCloud")}catch(B){console.error("Error cargando empresa/usuario:",B)}finally{E(!1)}});return()=>K()},[m]);const[g,_]=b.useState({pacientesHoy:0,citasHoy:0,facturacionHoy:0,enEspera:0}),[O,L]=b.useState(!0),[v,w]=b.useState([]),[I,R]=b.useState([]),[P,V]=b.useState(!0),{startToday:k,endToday:M,startTodayJS:ge}=a3(),oe=b.useMemo(()=>l3(ge),[ge]),Oe=b.useMemo(()=>{const K=new Date,X=new Date(K.getFullYear(),K.getMonth(),K.getDate()-6),B=K,me=Me=>Me.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit",month:"short"}).replace(".","");return`${me(X)}  ${me(B)}`},[n]),Q=K=>{var ze;const X=K.data()||{};let B;if((ze=X.fecha)!=null&&ze.toDate){B=X.fecha.toDate();const Fe=X.horaInicio||X.hora;if(Fe&&typeof Fe=="string"){const[Ke=0,we=0]=Fe.split(":").map(lt=>parseInt(lt,10));B.setHours(Ke||0,we||0,0,0)}}else if(typeof X.fecha=="string"){const Fe=X.horaInicio||X.hora||"00:00";B=u3(X.fecha,Fe)}else B=new Date;const me=X.pacienteNombre||X.paciente||"Paciente",Me=X.estado&&String(X.estado)||"programada";return{id:K.id,fecha:B,pacienteId:X.pacienteId||"",pacienteNombre:me,estado:Me,motivo:X.motivo||""}};b.useEffect(()=>{const K=qe(ue(J,"citas"),it("fecha",">=",k),it("fecha","<",M),yt("fecha","asc")),X=qe(ue(J,"citas"),it("fecha","==",oe));let B=new Map,me=!1,Me=!1;const ze=()=>{const we=Array.from(B.values()).sort((Ze,xt)=>Ze.fecha.getTime()-xt.fecha.getTime()),lt=we.filter(Ze=>String(Ze.estado).toLowerCase().trim()==="en espera").length;R(we),_(Ze=>({...Ze,citasHoy:we.length,enEspera:lt})),me&&Me&&V(!1)},Fe=an(K,we=>{me=!0;const lt=new Map(B);we.docs.forEach(Ze=>lt.set(Ze.id,Q(Ze))),B=lt,ze()},we=>{console.error("Realtime citas hoy (TS):",we),me=!0,ze()}),Ke=an(X,we=>{Me=!0;const lt=new Map(B);we.docs.forEach(Ze=>lt.set(Ze.id,Q(Ze))),B=lt,ze()},we=>{console.error("Realtime citas hoy (STR):",we),Me=!0,ze()});return()=>{try{Fe(),Ke()}catch{}}},[k,M,oe]),b.useEffect(()=>{(async()=>{try{const B=(await dF(ue(J,"pacientes"))).data().count||0;let me=0;try{const Me=qe(ue(J,"facturas"),it("fecha",">=",k),it("fecha","<",M));(await Ae(Me)).forEach(Fe=>{const Ke=Fe.data();typeof Ke.monto=="number"&&(me+=Ke.monto)})}catch{me=0}_(Me=>({...Me,pacientesHoy:B,facturacionHoy:me}))}catch(X){console.error("Error cargando mtricas:",X),_(B=>({...B,pacientesHoy:0,facturacionHoy:0}))}finally{L(!1)}})()},[k,M]),b.useEffect(()=>{const K=new Date,X=new Date(K.getFullYear(),K.getMonth(),K.getDate()-6),B=new Date(K.getFullYear(),K.getMonth(),K.getDate()+1),me=new Map;for(let Fe=0;Fe<7;Fe++){const Ke=new Date(K.getFullYear(),K.getMonth(),K.getDate()-(6-Fe)),we=Ke.toISOString().slice(0,10),lt=Ke.toLocaleDateString(n==="es"?"es-ES":"en-US"),Ze=Ke.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit"}).replace(".","");me.set(we,{label:lt,shortLabel:Ze,value:0})}const Me=qe(ue(J,"pacientes"),it("createdAt",">=",ot.fromDate(X)),it("createdAt","<",ot.fromDate(B))),ze=an(Me,Fe=>{const Ke=new Map(me);Fe.docs.forEach(we=>{var ie;const lt=we.data()||{},Ze=(ie=we.data().createdAt)!=null&&ie.toDate?we.data().createdAt.toDate():lt.createdAt?new Date(lt.createdAt):null;if(!Ze||isNaN(Ze))return;const xt=Ze.toISOString().slice(0,10);if(!Ke.has(xt))return;const z=Ke.get(xt);z.value+=1,Ke.set(xt,z)}),w(Array.from(Ke.values()))},Fe=>{console.error("Error realtime serie semanal (pacientes):",Fe),w(Array.from(me.values()))});return()=>{try{ze()}catch{}}},[n]);const[le,ce]=b.useState([]),[_e,Ie]=b.useState(!0);b.useEffect(()=>{(async()=>{try{const X=qe(ue(J,"actividad"),yt("fecha","desc"),Pa(5)),B=await Ae(X);ce(B.docs.map(me=>({id:me.id,title:me.data().descripcion||me.data().titulo||"Actividad",time:me.data().resumenTiempo||""})))}catch(X){console.error("Error cargando actividad:",X),ce([])}finally{Ie(!1)}})()},[]);const[fe,ye]=b.useState(null),[Le,We]=b.useState(!0);b.useEffect(()=>{(async()=>{try{const X=De(J,"integraciones","n8n"),B=await Co(X);ye(B.exists()?{connected:!!B.data().connected,flowsRunning:B.data().flowsRunning||0,lastError:B.data().lastError||null}:{connected:!1,flowsRunning:0,lastError:null})}catch(X){console.error("Error cargando estado n8n:",X),ye({connected:!1,flowsRunning:0,lastError:"No se pudo leer el estado desde Firebase."})}finally{We(!1)}})()},[]);const Re=async()=>{try{localStorage.removeItem("odc_session")}catch{}try{await y2(Vh)}catch(K){console.error("Error al cerrar sesin:",K)}window.location.href="/"},[Je,gt]=b.useState(!1),[q,pe]=b.useState(null),xe=b.useRef(null);b.useRef(null);const Y=()=>{var X,B;const K=(B=(X=xe.current)==null?void 0:X.getBoundingClientRect)==null?void 0:B.call(X);pe(K),gt(!0)};b.useEffect(()=>{const K=e.pathname.toLowerCase(),X=K.includes("/pacientes"),B=K.includes("/caja"),me=K.includes("/agenda"),Me=K.includes("/facturacion"),ze=K.includes("/inventario"),Fe=K.includes("/odontograma"),Ke=K.includes("/reportes"),we=K.includes("/config");i(X?"Pacientes":B?"Caja":me?"Agenda":ze?"Inventario":Fe?"Odontograma":Ke?"Reportes":we?"Config":"Inicio"),Me&&(i("Facturacin"),K.includes("/pagos")?l("pagos"):K.includes("/facturas")?l("fv"):K.includes("/recibo")?l("recibo"):K.includes("/saldo")?l("saldo"):K.includes("/nc")?l("nc"):K.includes("/nd")?l("nd"):K.includes("/liq")?l("liq"):K.includes("/tras")?l("tras"):K.includes("/oc")?l("oc"):K.includes("/fc")?l("fc"):l("recibo"))},[e.pathname]);const Z=b.useMemo(()=>{const K=e.pathname.split("/").filter(Boolean),X=K.findIndex(B=>B.startsWith("dashboard_"));return X>=0?`/${K.slice(0,X+1).join("/")}`:""},[e.pathname]),Te=(K="")=>{const X=String(K).replace(/^\/+|\/+$/g,""),B=X?`${Z}/${X}`:Z||"/",me=e.pathname.toLowerCase()===B.toLowerCase();t(B,{replace:me})},ve=()=>{switch(s){case"Agenda":return o.jsx(sU,{});case"Pacientes":return o.jsx(b.Suspense,{fallback:o.jsx("div",{style:{padding:16},children:"Cargando"}),children:o.jsx(mU,{})});case"Facturacin":return o.jsx(iU,{view:a});case"Inventario":return o.jsx(oU,{});case"Odontograma":return o.jsx(aU,{});case"Reportes":return o.jsx(vU,{});case"Caja":return o.jsx(r3,{});case"Config":case"Configuracin":case"Configuracion":return o.jsx(JU,{});case"Inicio":default:return null}};return o.jsxs("div",{className:`oc-shell ${c?"oc-dark":""}`,children:[o.jsx("a",{href:"#oc-main",className:"oc-skip-link",children:"Saltar al contenido"}),o.jsxs("header",{className:"oc-header",role:"banner",children:[o.jsxs("div",{className:"oc-header-left",children:[o.jsx("img",{src:XN,alt:"OdontoCloud",className:"oc-logo"}),o.jsxs("div",{className:"oc-brand-text",children:[o.jsx("span",{className:"oc-brand-main",children:"OdontoCloud"}),o.jsx("span",{className:"oc-brand-sub",children:S?"...":x})]})]}),o.jsxs("nav",{className:"oc-nav",role:"navigation","aria-label":"Navegacin principal",children:[o.jsx(ra,{to:Z,end:!0,className:({isActive:K})=>K&&s==="Inicio"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_home"),children:r("nav_home")}),o.jsx(ra,{to:`${Z}/agenda`,className:({isActive:K})=>K||s==="Agenda"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_agenda"),children:r("nav_agenda")}),o.jsx(ra,{to:`${Z}/pacientes`,className:({isActive:K})=>K||s==="Pacientes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_patients"),children:r("nav_patients")}),o.jsx(ra,{to:`${Z}/caja`,className:({isActive:K})=>K||s==="Caja"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_cash"),children:r("nav_cash")}),o.jsx("button",{type:"button",ref:xe,className:"oc-nav-btn",title:r("nav_admin"),"aria-haspopup":"true","aria-expanded":Je,onClick:()=>Je?gt(!1):Y(),children:r("nav_admin")}),o.jsx(ra,{to:`${Z}/reportes`,className:({isActive:K})=>K||s==="Reportes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_reports"),children:r("nav_reports")})]}),o.jsxs("div",{className:"oc-header-right",children:[o.jsx(h3,{placeholder:r("searchPlaceholder"),onNavigate:K=>{K==="Inicio"?Te(""):K==="Facturacin"?(l("recibo"),Te("facturacion/recibo")):Te(K.toLowerCase())},onAction:K=>{switch(K){case"new_appointment":case"agenda_today":case"export_agenda":Te("agenda");break;case"new_patient":Te("pacientes");break;case"new_invoice":l("fv"),Te("facturacion/facturas");break;case"toggle_dark":d(X=>!X);break;case"logout":Re();break;case"show_shortcuts":alert("Atajos: Ctrl/Cmd + K para abrir bsqueda, / para moverse, Enter para ejecutar.");break;case"support":window.open("https://tu-soporte.odc","_blank");break}}}),o.jsx(_U,{basePath:Z,className:"ml-2"}),o.jsx("button",{className:"oc-icon-btn",type:"button",onClick:()=>d(K=>!K),"aria-pressed":c,title:c?"Activar modo claro":"Activar modo oscuro",children:c?"":""}),o.jsx("button",{className:"oc-icon-btn",type:"button",onClick:Re,title:om[n].logout,children:om[n].logout})]})]}),o.jsx(f3,{open:Je,anchorRect:q,dark:c,onClose:()=>gt(!1),onSoon:()=>{alert("Prximamente"),gt(!1)},onNavigatePath:K=>{Te(K),gt(!1)},onSetFactView:K=>l(K)}),o.jsxs("main",{id:"oc-main",className:"oc-main-wrapper",role:"main",children:[s!=="Inicio"&&ve(),s==="Inicio"&&o.jsx(p3,{t:r,companyName:x,userName:N,role:f,darkMode:c,weeklySeries:v,weekRangeLabel:Oe,todaysAppointments:I,todaysLoading:P,metrics:g,metricsLoading:O,n8nState:fe,n8nLoading:Le,recent:le,recentLoading:_e,onGoAgenda:()=>Te("agenda")})]})]})}const w1=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},E1=t=>{const e=(t||"").toLowerCase();return e==="administrador"?"/dashboard_admin":e==="doctor"?"/dashboard_doctor":e==="recepcionista"?"/dashboard_recepcion":"/"};function lm({allowedRoles:t,children:e}){var s;const n=w1();if(!n)return o.jsx(lh,{to:"/",replace:!0});const r=(s=n.rol)==null?void 0:s.toLowerCase();return t.map(i=>i.toLowerCase()).includes(r)?e:o.jsx(lh,{to:E1(n.rol),replace:!0})}function m3(){const t=w1();return o.jsxs(rP,{children:[o.jsx(na,{path:"/",element:t?o.jsx(lh,{to:E1(t.rol),replace:!0}):o.jsx(k4,{})}),o.jsx(na,{path:"/dashboard_admin/*",element:o.jsx(lm,{allowedRoles:["administrador"],children:o.jsx(am,{})})}),o.jsx(na,{path:"/dashboard_doctor/*",element:o.jsx(lm,{allowedRoles:["doctor"],children:o.jsx(am,{})})}),o.jsx(na,{path:"/dashboard_recepcion/*",element:o.jsx(lm,{allowedRoles:["recepcionista"],children:o.jsx(am,{})})}),o.jsx(na,{path:"*",element:o.jsx(lh,{to:"/",replace:!0})})]})}async function g3(){try{await p2(Vh,fT),await QM(J),console.log(" Firebase listo con sesin persistente y modo offline.")}catch(t){console.warn(" Firebase offline/persistencia fall:",t.message)}}const y3="modulepreload",v3=function(t){return"/odontocloud-react/"+t},H0={},_3=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=v3(c),c in H0)return;H0[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":y3,d||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),d)return new Promise((m,x)=>{f.addEventListener("load",m),f.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function x3(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:a}=t;let l,c;const d=async(f=!0)=>{await c};async function h(){if("serviceWorker"in navigator){if(l=await _3(async()=>{const{Workbox:f}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:f}},[]).then(({Workbox:f})=>new f("/odontocloud-react/sw.js",{scope:"/odontocloud-react/",type:"classic"})).catch(f=>{a==null||a(f)}),!l)return;l.addEventListener("activated",f=>{(f.isUpdate||f.isExternal)&&window.location.reload()}),l.addEventListener("installed",f=>{f.isUpdate||r==null||r()}),l.register({immediate:e}).then(f=>{i?i("/odontocloud-react/sw.js",f):s==null||s(f)}).catch(f=>{a==null||a(f)})}}return c=h(),d}const b3="empresa_logo_url",W0="empresa_nombre",w3=b.createContext(null);function E3({children:t}){const[e,n]=b.useState(""),[r,s]=b.useState("OdontoCloud"),[i,a]=b.useState(!0);b.useEffect(()=>{var f;let d="";try{d=localStorage.getItem(b3)||""}catch{}d||(d="/assets/logo.png"),n(d);let h="OdontoCloud";try{h=localStorage.getItem(W0)||((f=document.querySelector('meta[name="company-name"]'))==null?void 0:f.getAttribute("content"))||"OdontoCloud"}catch{}s(h),a(!1)},[]);const c={logoUrl:e,clinicName:r,loading:i,setLogoUrl:n,setClinicName:d=>{const h=d||"OdontoCloud";try{localStorage.setItem(W0,h)}catch{}let f=document.querySelector('meta[name="company-name"]');f||(f=document.createElement("meta"),f.setAttribute("name","company-name"),document.head.appendChild(f)),f.setAttribute("content",h),s(h)}};return o.jsx(w3.Provider,{value:c,children:t})}const I3="/odontocloud-react/";g3();x3({immediate:!0});aS(document.getElementById("root")).render(o.jsx(Fh.StrictMode,{children:o.jsx(E3,{children:o.jsx(TP,{basename:I3,children:o.jsx(m3,{})})})}));
