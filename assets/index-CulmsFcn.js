(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function W1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nE={exports:{}},zh={},rE={exports:{}},et={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tu=Symbol.for("react.element"),G1=Symbol.for("react.portal"),K1=Symbol.for("react.fragment"),Q1=Symbol.for("react.strict_mode"),Y1=Symbol.for("react.profiler"),X1=Symbol.for("react.provider"),J1=Symbol.for("react.context"),Z1=Symbol.for("react.forward_ref"),ej=Symbol.for("react.suspense"),tj=Symbol.for("react.memo"),nj=Symbol.for("react.lazy"),ex=Symbol.iterator;function rj(t){return t===null||typeof t!="object"?null:(t=ex&&t[ex]||t["@@iterator"],typeof t=="function"?t:null)}var sE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},iE=Object.assign,oE={};function sl(t,e,n){this.props=t,this.context=e,this.refs=oE,this.updater=n||sE}sl.prototype.isReactComponent={};sl.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};sl.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function aE(){}aE.prototype=sl.prototype;function Hg(t,e,n){this.props=t,this.context=e,this.refs=oE,this.updater=n||sE}var Wg=Hg.prototype=new aE;Wg.constructor=Hg;iE(Wg,sl.prototype);Wg.isPureReactComponent=!0;var tx=Array.isArray,lE=Object.prototype.hasOwnProperty,Gg={current:null},cE={key:!0,ref:!0,__self:!0,__source:!0};function uE(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)lE.call(e,r)&&!cE.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:tu,type:t,key:i,ref:a,props:s,_owner:Gg.current}}function sj(t,e){return{$$typeof:tu,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Kg(t){return typeof t=="object"&&t!==null&&t.$$typeof===tu}function ij(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var nx=/\/+/g;function op(t,e){return typeof t=="object"&&t!==null&&t.key!=null?ij(""+t.key):e.toString(36)}function ud(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case tu:case G1:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+op(a,0):r,tx(s)?(n="",t!=null&&(n=t.replace(nx,"$&/")+"/"),ud(s,e,n,"",function(d){return d})):s!=null&&(Kg(s)&&(s=sj(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(nx,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",tx(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+op(i,l);a+=ud(i,e,n,c,s)}else if(c=rj(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+op(i,l++),a+=ud(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function ku(t,e,n){if(t==null)return t;var r=[],s=0;return ud(t,r,"","",function(i){return e.call(n,i,s++)}),r}function oj(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Un={current:null},dd={transition:null},aj={ReactCurrentDispatcher:Un,ReactCurrentBatchConfig:dd,ReactCurrentOwner:Gg};function dE(){throw Error("act(...) is not supported in production builds of React.")}et.Children={map:ku,forEach:function(t,e,n){ku(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ku(t,function(){e++}),e},toArray:function(t){return ku(t,function(e){return e})||[]},only:function(t){if(!Kg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};et.Component=sl;et.Fragment=K1;et.Profiler=Y1;et.PureComponent=Hg;et.StrictMode=Q1;et.Suspense=ej;et.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=aj;et.act=dE;et.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=iE({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=Gg.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)lE.call(e,c)&&!cE.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:tu,type:t.type,key:s,ref:i,props:r,_owner:a}};et.createContext=function(t){return t={$$typeof:J1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:X1,_context:t},t.Consumer=t};et.createElement=uE;et.createFactory=function(t){var e=uE.bind(null,t);return e.type=t,e};et.createRef=function(){return{current:null}};et.forwardRef=function(t){return{$$typeof:Z1,render:t}};et.isValidElement=Kg;et.lazy=function(t){return{$$typeof:nj,_payload:{_status:-1,_result:t},_init:oj}};et.memo=function(t,e){return{$$typeof:tj,type:t,compare:e===void 0?null:e}};et.startTransition=function(t){var e=dd.transition;dd.transition={};try{t()}finally{dd.transition=e}};et.unstable_act=dE;et.useCallback=function(t,e){return Un.current.useCallback(t,e)};et.useContext=function(t){return Un.current.useContext(t)};et.useDebugValue=function(){};et.useDeferredValue=function(t){return Un.current.useDeferredValue(t)};et.useEffect=function(t,e){return Un.current.useEffect(t,e)};et.useId=function(){return Un.current.useId()};et.useImperativeHandle=function(t,e,n){return Un.current.useImperativeHandle(t,e,n)};et.useInsertionEffect=function(t,e){return Un.current.useInsertionEffect(t,e)};et.useLayoutEffect=function(t,e){return Un.current.useLayoutEffect(t,e)};et.useMemo=function(t,e){return Un.current.useMemo(t,e)};et.useReducer=function(t,e,n){return Un.current.useReducer(t,e,n)};et.useRef=function(t){return Un.current.useRef(t)};et.useState=function(t){return Un.current.useState(t)};et.useSyncExternalStore=function(t,e,n){return Un.current.useSyncExternalStore(t,e,n)};et.useTransition=function(){return Un.current.useTransition()};et.version="18.3.1";rE.exports=et;var w=rE.exports;const qh=W1(w);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lj=w,cj=Symbol.for("react.element"),uj=Symbol.for("react.fragment"),dj=Object.prototype.hasOwnProperty,hj=lj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fj={key:!0,ref:!0,__self:!0,__source:!0};function hE(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)dj.call(e,r)&&!fj.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:cj,type:t,key:i,ref:a,props:s,_owner:hj.current}}zh.Fragment=uj;zh.jsx=hE;zh.jsxs=hE;nE.exports=zh;var o=nE.exports,fE={exports:{}},ur={},pE={exports:{}},mE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(ee,te){var ne=ee.length;ee.push(te);e:for(;0<ne;){var me=ne-1>>>1,Ne=ee[me];if(0<s(Ne,te))ee[me]=te,ee[ne]=Ne,ne=me;else break e}}function n(ee){return ee.length===0?null:ee[0]}function r(ee){if(ee.length===0)return null;var te=ee[0],ne=ee.pop();if(ne!==te){ee[0]=ne;e:for(var me=0,Ne=ee.length,ke=Ne>>>1;me<ke;){var He=2*(me+1)-1,st=ee[He],De=He+1,We=ee[De];if(0>s(st,ne))De<Ne&&0>s(We,st)?(ee[me]=We,ee[De]=ne,me=De):(ee[me]=st,ee[He]=ne,me=He);else if(De<Ne&&0>s(We,ne))ee[me]=We,ee[De]=ne,me=De;else break e}}return te}function s(ee,te){var ne=ee.sortIndex-te.sortIndex;return ne!==0?ne:ee.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],d=[],f=1,h=null,p=3,x=!1,T=!1,C=!1,N=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(ee){for(var te=n(d);te!==null;){if(te.callback===null)r(d);else if(te.startTime<=ee)r(d),te.sortIndex=te.expirationTime,e(c,te);else break;te=n(d)}}function I(ee){if(C=!1,S(ee),!T)if(n(c)!==null)T=!0,ve(L);else{var te=n(d);te!==null&&we(I,te.startTime-ee)}}function L(ee,te){T=!1,C&&(C=!1,_(v),v=-1),x=!0;var ne=p;try{for(S(te),h=n(c);h!==null&&(!(h.expirationTime>te)||ee&&!R());){var me=h.callback;if(typeof me=="function"){h.callback=null,p=h.priorityLevel;var Ne=me(h.expirationTime<=te);te=t.unstable_now(),typeof Ne=="function"?h.callback=Ne:h===n(c)&&r(c),S(te)}else r(c);h=n(c)}if(h!==null)var ke=!0;else{var He=n(d);He!==null&&we(I,He.startTime-te),ke=!1}return ke}finally{h=null,p=ne,x=!1}}var V=!1,g=null,v=-1,b=5,P=-1;function R(){return!(t.unstable_now()-P<b)}function O(){if(g!==null){var ee=t.unstable_now();P=ee;var te=!0;try{te=g(!0,ee)}finally{te?k():(V=!1,g=null)}}else V=!1}var k;if(typeof E=="function")k=function(){E(O)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,z=M.port2;M.port1.onmessage=O,k=function(){z.postMessage(null)}}else k=function(){N(O,0)};function ve(ee){g=ee,V||(V=!0,k())}function we(ee,te){v=N(function(){ee(t.unstable_now())},te)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ee){ee.callback=null},t.unstable_continueExecution=function(){T||x||(T=!0,ve(L))},t.unstable_forceFrameRate=function(ee){0>ee||125<ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<ee?Math.floor(1e3/ee):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(ee){switch(p){case 1:case 2:case 3:var te=3;break;default:te=p}var ne=p;p=te;try{return ee()}finally{p=ne}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(ee,te){switch(ee){case 1:case 2:case 3:case 4:case 5:break;default:ee=3}var ne=p;p=ee;try{return te()}finally{p=ne}},t.unstable_scheduleCallback=function(ee,te,ne){var me=t.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?me+ne:me):ne=me,ee){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=ne+Ne,ee={id:f++,callback:te,priorityLevel:ee,startTime:ne,expirationTime:Ne,sortIndex:-1},ne>me?(ee.sortIndex=ne,e(d,ee),n(c)===null&&ee===n(d)&&(C?(_(v),v=-1):C=!0,we(I,ne-me))):(ee.sortIndex=Ne,e(c,ee),T||x||(T=!0,ve(L))),ee},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(ee){var te=p;return function(){var ne=p;p=te;try{return ee.apply(this,arguments)}finally{p=ne}}}})(mE);pE.exports=mE;var pj=pE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mj=w,lr=pj;function ae(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gE=new Set,Ec={};function Oo(t,e){Va(t,e),Va(t+"Capture",e)}function Va(t,e){for(Ec[t]=e,t=0;t<e.length;t++)gE.add(e[t])}var Ss=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pm=Object.prototype.hasOwnProperty,gj=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,rx={},sx={};function yj(t){return pm.call(sx,t)?!0:pm.call(rx,t)?!1:gj.test(t)?sx[t]=!0:(rx[t]=!0,!1)}function vj(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function _j(t,e,n,r){if(e===null||typeof e>"u"||vj(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function $n(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var gn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){gn[t]=new $n(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];gn[e]=new $n(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){gn[t]=new $n(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){gn[t]=new $n(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){gn[t]=new $n(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){gn[t]=new $n(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){gn[t]=new $n(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){gn[t]=new $n(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){gn[t]=new $n(t,5,!1,t.toLowerCase(),null,!1,!1)});var Qg=/[\-:]([a-z])/g;function Yg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Qg,Yg);gn[e]=new $n(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Qg,Yg);gn[e]=new $n(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Qg,Yg);gn[e]=new $n(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){gn[t]=new $n(t,1,!1,t.toLowerCase(),null,!1,!1)});gn.xlinkHref=new $n("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){gn[t]=new $n(t,1,!1,t.toLowerCase(),null,!0,!0)});function Xg(t,e,n,r){var s=gn.hasOwnProperty(e)?gn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(_j(e,n,s,r)&&(n=null),r||s===null?yj(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Ls=mj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Du=Symbol.for("react.element"),da=Symbol.for("react.portal"),ha=Symbol.for("react.fragment"),Jg=Symbol.for("react.strict_mode"),mm=Symbol.for("react.profiler"),yE=Symbol.for("react.provider"),vE=Symbol.for("react.context"),Zg=Symbol.for("react.forward_ref"),gm=Symbol.for("react.suspense"),ym=Symbol.for("react.suspense_list"),ey=Symbol.for("react.memo"),Qs=Symbol.for("react.lazy"),_E=Symbol.for("react.offscreen"),ix=Symbol.iterator;function Tl(t){return t===null||typeof t!="object"?null:(t=ix&&t[ix]||t["@@iterator"],typeof t=="function"?t:null)}var Ot=Object.assign,ap;function Hl(t){if(ap===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);ap=e&&e[1]||""}return`
`+ap+t}var lp=!1;function cp(t,e){if(!t||lp)return"";lp=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var c=`
`+s[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=l);break}}}finally{lp=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Hl(t):""}function xj(t){switch(t.tag){case 5:return Hl(t.type);case 16:return Hl("Lazy");case 13:return Hl("Suspense");case 19:return Hl("SuspenseList");case 0:case 2:case 15:return t=cp(t.type,!1),t;case 11:return t=cp(t.type.render,!1),t;case 1:return t=cp(t.type,!0),t;default:return""}}function vm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ha:return"Fragment";case da:return"Portal";case mm:return"Profiler";case Jg:return"StrictMode";case gm:return"Suspense";case ym:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case vE:return(t.displayName||"Context")+".Consumer";case yE:return(t._context.displayName||"Context")+".Provider";case Zg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case ey:return e=t.displayName||null,e!==null?e:vm(t.type)||"Memo";case Qs:e=t._payload,t=t._init;try{return vm(t(e))}catch{}}return null}function bj(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return vm(e);case 8:return e===Jg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ei(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function xE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function wj(t){var e=xE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Lu(t){t._valueTracker||(t._valueTracker=wj(t))}function bE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=xE(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Bd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function _m(t,e){var n=e.checked;return Ot({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ox(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ei(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function wE(t,e){e=e.checked,e!=null&&Xg(t,"checked",e,!1)}function xm(t,e){wE(t,e);var n=Ei(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?bm(t,e.type,n):e.hasOwnProperty("defaultValue")&&bm(t,e.type,Ei(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ax(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function bm(t,e,n){(e!=="number"||Bd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Wl=Array.isArray;function Ia(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ei(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function wm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ae(91));return Ot({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function lx(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ae(92));if(Wl(n)){if(1<n.length)throw Error(ae(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ei(n)}}function EE(t,e){var n=Ei(e.value),r=Ei(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function cx(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function IE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Em(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?IE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ou,SE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ou=Ou||document.createElement("div"),Ou.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ou.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ic(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var sc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ej=["Webkit","ms","Moz","O"];Object.keys(sc).forEach(function(t){Ej.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),sc[e]=sc[t]})});function CE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||sc.hasOwnProperty(t)&&sc[t]?(""+e).trim():e+"px"}function TE(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=CE(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var Ij=Ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Im(t,e){if(e){if(Ij[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ae(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ae(62))}}function Sm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cm=null;function ty(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Tm=null,Sa=null,Ca=null;function ux(t){if(t=su(t)){if(typeof Tm!="function")throw Error(ae(280));var e=t.stateNode;e&&(e=Qh(e),Tm(t.stateNode,t.type,e))}}function NE(t){Sa?Ca?Ca.push(t):Ca=[t]:Sa=t}function jE(){if(Sa){var t=Sa,e=Ca;if(Ca=Sa=null,ux(t),e)for(t=0;t<e.length;t++)ux(e[t])}}function AE(t,e){return t(e)}function PE(){}var up=!1;function RE(t,e,n){if(up)return t(e,n);up=!0;try{return AE(t,e,n)}finally{up=!1,(Sa!==null||Ca!==null)&&(PE(),jE())}}function Sc(t,e){var n=t.stateNode;if(n===null)return null;var r=Qh(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ae(231,e,typeof n));return n}var Nm=!1;if(Ss)try{var Nl={};Object.defineProperty(Nl,"passive",{get:function(){Nm=!0}}),window.addEventListener("test",Nl,Nl),window.removeEventListener("test",Nl,Nl)}catch{Nm=!1}function Sj(t,e,n,r,s,i,a,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(f){this.onError(f)}}var ic=!1,zd=null,qd=!1,jm=null,Cj={onError:function(t){ic=!0,zd=t}};function Tj(t,e,n,r,s,i,a,l,c){ic=!1,zd=null,Sj.apply(Cj,arguments)}function Nj(t,e,n,r,s,i,a,l,c){if(Tj.apply(this,arguments),ic){if(ic){var d=zd;ic=!1,zd=null}else throw Error(ae(198));qd||(qd=!0,jm=d)}}function Vo(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function kE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function dx(t){if(Vo(t)!==t)throw Error(ae(188))}function jj(t){var e=t.alternate;if(!e){if(e=Vo(t),e===null)throw Error(ae(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return dx(s),t;if(i===r)return dx(s),e;i=i.sibling}throw Error(ae(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a)throw Error(ae(189))}}if(n.alternate!==r)throw Error(ae(190))}if(n.tag!==3)throw Error(ae(188));return n.stateNode.current===n?t:e}function DE(t){return t=jj(t),t!==null?LE(t):null}function LE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=LE(t);if(e!==null)return e;t=t.sibling}return null}var OE=lr.unstable_scheduleCallback,hx=lr.unstable_cancelCallback,Aj=lr.unstable_shouldYield,Pj=lr.unstable_requestPaint,Gt=lr.unstable_now,Rj=lr.unstable_getCurrentPriorityLevel,ny=lr.unstable_ImmediatePriority,VE=lr.unstable_UserBlockingPriority,Hd=lr.unstable_NormalPriority,kj=lr.unstable_LowPriority,ME=lr.unstable_IdlePriority,Hh=null,ns=null;function Dj(t){if(ns&&typeof ns.onCommitFiberRoot=="function")try{ns.onCommitFiberRoot(Hh,t,void 0,(t.current.flags&128)===128)}catch{}}var Lr=Math.clz32?Math.clz32:Vj,Lj=Math.log,Oj=Math.LN2;function Vj(t){return t>>>=0,t===0?32:31-(Lj(t)/Oj|0)|0}var Vu=64,Mu=4194304;function Gl(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Wd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~s;l!==0?r=Gl(l):(i&=a,i!==0&&(r=Gl(i)))}else a=n&~s,a!==0?r=Gl(a):i!==0&&(r=Gl(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Lr(e),s=1<<n,r|=t[n],e&=~s;return r}function Mj(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fj(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-Lr(i),l=1<<a,c=s[a];c===-1?(!(l&n)||l&r)&&(s[a]=Mj(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Am(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function FE(){var t=Vu;return Vu<<=1,!(Vu&4194240)&&(Vu=64),t}function dp(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function nu(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Lr(e),t[e]=n}function Uj(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Lr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function ry(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Lr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var pt=0;function UE(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var $E,sy,BE,zE,qE,Pm=!1,Fu=[],ci=null,ui=null,di=null,Cc=new Map,Tc=new Map,Xs=[],$j="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function fx(t,e){switch(t){case"focusin":case"focusout":ci=null;break;case"dragenter":case"dragleave":ui=null;break;case"mouseover":case"mouseout":di=null;break;case"pointerover":case"pointerout":Cc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tc.delete(e.pointerId)}}function jl(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=su(e),e!==null&&sy(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Bj(t,e,n,r,s){switch(e){case"focusin":return ci=jl(ci,t,e,n,r,s),!0;case"dragenter":return ui=jl(ui,t,e,n,r,s),!0;case"mouseover":return di=jl(di,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Cc.set(i,jl(Cc.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Tc.set(i,jl(Tc.get(i)||null,t,e,n,r,s)),!0}return!1}function HE(t){var e=to(t.target);if(e!==null){var n=Vo(e);if(n!==null){if(e=n.tag,e===13){if(e=kE(n),e!==null){t.blockedOn=e,qE(t.priority,function(){BE(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function hd(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Rm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Cm=r,n.target.dispatchEvent(r),Cm=null}else return e=su(n),e!==null&&sy(e),t.blockedOn=n,!1;e.shift()}return!0}function px(t,e,n){hd(t)&&n.delete(e)}function zj(){Pm=!1,ci!==null&&hd(ci)&&(ci=null),ui!==null&&hd(ui)&&(ui=null),di!==null&&hd(di)&&(di=null),Cc.forEach(px),Tc.forEach(px)}function Al(t,e){t.blockedOn===e&&(t.blockedOn=null,Pm||(Pm=!0,lr.unstable_scheduleCallback(lr.unstable_NormalPriority,zj)))}function Nc(t){function e(s){return Al(s,t)}if(0<Fu.length){Al(Fu[0],t);for(var n=1;n<Fu.length;n++){var r=Fu[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ci!==null&&Al(ci,t),ui!==null&&Al(ui,t),di!==null&&Al(di,t),Cc.forEach(e),Tc.forEach(e),n=0;n<Xs.length;n++)r=Xs[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Xs.length&&(n=Xs[0],n.blockedOn===null);)HE(n),n.blockedOn===null&&Xs.shift()}var Ta=Ls.ReactCurrentBatchConfig,Gd=!0;function qj(t,e,n,r){var s=pt,i=Ta.transition;Ta.transition=null;try{pt=1,iy(t,e,n,r)}finally{pt=s,Ta.transition=i}}function Hj(t,e,n,r){var s=pt,i=Ta.transition;Ta.transition=null;try{pt=4,iy(t,e,n,r)}finally{pt=s,Ta.transition=i}}function iy(t,e,n,r){if(Gd){var s=Rm(t,e,n,r);if(s===null)bp(t,e,r,Kd,n),fx(t,r);else if(Bj(s,t,e,n,r))r.stopPropagation();else if(fx(t,r),e&4&&-1<$j.indexOf(t)){for(;s!==null;){var i=su(s);if(i!==null&&$E(i),i=Rm(t,e,n,r),i===null&&bp(t,e,r,Kd,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else bp(t,e,r,null,n)}}var Kd=null;function Rm(t,e,n,r){if(Kd=null,t=ty(r),t=to(t),t!==null)if(e=Vo(t),e===null)t=null;else if(n=e.tag,n===13){if(t=kE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Kd=t,null}function WE(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Rj()){case ny:return 1;case VE:return 4;case Hd:case kj:return 16;case ME:return 536870912;default:return 16}default:return 16}}var oi=null,oy=null,fd=null;function GE(){if(fd)return fd;var t,e=oy,n=e.length,r,s="value"in oi?oi.value:oi.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return fd=s.slice(t,1<r?1-r:void 0)}function pd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Uu(){return!0}function mx(){return!1}function dr(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Uu:mx,this.isPropagationStopped=mx,this}return Ot(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Uu)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Uu)},persist:function(){},isPersistent:Uu}),e}var il={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ay=dr(il),ru=Ot({},il,{view:0,detail:0}),Wj=dr(ru),hp,fp,Pl,Wh=Ot({},ru,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ly,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Pl&&(Pl&&t.type==="mousemove"?(hp=t.screenX-Pl.screenX,fp=t.screenY-Pl.screenY):fp=hp=0,Pl=t),hp)},movementY:function(t){return"movementY"in t?t.movementY:fp}}),gx=dr(Wh),Gj=Ot({},Wh,{dataTransfer:0}),Kj=dr(Gj),Qj=Ot({},ru,{relatedTarget:0}),pp=dr(Qj),Yj=Ot({},il,{animationName:0,elapsedTime:0,pseudoElement:0}),Xj=dr(Yj),Jj=Ot({},il,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Zj=dr(Jj),eA=Ot({},il,{data:0}),yx=dr(eA),tA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sA(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=rA[t])?!!e[t]:!1}function ly(){return sA}var iA=Ot({},ru,{key:function(t){if(t.key){var e=tA[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=pd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?nA[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ly,charCode:function(t){return t.type==="keypress"?pd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?pd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),oA=dr(iA),aA=Ot({},Wh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),vx=dr(aA),lA=Ot({},ru,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ly}),cA=dr(lA),uA=Ot({},il,{propertyName:0,elapsedTime:0,pseudoElement:0}),dA=dr(uA),hA=Ot({},Wh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),fA=dr(hA),pA=[9,13,27,32],cy=Ss&&"CompositionEvent"in window,oc=null;Ss&&"documentMode"in document&&(oc=document.documentMode);var mA=Ss&&"TextEvent"in window&&!oc,KE=Ss&&(!cy||oc&&8<oc&&11>=oc),_x=" ",xx=!1;function QE(t,e){switch(t){case"keyup":return pA.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function YE(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var fa=!1;function gA(t,e){switch(t){case"compositionend":return YE(e);case"keypress":return e.which!==32?null:(xx=!0,_x);case"textInput":return t=e.data,t===_x&&xx?null:t;default:return null}}function yA(t,e){if(fa)return t==="compositionend"||!cy&&QE(t,e)?(t=GE(),fd=oy=oi=null,fa=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return KE&&e.locale!=="ko"?null:e.data;default:return null}}var vA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!vA[t.type]:e==="textarea"}function XE(t,e,n,r){NE(r),e=Qd(e,"onChange"),0<e.length&&(n=new ay("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var ac=null,jc=null;function _A(t){lI(t,0)}function Gh(t){var e=ga(t);if(bE(e))return t}function xA(t,e){if(t==="change")return e}var JE=!1;if(Ss){var mp;if(Ss){var gp="oninput"in document;if(!gp){var wx=document.createElement("div");wx.setAttribute("oninput","return;"),gp=typeof wx.oninput=="function"}mp=gp}else mp=!1;JE=mp&&(!document.documentMode||9<document.documentMode)}function Ex(){ac&&(ac.detachEvent("onpropertychange",ZE),jc=ac=null)}function ZE(t){if(t.propertyName==="value"&&Gh(jc)){var e=[];XE(e,jc,t,ty(t)),RE(_A,e)}}function bA(t,e,n){t==="focusin"?(Ex(),ac=e,jc=n,ac.attachEvent("onpropertychange",ZE)):t==="focusout"&&Ex()}function wA(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Gh(jc)}function EA(t,e){if(t==="click")return Gh(e)}function IA(t,e){if(t==="input"||t==="change")return Gh(e)}function SA(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Mr=typeof Object.is=="function"?Object.is:SA;function Ac(t,e){if(Mr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!pm.call(e,s)||!Mr(t[s],e[s]))return!1}return!0}function Ix(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Sx(t,e){var n=Ix(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ix(n)}}function eI(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?eI(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function tI(){for(var t=window,e=Bd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Bd(t.document)}return e}function uy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function CA(t){var e=tI(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&eI(n.ownerDocument.documentElement,n)){if(r!==null&&uy(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Sx(n,i);var a=Sx(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var TA=Ss&&"documentMode"in document&&11>=document.documentMode,pa=null,km=null,lc=null,Dm=!1;function Cx(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Dm||pa==null||pa!==Bd(r)||(r=pa,"selectionStart"in r&&uy(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),lc&&Ac(lc,r)||(lc=r,r=Qd(km,"onSelect"),0<r.length&&(e=new ay("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=pa)))}function $u(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ma={animationend:$u("Animation","AnimationEnd"),animationiteration:$u("Animation","AnimationIteration"),animationstart:$u("Animation","AnimationStart"),transitionend:$u("Transition","TransitionEnd")},yp={},nI={};Ss&&(nI=document.createElement("div").style,"AnimationEvent"in window||(delete ma.animationend.animation,delete ma.animationiteration.animation,delete ma.animationstart.animation),"TransitionEvent"in window||delete ma.transitionend.transition);function Kh(t){if(yp[t])return yp[t];if(!ma[t])return t;var e=ma[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in nI)return yp[t]=e[n];return t}var rI=Kh("animationend"),sI=Kh("animationiteration"),iI=Kh("animationstart"),oI=Kh("transitionend"),aI=new Map,Tx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ai(t,e){aI.set(t,e),Oo(e,[t])}for(var vp=0;vp<Tx.length;vp++){var _p=Tx[vp],NA=_p.toLowerCase(),jA=_p[0].toUpperCase()+_p.slice(1);Ai(NA,"on"+jA)}Ai(rI,"onAnimationEnd");Ai(sI,"onAnimationIteration");Ai(iI,"onAnimationStart");Ai("dblclick","onDoubleClick");Ai("focusin","onFocus");Ai("focusout","onBlur");Ai(oI,"onTransitionEnd");Va("onMouseEnter",["mouseout","mouseover"]);Va("onMouseLeave",["mouseout","mouseover"]);Va("onPointerEnter",["pointerout","pointerover"]);Va("onPointerLeave",["pointerout","pointerover"]);Oo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Oo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Oo("onBeforeInput",["compositionend","keypress","textInput","paste"]);Oo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Oo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Oo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AA=new Set("cancel close invalid load scroll toggle".split(" ").concat(Kl));function Nx(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Nj(r,e,void 0,t),t.currentTarget=null}function lI(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;Nx(s,l,d),i=c}else for(a=0;a<r.length;a++){if(l=r[a],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;Nx(s,l,d),i=c}}}if(qd)throw t=jm,qd=!1,jm=null,t}function It(t,e){var n=e[Fm];n===void 0&&(n=e[Fm]=new Set);var r=t+"__bubble";n.has(r)||(cI(e,t,2,!1),n.add(r))}function xp(t,e,n){var r=0;e&&(r|=4),cI(n,t,r,e)}var Bu="_reactListening"+Math.random().toString(36).slice(2);function Pc(t){if(!t[Bu]){t[Bu]=!0,gE.forEach(function(n){n!=="selectionchange"&&(AA.has(n)||xp(n,!1,t),xp(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Bu]||(e[Bu]=!0,xp("selectionchange",!1,e))}}function cI(t,e,n,r){switch(WE(e)){case 1:var s=qj;break;case 4:s=Hj;break;default:s=iy}n=s.bind(null,e,n,t),s=void 0,!Nm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function bp(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;a=a.return}for(;l!==null;){if(a=to(l),a===null)return;if(c=a.tag,c===5||c===6){r=i=a;continue e}l=l.parentNode}}r=r.return}RE(function(){var d=i,f=ty(n),h=[];e:{var p=aI.get(t);if(p!==void 0){var x=ay,T=t;switch(t){case"keypress":if(pd(n)===0)break e;case"keydown":case"keyup":x=oA;break;case"focusin":T="focus",x=pp;break;case"focusout":T="blur",x=pp;break;case"beforeblur":case"afterblur":x=pp;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=gx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=Kj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=cA;break;case rI:case sI:case iI:x=Xj;break;case oI:x=dA;break;case"scroll":x=Wj;break;case"wheel":x=fA;break;case"copy":case"cut":case"paste":x=Zj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=vx}var C=(e&4)!==0,N=!C&&t==="scroll",_=C?p!==null?p+"Capture":null:p;C=[];for(var E=d,S;E!==null;){S=E;var I=S.stateNode;if(S.tag===5&&I!==null&&(S=I,_!==null&&(I=Sc(E,_),I!=null&&C.push(Rc(E,I,S)))),N)break;E=E.return}0<C.length&&(p=new x(p,T,null,n,f),h.push({event:p,listeners:C}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",p&&n!==Cm&&(T=n.relatedTarget||n.fromElement)&&(to(T)||T[Cs]))break e;if((x||p)&&(p=f.window===f?f:(p=f.ownerDocument)?p.defaultView||p.parentWindow:window,x?(T=n.relatedTarget||n.toElement,x=d,T=T?to(T):null,T!==null&&(N=Vo(T),T!==N||T.tag!==5&&T.tag!==6)&&(T=null)):(x=null,T=d),x!==T)){if(C=gx,I="onMouseLeave",_="onMouseEnter",E="mouse",(t==="pointerout"||t==="pointerover")&&(C=vx,I="onPointerLeave",_="onPointerEnter",E="pointer"),N=x==null?p:ga(x),S=T==null?p:ga(T),p=new C(I,E+"leave",x,n,f),p.target=N,p.relatedTarget=S,I=null,to(f)===d&&(C=new C(_,E+"enter",T,n,f),C.target=S,C.relatedTarget=N,I=C),N=I,x&&T)t:{for(C=x,_=T,E=0,S=C;S;S=Wo(S))E++;for(S=0,I=_;I;I=Wo(I))S++;for(;0<E-S;)C=Wo(C),E--;for(;0<S-E;)_=Wo(_),S--;for(;E--;){if(C===_||_!==null&&C===_.alternate)break t;C=Wo(C),_=Wo(_)}C=null}else C=null;x!==null&&jx(h,p,x,C,!1),T!==null&&N!==null&&jx(h,N,T,C,!0)}}e:{if(p=d?ga(d):window,x=p.nodeName&&p.nodeName.toLowerCase(),x==="select"||x==="input"&&p.type==="file")var L=xA;else if(bx(p))if(JE)L=IA;else{L=wA;var V=bA}else(x=p.nodeName)&&x.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(L=EA);if(L&&(L=L(t,d))){XE(h,L,n,f);break e}V&&V(t,p,d),t==="focusout"&&(V=p._wrapperState)&&V.controlled&&p.type==="number"&&bm(p,"number",p.value)}switch(V=d?ga(d):window,t){case"focusin":(bx(V)||V.contentEditable==="true")&&(pa=V,km=d,lc=null);break;case"focusout":lc=km=pa=null;break;case"mousedown":Dm=!0;break;case"contextmenu":case"mouseup":case"dragend":Dm=!1,Cx(h,n,f);break;case"selectionchange":if(TA)break;case"keydown":case"keyup":Cx(h,n,f)}var g;if(cy)e:{switch(t){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else fa?QE(t,n)&&(v="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(v="onCompositionStart");v&&(KE&&n.locale!=="ko"&&(fa||v!=="onCompositionStart"?v==="onCompositionEnd"&&fa&&(g=GE()):(oi=f,oy="value"in oi?oi.value:oi.textContent,fa=!0)),V=Qd(d,v),0<V.length&&(v=new yx(v,t,null,n,f),h.push({event:v,listeners:V}),g?v.data=g:(g=YE(n),g!==null&&(v.data=g)))),(g=mA?gA(t,n):yA(t,n))&&(d=Qd(d,"onBeforeInput"),0<d.length&&(f=new yx("onBeforeInput","beforeinput",null,n,f),h.push({event:f,listeners:d}),f.data=g))}lI(h,e)})}function Rc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Qd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Sc(t,n),i!=null&&r.unshift(Rc(t,i,s)),i=Sc(t,e),i!=null&&r.push(Rc(t,i,s))),t=t.return}return r}function Wo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function jx(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=Sc(n,i),c!=null&&a.unshift(Rc(n,c,l))):s||(c=Sc(n,i),c!=null&&a.push(Rc(n,c,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var PA=/\r\n?/g,RA=/\u0000|\uFFFD/g;function Ax(t){return(typeof t=="string"?t:""+t).replace(PA,`
`).replace(RA,"")}function zu(t,e,n){if(e=Ax(e),Ax(t)!==e&&n)throw Error(ae(425))}function Yd(){}var Lm=null,Om=null;function Vm(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Mm=typeof setTimeout=="function"?setTimeout:void 0,kA=typeof clearTimeout=="function"?clearTimeout:void 0,Px=typeof Promise=="function"?Promise:void 0,DA=typeof queueMicrotask=="function"?queueMicrotask:typeof Px<"u"?function(t){return Px.resolve(null).then(t).catch(LA)}:Mm;function LA(t){setTimeout(function(){throw t})}function wp(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Nc(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Nc(e)}function hi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Rx(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ol=Math.random().toString(36).slice(2),Jr="__reactFiber$"+ol,kc="__reactProps$"+ol,Cs="__reactContainer$"+ol,Fm="__reactEvents$"+ol,OA="__reactListeners$"+ol,VA="__reactHandles$"+ol;function to(t){var e=t[Jr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Cs]||n[Jr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Rx(t);t!==null;){if(n=t[Jr])return n;t=Rx(t)}return e}t=n,n=t.parentNode}return null}function su(t){return t=t[Jr]||t[Cs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ga(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ae(33))}function Qh(t){return t[kc]||null}var Um=[],ya=-1;function Pi(t){return{current:t}}function St(t){0>ya||(t.current=Um[ya],Um[ya]=null,ya--)}function xt(t,e){ya++,Um[ya]=t.current,t.current=e}var Ii={},Pn=Pi(Ii),Kn=Pi(!1),mo=Ii;function Ma(t,e){var n=t.type.contextTypes;if(!n)return Ii;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Qn(t){return t=t.childContextTypes,t!=null}function Xd(){St(Kn),St(Pn)}function kx(t,e,n){if(Pn.current!==Ii)throw Error(ae(168));xt(Pn,e),xt(Kn,n)}function uI(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(ae(108,bj(t)||"Unknown",s));return Ot({},n,r)}function Jd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ii,mo=Pn.current,xt(Pn,t),xt(Kn,Kn.current),!0}function Dx(t,e,n){var r=t.stateNode;if(!r)throw Error(ae(169));n?(t=uI(t,e,mo),r.__reactInternalMemoizedMergedChildContext=t,St(Kn),St(Pn),xt(Pn,t)):St(Kn),xt(Kn,n)}var gs=null,Yh=!1,Ep=!1;function dI(t){gs===null?gs=[t]:gs.push(t)}function MA(t){Yh=!0,dI(t)}function Ri(){if(!Ep&&gs!==null){Ep=!0;var t=0,e=pt;try{var n=gs;for(pt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}gs=null,Yh=!1}catch(s){throw gs!==null&&(gs=gs.slice(t+1)),OE(ny,Ri),s}finally{pt=e,Ep=!1}}return null}var va=[],_a=0,Zd=null,eh=0,hr=[],fr=0,go=null,ys=1,vs="";function Hi(t,e){va[_a++]=eh,va[_a++]=Zd,Zd=t,eh=e}function hI(t,e,n){hr[fr++]=ys,hr[fr++]=vs,hr[fr++]=go,go=t;var r=ys;t=vs;var s=32-Lr(r)-1;r&=~(1<<s),n+=1;var i=32-Lr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,ys=1<<32-Lr(e)+s|n<<s|r,vs=i+t}else ys=1<<i|n<<s|r,vs=t}function dy(t){t.return!==null&&(Hi(t,1),hI(t,1,0))}function hy(t){for(;t===Zd;)Zd=va[--_a],va[_a]=null,eh=va[--_a],va[_a]=null;for(;t===go;)go=hr[--fr],hr[fr]=null,vs=hr[--fr],hr[fr]=null,ys=hr[--fr],hr[fr]=null}var or=null,sr=null,Nt=!1,kr=null;function fI(t,e){var n=gr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Lx(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,or=t,sr=hi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,or=t,sr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=go!==null?{id:ys,overflow:vs}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=gr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,or=t,sr=null,!0):!1;default:return!1}}function $m(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Bm(t){if(Nt){var e=sr;if(e){var n=e;if(!Lx(t,e)){if($m(t))throw Error(ae(418));e=hi(n.nextSibling);var r=or;e&&Lx(t,e)?fI(r,n):(t.flags=t.flags&-4097|2,Nt=!1,or=t)}}else{if($m(t))throw Error(ae(418));t.flags=t.flags&-4097|2,Nt=!1,or=t}}}function Ox(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;or=t}function qu(t){if(t!==or)return!1;if(!Nt)return Ox(t),Nt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Vm(t.type,t.memoizedProps)),e&&(e=sr)){if($m(t))throw pI(),Error(ae(418));for(;e;)fI(t,e),e=hi(e.nextSibling)}if(Ox(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ae(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){sr=hi(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}sr=null}}else sr=or?hi(t.stateNode.nextSibling):null;return!0}function pI(){for(var t=sr;t;)t=hi(t.nextSibling)}function Fa(){sr=or=null,Nt=!1}function fy(t){kr===null?kr=[t]:kr.push(t)}var FA=Ls.ReactCurrentBatchConfig;function Rl(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ae(309));var r=n.stateNode}if(!r)throw Error(ae(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(ae(284));if(!n._owner)throw Error(ae(290,t))}return t}function Hu(t,e){throw t=Object.prototype.toString.call(e),Error(ae(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Vx(t){var e=t._init;return e(t._payload)}function mI(t){function e(_,E){if(t){var S=_.deletions;S===null?(_.deletions=[E],_.flags|=16):S.push(E)}}function n(_,E){if(!t)return null;for(;E!==null;)e(_,E),E=E.sibling;return null}function r(_,E){for(_=new Map;E!==null;)E.key!==null?_.set(E.key,E):_.set(E.index,E),E=E.sibling;return _}function s(_,E){return _=gi(_,E),_.index=0,_.sibling=null,_}function i(_,E,S){return _.index=S,t?(S=_.alternate,S!==null?(S=S.index,S<E?(_.flags|=2,E):S):(_.flags|=2,E)):(_.flags|=1048576,E)}function a(_){return t&&_.alternate===null&&(_.flags|=2),_}function l(_,E,S,I){return E===null||E.tag!==6?(E=Ap(S,_.mode,I),E.return=_,E):(E=s(E,S),E.return=_,E)}function c(_,E,S,I){var L=S.type;return L===ha?f(_,E,S.props.children,I,S.key):E!==null&&(E.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===Qs&&Vx(L)===E.type)?(I=s(E,S.props),I.ref=Rl(_,E,S),I.return=_,I):(I=bd(S.type,S.key,S.props,null,_.mode,I),I.ref=Rl(_,E,S),I.return=_,I)}function d(_,E,S,I){return E===null||E.tag!==4||E.stateNode.containerInfo!==S.containerInfo||E.stateNode.implementation!==S.implementation?(E=Pp(S,_.mode,I),E.return=_,E):(E=s(E,S.children||[]),E.return=_,E)}function f(_,E,S,I,L){return E===null||E.tag!==7?(E=ao(S,_.mode,I,L),E.return=_,E):(E=s(E,S),E.return=_,E)}function h(_,E,S){if(typeof E=="string"&&E!==""||typeof E=="number")return E=Ap(""+E,_.mode,S),E.return=_,E;if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Du:return S=bd(E.type,E.key,E.props,null,_.mode,S),S.ref=Rl(_,null,E),S.return=_,S;case da:return E=Pp(E,_.mode,S),E.return=_,E;case Qs:var I=E._init;return h(_,I(E._payload),S)}if(Wl(E)||Tl(E))return E=ao(E,_.mode,S,null),E.return=_,E;Hu(_,E)}return null}function p(_,E,S,I){var L=E!==null?E.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return L!==null?null:l(_,E,""+S,I);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Du:return S.key===L?c(_,E,S,I):null;case da:return S.key===L?d(_,E,S,I):null;case Qs:return L=S._init,p(_,E,L(S._payload),I)}if(Wl(S)||Tl(S))return L!==null?null:f(_,E,S,I,null);Hu(_,S)}return null}function x(_,E,S,I,L){if(typeof I=="string"&&I!==""||typeof I=="number")return _=_.get(S)||null,l(E,_,""+I,L);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Du:return _=_.get(I.key===null?S:I.key)||null,c(E,_,I,L);case da:return _=_.get(I.key===null?S:I.key)||null,d(E,_,I,L);case Qs:var V=I._init;return x(_,E,S,V(I._payload),L)}if(Wl(I)||Tl(I))return _=_.get(S)||null,f(E,_,I,L,null);Hu(E,I)}return null}function T(_,E,S,I){for(var L=null,V=null,g=E,v=E=0,b=null;g!==null&&v<S.length;v++){g.index>v?(b=g,g=null):b=g.sibling;var P=p(_,g,S[v],I);if(P===null){g===null&&(g=b);break}t&&g&&P.alternate===null&&e(_,g),E=i(P,E,v),V===null?L=P:V.sibling=P,V=P,g=b}if(v===S.length)return n(_,g),Nt&&Hi(_,v),L;if(g===null){for(;v<S.length;v++)g=h(_,S[v],I),g!==null&&(E=i(g,E,v),V===null?L=g:V.sibling=g,V=g);return Nt&&Hi(_,v),L}for(g=r(_,g);v<S.length;v++)b=x(g,_,v,S[v],I),b!==null&&(t&&b.alternate!==null&&g.delete(b.key===null?v:b.key),E=i(b,E,v),V===null?L=b:V.sibling=b,V=b);return t&&g.forEach(function(R){return e(_,R)}),Nt&&Hi(_,v),L}function C(_,E,S,I){var L=Tl(S);if(typeof L!="function")throw Error(ae(150));if(S=L.call(S),S==null)throw Error(ae(151));for(var V=L=null,g=E,v=E=0,b=null,P=S.next();g!==null&&!P.done;v++,P=S.next()){g.index>v?(b=g,g=null):b=g.sibling;var R=p(_,g,P.value,I);if(R===null){g===null&&(g=b);break}t&&g&&R.alternate===null&&e(_,g),E=i(R,E,v),V===null?L=R:V.sibling=R,V=R,g=b}if(P.done)return n(_,g),Nt&&Hi(_,v),L;if(g===null){for(;!P.done;v++,P=S.next())P=h(_,P.value,I),P!==null&&(E=i(P,E,v),V===null?L=P:V.sibling=P,V=P);return Nt&&Hi(_,v),L}for(g=r(_,g);!P.done;v++,P=S.next())P=x(g,_,v,P.value,I),P!==null&&(t&&P.alternate!==null&&g.delete(P.key===null?v:P.key),E=i(P,E,v),V===null?L=P:V.sibling=P,V=P);return t&&g.forEach(function(O){return e(_,O)}),Nt&&Hi(_,v),L}function N(_,E,S,I){if(typeof S=="object"&&S!==null&&S.type===ha&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Du:e:{for(var L=S.key,V=E;V!==null;){if(V.key===L){if(L=S.type,L===ha){if(V.tag===7){n(_,V.sibling),E=s(V,S.props.children),E.return=_,_=E;break e}}else if(V.elementType===L||typeof L=="object"&&L!==null&&L.$$typeof===Qs&&Vx(L)===V.type){n(_,V.sibling),E=s(V,S.props),E.ref=Rl(_,V,S),E.return=_,_=E;break e}n(_,V);break}else e(_,V);V=V.sibling}S.type===ha?(E=ao(S.props.children,_.mode,I,S.key),E.return=_,_=E):(I=bd(S.type,S.key,S.props,null,_.mode,I),I.ref=Rl(_,E,S),I.return=_,_=I)}return a(_);case da:e:{for(V=S.key;E!==null;){if(E.key===V)if(E.tag===4&&E.stateNode.containerInfo===S.containerInfo&&E.stateNode.implementation===S.implementation){n(_,E.sibling),E=s(E,S.children||[]),E.return=_,_=E;break e}else{n(_,E);break}else e(_,E);E=E.sibling}E=Pp(S,_.mode,I),E.return=_,_=E}return a(_);case Qs:return V=S._init,N(_,E,V(S._payload),I)}if(Wl(S))return T(_,E,S,I);if(Tl(S))return C(_,E,S,I);Hu(_,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,E!==null&&E.tag===6?(n(_,E.sibling),E=s(E,S),E.return=_,_=E):(n(_,E),E=Ap(S,_.mode,I),E.return=_,_=E),a(_)):n(_,E)}return N}var Ua=mI(!0),gI=mI(!1),th=Pi(null),nh=null,xa=null,py=null;function my(){py=xa=nh=null}function gy(t){var e=th.current;St(th),t._currentValue=e}function zm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Na(t,e){nh=t,py=xa=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Wn=!0),t.firstContext=null)}function xr(t){var e=t._currentValue;if(py!==t)if(t={context:t,memoizedValue:e,next:null},xa===null){if(nh===null)throw Error(ae(308));xa=t,nh.dependencies={lanes:0,firstContext:t}}else xa=xa.next=t;return e}var no=null;function yy(t){no===null?no=[t]:no.push(t)}function yI(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,yy(e)):(n.next=s.next,s.next=n),e.interleaved=n,Ts(t,r)}function Ts(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ys=!1;function vy(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ws(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function fi(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,at&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ts(t,n)}return s=r.interleaved,s===null?(e.next=e,yy(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ts(t,n)}function md(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,ry(t,n)}}function Mx(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function rh(t,e,n,r){var s=t.updateQueue;Ys=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var f=t.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==a&&(l===null?f.firstBaseUpdate=d:l.next=d,f.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;a=0,f=d=c=null,l=i;do{var p=l.lane,x=l.eventTime;if((r&p)===p){f!==null&&(f=f.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var T=t,C=l;switch(p=e,x=n,C.tag){case 1:if(T=C.payload,typeof T=="function"){h=T.call(x,h,p);break e}h=T;break e;case 3:T.flags=T.flags&-65537|128;case 0:if(T=C.payload,p=typeof T=="function"?T.call(x,h,p):T,p==null)break e;h=Ot({},h,p);break e;case 2:Ys=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,p=s.effects,p===null?s.effects=[l]:p.push(l))}else x={eventTime:x,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(d=f=x,c=h):f=f.next=x,a|=p;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;p=l,l=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(!0);if(f===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=f,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);vo|=a,t.lanes=a,t.memoizedState=h}}function Fx(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(ae(191,s));s.call(r)}}}var iu={},rs=Pi(iu),Dc=Pi(iu),Lc=Pi(iu);function ro(t){if(t===iu)throw Error(ae(174));return t}function _y(t,e){switch(xt(Lc,e),xt(Dc,t),xt(rs,iu),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Em(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Em(e,t)}St(rs),xt(rs,e)}function $a(){St(rs),St(Dc),St(Lc)}function _I(t){ro(Lc.current);var e=ro(rs.current),n=Em(e,t.type);e!==n&&(xt(Dc,t),xt(rs,n))}function xy(t){Dc.current===t&&(St(rs),St(Dc))}var Rt=Pi(0);function sh(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ip=[];function by(){for(var t=0;t<Ip.length;t++)Ip[t]._workInProgressVersionPrimary=null;Ip.length=0}var gd=Ls.ReactCurrentDispatcher,Sp=Ls.ReactCurrentBatchConfig,yo=0,Lt=null,Zt=null,ln=null,ih=!1,cc=!1,Oc=0,UA=0;function _n(){throw Error(ae(321))}function wy(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Mr(t[n],e[n]))return!1;return!0}function Ey(t,e,n,r,s,i){if(yo=i,Lt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,gd.current=t===null||t.memoizedState===null?qA:HA,t=n(r,s),cc){i=0;do{if(cc=!1,Oc=0,25<=i)throw Error(ae(301));i+=1,ln=Zt=null,e.updateQueue=null,gd.current=WA,t=n(r,s)}while(cc)}if(gd.current=oh,e=Zt!==null&&Zt.next!==null,yo=0,ln=Zt=Lt=null,ih=!1,e)throw Error(ae(300));return t}function Iy(){var t=Oc!==0;return Oc=0,t}function Yr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ln===null?Lt.memoizedState=ln=t:ln=ln.next=t,ln}function br(){if(Zt===null){var t=Lt.alternate;t=t!==null?t.memoizedState:null}else t=Zt.next;var e=ln===null?Lt.memoizedState:ln.next;if(e!==null)ln=e,Zt=t;else{if(t===null)throw Error(ae(310));Zt=t,t={memoizedState:Zt.memoizedState,baseState:Zt.baseState,baseQueue:Zt.baseQueue,queue:Zt.queue,next:null},ln===null?Lt.memoizedState=ln=t:ln=ln.next=t}return ln}function Vc(t,e){return typeof e=="function"?e(t):e}function Cp(t){var e=br(),n=e.queue;if(n===null)throw Error(ae(311));n.lastRenderedReducer=t;var r=Zt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,c=null,d=i;do{var f=d.lane;if((yo&f)===f)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var h={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,a=r):c=c.next=h,Lt.lanes|=f,vo|=f}d=d.next}while(d!==null&&d!==i);c===null?a=r:c.next=l,Mr(r,e.memoizedState)||(Wn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Lt.lanes|=i,vo|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Tp(t){var e=br(),n=e.queue;if(n===null)throw Error(ae(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);Mr(i,e.memoizedState)||(Wn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function xI(){}function bI(t,e){var n=Lt,r=br(),s=e(),i=!Mr(r.memoizedState,s);if(i&&(r.memoizedState=s,Wn=!0),r=r.queue,Sy(II.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||ln!==null&&ln.memoizedState.tag&1){if(n.flags|=2048,Mc(9,EI.bind(null,n,r,s,e),void 0,null),un===null)throw Error(ae(349));yo&30||wI(n,e,s)}return s}function wI(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Lt.updateQueue,e===null?(e={lastEffect:null,stores:null},Lt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function EI(t,e,n,r){e.value=n,e.getSnapshot=r,SI(e)&&CI(t)}function II(t,e,n){return n(function(){SI(e)&&CI(t)})}function SI(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Mr(t,n)}catch{return!0}}function CI(t){var e=Ts(t,1);e!==null&&Or(e,t,1,-1)}function Ux(t){var e=Yr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vc,lastRenderedState:t},e.queue=t,t=t.dispatch=zA.bind(null,Lt,t),[e.memoizedState,t]}function Mc(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Lt.updateQueue,e===null?(e={lastEffect:null,stores:null},Lt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function TI(){return br().memoizedState}function yd(t,e,n,r){var s=Yr();Lt.flags|=t,s.memoizedState=Mc(1|e,n,void 0,r===void 0?null:r)}function Xh(t,e,n,r){var s=br();r=r===void 0?null:r;var i=void 0;if(Zt!==null){var a=Zt.memoizedState;if(i=a.destroy,r!==null&&wy(r,a.deps)){s.memoizedState=Mc(e,n,i,r);return}}Lt.flags|=t,s.memoizedState=Mc(1|e,n,i,r)}function $x(t,e){return yd(8390656,8,t,e)}function Sy(t,e){return Xh(2048,8,t,e)}function NI(t,e){return Xh(4,2,t,e)}function jI(t,e){return Xh(4,4,t,e)}function AI(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function PI(t,e,n){return n=n!=null?n.concat([t]):null,Xh(4,4,AI.bind(null,e,t),n)}function Cy(){}function RI(t,e){var n=br();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&wy(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function kI(t,e){var n=br();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&wy(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function DI(t,e,n){return yo&21?(Mr(n,e)||(n=FE(),Lt.lanes|=n,vo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Wn=!0),t.memoizedState=n)}function $A(t,e){var n=pt;pt=n!==0&&4>n?n:4,t(!0);var r=Sp.transition;Sp.transition={};try{t(!1),e()}finally{pt=n,Sp.transition=r}}function LI(){return br().memoizedState}function BA(t,e,n){var r=mi(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},OI(t))VI(e,n);else if(n=yI(t,e,n,r),n!==null){var s=Vn();Or(n,t,r,s),MI(n,e,r)}}function zA(t,e,n){var r=mi(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(OI(t))VI(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,n);if(s.hasEagerState=!0,s.eagerState=l,Mr(l,a)){var c=e.interleaved;c===null?(s.next=s,yy(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=yI(t,e,s,r),n!==null&&(s=Vn(),Or(n,t,r,s),MI(n,e,r))}}function OI(t){var e=t.alternate;return t===Lt||e!==null&&e===Lt}function VI(t,e){cc=ih=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function MI(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,ry(t,n)}}var oh={readContext:xr,useCallback:_n,useContext:_n,useEffect:_n,useImperativeHandle:_n,useInsertionEffect:_n,useLayoutEffect:_n,useMemo:_n,useReducer:_n,useRef:_n,useState:_n,useDebugValue:_n,useDeferredValue:_n,useTransition:_n,useMutableSource:_n,useSyncExternalStore:_n,useId:_n,unstable_isNewReconciler:!1},qA={readContext:xr,useCallback:function(t,e){return Yr().memoizedState=[t,e===void 0?null:e],t},useContext:xr,useEffect:$x,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,yd(4194308,4,AI.bind(null,e,t),n)},useLayoutEffect:function(t,e){return yd(4194308,4,t,e)},useInsertionEffect:function(t,e){return yd(4,2,t,e)},useMemo:function(t,e){var n=Yr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Yr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=BA.bind(null,Lt,t),[r.memoizedState,t]},useRef:function(t){var e=Yr();return t={current:t},e.memoizedState=t},useState:Ux,useDebugValue:Cy,useDeferredValue:function(t){return Yr().memoizedState=t},useTransition:function(){var t=Ux(!1),e=t[0];return t=$A.bind(null,t[1]),Yr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Lt,s=Yr();if(Nt){if(n===void 0)throw Error(ae(407));n=n()}else{if(n=e(),un===null)throw Error(ae(349));yo&30||wI(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,$x(II.bind(null,r,i,t),[t]),r.flags|=2048,Mc(9,EI.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Yr(),e=un.identifierPrefix;if(Nt){var n=vs,r=ys;n=(r&~(1<<32-Lr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Oc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=UA++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},HA={readContext:xr,useCallback:RI,useContext:xr,useEffect:Sy,useImperativeHandle:PI,useInsertionEffect:NI,useLayoutEffect:jI,useMemo:kI,useReducer:Cp,useRef:TI,useState:function(){return Cp(Vc)},useDebugValue:Cy,useDeferredValue:function(t){var e=br();return DI(e,Zt.memoizedState,t)},useTransition:function(){var t=Cp(Vc)[0],e=br().memoizedState;return[t,e]},useMutableSource:xI,useSyncExternalStore:bI,useId:LI,unstable_isNewReconciler:!1},WA={readContext:xr,useCallback:RI,useContext:xr,useEffect:Sy,useImperativeHandle:PI,useInsertionEffect:NI,useLayoutEffect:jI,useMemo:kI,useReducer:Tp,useRef:TI,useState:function(){return Tp(Vc)},useDebugValue:Cy,useDeferredValue:function(t){var e=br();return Zt===null?e.memoizedState=t:DI(e,Zt.memoizedState,t)},useTransition:function(){var t=Tp(Vc)[0],e=br().memoizedState;return[t,e]},useMutableSource:xI,useSyncExternalStore:bI,useId:LI,unstable_isNewReconciler:!1};function jr(t,e){if(t&&t.defaultProps){e=Ot({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function qm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ot({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Jh={isMounted:function(t){return(t=t._reactInternals)?Vo(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Vn(),s=mi(t),i=ws(r,s);i.payload=e,n!=null&&(i.callback=n),e=fi(t,i,s),e!==null&&(Or(e,t,s,r),md(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Vn(),s=mi(t),i=ws(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=fi(t,i,s),e!==null&&(Or(e,t,s,r),md(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Vn(),r=mi(t),s=ws(n,r);s.tag=2,e!=null&&(s.callback=e),e=fi(t,s,r),e!==null&&(Or(e,t,r,n),md(e,t,r))}};function Bx(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Ac(n,r)||!Ac(s,i):!0}function FI(t,e,n){var r=!1,s=Ii,i=e.contextType;return typeof i=="object"&&i!==null?i=xr(i):(s=Qn(e)?mo:Pn.current,r=e.contextTypes,i=(r=r!=null)?Ma(t,s):Ii),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Jh,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function zx(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Jh.enqueueReplaceState(e,e.state,null)}function Hm(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},vy(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=xr(i):(i=Qn(e)?mo:Pn.current,s.context=Ma(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(qm(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Jh.enqueueReplaceState(s,s.state,null),rh(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ba(t,e){try{var n="",r=e;do n+=xj(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Np(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Wm(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var GA=typeof WeakMap=="function"?WeakMap:Map;function UI(t,e,n){n=ws(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){lh||(lh=!0,ng=r),Wm(t,e)},n}function $I(t,e,n){n=ws(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Wm(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Wm(t,e),typeof r!="function"&&(pi===null?pi=new Set([this]):pi.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function qx(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new GA;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=aP.bind(null,t,e,n),e.then(t,t))}function Hx(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Wx(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ws(-1,1),e.tag=2,fi(n,e,1))),n.lanes|=1),t)}var KA=Ls.ReactCurrentOwner,Wn=!1;function Dn(t,e,n,r){e.child=t===null?gI(e,null,n,r):Ua(e,t.child,n,r)}function Gx(t,e,n,r,s){n=n.render;var i=e.ref;return Na(e,s),r=Ey(t,e,n,r,i,s),n=Iy(),t!==null&&!Wn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ns(t,e,s)):(Nt&&n&&dy(e),e.flags|=1,Dn(t,e,r,s),e.child)}function Kx(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Dy(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,BI(t,e,i,r,s)):(t=bd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Ac,n(a,r)&&t.ref===e.ref)return Ns(t,e,s)}return e.flags|=1,t=gi(i,r),t.ref=e.ref,t.return=e,e.child=t}function BI(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Ac(i,r)&&t.ref===e.ref)if(Wn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Wn=!0);else return e.lanes=t.lanes,Ns(t,e,s)}return Gm(t,e,n,r,s)}function zI(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},xt(wa,nr),nr|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,xt(wa,nr),nr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,xt(wa,nr),nr|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,xt(wa,nr),nr|=r;return Dn(t,e,s,n),e.child}function qI(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Gm(t,e,n,r,s){var i=Qn(n)?mo:Pn.current;return i=Ma(e,i),Na(e,s),n=Ey(t,e,n,r,i,s),r=Iy(),t!==null&&!Wn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ns(t,e,s)):(Nt&&r&&dy(e),e.flags|=1,Dn(t,e,n,s),e.child)}function Qx(t,e,n,r,s){if(Qn(n)){var i=!0;Jd(e)}else i=!1;if(Na(e,s),e.stateNode===null)vd(t,e),FI(e,n,r),Hm(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=xr(d):(d=Qn(n)?mo:Pn.current,d=Ma(e,d));var f=n.getDerivedStateFromProps,h=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||c!==d)&&zx(e,a,r,d),Ys=!1;var p=e.memoizedState;a.state=p,rh(e,r,a,s),c=e.memoizedState,l!==r||p!==c||Kn.current||Ys?(typeof f=="function"&&(qm(e,n,f,r),c=e.memoizedState),(l=Ys||Bx(e,n,l,r,p,c,d))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),a.props=r,a.state=c,a.context=d,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,vI(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:jr(e.type,l),a.props=d,h=e.pendingProps,p=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=xr(c):(c=Qn(n)?mo:Pn.current,c=Ma(e,c));var x=n.getDerivedStateFromProps;(f=typeof x=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==h||p!==c)&&zx(e,a,r,c),Ys=!1,p=e.memoizedState,a.state=p,rh(e,r,a,s);var T=e.memoizedState;l!==h||p!==T||Kn.current||Ys?(typeof x=="function"&&(qm(e,n,x,r),T=e.memoizedState),(d=Ys||Bx(e,n,d,r,p,T,c)||!1)?(f||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,T,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,T,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=T),a.props=r,a.state=T,a.context=c,r=d):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),r=!1)}return Km(t,e,n,r,i,s)}function Km(t,e,n,r,s,i){qI(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&Dx(e,n,!1),Ns(t,e,i);r=e.stateNode,KA.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Ua(e,t.child,null,i),e.child=Ua(e,null,l,i)):Dn(t,e,l,i),e.memoizedState=r.state,s&&Dx(e,n,!0),e.child}function HI(t){var e=t.stateNode;e.pendingContext?kx(t,e.pendingContext,e.pendingContext!==e.context):e.context&&kx(t,e.context,!1),_y(t,e.containerInfo)}function Yx(t,e,n,r,s){return Fa(),fy(s),e.flags|=256,Dn(t,e,n,r),e.child}var Qm={dehydrated:null,treeContext:null,retryLane:0};function Ym(t){return{baseLanes:t,cachePool:null,transitions:null}}function WI(t,e,n){var r=e.pendingProps,s=Rt.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),xt(Rt,s&1),t===null)return Bm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=tf(a,r,0,null),t=ao(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Ym(n),e.memoizedState=Qm,t):Ty(e,a));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return QA(t,e,a,r,l,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=gi(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=gi(l,i):(i=ao(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?Ym(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=Qm,r}return i=t.child,t=i.sibling,r=gi(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Ty(t,e){return e=tf({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Wu(t,e,n,r){return r!==null&&fy(r),Ua(e,t.child,null,n),t=Ty(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function QA(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=Np(Error(ae(422))),Wu(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=tf({mode:"visible",children:r.children},s,0,null),i=ao(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Ua(e,t.child,null,a),e.child.memoizedState=Ym(a),e.memoizedState=Qm,i);if(!(e.mode&1))return Wu(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(ae(419)),r=Np(i,r,void 0),Wu(t,e,a,r)}if(l=(a&t.childLanes)!==0,Wn||l){if(r=un,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Ts(t,s),Or(r,t,s,-1))}return ky(),r=Np(Error(ae(421))),Wu(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=lP.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,sr=hi(s.nextSibling),or=e,Nt=!0,kr=null,t!==null&&(hr[fr++]=ys,hr[fr++]=vs,hr[fr++]=go,ys=t.id,vs=t.overflow,go=e),e=Ty(e,r.children),e.flags|=4096,e)}function Xx(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),zm(t.return,e,n)}function jp(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function GI(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Dn(t,e,r.children,n),r=Rt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Xx(t,n,e);else if(t.tag===19)Xx(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(xt(Rt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&sh(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),jp(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&sh(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}jp(e,!0,n,null,i);break;case"together":jp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function vd(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ns(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),vo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ae(153));if(e.child!==null){for(t=e.child,n=gi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=gi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function YA(t,e,n){switch(e.tag){case 3:HI(e),Fa();break;case 5:_I(e);break;case 1:Qn(e.type)&&Jd(e);break;case 4:_y(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;xt(th,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(xt(Rt,Rt.current&1),e.flags|=128,null):n&e.child.childLanes?WI(t,e,n):(xt(Rt,Rt.current&1),t=Ns(t,e,n),t!==null?t.sibling:null);xt(Rt,Rt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return GI(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),xt(Rt,Rt.current),r)break;return null;case 22:case 23:return e.lanes=0,zI(t,e,n)}return Ns(t,e,n)}var KI,Xm,QI,YI;KI=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Xm=function(){};QI=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,ro(rs.current);var i=null;switch(n){case"input":s=_m(t,s),r=_m(t,r),i=[];break;case"select":s=Ot({},s,{value:void 0}),r=Ot({},r,{value:void 0}),i=[];break;case"textarea":s=wm(t,s),r=wm(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Yd)}Im(n,r);var a;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ec.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ec.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&It("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};YI=function(t,e,n,r){n!==r&&(e.flags|=4)};function kl(t,e){if(!Nt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function xn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function XA(t,e,n){var r=e.pendingProps;switch(hy(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xn(e),null;case 1:return Qn(e.type)&&Xd(),xn(e),null;case 3:return r=e.stateNode,$a(),St(Kn),St(Pn),by(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(qu(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,kr!==null&&(ig(kr),kr=null))),Xm(t,e),xn(e),null;case 5:xy(e);var s=ro(Lc.current);if(n=e.type,t!==null&&e.stateNode!=null)QI(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(ae(166));return xn(e),null}if(t=ro(rs.current),qu(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Jr]=e,r[kc]=i,t=(e.mode&1)!==0,n){case"dialog":It("cancel",r),It("close",r);break;case"iframe":case"object":case"embed":It("load",r);break;case"video":case"audio":for(s=0;s<Kl.length;s++)It(Kl[s],r);break;case"source":It("error",r);break;case"img":case"image":case"link":It("error",r),It("load",r);break;case"details":It("toggle",r);break;case"input":ox(r,i),It("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},It("invalid",r);break;case"textarea":lx(r,i),It("invalid",r)}Im(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&zu(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&zu(r.textContent,l,t),s=["children",""+l]):Ec.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&It("scroll",r)}switch(n){case"input":Lu(r),ax(r,i,!0);break;case"textarea":Lu(r),cx(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Yd)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=IE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Jr]=e,t[kc]=r,KI(t,e,!1,!1),e.stateNode=t;e:{switch(a=Sm(n,r),n){case"dialog":It("cancel",t),It("close",t),s=r;break;case"iframe":case"object":case"embed":It("load",t),s=r;break;case"video":case"audio":for(s=0;s<Kl.length;s++)It(Kl[s],t);s=r;break;case"source":It("error",t),s=r;break;case"img":case"image":case"link":It("error",t),It("load",t),s=r;break;case"details":It("toggle",t),s=r;break;case"input":ox(t,r),s=_m(t,r),It("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ot({},r,{value:void 0}),It("invalid",t);break;case"textarea":lx(t,r),s=wm(t,r),It("invalid",t);break;default:s=r}Im(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?TE(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&SE(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Ic(t,c):typeof c=="number"&&Ic(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ec.hasOwnProperty(i)?c!=null&&i==="onScroll"&&It("scroll",t):c!=null&&Xg(t,i,c,a))}switch(n){case"input":Lu(t),ax(t,r,!1);break;case"textarea":Lu(t),cx(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ei(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Ia(t,!!r.multiple,i,!1):r.defaultValue!=null&&Ia(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Yd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return xn(e),null;case 6:if(t&&e.stateNode!=null)YI(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(ae(166));if(n=ro(Lc.current),ro(rs.current),qu(e)){if(r=e.stateNode,n=e.memoizedProps,r[Jr]=e,(i=r.nodeValue!==n)&&(t=or,t!==null))switch(t.tag){case 3:zu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&zu(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Jr]=e,e.stateNode=r}return xn(e),null;case 13:if(St(Rt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Nt&&sr!==null&&e.mode&1&&!(e.flags&128))pI(),Fa(),e.flags|=98560,i=!1;else if(i=qu(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(ae(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ae(317));i[Jr]=e}else Fa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;xn(e),i=!1}else kr!==null&&(ig(kr),kr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Rt.current&1?en===0&&(en=3):ky())),e.updateQueue!==null&&(e.flags|=4),xn(e),null);case 4:return $a(),Xm(t,e),t===null&&Pc(e.stateNode.containerInfo),xn(e),null;case 10:return gy(e.type._context),xn(e),null;case 17:return Qn(e.type)&&Xd(),xn(e),null;case 19:if(St(Rt),i=e.memoizedState,i===null)return xn(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)kl(i,!1);else{if(en!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=sh(t),a!==null){for(e.flags|=128,kl(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return xt(Rt,Rt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Gt()>za&&(e.flags|=128,r=!0,kl(i,!1),e.lanes=4194304)}else{if(!r)if(t=sh(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),kl(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Nt)return xn(e),null}else 2*Gt()-i.renderingStartTime>za&&n!==1073741824&&(e.flags|=128,r=!0,kl(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Gt(),e.sibling=null,n=Rt.current,xt(Rt,r?n&1|2:n&1),e):(xn(e),null);case 22:case 23:return Ry(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?nr&1073741824&&(xn(e),e.subtreeFlags&6&&(e.flags|=8192)):xn(e),null;case 24:return null;case 25:return null}throw Error(ae(156,e.tag))}function JA(t,e){switch(hy(e),e.tag){case 1:return Qn(e.type)&&Xd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return $a(),St(Kn),St(Pn),by(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return xy(e),null;case 13:if(St(Rt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ae(340));Fa()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return St(Rt),null;case 4:return $a(),null;case 10:return gy(e.type._context),null;case 22:case 23:return Ry(),null;case 24:return null;default:return null}}var Gu=!1,Sn=!1,ZA=typeof WeakSet=="function"?WeakSet:Set,be=null;function ba(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ft(t,e,r)}else n.current=null}function Jm(t,e,n){try{n()}catch(r){Ft(t,e,r)}}var Jx=!1;function eP(t,e){if(Lm=Gd,t=tI(),uy(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,d=0,f=0,h=t,p=null;t:for(;;){for(var x;h!==n||s!==0&&h.nodeType!==3||(l=a+s),h!==i||r!==0&&h.nodeType!==3||(c=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(x=h.firstChild)!==null;)p=h,h=x;for(;;){if(h===t)break t;if(p===n&&++d===s&&(l=a),p===i&&++f===r&&(c=a),(x=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=x}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Om={focusedElem:t,selectionRange:n},Gd=!1,be=e;be!==null;)if(e=be,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,be=t;else for(;be!==null;){e=be;try{var T=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var C=T.memoizedProps,N=T.memoizedState,_=e.stateNode,E=_.getSnapshotBeforeUpdate(e.elementType===e.type?C:jr(e.type,C),N);_.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ae(163))}}catch(I){Ft(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,be=t;break}be=e.return}return T=Jx,Jx=!1,T}function uc(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Jm(e,n,i)}s=s.next}while(s!==r)}}function Zh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Zm(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function XI(t){var e=t.alternate;e!==null&&(t.alternate=null,XI(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Jr],delete e[kc],delete e[Fm],delete e[OA],delete e[VA])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function JI(t){return t.tag===5||t.tag===3||t.tag===4}function Zx(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||JI(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function eg(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Yd));else if(r!==4&&(t=t.child,t!==null))for(eg(t,e,n),t=t.sibling;t!==null;)eg(t,e,n),t=t.sibling}function tg(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(tg(t,e,n),t=t.sibling;t!==null;)tg(t,e,n),t=t.sibling}var hn=null,Ar=!1;function zs(t,e,n){for(n=n.child;n!==null;)ZI(t,e,n),n=n.sibling}function ZI(t,e,n){if(ns&&typeof ns.onCommitFiberUnmount=="function")try{ns.onCommitFiberUnmount(Hh,n)}catch{}switch(n.tag){case 5:Sn||ba(n,e);case 6:var r=hn,s=Ar;hn=null,zs(t,e,n),hn=r,Ar=s,hn!==null&&(Ar?(t=hn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):hn.removeChild(n.stateNode));break;case 18:hn!==null&&(Ar?(t=hn,n=n.stateNode,t.nodeType===8?wp(t.parentNode,n):t.nodeType===1&&wp(t,n),Nc(t)):wp(hn,n.stateNode));break;case 4:r=hn,s=Ar,hn=n.stateNode.containerInfo,Ar=!0,zs(t,e,n),hn=r,Ar=s;break;case 0:case 11:case 14:case 15:if(!Sn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Jm(n,e,a),s=s.next}while(s!==r)}zs(t,e,n);break;case 1:if(!Sn&&(ba(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Ft(n,e,l)}zs(t,e,n);break;case 21:zs(t,e,n);break;case 22:n.mode&1?(Sn=(r=Sn)||n.memoizedState!==null,zs(t,e,n),Sn=r):zs(t,e,n);break;default:zs(t,e,n)}}function eb(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new ZA),e.forEach(function(r){var s=cP.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Tr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:hn=l.stateNode,Ar=!1;break e;case 3:hn=l.stateNode.containerInfo,Ar=!0;break e;case 4:hn=l.stateNode.containerInfo,Ar=!0;break e}l=l.return}if(hn===null)throw Error(ae(160));ZI(i,a,s),hn=null,Ar=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Ft(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)eS(e,t),e=e.sibling}function eS(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Tr(e,t),Gr(t),r&4){try{uc(3,t,t.return),Zh(3,t)}catch(C){Ft(t,t.return,C)}try{uc(5,t,t.return)}catch(C){Ft(t,t.return,C)}}break;case 1:Tr(e,t),Gr(t),r&512&&n!==null&&ba(n,n.return);break;case 5:if(Tr(e,t),Gr(t),r&512&&n!==null&&ba(n,n.return),t.flags&32){var s=t.stateNode;try{Ic(s,"")}catch(C){Ft(t,t.return,C)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&wE(s,i),Sm(l,a);var d=Sm(l,i);for(a=0;a<c.length;a+=2){var f=c[a],h=c[a+1];f==="style"?TE(s,h):f==="dangerouslySetInnerHTML"?SE(s,h):f==="children"?Ic(s,h):Xg(s,f,h,d)}switch(l){case"input":xm(s,i);break;case"textarea":EE(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var x=i.value;x!=null?Ia(s,!!i.multiple,x,!1):p!==!!i.multiple&&(i.defaultValue!=null?Ia(s,!!i.multiple,i.defaultValue,!0):Ia(s,!!i.multiple,i.multiple?[]:"",!1))}s[kc]=i}catch(C){Ft(t,t.return,C)}}break;case 6:if(Tr(e,t),Gr(t),r&4){if(t.stateNode===null)throw Error(ae(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(C){Ft(t,t.return,C)}}break;case 3:if(Tr(e,t),Gr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Nc(e.containerInfo)}catch(C){Ft(t,t.return,C)}break;case 4:Tr(e,t),Gr(t);break;case 13:Tr(e,t),Gr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Ay=Gt())),r&4&&eb(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(Sn=(d=Sn)||f,Tr(e,t),Sn=d):Tr(e,t),Gr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!f&&t.mode&1)for(be=t,f=t.child;f!==null;){for(h=be=f;be!==null;){switch(p=be,x=p.child,p.tag){case 0:case 11:case 14:case 15:uc(4,p,p.return);break;case 1:ba(p,p.return);var T=p.stateNode;if(typeof T.componentWillUnmount=="function"){r=p,n=p.return;try{e=r,T.props=e.memoizedProps,T.state=e.memoizedState,T.componentWillUnmount()}catch(C){Ft(r,n,C)}}break;case 5:ba(p,p.return);break;case 22:if(p.memoizedState!==null){nb(h);continue}}x!==null?(x.return=p,be=x):nb(h)}f=f.sibling}e:for(f=null,h=t;;){if(h.tag===5){if(f===null){f=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=CE("display",a))}catch(C){Ft(t,t.return,C)}}}else if(h.tag===6){if(f===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(C){Ft(t,t.return,C)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;f===h&&(f=null),h=h.return}f===h&&(f=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Tr(e,t),Gr(t),r&4&&eb(t);break;case 21:break;default:Tr(e,t),Gr(t)}}function Gr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(JI(n)){var r=n;break e}n=n.return}throw Error(ae(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Ic(s,""),r.flags&=-33);var i=Zx(t);tg(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=Zx(t);eg(t,l,a);break;default:throw Error(ae(161))}}catch(c){Ft(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function tP(t,e,n){be=t,tS(t)}function tS(t,e,n){for(var r=(t.mode&1)!==0;be!==null;){var s=be,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||Gu;if(!a){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Sn;l=Gu;var d=Sn;if(Gu=a,(Sn=c)&&!d)for(be=s;be!==null;)a=be,c=a.child,a.tag===22&&a.memoizedState!==null?rb(s):c!==null?(c.return=a,be=c):rb(s);for(;i!==null;)be=i,tS(i),i=i.sibling;be=s,Gu=l,Sn=d}tb(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,be=i):tb(t)}}function tb(t){for(;be!==null;){var e=be;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Sn||Zh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Sn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:jr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Fx(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Fx(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var h=f.dehydrated;h!==null&&Nc(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ae(163))}Sn||e.flags&512&&Zm(e)}catch(p){Ft(e,e.return,p)}}if(e===t){be=null;break}if(n=e.sibling,n!==null){n.return=e.return,be=n;break}be=e.return}}function nb(t){for(;be!==null;){var e=be;if(e===t){be=null;break}var n=e.sibling;if(n!==null){n.return=e.return,be=n;break}be=e.return}}function rb(t){for(;be!==null;){var e=be;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Zh(4,e)}catch(c){Ft(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Ft(e,s,c)}}var i=e.return;try{Zm(e)}catch(c){Ft(e,i,c)}break;case 5:var a=e.return;try{Zm(e)}catch(c){Ft(e,a,c)}}}catch(c){Ft(e,e.return,c)}if(e===t){be=null;break}var l=e.sibling;if(l!==null){l.return=e.return,be=l;break}be=e.return}}var nP=Math.ceil,ah=Ls.ReactCurrentDispatcher,Ny=Ls.ReactCurrentOwner,vr=Ls.ReactCurrentBatchConfig,at=0,un=null,Qt=null,mn=0,nr=0,wa=Pi(0),en=0,Fc=null,vo=0,ef=0,jy=0,dc=null,Hn=null,Ay=0,za=1/0,ms=null,lh=!1,ng=null,pi=null,Ku=!1,ai=null,ch=0,hc=0,rg=null,_d=-1,xd=0;function Vn(){return at&6?Gt():_d!==-1?_d:_d=Gt()}function mi(t){return t.mode&1?at&2&&mn!==0?mn&-mn:FA.transition!==null?(xd===0&&(xd=FE()),xd):(t=pt,t!==0||(t=window.event,t=t===void 0?16:WE(t.type)),t):1}function Or(t,e,n,r){if(50<hc)throw hc=0,rg=null,Error(ae(185));nu(t,n,r),(!(at&2)||t!==un)&&(t===un&&(!(at&2)&&(ef|=n),en===4&&Js(t,mn)),Yn(t,r),n===1&&at===0&&!(e.mode&1)&&(za=Gt()+500,Yh&&Ri()))}function Yn(t,e){var n=t.callbackNode;Fj(t,e);var r=Wd(t,t===un?mn:0);if(r===0)n!==null&&hx(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&hx(n),e===1)t.tag===0?MA(sb.bind(null,t)):dI(sb.bind(null,t)),DA(function(){!(at&6)&&Ri()}),n=null;else{switch(UE(r)){case 1:n=ny;break;case 4:n=VE;break;case 16:n=Hd;break;case 536870912:n=ME;break;default:n=Hd}n=cS(n,nS.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function nS(t,e){if(_d=-1,xd=0,at&6)throw Error(ae(327));var n=t.callbackNode;if(ja()&&t.callbackNode!==n)return null;var r=Wd(t,t===un?mn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=uh(t,r);else{e=r;var s=at;at|=2;var i=sS();(un!==t||mn!==e)&&(ms=null,za=Gt()+500,oo(t,e));do try{iP();break}catch(l){rS(t,l)}while(!0);my(),ah.current=i,at=s,Qt!==null?e=0:(un=null,mn=0,e=en)}if(e!==0){if(e===2&&(s=Am(t),s!==0&&(r=s,e=sg(t,s))),e===1)throw n=Fc,oo(t,0),Js(t,r),Yn(t,Gt()),n;if(e===6)Js(t,r);else{if(s=t.current.alternate,!(r&30)&&!rP(s)&&(e=uh(t,r),e===2&&(i=Am(t),i!==0&&(r=i,e=sg(t,i))),e===1))throw n=Fc,oo(t,0),Js(t,r),Yn(t,Gt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(ae(345));case 2:Wi(t,Hn,ms);break;case 3:if(Js(t,r),(r&130023424)===r&&(e=Ay+500-Gt(),10<e)){if(Wd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Vn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Mm(Wi.bind(null,t,Hn,ms),e);break}Wi(t,Hn,ms);break;case 4:if(Js(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-Lr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Gt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*nP(r/1960))-r,10<r){t.timeoutHandle=Mm(Wi.bind(null,t,Hn,ms),r);break}Wi(t,Hn,ms);break;case 5:Wi(t,Hn,ms);break;default:throw Error(ae(329))}}}return Yn(t,Gt()),t.callbackNode===n?nS.bind(null,t):null}function sg(t,e){var n=dc;return t.current.memoizedState.isDehydrated&&(oo(t,e).flags|=256),t=uh(t,e),t!==2&&(e=Hn,Hn=n,e!==null&&ig(e)),t}function ig(t){Hn===null?Hn=t:Hn.push.apply(Hn,t)}function rP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Mr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Js(t,e){for(e&=~jy,e&=~ef,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Lr(e),r=1<<n;t[n]=-1,e&=~r}}function sb(t){if(at&6)throw Error(ae(327));ja();var e=Wd(t,0);if(!(e&1))return Yn(t,Gt()),null;var n=uh(t,e);if(t.tag!==0&&n===2){var r=Am(t);r!==0&&(e=r,n=sg(t,r))}if(n===1)throw n=Fc,oo(t,0),Js(t,e),Yn(t,Gt()),n;if(n===6)throw Error(ae(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Wi(t,Hn,ms),Yn(t,Gt()),null}function Py(t,e){var n=at;at|=1;try{return t(e)}finally{at=n,at===0&&(za=Gt()+500,Yh&&Ri())}}function _o(t){ai!==null&&ai.tag===0&&!(at&6)&&ja();var e=at;at|=1;var n=vr.transition,r=pt;try{if(vr.transition=null,pt=1,t)return t()}finally{pt=r,vr.transition=n,at=e,!(at&6)&&Ri()}}function Ry(){nr=wa.current,St(wa)}function oo(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,kA(n)),Qt!==null)for(n=Qt.return;n!==null;){var r=n;switch(hy(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Xd();break;case 3:$a(),St(Kn),St(Pn),by();break;case 5:xy(r);break;case 4:$a();break;case 13:St(Rt);break;case 19:St(Rt);break;case 10:gy(r.type._context);break;case 22:case 23:Ry()}n=n.return}if(un=t,Qt=t=gi(t.current,null),mn=nr=e,en=0,Fc=null,jy=ef=vo=0,Hn=dc=null,no!==null){for(e=0;e<no.length;e++)if(n=no[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}no=null}return t}function rS(t,e){do{var n=Qt;try{if(my(),gd.current=oh,ih){for(var r=Lt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}ih=!1}if(yo=0,ln=Zt=Lt=null,cc=!1,Oc=0,Ny.current=null,n===null||n.return===null){en=1,Fc=e,Qt=null;break}e:{var i=t,a=n.return,l=n,c=e;if(e=mn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,f=l,h=f.tag;if(!(f.mode&1)&&(h===0||h===11||h===15)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var x=Hx(a);if(x!==null){x.flags&=-257,Wx(x,a,l,i,e),x.mode&1&&qx(i,d,e),e=x,c=d;var T=e.updateQueue;if(T===null){var C=new Set;C.add(c),e.updateQueue=C}else T.add(c);break e}else{if(!(e&1)){qx(i,d,e),ky();break e}c=Error(ae(426))}}else if(Nt&&l.mode&1){var N=Hx(a);if(N!==null){!(N.flags&65536)&&(N.flags|=256),Wx(N,a,l,i,e),fy(Ba(c,l));break e}}i=c=Ba(c,l),en!==4&&(en=2),dc===null?dc=[i]:dc.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var _=UI(i,c,e);Mx(i,_);break e;case 1:l=c;var E=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof E.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(pi===null||!pi.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var I=$I(i,l,e);Mx(i,I);break e}}i=i.return}while(i!==null)}oS(n)}catch(L){e=L,Qt===n&&n!==null&&(Qt=n=n.return);continue}break}while(!0)}function sS(){var t=ah.current;return ah.current=oh,t===null?oh:t}function ky(){(en===0||en===3||en===2)&&(en=4),un===null||!(vo&268435455)&&!(ef&268435455)||Js(un,mn)}function uh(t,e){var n=at;at|=2;var r=sS();(un!==t||mn!==e)&&(ms=null,oo(t,e));do try{sP();break}catch(s){rS(t,s)}while(!0);if(my(),at=n,ah.current=r,Qt!==null)throw Error(ae(261));return un=null,mn=0,en}function sP(){for(;Qt!==null;)iS(Qt)}function iP(){for(;Qt!==null&&!Aj();)iS(Qt)}function iS(t){var e=lS(t.alternate,t,nr);t.memoizedProps=t.pendingProps,e===null?oS(t):Qt=e,Ny.current=null}function oS(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=JA(n,e),n!==null){n.flags&=32767,Qt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{en=6,Qt=null;return}}else if(n=XA(n,e,nr),n!==null){Qt=n;return}if(e=e.sibling,e!==null){Qt=e;return}Qt=e=t}while(e!==null);en===0&&(en=5)}function Wi(t,e,n){var r=pt,s=vr.transition;try{vr.transition=null,pt=1,oP(t,e,n,r)}finally{vr.transition=s,pt=r}return null}function oP(t,e,n,r){do ja();while(ai!==null);if(at&6)throw Error(ae(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ae(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(Uj(t,i),t===un&&(Qt=un=null,mn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ku||(Ku=!0,cS(Hd,function(){return ja(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=vr.transition,vr.transition=null;var a=pt;pt=1;var l=at;at|=4,Ny.current=null,eP(t,n),eS(n,t),CA(Om),Gd=!!Lm,Om=Lm=null,t.current=n,tP(n),Pj(),at=l,pt=a,vr.transition=i}else t.current=n;if(Ku&&(Ku=!1,ai=t,ch=s),i=t.pendingLanes,i===0&&(pi=null),Dj(n.stateNode),Yn(t,Gt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(lh)throw lh=!1,t=ng,ng=null,t;return ch&1&&t.tag!==0&&ja(),i=t.pendingLanes,i&1?t===rg?hc++:(hc=0,rg=t):hc=0,Ri(),null}function ja(){if(ai!==null){var t=UE(ch),e=vr.transition,n=pt;try{if(vr.transition=null,pt=16>t?16:t,ai===null)var r=!1;else{if(t=ai,ai=null,ch=0,at&6)throw Error(ae(331));var s=at;for(at|=4,be=t.current;be!==null;){var i=be,a=i.child;if(be.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(be=d;be!==null;){var f=be;switch(f.tag){case 0:case 11:case 15:uc(8,f,i)}var h=f.child;if(h!==null)h.return=f,be=h;else for(;be!==null;){f=be;var p=f.sibling,x=f.return;if(XI(f),f===d){be=null;break}if(p!==null){p.return=x,be=p;break}be=x}}}var T=i.alternate;if(T!==null){var C=T.child;if(C!==null){T.child=null;do{var N=C.sibling;C.sibling=null,C=N}while(C!==null)}}be=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,be=a;else e:for(;be!==null;){if(i=be,i.flags&2048)switch(i.tag){case 0:case 11:case 15:uc(9,i,i.return)}var _=i.sibling;if(_!==null){_.return=i.return,be=_;break e}be=i.return}}var E=t.current;for(be=E;be!==null;){a=be;var S=a.child;if(a.subtreeFlags&2064&&S!==null)S.return=a,be=S;else e:for(a=E;be!==null;){if(l=be,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Zh(9,l)}}catch(L){Ft(l,l.return,L)}if(l===a){be=null;break e}var I=l.sibling;if(I!==null){I.return=l.return,be=I;break e}be=l.return}}if(at=s,Ri(),ns&&typeof ns.onPostCommitFiberRoot=="function")try{ns.onPostCommitFiberRoot(Hh,t)}catch{}r=!0}return r}finally{pt=n,vr.transition=e}}return!1}function ib(t,e,n){e=Ba(n,e),e=UI(t,e,1),t=fi(t,e,1),e=Vn(),t!==null&&(nu(t,1,e),Yn(t,e))}function Ft(t,e,n){if(t.tag===3)ib(t,t,n);else for(;e!==null;){if(e.tag===3){ib(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(pi===null||!pi.has(r))){t=Ba(n,t),t=$I(e,t,1),e=fi(e,t,1),t=Vn(),e!==null&&(nu(e,1,t),Yn(e,t));break}}e=e.return}}function aP(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Vn(),t.pingedLanes|=t.suspendedLanes&n,un===t&&(mn&n)===n&&(en===4||en===3&&(mn&130023424)===mn&&500>Gt()-Ay?oo(t,0):jy|=n),Yn(t,e)}function aS(t,e){e===0&&(t.mode&1?(e=Mu,Mu<<=1,!(Mu&130023424)&&(Mu=4194304)):e=1);var n=Vn();t=Ts(t,e),t!==null&&(nu(t,e,n),Yn(t,n))}function lP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),aS(t,n)}function cP(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(ae(314))}r!==null&&r.delete(e),aS(t,n)}var lS;lS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Kn.current)Wn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Wn=!1,YA(t,e,n);Wn=!!(t.flags&131072)}else Wn=!1,Nt&&e.flags&1048576&&hI(e,eh,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;vd(t,e),t=e.pendingProps;var s=Ma(e,Pn.current);Na(e,n),s=Ey(null,e,r,t,s,n);var i=Iy();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qn(r)?(i=!0,Jd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,vy(e),s.updater=Jh,e.stateNode=s,s._reactInternals=e,Hm(e,r,t,n),e=Km(null,e,r,!0,i,n)):(e.tag=0,Nt&&i&&dy(e),Dn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(vd(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=dP(r),t=jr(r,t),s){case 0:e=Gm(null,e,r,t,n);break e;case 1:e=Qx(null,e,r,t,n);break e;case 11:e=Gx(null,e,r,t,n);break e;case 14:e=Kx(null,e,r,jr(r.type,t),n);break e}throw Error(ae(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:jr(r,s),Gm(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:jr(r,s),Qx(t,e,r,s,n);case 3:e:{if(HI(e),t===null)throw Error(ae(387));r=e.pendingProps,i=e.memoizedState,s=i.element,vI(t,e),rh(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ba(Error(ae(423)),e),e=Yx(t,e,r,n,s);break e}else if(r!==s){s=Ba(Error(ae(424)),e),e=Yx(t,e,r,n,s);break e}else for(sr=hi(e.stateNode.containerInfo.firstChild),or=e,Nt=!0,kr=null,n=gI(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Fa(),r===s){e=Ns(t,e,n);break e}Dn(t,e,r,n)}e=e.child}return e;case 5:return _I(e),t===null&&Bm(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,Vm(r,s)?a=null:i!==null&&Vm(r,i)&&(e.flags|=32),qI(t,e),Dn(t,e,a,n),e.child;case 6:return t===null&&Bm(e),null;case 13:return WI(t,e,n);case 4:return _y(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ua(e,null,r,n):Dn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:jr(r,s),Gx(t,e,r,s,n);case 7:return Dn(t,e,e.pendingProps,n),e.child;case 8:return Dn(t,e,e.pendingProps.children,n),e.child;case 12:return Dn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,xt(th,r._currentValue),r._currentValue=a,i!==null)if(Mr(i.value,a)){if(i.children===s.children&&!Kn.current){e=Ns(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=ws(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?c.next=c:(c.next=f.next,f.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),zm(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(ae(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),zm(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Dn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Na(e,n),s=xr(s),r=r(s),e.flags|=1,Dn(t,e,r,n),e.child;case 14:return r=e.type,s=jr(r,e.pendingProps),s=jr(r.type,s),Kx(t,e,r,s,n);case 15:return BI(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:jr(r,s),vd(t,e),e.tag=1,Qn(r)?(t=!0,Jd(e)):t=!1,Na(e,n),FI(e,r,s),Hm(e,r,s,n),Km(null,e,r,!0,t,n);case 19:return GI(t,e,n);case 22:return zI(t,e,n)}throw Error(ae(156,e.tag))};function cS(t,e){return OE(t,e)}function uP(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gr(t,e,n,r){return new uP(t,e,n,r)}function Dy(t){return t=t.prototype,!(!t||!t.isReactComponent)}function dP(t){if(typeof t=="function")return Dy(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Zg)return 11;if(t===ey)return 14}return 2}function gi(t,e){var n=t.alternate;return n===null?(n=gr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function bd(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")Dy(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case ha:return ao(n.children,s,i,e);case Jg:a=8,s|=8;break;case mm:return t=gr(12,n,e,s|2),t.elementType=mm,t.lanes=i,t;case gm:return t=gr(13,n,e,s),t.elementType=gm,t.lanes=i,t;case ym:return t=gr(19,n,e,s),t.elementType=ym,t.lanes=i,t;case _E:return tf(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case yE:a=10;break e;case vE:a=9;break e;case Zg:a=11;break e;case ey:a=14;break e;case Qs:a=16,r=null;break e}throw Error(ae(130,t==null?t:typeof t,""))}return e=gr(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function ao(t,e,n,r){return t=gr(7,t,r,e),t.lanes=n,t}function tf(t,e,n,r){return t=gr(22,t,r,e),t.elementType=_E,t.lanes=n,t.stateNode={isHidden:!1},t}function Ap(t,e,n){return t=gr(6,t,null,e),t.lanes=n,t}function Pp(t,e,n){return e=gr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function hP(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=dp(0),this.expirationTimes=dp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=dp(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Ly(t,e,n,r,s,i,a,l,c){return t=new hP(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=gr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},vy(i),t}function fP(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:da,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function uS(t){if(!t)return Ii;t=t._reactInternals;e:{if(Vo(t)!==t||t.tag!==1)throw Error(ae(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ae(171))}if(t.tag===1){var n=t.type;if(Qn(n))return uI(t,n,e)}return e}function dS(t,e,n,r,s,i,a,l,c){return t=Ly(n,r,!0,t,s,i,a,l,c),t.context=uS(null),n=t.current,r=Vn(),s=mi(n),i=ws(r,s),i.callback=e??null,fi(n,i,s),t.current.lanes=s,nu(t,s,r),Yn(t,r),t}function nf(t,e,n,r){var s=e.current,i=Vn(),a=mi(s);return n=uS(n),e.context===null?e.context=n:e.pendingContext=n,e=ws(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=fi(s,e,a),t!==null&&(Or(t,s,a,i),md(t,s,a)),a}function dh(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ob(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Oy(t,e){ob(t,e),(t=t.alternate)&&ob(t,e)}function pP(){return null}var hS=typeof reportError=="function"?reportError:function(t){console.error(t)};function Vy(t){this._internalRoot=t}rf.prototype.render=Vy.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ae(409));nf(t,e,null,null)};rf.prototype.unmount=Vy.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;_o(function(){nf(null,t,null,null)}),e[Cs]=null}};function rf(t){this._internalRoot=t}rf.prototype.unstable_scheduleHydration=function(t){if(t){var e=zE();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Xs.length&&e!==0&&e<Xs[n].priority;n++);Xs.splice(n,0,t),n===0&&HE(t)}};function My(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function sf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function ab(){}function mP(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=dh(a);i.call(d)}}var a=dS(e,r,t,0,null,!1,!1,"",ab);return t._reactRootContainer=a,t[Cs]=a.current,Pc(t.nodeType===8?t.parentNode:t),_o(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=dh(c);l.call(d)}}var c=Ly(t,0,!1,null,null,!1,!1,"",ab);return t._reactRootContainer=c,t[Cs]=c.current,Pc(t.nodeType===8?t.parentNode:t),_o(function(){nf(e,c,n,r)}),c}function of(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var c=dh(a);l.call(c)}}nf(e,a,t,s)}else a=mP(n,e,t,s,r);return dh(a)}$E=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Gl(e.pendingLanes);n!==0&&(ry(e,n|1),Yn(e,Gt()),!(at&6)&&(za=Gt()+500,Ri()))}break;case 13:_o(function(){var r=Ts(t,1);if(r!==null){var s=Vn();Or(r,t,1,s)}}),Oy(t,1)}};sy=function(t){if(t.tag===13){var e=Ts(t,134217728);if(e!==null){var n=Vn();Or(e,t,134217728,n)}Oy(t,134217728)}};BE=function(t){if(t.tag===13){var e=mi(t),n=Ts(t,e);if(n!==null){var r=Vn();Or(n,t,e,r)}Oy(t,e)}};zE=function(){return pt};qE=function(t,e){var n=pt;try{return pt=t,e()}finally{pt=n}};Tm=function(t,e,n){switch(e){case"input":if(xm(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Qh(r);if(!s)throw Error(ae(90));bE(r),xm(r,s)}}}break;case"textarea":EE(t,n);break;case"select":e=n.value,e!=null&&Ia(t,!!n.multiple,e,!1)}};AE=Py;PE=_o;var gP={usingClientEntryPoint:!1,Events:[su,ga,Qh,NE,jE,Py]},Dl={findFiberByHostInstance:to,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yP={bundleType:Dl.bundleType,version:Dl.version,rendererPackageName:Dl.rendererPackageName,rendererConfig:Dl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ls.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=DE(t),t===null?null:t.stateNode},findFiberByHostInstance:Dl.findFiberByHostInstance||pP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qu.isDisabled&&Qu.supportsFiber)try{Hh=Qu.inject(yP),ns=Qu}catch{}}ur.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gP;ur.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!My(e))throw Error(ae(200));return fP(t,e,null,n)};ur.createRoot=function(t,e){if(!My(t))throw Error(ae(299));var n=!1,r="",s=hS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Ly(t,1,!1,null,null,n,!1,r,s),t[Cs]=e.current,Pc(t.nodeType===8?t.parentNode:t),new Vy(e)};ur.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ae(188)):(t=Object.keys(t).join(","),Error(ae(268,t)));return t=DE(e),t=t===null?null:t.stateNode,t};ur.flushSync=function(t){return _o(t)};ur.hydrate=function(t,e,n){if(!sf(e))throw Error(ae(200));return of(null,t,e,!0,n)};ur.hydrateRoot=function(t,e,n){if(!My(t))throw Error(ae(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=hS;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=dS(e,null,t,1,n??null,s,!1,i,a),t[Cs]=e.current,Pc(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new rf(e)};ur.render=function(t,e,n){if(!sf(e))throw Error(ae(200));return of(null,t,e,!1,n)};ur.unmountComponentAtNode=function(t){if(!sf(t))throw Error(ae(40));return t._reactRootContainer?(_o(function(){of(null,null,t,!1,function(){t._reactRootContainer=null,t[Cs]=null})}),!0):!1};ur.unstable_batchedUpdates=Py;ur.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!sf(n))throw Error(ae(200));if(t==null||t._reactInternals===void 0)throw Error(ae(38));return of(t,e,n,!1,r)};ur.version="18.3.1-next-f1338f8080-20240426";function fS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(fS)}catch(t){console.error(t)}}fS(),fE.exports=ur;var vP=fE.exports,pS,lb=vP;pS=lb.createRoot,lb.hydrateRoot;/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var cb="popstate";function _P(t={}){function e(r,s){let{pathname:i,search:a,hash:l}=r.location;return og("",{pathname:i,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Uc(s)}return bP(e,n,null,t)}function jt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function wr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function xP(){return Math.random().toString(36).substring(2,10)}function ub(t,e){return{usr:t.state,key:t.key,idx:e}}function og(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?al(e):e,state:n,key:e&&e.key||r||xP()}}function Uc({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function al(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function bP(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,l="POP",c=null,d=f();d==null&&(d=0,a.replaceState({...a.state,idx:d},""));function f(){return(a.state||{idx:null}).idx}function h(){l="POP";let N=f(),_=N==null?null:N-d;d=N,c&&c({action:l,location:C.location,delta:_})}function p(N,_){l="PUSH";let E=og(C.location,N,_);d=f()+1;let S=ub(E,d),I=C.createHref(E);try{a.pushState(S,"",I)}catch(L){if(L instanceof DOMException&&L.name==="DataCloneError")throw L;s.location.assign(I)}i&&c&&c({action:l,location:C.location,delta:1})}function x(N,_){l="REPLACE";let E=og(C.location,N,_);d=f();let S=ub(E,d),I=C.createHref(E);a.replaceState(S,"",I),i&&c&&c({action:l,location:C.location,delta:0})}function T(N){return wP(N)}let C={get action(){return l},get location(){return t(s,a)},listen(N){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(cb,h),c=N,()=>{s.removeEventListener(cb,h),c=null}},createHref(N){return e(s,N)},createURL:T,encodeLocation(N){let _=T(N);return{pathname:_.pathname,search:_.search,hash:_.hash}},push:p,replace:x,go(N){return a.go(N)}};return C}function wP(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),jt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Uc(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function mS(t,e,n="/"){return EP(t,e,n,!1)}function EP(t,e,n,r){let s=typeof e=="string"?al(e):e,i=js(s.pathname||"/",n);if(i==null)return null;let a=gS(t);IP(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let d=LP(i);l=kP(a[c],d,r)}return l}function gS(t,e=[],n=[],r="",s=!1){let i=(a,l,c=s,d)=>{let f={relativePath:d===void 0?a.path||"":d,caseSensitive:a.caseSensitive===!0,childrenIndex:l,route:a};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(r)&&c)return;jt(f.relativePath.startsWith(r),`Absolute route path "${f.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(r.length)}let h=Es([r,f.relativePath]),p=n.concat(f);a.children&&a.children.length>0&&(jt(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),gS(a.children,e,p,h,c)),!(a.path==null&&!a.index)&&e.push({path:h,score:PP(h,a.index),routesMeta:p})};return t.forEach((a,l)=>{var c;if(a.path===""||!((c=a.path)!=null&&c.includes("?")))i(a,l);else for(let d of yS(a.path))i(a,l,!0,d)}),e}function yS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=yS(r.join("/")),l=[];return l.push(...a.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...a),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function IP(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:RP(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var SP=/^:[\w-]+$/,CP=3,TP=2,NP=1,jP=10,AP=-2,db=t=>t==="*";function PP(t,e){let n=t.split("/"),r=n.length;return n.some(db)&&(r+=AP),e&&(r+=TP),n.filter(s=>!db(s)).reduce((s,i)=>s+(SP.test(i)?CP:i===""?NP:jP),r)}function RP(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function kP(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",a=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",h=hh({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},f),p=c.route;if(!h&&d&&n&&!r[r.length-1].route.index&&(h=hh({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},f)),!h)return null;Object.assign(s,h.params),a.push({params:s,pathname:Es([i,h.pathname]),pathnameBase:UP(Es([i,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(i=Es([i,h.pathnameBase]))}return a}function hh(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=DP(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,{paramName:f,isOptional:h},p)=>{if(f==="*"){let T=l[p]||"";a=i.slice(0,i.length-T.length).replace(/(.)\/+$/,"$1")}const x=l[p];return h&&!x?d[f]=void 0:d[f]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:t}}function DP(t,e=!1,n=!0){wr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function LP(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return wr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function js(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var OP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,VP=t=>OP.test(t);function MP(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?al(t):t,i;if(n)if(VP(n))i=n;else{if(n.includes("//")){let a=n;n=n.replace(/\/\/+/g,"/"),wr(!1,`Pathnames cannot have embedded double slashes - normalizing ${a} -> ${n}`)}n.startsWith("/")?i=hb(n.substring(1),"/"):i=hb(n,e)}else i=e;return{pathname:i,search:$P(r),hash:BP(s)}}function hb(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Rp(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function FP(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Fy(t){let e=FP(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Uy(t,e,n,r=!1){let s;typeof t=="string"?s=al(t):(s={...t},jt(!s.pathname||!s.pathname.includes("?"),Rp("?","pathname","search",s)),jt(!s.pathname||!s.pathname.includes("#"),Rp("#","pathname","hash",s)),jt(!s.search||!s.search.includes("#"),Rp("#","search","hash",s)));let i=t===""||s.pathname==="",a=i?"/":s.pathname,l;if(a==null)l=n;else{let h=e.length-1;if(!r&&a.startsWith("..")){let p=a.split("/");for(;p[0]==="..";)p.shift(),h-=1;s.pathname=p.join("/")}l=h>=0?e[h]:"/"}let c=MP(s,l),d=a&&a!=="/"&&a.endsWith("/"),f=(i||a===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||f)&&(c.pathname+="/"),c}var Es=t=>t.join("/").replace(/\/\/+/g,"/"),UP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),$P=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,BP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function zP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var vS=["POST","PUT","PATCH","DELETE"];new Set(vS);var qP=["GET",...vS];new Set(qP);var ll=w.createContext(null);ll.displayName="DataRouter";var af=w.createContext(null);af.displayName="DataRouterState";w.createContext(!1);var _S=w.createContext({isTransitioning:!1});_S.displayName="ViewTransition";var HP=w.createContext(new Map);HP.displayName="Fetchers";var WP=w.createContext(null);WP.displayName="Await";var Br=w.createContext(null);Br.displayName="Navigation";var ou=w.createContext(null);ou.displayName="Location";var zr=w.createContext({outlet:null,matches:[],isDataRoute:!1});zr.displayName="Route";var $y=w.createContext(null);$y.displayName="RouteError";function GP(t,{relative:e}={}){jt(cl(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=w.useContext(Br),{hash:s,pathname:i,search:a}=au(t,{relative:e}),l=i;return n!=="/"&&(l=i==="/"?n:Es([n,i])),r.createHref({pathname:l,search:a,hash:s})}function cl(){return w.useContext(ou)!=null}function Bn(){return jt(cl(),"useLocation() may be used only in the context of a <Router> component."),w.useContext(ou).location}var xS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function bS(t){w.useContext(Br).static||w.useLayoutEffect(t)}function cs(){let{isDataRoute:t}=w.useContext(zr);return t?aR():KP()}function KP(){jt(cl(),"useNavigate() may be used only in the context of a <Router> component.");let t=w.useContext(ll),{basename:e,navigator:n}=w.useContext(Br),{matches:r}=w.useContext(zr),{pathname:s}=Bn(),i=JSON.stringify(Fy(r)),a=w.useRef(!1);return bS(()=>{a.current=!0}),w.useCallback((c,d={})=>{if(wr(a.current,xS),!a.current)return;if(typeof c=="number"){n.go(c);return}let f=Uy(c,JSON.parse(i),s,d.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Es([e,f.pathname])),(d.replace?n.replace:n.push)(f,d.state,d)},[e,n,i,s,t])}w.createContext(null);function QP(){let{matches:t}=w.useContext(zr),e=t[t.length-1];return e?e.params:{}}function au(t,{relative:e}={}){let{matches:n}=w.useContext(zr),{pathname:r}=Bn(),s=JSON.stringify(Fy(n));return w.useMemo(()=>Uy(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function YP(t,e){return wS(t,e)}function wS(t,e,n,r,s){var E;jt(cl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=w.useContext(Br),{matches:a}=w.useContext(zr),l=a[a.length-1],c=l?l.params:{},d=l?l.pathname:"/",f=l?l.pathnameBase:"/",h=l&&l.route;{let S=h&&h.path||"";ES(d,!h||S.endsWith("*")||S.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${S}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${S}"> to <Route path="${S==="/"?"*":`${S}/*`}">.`)}let p=Bn(),x;if(e){let S=typeof e=="string"?al(e):e;jt(f==="/"||((E=S.pathname)==null?void 0:E.startsWith(f)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${S.pathname}" was given in the \`location\` prop.`),x=S}else x=p;let T=x.pathname||"/",C=T;if(f!=="/"){let S=f.replace(/^\//,"").split("/");C="/"+T.replace(/^\//,"").split("/").slice(S.length).join("/")}let N=mS(t,{pathname:C});wr(h||N!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),wr(N==null||N[N.length-1].route.element!==void 0||N[N.length-1].route.Component!==void 0||N[N.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let _=tR(N&&N.map(S=>Object.assign({},S,{params:Object.assign({},c,S.params),pathname:Es([f,i.encodeLocation?i.encodeLocation(S.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?f:Es([f,i.encodeLocation?i.encodeLocation(S.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:S.pathnameBase])})),a,n,r,s);return e&&_?w.createElement(ou.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},_):_}function XP(){let t=oR(),e=zP(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",t),a=w.createElement(w.Fragment,null,w.createElement("p",null," Hey developer "),w.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",w.createElement("code",{style:i},"ErrorBoundary")," or"," ",w.createElement("code",{style:i},"errorElement")," prop on your route.")),w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},e),n?w.createElement("pre",{style:s},n):null,a)}var JP=w.createElement(XP,null),ZP=class extends w.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?w.createElement(zr.Provider,{value:this.props.routeContext},w.createElement($y.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function eR({routeContext:t,match:e,children:n}){let r=w.useContext(ll);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),w.createElement(zr.Provider,{value:t},n)}function tR(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,a=n==null?void 0:n.errors;if(a!=null){let f=i.findIndex(h=>h.route.id&&(a==null?void 0:a[h.route.id])!==void 0);jt(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),i=i.slice(0,Math.min(i.length,f+1))}let l=!1,c=-1;if(n)for(let f=0;f<i.length;f++){let h=i[f];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=f),h.route.id){let{loaderData:p,errors:x}=n,T=h.route.loader&&!p.hasOwnProperty(h.route.id)&&(!x||x[h.route.id]===void 0);if(h.route.lazy||T){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}let d=n&&r?(f,h)=>{var p,x;r(f,{location:n.location,params:((x=(p=n.matches)==null?void 0:p[0])==null?void 0:x.params)??{},errorInfo:h})}:void 0;return i.reduceRight((f,h,p)=>{let x,T=!1,C=null,N=null;n&&(x=a&&h.route.id?a[h.route.id]:void 0,C=h.route.errorElement||JP,l&&(c<0&&p===0?(ES("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),T=!0,N=null):c===p&&(T=!0,N=h.route.hydrateFallbackElement||null)));let _=e.concat(i.slice(0,p+1)),E=()=>{let S;return x?S=C:T?S=N:h.route.Component?S=w.createElement(h.route.Component,null):h.route.element?S=h.route.element:S=f,w.createElement(eR,{match:h,routeContext:{outlet:f,matches:_,isDataRoute:n!=null},children:S})};return n&&(h.route.ErrorBoundary||h.route.errorElement||p===0)?w.createElement(ZP,{location:n.location,revalidation:n.revalidation,component:C,error:x,children:E(),routeContext:{outlet:null,matches:_,isDataRoute:!0},onError:d}):E()},null)}function By(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nR(t){let e=w.useContext(ll);return jt(e,By(t)),e}function rR(t){let e=w.useContext(af);return jt(e,By(t)),e}function sR(t){let e=w.useContext(zr);return jt(e,By(t)),e}function zy(t){let e=sR(t),n=e.matches[e.matches.length-1];return jt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function iR(){return zy("useRouteId")}function oR(){var r;let t=w.useContext($y),e=rR("useRouteError"),n=zy("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function aR(){let{router:t}=nR("useNavigate"),e=zy("useNavigate"),n=w.useRef(!1);return bS(()=>{n.current=!0}),w.useCallback(async(s,i={})=>{wr(n.current,xS),n.current&&(typeof s=="number"?t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var fb={};function ES(t,e,n){!e&&!fb[t]&&(fb[t]=!0,wr(!1,n))}w.memo(lR);function lR({routes:t,future:e,state:n,unstable_onError:r}){return wS(t,void 0,n,r,e)}function fh({to:t,replace:e,state:n,relative:r}){jt(cl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=w.useContext(Br);wr(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=w.useContext(zr),{pathname:a}=Bn(),l=cs(),c=Uy(t,Fy(i),a,r==="path"),d=JSON.stringify(c);return w.useEffect(()=>{l(JSON.parse(d),{replace:e,state:n,relative:r})},[l,d,r,e,n]),null}function ia(t){jt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function cR({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1}){jt(!cl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=w.useMemo(()=>({basename:a,navigator:s,static:i,future:{}}),[a,s,i]);typeof n=="string"&&(n=al(n));let{pathname:c="/",search:d="",hash:f="",state:h=null,key:p="default"}=n,x=w.useMemo(()=>{let T=js(c,a);return T==null?null:{location:{pathname:T,search:d,hash:f,state:h,key:p},navigationType:r}},[a,c,d,f,h,p,r]);return wr(x!=null,`<Router basename="${a}"> is not able to match the URL "${c}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),x==null?null:w.createElement(Br.Provider,{value:l},w.createElement(ou.Provider,{children:e,value:x}))}function uR({children:t,location:e}){return YP(ag(t),e)}function ag(t,e=[]){let n=[];return w.Children.forEach(t,(r,s)=>{if(!w.isValidElement(r))return;let i=[...e,s];if(r.type===w.Fragment){n.push.apply(n,ag(r.props.children,i));return}jt(r.type===ia,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),jt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=ag(r.props.children,i)),n.push(a)}),n}var wd="get",Ed="application/x-www-form-urlencoded";function lf(t){return t!=null&&typeof t.tagName=="string"}function dR(t){return lf(t)&&t.tagName.toLowerCase()==="button"}function hR(t){return lf(t)&&t.tagName.toLowerCase()==="form"}function fR(t){return lf(t)&&t.tagName.toLowerCase()==="input"}function pR(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function mR(t,e){return t.button===0&&(!e||e==="_self")&&!pR(t)}var Yu=null;function gR(){if(Yu===null)try{new FormData(document.createElement("form"),0),Yu=!1}catch{Yu=!0}return Yu}var yR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function kp(t){return t!=null&&!yR.has(t)?(wr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ed}"`),null):t}function vR(t,e){let n,r,s,i,a;if(hR(t)){let l=t.getAttribute("action");r=l?js(l,e):null,n=t.getAttribute("method")||wd,s=kp(t.getAttribute("enctype"))||Ed,i=new FormData(t)}else if(dR(t)||fR(t)&&(t.type==="submit"||t.type==="image")){let l=t.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||l.getAttribute("action");if(r=c?js(c,e):null,n=t.getAttribute("formmethod")||l.getAttribute("method")||wd,s=kp(t.getAttribute("formenctype"))||kp(l.getAttribute("enctype"))||Ed,i=new FormData(l,t),!gR()){let{name:d,type:f,value:h}=t;if(f==="image"){let p=d?`${d}.`:"";i.append(`${p}x`,"0"),i.append(`${p}y`,"0")}else d&&i.append(d,h)}}else{if(lf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=wd,r=null,s=Ed,a=t}return i&&s==="text/plain"&&(a=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function qy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function _R(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&js(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function xR(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function bR(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function wR(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let a=await xR(i,n);return a.links?a.links():[]}return[]}));return CR(r.flat(1).filter(bR).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function pb(t,e,n,r,s,i){let a=(c,d)=>n[d]?c.route.id!==n[d].route.id:!0,l=(c,d)=>{var f;return n[d].pathname!==c.pathname||((f=n[d].route.path)==null?void 0:f.endsWith("*"))&&n[d].params["*"]!==c.params["*"]};return i==="assets"?e.filter((c,d)=>a(c,d)||l(c,d)):i==="data"?e.filter((c,d)=>{var h;let f=r.routes[c.route.id];if(!f||!f.hasLoader)return!1;if(a(c,d)||l(c,d))return!0;if(c.route.shouldRevalidate){let p=c.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((h=n[0])==null?void 0:h.params)||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function ER(t,e,{includeHydrateFallback:n}={}){return IR(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function IR(t){return[...new Set(t)]}function SR(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function CR(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let i=JSON.stringify(SR(s));return n.has(i)||(n.add(i),r.push({key:i,link:s})),r},[])}function IS(){let t=w.useContext(ll);return qy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function TR(){let t=w.useContext(af);return qy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Hy=w.createContext(void 0);Hy.displayName="FrameworkContext";function SS(){let t=w.useContext(Hy);return qy(t,"You must render this element inside a <HydratedRouter> element"),t}function NR(t,e){let n=w.useContext(Hy),[r,s]=w.useState(!1),[i,a]=w.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:d,onMouseLeave:f,onTouchStart:h}=e,p=w.useRef(null);w.useEffect(()=>{if(t==="render"&&a(!0),t==="viewport"){let C=_=>{_.forEach(E=>{a(E.isIntersecting)})},N=new IntersectionObserver(C,{threshold:.5});return p.current&&N.observe(p.current),()=>{N.disconnect()}}},[t]),w.useEffect(()=>{if(r){let C=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(C)}}},[r]);let x=()=>{s(!0)},T=()=>{s(!1),a(!1)};return n?t!=="intent"?[i,p,{}]:[i,p,{onFocus:Ll(l,x),onBlur:Ll(c,T),onMouseEnter:Ll(d,x),onMouseLeave:Ll(f,T),onTouchStart:Ll(h,x)}]:[!1,p,{}]}function Ll(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function jR({page:t,...e}){let{router:n}=IS(),r=w.useMemo(()=>mS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?w.createElement(PR,{page:t,matches:r,...e}):null}function AR(t){let{manifest:e,routeModules:n}=SS(),[r,s]=w.useState([]);return w.useEffect(()=>{let i=!1;return wR(t,e,n).then(a=>{i||s(a)}),()=>{i=!0}},[t,e,n]),r}function PR({page:t,matches:e,...n}){let r=Bn(),{manifest:s,routeModules:i}=SS(),{basename:a}=IS(),{loaderData:l,matches:c}=TR(),d=w.useMemo(()=>pb(t,e,c,s,r,"data"),[t,e,c,s,r]),f=w.useMemo(()=>pb(t,e,c,s,r,"assets"),[t,e,c,s,r]),h=w.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let T=new Set,C=!1;if(e.forEach(_=>{var S;let E=s.routes[_.route.id];!E||!E.hasLoader||(!d.some(I=>I.route.id===_.route.id)&&_.route.id in l&&((S=i[_.route.id])!=null&&S.shouldRevalidate)||E.hasClientLoader?C=!0:T.add(_.route.id))}),T.size===0)return[];let N=_R(t,a,"data");return C&&T.size>0&&N.searchParams.set("_routes",e.filter(_=>T.has(_.route.id)).map(_=>_.route.id).join(",")),[N.pathname+N.search]},[a,l,r,s,d,e,t,i]),p=w.useMemo(()=>ER(f,s),[f,s]),x=AR(f);return w.createElement(w.Fragment,null,h.map(T=>w.createElement("link",{key:T,rel:"prefetch",as:"fetch",href:T,...n})),p.map(T=>w.createElement("link",{key:T,rel:"modulepreload",href:T,...n})),x.map(({key:T,link:C})=>w.createElement("link",{key:T,nonce:n.nonce,...C})))}function RR(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var CS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{CS&&(window.__reactRouterVersion="7.9.6")}catch{}function kR({basename:t,children:e,window:n}){let r=w.useRef();r.current==null&&(r.current=_P({window:n,v5Compat:!0}));let s=r.current,[i,a]=w.useState({action:s.action,location:s.location}),l=w.useCallback(c=>{w.startTransition(()=>a(c))},[a]);return w.useLayoutEffect(()=>s.listen(l),[s,l]),w.createElement(cR,{basename:t,children:e,location:i.location,navigationType:i.action,navigator:s})}var TS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,NS=w.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:a,state:l,target:c,to:d,preventScrollReset:f,viewTransition:h,...p},x){let{basename:T}=w.useContext(Br),C=typeof d=="string"&&TS.test(d),N,_=!1;if(typeof d=="string"&&C&&(N=d,CS))try{let b=new URL(window.location.href),P=d.startsWith("//")?new URL(b.protocol+d):new URL(d),R=js(P.pathname,T);P.origin===b.origin&&R!=null?d=R+P.search+P.hash:_=!0}catch{wr(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let E=GP(d,{relative:s}),[S,I,L]=NR(r,p),V=OR(d,{replace:a,state:l,target:c,preventScrollReset:f,relative:s,viewTransition:h});function g(b){e&&e(b),b.defaultPrevented||V(b)}let v=w.createElement("a",{...p,...L,href:N||E,onClick:_||i?e:g,ref:RR(x,I),target:c,"data-discover":!C&&n==="render"?"true":void 0});return S&&!C?w.createElement(w.Fragment,null,v,w.createElement(jR,{page:E})):v});NS.displayName="Link";var oa=w.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:a,viewTransition:l,children:c,...d},f){let h=au(a,{relative:d.relative}),p=Bn(),x=w.useContext(af),{navigator:T,basename:C}=w.useContext(Br),N=x!=null&&$R(h)&&l===!0,_=T.encodeLocation?T.encodeLocation(h).pathname:h.pathname,E=p.pathname,S=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;n||(E=E.toLowerCase(),S=S?S.toLowerCase():null,_=_.toLowerCase()),S&&C&&(S=js(S,C)||S);const I=_!=="/"&&_.endsWith("/")?_.length-1:_.length;let L=E===_||!s&&E.startsWith(_)&&E.charAt(I)==="/",V=S!=null&&(S===_||!s&&S.startsWith(_)&&S.charAt(_.length)==="/"),g={isActive:L,isPending:V,isTransitioning:N},v=L?e:void 0,b;typeof r=="function"?b=r(g):b=[r,L?"active":null,V?"pending":null,N?"transitioning":null].filter(Boolean).join(" ");let P=typeof i=="function"?i(g):i;return w.createElement(NS,{...d,"aria-current":v,className:b,ref:f,style:P,to:a,viewTransition:l},typeof c=="function"?c(g):c)});oa.displayName="NavLink";var DR=w.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:a=wd,action:l,onSubmit:c,relative:d,preventScrollReset:f,viewTransition:h,...p},x)=>{let T=FR(),C=UR(l,{relative:d}),N=a.toLowerCase()==="get"?"get":"post",_=typeof l=="string"&&TS.test(l),E=S=>{if(c&&c(S),S.defaultPrevented)return;S.preventDefault();let I=S.nativeEvent.submitter,L=(I==null?void 0:I.getAttribute("formmethod"))||a;T(I||S.currentTarget,{fetcherKey:e,method:L,navigate:n,replace:s,state:i,relative:d,preventScrollReset:f,viewTransition:h})};return w.createElement("form",{ref:x,method:N,action:C,onSubmit:r?c:E,...p,"data-discover":!_&&t==="render"?"true":void 0})});DR.displayName="Form";function LR(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function jS(t){let e=w.useContext(ll);return jt(e,LR(t)),e}function OR(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:a}={}){let l=cs(),c=Bn(),d=au(t,{relative:i});return w.useCallback(f=>{if(mR(f,e)){f.preventDefault();let h=n!==void 0?n:Uc(c)===Uc(d);l(t,{replace:h,state:r,preventScrollReset:s,relative:i,viewTransition:a})}},[c,l,d,n,r,e,t,s,i,a])}var VR=0,MR=()=>`__${String(++VR)}__`;function FR(){let{router:t}=jS("useSubmit"),{basename:e}=w.useContext(Br),n=iR();return w.useCallback(async(r,s={})=>{let{action:i,method:a,encType:l,formData:c,body:d}=vR(r,e);if(s.navigate===!1){let f=s.fetcherKey||MR();await t.fetch(f,n,s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||a,formEncType:s.encType||l,flushSync:s.flushSync})}else await t.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||a,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:n,flushSync:s.flushSync,viewTransition:s.viewTransition})},[t,e,n])}function UR(t,{relative:e}={}){let{basename:n}=w.useContext(Br),r=w.useContext(zr);jt(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...au(t||".",{relative:e})},a=Bn();if(t==null){i.search=a.search;let l=new URLSearchParams(i.search),c=l.getAll("index");if(c.some(f=>f==="")){l.delete("index"),c.filter(h=>h).forEach(h=>l.append("index",h));let f=l.toString();i.search=f?`?${f}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:Es([n,i.pathname])),Uc(i)}function $R(t,{relative:e}={}){let n=w.useContext(_S);jt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=jS("useViewTransitionState"),s=au(t,{relative:e});if(!n.isTransitioning)return!1;let i=js(n.currentLocation.pathname,r)||n.currentLocation.pathname,a=js(n.nextLocation.pathname,r)||n.nextLocation.pathname;return hh(s.pathname,a)!=null||hh(s.pathname,i)!=null}const BR=()=>{};var mb={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AS=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},zR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],a=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],a=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},PS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],a=s+1<t.length,l=a?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,f=i>>2,h=(i&3)<<4|l>>4;let p=(l&15)<<2|d>>6,x=d&63;c||(x=64,a||(p=64)),r.push(n[f],n[h],n[p],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(AS(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):zR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||h==null)throw new qR;const p=i<<2|l>>4;if(r.push(p),d!==64){const x=l<<4&240|d>>2;if(r.push(x),h!==64){const T=d<<6&192|h;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class qR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const HR=function(t){const e=AS(t);return PS.encodeByteArray(e,!0)},ph=function(t){return HR(t).replace(/\./g,"")},RS=function(t){try{return PS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WR=()=>kS().__FIREBASE_DEFAULTS__,GR=()=>{if(typeof process>"u"||typeof mb>"u")return;const t=mb.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},KR=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&RS(t[1]);return e&&JSON.parse(e)},cf=()=>{try{return BR()||WR()||GR()||KR()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},DS=t=>{var e,n;return(n=(e=cf())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},LS=t=>{const e=DS(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},OS=()=>{var t;return(t=cf())==null?void 0:t.config},VS=t=>{var e;return(e=cf())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ki(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Wy(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MS(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[ph(JSON.stringify(n)),ph(JSON.stringify(a)),""].join(".")}const fc={};function YR(){const t={prod:[],emulator:[]};for(const e of Object.keys(fc))fc[e]?t.emulator.push(e):t.prod.push(e);return t}function XR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let gb=!1;function Gy(t,e){if(typeof window>"u"||typeof document>"u"||!ki(window.location.host)||fc[t]===e||fc[t]||gb)return;fc[t]=e;function n(p){return`__firebase__banner__${p}`}const r="__firebase__banner",i=YR().prod.length>0;function a(){const p=document.getElementById(r);p&&p.remove()}function l(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function c(p,x){p.setAttribute("width","24"),p.setAttribute("id",x),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function d(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{gb=!0,a()},p}function f(p,x){p.setAttribute("id",x),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function h(){const p=XR(r),x=n("text"),T=document.getElementById(x)||document.createElement("span"),C=n("learnmore"),N=document.getElementById(C)||document.createElement("a"),_=n("preprendIcon"),E=document.getElementById(_)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const S=p.element;l(S),f(N,C);const I=d();c(E,_),S.append(E,T,N,I),document.body.appendChild(S)}i?(T.innerText="Preview backend disconnected.",E.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(E.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,T.innerText="Preview backend running in this workspace."),T.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function JR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(tn())}function FS(){var e;const t=(e=cf())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function ZR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function US(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function ek(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function tk(){const t=tn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function $S(){return!FS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function BS(){return!FS()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Ky(){try{return typeof indexedDB=="object"}catch{return!1}}function zS(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}function nk(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rk="FirebaseError";class Ir extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=rk,Object.setPrototypeOf(this,Ir.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Mo.prototype.create)}}class Mo{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?sk(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new Ir(s,l,r)}}function sk(t,e){return t.replace(ik,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const ik=/\{\$([^}]+)}/g;function ok(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function As(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],a=e[s];if(yb(i)&&yb(a)){if(!As(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function yb(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ql(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Yl(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function ak(t,e){const n=new lk(t,e);return n.subscribe.bind(n)}class lk{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");ck(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Dp),s.error===void 0&&(s.error=Dp),s.complete===void 0&&(s.complete=Dp);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ck(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Dp(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uk=1e3,dk=2,hk=4*60*60*1e3,fk=.5;function vb(t,e=uk,n=dk){const r=e*Math.pow(n,t),s=Math.round(fk*r*(Math.random()-.5)*2);return Math.min(hk,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ht(t){return t&&t._delegate?t._delegate:t}class Er{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new QR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(gk(e))try{this.getOrInitializeService({instanceIdentifier:Gi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Gi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Gi){return this.instances.has(e)}getOptions(e=Gi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:mk(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Gi){return this.component?this.component.multipleInstances?e:Gi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function mk(t){return t===Gi?void 0:t}function gk(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new pk(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(tt||(tt={}));const vk={debug:tt.DEBUG,verbose:tt.VERBOSE,info:tt.INFO,warn:tt.WARN,error:tt.ERROR,silent:tt.SILENT},_k=tt.INFO,xk={[tt.DEBUG]:"log",[tt.VERBOSE]:"log",[tt.INFO]:"info",[tt.WARN]:"warn",[tt.ERROR]:"error"},bk=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=xk[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class uf{constructor(e){this.name=e,this._logLevel=_k,this._logHandler=bk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in tt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?vk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,tt.DEBUG,...e),this._logHandler(this,tt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,tt.VERBOSE,...e),this._logHandler(this,tt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,tt.INFO,...e),this._logHandler(this,tt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,tt.WARN,...e),this._logHandler(this,tt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,tt.ERROR,...e),this._logHandler(this,tt.ERROR,...e)}}const wk=(t,e)=>e.some(n=>t instanceof n);let _b,xb;function Ek(){return _b||(_b=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ik(){return xb||(xb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qS=new WeakMap,lg=new WeakMap,HS=new WeakMap,Lp=new WeakMap,Qy=new WeakMap;function Sk(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(yi(t.result)),s()},a=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&qS.set(n,t)}).catch(()=>{}),Qy.set(e,t),e}function Ck(t){if(lg.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});lg.set(t,e)}let cg={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return lg.get(t);if(e==="objectStoreNames")return t.objectStoreNames||HS.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return yi(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Tk(t){cg=t(cg)}function Nk(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Op(this),e,...n);return HS.set(r,e.sort?e.sort():[e]),yi(r)}:Ik().includes(t)?function(...e){return t.apply(Op(this),e),yi(qS.get(this))}:function(...e){return yi(t.apply(Op(this),e))}}function jk(t){return typeof t=="function"?Nk(t):(t instanceof IDBTransaction&&Ck(t),wk(t,Ek())?new Proxy(t,cg):t)}function yi(t){if(t instanceof IDBRequest)return Sk(t);if(Lp.has(t))return Lp.get(t);const e=jk(t);return e!==t&&(Lp.set(t,e),Qy.set(e,t)),e}const Op=t=>Qy.get(t);function WS(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),l=yi(a);return r&&a.addEventListener("upgradeneeded",c=>{r(yi(a.result),c.oldVersion,c.newVersion,yi(a.transaction),c)}),n&&a.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const Ak=["get","getKey","getAll","getAllKeys","count"],Pk=["put","add","delete","clear"],Vp=new Map;function bb(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Vp.get(e))return Vp.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=Pk.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Ak.includes(n)))return;const i=async function(a,...l){const c=this.transaction(a,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return Vp.set(e,i),i}Tk(t=>({...t,get:(e,n,r)=>bb(e,n)||t.get(e,n,r),has:(e,n)=>!!bb(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rk{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(kk(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function kk(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ug="@firebase/app",wb="0.14.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ps=new uf("@firebase/app"),Dk="@firebase/app-compat",Lk="@firebase/analytics-compat",Ok="@firebase/analytics",Vk="@firebase/app-check-compat",Mk="@firebase/app-check",Fk="@firebase/auth",Uk="@firebase/auth-compat",$k="@firebase/database",Bk="@firebase/data-connect",zk="@firebase/database-compat",qk="@firebase/functions",Hk="@firebase/functions-compat",Wk="@firebase/installations",Gk="@firebase/installations-compat",Kk="@firebase/messaging",Qk="@firebase/messaging-compat",Yk="@firebase/performance",Xk="@firebase/performance-compat",Jk="@firebase/remote-config",Zk="@firebase/remote-config-compat",eD="@firebase/storage",tD="@firebase/storage-compat",nD="@firebase/firestore",rD="@firebase/ai",sD="@firebase/firestore-compat",iD="firebase",oD="12.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dg="[DEFAULT]",aD={[ug]:"fire-core",[Dk]:"fire-core-compat",[Ok]:"fire-analytics",[Lk]:"fire-analytics-compat",[Mk]:"fire-app-check",[Vk]:"fire-app-check-compat",[Fk]:"fire-auth",[Uk]:"fire-auth-compat",[$k]:"fire-rtdb",[Bk]:"fire-data-connect",[zk]:"fire-rtdb-compat",[qk]:"fire-fn",[Hk]:"fire-fn-compat",[Wk]:"fire-iid",[Gk]:"fire-iid-compat",[Kk]:"fire-fcm",[Qk]:"fire-fcm-compat",[Yk]:"fire-perf",[Xk]:"fire-perf-compat",[Jk]:"fire-rc",[Zk]:"fire-rc-compat",[eD]:"fire-gcs",[tD]:"fire-gcs-compat",[nD]:"fire-fst",[sD]:"fire-fst-compat",[rD]:"fire-vertex","fire-js":"fire-js",[iD]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh=new Map,lD=new Map,hg=new Map;function Eb(t,e){try{t.container.addComponent(e)}catch(n){Ps.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Fr(t){const e=t.name;if(hg.has(e))return Ps.debug(`There were multiple attempts to register component ${e}.`),!1;hg.set(e,t);for(const n of mh.values())Eb(n,t);for(const n of lD.values())Eb(n,t);return!0}function Di(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function pr(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vi=new Mo("app","Firebase",cD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Er("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fo=oD;function Yy(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:dg,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw vi.create("bad-app-name",{appName:String(s)});if(n||(n=OS()),!n)throw vi.create("no-options");const i=mh.get(s);if(i){if(As(n,i.options)&&As(r,i.config))return i;throw vi.create("duplicate-app",{appName:s})}const a=new yk(s);for(const c of hg.values())a.addComponent(c);const l=new uD(n,r,a);return mh.set(s,l),l}function df(t=dg){const e=mh.get(t);if(!e&&t===dg&&OS())return Yy();if(!e)throw vi.create("no-app",{appName:t});return e}function Xn(t,e,n){let r=aD[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ps.warn(a.join(" "));return}Fr(new Er(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dD="firebase-heartbeat-database",hD=1,$c="firebase-heartbeat-store";let Mp=null;function GS(){return Mp||(Mp=WS(dD,hD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore($c)}catch(n){console.warn(n)}}}}).catch(t=>{throw vi.create("idb-open",{originalErrorMessage:t.message})})),Mp}async function fD(t){try{const n=(await GS()).transaction($c),r=await n.objectStore($c).get(KS(t));return await n.done,r}catch(e){if(e instanceof Ir)Ps.warn(e.message);else{const n=vi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ps.warn(n.message)}}}async function Ib(t,e){try{const r=(await GS()).transaction($c,"readwrite");await r.objectStore($c).put(e,KS(t)),await r.done}catch(n){if(n instanceof Ir)Ps.warn(n.message);else{const r=vi.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Ps.warn(r.message)}}}function KS(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pD=1024,mD=30;class gD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new vD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Sb();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>mD){const a=_D(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ps.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Sb(),{heartbeatsToSend:r,unsentEntries:s}=yD(this._heartbeatsCache.heartbeats),i=ph(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Ps.warn(n),""}}}function Sb(){return new Date().toISOString().substring(0,10)}function yD(t,e=pD){const n=[];let r=t.slice();for(const s of t){const i=n.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Cb(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Cb(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class vD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ky()?zS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await fD(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ib(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ib(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function Cb(t){return ph(JSON.stringify({version:2,heartbeats:t})).length}function _D(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xD(t){Fr(new Er("platform-logger",e=>new Rk(e),"PRIVATE")),Fr(new Er("heartbeat",e=>new gD(e),"PRIVATE")),Xn(ug,wb,t),Xn(ug,wb,"esm2020"),Xn("fire-js","")}xD("");var bD="firebase",wD="12.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xn(bD,wD,"app");function QS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ED=QS,YS=new Mo("auth","Firebase",QS());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gh=new uf("@firebase/auth");function ID(t,...e){gh.logLevel<=tt.WARN&&gh.warn(`Auth (${Fo}): ${t}`,...e)}function Id(t,...e){gh.logLevel<=tt.ERROR&&gh.error(`Auth (${Fo}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ur(t,...e){throw Xy(t,...e)}function ss(t,...e){return Xy(t,...e)}function XS(t,e,n){const r={...ED(),[e]:n};return new Mo("auth","Firebase",r).create(e,{appName:t.name})}function _i(t){return XS(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Xy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return YS.create(t,...e)}function Oe(t,e,...n){if(!t)throw Xy(e,...n)}function _s(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Id(e),new Error(e)}function Rs(t,e){t||_s(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fg(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function SD(){return Tb()==="http:"||Tb()==="https:"}function Tb(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(SD()||US()||"connection"in navigator)?navigator.onLine:!0}function TD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{constructor(e,n){this.shortDelay=e,this.longDelay=n,Rs(n>e,"Short delay should be less than long delay!"),this.isMobile=JR()||ek()}get(){return CD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jy(t,e){Rs(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;_s("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;_s("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;_s("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ND={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],AD=new cu(3e4,6e4);function Uo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Li(t,e,n,r,s={}){return ZS(t,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=lu({key:t.config.apiKey,...a}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return ZR()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&ki(t.emulatorConfig.host)&&(d.credentials="include"),JS.fetch()(await eC(t,t.config.apiHost,n,l),d)})}async function ZS(t,e,n){t._canInitEmulator=!1;const r={...ND,...e};try{const s=new RD(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Xu(t,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Xu(t,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw Xu(t,"email-already-in-use",a);if(c==="USER_DISABLED")throw Xu(t,"user-disabled",a);const f=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw XS(t,f,d);Ur(t,f)}}catch(s){if(s instanceof Ir)throw s;Ur(t,"network-request-failed",{message:String(s)})}}async function hf(t,e,n,r,s={}){const i=await Li(t,e,n,r,s);return"mfaPendingCredential"in i&&Ur(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function eC(t,e,n,r){const s=`${e}${n}?${r}`,i=t,a=i.config.emulator?Jy(t.config,s):`${t.config.apiScheme}://${s}`;return jD.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function PD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class RD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(ss(this.auth,"network-request-failed")),AD.get())})}}function Xu(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=ss(t,e,r);return s.customData._tokenResponse=n,s}function Nb(t){return t!==void 0&&t.enterprise!==void 0}class kD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return PD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function DD(t,e){return Li(t,"GET","/v2/recaptchaConfig",Uo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LD(t,e){return Li(t,"POST","/v1/accounts:delete",e)}async function yh(t,e){return Li(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function OD(t,e=!1){const n=ht(t),r=await n.getIdToken(e),s=Zy(r);Oe(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:pc(Fp(s.auth_time)),issuedAtTime:pc(Fp(s.iat)),expirationTime:pc(Fp(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Fp(t){return Number(t)*1e3}function Zy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Id("JWT malformed, contained fewer than 3 sections"),null;try{const s=RS(n);return s?JSON.parse(s):(Id("Failed to decode base64 JWT payload"),null)}catch(s){return Id("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function jb(t){const e=Zy(t);return Oe(e,"internal-error"),Oe(typeof e.exp<"u","internal-error"),Oe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ir&&VD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function VD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pg{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=pc(this.lastLoginAt),this.creationTime=pc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vh(t){var h;const e=t.auth,n=await t.getIdToken(),r=await Bc(t,yh(e,{idToken:n}));Oe(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?tC(s.providerUserInfo):[],a=UD(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new pg(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,f)}async function FD(t){const e=ht(t);await vh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function UD(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function tC(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $D(t,e){const n=await ZS(t,{},async()=>{const r=lu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,a=await eC(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&ki(t.emulatorConfig.host)&&(c.credentials="include"),JS.fetch()(a,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function BD(t,e){return Li(t,"POST","/v2/accounts:revokeToken",Uo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Oe(e.idToken,"internal-error"),Oe(typeof e.idToken<"u","internal-error"),Oe(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):jb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Oe(e.length!==0,"internal-error");const n=jb(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Oe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await $D(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,a=new Aa;return r&&(Oe(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(Oe(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(Oe(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Aa,this.toJSON())}_performRefresh(){return _s("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qs(t,e){Oe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Dr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new MD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new pg(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Bc(this,this.stsTokenManager.getToken(this.auth,e));return Oe(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return OD(this,e)}reload(){return FD(this)}_assign(e){this!==e&&(Oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Dr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await vh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(pr(this.auth.app))return Promise.reject(_i(this.auth));const e=await this.getIdToken();return await Bc(this,LD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,a=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,f=n.lastLoginAt??void 0,{uid:h,emailVerified:p,isAnonymous:x,providerData:T,stsTokenManager:C}=n;Oe(h&&C,e,"internal-error");const N=Aa.fromJSON(this.name,C);Oe(typeof h=="string",e,"internal-error"),qs(r,e.name),qs(s,e.name),Oe(typeof p=="boolean",e,"internal-error"),Oe(typeof x=="boolean",e,"internal-error"),qs(i,e.name),qs(a,e.name),qs(l,e.name),qs(c,e.name),qs(d,e.name),qs(f,e.name);const _=new Dr({uid:h,auth:e,email:s,emailVerified:p,displayName:r,isAnonymous:x,photoURL:a,phoneNumber:i,tenantId:l,stsTokenManager:N,createdAt:d,lastLoginAt:f});return T&&Array.isArray(T)&&(_.providerData=T.map(E=>({...E}))),c&&(_._redirectEventId=c),_}static async _fromIdTokenResponse(e,n,r=!1){const s=new Aa;s.updateFromServerResponse(n);const i=new Dr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await vh(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Oe(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?tC(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new Aa;l.updateFromIdToken(r);const c=new Dr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new pg(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ab=new Map;function xs(t){Rs(t instanceof Function,"Expected a class definition");let e=Ab.get(t);return e?(Rs(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Ab.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nC{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}nC.type="NONE";const Pb=nC;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sd(t,e,n){return`firebase:${t}:${e}:${n}`}class Pa{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Sd(this.userKey,s.apiKey,i),this.fullPersistenceKey=Sd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await yh(this.auth,{idToken:e}).catch(()=>{});return n?Dr._fromGetAccountInfoResponse(this.auth,n,e):null}return Dr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Pa(xs(Pb),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||xs(Pb);const a=Sd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const f=await d._get(a);if(f){let h;if(typeof f=="string"){const p=await yh(e,{idToken:f}).catch(()=>{});if(!p)break;h=await Dr._fromGetAccountInfoResponse(e,p,f)}else h=Dr._fromJSON(e,f);d!==i&&(l=h),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Pa(i,e,r):(i=c[0],l&&await i._set(a,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new Pa(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rb(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(oC(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(rC(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(lC(e))return"Blackberry";if(cC(e))return"Webos";if(sC(e))return"Safari";if((e.includes("chrome/")||iC(e))&&!e.includes("edge/"))return"Chrome";if(aC(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function rC(t=tn()){return/firefox\//i.test(t)}function sC(t=tn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function iC(t=tn()){return/crios\//i.test(t)}function oC(t=tn()){return/iemobile/i.test(t)}function aC(t=tn()){return/android/i.test(t)}function lC(t=tn()){return/blackberry/i.test(t)}function cC(t=tn()){return/webos/i.test(t)}function ev(t=tn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function zD(t=tn()){var e;return ev(t)&&!!((e=window.navigator)!=null&&e.standalone)}function qD(){return tk()&&document.documentMode===10}function uC(t=tn()){return ev(t)||aC(t)||cC(t)||lC(t)||/windows phone/i.test(t)||oC(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dC(t,e=[]){let n;switch(t){case"Browser":n=Rb(tn());break;case"Worker":n=`${Rb(tn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Fo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((a,l)=>{try{const c=e(i);a(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WD(t,e={}){return Li(t,"GET","/v2/passwordPolicy",Uo(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GD=6;class KD{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??GD,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QD{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new kb(this),this.idTokenSubscription=new kb(this),this.beforeStateQueue=new HD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=YS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=xs(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Pa.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await yh(this,{idToken:e}),r=await Dr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(pr(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(a){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Oe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await vh(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=TD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(pr(this.app))return Promise.reject(_i(this));const n=e?ht(e):null;return n&&Oe(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return pr(this.app)?Promise.reject(_i(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return pr(this.app)?Promise.reject(_i(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(xs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await WD(this),n=new KD(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Mo("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await BD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&xs(e)||this._popupRedirectResolver;Oe(n,this,"argument-error"),this.redirectPersistenceManager=await Pa.create(this,[xs(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Oe(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{a=!0,c()}}else{const c=e.addObserver(n);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=dC(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(pr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&ID(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function ul(t){return ht(t)}class kb{constructor(e){this.auth=e,this.observer=null,this.addObserver=ak(n=>this.observer=n)}get next(){return Oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ff={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function YD(t){ff=t}function hC(t){return ff.loadJS(t)}function XD(){return ff.recaptchaEnterpriseScript}function JD(){return ff.gapiScript}function ZD(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class e2{constructor(){this.enterprise=new t2}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class t2{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const n2="recaptcha-enterprise",fC="NO_RECAPTCHA";class r2{constructor(e){this.type=n2,this.auth=ul(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{DD(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new kD(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,a,l){const c=window.grecaptcha;Nb(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(fC)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new e2().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(l=>{if(!n&&Nb(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=XD();c.length!==0&&(c+=l),hC(c).then(()=>{s(l,i,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function Db(t,e,n,r=!1,s=!1){const i=new r2(t);let a;if(s)a=fC;else try{a=await i.verify(n)}catch{a=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Lb(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Db(t,e,n,n==="getOobCode");return r(t,a)}else return r(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Db(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(t,e){const n=Di(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(As(i,e??{}))return s;Ur(s,"already-initialized")}return n.initialize({options:e})}function i2(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(xs);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function o2(t,e,n){const r=ul(t);Oe(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=pC(e),{host:a,port:l}=a2(e),c=l===null?"":`:${l}`,d={url:`${i}//${a}${c}/`},f=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Oe(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Oe(As(d,r.config.emulator)&&As(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,ki(a)?(Wy(`${i}//${a}${c}`),Gy("Auth",!0)):l2()}function pC(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function a2(t){const e=pC(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Ob(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Ob(a)}}}function Ob(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function l2(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return _s("not implemented")}_getIdTokenResponse(e){return _s("not implemented")}_linkToIdToken(e,n){return _s("not implemented")}_getReauthenticationResolver(e){return _s("not implemented")}}async function c2(t,e){return Li(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u2(t,e){return hf(t,"POST","/v1/accounts:signInWithPassword",Uo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d2(t,e){return hf(t,"POST","/v1/accounts:signInWithEmailLink",Uo(t,e))}async function h2(t,e){return hf(t,"POST","/v1/accounts:signInWithEmailLink",Uo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zc extends tv{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new zc(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new zc(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Lb(e,n,"signInWithPassword",u2);case"emailLink":return d2(e,{email:this._email,oobCode:this._password});default:Ur(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Lb(e,r,"signUpPassword",c2);case"emailLink":return h2(e,{idToken:n,email:this._email,oobCode:this._password});default:Ur(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ra(t,e){return hf(t,"POST","/v1/accounts:signInWithIdp",Uo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f2="http://localhost";class xo extends tv{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new xo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Ur("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const a=new xo(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return Ra(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Ra(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Ra(e,n)}buildRequest(){const e={requestUri:f2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=lu(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p2(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function m2(t){const e=Ql(Yl(t)).link,n=e?Ql(Yl(e)).deep_link_id:null,r=Ql(Yl(t)).deep_link_id;return(r?Ql(Yl(r)).link:null)||r||n||e||t}class nv{constructor(e){const n=Ql(Yl(e)),r=n.apiKey??null,s=n.oobCode??null,i=p2(n.mode??null);Oe(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=m2(e);try{return new nv(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dl{constructor(){this.providerId=dl.PROVIDER_ID}static credential(e,n){return zc._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=nv.parseLink(n);return Oe(r,"argument-error"),zc._fromEmailAndCode(e,r.code,r.tenantId)}}dl.PROVIDER_ID="password";dl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";dl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uu extends mC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs extends uu{constructor(){super("facebook.com")}static credential(e){return xo._fromParams({providerId:Zs.PROVIDER_ID,signInMethod:Zs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zs.credentialFromTaggedObject(e)}static credentialFromError(e){return Zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zs.credential(e.oauthAccessToken)}catch{return null}}}Zs.FACEBOOK_SIGN_IN_METHOD="facebook.com";Zs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei extends uu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return xo._fromParams({providerId:ei.PROVIDER_ID,signInMethod:ei.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return ei.credentialFromTaggedObject(e)}static credentialFromError(e){return ei.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return ei.credential(n,r)}catch{return null}}}ei.GOOGLE_SIGN_IN_METHOD="google.com";ei.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti extends uu{constructor(){super("github.com")}static credential(e){return xo._fromParams({providerId:ti.PROVIDER_ID,signInMethod:ti.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ti.credentialFromTaggedObject(e)}static credentialFromError(e){return ti.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ti.credential(e.oauthAccessToken)}catch{return null}}}ti.GITHUB_SIGN_IN_METHOD="github.com";ti.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni extends uu{constructor(){super("twitter.com")}static credential(e,n){return xo._fromParams({providerId:ni.PROVIDER_ID,signInMethod:ni.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return ni.credentialFromTaggedObject(e)}static credentialFromError(e){return ni.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return ni.credential(n,r)}catch{return null}}}ni.TWITTER_SIGN_IN_METHOD="twitter.com";ni.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Dr._fromIdTokenResponse(e,r,s),a=Vb(r);return new qa({user:i,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=Vb(r);return new qa({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function Vb(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _h extends Ir{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,_h.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new _h(e,n,r,s)}}function gC(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?_h._fromErrorAndOperation(t,i,e,r):i})}async function g2(t,e,n=!1){const r=await Bc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return qa._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y2(t,e,n=!1){const{auth:r}=t;if(pr(r.app))return Promise.reject(_i(r));const s="reauthenticate";try{const i=await Bc(t,gC(r,s,e,t),n);Oe(i.idToken,r,"internal-error");const a=Zy(i.idToken);Oe(a,r,"internal-error");const{sub:l}=a;return Oe(t.uid===l,r,"user-mismatch"),qa._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Ur(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yC(t,e,n=!1){if(pr(t.app))return Promise.reject(_i(t));const r="signIn",s=await gC(t,r,e),i=await qa._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function v2(t,e){return yC(ul(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _2(t){const e=ul(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function x2(t,e,n){return pr(t.app)?Promise.reject(_i(t)):v2(ht(t),dl.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&_2(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b2(t,e){return ht(t).setPersistence(e)}function w2(t,e,n,r){return ht(t).onIdTokenChanged(e,n,r)}function E2(t,e,n){return ht(t).beforeAuthStateChanged(e,n)}function rv(t,e,n,r){return ht(t).onAuthStateChanged(e,n,r)}function I2(t){return ht(t).signOut()}const xh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(xh,"1"),this.storage.removeItem(xh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S2=1e3,C2=10;class _C extends vC{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=uC(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,l,c)=>{this.notifyListeners(a,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);qD()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,C2):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},S2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}_C.type="LOCAL";const xC=_C;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bC extends vC{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}bC.type="SESSION";const wC=bC;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new pf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(n.origin,i)),c=await T2(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}pf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sv(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,c)=>{const d=sv("",20);s.port1.start();const f=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(h){const p=h;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(p.data.response);break;default:clearTimeout(f),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function is(){return window}function j2(t){is().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EC(){return typeof is().WorkerGlobalScope<"u"&&typeof is().importScripts=="function"}async function A2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function P2(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function R2(){return EC()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IC="firebaseLocalStorageDb",k2=1,bh="firebaseLocalStorage",SC="fbase_key";class du{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function mf(t,e){return t.transaction([bh],e?"readwrite":"readonly").objectStore(bh)}function D2(){const t=indexedDB.deleteDatabase(IC);return new du(t).toPromise()}function mg(){const t=indexedDB.open(IC,k2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(bh,{keyPath:SC})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(bh)?e(r):(r.close(),await D2(),e(await mg()))})})}async function Mb(t,e,n){const r=mf(t,!0).put({[SC]:e,value:n});return new du(r).toPromise()}async function L2(t,e){const n=mf(t,!1).get(e),r=await new du(n).toPromise();return r===void 0?null:r.value}function Fb(t,e){const n=mf(t,!0).delete(e);return new du(n).toPromise()}const O2=800,V2=3;class CC{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await mg(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>V2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return EC()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=pf._getInstance(R2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await A2(),!this.activeServiceWorker)return;this.sender=new N2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||P2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await mg();return await Mb(e,xh,"1"),await Fb(e,xh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Mb(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>L2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Fb(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=mf(s,!1).getAll();return new du(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),O2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}CC.type="LOCAL";const M2=CC;new cu(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F2(t,e){return e?xs(e):(Oe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv extends tv{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ra(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Ra(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Ra(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function U2(t){return yC(t.auth,new iv(t),t.bypassAuthState)}function $2(t){const{auth:e,user:n}=t;return Oe(n,e,"internal-error"),y2(n,new iv(t),t.bypassAuthState)}async function B2(t){const{auth:e,user:n}=t;return Oe(n,e,"internal-error"),g2(n,new iv(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TC{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return U2;case"linkViaPopup":case"linkViaRedirect":return B2;case"reauthViaPopup":case"reauthViaRedirect":return $2;default:Ur(this.auth,"internal-error")}}resolve(e){Rs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Rs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z2=new cu(2e3,1e4);class Ea extends TC{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Ea.currentPopupAction&&Ea.currentPopupAction.cancel(),Ea.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Oe(e,this.auth,"internal-error"),e}async onExecution(){Rs(this.filter.length===1,"Popup operations only handle one event");const e=sv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(ss(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(ss(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ea.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ss(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,z2.get())};e()}}Ea.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q2="pendingRedirect",Cd=new Map;class H2 extends TC{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Cd.get(this.auth._key());if(!e){try{const r=await W2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Cd.set(this.auth._key(),e)}return this.bypassAuthState||Cd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function W2(t,e){const n=Q2(e),r=K2(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function G2(t,e){Cd.set(t._key(),e)}function K2(t){return xs(t._redirectPersistence)}function Q2(t){return Sd(q2,t.config.apiKey,t.name)}async function Y2(t,e,n=!1){if(pr(t.app))return Promise.reject(_i(t));const r=ul(t),s=F2(r,e),a=await new H2(r,s,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X2=10*60*1e3;class J2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Z2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!NC(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(ss(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=X2&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ub(e))}saveEventToCache(e){this.cachedEventUids.add(Ub(e)),this.lastProcessedEventTime=Date.now()}}function Ub(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function NC({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Z2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return NC(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eL(t,e={}){return Li(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tL=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nL=/^https?/;async function rL(t){if(t.config.emulator)return;const{authorizedDomains:e}=await eL(t);for(const n of e)try{if(sL(n))return}catch{}Ur(t,"unauthorized-domain")}function sL(t){const e=fg(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!nL.test(n))return!1;if(tL.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iL=new cu(3e4,6e4);function $b(){const t=is().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function oL(t){return new Promise((e,n)=>{var s,i,a;function r(){$b(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{$b(),n(ss(t,"network-request-failed"))},timeout:iL.get()})}if((i=(s=is().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((a=is().gapi)!=null&&a.load)r();else{const l=ZD("iframefcb");return is()[l]=()=>{gapi.load?r():n(ss(t,"network-request-failed"))},hC(`${JD()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw Td=null,e})}let Td=null;function aL(t){return Td=Td||oL(t),Td}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lL=new cu(5e3,15e3),cL="__/auth/iframe",uL="emulator/auth/iframe",dL={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},hL=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function fL(t){const e=t.config;Oe(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Jy(e,uL):`https://${t.config.authDomain}/${cL}`,r={apiKey:e.apiKey,appName:t.name,v:Fo},s=hL.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${lu(r).slice(1)}`}async function pL(t){const e=await aL(t),n=is().gapi;return Oe(n,t,"internal-error"),e.open({where:document.body,url:fL(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:dL,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=ss(t,"network-request-failed"),l=is().setTimeout(()=>{i(a)},lL.get());function c(){is().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mL={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},gL=500,yL=600,vL="_blank",_L="http://localhost";class Bb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function xL(t,e,n,r=gL,s=yL){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...mL,width:r.toString(),height:s.toString(),top:i,left:a},d=tn().toLowerCase();n&&(l=iC(d)?vL:n),rC(d)&&(e=e||_L,c.scrollbars="yes");const f=Object.entries(c).reduce((p,[x,T])=>`${p}${x}=${T},`,"");if(zD(d)&&l!=="_self")return bL(e||"",l),new Bb(null);const h=window.open(e||"",l,f);Oe(h,t,"popup-blocked");try{h.focus()}catch{}return new Bb(h)}function bL(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wL="__/auth/handler",EL="emulator/auth/handler",IL=encodeURIComponent("fac");async function zb(t,e,n,r,s,i){Oe(t.config.authDomain,t,"auth-domain-config-required"),Oe(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Fo,eventId:s};if(e instanceof mC){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",ok(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,h]of Object.entries({}))a[f]=h}if(e instanceof uu){const f=e.getScopes().filter(h=>h!=="");f.length>0&&(a.scopes=f.join(","))}t.tenantId&&(a.tid=t.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const c=await t._getAppCheckToken(),d=c?`#${IL}=${encodeURIComponent(c)}`:"";return`${SL(t)}?${lu(l).slice(1)}${d}`}function SL({config:t}){return t.emulator?Jy(t,EL):`https://${t.authDomain}/${wL}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Up="webStorageSupport";class CL{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=wC,this._completeRedirectFn=Y2,this._overrideRedirectResult=G2}async _openPopup(e,n,r,s){var a;Rs((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const i=await zb(e,n,r,fg(),s);return xL(e,i,sv())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await zb(e,n,r,fg(),s);return j2(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(Rs(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await pL(e),r=new J2(e);return n.register("authEvent",s=>(Oe(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Up,{type:Up},s=>{var a;const i=(a=s==null?void 0:s[0])==null?void 0:a[Up];i!==void 0&&n(!!i),Ur(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=rL(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return uC()||sC()||ev()}}const TL=CL;var qb="@firebase/auth",Hb="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NL{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jL(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function AL(t){Fr(new Er("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;Oe(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:dC(t)},d=new QD(r,s,i,c);return i2(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Fr(new Er("auth-internal",e=>{const n=ul(e.getProvider("auth").getImmediate());return(r=>new NL(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Xn(qb,Hb,jL(t)),Xn(qb,Hb,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PL=5*60,RL=VS("authIdTokenMaxAge")||PL;let Wb=null;const kL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>RL)return;const s=n==null?void 0:n.token;Wb!==s&&(Wb=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function jC(t=df()){const e=Di(t,"auth");if(e.isInitialized())return e.getImmediate();const n=s2(t,{popupRedirectResolver:TL,persistence:[M2,xC,wC]}),r=VS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=kL(i.toString());E2(n,a,()=>a(n.currentUser)),w2(n,l=>a(l))}}const s=DS("auth");return s&&o2(n,`http://${s}`),n}function DL(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}YD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=ss("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",DL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});AL("Browser");var Gb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xi,AC;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(g,v){function b(){}b.prototype=v.prototype,g.F=v.prototype,g.prototype=new b,g.prototype.constructor=g,g.D=function(P,R,O){for(var k=Array(arguments.length-2),M=2;M<arguments.length;M++)k[M-2]=arguments[M];return v.prototype[R].apply(P,k)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(g,v,b){b||(b=0);const P=Array(16);if(typeof v=="string")for(var R=0;R<16;++R)P[R]=v.charCodeAt(b++)|v.charCodeAt(b++)<<8|v.charCodeAt(b++)<<16|v.charCodeAt(b++)<<24;else for(R=0;R<16;++R)P[R]=v[b++]|v[b++]<<8|v[b++]<<16|v[b++]<<24;v=g.g[0],b=g.g[1],R=g.g[2];let O=g.g[3],k;k=v+(O^b&(R^O))+P[0]+3614090360&4294967295,v=b+(k<<7&4294967295|k>>>25),k=O+(R^v&(b^R))+P[1]+3905402710&4294967295,O=v+(k<<12&4294967295|k>>>20),k=R+(b^O&(v^b))+P[2]+606105819&4294967295,R=O+(k<<17&4294967295|k>>>15),k=b+(v^R&(O^v))+P[3]+3250441966&4294967295,b=R+(k<<22&4294967295|k>>>10),k=v+(O^b&(R^O))+P[4]+4118548399&4294967295,v=b+(k<<7&4294967295|k>>>25),k=O+(R^v&(b^R))+P[5]+1200080426&4294967295,O=v+(k<<12&4294967295|k>>>20),k=R+(b^O&(v^b))+P[6]+2821735955&4294967295,R=O+(k<<17&4294967295|k>>>15),k=b+(v^R&(O^v))+P[7]+4249261313&4294967295,b=R+(k<<22&4294967295|k>>>10),k=v+(O^b&(R^O))+P[8]+1770035416&4294967295,v=b+(k<<7&4294967295|k>>>25),k=O+(R^v&(b^R))+P[9]+2336552879&4294967295,O=v+(k<<12&4294967295|k>>>20),k=R+(b^O&(v^b))+P[10]+4294925233&4294967295,R=O+(k<<17&4294967295|k>>>15),k=b+(v^R&(O^v))+P[11]+2304563134&4294967295,b=R+(k<<22&4294967295|k>>>10),k=v+(O^b&(R^O))+P[12]+1804603682&4294967295,v=b+(k<<7&4294967295|k>>>25),k=O+(R^v&(b^R))+P[13]+4254626195&4294967295,O=v+(k<<12&4294967295|k>>>20),k=R+(b^O&(v^b))+P[14]+2792965006&4294967295,R=O+(k<<17&4294967295|k>>>15),k=b+(v^R&(O^v))+P[15]+1236535329&4294967295,b=R+(k<<22&4294967295|k>>>10),k=v+(R^O&(b^R))+P[1]+4129170786&4294967295,v=b+(k<<5&4294967295|k>>>27),k=O+(b^R&(v^b))+P[6]+3225465664&4294967295,O=v+(k<<9&4294967295|k>>>23),k=R+(v^b&(O^v))+P[11]+643717713&4294967295,R=O+(k<<14&4294967295|k>>>18),k=b+(O^v&(R^O))+P[0]+3921069994&4294967295,b=R+(k<<20&4294967295|k>>>12),k=v+(R^O&(b^R))+P[5]+3593408605&4294967295,v=b+(k<<5&4294967295|k>>>27),k=O+(b^R&(v^b))+P[10]+38016083&4294967295,O=v+(k<<9&4294967295|k>>>23),k=R+(v^b&(O^v))+P[15]+3634488961&4294967295,R=O+(k<<14&4294967295|k>>>18),k=b+(O^v&(R^O))+P[4]+3889429448&4294967295,b=R+(k<<20&4294967295|k>>>12),k=v+(R^O&(b^R))+P[9]+568446438&4294967295,v=b+(k<<5&4294967295|k>>>27),k=O+(b^R&(v^b))+P[14]+3275163606&4294967295,O=v+(k<<9&4294967295|k>>>23),k=R+(v^b&(O^v))+P[3]+4107603335&4294967295,R=O+(k<<14&4294967295|k>>>18),k=b+(O^v&(R^O))+P[8]+1163531501&4294967295,b=R+(k<<20&4294967295|k>>>12),k=v+(R^O&(b^R))+P[13]+2850285829&4294967295,v=b+(k<<5&4294967295|k>>>27),k=O+(b^R&(v^b))+P[2]+4243563512&4294967295,O=v+(k<<9&4294967295|k>>>23),k=R+(v^b&(O^v))+P[7]+1735328473&4294967295,R=O+(k<<14&4294967295|k>>>18),k=b+(O^v&(R^O))+P[12]+2368359562&4294967295,b=R+(k<<20&4294967295|k>>>12),k=v+(b^R^O)+P[5]+4294588738&4294967295,v=b+(k<<4&4294967295|k>>>28),k=O+(v^b^R)+P[8]+2272392833&4294967295,O=v+(k<<11&4294967295|k>>>21),k=R+(O^v^b)+P[11]+1839030562&4294967295,R=O+(k<<16&4294967295|k>>>16),k=b+(R^O^v)+P[14]+4259657740&4294967295,b=R+(k<<23&4294967295|k>>>9),k=v+(b^R^O)+P[1]+2763975236&4294967295,v=b+(k<<4&4294967295|k>>>28),k=O+(v^b^R)+P[4]+1272893353&4294967295,O=v+(k<<11&4294967295|k>>>21),k=R+(O^v^b)+P[7]+4139469664&4294967295,R=O+(k<<16&4294967295|k>>>16),k=b+(R^O^v)+P[10]+3200236656&4294967295,b=R+(k<<23&4294967295|k>>>9),k=v+(b^R^O)+P[13]+681279174&4294967295,v=b+(k<<4&4294967295|k>>>28),k=O+(v^b^R)+P[0]+3936430074&4294967295,O=v+(k<<11&4294967295|k>>>21),k=R+(O^v^b)+P[3]+3572445317&4294967295,R=O+(k<<16&4294967295|k>>>16),k=b+(R^O^v)+P[6]+76029189&4294967295,b=R+(k<<23&4294967295|k>>>9),k=v+(b^R^O)+P[9]+3654602809&4294967295,v=b+(k<<4&4294967295|k>>>28),k=O+(v^b^R)+P[12]+3873151461&4294967295,O=v+(k<<11&4294967295|k>>>21),k=R+(O^v^b)+P[15]+530742520&4294967295,R=O+(k<<16&4294967295|k>>>16),k=b+(R^O^v)+P[2]+3299628645&4294967295,b=R+(k<<23&4294967295|k>>>9),k=v+(R^(b|~O))+P[0]+4096336452&4294967295,v=b+(k<<6&4294967295|k>>>26),k=O+(b^(v|~R))+P[7]+1126891415&4294967295,O=v+(k<<10&4294967295|k>>>22),k=R+(v^(O|~b))+P[14]+2878612391&4294967295,R=O+(k<<15&4294967295|k>>>17),k=b+(O^(R|~v))+P[5]+4237533241&4294967295,b=R+(k<<21&4294967295|k>>>11),k=v+(R^(b|~O))+P[12]+1700485571&4294967295,v=b+(k<<6&4294967295|k>>>26),k=O+(b^(v|~R))+P[3]+2399980690&4294967295,O=v+(k<<10&4294967295|k>>>22),k=R+(v^(O|~b))+P[10]+4293915773&4294967295,R=O+(k<<15&4294967295|k>>>17),k=b+(O^(R|~v))+P[1]+2240044497&4294967295,b=R+(k<<21&4294967295|k>>>11),k=v+(R^(b|~O))+P[8]+1873313359&4294967295,v=b+(k<<6&4294967295|k>>>26),k=O+(b^(v|~R))+P[15]+4264355552&4294967295,O=v+(k<<10&4294967295|k>>>22),k=R+(v^(O|~b))+P[6]+2734768916&4294967295,R=O+(k<<15&4294967295|k>>>17),k=b+(O^(R|~v))+P[13]+1309151649&4294967295,b=R+(k<<21&4294967295|k>>>11),k=v+(R^(b|~O))+P[4]+4149444226&4294967295,v=b+(k<<6&4294967295|k>>>26),k=O+(b^(v|~R))+P[11]+3174756917&4294967295,O=v+(k<<10&4294967295|k>>>22),k=R+(v^(O|~b))+P[2]+718787259&4294967295,R=O+(k<<15&4294967295|k>>>17),k=b+(O^(R|~v))+P[9]+3951481745&4294967295,g.g[0]=g.g[0]+v&4294967295,g.g[1]=g.g[1]+(R+(k<<21&4294967295|k>>>11))&4294967295,g.g[2]=g.g[2]+R&4294967295,g.g[3]=g.g[3]+O&4294967295}r.prototype.v=function(g,v){v===void 0&&(v=g.length);const b=v-this.blockSize,P=this.C;let R=this.h,O=0;for(;O<v;){if(R==0)for(;O<=b;)s(this,g,O),O+=this.blockSize;if(typeof g=="string"){for(;O<v;)if(P[R++]=g.charCodeAt(O++),R==this.blockSize){s(this,P),R=0;break}}else for(;O<v;)if(P[R++]=g[O++],R==this.blockSize){s(this,P),R=0;break}}this.h=R,this.o+=v},r.prototype.A=function(){var g=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);g[0]=128;for(var v=1;v<g.length-8;++v)g[v]=0;v=this.o*8;for(var b=g.length-8;b<g.length;++b)g[b]=v&255,v/=256;for(this.v(g),g=Array(16),v=0,b=0;b<4;++b)for(let P=0;P<32;P+=8)g[v++]=this.g[b]>>>P&255;return g};function i(g,v){var b=l;return Object.prototype.hasOwnProperty.call(b,g)?b[g]:b[g]=v(g)}function a(g,v){this.h=v;const b=[];let P=!0;for(let R=g.length-1;R>=0;R--){const O=g[R]|0;P&&O==v||(b[R]=O,P=!1)}this.g=b}var l={};function c(g){return-128<=g&&g<128?i(g,function(v){return new a([v|0],v<0?-1:0)}):new a([g|0],g<0?-1:0)}function d(g){if(isNaN(g)||!isFinite(g))return h;if(g<0)return N(d(-g));const v=[];let b=1;for(let P=0;g>=b;P++)v[P]=g/b|0,b*=4294967296;return new a(v,0)}function f(g,v){if(g.length==0)throw Error("number format error: empty string");if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(g.charAt(0)=="-")return N(f(g.substring(1),v));if(g.indexOf("-")>=0)throw Error('number format error: interior "-" character');const b=d(Math.pow(v,8));let P=h;for(let O=0;O<g.length;O+=8){var R=Math.min(8,g.length-O);const k=parseInt(g.substring(O,O+R),v);R<8?(R=d(Math.pow(v,R)),P=P.j(R).add(d(k))):(P=P.j(b),P=P.add(d(k)))}return P}var h=c(0),p=c(1),x=c(16777216);t=a.prototype,t.m=function(){if(C(this))return-N(this).m();let g=0,v=1;for(let b=0;b<this.g.length;b++){const P=this.i(b);g+=(P>=0?P:4294967296+P)*v,v*=4294967296}return g},t.toString=function(g){if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(T(this))return"0";if(C(this))return"-"+N(this).toString(g);const v=d(Math.pow(g,6));var b=this;let P="";for(;;){const R=I(b,v).g;b=_(b,R.j(v));let O=((b.g.length>0?b.g[0]:b.h)>>>0).toString(g);if(b=R,T(b))return O+P;for(;O.length<6;)O="0"+O;P=O+P}},t.i=function(g){return g<0?0:g<this.g.length?this.g[g]:this.h};function T(g){if(g.h!=0)return!1;for(let v=0;v<g.g.length;v++)if(g.g[v]!=0)return!1;return!0}function C(g){return g.h==-1}t.l=function(g){return g=_(this,g),C(g)?-1:T(g)?0:1};function N(g){const v=g.g.length,b=[];for(let P=0;P<v;P++)b[P]=~g.g[P];return new a(b,~g.h).add(p)}t.abs=function(){return C(this)?N(this):this},t.add=function(g){const v=Math.max(this.g.length,g.g.length),b=[];let P=0;for(let R=0;R<=v;R++){let O=P+(this.i(R)&65535)+(g.i(R)&65535),k=(O>>>16)+(this.i(R)>>>16)+(g.i(R)>>>16);P=k>>>16,O&=65535,k&=65535,b[R]=k<<16|O}return new a(b,b[b.length-1]&-2147483648?-1:0)};function _(g,v){return g.add(N(v))}t.j=function(g){if(T(this)||T(g))return h;if(C(this))return C(g)?N(this).j(N(g)):N(N(this).j(g));if(C(g))return N(this.j(N(g)));if(this.l(x)<0&&g.l(x)<0)return d(this.m()*g.m());const v=this.g.length+g.g.length,b=[];for(var P=0;P<2*v;P++)b[P]=0;for(P=0;P<this.g.length;P++)for(let R=0;R<g.g.length;R++){const O=this.i(P)>>>16,k=this.i(P)&65535,M=g.i(R)>>>16,z=g.i(R)&65535;b[2*P+2*R]+=k*z,E(b,2*P+2*R),b[2*P+2*R+1]+=O*z,E(b,2*P+2*R+1),b[2*P+2*R+1]+=k*M,E(b,2*P+2*R+1),b[2*P+2*R+2]+=O*M,E(b,2*P+2*R+2)}for(g=0;g<v;g++)b[g]=b[2*g+1]<<16|b[2*g];for(g=v;g<2*v;g++)b[g]=0;return new a(b,0)};function E(g,v){for(;(g[v]&65535)!=g[v];)g[v+1]+=g[v]>>>16,g[v]&=65535,v++}function S(g,v){this.g=g,this.h=v}function I(g,v){if(T(v))throw Error("division by zero");if(T(g))return new S(h,h);if(C(g))return v=I(N(g),v),new S(N(v.g),N(v.h));if(C(v))return v=I(g,N(v)),new S(N(v.g),v.h);if(g.g.length>30){if(C(g)||C(v))throw Error("slowDivide_ only works with positive integers.");for(var b=p,P=v;P.l(g)<=0;)b=L(b),P=L(P);var R=V(b,1),O=V(P,1);for(P=V(P,2),b=V(b,2);!T(P);){var k=O.add(P);k.l(g)<=0&&(R=R.add(b),O=k),P=V(P,1),b=V(b,1)}return v=_(g,R.j(v)),new S(R,v)}for(R=h;g.l(v)>=0;){for(b=Math.max(1,Math.floor(g.m()/v.m())),P=Math.ceil(Math.log(b)/Math.LN2),P=P<=48?1:Math.pow(2,P-48),O=d(b),k=O.j(v);C(k)||k.l(g)>0;)b-=P,O=d(b),k=O.j(v);T(O)&&(O=p),R=R.add(O),g=_(g,k)}return new S(R,g)}t.B=function(g){return I(this,g).h},t.and=function(g){const v=Math.max(this.g.length,g.g.length),b=[];for(let P=0;P<v;P++)b[P]=this.i(P)&g.i(P);return new a(b,this.h&g.h)},t.or=function(g){const v=Math.max(this.g.length,g.g.length),b=[];for(let P=0;P<v;P++)b[P]=this.i(P)|g.i(P);return new a(b,this.h|g.h)},t.xor=function(g){const v=Math.max(this.g.length,g.g.length),b=[];for(let P=0;P<v;P++)b[P]=this.i(P)^g.i(P);return new a(b,this.h^g.h)};function L(g){const v=g.g.length+1,b=[];for(let P=0;P<v;P++)b[P]=g.i(P)<<1|g.i(P-1)>>>31;return new a(b,g.h)}function V(g,v){const b=v>>5;v%=32;const P=g.g.length-b,R=[];for(let O=0;O<P;O++)R[O]=v>0?g.i(O+b)>>>v|g.i(O+b+1)<<32-v:g.i(O+b);return new a(R,g.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,AC=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,xi=a}).apply(typeof Gb<"u"?Gb:typeof self<"u"?self:typeof window<"u"?window:{});var Ju=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var PC,Xl,RC,Nd,gg,kC,DC,LC;(function(){var t,e=Object.defineProperty;function n(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ju=="object"&&Ju];for(var m=0;m<u.length;++m){var y=u[m];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=n(this);function s(u,m){if(m)e:{var y=r;u=u.split(".");for(var A=0;A<u.length-1;A++){var $=u[A];if(!($ in y))break e;y=y[$]}u=u[u.length-1],A=y[u],m=m(A),m!=A&&m!=null&&e(y,u,{configurable:!0,writable:!0,value:m})}}s("Symbol.dispose",function(u){return u||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(u){return u||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(u){return u||function(m){var y=[],A;for(A in m)Object.prototype.hasOwnProperty.call(m,A)&&y.push([A,m[A]]);return y}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},a=this||self;function l(u){var m=typeof u;return m=="object"&&u!=null||m=="function"}function c(u,m,y){return u.call.apply(u.bind,arguments)}function d(u,m,y){return d=c,d.apply(null,arguments)}function f(u,m){var y=Array.prototype.slice.call(arguments,1);return function(){var A=y.slice();return A.push.apply(A,arguments),u.apply(this,A)}}function h(u,m){function y(){}y.prototype=m.prototype,u.Z=m.prototype,u.prototype=new y,u.prototype.constructor=u,u.Ob=function(A,$,H){for(var de=Array(arguments.length-2),Ye=2;Ye<arguments.length;Ye++)de[Ye-2]=arguments[Ye];return m.prototype[$].apply(A,de)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?u=>u&&AsyncContext.Snapshot.wrap(u):u=>u;function x(u){const m=u.length;if(m>0){const y=Array(m);for(let A=0;A<m;A++)y[A]=u[A];return y}return[]}function T(u,m){for(let A=1;A<arguments.length;A++){const $=arguments[A];var y=typeof $;if(y=y!="object"?y:$?Array.isArray($)?"array":y:"null",y=="array"||y=="object"&&typeof $.length=="number"){y=u.length||0;const H=$.length||0;u.length=y+H;for(let de=0;de<H;de++)u[y+de]=$[de]}else u.push($)}}class C{constructor(m,y){this.i=m,this.j=y,this.h=0,this.g=null}get(){let m;return this.h>0?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}function N(u){a.setTimeout(()=>{throw u},0)}function _(){var u=g;let m=null;return u.g&&(m=u.g,u.g=u.g.next,u.g||(u.h=null),m.next=null),m}class E{constructor(){this.h=this.g=null}add(m,y){const A=S.get();A.set(m,y),this.h?this.h.next=A:this.g=A,this.h=A}}var S=new C(()=>new I,u=>u.reset());class I{constructor(){this.next=this.g=this.h=null}set(m,y){this.h=m,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let L,V=!1,g=new E,v=()=>{const u=Promise.resolve(void 0);L=()=>{u.then(b)}};function b(){for(var u;u=_();){try{u.h.call(u.g)}catch(y){N(y)}var m=S;m.j(u),m.h<100&&(m.h++,u.next=m.g,m.g=u)}V=!1}function P(){this.u=this.u,this.C=this.C}P.prototype.u=!1,P.prototype.dispose=function(){this.u||(this.u=!0,this.N())},P.prototype[Symbol.dispose]=function(){this.dispose()},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function R(u,m){this.type=u,this.g=this.target=m,this.defaultPrevented=!1}R.prototype.h=function(){this.defaultPrevented=!0};var O=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,m=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,m),a.removeEventListener("test",y,m)}catch{}return u}();function k(u){return/^[\s\xa0]*$/.test(u)}function M(u,m){R.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u&&this.init(u,m)}h(M,R),M.prototype.init=function(u,m){const y=this.type=u.type,A=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;this.target=u.target||u.srcElement,this.g=m,m=u.relatedTarget,m||(y=="mouseover"?m=u.fromElement:y=="mouseout"&&(m=u.toElement)),this.relatedTarget=m,A?(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=u.pointerType,this.state=u.state,this.i=u,u.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);const u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var z="closure_listenable_"+(Math.random()*1e6|0),ve=0;function we(u,m,y,A,$){this.listener=u,this.proxy=null,this.src=m,this.type=y,this.capture=!!A,this.ha=$,this.key=++ve,this.da=this.fa=!1}function ee(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function te(u,m,y){for(const A in u)m.call(y,u[A],A,u)}function ne(u,m){for(const y in u)m.call(void 0,u[y],y,u)}function me(u){const m={};for(const y in u)m[y]=u[y];return m}const Ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ke(u,m){let y,A;for(let $=1;$<arguments.length;$++){A=arguments[$];for(y in A)u[y]=A[y];for(let H=0;H<Ne.length;H++)y=Ne[H],Object.prototype.hasOwnProperty.call(A,y)&&(u[y]=A[y])}}function He(u){this.src=u,this.g={},this.h=0}He.prototype.add=function(u,m,y,A,$){const H=u.toString();u=this.g[H],u||(u=this.g[H]=[],this.h++);const de=De(u,m,A,$);return de>-1?(m=u[de],y||(m.fa=!1)):(m=new we(m,this.src,H,!!A,$),m.fa=y,u.push(m)),m};function st(u,m){const y=m.type;if(y in u.g){var A=u.g[y],$=Array.prototype.indexOf.call(A,m,void 0),H;(H=$>=0)&&Array.prototype.splice.call(A,$,1),H&&(ee(m),u.g[y].length==0&&(delete u.g[y],u.h--))}}function De(u,m,y,A){for(let $=0;$<u.length;++$){const H=u[$];if(!H.da&&H.listener==m&&H.capture==!!y&&H.ha==A)return $}return-1}var We="closure_lm_"+(Math.random()*1e6|0),Ge={};function _t(u,m,y,A,$){if(Array.isArray(m)){for(let H=0;H<m.length;H++)_t(u,m[H],y,A,$);return null}return y=X(y),u&&u[z]?u.J(m,y,l(A)?!!A.capture:!1,$):W(u,m,y,!1,A,$)}function W(u,m,y,A,$,H){if(!m)throw Error("Invalid event type");const de=l($)?!!$.capture:!!$;let Ye=ge(u);if(Ye||(u[We]=Ye=new He(u)),y=Ye.add(m,y,A,de,H),y.proxy)return y;if(A=fe(),y.proxy=A,A.src=u,A.listener=y,u.addEventListener)O||($=de),$===void 0&&($=!1),u.addEventListener(m.toString(),A,$);else if(u.attachEvent)u.attachEvent(Z(m.toString()),A);else if(u.addListener&&u.removeListener)u.addListener(A);else throw Error("addEventListener and attachEvent are unavailable.");return y}function fe(){function u(y){return m.call(u.src,u.listener,y)}const m=Ie;return u}function ye(u,m,y,A,$){if(Array.isArray(m))for(var H=0;H<m.length;H++)ye(u,m[H],y,A,$);else A=l(A)?!!A.capture:!!A,y=X(y),u&&u[z]?(u=u.i,H=String(m).toString(),H in u.g&&(m=u.g[H],y=De(m,y,A,$),y>-1&&(ee(m[y]),Array.prototype.splice.call(m,y,1),m.length==0&&(delete u.g[H],u.h--)))):u&&(u=ge(u))&&(m=u.g[m.toString()],u=-1,m&&(u=De(m,y,A,$)),(y=u>-1?m[u]:null)&&J(y))}function J(u){if(typeof u!="number"&&u&&!u.da){var m=u.src;if(m&&m[z])st(m.i,u);else{var y=u.type,A=u.proxy;m.removeEventListener?m.removeEventListener(y,A,u.capture):m.detachEvent?m.detachEvent(Z(y),A):m.addListener&&m.removeListener&&m.removeListener(A),(y=ge(m))?(st(y,u),y.h==0&&(y.src=null,m[We]=null)):ee(u)}}}function Z(u){return u in Ge?Ge[u]:Ge[u]="on"+u}function Ie(u,m){if(u.da)u=!0;else{m=new M(m,this);const y=u.listener,A=u.ha||u.src;u.fa&&J(u),u=y.call(A,m)}return u}function ge(u){return u=u[We],u instanceof He?u:null}var Y="__closure_events_fn_"+(Math.random()*1e9>>>0);function X(u){return typeof u=="function"?u:(u[Y]||(u[Y]=function(m){return u.handleEvent(m)}),u[Y])}function B(){P.call(this),this.i=new He(this),this.M=this,this.G=null}h(B,P),B.prototype[z]=!0,B.prototype.removeEventListener=function(u,m,y,A){ye(this,u,m,y,A)};function pe(u,m){var y,A=u.G;if(A)for(y=[];A;A=A.G)y.push(A);if(u=u.M,A=m.type||m,typeof m=="string")m=new R(m,u);else if(m instanceof R)m.target=m.target||u;else{var $=m;m=new R(A,u),ke(m,$)}$=!0;let H,de;if(y)for(de=y.length-1;de>=0;de--)H=m.g=y[de],$=Ve(H,A,!0,m)&&$;if(H=m.g=u,$=Ve(H,A,!0,m)&&$,$=Ve(H,A,!1,m)&&$,y)for(de=0;de<y.length;de++)H=m.g=y[de],$=Ve(H,A,!1,m)&&$}B.prototype.N=function(){if(B.Z.N.call(this),this.i){var u=this.i;for(const m in u.g){const y=u.g[m];for(let A=0;A<y.length;A++)ee(y[A]);delete u.g[m],u.h--}}this.G=null},B.prototype.J=function(u,m,y,A){return this.i.add(String(u),m,!1,y,A)},B.prototype.K=function(u,m,y,A){return this.i.add(String(u),m,!0,y,A)};function Ve(u,m,y,A){if(m=u.i.g[String(m)],!m)return!0;m=m.concat();let $=!0;for(let H=0;H<m.length;++H){const de=m[H];if(de&&!de.da&&de.capture==y){const Ye=de.listener,Jt=de.ha||de.src;de.fa&&st(u.i,de),$=Ye.call(Jt,A)!==!1&&$}}return $&&!A.defaultPrevented}function Be(u,m){if(typeof u!="function")if(u&&typeof u.handleEvent=="function")u=d(u.handleEvent,u);else throw Error("Invalid listener argument");return Number(m)>2147483647?-1:a.setTimeout(u,m||0)}function Me(u){u.g=Be(()=>{u.g=null,u.i&&(u.i=!1,Me(u))},u.l);const m=u.h;u.h=null,u.m.apply(null,m)}class Ke extends P{constructor(m,y){super(),this.m=m,this.l=y,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:Me(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function xe(u){P.call(this),this.h=u,this.g={}}h(xe,P);var lt=[];function Ze(u){te(u.g,function(m,y){this.g.hasOwnProperty(y)&&J(m)},u),u.g={}}xe.prototype.N=function(){xe.Z.N.call(this),Ze(this)},xe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var bt=a.JSON.stringify,q=a.JSON.parse,ce=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function D(){}function F(){}var re={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ue(){R.call(this,"d")}h(ue,R);function Ae(){R.call(this,"c")}h(Ae,R);var Pe={},$e=null;function Fe(){return $e=$e||new B}Pe.Ia="serverreachability";function rt(u){R.call(this,Pe.Ia,u)}h(rt,R);function dt(u){const m=Fe();pe(m,new rt(m))}Pe.STAT_EVENT="statevent";function Vt(u,m){R.call(this,Pe.STAT_EVENT,u),this.stat=m}h(Vt,R);function Qe(u){const m=Fe();pe(m,new Vt(m,u))}Pe.Ja="timingevent";function Jn(u,m){R.call(this,Pe.Ja,u),this.size=m}h(Jn,R);function Wt(u,m){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},m)}function ut(){this.g=!0}ut.prototype.ua=function(){this.g=!1};function dn(u,m,y,A,$,H){u.info(function(){if(u.g)if(H){var de="",Ye=H.split("&");for(let yt=0;yt<Ye.length;yt++){var Jt=Ye[yt].split("=");if(Jt.length>1){const rn=Jt[0];Jt=Jt[1];const Wr=rn.split("_");de=Wr.length>=2&&Wr[1]=="type"?de+(rn+"="+Jt+"&"):de+(rn+"=redacted&")}}}else de=null;else de=H;return"XMLHTTP REQ ("+A+") [attempt "+$+"]: "+m+`
`+y+`
`+de})}function yn(u,m,y,A,$,H,de){u.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+$+"]: "+m+`
`+y+`
`+H+" "+de})}function vn(u,m,y,A){u.info(function(){return"XMLHTTP TEXT ("+m+"): "+yl(u,y)+(A?" "+A:"")})}function Sr(u,m){u.info(function(){return"TIMEOUT: "+m})}ut.prototype.info=function(){};function yl(u,m){if(!u.g)return m;if(!m)return null;try{const H=JSON.parse(m);if(H){for(u=0;u<H.length;u++)if(Array.isArray(H[u])){var y=H[u];if(!(y.length<2)){var A=y[1];if(Array.isArray(A)&&!(A.length<1)){var $=A[0];if($!="noop"&&$!="stop"&&$!="close")for(let de=1;de<A.length;de++)A[de]=""}}}}return bt(H)}catch{return m}}var us={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Fi={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},j;function G(){}h(G,D),G.prototype.g=function(){return new XMLHttpRequest},j=new G;function oe(u){return encodeURIComponent(String(u))}function _e(u){var m=1;u=u.split(":");const y=[];for(;m>0&&u.length;)y.push(u.shift()),m--;return u.length&&y.push(u.join(":")),y}function Ce(u,m,y,A){this.j=u,this.i=m,this.l=y,this.S=A||1,this.V=new xe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new qe}function qe(){this.i=null,this.g="",this.h=!1}var wt={},zn={};function Rn(u,m,y){u.M=1,u.A=Su(Hr(m)),u.u=y,u.R=!0,Ct(u,null)}function Ct(u,m){u.F=Date.now(),ds(u),u.B=Hr(u.A);var y=u.B,A=u.S;Array.isArray(A)||(A=[String(A)]),R_(y.i,"t",A),u.C=0,y=u.j.L,u.h=new qe,u.g=Y_(u.j,y?m:null,!u.u),u.P>0&&(u.O=new Ke(d(u.Y,u,u.g),u.P)),m=u.V,y=u.g,A=u.ba;var $="readystatechange";Array.isArray($)||($&&(lt[0]=$.toString()),$=lt);for(let H=0;H<$.length;H++){const de=_t(y,$[H],A||m.handleEvent,!1,m.h||m);if(!de)break;m.g[de.key]=de}m=u.J?me(u.J):{},u.u?(u.v||(u.v="POST"),m["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.B,u.v,u.u,m)):(u.v="GET",u.g.ea(u.B,u.v,null,m)),dt(),dn(u.i,u.v,u.B,u.l,u.S,u.u)}Ce.prototype.ba=function(u){u=u.target;const m=this.O;m&&Us(u)==3?m.j():this.Y(u)},Ce.prototype.Y=function(u){try{if(u==this.g)e:{const Ye=Us(this.g),Jt=this.g.ya(),yt=this.g.ca();if(!(Ye<3)&&(Ye!=3||this.g&&(this.h.h||this.g.la()||F_(this.g)))){this.K||Ye!=4||Jt==7||(Jt==8||yt<=0?dt(3):dt(2)),zo(this);var m=this.g.ca();this.X=m;var y=Pt(this);if(this.o=m==200,yn(this.i,this.v,this.B,this.l,this.S,Ye,m),this.o){if(this.U&&!this.L){t:{if(this.g){var A,$=this.g;if((A=$.g?$.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(A)){var H=A;break t}}H=null}if(u=H)vn(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Yf(this,u);else{this.o=!1,this.m=3,Qe(12),Ui(this),fs(this);break e}}if(this.R){u=!0;let rn;for(;!this.K&&this.C<y.length;)if(rn=Cr(this,y),rn==zn){Ye==4&&(this.m=4,Qe(14),u=!1),vn(this.i,this.l,null,"[Incomplete Response]");break}else if(rn==wt){this.m=4,Qe(15),vn(this.i,this.l,y,"[Invalid Chunk]"),u=!1;break}else vn(this.i,this.l,rn,null),Yf(this,rn);if(qn(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ye!=4||y.length!=0||this.h.h||(this.m=1,Qe(16),u=!1),this.o=this.o&&u,!u)vn(this.i,this.l,y,"[Invalid Chunked Response]"),Ui(this),fs(this);else if(y.length>0&&!this.W){this.W=!0;var de=this.j;de.g==this&&de.aa&&!de.P&&(de.j.info("Great, no buffering proxy detected. Bytes received: "+y.length),sp(de),de.P=!0,Qe(11))}}else vn(this.i,this.l,y,null),Yf(this,y);Ye==4&&Ui(this),this.o&&!this.K&&(Ye==4?W_(this.j,this):(this.o=!1,ds(this)))}else q1(this.g),m==400&&y.indexOf("Unknown SID")>0?(this.m=3,Qe(12)):(this.m=0,Qe(13)),Ui(this),fs(this)}}}catch{}finally{}};function Pt(u){if(!qn(u))return u.g.la();const m=F_(u.g);if(m==="")return"";let y="";const A=m.length,$=Us(u.g)==4;if(!u.h.i){if(typeof TextDecoder>"u")return Ui(u),fs(u),"";u.h.i=new a.TextDecoder}for(let H=0;H<A;H++)u.h.h=!0,y+=u.h.i.decode(m[H],{stream:!($&&H==A-1)});return m.length=0,u.h.g+=y,u.C=0,u.h.g}function qn(u){return u.g?u.v=="GET"&&u.M!=2&&u.j.Aa:!1}function Cr(u,m){var y=u.C,A=m.indexOf(`
`,y);return A==-1?zn:(y=Number(m.substring(y,A)),isNaN(y)?wt:(A+=1,A+y>m.length?zn:(m=m.slice(A,A+y),u.C=A+y,m)))}Ce.prototype.cancel=function(){this.K=!0,Ui(this)};function ds(u){u.T=Date.now()+u.H,hs(u,u.H)}function hs(u,m){if(u.D!=null)throw Error("WatchDog timer not null");u.D=Wt(d(u.aa,u),m)}function zo(u){u.D&&(a.clearTimeout(u.D),u.D=null)}Ce.prototype.aa=function(){this.D=null;const u=Date.now();u-this.T>=0?(Sr(this.i,this.B),this.M!=2&&(dt(),Qe(17)),Ui(this),this.m=2,fs(this)):hs(this,this.T-u)};function fs(u){u.j.I==0||u.K||W_(u.j,u)}function Ui(u){zo(u);var m=u.O;m&&typeof m.dispose=="function"&&m.dispose(),u.O=null,Ze(u.V),u.g&&(m=u.g,u.g=null,m.abort(),m.dispose())}function Yf(u,m){try{var y=u.j;if(y.I!=0&&(y.g==u||Xf(y.h,u))){if(!u.L&&Xf(y.h,u)&&y.I==3){try{var A=y.Ba.g.parse(m)}catch{A=null}if(Array.isArray(A)&&A.length==3){var $=A;if($[0]==0){e:if(!y.v){if(y.g)if(y.g.F+3e3<u.F)Au(y),Nu(y);else break e;rp(y),Qe(18)}}else y.xa=$[1],0<y.xa-y.K&&$[2]<37500&&y.F&&y.A==0&&!y.C&&(y.C=Wt(d(y.Va,y),6e3));I_(y.h)<=1&&y.ta&&(y.ta=void 0)}else Bi(y,11)}else if((u.L||y.g==u)&&Au(y),!k(m))for($=y.Ba.g.parse(m),m=0;m<$.length;m++){let yt=$[m];const rn=yt[0];if(!(rn<=y.K))if(y.K=rn,yt=yt[1],y.I==2)if(yt[0]=="c"){y.M=yt[1],y.ba=yt[2];const Wr=yt[3];Wr!=null&&(y.ka=Wr,y.j.info("VER="+y.ka));const zi=yt[4];zi!=null&&(y.za=zi,y.j.info("SVER="+y.za));const $s=yt[5];$s!=null&&typeof $s=="number"&&$s>0&&(A=1.5*$s,y.O=A,y.j.info("backChannelRequestTimeoutMs_="+A)),A=y;const Bs=u.g;if(Bs){const Ru=Bs.g?Bs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ru){var H=A.h;H.g||Ru.indexOf("spdy")==-1&&Ru.indexOf("quic")==-1&&Ru.indexOf("h2")==-1||(H.j=H.l,H.g=new Set,H.h&&(Jf(H,H.h),H.h=null))}if(A.G){const ip=Bs.g?Bs.g.getResponseHeader("X-HTTP-Session-Id"):null;ip&&(A.wa=ip,Et(A.J,A.G,ip))}}y.I=3,y.l&&y.l.ra(),y.aa&&(y.T=Date.now()-u.F,y.j.info("Handshake RTT: "+y.T+"ms")),A=y;var de=u;if(A.na=Q_(A,A.L?A.ba:null,A.W),de.L){S_(A.h,de);var Ye=de,Jt=A.O;Jt&&(Ye.H=Jt),Ye.D&&(zo(Ye),ds(Ye)),A.g=de}else q_(A);y.i.length>0&&ju(y)}else yt[0]!="stop"&&yt[0]!="close"||Bi(y,7);else y.I==3&&(yt[0]=="stop"||yt[0]=="close"?yt[0]=="stop"?Bi(y,7):np(y):yt[0]!="noop"&&y.l&&y.l.qa(yt),y.A=0)}}dt(4)}catch{}}var P1=class{constructor(u,m){this.g=u,this.map=m}};function w_(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=u.length>0&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function E_(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function I_(u){return u.h?1:u.g?u.g.size:0}function Xf(u,m){return u.h?u.h==m:u.g?u.g.has(m):!1}function Jf(u,m){u.g?u.g.add(m):u.h=m}function S_(u,m){u.h&&u.h==m?u.h=null:u.g&&u.g.has(m)&&u.g.delete(m)}w_.prototype.cancel=function(){if(this.i=C_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function C_(u){if(u.h!=null)return u.i.concat(u.h.G);if(u.g!=null&&u.g.size!==0){let m=u.i;for(const y of u.g.values())m=m.concat(y.G);return m}return x(u.i)}var T_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function R1(u,m){if(u){u=u.split("&");for(let y=0;y<u.length;y++){const A=u[y].indexOf("=");let $,H=null;A>=0?($=u[y].substring(0,A),H=u[y].substring(A+1)):$=u[y],m($,H?decodeURIComponent(H.replace(/\+/g," ")):"")}}}function Ms(u){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let m;u instanceof Ms?(this.l=u.l,vl(this,u.j),this.o=u.o,this.g=u.g,_l(this,u.u),this.h=u.h,Zf(this,k_(u.i)),this.m=u.m):u&&(m=String(u).match(T_))?(this.l=!1,vl(this,m[1]||"",!0),this.o=xl(m[2]||""),this.g=xl(m[3]||"",!0),_l(this,m[4]),this.h=xl(m[5]||"",!0),Zf(this,m[6]||"",!0),this.m=xl(m[7]||"")):(this.l=!1,this.i=new wl(null,this.l))}Ms.prototype.toString=function(){const u=[];var m=this.j;m&&u.push(bl(m,N_,!0),":");var y=this.g;return(y||m=="file")&&(u.push("//"),(m=this.o)&&u.push(bl(m,N_,!0),"@"),u.push(oe(y).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.u,y!=null&&u.push(":",String(y))),(y=this.h)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(bl(y,y.charAt(0)=="/"?L1:D1,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",bl(y,V1)),u.join("")},Ms.prototype.resolve=function(u){const m=Hr(this);let y=!!u.j;y?vl(m,u.j):y=!!u.o,y?m.o=u.o:y=!!u.g,y?m.g=u.g:y=u.u!=null;var A=u.h;if(y)_l(m,u.u);else if(y=!!u.h){if(A.charAt(0)!="/")if(this.g&&!this.h)A="/"+A;else{var $=m.h.lastIndexOf("/");$!=-1&&(A=m.h.slice(0,$+1)+A)}if($=A,$==".."||$==".")A="";else if($.indexOf("./")!=-1||$.indexOf("/.")!=-1){A=$.lastIndexOf("/",0)==0,$=$.split("/");const H=[];for(let de=0;de<$.length;){const Ye=$[de++];Ye=="."?A&&de==$.length&&H.push(""):Ye==".."?((H.length>1||H.length==1&&H[0]!="")&&H.pop(),A&&de==$.length&&H.push("")):(H.push(Ye),A=!0)}A=H.join("/")}else A=$}return y?m.h=A:y=u.i.toString()!=="",y?Zf(m,k_(u.i)):y=!!u.m,y&&(m.m=u.m),m};function Hr(u){return new Ms(u)}function vl(u,m,y){u.j=y?xl(m,!0):m,u.j&&(u.j=u.j.replace(/:$/,""))}function _l(u,m){if(m){if(m=Number(m),isNaN(m)||m<0)throw Error("Bad port number "+m);u.u=m}else u.u=null}function Zf(u,m,y){m instanceof wl?(u.i=m,M1(u.i,u.l)):(y||(m=bl(m,O1)),u.i=new wl(m,u.l))}function Et(u,m,y){u.i.set(m,y)}function Su(u){return Et(u,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),u}function xl(u,m){return u?m?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function bl(u,m,y){return typeof u=="string"?(u=encodeURI(u).replace(m,k1),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function k1(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var N_=/[#\/\?@]/g,D1=/[#\?:]/g,L1=/[#\?]/g,O1=/[#\?@]/g,V1=/#/g;function wl(u,m){this.h=this.g=null,this.i=u||null,this.j=!!m}function $i(u){u.g||(u.g=new Map,u.h=0,u.i&&R1(u.i,function(m,y){u.add(decodeURIComponent(m.replace(/\+/g," ")),y)}))}t=wl.prototype,t.add=function(u,m){$i(this),this.i=null,u=qo(this,u);let y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(m),this.h+=1,this};function j_(u,m){$i(u),m=qo(u,m),u.g.has(m)&&(u.i=null,u.h-=u.g.get(m).length,u.g.delete(m))}function A_(u,m){return $i(u),m=qo(u,m),u.g.has(m)}t.forEach=function(u,m){$i(this),this.g.forEach(function(y,A){y.forEach(function($){u.call(m,$,A,this)},this)},this)};function P_(u,m){$i(u);let y=[];if(typeof m=="string")A_(u,m)&&(y=y.concat(u.g.get(qo(u,m))));else for(u=Array.from(u.g.values()),m=0;m<u.length;m++)y=y.concat(u[m]);return y}t.set=function(u,m){return $i(this),this.i=null,u=qo(this,u),A_(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[m]),this.h+=1,this},t.get=function(u,m){return u?(u=P_(this,u),u.length>0?String(u[0]):m):m};function R_(u,m,y){j_(u,m),y.length>0&&(u.i=null,u.g.set(qo(u,m),x(y)),u.h+=y.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],m=Array.from(this.g.keys());for(let A=0;A<m.length;A++){var y=m[A];const $=oe(y);y=P_(this,y);for(let H=0;H<y.length;H++){let de=$;y[H]!==""&&(de+="="+oe(y[H])),u.push(de)}}return this.i=u.join("&")};function k_(u){const m=new wl;return m.i=u.i,u.g&&(m.g=new Map(u.g),m.h=u.h),m}function qo(u,m){return m=String(m),u.j&&(m=m.toLowerCase()),m}function M1(u,m){m&&!u.j&&($i(u),u.i=null,u.g.forEach(function(y,A){const $=A.toLowerCase();A!=$&&(j_(this,A),R_(this,$,y))},u)),u.j=m}function F1(u,m){const y=new ut;if(a.Image){const A=new Image;A.onload=f(Fs,y,"TestLoadImage: loaded",!0,m,A),A.onerror=f(Fs,y,"TestLoadImage: error",!1,m,A),A.onabort=f(Fs,y,"TestLoadImage: abort",!1,m,A),A.ontimeout=f(Fs,y,"TestLoadImage: timeout",!1,m,A),a.setTimeout(function(){A.ontimeout&&A.ontimeout()},1e4),A.src=u}else m(!1)}function U1(u,m){const y=new ut,A=new AbortController,$=setTimeout(()=>{A.abort(),Fs(y,"TestPingServer: timeout",!1,m)},1e4);fetch(u,{signal:A.signal}).then(H=>{clearTimeout($),H.ok?Fs(y,"TestPingServer: ok",!0,m):Fs(y,"TestPingServer: server error",!1,m)}).catch(()=>{clearTimeout($),Fs(y,"TestPingServer: error",!1,m)})}function Fs(u,m,y,A,$){try{$&&($.onload=null,$.onerror=null,$.onabort=null,$.ontimeout=null),A(y)}catch{}}function $1(){this.g=new ce}function ep(u){this.i=u.Sb||null,this.h=u.ab||!1}h(ep,D),ep.prototype.g=function(){return new Cu(this.i,this.h)};function Cu(u,m){B.call(this),this.H=u,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(Cu,B),t=Cu.prototype,t.open=function(u,m){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=u,this.D=m,this.readyState=1,Il(this)},t.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const m={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};u&&(m.body=u),(this.H||a).fetch(new Request(this.D,m)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,El(this)),this.readyState=0},t.Pa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Il(this)),this.g&&(this.readyState=3,Il(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;D_(this)}else u.text().then(this.Oa.bind(this),this.ga.bind(this))};function D_(u){u.j.read().then(u.Ma.bind(u)).catch(u.ga.bind(u))}t.Ma=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var m=u.value?u.value:new Uint8Array(0);(m=this.B.decode(m,{stream:!u.done}))&&(this.response=this.responseText+=m)}u.done?El(this):Il(this),this.readyState==3&&D_(this)}},t.Oa=function(u){this.g&&(this.response=this.responseText=u,El(this))},t.Na=function(u){this.g&&(this.response=u,El(this))},t.ga=function(){this.g&&El(this)};function El(u){u.readyState=4,u.l=null,u.j=null,u.B=null,Il(u)}t.setRequestHeader=function(u,m){this.A.append(u,m)},t.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],m=this.h.entries();for(var y=m.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=m.next();return u.join(`\r
`)};function Il(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Cu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function L_(u){let m="";return te(u,function(y,A){m+=A,m+=":",m+=y,m+=`\r
`}),m}function tp(u,m,y){e:{for(A in y){var A=!1;break e}A=!0}A||(y=L_(y),typeof u=="string"?y!=null&&oe(y):Et(u,m,y))}function Mt(u){B.call(this),this.headers=new Map,this.L=u||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(Mt,B);var B1=/^https?$/i,z1=["POST","PUT"];t=Mt.prototype,t.Fa=function(u){this.H=u},t.ea=function(u,m,y,A){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);m=m?m.toUpperCase():"GET",this.D=u,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():j.g(),this.g.onreadystatechange=p(d(this.Ca,this));try{this.B=!0,this.g.open(m,String(u),!0),this.B=!1}catch(H){O_(this,H);return}if(u=y||"",y=new Map(this.headers),A)if(Object.getPrototypeOf(A)===Object.prototype)for(var $ in A)y.set($,A[$]);else if(typeof A.keys=="function"&&typeof A.get=="function")for(const H of A.keys())y.set(H,A.get(H));else throw Error("Unknown input type for opt_headers: "+String(A));A=Array.from(y.keys()).find(H=>H.toLowerCase()=="content-type"),$=a.FormData&&u instanceof a.FormData,!(Array.prototype.indexOf.call(z1,m,void 0)>=0)||A||$||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[H,de]of y)this.g.setRequestHeader(H,de);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(u),this.v=!1}catch(H){O_(this,H)}};function O_(u,m){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=m,u.o=5,V_(u),Tu(u)}function V_(u){u.A||(u.A=!0,pe(u,"complete"),pe(u,"error"))}t.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=u||7,pe(this,"complete"),pe(this,"abort"),Tu(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Tu(this,!0)),Mt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?M_(this):this.Xa())},t.Xa=function(){M_(this)};function M_(u){if(u.h&&typeof i<"u"){if(u.v&&Us(u)==4)setTimeout(u.Ca.bind(u),0);else if(pe(u,"readystatechange"),Us(u)==4){u.h=!1;try{const H=u.ca();e:switch(H){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var y;if(!(y=m)){var A;if(A=H===0){let de=String(u.D).match(T_)[1]||null;!de&&a.self&&a.self.location&&(de=a.self.location.protocol.slice(0,-1)),A=!B1.test(de?de.toLowerCase():"")}y=A}if(y)pe(u,"complete"),pe(u,"success");else{u.o=6;try{var $=Us(u)>2?u.g.statusText:""}catch{$=""}u.l=$+" ["+u.ca()+"]",V_(u)}}finally{Tu(u)}}}}function Tu(u,m){if(u.g){u.m&&(clearTimeout(u.m),u.m=null);const y=u.g;u.g=null,m||pe(u,"ready");try{y.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Us(u){return u.g?u.g.readyState:0}t.ca=function(){try{return Us(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(u){if(this.g){var m=this.g.responseText;return u&&m.indexOf(u)==0&&(m=m.substring(u.length)),q(m)}};function F_(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.F){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function q1(u){const m={};u=(u.g&&Us(u)>=2&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let A=0;A<u.length;A++){if(k(u[A]))continue;var y=_e(u[A]);const $=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const H=m[$]||[];m[$]=H,H.push(y)}ne(m,function(A){return A.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Sl(u,m,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||m}function U_(u){this.za=0,this.i=[],this.j=new ut,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Sl("failFast",!1,u),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Sl("baseRetryDelayMs",5e3,u),this.Za=Sl("retryDelaySeedMs",1e4,u),this.Ta=Sl("forwardChannelMaxRetries",2,u),this.va=Sl("forwardChannelRequestTimeoutMs",2e4,u),this.ma=u&&u.xmlHttpFactory||void 0,this.Ua=u&&u.Rb||void 0,this.Aa=u&&u.useFetchStreams||!1,this.O=void 0,this.L=u&&u.supportsCrossDomainXhr||!1,this.M="",this.h=new w_(u&&u.concurrentRequestLimit),this.Ba=new $1,this.S=u&&u.fastHandshake||!1,this.R=u&&u.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=u&&u.Pb||!1,u&&u.ua&&this.j.ua(),u&&u.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&u&&u.detectBufferingProxy||!1,this.ia=void 0,u&&u.longPollingTimeout&&u.longPollingTimeout>0&&(this.ia=u.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=U_.prototype,t.ka=8,t.I=1,t.connect=function(u,m,y,A){Qe(0),this.W=u,this.H=m||{},y&&A!==void 0&&(this.H.OSID=y,this.H.OAID=A),this.F=this.X,this.J=Q_(this,null,this.W),ju(this)};function np(u){if($_(u),u.I==3){var m=u.V++,y=Hr(u.J);if(Et(y,"SID",u.M),Et(y,"RID",m),Et(y,"TYPE","terminate"),Cl(u,y),m=new Ce(u,u.j,m),m.M=2,m.A=Su(Hr(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(m.A.toString(),"")}catch{}!y&&a.Image&&(new Image().src=m.A,y=!0),y||(m.g=Y_(m.j,null),m.g.ea(m.A)),m.F=Date.now(),ds(m)}K_(u)}function Nu(u){u.g&&(sp(u),u.g.cancel(),u.g=null)}function $_(u){Nu(u),u.v&&(a.clearTimeout(u.v),u.v=null),Au(u),u.h.cancel(),u.m&&(typeof u.m=="number"&&a.clearTimeout(u.m),u.m=null)}function ju(u){if(!E_(u.h)&&!u.m){u.m=!0;var m=u.Ea;L||v(),V||(L(),V=!0),g.add(m,u),u.D=0}}function H1(u,m){return I_(u.h)>=u.h.j-(u.m?1:0)?!1:u.m?(u.i=m.G.concat(u.i),!0):u.I==1||u.I==2||u.D>=(u.Sa?0:u.Ta)?!1:(u.m=Wt(d(u.Ea,u,m),G_(u,u.D)),u.D++,!0)}t.Ea=function(u){if(this.m)if(this.m=null,this.I==1){if(!u){this.V=Math.floor(Math.random()*1e5),u=this.V++;const $=new Ce(this,this.j,u);let H=this.o;if(this.U&&(H?(H=me(H),ke(H,this.U)):H=this.U),this.u!==null||this.R||($.J=H,H=null),this.S)e:{for(var m=0,y=0;y<this.i.length;y++){t:{var A=this.i[y];if("__data__"in A.map&&(A=A.map.__data__,typeof A=="string")){A=A.length;break t}A=void 0}if(A===void 0)break;if(m+=A,m>4096){m=y;break e}if(m===4096||y===this.i.length-1){m=y+1;break e}}m=1e3}else m=1e3;m=z_(this,$,m),y=Hr(this.J),Et(y,"RID",u),Et(y,"CVER",22),this.G&&Et(y,"X-HTTP-Session-Id",this.G),Cl(this,y),H&&(this.R?m="headers="+oe(L_(H))+"&"+m:this.u&&tp(y,this.u,H)),Jf(this.h,$),this.Ra&&Et(y,"TYPE","init"),this.S?(Et(y,"$req",m),Et(y,"SID","null"),$.U=!0,Rn($,y,null)):Rn($,y,m),this.I=2}}else this.I==3&&(u?B_(this,u):this.i.length==0||E_(this.h)||B_(this))};function B_(u,m){var y;m?y=m.l:y=u.V++;const A=Hr(u.J);Et(A,"SID",u.M),Et(A,"RID",y),Et(A,"AID",u.K),Cl(u,A),u.u&&u.o&&tp(A,u.u,u.o),y=new Ce(u,u.j,y,u.D+1),u.u===null&&(y.J=u.o),m&&(u.i=m.G.concat(u.i)),m=z_(u,y,1e3),y.H=Math.round(u.va*.5)+Math.round(u.va*.5*Math.random()),Jf(u.h,y),Rn(y,A,m)}function Cl(u,m){u.H&&te(u.H,function(y,A){Et(m,A,y)}),u.l&&te({},function(y,A){Et(m,A,y)})}function z_(u,m,y){y=Math.min(u.i.length,y);const A=u.l?d(u.l.Ka,u.l,u):null;e:{var $=u.i;let Ye=-1;for(;;){const Jt=["count="+y];Ye==-1?y>0?(Ye=$[0].g,Jt.push("ofs="+Ye)):Ye=0:Jt.push("ofs="+Ye);let yt=!0;for(let rn=0;rn<y;rn++){var H=$[rn].g;const Wr=$[rn].map;if(H-=Ye,H<0)Ye=Math.max(0,$[rn].g-100),yt=!1;else try{H="req"+H+"_"||"";try{var de=Wr instanceof Map?Wr:Object.entries(Wr);for(const[zi,$s]of de){let Bs=$s;l($s)&&(Bs=bt($s)),Jt.push(H+zi+"="+encodeURIComponent(Bs))}}catch(zi){throw Jt.push(H+"type="+encodeURIComponent("_badmap")),zi}}catch{A&&A(Wr)}}if(yt){de=Jt.join("&");break e}}de=void 0}return u=u.i.splice(0,y),m.G=u,de}function q_(u){if(!u.g&&!u.v){u.Y=1;var m=u.Da;L||v(),V||(L(),V=!0),g.add(m,u),u.A=0}}function rp(u){return u.g||u.v||u.A>=3?!1:(u.Y++,u.v=Wt(d(u.Da,u),G_(u,u.A)),u.A++,!0)}t.Da=function(){if(this.v=null,H_(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var u=4*this.T;this.j.info("BP detection timer enabled: "+u),this.B=Wt(d(this.Wa,this),u)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Qe(10),Nu(this),H_(this))};function sp(u){u.B!=null&&(a.clearTimeout(u.B),u.B=null)}function H_(u){u.g=new Ce(u,u.j,"rpc",u.Y),u.u===null&&(u.g.J=u.o),u.g.P=0;var m=Hr(u.na);Et(m,"RID","rpc"),Et(m,"SID",u.M),Et(m,"AID",u.K),Et(m,"CI",u.F?"0":"1"),!u.F&&u.ia&&Et(m,"TO",u.ia),Et(m,"TYPE","xmlhttp"),Cl(u,m),u.u&&u.o&&tp(m,u.u,u.o),u.O&&(u.g.H=u.O);var y=u.g;u=u.ba,y.M=1,y.A=Su(Hr(m)),y.u=null,y.R=!0,Ct(y,u)}t.Va=function(){this.C!=null&&(this.C=null,Nu(this),rp(this),Qe(19))};function Au(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function W_(u,m){var y=null;if(u.g==m){Au(u),sp(u),u.g=null;var A=2}else if(Xf(u.h,m))y=m.G,S_(u.h,m),A=1;else return;if(u.I!=0){if(m.o)if(A==1){y=m.u?m.u.length:0,m=Date.now()-m.F;var $=u.D;A=Fe(),pe(A,new Jn(A,y)),ju(u)}else q_(u);else if($=m.m,$==3||$==0&&m.X>0||!(A==1&&H1(u,m)||A==2&&rp(u)))switch(y&&y.length>0&&(m=u.h,m.i=m.i.concat(y)),$){case 1:Bi(u,5);break;case 4:Bi(u,10);break;case 3:Bi(u,6);break;default:Bi(u,2)}}}function G_(u,m){let y=u.Qa+Math.floor(Math.random()*u.Za);return u.isActive()||(y*=2),y*m}function Bi(u,m){if(u.j.info("Error code "+m),m==2){var y=d(u.bb,u),A=u.Ua;const $=!A;A=new Ms(A||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||vl(A,"https"),Su(A),$?F1(A.toString(),y):U1(A.toString(),y)}else Qe(2);u.I=0,u.l&&u.l.pa(m),K_(u),$_(u)}t.bb=function(u){u?(this.j.info("Successfully pinged google.com"),Qe(2)):(this.j.info("Failed to ping google.com"),Qe(1))};function K_(u){if(u.I=0,u.ja=[],u.l){const m=C_(u.h);(m.length!=0||u.i.length!=0)&&(T(u.ja,m),T(u.ja,u.i),u.h.i.length=0,x(u.i),u.i.length=0),u.l.oa()}}function Q_(u,m,y){var A=y instanceof Ms?Hr(y):new Ms(y);if(A.g!="")m&&(A.g=m+"."+A.g),_l(A,A.u);else{var $=a.location;A=$.protocol,m=m?m+"."+$.hostname:$.hostname,$=+$.port;const H=new Ms(null);A&&vl(H,A),m&&(H.g=m),$&&_l(H,$),y&&(H.h=y),A=H}return y=u.G,m=u.wa,y&&m&&Et(A,y,m),Et(A,"VER",u.ka),Cl(u,A),A}function Y_(u,m,y){if(m&&!u.L)throw Error("Can't create secondary domain capable XhrIo object.");return m=u.Aa&&!u.ma?new Mt(new ep({ab:y})):new Mt(u.ma),m.Fa(u.L),m}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function X_(){}t=X_.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Pu(){}Pu.prototype.g=function(u,m){return new Zn(u,m)};function Zn(u,m){B.call(this),this.g=new U_(m),this.l=u,this.h=m&&m.messageUrlParams||null,u=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(u?u["X-WebChannel-Content-Type"]=m.messageContentType:u={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.sa&&(u?u["X-WebChannel-Client-Profile"]=m.sa:u={"X-WebChannel-Client-Profile":m.sa}),this.g.U=u,(u=m&&m.Qb)&&!k(u)&&(this.g.u=u),this.A=m&&m.supportsCrossDomainXhr||!1,this.v=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!k(m)&&(this.g.G=m,u=this.h,u!==null&&m in u&&(u=this.h,m in u&&delete u[m])),this.j=new Ho(this)}h(Zn,B),Zn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Zn.prototype.close=function(){np(this.g)},Zn.prototype.o=function(u){var m=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.v&&(y={},y.__data__=bt(u),u=y);m.i.push(new P1(m.Ya++,u)),m.I==3&&ju(m)},Zn.prototype.N=function(){this.g.l=null,delete this.j,np(this.g),delete this.g,Zn.Z.N.call(this)};function J_(u){ue.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var m=u.__sm__;if(m){e:{for(const y in m){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,m=m!==null&&u in m?m[u]:void 0),this.data=m}else this.data=u}h(J_,ue);function Z_(){Ae.call(this),this.status=1}h(Z_,Ae);function Ho(u){this.g=u}h(Ho,X_),Ho.prototype.ra=function(){pe(this.g,"a")},Ho.prototype.qa=function(u){pe(this.g,new J_(u))},Ho.prototype.pa=function(u){pe(this.g,new Z_)},Ho.prototype.oa=function(){pe(this.g,"b")},Pu.prototype.createWebChannel=Pu.prototype.g,Zn.prototype.send=Zn.prototype.o,Zn.prototype.open=Zn.prototype.m,Zn.prototype.close=Zn.prototype.close,LC=function(){return new Pu},DC=function(){return Fe()},kC=Pe,gg={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},us.NO_ERROR=0,us.TIMEOUT=8,us.HTTP_ERROR=6,Nd=us,Fi.COMPLETE="complete",RC=Fi,F.EventType=re,re.OPEN="a",re.CLOSE="b",re.ERROR="c",re.MESSAGE="d",B.prototype.listen=B.prototype.J,Xl=F,Mt.prototype.listenOnce=Mt.prototype.K,Mt.prototype.getLastError=Mt.prototype.Ha,Mt.prototype.getLastErrorCode=Mt.prototype.ya,Mt.prototype.getStatus=Mt.prototype.ca,Mt.prototype.getResponseJson=Mt.prototype.La,Mt.prototype.getResponseText=Mt.prototype.la,Mt.prototype.send=Mt.prototype.ea,Mt.prototype.setWithCredentials=Mt.prototype.Fa,PC=Mt}).apply(typeof Ju<"u"?Ju:typeof self<"u"?self:typeof window<"u"?window:{});const Kb="@firebase/firestore",Qb="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}fn.UNAUTHENTICATED=new fn(null),fn.GOOGLE_CREDENTIALS=new fn("google-credentials-uid"),fn.FIRST_PARTY=new fn("first-party-uid"),fn.MOCK_USER=new fn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hl="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bo=new uf("@firebase/firestore");function aa(){return bo.logLevel}function ie(t,...e){if(bo.logLevel<=tt.DEBUG){const n=e.map(ov);bo.debug(`Firestore (${hl}): ${t}`,...n)}}function Ln(t,...e){if(bo.logLevel<=tt.ERROR){const n=e.map(ov);bo.error(`Firestore (${hl}): ${t}`,...n)}}function wo(t,...e){if(bo.logLevel<=tt.WARN){const n=e.map(ov);bo.warn(`Firestore (${hl}): ${t}`,...n)}}function ov(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ee(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,OC(t,r,n)}function OC(t,e,n){let r=`FIRESTORE (${hl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Ln(r),new Error(r)}function Te(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||OC(e,s,r)}function Ue(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class le extends Ir{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VC{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class LL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(fn.UNAUTHENTICATED))}shutdown(){}}class OL{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class VL{constructor(e){this.t=e,this.currentUser=fn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Te(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let i=new Vr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Vr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{ie("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(ie("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Vr)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(ie("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Te(typeof r.accessToken=="string",31837,{l:r}),new VC(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Te(e===null||typeof e=="string",2055,{h:e}),new fn(e)}}class ML{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=fn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class FL{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new ML(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(fn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Yb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class UL{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,pr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Te(this.o===void 0,3512);const r=i=>{i.error!=null&&ie("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,ie("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{ie("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):ie("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Yb(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Te(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Yb(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $L(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class av{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=$L(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%62))}return r}}function ze(t,e){return t<e?-1:t>e?1:0}function yg(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),i=e.charAt(r);if(s!==i)return $p(s)===$p(i)?ze(s,i):$p(s)?1:-1}return ze(t.length,e.length)}const BL=55296,zL=57343;function $p(t){const e=t.charCodeAt(0);return e>=BL&&e<=zL}function Ha(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function MC(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xb="__name__";class Xr{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ee(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ee(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Xr.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Xr?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=Xr.compareSegments(e.get(s),n.get(s));if(i!==0)return i}return ze(e.length,n.length)}static compareSegments(e,n){const r=Xr.isNumericId(e),s=Xr.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?Xr.extractNumericId(e).compare(Xr.extractNumericId(n)):yg(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return xi.fromString(e.substring(4,e.length-2))}}class ct extends Xr{construct(e,n,r){return new ct(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new le(K.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new ct(n)}static emptyPath(){return new ct([])}}const qL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Dt extends Xr{construct(e,n,r){return new Dt(e,n,r)}static isValidIdentifier(e){return qL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Dt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Xb}static keyField(){return new Dt([Xb])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new le(K.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new le(K.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new le(K.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new le(K.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Dt(n)}static emptyPath(){return new Dt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{constructor(e){this.path=e}static fromPath(e){return new he(ct.fromString(e))}static fromName(e){return new he(ct.fromString(e).popFirst(5))}static empty(){return new he(ct.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ct.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ct.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new he(new ct(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FC(t,e,n){if(!n)throw new le(K.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function HL(t,e,n,r){if(e===!0&&r===!0)throw new le(K.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Jb(t){if(!he.isDocumentKey(t))throw new le(K.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Zb(t){if(he.isDocumentKey(t))throw new le(K.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function UC(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function gf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ee(12329,{type:typeof t})}function Nn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new le(K.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=gf(t);throw new le(K.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function WL(t,e){if(e<=0)throw new le(K.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yt(t,e){const n={typeString:t};return e&&(n.value=e),n}function hu(t,e){if(!UC(t))throw new le(K.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const a=t[r];if(s&&typeof a!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new le(K.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ew=-62135596800,tw=1e6;class ot{static now(){return ot.fromMillis(Date.now())}static fromDate(e){return ot.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*tw);return new ot(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new le(K.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new le(K.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<ew)throw new le(K.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new le(K.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/tw}_compareTo(e){return this.seconds===e.seconds?ze(this.nanoseconds,e.nanoseconds):ze(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ot._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(hu(e,ot._jsonSchema))return new ot(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-ew;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ot._jsonSchemaVersion="firestore/timestamp/1.0",ot._jsonSchema={type:Yt("string",ot._jsonSchemaVersion),seconds:Yt("number"),nanoseconds:Yt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je{static fromTimestamp(e){return new je(e)}static min(){return new je(new ot(0,0))}static max(){return new je(new ot(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qc=-1;class wh{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function vg(t){return t.fields.find(e=>e.kind===2)}function Ki(t){return t.fields.filter(e=>e.kind!==2)}wh.UNKNOWN_ID=-1;class jd{constructor(e,n){this.fieldPath=e,this.kind=n}}class Hc{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Hc(0,cr.min())}}function GL(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=je.fromTimestamp(r===1e9?new ot(n+1,0):new ot(n,r));return new cr(s,he.empty(),e)}function $C(t){return new cr(t.readTime,t.key,qc)}class cr{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new cr(je.min(),he.empty(),qc)}static max(){return new cr(je.max(),he.empty(),qc)}}function lv(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=he.comparator(t.documentKey,e.documentKey),n!==0?n:ze(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BC="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class zC{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $o(t){if(t.code!==K.FAILED_PRECONDITION||t.message!==BC)throw t;ie("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ee(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new U((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof U?n:U.resolve(n)}catch(n){return U.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):U.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):U.reject(n)}static resolve(e){return new U((n,r)=>{n(e)})}static reject(e){return new U((n,r)=>{r(e)})}static waitFor(e){return new U((n,r)=>{let s=0,i=0,a=!1;e.forEach(l=>{++s,l.next(()=>{++i,a&&i===s&&n()},c=>r(c))}),a=!0,i===s&&n()})}static or(e){let n=U.resolve(!1);for(const r of e)n=n.next(s=>s?U.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new U((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let c=0;c<i;c++){const d=c;n(e[d]).next(f=>{a[d]=f,++l,l===i&&r(a)},f=>s(f))}})}static doWhile(e,n){return new U((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rr="SimpleDb";class yf{static open(e,n,r,s){try{return new yf(n,e.transaction(s,r))}catch(i){throw new mc(n,i)}}constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.S=new Vr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{n.error?this.S.reject(new mc(e,n.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=cv(r.target.error);this.S.reject(new mc(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ie(rr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new QL(n)}}class bi{static delete(e){return ie(rr,"Removing database:",e),Yi(kS().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Ky())return!1;if(bi.F())return!0;const e=tn(),n=bi.M(e),r=0<n&&n<10,s=qC(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,n){return e.store(n)}static M(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,n,r){this.name=e,this.version=n,this.N=r,this.B=null,bi.M(tn())===12.2&&Ln("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(ie(rr,"Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;n(a)},s.onblocked=()=>{r(new mc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?r(new le(K.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new le(K.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new mc(e,a))},s.onupgradeneeded=i=>{ie(rr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next(()=>{ie(rr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=n=>this.q(n)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let a=0;for(;;){++a;try{this.db=await this.L(e);const l=yf.open(this.db,e,i?"readonly":"readwrite",r),c=s(l).next(d=>(l.C(),d)).catch(d=>(l.abort(d),U.reject(d))).toPromise();return c.catch(()=>{}),await l.D,c}catch(l){const c=l,d=c.name!=="FirebaseError"&&a<3;if(ie(rr,"Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function qC(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class KL{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Yi(this.U.delete())}}class mc extends le{constructor(e,n){super(K.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function Oi(t){return t.name==="IndexedDbTransactionError"}class QL{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(ie(rr,"PUT",this.store.name,e,n),r=this.store.put(n,e)):(ie(rr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Yi(r)}add(e){return ie(rr,"ADD",this.store.name,e,e),Yi(this.store.add(e))}get(e){return Yi(this.store.get(e)).next(n=>(n===void 0&&(n=null),ie(rr,"GET",this.store.name,e,n),n))}delete(e){return ie(rr,"DELETE",this.store.name,e),Yi(this.store.delete(e))}count(){return ie(rr,"COUNT",this.store.name),Yi(this.store.count())}J(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new U((a,l)=>{i.onerror=c=>{l(c.target.error)},i.onsuccess=c=>{a(c.target.result)}})}{const i=this.cursor(r),a=[];return this.H(i,(l,c)=>{a.push(c)}).next(()=>a)}}Y(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new U((s,i)=>{r.onerror=a=>{i(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}Z(e,n){ie(rr,"DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const s=this.cursor(r);return this.H(s,(i,a,l)=>l.delete())}ee(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.H(s,n)}te(e){const n=this.cursor({});return new U((r,s)=>{n.onerror=i=>{const a=cv(i.target.error);s(a)},n.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next(l=>{l?a.continue():r()}):r()}})}H(e,n){const r=[];return new U((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const l=a.target.result;if(!l)return void s();const c=new KL(l),d=n(l.primaryKey,l.value,c);if(d instanceof U){const f=d.catch(h=>(c.done(),U.reject(h)));r.push(f)}c.isDone?s():c.G===null?l.continue():l.continue(c.G)}}).next(()=>U.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function Yi(t){return new U((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=cv(r.target.error);n(s)}})}let nw=!1;function cv(t){const e=bi.M(tn());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new le("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nw||(nw=!0,setTimeout(()=>{throw r},0)),r}}return t}const gc="IndexBackfiller";class YL{constructor(e,n){this.asyncQueue=e,this.ne=n,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){ie(gc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const n=await this.ne.ie();ie(gc,`Documents written: ${n}`)}catch(n){Oi(n)?ie(gc,"Ignoring IndexedDB error during index backfill: ",n):await $o(n)}await this.re(6e4)})}}class XL{constructor(e,n){this.localStore=e,this.persistence=n}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.se(n,e))}se(e,n){const r=new Set;let s=n,i=!0;return U.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return ie(gc,`Processing collection: ${a}`),this.oe(e,a,s).next(l=>{s-=l,r.add(a)});i=!1})).next(()=>n-s)}oe(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this._e(s,i)).next(l=>(ie(gc,`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,n,l))).next(()=>a.size)}))}_e(e,n){let r=e;return n.changes.forEach((s,i)=>{const a=$C(i);lv(a,r)>0&&(r=a)}),new cr(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}yr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lo=-1;function vf(t){return t==null}function Wc(t){return t===0&&1/t==-1/0}function JL(t){return typeof t=="number"&&Number.isInteger(t)&&!Wc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eh="";function jn(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=rw(e)),e=ZL(t.get(n),e);return rw(e)}function ZL(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case Eh:n+="";break;default:n+=i}}return n}function rw(t){return t+Eh+""}function Zr(t){const e=t.length;if(Te(e>=2,64408,{path:t}),e===2)return Te(t.charAt(0)===Eh&&t.charAt(1)==="",56145,{path:t}),ct.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const a=t.indexOf(Eh,i);switch((a<0||a>n)&&Ee(50515,{path:t}),t.charAt(a+1)){case"":const l=t.substring(i,a);let c;s.length===0?c=l:(s+=l,c=s,s=""),r.push(c);break;case"":s+=t.substring(i,a),s+="\0";break;case"":s+=t.substring(i,a+1);break;default:Ee(61167,{path:t})}i=a+2}return new ct(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qi="remoteDocuments",fu="owner",Go="owner",Gc="mutationQueues",eO="userId",Pr="mutations",sw="batchId",so="userMutationsIndex",iw=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ad(t,e){return[t,jn(e)]}function HC(t,e,n){return[t,jn(e),n]}const tO={},Wa="documentMutations",Ih="remoteDocumentsV14",nO=["prefixPath","collectionGroup","readTime","documentId"],Pd="documentKeyIndex",rO=["prefixPath","collectionGroup","documentId"],WC="collectionGroupIndex",sO=["collectionGroup","readTime","prefixPath","documentId"],Kc="remoteDocumentGlobal",_g="remoteDocumentGlobalKey",Ga="targets",GC="queryTargetsIndex",iO=["canonicalId","targetId"],Ka="targetDocuments",oO=["targetId","path"],uv="documentTargetsIndex",aO=["path","targetId"],Sh="targetGlobalKey",co="targetGlobal",Qc="collectionParents",lO=["collectionId","parent"],Qa="clientMetadata",cO="clientId",_f="bundles",uO="bundleId",xf="namedQueries",dO="name",dv="indexConfiguration",hO="indexId",xg="collectionGroupIndex",fO="collectionGroup",yc="indexState",pO=["indexId","uid"],KC="sequenceNumberIndex",mO=["uid","sequenceNumber"],vc="indexEntries",gO=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],QC="documentKeyIndex",yO=["indexId","uid","orderedDocumentKey"],bf="documentOverlays",vO=["userId","collectionPath","documentId"],bg="collectionPathOverlayIndex",_O=["userId","collectionPath","largestBatchId"],YC="collectionGroupOverlayIndex",xO=["userId","collectionGroup","largestBatchId"],hv="globals",bO="name",XC=[Gc,Pr,Wa,Qi,Ga,fu,co,Ka,Qa,Kc,Qc,_f,xf],wO=[...XC,bf],JC=[Gc,Pr,Wa,Ih,Ga,fu,co,Ka,Qa,Kc,Qc,_f,xf,bf],ZC=JC,fv=[...ZC,dv,yc,vc],EO=fv,eT=[...fv,hv],IO=eT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg extends zC{constructor(e,n){super(),this.le=e,this.currentSequenceNumber=n}}function nn(t,e){const n=Ue(t);return bi.O(n.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ow(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Vi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function SO(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function tT(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e,n){this.comparator=e,this.root=n||pn.EMPTY}insert(e,n){return new At(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,pn.BLACK,null,null))}remove(e){return new At(this.comparator,this.root.remove(e,this.comparator).copy(null,null,pn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Zu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Zu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Zu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Zu(this.root,e,this.comparator,!0)}}class Zu{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class pn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??pn.RED,this.left=s??pn.EMPTY,this.right=i??pn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new pn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return pn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return pn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,pn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,pn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ee(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ee(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ee(27949);return e+(this.isRed()?0:1)}}pn.EMPTY=null,pn.RED=!0,pn.BLACK=!1;pn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ee(57766)}get value(){throw Ee(16141)}get color(){throw Ee(16727)}get left(){throw Ee(29726)}get right(){throw Ee(36894)}copy(e,n,r,s,i){return this}insert(e,n,r){return new pn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mt{constructor(e){this.comparator=e,this.data=new At(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new aw(this.data.getIterator())}getIteratorFrom(e){return new aw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof mt)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new mt(this.comparator);return n.data=e,n}}class aw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ko(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{constructor(e){this.fields=e,e.sort(Dt.comparator)}static empty(){return new Gn([])}unionWith(e){let n=new mt(Dt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Gn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ha(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new nT("Invalid base64 string: "+i):i}}(e);return new Xt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Xt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ze(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xt.EMPTY_BYTE_STRING=new Xt("");const CO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ks(t){if(Te(!!t,39018),typeof t=="string"){let e=0;const n=CO.exec(t);if(Te(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Tt(t.seconds),nanos:Tt(t.nanos)}}function Tt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ds(t){return typeof t=="string"?Xt.fromBase64String(t):Xt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rT="server_timestamp",sT="__type__",iT="__previous_value__",oT="__local_write_time__";function wf(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[sT])==null?void 0:r.stringValue)===rT}function Ef(t){const e=t.mapValue.fields[iT];return wf(e)?Ef(e):e}function Yc(t){const e=ks(t.mapValue.fields[oT].timestampValue);return new ot(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TO{constructor(e,n,r,s,i,a,l,c,d,f){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=f}}const Ch="(default)";class Eo{constructor(e,n){this.projectId=e,this.database=n||Ch}static empty(){return new Eo("","")}get isDefaultDatabase(){return this.database===Ch}isEqual(e){return e instanceof Eo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pv="__type__",aT="__max__",li={mapValue:{fields:{__type__:{stringValue:aT}}}},mv="__vector__",Ya="value",Rd={nullValue:"NULL_VALUE"};function Si(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?wf(t)?4:lT(t)?9007199254740991:If(t)?10:11:Ee(28295,{value:t})}function ls(t,e){if(t===e)return!0;const n=Si(t);if(n!==Si(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Yc(t).isEqual(Yc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=ks(s.timestampValue),l=ks(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return Ds(s.bytesValue).isEqual(Ds(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return Tt(s.geoPointValue.latitude)===Tt(i.geoPointValue.latitude)&&Tt(s.geoPointValue.longitude)===Tt(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Tt(s.integerValue)===Tt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=Tt(s.doubleValue),l=Tt(i.doubleValue);return a===l?Wc(a)===Wc(l):isNaN(a)&&isNaN(l)}return!1}(t,e);case 9:return Ha(t.arrayValue.values||[],e.arrayValue.values||[],ls);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(ow(a)!==ow(l))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(l[c]===void 0||!ls(a[c],l[c])))return!1;return!0}(t,e);default:return Ee(52216,{left:t})}}function Xc(t,e){return(t.values||[]).find(n=>ls(n,e))!==void 0}function Ci(t,e){if(t===e)return 0;const n=Si(t),r=Si(e);if(n!==r)return ze(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ze(t.booleanValue,e.booleanValue);case 2:return function(i,a){const l=Tt(i.integerValue||i.doubleValue),c=Tt(a.integerValue||a.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return lw(t.timestampValue,e.timestampValue);case 4:return lw(Yc(t),Yc(e));case 5:return yg(t.stringValue,e.stringValue);case 6:return function(i,a){const l=Ds(i),c=Ds(a);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(i,a){const l=i.split("/"),c=a.split("/");for(let d=0;d<l.length&&d<c.length;d++){const f=ze(l[d],c[d]);if(f!==0)return f}return ze(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,a){const l=ze(Tt(i.latitude),Tt(a.latitude));return l!==0?l:ze(Tt(i.longitude),Tt(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return cw(t.arrayValue,e.arrayValue);case 10:return function(i,a){var p,x,T,C;const l=i.fields||{},c=a.fields||{},d=(p=l[Ya])==null?void 0:p.arrayValue,f=(x=c[Ya])==null?void 0:x.arrayValue,h=ze(((T=d==null?void 0:d.values)==null?void 0:T.length)||0,((C=f==null?void 0:f.values)==null?void 0:C.length)||0);return h!==0?h:cw(d,f)}(t.mapValue,e.mapValue);case 11:return function(i,a){if(i===li.mapValue&&a===li.mapValue)return 0;if(i===li.mapValue)return 1;if(a===li.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),d=a.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let h=0;h<c.length&&h<f.length;++h){const p=yg(c[h],f[h]);if(p!==0)return p;const x=Ci(l[c[h]],d[f[h]]);if(x!==0)return x}return ze(c.length,f.length)}(t.mapValue,e.mapValue);default:throw Ee(23264,{he:n})}}function lw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ze(t,e);const n=ks(t),r=ks(e),s=ze(n.seconds,r.seconds);return s!==0?s:ze(n.nanos,r.nanos)}function cw(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=Ci(n[s],r[s]);if(i)return i}return ze(n.length,r.length)}function Xa(t){return Eg(t)}function Eg(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=ks(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Ds(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return he.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=Eg(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${Eg(n.fields[a])}`;return s+"}"}(t.mapValue):Ee(61005,{value:t})}function kd(t){switch(Si(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Ef(t);return e?16+kd(e):16;case 5:return 2*t.stringValue.length;case 6:return Ds(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+kd(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return Vi(r.fields,(i,a)=>{s+=i.length+kd(a)}),s}(t.mapValue);default:throw Ee(13486,{value:t})}}function Io(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ig(t){return!!t&&"integerValue"in t}function Jc(t){return!!t&&"arrayValue"in t}function uw(t){return!!t&&"nullValue"in t}function dw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Dd(t){return!!t&&"mapValue"in t}function If(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[pv])==null?void 0:r.stringValue)===mv}function _c(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Vi(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=_c(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=_c(t.arrayValue.values[n]);return e}return{...t}}function lT(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===aT}const cT={mapValue:{fields:{[pv]:{stringValue:mv},[Ya]:{arrayValue:{}}}}};function NO(t){return"nullValue"in t?Rd:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Io(Eo.empty(),he.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?If(t)?cT:{mapValue:{}}:Ee(35942,{value:t})}function jO(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Io(Eo.empty(),he.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?cT:"mapValue"in t?If(t)?{mapValue:{}}:li:Ee(61959,{value:t})}function hw(t,e){const n=Ci(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function fw(t,e){const n=Ci(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cn{constructor(e){this.value=e}static empty(){return new Cn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Dd(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=_c(n)}setAll(e){let n=Dt.emptyPath(),r={},s=[];e.forEach((a,l)=>{if(!n.isImmediateParentOf(l)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=l.popLast()}a?r[l.lastSegment()]=_c(a):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Dd(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return ls(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Dd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Vi(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Cn(_c(this.value))}}function uT(t){const e=[];return Vi(t.fields,(n,r)=>{const s=new Dt([n]);if(Dd(r)){const i=uT(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new Gn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e,n,r,s,i,a,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Ut(e,0,je.min(),je.min(),je.min(),Cn.empty(),0)}static newFoundDocument(e,n,r,s){return new Ut(e,1,n,je.min(),r,s,0)}static newNoDocument(e,n){return new Ut(e,2,n,je.min(),je.min(),Cn.empty(),0)}static newUnknownDocument(e,n){return new Ut(e,3,n,je.min(),je.min(),Cn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(je.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Cn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Cn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=je.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ut&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ut(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e,n){this.position=e,this.inclusive=n}}function pw(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],a=t.position[s];if(i.field.isKeyField()?r=he.comparator(he.fromName(a.referenceValue),n.key):r=Ci(a,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function mw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ls(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(e,n="asc"){this.field=e,this.dir=n}}function AO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dT{}class nt extends dT{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new PO(e,n,r):n==="array-contains"?new DO(e,r):n==="in"?new yT(e,r):n==="not-in"?new LO(e,r):n==="array-contains-any"?new OO(e,r):new nt(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new RO(e,r):new kO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Ci(n,this.value)):n!==null&&Si(this.value)===Si(n)&&this.matchesComparison(Ci(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ee(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ft extends dT{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new ft(e,n)}matches(e){return Ja(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ja(t){return t.op==="and"}function Sg(t){return t.op==="or"}function gv(t){return hT(t)&&Ja(t)}function hT(t){for(const e of t.filters)if(e instanceof ft)return!1;return!0}function Cg(t){if(t instanceof nt)return t.field.canonicalString()+t.op.toString()+Xa(t.value);if(gv(t))return t.filters.map(e=>Cg(e)).join(",");{const e=t.filters.map(n=>Cg(n)).join(",");return`${t.op}(${e})`}}function fT(t,e){return t instanceof nt?function(r,s){return s instanceof nt&&r.op===s.op&&r.field.isEqual(s.field)&&ls(r.value,s.value)}(t,e):t instanceof ft?function(r,s){return s instanceof ft&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,l)=>i&&fT(a,s.filters[l]),!0):!1}(t,e):void Ee(19439)}function pT(t,e){const n=t.filters.concat(e);return ft.create(n,t.op)}function mT(t){return t instanceof nt?function(n){return`${n.field.canonicalString()} ${n.op} ${Xa(n.value)}`}(t):t instanceof ft?function(n){return n.op.toString()+" {"+n.getFilters().map(mT).join(" ,")+"}"}(t):"Filter"}class PO extends nt{constructor(e,n,r){super(e,n,r),this.key=he.fromName(r.referenceValue)}matches(e){const n=he.comparator(e.key,this.key);return this.matchesComparison(n)}}class RO extends nt{constructor(e,n){super(e,"in",n),this.keys=gT("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class kO extends nt{constructor(e,n){super(e,"not-in",n),this.keys=gT("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function gT(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>he.fromName(r.referenceValue))}class DO extends nt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Jc(n)&&Xc(n.arrayValue,this.value)}}class yT extends nt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Xc(this.value.arrayValue,n)}}class LO extends nt{constructor(e,n){super(e,"not-in",n)}matches(e){if(Xc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Xc(this.value.arrayValue,n)}}class OO extends nt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Jc(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Xc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VO{constructor(e,n=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Te=null}}function Tg(t,e=null,n=[],r=[],s=null,i=null,a=null){return new VO(t,e,n,r,s,i,a)}function So(t){const e=Ue(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Cg(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),vf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Xa(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Xa(r)).join(",")),e.Te=n}return e.Te}function pu(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!AO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!fT(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!mw(t.startAt,e.startAt)&&mw(t.endAt,e.endAt)}function Th(t){return he.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function Nh(t,e){return t.filters.filter(n=>n instanceof nt&&n.field.isEqual(e))}function gw(t,e,n){let r=Rd,s=!0;for(const i of Nh(t,e)){let a=Rd,l=!0;switch(i.op){case"<":case"<=":a=NO(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,l=!1;break;case"!=":case"not-in":a=Rd}hw({value:r,inclusive:s},{value:a,inclusive:l})<0&&(r=a,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];hw({value:r,inclusive:s},{value:a,inclusive:n.inclusive})<0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}function yw(t,e,n){let r=li,s=!0;for(const i of Nh(t,e)){let a=li,l=!0;switch(i.op){case">=":case">":a=jO(i.value),l=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,l=!1;break;case"!=":case"not-in":a=li}fw({value:r,inclusive:s},{value:a,inclusive:l})>0&&(r=a,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];fw({value:r,inclusive:s},{value:a,inclusive:n.inclusive})>0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(e,n=null,r=[],s=[],i=null,a="F",l=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function MO(t,e,n,r,s,i,a,l){return new Mi(t,e,n,r,s,i,a,l)}function mu(t){return new Mi(t)}function vw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function yv(t){return t.collectionGroup!==null}function ka(t){const e=Ue(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new mt(Dt.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Zc(i,r))}),n.has(Dt.keyField().canonicalString())||e.Ie.push(new Zc(Dt.keyField(),r))}return e.Ie}function _r(t){const e=Ue(t);return e.Ee||(e.Ee=vT(e,ka(t))),e.Ee}function FO(t){const e=Ue(t);return e.de||(e.de=vT(e,t.explicitOrderBy)),e.de}function vT(t,e){if(t.limitType==="F")return Tg(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Zc(s.field,i)});const n=t.endAt?new Ti(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ti(t.startAt.position,t.startAt.inclusive):null;return Tg(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Ng(t,e){const n=t.filters.concat([e]);return new Mi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function jh(t,e,n){return new Mi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Sf(t,e){return pu(_r(t),_r(e))&&t.limitType===e.limitType}function _T(t){return`${So(_r(t))}|lt:${t.limitType}`}function la(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>mT(s)).join(", ")}]`),vf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Xa(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Xa(s)).join(",")),`Target(${r})`}(_r(t))}; limitType=${t.limitType})`}function gu(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):he.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of ka(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(a,l,c){const d=pw(a,l,c);return a.inclusive?d<=0:d<0}(r.startAt,ka(r),s)||r.endAt&&!function(a,l,c){const d=pw(a,l,c);return a.inclusive?d>=0:d>0}(r.endAt,ka(r),s))}(t,e)}function UO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function xT(t){return(e,n)=>{let r=!1;for(const s of ka(t)){const i=$O(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function $O(t,e,n){const r=t.field.isKeyField()?he.comparator(e.key,n.key):function(i,a,l){const c=a.data.field(i),d=l.data.field(i);return c!==null&&d!==null?Ci(c,d):Ee(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ee(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Vi(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return tT(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BO=new At(he.comparator);function ir(){return BO}const bT=new At(he.comparator);function Jl(...t){let e=bT;for(const n of t)e=e.insert(n.key,n);return e}function wT(t){let e=bT;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function es(){return xc()}function ET(){return xc()}function xc(){return new Os(t=>t.toString(),(t,e)=>t.isEqual(e))}const zO=new At(he.comparator),qO=new mt(he.comparator);function Je(...t){let e=qO;for(const n of t)e=e.add(n);return e}const HO=new mt(ze);function WO(){return HO}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vv(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wc(e)?"-0":e}}function IT(t){return{integerValue:""+t}}function ST(t,e){return JL(e)?IT(e):vv(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(){this._=void 0}}function GO(t,e,n){return t instanceof Za?function(s,i){const a={fields:{[sT]:{stringValue:rT},[oT]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&wf(i)&&(i=Ef(i)),i&&(a.fields[iT]=i),{mapValue:a}}(n,e):t instanceof Co?TT(t,e):t instanceof el?NT(t,e):function(s,i){const a=CT(s,i),l=_w(a)+_w(s.Ae);return Ig(a)&&Ig(s.Ae)?IT(l):vv(s.serializer,l)}(t,e)}function KO(t,e,n){return t instanceof Co?TT(t,e):t instanceof el?NT(t,e):n}function CT(t,e){return t instanceof tl?function(r){return Ig(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Za extends Cf{}class Co extends Cf{constructor(e){super(),this.elements=e}}function TT(t,e){const n=jT(e);for(const r of t.elements)n.some(s=>ls(s,r))||n.push(r);return{arrayValue:{values:n}}}class el extends Cf{constructor(e){super(),this.elements=e}}function NT(t,e){let n=jT(e);for(const r of t.elements)n=n.filter(s=>!ls(s,r));return{arrayValue:{values:n}}}class tl extends Cf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function _w(t){return Tt(t.integerValue||t.doubleValue)}function jT(t){return Jc(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,n){this.field=e,this.transform=n}}function QO(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof Co&&s instanceof Co||r instanceof el&&s instanceof el?Ha(r.elements,s.elements,ls):r instanceof tl&&s instanceof tl?ls(r.Ae,s.Ae):r instanceof Za&&s instanceof Za}(t.transform,e.transform)}class YO{constructor(e,n){this.version=e,this.transformResults=n}}class Tn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Tn}static exists(e){return new Tn(void 0,e)}static updateTime(e){return new Tn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ld(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Nf{}function AT(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new jf(t.key,Tn.none()):new fl(t.key,t.data,Tn.none());{const n=t.data,r=Cn.empty();let s=new mt(Dt.comparator);for(let i of e.fields)if(!s.has(i)){let a=n.field(i);a===null&&i.length>1&&(i=i.popLast(),a=n.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Vs(t.key,r,new Gn(s.toArray()),Tn.none())}}function XO(t,e,n){t instanceof fl?function(s,i,a){const l=s.value.clone(),c=bw(s.fieldTransforms,i,a.transformResults);l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Vs?function(s,i,a){if(!Ld(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=bw(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(PT(s)),c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(t,e,n):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function bc(t,e,n,r){return t instanceof fl?function(i,a,l,c){if(!Ld(i.precondition,a))return l;const d=i.value.clone(),f=ww(i.fieldTransforms,c,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Vs?function(i,a,l,c){if(!Ld(i.precondition,a))return l;const d=ww(i.fieldTransforms,c,a),f=a.data;return f.setAll(PT(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(t,e,n,r):function(i,a,l){return Ld(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(t,e,n)}function JO(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=CT(r.transform,s||null);i!=null&&(n===null&&(n=Cn.empty()),n.set(r.field,i))}return n||null}function xw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ha(r,s,(i,a)=>QO(i,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class fl extends Nf{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Vs extends Nf{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function PT(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function bw(t,e,n){const r=new Map;Te(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,KO(a,l,n[s]))}return r}function ww(t,e,n){const r=new Map;for(const s of t){const i=s.transform,a=n.data.field(s.field);r.set(s.field,GO(i,a,e))}return r}class jf extends Nf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class RT extends Nf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _v{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&XO(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=bc(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=bc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=ET();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=n.has(s.key)?null:l;const c=AT(a,l);c!==null&&r.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(je.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Je())}isEqual(e){return this.batchId===e.batchId&&Ha(this.mutations,e.mutations,(n,r)=>xw(n,r))&&Ha(this.baseMutations,e.baseMutations,(n,r)=>xw(n,r))}}class xv{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Te(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return zO}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new xv(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bv{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZO{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eV{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kt,it;function tV(t){switch(t){case K.OK:return Ee(64938);case K.CANCELLED:case K.UNKNOWN:case K.DEADLINE_EXCEEDED:case K.RESOURCE_EXHAUSTED:case K.INTERNAL:case K.UNAVAILABLE:case K.UNAUTHENTICATED:return!1;case K.INVALID_ARGUMENT:case K.NOT_FOUND:case K.ALREADY_EXISTS:case K.PERMISSION_DENIED:case K.FAILED_PRECONDITION:case K.ABORTED:case K.OUT_OF_RANGE:case K.UNIMPLEMENTED:case K.DATA_LOSS:return!0;default:return Ee(15467,{code:t})}}function kT(t){if(t===void 0)return Ln("GRPC error has no .code"),K.UNKNOWN;switch(t){case Kt.OK:return K.OK;case Kt.CANCELLED:return K.CANCELLED;case Kt.UNKNOWN:return K.UNKNOWN;case Kt.DEADLINE_EXCEEDED:return K.DEADLINE_EXCEEDED;case Kt.RESOURCE_EXHAUSTED:return K.RESOURCE_EXHAUSTED;case Kt.INTERNAL:return K.INTERNAL;case Kt.UNAVAILABLE:return K.UNAVAILABLE;case Kt.UNAUTHENTICATED:return K.UNAUTHENTICATED;case Kt.INVALID_ARGUMENT:return K.INVALID_ARGUMENT;case Kt.NOT_FOUND:return K.NOT_FOUND;case Kt.ALREADY_EXISTS:return K.ALREADY_EXISTS;case Kt.PERMISSION_DENIED:return K.PERMISSION_DENIED;case Kt.FAILED_PRECONDITION:return K.FAILED_PRECONDITION;case Kt.ABORTED:return K.ABORTED;case Kt.OUT_OF_RANGE:return K.OUT_OF_RANGE;case Kt.UNIMPLEMENTED:return K.UNIMPLEMENTED;case Kt.DATA_LOSS:return K.DATA_LOSS;default:return Ee(39323,{code:t})}}(it=Kt||(Kt={}))[it.OK=0]="OK",it[it.CANCELLED=1]="CANCELLED",it[it.UNKNOWN=2]="UNKNOWN",it[it.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",it[it.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",it[it.NOT_FOUND=5]="NOT_FOUND",it[it.ALREADY_EXISTS=6]="ALREADY_EXISTS",it[it.PERMISSION_DENIED=7]="PERMISSION_DENIED",it[it.UNAUTHENTICATED=16]="UNAUTHENTICATED",it[it.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",it[it.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",it[it.ABORTED=10]="ABORTED",it[it.OUT_OF_RANGE=11]="OUT_OF_RANGE",it[it.UNIMPLEMENTED=12]="UNIMPLEMENTED",it[it.INTERNAL=13]="INTERNAL",it[it.UNAVAILABLE=14]="UNAVAILABLE",it[it.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nV(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rV=new xi([4294967295,4294967295],0);function Ew(t){const e=nV().encode(t),n=new AC;return n.update(e),new Uint8Array(n.digest())}function Iw(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new xi([n,r],0),new xi([s,i],0)]}class wv{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Zl(`Invalid padding: ${n}`);if(r<0)throw new Zl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Zl(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Zl(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=xi.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(xi.fromNumber(r)));return s.compare(rV)===1&&(s=new xi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=Ew(e),[r,s]=Iw(n);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new wv(i,s,n);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.ge===0)return;const n=Ew(e),[r,s]=Iw(n);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Zl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,yu.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Af(je.min(),s,new At(ze),ir(),Je())}}class yu{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new yu(r,n,Je(),Je(),Je())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class DT{constructor(e,n){this.targetId=e,this.Ce=n}}class LT{constructor(e,n,r=Xt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Sw{constructor(){this.ve=0,this.Fe=Cw(),this.Me=Xt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Je(),n=Je(),r=Je();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:Ee(38017,{changeType:i})}}),new yu(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=Cw()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Te(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class sV{constructor(e){this.Ge=e,this.ze=new Map,this.je=ir(),this.Je=ed(),this.He=ed(),this.Ye=new At(ze)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ee(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,s)=>{this.rt(s)&&n(s)})}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const i=s.target;if(Th(i))if(r===0){const a=new he(i.path);this.et(n,a,Ut.newNoDocument(a,je.min()))}else Te(r===1,20013,{expectedCount:r});else{const a=this._t(n);if(a!==r){const l=this.ut(e),c=l?this.ct(l,e,a):1;if(c!==0){this.it(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,d)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let a,l;try{a=Ds(r).toUint8Array()}catch(c){if(c instanceof nT)return wo("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new wv(a,s,i)}catch(c){return wo(c instanceof Zl?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(n,i,null),s++)}),s}Tt(e){const n=new Map;this.ze.forEach((i,a)=>{const l=this.ot(a);if(l){if(i.current&&Th(l.target)){const c=new he(l.target.path);this.It(c).has(a)||this.Et(a,c)||this.et(a,c,Ut.newNoDocument(c,e))}i.Be&&(n.set(a,i.ke()),i.qe())}});let r=Je();this.He.forEach((i,a)=>{let l=!0;a.forEachWhile(c=>{const d=this.ot(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.je.forEach((i,a)=>a.setReadTime(e));const s=new Af(e,n,this.Ye,this.je,r);return this.je=ir(),this.Je=ed(),this.He=ed(),this.Ye=new At(ze),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new Sw,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new mt(ze),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new mt(ze),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||ie("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Sw),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function ed(){return new At(he.comparator)}function Cw(){return new At(he.comparator)}const iV={asc:"ASCENDING",desc:"DESCENDING"},oV={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aV={and:"AND",or:"OR"};class lV{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function jg(t,e){return t.useProto3Json||vf(e)?e:{value:e}}function nl(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function OT(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function cV(t,e){return nl(t,e.toTimestamp())}function Mn(t){return Te(!!t,49232),je.fromTimestamp(function(n){const r=ks(n);return new ot(r.seconds,r.nanos)}(t))}function Ev(t,e){return Ag(t,e).canonicalString()}function Ag(t,e){const n=function(s){return new ct(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function VT(t){const e=ct.fromString(t);return Te(HT(e),10190,{key:e.toString()}),e}function Ah(t,e){return Ev(t.databaseId,e.path)}function uo(t,e){const n=VT(e);if(n.get(1)!==t.databaseId.projectId)throw new le(K.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new le(K.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new he(UT(n))}function MT(t,e){return Ev(t.databaseId,e)}function FT(t){const e=VT(t);return e.length===4?ct.emptyPath():UT(e)}function Pg(t){return new ct(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function UT(t){return Te(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function Tw(t,e,n){return{name:Ah(t,e),fields:n.value.mapValue.fields}}function uV(t,e,n){const r=uo(t,e.name),s=Mn(e.updateTime),i=e.createTime?Mn(e.createTime):je.min(),a=new Cn({mapValue:{fields:e.fields}}),l=Ut.newFoundDocument(r,s,i,a);return n&&l.setHasCommittedMutations(),n?l.setHasCommittedMutations():l}function dV(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Ee(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(Te(f===void 0||typeof f=="string",58123),Xt.fromBase64String(f||"")):(Te(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Xt.fromUint8Array(f||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(d){const f=d.code===void 0?K.UNKNOWN:kT(d.code);return new le(f,d.message||"")}(a);n=new LT(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=uo(t,r.document.name),i=Mn(r.document.updateTime),a=r.document.createTime?Mn(r.document.createTime):je.min(),l=new Cn({mapValue:{fields:r.document.fields}}),c=Ut.newFoundDocument(s,i,a,l),d=r.targetIds||[],f=r.removedTargetIds||[];n=new Od(d,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=uo(t,r.document),i=r.readTime?Mn(r.readTime):je.min(),a=Ut.newNoDocument(s,i),l=r.removedTargetIds||[];n=new Od([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=uo(t,r.document),i=r.removedTargetIds||[];n=new Od([],i,s,null)}else{if(!("filter"in e))return Ee(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new eV(s,i),l=r.targetId;n=new DT(l,a)}}return n}function Ph(t,e){let n;if(e instanceof fl)n={update:Tw(t,e.key,e.value)};else if(e instanceof jf)n={delete:Ah(t,e.key)};else if(e instanceof Vs)n={update:Tw(t,e.key,e.data),updateMask:vV(e.fieldMask)};else{if(!(e instanceof RT))return Ee(16599,{Vt:e.type});n={verify:Ah(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const l=a.transform;if(l instanceof Za)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Co)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof el)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof tl)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw Ee(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:cV(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ee(27497)}(t,e.precondition)),n}function Rg(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?Tn.updateTime(Mn(i.updateTime)):i.exists!==void 0?Tn.exists(i.exists):Tn.none()}(e.currentDocument):Tn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(a,l){let c=null;if("setToServerValue"in l)Te(l.setToServerValue==="REQUEST_TIME",16630,{proto:l}),c=new Za;else if("appendMissingElements"in l){const f=l.appendMissingElements.values||[];c=new Co(f)}else if("removeAllFromArray"in l){const f=l.removeAllFromArray.values||[];c=new el(f)}else"increment"in l?c=new tl(a,l.increment):Ee(16584,{proto:l});const d=Dt.fromServerFormat(l.fieldPath);return new Tf(d,c)}(t,s)):[];if(e.update){e.update.name;const s=uo(t,e.update.name),i=new Cn({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(c){const d=c.fieldPaths||[];return new Gn(d.map(f=>Dt.fromServerFormat(f)))}(e.updateMask);return new Vs(s,i,a,n,r)}return new fl(s,i,n,r)}if(e.delete){const s=uo(t,e.delete);return new jf(s,n)}if(e.verify){const s=uo(t,e.verify);return new RT(s,n)}return Ee(1463,{proto:e})}function hV(t,e){return t&&t.length>0?(Te(e!==void 0,14353),t.map(n=>function(s,i){let a=s.updateTime?Mn(s.updateTime):Mn(i);return a.isEqual(je.min())&&(a=Mn(i)),new YO(a,s.transformResults||[])}(n,e))):[]}function $T(t,e){return{documents:[MT(t,e.path)]}}function Iv(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=MT(t,s);const i=function(d){if(d.length!==0)return qT(ft.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(f=>function(p){return{field:ri(p.field),direction:mV(p.dir)}}(f))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const l=jg(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:n,parent:s}}function fV(t,e,n,r){const{ft:s,parent:i}=Iv(t,e),a={},l=[];let c=0;return n.forEach(d=>{const f="aggregate_"+c++;a[f]=d.alias,d.aggregateType==="count"?l.push({alias:f,count:{}}):d.aggregateType==="avg"?l.push({alias:f,avg:{field:ri(d.fieldPath)}}):d.aggregateType==="sum"&&l.push({alias:f,sum:{field:ri(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:l,structuredQuery:s.structuredQuery},parent:s.parent},gt:a,parent:i}}function BT(t){let e=FT(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Te(r===1,65062);const f=n.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];n.where&&(i=function(h){const p=zT(h);return p instanceof ft&&gv(p)?p.getFilters():[p]}(n.where));let a=[];n.orderBy&&(a=function(h){return h.map(p=>function(T){return new Zc(ca(T.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(p))}(n.orderBy));let l=null;n.limit&&(l=function(h){let p;return p=typeof h=="object"?h.value:h,vf(p)?null:p}(n.limit));let c=null;n.startAt&&(c=function(h){const p=!!h.before,x=h.values||[];return new Ti(x,p)}(n.startAt));let d=null;return n.endAt&&(d=function(h){const p=!h.before,x=h.values||[];return new Ti(x,p)}(n.endAt)),MO(e,s,a,i,l,"F",c,d)}function pV(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ee(28987,{purpose:s})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function zT(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=ca(n.unaryFilter.field);return nt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=ca(n.unaryFilter.field);return nt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=ca(n.unaryFilter.field);return nt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=ca(n.unaryFilter.field);return nt.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ee(61313);default:return Ee(60726)}}(t):t.fieldFilter!==void 0?function(n){return nt.create(ca(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ee(58110);default:return Ee(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return ft.create(n.compositeFilter.filters.map(r=>zT(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ee(1026)}}(n.compositeFilter.op))}(t):Ee(30097,{filter:t})}function mV(t){return iV[t]}function gV(t){return oV[t]}function yV(t){return aV[t]}function ri(t){return{fieldPath:t.canonicalString()}}function ca(t){return Dt.fromServerFormat(t.fieldPath)}function qT(t){return t instanceof nt?function(n){if(n.op==="=="){if(dw(n.value))return{unaryFilter:{field:ri(n.field),op:"IS_NAN"}};if(uw(n.value))return{unaryFilter:{field:ri(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(dw(n.value))return{unaryFilter:{field:ri(n.field),op:"IS_NOT_NAN"}};if(uw(n.value))return{unaryFilter:{field:ri(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ri(n.field),op:gV(n.op),value:n.value}}}(t):t instanceof ft?function(n){const r=n.getFilters().map(s=>qT(s));return r.length===1?r[0]:{compositeFilter:{op:yV(n.op),filters:r}}}(t):Ee(54877,{filter:t})}function vV(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function HT(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e,n,r,s,i=je.min(),a=je.min(),l=Xt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new bs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new bs(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WT{constructor(e){this.yt=e}}function _V(t,e){let n;if(e.document)n=uV(t.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=he.fromSegments(e.noDocument.path),s=No(e.noDocument.readTime);n=Ut.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ee(56709);{const r=he.fromSegments(e.unknownDocument.path),s=No(e.unknownDocument.version);n=Ut.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new ot(s[0],s[1]);return je.fromTimestamp(i)}(e.readTime)),n}function Nw(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Rh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,a){return{name:Ah(i,a.key),fields:a.data.value.mapValue.fields,updateTime:nl(i,a.version.toTimestamp()),createTime:nl(i,a.createTime.toTimestamp())}}(t.yt,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:To(e.version)};else{if(!e.isUnknownDocument())return Ee(57904,{document:e});r.unknownDocument={path:n.path.toArray(),version:To(e.version)}}return r}function Rh(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function To(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function No(t){const e=new ot(t.seconds,t.nanoseconds);return je.fromTimestamp(e)}function Xi(t,e){const n=(e.baseMutations||[]).map(i=>Rg(t.yt,i));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];a.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Rg(t.yt,i)),s=ot.fromMillis(e.localWriteTimeMs);return new _v(e.batchId,s,n,r)}function ec(t){const e=No(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?No(t.lastLimboFreeSnapshotVersion):je.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){const a=i.documents.length;return Te(a===1,1966,{count:a}),_r(mu(FT(i.documents[0])))}(t.query):function(i){return _r(BT(i))}(t.query),new bs(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,Xt.fromBase64String(t.resumeToken))}function GT(t,e){const n=To(e.snapshotVersion),r=To(e.lastLimboFreeSnapshotVersion);let s;s=Th(e.target)?$T(t.yt,e.target):Iv(t.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:So(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function KT(t){const e=BT({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?jh(e,e.limit,"L"):e}function Bp(t,e){return new bv(e.largestBatchId,Rg(t.yt,e.overlayMutation))}function jw(t,e){const n=e.path.lastSegment();return[t,jn(e.path.popLast()),n]}function Aw(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:To(r.readTime),documentKey:jn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{getBundleMetadata(e,n){return Pw(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:No(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return Pw(e).put(function(s){return{bundleId:s.id,createTime:To(Mn(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return Rw(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:KT(i.bundledQuery),readTime:No(i.readTime)}}(r)})}saveNamedQuery(e,n){return Rw(e).put(function(s){return{name:s.name,readTime:To(Mn(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function Pw(t){return nn(t,_f)}function Rw(t){return nn(t,xf)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(e,n){this.serializer=e,this.userId=n}static wt(e,n){const r=n.uid||"";return new Pf(e,r)}getOverlay(e,n){return Ol(e).get(jw(this.userId,n)).next(r=>r?Bp(this.serializer,r):null)}getOverlays(e,n){const r=es();return U.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,a)=>{const l=new bv(n,a);s.push(this.St(e,l))}),U.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(a=>s.add(jn(a.getCollectionPath())));const i=[];return s.forEach(a=>{const l=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);i.push(Ol(e).Z(bg,l))}),U.waitFor(i)}getOverlaysForCollection(e,n,r){const s=es(),i=jn(n),a=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ol(e).J(bg,a).next(l=>{for(const c of l){const d=Bp(this.serializer,c);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=es();let a;const l=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return Ol(e).ee({index:YC,range:l},(c,d,f)=>{const h=Bp(this.serializer,d);i.size()<s||h.largestBatchId===a?(i.set(h.getKey(),h),a=h.largestBatchId):f.done()}).next(()=>i)}St(e,n){return Ol(e).put(function(s,i,a){const[l,c,d]=jw(i,a.mutation.key);return{userId:i,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Ph(s.yt,a.mutation)}}(this.serializer,this.userId,n))}}function Ol(t){return nn(t,bf)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{bt(e){return nn(e,hv)}getSessionToken(e){return this.bt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?Xt.fromUint8Array(r):Xt.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.bt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(Tt(e.integerValue));else if("doubleValue"in e){const r=Tt(e.doubleValue);isNaN(r)?this.Ft(n,13):(this.Ft(n,15),Wc(r)?n.Mt(0):n.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(n,20),typeof r=="string"&&(r=ks(r)),n.xt(`${r.seconds||""}`),n.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(Ds(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(n,45),n.Mt(r.latitude||0),n.Mt(r.longitude||0)}else"mapValue"in e?lT(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):If(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):Ee(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){const r=e.fields||{};this.Ft(n,55);for(const s of Object.keys(r))this.Ot(s,n),this.Ct(r[s],n)}kt(e,n){var a,l;const r=e.fields||{};this.Ft(n,53);const s=Ya,i=((l=(a=r[s].arrayValue)==null?void 0:a.values)==null?void 0:l.length)||0;this.Ft(n,15),n.Mt(Tt(i)),this.Ot(s,n),this.Ct(r[s],n)}Qt(e,n){const r=e.values||[];this.Ft(n,50);for(const s of r)this.Ct(s,n)}Lt(e,n){this.Ft(n,37),he.fromName(e).path.forEach(r=>{this.Ft(n,60),this.Ut(r,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}}Ji.Kt=new Ji;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qo=255;function wV(t){if(t===0)return 8;let e=0;return t>>4||(e+=4,t<<=4),t>>6||(e+=2,t<<=2),t>>7||(e+=1),e}function kw(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const a=wV(255&r[i]);if(s+=a,a!==8)break}return s}(t);return Math.ceil(e/8)}class EV{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Gt(r.value),r=n.next();this.zt()}jt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Jt(r.value),r=n.next();this.Ht()}Yt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=n.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=n.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const n=this.en(e),r=kw(n);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}nn(e){const n=this.en(e),r=kw(n);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}rn(){this.sn(Qo),this.sn(255)}_n(){this.an(Qo),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const n=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(e),r=!!(128&n[0]);n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Gt(e){const n=255&e;n===0?(this.sn(0),this.sn(255)):n===Qo?(this.sn(Qo),this.sn(0)):this.sn(n)}Jt(e){const n=255&e;n===0?(this.an(0),this.an(255)):n===Qo?(this.an(Qo),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class IV{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class SV{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Vl{constructor(){this.cn=new EV,this.ln=new IV(this.cn),this.hn=new SV(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(e,n,r,s){this.Tn=e,this.In=n,this.En=r,this.dn=s}An(){const e=this.dn.length,n=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.dn,0),n!==e?r.set([0],this.dn.length):++r[r.length-1],new Zi(this.Tn,this.In,this.En,r)}Rn(e,n,r){return{indexId:this.Tn,uid:e,arrayValue:Vd(this.En),directionalValue:Vd(this.dn),orderedDocumentKey:Vd(n),documentKey:r.path.toArray()}}Vn(e,n,r){const s=this.Rn(e,n,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Hs(t,e){let n=t.Tn-e.Tn;return n!==0?n:(n=Dw(t.En,e.En),n!==0?n:(n=Dw(t.dn,e.dn),n!==0?n:he.comparator(t.In,e.In)))}function Dw(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}function Vd(t){return BS()?function(n){let r="";for(let s=0;s<n.length;s++)r+=String.fromCharCode(n[s]);return r}(t):t}function Lw(t){return typeof t!="string"?t:function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(t)}class Ow{constructor(e){this.mn=new mt((n,r)=>Dt.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const n of e.filters){const r=n;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(Te(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const n=vg(e);if(n!==void 0&&!this.wn(n))return!1;const r=Ki(e);let s=new Set,i=0,a=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const l=this.mn.getIterator().getNext();if(!s.has(l.field.canonicalString())){const c=r[i];if(!this.Sn(l,c)||!this.bn(this.fn[a++],c))return!1}++i}for(;i<r.length;++i){const l=r[i];if(a>=this.fn.length||!this.bn(this.fn[a++],l))return!1}return!0}Dn(){if(this.pn)return null;let e=new mt(Dt.comparator);const n=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new jd(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new jd(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new jd(r.field,r.dir==="asc"?0:1)));return new wh(wh.UNKNOWN_ID,this.collectionId,n,Hc.empty())}wn(e){for(const n of this.gn)if(this.Sn(n,e))return!0;return!1}Sn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}bn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QT(t){var n,r;if(Te(t instanceof nt||t instanceof ft,20012),t instanceof nt){if(t instanceof yT){const s=((r=(n=t.value.arrayValue)==null?void 0:n.values)==null?void 0:r.map(i=>nt.create(t.field,"==",i)))||[];return ft.create(s,"or")}return t}const e=t.filters.map(s=>QT(s));return ft.create(e,t.op)}function CV(t){if(t.getFilters().length===0)return[];const e=Lg(QT(t));return Te(YT(e),7391),kg(e)||Dg(e)?[e]:e.getFilters()}function kg(t){return t instanceof nt}function Dg(t){return t instanceof ft&&gv(t)}function YT(t){return kg(t)||Dg(t)||function(n){if(n instanceof ft&&Sg(n)){for(const r of n.getFilters())if(!kg(r)&&!Dg(r))return!1;return!0}return!1}(t)}function Lg(t){if(Te(t instanceof nt||t instanceof ft,34018),t instanceof nt)return t;if(t.filters.length===1)return Lg(t.filters[0]);const e=t.filters.map(r=>Lg(r));let n=ft.create(e,t.op);return n=kh(n),YT(n)?n:(Te(n instanceof ft,64498),Te(Ja(n),40251),Te(n.filters.length>1,57927),n.filters.reduce((r,s)=>Sv(r,s)))}function Sv(t,e){let n;return Te(t instanceof nt||t instanceof ft,38388),Te(e instanceof nt||e instanceof ft,25473),n=t instanceof nt?e instanceof nt?function(s,i){return ft.create([s,i],"and")}(t,e):Vw(t,e):e instanceof nt?Vw(e,t):function(s,i){if(Te(s.filters.length>0&&i.filters.length>0,48005),Ja(s)&&Ja(i))return pT(s,i.getFilters());const a=Sg(s)?s:i,l=Sg(s)?i:s,c=a.filters.map(d=>Sv(d,l));return ft.create(c,"or")}(t,e),kh(n)}function Vw(t,e){if(Ja(e))return pT(e,t.getFilters());{const n=e.filters.map(r=>Sv(t,r));return ft.create(n,"or")}}function kh(t){if(Te(t instanceof nt||t instanceof ft,11850),t instanceof nt)return t;const e=t.getFilters();if(e.length===1)return kh(e[0]);if(hT(t))return t;const n=e.map(s=>kh(s)),r=[];return n.forEach(s=>{s instanceof nt?r.push(s):s instanceof ft&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:ft.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(){this.Cn=new Cv}addToCollectionParentIndex(e,n){return this.Cn.add(n),U.resolve()}getCollectionParents(e,n){return U.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return U.resolve()}deleteFieldIndex(e,n){return U.resolve()}deleteAllFieldIndexes(e){return U.resolve()}createTargetIndexes(e,n){return U.resolve()}getDocumentsMatchingTarget(e,n){return U.resolve(null)}getIndexType(e,n){return U.resolve(0)}getFieldIndexes(e,n){return U.resolve([])}getNextCollectionGroupToUpdate(e){return U.resolve(null)}getMinOffset(e,n){return U.resolve(cr.min())}getMinOffsetFromCollectionGroup(e,n){return U.resolve(cr.min())}updateCollectionGroup(e,n,r){return U.resolve()}updateIndexEntries(e,n){return U.resolve()}}class Cv{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new mt(ct.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new mt(ct.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mw="IndexedDbIndexManager",td=new Uint8Array(0);class NV{constructor(e,n){this.databaseId=n,this.vn=new Cv,this.Fn=new Os(r=>So(r),(r,s)=>pu(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.vn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.vn.add(n)});const i={collectionId:r,parent:jn(s)};return Fw(e).put(i)}return U.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[MC(n),""],!1,!0);return Fw(e).J(s).next(i=>{for(const a of i){if(a.collectionId!==n)break;r.push(Zr(a.parent))}return r})}addFieldIndex(e,n){const r=Ml(e),s=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const a=Xo(e);return i.next(l=>{a.put(Aw(l,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=Ml(e),s=Xo(e),i=Yo(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=Ml(e),r=Yo(e),s=Xo(e);return n.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,n){return U.forEach(this.Mn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Ow(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=Yo(e);let s=!0;const i=new Map;return U.forEach(this.Mn(n),a=>this.xn(e,a).next(l=>{s&&(s=!!l),i.set(a,l)})).next(()=>{if(s){let a=Je();const l=[];return U.forEach(i,(c,d)=>{ie(Mw,`Using index ${function(S){return`id=${S.indexId}|cg=${S.collectionGroup}|f=${S.fields.map(I=>`${I.fieldPath}:${I.kind}`).join(",")}`}(c)} to execute ${So(n)}`);const f=function(S,I){const L=vg(I);if(L===void 0)return null;for(const V of Nh(S,L.fieldPath))switch(V.op){case"array-contains-any":return V.value.arrayValue.values||[];case"array-contains":return[V.value]}return null}(d,c),h=function(S,I){const L=new Map;for(const V of Ki(I))for(const g of Nh(S,V.fieldPath))switch(g.op){case"==":case"in":L.set(V.fieldPath.canonicalString(),g.value);break;case"not-in":case"!=":return L.set(V.fieldPath.canonicalString(),g.value),Array.from(L.values())}return null}(d,c),p=function(S,I){const L=[];let V=!0;for(const g of Ki(I)){const v=g.kind===0?gw(S,g.fieldPath,S.startAt):yw(S,g.fieldPath,S.startAt);L.push(v.value),V&&(V=v.inclusive)}return new Ti(L,V)}(d,c),x=function(S,I){const L=[];let V=!0;for(const g of Ki(I)){const v=g.kind===0?yw(S,g.fieldPath,S.endAt):gw(S,g.fieldPath,S.endAt);L.push(v.value),V&&(V=v.inclusive)}return new Ti(L,V)}(d,c),T=this.On(c,d,p),C=this.On(c,d,x),N=this.Nn(c,d,h),_=this.Bn(c.indexId,f,T,p.inclusive,C,x.inclusive,N);return U.forEach(_,E=>r.Y(E,n.limit).next(S=>{S.forEach(I=>{const L=he.fromSegments(I.documentKey);a.has(L)||(a=a.add(L),l.push(L))})}))}).next(()=>l)}return U.resolve(null)})}Mn(e){let n=this.Fn.get(e);return n||(e.filters.length===0?n=[e]:n=CV(ft.create(e.filters,"and")).map(r=>Tg(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,n),n)}Bn(e,n,r,s,i,a,l){const c=(n!=null?n.length:1)*Math.max(r.length,i.length),d=c/(n!=null?n.length:1),f=[];for(let h=0;h<c;++h){const p=n?this.Ln(n[h/d]):td,x=this.kn(e,p,r[h%d],s),T=this.qn(e,p,i[h%d],a),C=l.map(N=>this.kn(e,p,N,!0));f.push(...this.createRange(x,T,C))}return f}kn(e,n,r,s){const i=new Zi(e,he.empty(),n,r);return s?i:i.An()}qn(e,n,r,s){const i=new Zi(e,he.empty(),n,r);return s?i.An():i}xn(e,n){const r=new Ow(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let a=null;for(const l of i)r.yn(l)&&(!a||l.fields.length>a.fields.length)&&(a=l);return a})}getIndexType(e,n){let r=2;const s=this.Mn(n);return U.forEach(s,i=>this.xn(e,i).next(a=>{a?r!==0&&a.fields.length<function(c){let d=new mt(Dt.comparator),f=!1;for(const h of c.filters)for(const p of h.getFlattenedFilters())p.field.isKeyField()||(p.op==="array-contains"||p.op==="array-contains-any"?f=!0:d=d.add(p.field));for(const h of c.orderBy)h.field.isKeyField()||(d=d.add(h.field));return d.size+(f?1:0)}(i)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(n)&&s.length>1&&r===2?1:r)}Qn(e,n){const r=new Vl;for(const s of Ki(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const a=r.Pn(s.kind);Ji.Kt.Dt(i,a)}return r.un()}Ln(e){const n=new Vl;return Ji.Kt.Dt(e,n.Pn(0)),n.un()}$n(e,n){const r=new Vl;return Ji.Kt.Dt(Io(this.databaseId,n),r.Pn(function(i){const a=Ki(i);return a.length===0?0:a[a.length-1].kind}(e))),r.un()}Nn(e,n,r){if(r===null)return[];let s=[];s.push(new Vl);let i=0;for(const a of Ki(e)){const l=r[i++];for(const c of s)if(this.Un(n,a.fieldPath)&&Jc(l))s=this.Kn(s,a,l);else{const d=c.Pn(a.kind);Ji.Kt.Dt(l,d)}}return this.Wn(s)}On(e,n,r){return this.Nn(e,n,r.position)}Wn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].un();return n}Kn(e,n,r){const s=[...e],i=[];for(const a of r.arrayValue.values||[])for(const l of s){const c=new Vl;c.seed(l.un()),Ji.Kt.Dt(a,c.Pn(n.kind)),i.push(c)}return i}Un(e,n){return!!e.filters.find(r=>r instanceof nt&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=Ml(e),s=Xo(e);return(n?r.J(xg,IDBKeyRange.bound(n,n)):r.J()).next(i=>{const a=[];return U.forEach(i,l=>s.get([l.indexId,this.uid]).next(c=>{a.push(function(f,h){const p=h?new Hc(h.sequenceNumber,new cr(No(h.readTime),new he(Zr(h.documentKey)),h.largestBatchId)):Hc.empty(),x=f.fields.map(([T,C])=>new jd(Dt.fromServerFormat(T),C));return new wh(f.indexId,f.collectionGroup,x,p)}(l,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:ze(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Ml(e),i=Xo(e);return this.Gn(e).next(a=>s.J(xg,IDBKeyRange.bound(n,n)).next(l=>U.forEach(l,c=>i.put(Aw(c.indexId,this.uid,a,r)))))}updateIndexEntries(e,n){const r=new Map;return U.forEach(n,(s,i)=>{const a=r.get(s.collectionGroup);return(a?U.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next(l=>(r.set(s.collectionGroup,l),U.forEach(l,c=>this.zn(e,s,c).next(d=>{const f=this.jn(i,c);return d.isEqual(f)?U.resolve():this.Jn(e,i,c,d,f)}))))})}Hn(e,n,r,s){return Yo(e).put(s.Rn(this.uid,this.$n(r,n.key),n.key))}Yn(e,n,r,s){return Yo(e).delete(s.Vn(this.uid,this.$n(r,n.key),n.key))}zn(e,n,r){const s=Yo(e);let i=new mt(Hs);return s.ee({index:QC,range:IDBKeyRange.only([r.indexId,this.uid,Vd(this.$n(r,n))])},(a,l)=>{i=i.add(new Zi(r.indexId,n,Lw(l.arrayValue),Lw(l.directionalValue)))}).next(()=>i)}jn(e,n){let r=new mt(Hs);const s=this.Qn(n,e);if(s==null)return r;const i=vg(n);if(i!=null){const a=e.data.field(i.fieldPath);if(Jc(a))for(const l of a.arrayValue.values||[])r=r.add(new Zi(n.indexId,e.key,this.Ln(l),s))}else r=r.add(new Zi(n.indexId,e.key,td,s));return r}Jn(e,n,r,s,i){ie(Mw,"Updating index entries for document '%s'",n.key);const a=[];return function(c,d,f,h,p){const x=c.getIterator(),T=d.getIterator();let C=Ko(x),N=Ko(T);for(;C||N;){let _=!1,E=!1;if(C&&N){const S=f(C,N);S<0?E=!0:S>0&&(_=!0)}else C!=null?E=!0:_=!0;_?(h(N),N=Ko(T)):E?(p(C),C=Ko(x)):(C=Ko(x),N=Ko(T))}}(s,i,Hs,l=>{a.push(this.Hn(e,n,r,l))},l=>{a.push(this.Yn(e,n,r,l))}),U.waitFor(a)}Gn(e){let n=1;return Xo(e).ee({index:KC,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((a,l)=>Hs(a,l)).filter((a,l,c)=>!l||Hs(a,c[l-1])!==0);const s=[];s.push(e);for(const a of r){const l=Hs(a,e),c=Hs(a,n);if(l===0)s[0]=e.An();else if(l>0&&c<0)s.push(a),s.push(a.An());else if(c>0)break}s.push(n);const i=[];for(let a=0;a<s.length;a+=2){if(this.Zn(s[a],s[a+1]))return[];const l=s[a].Vn(this.uid,td,he.empty()),c=s[a+1].Vn(this.uid,td,he.empty());i.push(IDBKeyRange.bound(l,c))}return i}Zn(e,n){return Hs(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(Uw)}getMinOffset(e,n){return U.mapArray(this.Mn(n),r=>this.xn(e,r).next(s=>s||Ee(44426))).next(Uw)}}function Fw(t){return nn(t,Qc)}function Yo(t){return nn(t,vc)}function Ml(t){return nn(t,dv)}function Xo(t){return nn(t,yc)}function Uw(t){Te(t.length!==0,28825);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;lv(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new cr(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},XT=41943040;class In{static withCacheSize(e){return new In(e,In.DEFAULT_COLLECTION_PERCENTILE,In.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JT(t,e,n){const r=t.store(Pr),s=t.store(Wa),i=[],a=IDBKeyRange.only(n.batchId);let l=0;const c=r.ee({range:a},(f,h,p)=>(l++,p.delete()));i.push(c.next(()=>{Te(l===1,47070,{batchId:n.batchId})}));const d=[];for(const f of n.mutations){const h=HC(e,f.key.path,n.batchId);i.push(s.delete(h)),d.push(f.key)}return U.waitFor(i).next(()=>d)}function Dh(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ee(14731);e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */In.DEFAULT_COLLECTION_PERCENTILE=10,In.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,In.DEFAULT=new In(XT,In.DEFAULT_COLLECTION_PERCENTILE,In.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),In.DISABLED=new In(-1,0,0);class Rf{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,n,r,s){Te(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Rf(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ws(e).ee({index:so,range:r},(s,i,a)=>{n=!1,a.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=ua(e),a=Ws(e);return a.add({}).next(l=>{Te(typeof l=="number",49019);const c=new _v(l,n,r,s),d=function(x,T,C){const N=C.baseMutations.map(E=>Ph(x.yt,E)),_=C.mutations.map(E=>Ph(x.yt,E));return{userId:T,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:N,mutations:_}}(this.serializer,this.userId,c),f=[];let h=new mt((p,x)=>ze(p.canonicalString(),x.canonicalString()));for(const p of s){const x=HC(this.userId,p.key.path,l);h=h.add(p.key.path.popLast()),f.push(a.put(d)),f.push(i.put(x,tO))}return h.forEach(p=>{f.push(this.indexManager.addToCollectionParentIndex(e,p))}),e.addOnCommittedListener(()=>{this.Xn[l]=c.keys()}),U.waitFor(f).next(()=>c)})}lookupMutationBatch(e,n){return Ws(e).get(n).next(r=>r?(Te(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:n}),Xi(this.serializer,r)):null)}er(e,n){return this.Xn[n]?U.resolve(this.Xn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Xn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Ws(e).ee({index:so,range:s},(a,l,c)=>{l.userId===this.userId&&(Te(l.batchId>=r,47524,{tr:r}),i=Xi(this.serializer,l)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=lo;return Ws(e).ee({index:so,range:n,reverse:!0},(s,i,a)=>{r=i.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,lo],[this.userId,Number.POSITIVE_INFINITY]);return Ws(e).J(so,n).next(r=>r.map(s=>Xi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=Ad(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return ua(e).ee({range:s},(a,l,c)=>{const[d,f,h]=a,p=Zr(f);if(d===this.userId&&n.path.isEqual(p))return Ws(e).get(h).next(x=>{if(!x)throw Ee(61480,{nr:a,batchId:h});Te(x.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:x.userId,batchId:h}),i.push(Xi(this.serializer,x))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new mt(ze);const s=[];return n.forEach(i=>{const a=Ad(this.userId,i.path),l=IDBKeyRange.lowerBound(a),c=ua(e).ee({range:l},(d,f,h)=>{const[p,x,T]=d,C=Zr(x);p===this.userId&&i.path.isEqual(C)?r=r.add(T):h.done()});s.push(c)}),U.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=Ad(this.userId,r),a=IDBKeyRange.lowerBound(i);let l=new mt(ze);return ua(e).ee({range:a},(c,d,f)=>{const[h,p,x]=c,T=Zr(p);h===this.userId&&r.isPrefixOf(T)?T.length===s&&(l=l.add(x)):f.done()}).next(()=>this.rr(e,l))}rr(e,n){const r=[],s=[];return n.forEach(i=>{s.push(Ws(e).get(i).next(a=>{if(a===null)throw Ee(35274,{batchId:i});Te(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),r.push(Xi(this.serializer,a))}))}),U.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return JT(e.le,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.ir(n.batchId)}),U.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return U.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return ua(e).ee({range:r},(i,a,l)=>{if(i[0]===this.userId){const c=Zr(i[1]);s.push(c)}else l.done()}).next(()=>{Te(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,n){return ZT(e,this.userId,n)}_r(e){return eN(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:lo,lastStreamToken:""})}}function ZT(t,e,n){const r=Ad(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return ua(t).ee({range:i,X:!0},(l,c,d)=>{const[f,h,p]=l;f===e&&h===s&&(a=!0),d.done()}).next(()=>a)}function Ws(t){return nn(t,Pr)}function ua(t){return nn(t,Wa)}function eN(t){return nn(t,Gc)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new jo(0)}static cr(){return new jo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jV{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.lr(e).next(n=>{const r=new jo(n.highestTargetId);return n.highestTargetId=r.next(),this.hr(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(n=>je.fromTimestamp(new ot(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.hr(e,s)))}addTargetData(e,n){return this.Pr(e,n).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(n,r),this.hr(e,r))))}updateTargetData(e,n){return this.Pr(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>Jo(e).delete(n.targetId)).next(()=>this.lr(e)).next(r=>(Te(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return Jo(e).ee((a,l)=>{const c=ec(l);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>U.waitFor(i)).next(()=>s)}forEachTarget(e,n){return Jo(e).ee((r,s)=>{const i=ec(s);n(i)})}lr(e){return Bw(e).get(Sh).next(n=>(Te(n!==null,2888),n))}hr(e,n){return Bw(e).put(Sh,n)}Pr(e,n){return Jo(e).put(GT(this.serializer,n))}Tr(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(n=>n.targetCount)}getTargetData(e,n){const r=So(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Jo(e).ee({range:s,index:GC},(a,l,c)=>{const d=ec(l);pu(n,d.target)&&(i=d,c.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=si(e);return n.forEach(a=>{const l=jn(a.path);s.push(i.put({targetId:r,path:l})),s.push(this.referenceDelegate.addReference(e,r,a))}),U.waitFor(s)}removeMatchingKeys(e,n,r){const s=si(e);return U.forEach(n,i=>{const a=jn(i.path);return U.waitFor([s.delete([r,a]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=si(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=si(e);let i=Je();return s.ee({range:r,X:!0},(a,l,c)=>{const d=Zr(a[1]),f=new he(d);i=i.add(f)}).next(()=>i)}containsKey(e,n){const r=jn(n.path),s=IDBKeyRange.bound([r],[MC(r)],!1,!0);let i=0;return si(e).ee({index:uv,X:!0,range:s},([a,l],c,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}At(e,n){return Jo(e).get(n).next(r=>r?ec(r):null)}}function Jo(t){return nn(t,Ga)}function Bw(t){return nn(t,co)}function si(t){return nn(t,Ka)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zw="LruGarbageCollector",AV=1048576;function qw([t,e],[n,r]){const s=ze(t,n);return s===0?ze(e,r):s}class PV{constructor(e){this.Ir=e,this.buffer=new mt(qw),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();qw(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class tN{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){ie(zw,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Oi(n)?ie(zw,"Ignoring IndexedDB error during garbage collection: ",n):await $o(n)}await this.Vr(3e5)})}}class RV{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return U.resolve(yr.ce);const r=new PV(n);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(ie("LruGarbageCollector","Garbage collection skipped; disabled"),U.resolve($w)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ie("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$w):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,i,a,l,c,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(ie("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,a=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,l=Date.now(),this.removeTargets(e,r,n))).next(h=>(i=h,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(d=Date.now(),aa()<=tt.DEBUG&&ie("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${h} documents in `+(d-c)+`ms
Total Duration: ${d-f}ms`),U.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function nN(t,e){return new RV(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kV{constructor(e,n){this.db=e,this.garbageCollector=nN(this,n)}gr(e){const n=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}pr(e,n){return this.Sr(e,(r,s)=>n(s))}addReference(e,n,r){return nd(e,r)}removeReference(e,n,r){return nd(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return nd(e,n)}br(e,n){return function(s,i){let a=!1;return eN(s).te(l=>ZT(s,l,i).next(c=>(c&&(a=!0),U.resolve(!c)))).next(()=>a)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(a,l)=>{if(l<=n){const c=this.br(e,a).next(d=>{if(!d)return i++,r.getEntry(e,a).next(()=>(r.removeEntry(a,je.min()),si(e).delete(function(h){return[0,jn(h.path)]}(a))))});s.push(c)}}).next(()=>U.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return nd(e,n)}Sr(e,n){const r=si(e);let s,i=yr.ce;return r.ee({index:uv},([a,l],{path:c,sequenceNumber:d})=>{a===0?(i!==yr.ce&&n(new he(Zr(s)),i),i=d,s=c):i=yr.ce}).next(()=>{i!==yr.ce&&n(new he(Zr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function nd(t,e){return si(t).put(function(r,s){return{targetId:0,path:jn(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN{constructor(){this.changes=new Os(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Ut.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?U.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return qi(e).put(r)}removeEntry(e,n,r){return qi(e).delete(function(i,a){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],Rh(a),l[l.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Dr(e,r)))}getEntry(e,n){let r=Ut.newInvalidDocument(n);return qi(e).ee({index:Pd,range:IDBKeyRange.only(Fl(n))},(s,i)=>{r=this.Cr(n,i)}).next(()=>r)}vr(e,n){let r={size:0,document:Ut.newInvalidDocument(n)};return qi(e).ee({index:Pd,range:IDBKeyRange.only(Fl(n))},(s,i)=>{r={document:this.Cr(n,i),size:Dh(i)}}).next(()=>r)}getEntries(e,n){let r=ir();return this.Fr(e,n,(s,i)=>{const a=this.Cr(s,i);r=r.insert(s,a)}).next(()=>r)}Mr(e,n){let r=ir(),s=new At(he.comparator);return this.Fr(e,n,(i,a)=>{const l=this.Cr(i,a);r=r.insert(i,l),s=s.insert(i,Dh(a))}).next(()=>({documents:r,Or:s}))}Fr(e,n,r){if(n.isEmpty())return U.resolve();let s=new mt(Gw);n.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(Fl(s.first()),Fl(s.last())),a=s.getIterator();let l=a.getNext();return qi(e).ee({index:Pd,range:i},(c,d,f)=>{const h=he.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;l&&Gw(l,h)<0;)r(l,null),l=a.getNext();l&&l.isEqual(h)&&(r(l,d),l=a.hasNext()?a.getNext():null),l?f.j(Fl(l)):f.done()}).next(()=>{for(;l;)r(l,null),l=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const a=n.path,l=[a.popLast().toArray(),a.lastSegment(),Rh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return qi(e).J(IDBKeyRange.bound(l,c,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let f=ir();for(const h of d){const p=this.Cr(he.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);p.isFoundDocument()&&(gu(n,p)||s.has(p.key))&&(f=f.insert(p.key,p))}return f})}getAllFromCollectionGroup(e,n,r,s){let i=ir();const a=Ww(n,r),l=Ww(n,cr.max());return qi(e).ee({index:WC,range:IDBKeyRange.bound(a,l,!0)},(c,d,f)=>{const h=this.Cr(he.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(h.key,h),i.size===s&&f.done()}).next(()=>i)}newChangeBuffer(e){return new LV(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return Hw(e).get(_g).next(n=>(Te(!!n,20021),n))}Dr(e,n){return Hw(e).put(_g,n)}Cr(e,n){if(n){const r=_V(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(je.min())))return r}return Ut.newInvalidDocument(e)}}function sN(t){return new DV(t)}class LV extends rN{constructor(e,n){super(),this.Nr=e,this.trackRemovals=n,this.Br=new Os(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new mt((i,a)=>ze(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const l=this.Br.get(i);if(n.push(this.Nr.removeEntry(e,i,l.readTime)),a.isValidDocument()){const c=Nw(this.Nr.serializer,a);s=s.add(i.path.popLast());const d=Dh(c);r+=d-l.size,n.push(this.Nr.addEntry(e,i,c))}else if(r-=l.size,this.trackRemovals){const c=Nw(this.Nr.serializer,a.convertToNoDocument(je.min()));n.push(this.Nr.addEntry(e,i,c))}}),s.forEach(i=>{n.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.Nr.updateMetadata(e,r)),U.waitFor(n)}getFromCache(e,n){return this.Nr.vr(e,n).next(r=>(this.Br.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Nr.Mr(e,n).next(({documents:r,Or:s})=>(s.forEach((i,a)=>{this.Br.set(i,{size:a,readTime:r.get(i).readTime})}),r))}}function Hw(t){return nn(t,Kc)}function qi(t){return nn(t,Ih)}function Fl(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ww(t,e){const n=e.documentKey.path.toArray();return[t,Rh(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Gw(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=ze(n[i],r[i]),s)return s;return s=ze(n.length,r.length),s||(s=ze(n[n.length-2],r[r.length-2]),s||ze(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OV{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&bc(r.mutation,s,Gn.empty(),ot.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Je()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Je()){const s=es();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let a=Jl();return i.forEach((l,c)=>{a=a.insert(l,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=es();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Je()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,l)=>{n.set(a,l)})})}computeViews(e,n,r,s){let i=ir();const a=xc(),l=function(){return xc()}();return n.forEach((c,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof Vs)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),bc(f.mutation,d,f.mutation.getFieldMask(),ot.now())):a.set(d.key,Gn.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,f)=>a.set(d,f)),n.forEach((d,f)=>l.set(d,new OV(f,a.get(d)??null))),l))}recalculateAndSaveOverlays(e,n){const r=xc();let s=new At((a,l)=>a-l),i=Je();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const l of a)l.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let f=r.get(c)||Gn.empty();f=l.applyToLocalView(d,f),r.set(c,f);const h=(s.get(l.batchId)||Je()).add(c);s=s.insert(l.batchId,h)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,f=c.value,h=ET();f.forEach(p=>{if(!i.has(p)){const x=AT(n.get(p),r.get(p));x!==null&&h.set(p,x),i=i.add(p)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,h))}return U.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(a){return he.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):yv(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):U.resolve(es());let l=qc,c=i;return a.next(d=>U.forEach(d,(f,h)=>(l<h.largestBatchId&&(l=h.largestBatchId),i.get(f)?U.resolve():this.remoteDocumentCache.getEntry(e,f).next(p=>{c=c.insert(f,p)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,Je())).next(f=>({batchId:l,changes:wT(f)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new he(n)).next(r=>{let s=Jl();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let a=Jl();return this.indexManager.getCollectionParents(e,i).next(l=>U.forEach(l,c=>{const d=function(h,p){return new Mi(p,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(f=>{f.forEach((h,p)=>{a=a.insert(h,p)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(a=>{i.forEach((c,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,Ut.newInvalidDocument(f)))});let l=Jl();return a.forEach((c,d)=>{const f=i.get(c);f!==void 0&&bc(f.mutation,d,Gn.empty(),ot.now()),gu(n,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VV{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return U.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:Mn(s.createTime)}}(n)),U.resolve()}getNamedQuery(e,n){return U.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(s){return{name:s.name,query:KT(s.bundledQuery),readTime:Mn(s.readTime)}}(n)),U.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{constructor(){this.overlays=new At(he.comparator),this.qr=new Map}getOverlay(e,n){return U.resolve(this.overlays.get(n))}getOverlays(e,n){const r=es();return U.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.St(e,n,i)}),U.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),U.resolve()}getOverlaysForCollection(e,n,r){const s=es(),i=n.length+1,a=new he(n.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return U.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new At((d,f)=>d-f);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=es(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=es(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>l.set(d,f)),!(l.size()>=s)););return U.resolve(l)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new bv(n,r));let i=this.qr.get(n);i===void 0&&(i=Je(),this.qr.set(n,i)),this.qr.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FV{constructor(){this.sessionToken=Xt.EMPTY_BYTE_STRING}getSessionToken(e){return U.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,U.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(){this.Qr=new mt(an.$r),this.Ur=new mt(an.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new an(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new an(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new he(new ct([])),r=new an(n,e),s=new an(n,e+1),i=[];return this.Ur.forEachInRange([r,s],a=>{this.Gr(a),i.push(a.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new he(new ct([])),r=new an(n,e),s=new an(n,e+1);let i=Je();return this.Ur.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const n=new an(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class an{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return he.comparator(e.key,n.key)||ze(e.Yr,n.Yr)}static Kr(e,n){return ze(e.Yr,n.Yr)||he.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UV{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new mt(an.$r)}checkEmpty(e){return U.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new _v(i,n,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new an(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return U.resolve(a)}lookupMutationBatch(e,n){return U.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),i=s<0?0:s;return U.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return U.resolve(this.mutationQueue.length===0?lo:this.tr-1)}getAllMutationBatches(e){return U.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new an(n,0),s=new an(n,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],a=>{const l=this.Xr(a.Yr);i.push(l)}),U.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new mt(ze);return n.forEach(s=>{const i=new an(s,0),a=new an(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],l=>{r=r.add(l.Yr)})}),U.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;he.isDocumentKey(i)||(i=i.child(""));const a=new an(new he(i),0);let l=new mt(ze);return this.Zr.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.Yr)),!0)},a),U.resolve(this.ti(l))}ti(e){const n=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Te(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return U.forEach(n.mutations,s=>{const i=new an(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new an(n,0),s=this.Zr.firstAfterOrEqual(r);return U.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,U.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $V{constructor(e){this.ri=e,this.docs=function(){return new At(he.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return U.resolve(r?r.document.mutableCopy():Ut.newInvalidDocument(n))}getEntries(e,n){let r=ir();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ut.newInvalidDocument(s))}),U.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=ir();const a=n.path,l=new he(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:f}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||lv($C(f),r)<=0||(s.has(f.key)||gu(n,f))&&(i=i.insert(f.key,f.mutableCopy()))}return U.resolve(i)}getAllFromCollectionGroup(e,n,r,s){Ee(9500)}ii(e,n){return U.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new BV(this)}getSize(e){return U.resolve(this.size)}}class BV extends rN{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),U.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zV{constructor(e){this.persistence=e,this.si=new Os(n=>So(n),pu),this.lastRemoteSnapshotVersion=je.min(),this.highestTargetId=0,this.oi=0,this._i=new Tv,this.targetCount=0,this.ai=jo.ur()}forEachTarget(e,n){return this.si.forEach((r,s)=>n(s)),U.resolve()}getLastRemoteSnapshotVersion(e){return U.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return U.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),U.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),U.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new jo(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,U.resolve()}updateTargetData(e,n){return this.Pr(n),U.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,U.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.si.forEach((a,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),U.waitFor(i).next(()=>s)}getTargetCount(e){return U.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return U.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),U.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),U.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),U.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return U.resolve(r)}containsKey(e,n){return U.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nv{constructor(e,n){this.ui={},this.overlays={},this.ci=new yr(0),this.li=!1,this.li=!0,this.hi=new FV,this.referenceDelegate=e(this),this.Pi=new zV(this),this.indexManager=new TV,this.remoteDocumentCache=function(s){return new $V(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new WT(n),this.Ii=new VV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new MV,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new UV(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){ie("MemoryPersistence","Starting transaction:",e);const s=new qV(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,n){return U.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class qV extends zC{constructor(e){super(),this.currentSequenceNumber=e}}class kf{constructor(e){this.persistence=e,this.Ri=new Tv,this.Vi=null}static mi(e){return new kf(e)}get fi(){if(this.Vi)return this.Vi;throw Ee(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),U.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),U.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),U.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return U.forEach(this.fi,r=>{const s=he.fromPath(r);return this.gi(e,s).next(i=>{i||n.removeEntry(s,je.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return U.or([()=>U.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Lh{constructor(e,n){this.persistence=e,this.pi=new Os(r=>jn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=nN(this,n)}static mi(e,n){return new Lh(e,n)}Ei(){}di(e){return U.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return U.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?U.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,a=>this.br(e,a,n).next(l=>{l||(r++,i.removeEntry(a,je.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),U.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),U.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),U.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),U.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=kd(e.data.value)),n}br(e,n,r){return U.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return U.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HV{constructor(e){this.serializer=e}k(e,n,r,s){const i=new yf("createOrUpgrade",n);r<1&&s>=1&&(function(c){c.createObjectStore(fu)}(e),function(c){c.createObjectStore(Gc,{keyPath:eO}),c.createObjectStore(Pr,{keyPath:sw,autoIncrement:!0}).createIndex(so,iw,{unique:!0}),c.createObjectStore(Wa)}(e),Kw(e),function(c){c.createObjectStore(Qi)}(e));let a=U.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore(Ka),c.deleteObjectStore(Ga),c.deleteObjectStore(co)}(e),Kw(e)),a=a.next(()=>function(c){const d=c.store(co),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:je.min().toTimestamp(),targetCount:0};return d.put(Sh,f)}(i))),r<4&&s>=4&&(r!==0&&(a=a.next(()=>function(c,d){return d.store(Pr).J().next(h=>{c.deleteObjectStore(Pr),c.createObjectStore(Pr,{keyPath:sw,autoIncrement:!0}).createIndex(so,iw,{unique:!0});const p=d.store(Pr),x=h.map(T=>p.put(T));return U.waitFor(x)})}(e,i))),a=a.next(()=>{(function(c){c.createObjectStore(Qa,{keyPath:cO})})(e)})),r<5&&s>=5&&(a=a.next(()=>this.yi(i))),r<6&&s>=6&&(a=a.next(()=>(function(c){c.createObjectStore(Kc)}(e),this.wi(i)))),r<7&&s>=7&&(a=a.next(()=>this.Si(i))),r<8&&s>=8&&(a=a.next(()=>this.bi(e,i))),r<9&&s>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(a=a.next(()=>this.Di(i))),r<11&&s>=11&&(a=a.next(()=>{(function(c){c.createObjectStore(_f,{keyPath:uO})})(e),function(c){c.createObjectStore(xf,{keyPath:dO})}(e)})),r<12&&s>=12&&(a=a.next(()=>{(function(c){const d=c.createObjectStore(bf,{keyPath:vO});d.createIndex(bg,_O,{unique:!1}),d.createIndex(YC,xO,{unique:!1})})(e)})),r<13&&s>=13&&(a=a.next(()=>function(c){const d=c.createObjectStore(Ih,{keyPath:nO});d.createIndex(Pd,rO),d.createIndex(WC,sO)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Qi))),r<14&&s>=14&&(a=a.next(()=>this.Fi(e,i))),r<15&&s>=15&&(a=a.next(()=>function(c){c.createObjectStore(dv,{keyPath:hO,autoIncrement:!0}).createIndex(xg,fO,{unique:!1}),c.createObjectStore(yc,{keyPath:pO}).createIndex(KC,mO,{unique:!1}),c.createObjectStore(vc,{keyPath:gO}).createIndex(QC,yO,{unique:!1})}(e))),r<16&&s>=16&&(a=a.next(()=>{n.objectStore(yc).clear()}).next(()=>{n.objectStore(vc).clear()})),r<17&&s>=17&&(a=a.next(()=>{(function(c){c.createObjectStore(hv,{keyPath:bO})})(e)})),r<18&&s>=18&&BS()&&(a=a.next(()=>{n.objectStore(yc).clear()}).next(()=>{n.objectStore(vc).clear()})),a}wi(e){let n=0;return e.store(Qi).ee((r,s)=>{n+=Dh(s)}).next(()=>{const r={byteSize:n};return e.store(Kc).put(_g,r)})}yi(e){const n=e.store(Gc),r=e.store(Pr);return n.J().next(s=>U.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,lo],[i.userId,i.lastAcknowledgedBatchId]);return r.J(so,a).next(l=>U.forEach(l,c=>{Te(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const d=Xi(this.serializer,c);return JT(e,i.userId,d).next(()=>{})}))}))}Si(e){const n=e.store(Ka),r=e.store(Qi);return e.store(co).get(Sh).next(s=>{const i=[];return r.ee((a,l)=>{const c=new ct(a),d=function(h){return[0,jn(h)]}(c);i.push(n.get(d).next(f=>f?U.resolve():(h=>n.put({targetId:0,path:jn(h),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>U.waitFor(i))})}bi(e,n){e.createObjectStore(Qc,{keyPath:lO});const r=n.store(Qc),s=new Cv,i=a=>{if(s.add(a)){const l=a.lastSegment(),c=a.popLast();return r.put({collectionId:l,parent:jn(c)})}};return n.store(Qi).ee({X:!0},(a,l)=>{const c=new ct(a);return i(c.popLast())}).next(()=>n.store(Wa).ee({X:!0},([a,l,c],d)=>{const f=Zr(l);return i(f.popLast())}))}Di(e){const n=e.store(Ga);return n.ee((r,s)=>{const i=ec(s),a=GT(this.serializer,i);return n.put(a)})}Ci(e,n){const r=n.store(Qi),s=[];return r.ee((i,a)=>{const l=n.store(Ih),c=function(h){return h.document?new he(ct.fromString(h.document.name).popFirst(5)):h.noDocument?he.fromSegments(h.noDocument.path):h.unknownDocument?he.fromSegments(h.unknownDocument.path):Ee(36783)}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(l.put(d))}).next(()=>U.waitFor(s))}Fi(e,n){const r=n.store(Pr),s=sN(this.serializer),i=new Nv(kf.mi,this.serializer.yt);return r.J().next(a=>{const l=new Map;return a.forEach(c=>{let d=l.get(c.userId)??Je();Xi(this.serializer,c).keys().forEach(f=>d=d.add(f)),l.set(c.userId,d)}),U.forEach(l,(c,d)=>{const f=new fn(d),h=Pf.wt(this.serializer,f),p=i.getIndexManager(f),x=Rf.wt(f,this.serializer,p,i.referenceDelegate);return new iN(s,x,h,p).recalculateAndSaveOverlaysForDocumentKeys(new wg(n,yr.ce),c).next()})})}}function Kw(t){t.createObjectStore(Ka,{keyPath:oO}).createIndex(uv,aO,{unique:!0}),t.createObjectStore(Ga,{keyPath:"targetId"}).createIndex(GC,iO,{unique:!0}),t.createObjectStore(co)}const Gs="IndexedDbPersistence",zp=18e5,qp=5e3,Hp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",WV="main";class jv{constructor(e,n,r,s,i,a,l,c,d,f,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Mi=i,this.window=a,this.document=l,this.xi=d,this.Oi=f,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=p=>Promise.resolve(),!jv.v())throw new le(K.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new kV(this,s),this.$i=n+WV,this.serializer=new WT(c),this.Ui=new bi(this.$i,this.Ni,new HV(this.serializer)),this.hi=new bV,this.Pi=new jV(this.referenceDelegate,this.serializer),this.remoteDocumentCache=sN(this.serializer),this.Ii=new xV,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&Ln(Gs,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new le(K.FAILED_PRECONDITION,Hp);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new yr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>rd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(n=>{n||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(n=>this.isPrimary&&!n?this.Zi(e).next(()=>!1):!!n&&this.Xi(e).next(()=>!0))).catch(e=>{if(Oi(e))return ie(Gs,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ie(Gs,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Ul(e).get(Go).next(n=>U.resolve(this.es(n)))}ts(e){return rd(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,zp)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=nn(n,Qa);return r.J().next(s=>{const i=this.ss(s,zp),a=s.filter(l=>i.indexOf(l)===-1);return U.forEach(a,l=>r.delete(l.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ki)for(const n of e)this.Ki.removeItem(this._s(n.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?U.resolve(!0):Ul(e).get(Go).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,qp)&&!this.us(n.ownerId)){if(this.es(n)&&this.networkEnabled)return!0;if(!this.es(n)){if(!n.allowTabSynchronization)throw new le(K.FAILED_PRECONDITION,Hp);return!1}}return!(!this.networkEnabled||!this.inForeground)||rd(e).J().next(r=>this.ss(r,qp).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,l=this.networkEnabled===s.networkEnabled;if(i||a&&l)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&ie(Gs,`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[fu,Qa],e=>{const n=new wg(e,yr.ce);return this.Zi(n).next(()=>this.ts(n))}),this.Ui.close(),this.Ps()}ss(e,n){return e.filter(r=>this.rs(r.updateTimeMs,n)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>rd(e).J().next(n=>this.ss(n,zp).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,n){return Rf.wt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new NV(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Pf.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,n,r){ie(Gs,"Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(c){return c===18?IO:c===17?eT:c===16?EO:c===15?fv:c===14?ZC:c===13?JC:c===12?wO:c===11?XC:void Ee(60245)}(this.Ni);let a;return this.Ui.runTransaction(e,s,i,l=>(a=new wg(l,this.ci?this.ci.next():yr.ce),n==="readwrite-primary"?this.Hi(a).next(c=>!!c||this.Yi(a)).next(c=>{if(!c)throw Ln(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new le(K.FAILED_PRECONDITION,BC);return r(a)}).next(c=>this.Xi(a).next(()=>c)):this.Is(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Is(e){return Ul(e).get(Go).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,qp)&&!this.us(n.ownerId)&&!this.es(n)&&!(this.Oi||this.allowTabSynchronization&&n.allowTabSynchronization))throw new le(K.FAILED_PRECONDITION,Hp)})}Xi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ul(e).put(Go,n)}static v(){return bi.v()}Zi(e){const n=Ul(e);return n.get(Go).next(r=>this.es(r)?(ie(Gs,"Releasing primary lease."),n.delete(Go)):U.resolve())}rs(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(Ln(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const n=/(?:Version|Mobile)\/1[456]/;$S()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var n;try{const r=((n=this.Ki)==null?void 0:n.getItem(this._s(e)))!==null;return ie(Gs,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ln(Gs,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Ln("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ul(t){return nn(t,fu)}function rd(t){return nn(t,Qa)}function GV(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=Je(),s=Je();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Av(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return $S()?8:qC(tn())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.ys(e,n).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ws(e,n,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new KV;return this.Ss(e,n,a).next(l=>{if(i.result=l,this.Vs)return this.bs(e,n,a,l.size)})}).next(()=>i.result)}bs(e,n,r,s){return r.documentReadCount<this.fs?(aa()<=tt.DEBUG&&ie("QueryEngine","SDK will not create cache indexes for query:",la(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),U.resolve()):(aa()<=tt.DEBUG&&ie("QueryEngine","Query:",la(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(aa()<=tt.DEBUG&&ie("QueryEngine","The SDK decides to create cache indexes for query:",la(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,_r(n))):U.resolve())}ys(e,n){if(vw(n))return U.resolve(null);let r=_r(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=jh(n,null,"F"),r=_r(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=Je(...i);return this.ps.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.Ds(n,l);return this.Cs(n,d,a,c.readTime)?this.ys(e,jh(n,null,"F")):this.vs(e,d,n,c)}))})))}ws(e,n,r,s){return vw(n)||s.isEqual(je.min())?U.resolve(null):this.ps.getDocuments(e,r).next(i=>{const a=this.Ds(n,i);return this.Cs(n,a,r,s)?U.resolve(null):(aa()<=tt.DEBUG&&ie("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),la(n)),this.vs(e,a,n,GL(s,qc)).next(l=>l))})}Ds(e,n){let r=new mt(xT(e));return n.forEach((s,i)=>{gu(e,i)&&(r=r.add(i))}),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,n,r){return aa()<=tt.DEBUG&&ie("QueryEngine","Using full collection scan to execute query:",la(n)),this.ps.getDocumentsMatchingQuery(e,n,cr.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pv="LocalStore",QV=3e8;class YV{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new At(ze),this.xs=new Os(i=>So(i),pu),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new iN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function aN(t,e,n,r){return new YV(t,e,n,r)}async function lN(t,e){const n=Ue(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],l=[];let c=Je();for(const d of s){a.push(d.batchId);for(const f of d.mutations)c=c.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)c=c.add(f.key)}return n.localDocuments.getDocuments(r,c).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:l}))})})}function XV(t,e){const n=Ue(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(l,c,d,f){const h=d.batch,p=h.keys();let x=U.resolve();return p.forEach(T=>{x=x.next(()=>f.getEntry(c,T)).next(C=>{const N=d.docVersions.get(T);Te(N!==null,48541),C.version.compareTo(N)<0&&(h.applyToRemoteDocument(C,d),C.isValidDocument()&&(C.setReadTime(d.commitVersion),f.addEntry(C)))})}),x.next(()=>l.mutationQueue.removeMutationBatch(c,h))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=Je();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function cN(t){const e=Ue(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function JV(t,e){const n=Ue(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const l=[];e.targetChanges.forEach((f,h)=>{const p=s.get(h);if(!p)return;l.push(n.Pi.removeMatchingKeys(i,f.removedDocuments,h).next(()=>n.Pi.addMatchingKeys(i,f.addedDocuments,h)));let x=p.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?x=x.withResumeToken(Xt.EMPTY_BYTE_STRING,je.min()).withLastLimboFreeSnapshotVersion(je.min()):f.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(f.resumeToken,r)),s=s.insert(h,x),function(C,N,_){return C.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=QV?!0:_.addedDocuments.size+_.modifiedDocuments.size+_.removedDocuments.size>0}(p,x,f)&&l.push(n.Pi.updateTargetData(i,x))});let c=ir(),d=Je();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,f))}),l.push(ZV(i,a,e.documentUpdates).next(f=>{c=f.ks,d=f.qs})),!r.isEqual(je.min())){const f=n.Pi.getLastRemoteSnapshotVersion(i).next(h=>n.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(f)}return U.waitFor(l).next(()=>a.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(n.Ms=s,i))}function ZV(t,e,n){let r=Je(),s=Je();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let a=ir();return n.forEach((l,c)=>{const d=i.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(je.min())?(e.removeEntry(l,c.readTime),a=a.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),a=a.insert(l,c)):ie(Pv,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{ks:a,qs:s}})}function eM(t,e){const n=Ue(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=lo),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function tM(t,e){const n=Ue(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Pi.getTargetData(r,e).next(i=>i?(s=i,U.resolve(s)):n.Pi.allocateTargetId(r).next(a=>(s=new bs(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r})}async function Og(t,e,n){const r=Ue(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!Oi(a))throw a;ie(Pv,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Qw(t,e,n){const r=Ue(t);let s=je.min(),i=Je();return r.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,f){const h=Ue(c),p=h.xs.get(f);return p!==void 0?U.resolve(h.Ms.get(p)):h.Pi.getTargetData(d,f)}(r,a,_r(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next(c=>{i=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(a,e,n?s:je.min(),n?i:Je())).next(l=>(nM(r,UO(e),l),{documents:l,Qs:i})))}function nM(t,e,n){let r=t.Os.get(e)||je.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.Os.set(e,r)}class Yw{constructor(){this.activeTargetIds=WO()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class uN{constructor(){this.Mo=new Yw,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Yw,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rM{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xw="ConnectivityMonitor";class Jw{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){ie(Xw,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){ie(Xw,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sd=null;function Vg(){return sd===null?sd=function(){return 268435456+Math.round(2147483648*Math.random())}():sd++,"0x"+sd.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wp="RestConnection",sM={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class iM{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Ch?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,i){const a=Vg(),l=this.zo(e,n.toUriEncodedString());ie(Wp,`Sending RPC '${e}' ${a}:`,l,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:d}=new URL(l),f=ki(d);return this.Jo(e,l,c,r,f).then(h=>(ie(Wp,`Received RPC '${e}' ${a}: `,h),h),h=>{throw wo(Wp,`RPC '${e}' ${a} failed with error: `,h,"url: ",l,"request:",r),h})}Ho(e,n,r,s,i,a){return this.Go(e,n,r,s,i)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+hl}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,n){const r=sM[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bn="WebChannelConnection";class aM extends iM{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,i){const a=Vg();return new Promise((l,c)=>{const d=new PC;d.setWithCredentials(!0),d.listenOnce(RC.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Nd.NO_ERROR:const h=d.getResponseJson();ie(bn,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(h)),l(h);break;case Nd.TIMEOUT:ie(bn,`RPC '${e}' ${a} timed out`),c(new le(K.DEADLINE_EXCEEDED,"Request time out"));break;case Nd.HTTP_ERROR:const p=d.getStatus();if(ie(bn,`RPC '${e}' ${a} failed with status:`,p,"response text:",d.getResponseText()),p>0){let x=d.getResponseJson();Array.isArray(x)&&(x=x[0]);const T=x==null?void 0:x.error;if(T&&T.status&&T.message){const C=function(_){const E=_.toLowerCase().replace(/_/g,"-");return Object.values(K).indexOf(E)>=0?E:K.UNKNOWN}(T.status);c(new le(C,T.message))}else c(new le(K.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new le(K.UNAVAILABLE,"Connection failed."));break;default:Ee(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{ie(bn,`RPC '${e}' ${a} completed.`)}});const f=JSON.stringify(s);ie(bn,`RPC '${e}' ${a} sending request:`,s),d.send(n,"POST",f,r,15)})}T_(e,n,r){const s=Vg(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=LC(),l=DC(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const f=i.join("");ie(bn,`Creating RPC '${e}' stream ${s}: ${f}`,c);const h=a.createWebChannel(f,c);this.I_(h);let p=!1,x=!1;const T=new oM({Yo:N=>{x?ie(bn,`Not sending because RPC '${e}' stream ${s} is closed:`,N):(p||(ie(bn,`Opening RPC '${e}' stream ${s} transport.`),h.open(),p=!0),ie(bn,`RPC '${e}' stream ${s} sending:`,N),h.send(N))},Zo:()=>h.close()}),C=(N,_,E)=>{N.listen(_,S=>{try{E(S)}catch(I){setTimeout(()=>{throw I},0)}})};return C(h,Xl.EventType.OPEN,()=>{x||(ie(bn,`RPC '${e}' stream ${s} transport opened.`),T.o_())}),C(h,Xl.EventType.CLOSE,()=>{x||(x=!0,ie(bn,`RPC '${e}' stream ${s} transport closed`),T.a_(),this.E_(h))}),C(h,Xl.EventType.ERROR,N=>{x||(x=!0,wo(bn,`RPC '${e}' stream ${s} transport errored. Name:`,N.name,"Message:",N.message),T.a_(new le(K.UNAVAILABLE,"The operation could not be completed")))}),C(h,Xl.EventType.MESSAGE,N=>{var _;if(!x){const E=N.data[0];Te(!!E,16349);const S=E,I=(S==null?void 0:S.error)||((_=S[0])==null?void 0:_.error);if(I){ie(bn,`RPC '${e}' stream ${s} received error:`,I);const L=I.status;let V=function(b){const P=Kt[b];if(P!==void 0)return kT(P)}(L),g=I.message;V===void 0&&(V=K.INTERNAL,g="Unknown error status: "+L+" with message "+I.message),x=!0,T.a_(new le(V,g)),h.close()}else ie(bn,`RPC '${e}' stream ${s} received:`,E),T.u_(E)}}),C(l,kC.STAT_EVENT,N=>{N.stat===gg.PROXY?ie(bn,`RPC '${e}' stream ${s} detected buffering proxy`):N.stat===gg.NOPROXY&&ie(bn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{T.__()},0),T}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lM(){return typeof window<"u"?window:null}function Md(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Df(t){return new lV(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN{constructor(e,n,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&ie("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zw="PersistentStream";class hN{constructor(e,n,r,s,i,a,l,c){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new dN(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===K.RESOURCE_EXHAUSTED?(Ln(n.toString()),Ln("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===K.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===n&&this.G_(r,s)},r=>{e(()=>{const s=new le(K.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ie(Zw,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(ie(Zw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class cM extends hN{constructor(e,n,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=dV(this.serializer,e),r=function(i){if(!("targetChange"in i))return je.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?je.min():a.readTime?Mn(a.readTime):je.min()}(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Pg(this.serializer),n.addTarget=function(i,a){let l;const c=a.target;if(l=Th(c)?{documents:$T(i,c)}:{query:Iv(i,c).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=OT(i,a.resumeToken);const d=jg(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(je.min())>0){l.readTime=nl(i,a.snapshotVersion.toTimestamp());const d=jg(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=pV(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Pg(this.serializer),n.removeTarget=e,this.q_(n)}}class uM extends hN{constructor(e,n,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Te(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Te(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Te(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=hV(e.writeResults,e.commitTime),r=Mn(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Pg(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>Ph(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dM{}class hM extends dM{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new le(K.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Go(e,Ag(n,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===K.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new le(K.UNKNOWN,i.toString())})}Ho(e,n,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Ho(e,Ag(n,r),s,a,l,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===K.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new le(K.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class fM{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ln(n),this.aa=!1):ie("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ao="RemoteStore";class pM{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(a=>{r.enqueueAndForget(async()=>{Bo(this)&&(ie(Ao,"Restarting streams for network reachability change."),await async function(c){const d=Ue(c);d.Ea.add(4),await vu(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Lf(d)}(this))})}),this.Ra=new fM(r,s)}}async function Lf(t){if(Bo(t))for(const e of t.da)await e(!0)}async function vu(t){for(const e of t.da)await e(!1)}function fN(t,e){const n=Ue(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Lv(n)?Dv(n):pl(n).O_()&&kv(n,e))}function Rv(t,e){const n=Ue(t),r=pl(n);n.Ia.delete(e),r.O_()&&pN(n,e),n.Ia.size===0&&(r.O_()?r.L_():Bo(n)&&n.Ra.set("Unknown"))}function kv(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(je.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}pl(t).Y_(e)}function pN(t,e){t.Va.Ue(e),pl(t).Z_(e)}function Dv(t){t.Va=new sV({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),pl(t).start(),t.Ra.ua()}function Lv(t){return Bo(t)&&!pl(t).x_()&&t.Ia.size>0}function Bo(t){return Ue(t).Ea.size===0}function mN(t){t.Va=void 0}async function mM(t){t.Ra.set("Online")}async function gM(t){t.Ia.forEach((e,n)=>{kv(t,e)})}async function yM(t,e){mN(t),Lv(t)?(t.Ra.ha(e),Dv(t)):t.Ra.set("Unknown")}async function vM(t,e,n){if(t.Ra.set("Online"),e instanceof LT&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))}(t,e)}catch(r){ie(Ao,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Oh(t,r)}else if(e instanceof Od?t.Va.Ze(e):e instanceof DT?t.Va.st(e):t.Va.tt(e),!n.isEqual(je.min()))try{const r=await cN(t.localStore);n.compareTo(r)>=0&&await function(i,a){const l=i.Va.Tt(a);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(c.resumeToken,a))}}),l.targetMismatches.forEach((c,d)=>{const f=i.Ia.get(c);if(!f)return;i.Ia.set(c,f.withResumeToken(Xt.EMPTY_BYTE_STRING,f.snapshotVersion)),pN(i,c);const h=new bs(f.target,c,d,f.sequenceNumber);kv(i,h)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){ie(Ao,"Failed to raise snapshot:",r),await Oh(t,r)}}async function Oh(t,e,n){if(!Oi(e))throw e;t.Ea.add(1),await vu(t),t.Ra.set("Offline"),n||(n=()=>cN(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ie(Ao,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await Lf(t)})}function gN(t,e){return e().catch(n=>Oh(t,n,e))}async function _u(t){const e=Ue(t),n=Ni(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:lo;for(;_M(e);)try{const s=await eM(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,xM(e,s)}catch(s){await Oh(e,s)}yN(e)&&vN(e)}function _M(t){return Bo(t)&&t.Ta.length<10}function xM(t,e){t.Ta.push(e);const n=Ni(t);n.O_()&&n.X_&&n.ea(e.mutations)}function yN(t){return Bo(t)&&!Ni(t).x_()&&t.Ta.length>0}function vN(t){Ni(t).start()}async function bM(t){Ni(t).ra()}async function wM(t){const e=Ni(t);for(const n of t.Ta)e.ea(n.mutations)}async function EM(t,e,n){const r=t.Ta.shift(),s=xv.from(r,e,n);await gN(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await _u(t)}async function IM(t,e){e&&Ni(t).X_&&await async function(r,s){if(function(a){return tV(a)&&a!==K.ABORTED}(s.code)){const i=r.Ta.shift();Ni(r).B_(),await gN(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await _u(r)}}(t,e),yN(t)&&vN(t)}async function e0(t,e){const n=Ue(t);n.asyncQueue.verifyOperationInProgress(),ie(Ao,"RemoteStore received new credentials");const r=Bo(n);n.Ea.add(3),await vu(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Lf(n)}async function SM(t,e){const n=Ue(t);e?(n.Ea.delete(2),await Lf(n)):e||(n.Ea.add(2),await vu(n),n.Ra.set("Unknown"))}function pl(t){return t.ma||(t.ma=function(n,r,s){const i=Ue(n);return i.sa(),new cM(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:mM.bind(null,t),t_:gM.bind(null,t),r_:yM.bind(null,t),H_:vM.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),Lv(t)?Dv(t):t.Ra.set("Unknown")):(await t.ma.stop(),mN(t))})),t.ma}function Ni(t){return t.fa||(t.fa=function(n,r,s){const i=Ue(n);return i.sa(),new uM(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:bM.bind(null,t),r_:IM.bind(null,t),ta:wM.bind(null,t),na:EM.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await _u(t)):(await t.fa.stop(),t.Ta.length>0&&(ie(Ao,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ov{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Vr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const a=Date.now()+r,l=new Ov(e,n,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new le(K.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Vv(t,e){if(Ln("AsyncQueue",`${e}: ${t}`),Oi(t))return new le(K.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da{static emptySet(e){return new Da(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||he.comparator(n.key,r.key):(n,r)=>he.comparator(n.key,r.key),this.keyedMap=Jl(),this.sortedSet=new At(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Da)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Da;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t0{constructor(){this.ga=new At(he.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ee(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class rl{constructor(e,n,r,s,i,a,l,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const a=[];return n.forEach(l=>{a.push({type:0,doc:l})}),new rl(e,n,Da.emptySet(n),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Sf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CM{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class TM{constructor(){this.queries=n0(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=Ue(n),i=s.queries;s.queries=n0(),i.forEach((a,l)=>{for(const c of l.Sa)c.onError(r)})})(this,new le(K.ABORTED,"Firestore shutting down"))}}function n0(){return new Os(t=>_T(t),Sf)}async function Mv(t,e){const n=Ue(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new CM,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(a){const l=Vv(a,`Initialization of query '${la(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&Uv(n)}async function Fv(t,e){const n=Ue(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function NM(t,e){const n=Ue(t);let r=!1;for(const s of e){const i=s.query,a=n.queries.get(i);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&Uv(n)}function jM(t,e,n){const r=Ue(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function Uv(t){t.Ca.forEach(e=>{e.next()})}var Mg,r0;(r0=Mg||(Mg={})).Ma="default",r0.Cache="cache";class $v{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new rl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=rl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Mg.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _N{constructor(e){this.key=e}}class xN{constructor(e){this.key=e}}class AM{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Je(),this.mutatedKeys=Je(),this.eu=xT(e),this.tu=new Da(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new t0,s=n?n.tu:this.tu;let i=n?n.mutatedKeys:this.mutatedKeys,a=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,h)=>{const p=s.get(f),x=gu(this.query,h)?h:null,T=!!p&&this.mutatedKeys.has(p.key),C=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let N=!1;p&&x?p.data.isEqual(x.data)?T!==C&&(r.track({type:3,doc:x}),N=!0):this.su(p,x)||(r.track({type:2,doc:x}),N=!0,(c&&this.eu(x,c)>0||d&&this.eu(x,d)<0)&&(l=!0)):!p&&x?(r.track({type:0,doc:x}),N=!0):p&&!x&&(r.track({type:1,doc:p}),N=!0,(c||d)&&(l=!0)),N&&(x?(a=a.add(x),i=C?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Cs:l,mutatedKeys:i}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((f,h)=>function(x,T){const C=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ee(20277,{Rt:N})}};return C(x)-C(T)}(f.type,h.type)||this.eu(f.doc,h.doc)),this.ou(r),s=s??!1;const l=n&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,d=c!==this.Za;return this.Za=c,a.length!==0||d?{snapshot:new rl(this.query,e.tu,i,a,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new t0,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Je(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const n=[];return e.forEach(r=>{this.Xa.has(r)||n.push(new xN(r))}),this.Xa.forEach(r=>{e.has(r)||n.push(new _N(r))}),n}cu(e){this.Ya=e.Qs,this.Xa=Je();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return rl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Bv="SyncEngine";class PM{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class RM{constructor(e){this.key=e,this.hu=!1}}class kM{constructor(e,n,r,s,i,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Os(l=>_T(l),Sf),this.Iu=new Map,this.Eu=new Set,this.du=new At(he.comparator),this.Au=new Map,this.Ru=new Tv,this.Vu={},this.mu=new Map,this.fu=jo.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function DM(t,e,n=!0){const r=CN(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await bN(r,e,n,!0),s}async function LM(t,e){const n=CN(t);await bN(n,e,!0,!1)}async function bN(t,e,n,r){const s=await tM(t.localStore,_r(e)),i=s.targetId,a=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await OM(t,e,i,a==="current",s.resumeToken)),t.isPrimaryClient&&n&&fN(t.remoteStore,s),l}async function OM(t,e,n,r,s){t.pu=(h,p,x)=>async function(C,N,_,E){let S=N.view.ru(_);S.Cs&&(S=await Qw(C.localStore,N.query,!1).then(({documents:g})=>N.view.ru(g,S)));const I=E&&E.targetChanges.get(N.targetId),L=E&&E.targetMismatches.get(N.targetId)!=null,V=N.view.applyChanges(S,C.isPrimaryClient,I,L);return i0(C,N.targetId,V.au),V.snapshot}(t,h,p,x);const i=await Qw(t.localStore,e,!0),a=new AM(e,i.Qs),l=a.ru(i.documents),c=yu.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=a.applyChanges(l,t.isPrimaryClient,c);i0(t,n,d.au);const f=new PM(e,n,a);return t.Tu.set(e,f),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),d.snapshot}async function VM(t,e,n){const r=Ue(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(a=>!Sf(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Og(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Rv(r.remoteStore,s.targetId),Fg(r,s.targetId)}).catch($o)):(Fg(r,s.targetId),await Og(r.localStore,s.targetId,!0))}async function MM(t,e){const n=Ue(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Rv(n.remoteStore,r.targetId))}async function FM(t,e,n){const r=TN(t);try{const s=await function(a,l){const c=Ue(a),d=ot.now(),f=l.reduce((x,T)=>x.add(T.key),Je());let h,p;return c.persistence.runTransaction("Locally write mutations","readwrite",x=>{let T=ir(),C=Je();return c.Ns.getEntries(x,f).next(N=>{T=N,T.forEach((_,E)=>{E.isValidDocument()||(C=C.add(_))})}).next(()=>c.localDocuments.getOverlayedDocuments(x,T)).next(N=>{h=N;const _=[];for(const E of l){const S=JO(E,h.get(E.key).overlayedDocument);S!=null&&_.push(new Vs(E.key,S,uT(S.value.mapValue),Tn.exists(!0)))}return c.mutationQueue.addMutationBatch(x,d,_,l)}).next(N=>{p=N;const _=N.applyToLocalDocumentSet(h,C);return c.documentOverlayCache.saveOverlays(x,N.batchId,_)})}).then(()=>({batchId:p.batchId,changes:wT(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,c){let d=a.Vu[a.currentUser.toKey()];d||(d=new At(ze)),d=d.insert(l,c),a.Vu[a.currentUser.toKey()]=d}(r,s.batchId,n),await xu(r,s.changes),await _u(r.remoteStore)}catch(s){const i=Vv(s,"Failed to persist write");n.reject(i)}}async function wN(t,e){const n=Ue(t);try{const r=await JV(n.localStore,e);e.targetChanges.forEach((s,i)=>{const a=n.Au.get(i);a&&(Te(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Te(a.hu,14607):s.removedDocuments.size>0&&(Te(a.hu,42227),a.hu=!1))}),await xu(n,r,e)}catch(r){await $o(r)}}function s0(t,e,n){const r=Ue(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach((i,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)}),function(a,l){const c=Ue(a);c.onlineState=l;let d=!1;c.queries.forEach((f,h)=>{for(const p of h.Sa)p.va(l)&&(d=!0)}),d&&Uv(c)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function UM(t,e,n){const r=Ue(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new At(he.comparator);a=a.insert(i,Ut.newNoDocument(i,je.min()));const l=Je().add(i),c=new Af(je.min(),new Map,new At(ze),a,l);await wN(r,c),r.du=r.du.remove(i),r.Au.delete(e),zv(r)}else await Og(r.localStore,e,!1).then(()=>Fg(r,e,n)).catch($o)}async function $M(t,e){const n=Ue(t),r=e.batch.batchId;try{const s=await XV(n.localStore,e);IN(n,r,null),EN(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await xu(n,s)}catch(s){await $o(s)}}async function BM(t,e,n){const r=Ue(t);try{const s=await function(a,l){const c=Ue(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,l).next(h=>(Te(h!==null,37113),f=h.keys(),c.mutationQueue.removeMutationBatch(d,h))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(r.localStore,e);IN(r,e,n),EN(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await xu(r,s)}catch(s){await $o(s)}}function EN(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function IN(t,e,n){const r=Ue(t);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Fg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(r=>{t.Ru.containsKey(r)||SN(t,r)})}function SN(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(Rv(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),zv(t))}function i0(t,e,n){for(const r of n)r instanceof _N?(t.Ru.addReference(r.key,e),zM(t,r)):r instanceof xN?(ie(Bv,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||SN(t,r.key)):Ee(19791,{wu:r})}function zM(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(ie(Bv,"New document in limbo: "+n),t.Eu.add(r),zv(t))}function zv(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new he(ct.fromString(e)),r=t.fu.next();t.Au.set(r,new RM(n)),t.du=t.du.insert(n,r),fN(t.remoteStore,new bs(_r(mu(n.path)),r,"TargetPurposeLimboResolution",yr.ce))}}async function xu(t,e,n){const r=Ue(t),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((l,c)=>{a.push(r.pu(c,e,n).then(d=>{var f;if((d||n)&&r.isPrimaryClient){const h=d?!d.fromCache:(f=n==null?void 0:n.targetChanges.get(c.targetId))==null?void 0:f.current;r.sharedClientState.updateQueryState(c.targetId,h?"current":"not-current")}if(d){s.push(d);const h=Av.As(c.targetId,d);i.push(h)}}))}),await Promise.all(a),r.Pu.H_(s),await async function(c,d){const f=Ue(c);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>U.forEach(d,p=>U.forEach(p.Es,x=>f.persistence.referenceDelegate.addReference(h,p.targetId,x)).next(()=>U.forEach(p.ds,x=>f.persistence.referenceDelegate.removeReference(h,p.targetId,x)))))}catch(h){if(!Oi(h))throw h;ie(Pv,"Failed to update sequence numbers: "+h)}for(const h of d){const p=h.targetId;if(!h.fromCache){const x=f.Ms.get(p),T=x.snapshotVersion,C=x.withLastLimboFreeSnapshotVersion(T);f.Ms=f.Ms.insert(p,C)}}}(r.localStore,i))}async function qM(t,e){const n=Ue(t);if(!n.currentUser.isEqual(e)){ie(Bv,"User change. New user:",e.toKey());const r=await lN(n.localStore,e);n.currentUser=e,function(i,a){i.mu.forEach(l=>{l.forEach(c=>{c.reject(new le(K.CANCELLED,a))})}),i.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await xu(n,r.Ls)}}function HM(t,e){const n=Ue(t),r=n.Au.get(e);if(r&&r.hu)return Je().add(r.key);{let s=Je();const i=n.Iu.get(e);if(!i)return s;for(const a of i){const l=n.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function CN(t){const e=Ue(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=wN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=HM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=UM.bind(null,e),e.Pu.H_=NM.bind(null,e.eventManager),e.Pu.yu=jM.bind(null,e.eventManager),e}function TN(t){const e=Ue(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=$M.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=BM.bind(null,e),e}class eu{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Df(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return aN(this.persistence,new oN,e.initialUser,this.serializer)}Cu(e){return new Nv(kf.mi,this.serializer)}Du(e){return new uN}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}eu.provider={build:()=>new eu};class WM extends eu{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Te(this.persistence.referenceDelegate instanceof Lh,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new tN(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?In.withCacheSize(this.cacheSizeBytes):In.DEFAULT;return new Nv(r=>Lh.mi(r,n),this.serializer)}}class GM extends eu{constructor(e,n,r){super(),this.xu=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await TN(this.xu.syncEngine),await _u(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return aN(this.persistence,new oN,e.initialUser,this.serializer)}Fu(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new tN(r,e.asyncQueue,n)}Mu(e,n){const r=new XL(n,this.persistence);return new YL(e.asyncQueue,r)}Cu(e){const n=GV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?In.withCacheSize(this.cacheSizeBytes):In.DEFAULT;return new jv(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,lM(),Md(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new uN}}class Vh{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>s0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=qM.bind(null,this.syncEngine),await SM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new TM}()}createDatastore(e){const n=Df(e.databaseInfo.databaseId),r=function(i){return new aM(i)}(e.databaseInfo);return function(i,a,l,c){return new hM(i,a,l,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,a,l){return new pM(r,s,i,a,l)}(this.localStore,this.datastore,e.asyncQueue,n=>s0(this.syncEngine,n,0),function(){return Jw.v()?new Jw:new rM}())}createSyncEngine(e,n){return function(s,i,a,l,c,d,f){const h=new kM(s,i,a,l,c,d);return f&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=Ue(s);ie(Ao,"RemoteStore shutting down."),i.Ea.add(5),await vu(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}Vh.provider={build:()=>new Vh};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qv{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ln("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ji="FirestoreClient";class KM{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=fn.UNAUTHENTICATED,this.clientId=av.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{ie(ji,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(ie(ji,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Vr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Vv(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Gp(t,e){t.asyncQueue.verifyOperationInProgress(),ie(ji,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await lN(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function o0(t,e){t.asyncQueue.verifyOperationInProgress();const n=await QM(t);ie(ji,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>e0(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>e0(e.remoteStore,s)),t._onlineComponents=e}async function QM(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ie(ji,"Using user provided OfflineComponentProvider");try{await Gp(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===K.FAILED_PRECONDITION||s.code===K.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;wo("Error using user provided cache. Falling back to memory cache: "+n),await Gp(t,new eu)}}else ie(ji,"Using default OfflineComponentProvider"),await Gp(t,new WM(void 0));return t._offlineComponents}async function Hv(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ie(ji,"Using user provided OnlineComponentProvider"),await o0(t,t._uninitializedComponentsProvider._online)):(ie(ji,"Using default OnlineComponentProvider"),await o0(t,new Vh))),t._onlineComponents}function YM(t){return Hv(t).then(e=>e.syncEngine)}function XM(t){return Hv(t).then(e=>e.datastore)}async function Mh(t){const e=await Hv(t),n=e.eventManager;return n.onListen=DM.bind(null,e.syncEngine),n.onUnlisten=VM.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=LM.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=MM.bind(null,e.syncEngine),n}function JM(t,e,n={}){const r=new Vr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const f=new qv({next:p=>{f.Nu(),a.enqueueAndForget(()=>Fv(i,h));const x=p.docs.has(l);!x&&p.fromCache?d.reject(new le(K.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&p.fromCache&&c&&c.source==="server"?d.reject(new le(K.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(p)},error:p=>d.reject(p)}),h=new $v(mu(l.path),f,{includeMetadataChanges:!0,qa:!0});return Mv(i,h)}(await Mh(t),t.asyncQueue,e,n,r)),r.promise}function ZM(t,e,n={}){const r=new Vr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const f=new qv({next:p=>{f.Nu(),a.enqueueAndForget(()=>Fv(i,h)),p.fromCache&&c.source==="server"?d.reject(new le(K.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(p)},error:p=>d.reject(p)}),h=new $v(l,f,{includeMetadataChanges:!0,qa:!0});return Mv(i,h)}(await Mh(t),t.asyncQueue,e,n,r)),r.promise}function eF(t,e,n){const r=new Vr;return t.asyncQueue.enqueueAndForget(async()=>{try{const s=await XM(t);r.resolve(async function(a,l,c){var C;const d=Ue(a),{request:f,gt:h,parent:p}=fV(d.serializer,FO(l),c);d.connection.$o||delete f.parent;const x=(await d.Ho("RunAggregationQuery",d.serializer.databaseId,p,f,1)).filter(N=>!!N.result);Te(x.length===1,64727);const T=(C=x[0].result)==null?void 0:C.aggregateFields;return Object.keys(T).reduce((N,_)=>(N[h[_]]=T[_],N),{})}(s,e,n))}catch(s){r.reject(s)}}),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a0=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jN="firestore.googleapis.com",l0=!0;class c0{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new le(K.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=jN,this.ssl=l0}else this.host=e.host,this.ssl=e.ssl??l0;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=XT;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<AV)throw new le(K.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}HL("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=NN(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new le(K.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new le(K.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new le(K.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Of{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new c0({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new le(K.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new le(K.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new c0(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new LL;switch(r.type){case"firstParty":return new FL(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new le(K.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=a0.get(n);r&&(ie("ComponentProvider","Removing Datastore"),a0.delete(n),r.terminate())}(this),Promise.resolve()}}function tF(t,e,n,r={}){var d;t=Nn(t,Of);const s=ki(e),i=t._getSettings(),a={...i,emulatorOptions:t._getEmulatorOptions()},l=`${e}:${n}`;s&&(Wy(`https://${l}`),Gy("Firestore",!0)),i.host!==jN&&i.host!==l&&wo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:l,ssl:s,emulatorOptions:r};if(!As(c,a)&&(t._setSettings(c),r.mockUserToken)){let f,h;if(typeof r.mockUserToken=="string")f=r.mockUserToken,h=fn.MOCK_USER;else{f=MS(r.mockUserToken,(d=t._app)==null?void 0:d.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new le(K.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new fn(p)}t._authCredentials=new OL(new VC(f,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qr{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new qr(this.firestore,e,this._query)}}class Bt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Bt(this.firestore,e,this._key)}toJSON(){return{type:Bt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(hu(n,Bt._jsonSchema))return new Bt(e,r||null,new he(ct.fromString(n.referencePath)))}}Bt._jsonSchemaVersion="firestore/documentReference/1.0",Bt._jsonSchema={type:Yt("string",Bt._jsonSchemaVersion),referencePath:Yt("string")};class wi extends qr{constructor(e,n,r){super(e,n,mu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Bt(this.firestore,null,new he(e))}withConverter(e){return new wi(this.firestore,e,this._path)}}function se(t,e,...n){if(t=ht(t),FC("collection","path",e),t instanceof Of){const r=ct.fromString(e,...n);return Zb(r),new wi(t,null,r)}{if(!(t instanceof Bt||t instanceof wi))throw new le(K.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ct.fromString(e,...n));return Zb(r),new wi(t.firestore,null,r)}}function Re(t,e,...n){if(t=ht(t),arguments.length===1&&(e=av.newId()),FC("doc","path",e),t instanceof Of){const r=ct.fromString(e,...n);return Jb(r),new Bt(t,null,new he(r))}{if(!(t instanceof Bt||t instanceof wi))throw new le(K.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ct.fromString(e,...n));return Jb(r),new Bt(t.firestore,t instanceof wi?t.converter:null,new he(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u0="AsyncQueue";class d0{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new dN(this,"async_queue_retry"),this._c=()=>{const r=Md();r&&ie(u0,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Md();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Md();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new Vr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Oi(e))throw e;ie(u0,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Ln("INTERNAL UNHANDLED ERROR: ",h0(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=Ov.createAndSchedule(this,e,n,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&Ee(47125,{Pc:h0(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function h0(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f0(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class $r extends Of{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new d0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new d0(e),this._firestoreClient=void 0,await e}}}function AN(t,e){const n=typeof t=="object"?t:df(),r=typeof t=="string"?t:Ch,s=Di(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=LS("firestore");i&&tF(s,...i)}return s}function bu(t){if(t._terminated)throw new le(K.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||PN(t),t._firestoreClient}function PN(t){var r,s,i;const e=t._freezeSettings(),n=function(l,c,d,f){return new TO(l,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,NN(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new KM(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}function nF(t,e){wo("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return rF(t,Vh.provider,{build:r=>new GM(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function rF(t,e,n){if((t=Nn(t,$r))._firestoreClient||t._terminated)throw new le(K.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new le(K.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},PN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sF{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class iF{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new mr(Xt.fromBase64String(e))}catch(n){throw new le(K.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new mr(Xt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:mr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(hu(e,mr._jsonSchema))return mr.fromBase64String(e.bytes)}}mr._jsonSchemaVersion="firestore/bytes/1.0",mr._jsonSchema={type:Yt("string",mr._jsonSchemaVersion),bytes:Yt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new le(K.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Dt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new le(K.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new le(K.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ze(this._lat,e._lat)||ze(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:os._jsonSchemaVersion}}static fromJSON(e){if(hu(e,os._jsonSchema))return new os(e.latitude,e.longitude)}}os._jsonSchemaVersion="firestore/geoPoint/1.0",os._jsonSchema={type:Yt("string",os._jsonSchemaVersion),latitude:Yt("number"),longitude:Yt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:as._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(hu(e,as._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new as(e.vectorValues);throw new le(K.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}as._jsonSchemaVersion="firestore/vectorValue/1.0",as._jsonSchema={type:Yt("string",as._jsonSchemaVersion),vectorValues:Yt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oF=/^__.*__$/;class aF{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Vs(e,this.data,this.fieldMask,n,this.fieldTransforms):new fl(e,this.data,n,this.fieldTransforms)}}class RN{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Vs(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function kN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ee(40011,{Ac:t})}}class Mf{constructor(e,n,r,s,i,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Mf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Fh(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(kN(this.Ac)&&oF.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class lF{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Df(e)}Cc(e,n,r,s=!1){return new Mf({Ac:e,methodName:n,Dc:r,path:Dt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wu(t){const e=t._freezeSettings(),n=Df(t._databaseId);return new lF(t._databaseId,!!e.ignoreUndefinedProperties,n)}function DN(t,e,n,r,s,i={}){const a=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);Qv("Data must be an object, but it was:",a,r);const l=ON(r,a);let c,d;if(i.merge)c=new Gn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const h of i.mergeFields){const p=Ug(e,h,n);if(!a.contains(p))throw new le(K.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);MN(f,p)||f.push(p)}c=new Gn(f),d=a.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,d=a.fieldTransforms;return new aF(new Cn(l),c,d)}class Ff extends ml{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ff}}function cF(t,e,n){return new Mf({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Wv extends ml{_toFieldTransform(e){return new Tf(e.path,new Za)}isEqual(e){return e instanceof Wv}}class Gv extends ml{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=cF(this,e,!0),r=this.vc.map(i=>gl(i,n)),s=new Co(r);return new Tf(e.path,s)}isEqual(e){return e instanceof Gv&&As(this.vc,e.vc)}}class Kv extends ml{constructor(e,n){super(e),this.Fc=n}_toFieldTransform(e){const n=new tl(e.serializer,ST(e.serializer,this.Fc));return new Tf(e.path,n)}isEqual(e){return e instanceof Kv&&this.Fc===e.Fc}}function uF(t,e,n,r){const s=t.Cc(1,e,n);Qv("Data must be an object, but it was:",s,r);const i=[],a=Cn.empty();Vi(r,(c,d)=>{const f=Yv(e,c,n);d=ht(d);const h=s.yc(f);if(d instanceof Ff)i.push(f);else{const p=gl(d,h);p!=null&&(i.push(f),a.set(f,p))}});const l=new Gn(i);return new RN(a,l,s.fieldTransforms)}function dF(t,e,n,r,s,i){const a=t.Cc(1,e,n),l=[Ug(e,r,n)],c=[s];if(i.length%2!=0)throw new le(K.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<i.length;p+=2)l.push(Ug(e,i[p])),c.push(i[p+1]);const d=[],f=Cn.empty();for(let p=l.length-1;p>=0;--p)if(!MN(d,l[p])){const x=l[p];let T=c[p];T=ht(T);const C=a.yc(x);if(T instanceof Ff)d.push(x);else{const N=gl(T,C);N!=null&&(d.push(x),f.set(x,N))}}const h=new Gn(d);return new RN(f,h,a.fieldTransforms)}function LN(t,e,n,r=!1){return gl(n,t.Cc(r?4:3,e))}function gl(t,e){if(VN(t=ht(t)))return Qv("Unsupported field value:",e,t),ON(t,e);if(t instanceof ml)return function(r,s){if(!kN(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const l of r){let c=gl(l,s.wc(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=ht(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return ST(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=ot.fromDate(r);return{timestampValue:nl(s.serializer,i)}}if(r instanceof ot){const i=new ot(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:nl(s.serializer,i)}}if(r instanceof os)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof mr)return{bytesValue:OT(s.serializer,r._byteString)};if(r instanceof Bt){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Ev(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof as)return function(a,l){return{mapValue:{fields:{[pv]:{stringValue:mv},[Ya]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return vv(l.serializer,d)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${gf(r)}`)}(t,e)}function ON(t,e){const n={};return tT(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Vi(t,(r,s)=>{const i=gl(s,e.mc(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function VN(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ot||t instanceof os||t instanceof mr||t instanceof Bt||t instanceof ml||t instanceof as)}function Qv(t,e,n){if(!VN(n)||!UC(n)){const r=gf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Ug(t,e,n){if((e=ht(e))instanceof Vf)return e._internalPath;if(typeof e=="string")return Yv(t,e);throw Fh("Field path arguments must be of type string or ",t,!1,void 0,n)}const hF=new RegExp("[~\\*/\\[\\]]");function Yv(t,e,n){if(e.search(hF)>=0)throw Fh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Vf(...e.split("."))._internalPath}catch{throw Fh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Fh(t,e,n,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${r}`),a&&(c+=` in document ${s}`),c+=")"),new le(K.INVALID_ARGUMENT,l+t+c)}function MN(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xv{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Bt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new fF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Uf("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class fF extends Xv{data(){return super.data()}}function Uf(t,e){return typeof e=="string"?Yv(t,e):e instanceof Vf?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FN(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new le(K.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jv{}class Eu extends Jv{}function Le(t,e,...n){let r=[];e instanceof Jv&&r.push(e),r=r.concat(n),function(i){const a=i.filter(c=>c instanceof Zv).length,l=i.filter(c=>c instanceof $f).length;if(a>1||a>0&&l>0)throw new le(K.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class $f extends Eu{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new $f(e,n,r)}_apply(e){const n=this._parse(e);return $N(e._query,n),new qr(e.firestore,e.converter,Ng(e._query,n))}_parse(e){const n=wu(e.firestore);return function(i,a,l,c,d,f,h){let p;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new le(K.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){y0(h,f);const T=[];for(const C of h)T.push(g0(c,i,C));p={arrayValue:{values:T}}}else p=g0(c,i,h)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||y0(h,f),p=LN(l,a,h,f==="in"||f==="not-in");return nt.create(d,f,p)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Xe(t,e,n){const r=e,s=Uf("where",t);return $f._create(s,r,n)}class Zv extends Jv{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Zv(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:ft.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let a=s;const l=i.getFlattenedFilters();for(const c of l)$N(a,c),a=Ng(a,c)}(e._query,n),new qr(e.firestore,e.converter,Ng(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class e_ extends Eu{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new e_(e,n)}_apply(e){const n=function(s,i,a){if(s.startAt!==null)throw new le(K.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new le(K.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Zc(i,a)}(e._query,this._field,this._direction);return new qr(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new Mi(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function gt(t,e="asc"){const n=e,r=Uf("orderBy",t);return e_._create(r,n)}class t_ extends Eu{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new t_(e,n,r)}_apply(e){return new qr(e.firestore,e.converter,jh(e._query,this._limit,this._limitType))}}function La(t){return WL("limit",t),t_._create("limit",t,"F")}class Bf extends Eu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Bf(e,n,r)}_apply(e){const n=UN(e,this.type,this._docOrFields,this._inclusive);return new qr(e.firestore,e.converter,function(s,i){return new Mi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,n))}}function p0(...t){return Bf._create("startAt",t,!0)}function pF(...t){return Bf._create("startAfter",t,!1)}class n_ extends Eu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new n_(e,n,r)}_apply(e){const n=UN(e,this.type,this._docOrFields,this._inclusive);return new qr(e.firestore,e.converter,function(s,i){return new Mi(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,n))}}function m0(...t){return n_._create("endAt",t,!0)}function UN(t,e,n,r){if(n[0]=ht(n[0]),n[0]instanceof Xv)return function(i,a,l,c,d){if(!c)throw new le(K.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const f=[];for(const h of ka(i))if(h.field.isKeyField())f.push(Io(a,c.key));else{const p=c.data.field(h.field);if(wf(p))throw new le(K.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){const x=h.field.canonicalString();throw new le(K.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${x}' (used as the orderBy) does not exist.`)}f.push(p)}return new Ti(f,d)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=wu(t.firestore);return function(a,l,c,d,f,h){const p=a.explicitOrderBy;if(f.length>p.length)throw new le(K.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const x=[];for(let T=0;T<f.length;T++){const C=f[T];if(p[T].field.isKeyField()){if(typeof C!="string")throw new le(K.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof C}`);if(!yv(a)&&C.indexOf("/")!==-1)throw new le(K.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${C}' contains a slash.`);const N=a.path.child(ct.fromString(C));if(!he.isDocumentKey(N))throw new le(K.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);const _=new he(N);x.push(Io(l,_))}else{const N=LN(c,d,C);x.push(N)}}return new Ti(x,h)}(t._query,t.firestore._databaseId,s,e,n,r)}}function g0(t,e,n){if(typeof(n=ht(n))=="string"){if(n==="")throw new le(K.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yv(e)&&n.indexOf("/")!==-1)throw new le(K.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ct.fromString(n));if(!he.isDocumentKey(r))throw new le(K.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Io(t,new he(r))}if(n instanceof Bt)return Io(t,n._key);throw new le(K.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${gf(n)}.`)}function y0(t,e){if(!Array.isArray(t)||t.length===0)throw new le(K.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function $N(t,e){const n=function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new le(K.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new le(K.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class mF{convertValue(e,n="none"){switch(Si(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Tt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ds(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ee(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Vi(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var r,s,i;const n=(i=(s=(r=e.fields)==null?void 0:r[Ya].arrayValue)==null?void 0:s.values)==null?void 0:i.map(a=>Tt(a.doubleValue));return new as(n)}convertGeoPoint(e){return new os(Tt(e.latitude),Tt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Ef(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Yc(e));default:return null}}convertTimestamp(e){const n=ks(e);return new ot(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=ct.fromString(e);Te(HT(r),9688,{name:e});const s=new Eo(r.get(1),r.get(3)),i=new he(r.popFirst(5));return s.isEqual(n)||Ln(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BN(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}function gF(){return new sF("count")}class tc{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ho extends Xv{constructor(e,n,r,s,i,a){super(e,n,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Fd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Uf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new le(K.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=ho._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}ho._jsonSchemaVersion="firestore/documentSnapshot/1.0",ho._jsonSchema={type:Yt("string",ho._jsonSchemaVersion),bundleSource:Yt("string","DocumentSnapshot"),bundleName:Yt("string"),bundle:Yt("string")};class Fd extends ho{data(e={}){return super.data(e)}}class fo{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new tc(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Fd(this._firestore,this._userDataWriter,r.key,r,new tc(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new le(K.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const c=new Fd(s._firestore,s._userDataWriter,l.doc.key,l.doc,new tc(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new Fd(s._firestore,s._userDataWriter,l.doc.key,l.doc,new tc(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:yF(l.type),doc:c,oldIndex:d,newIndex:f}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new le(K.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=fo._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=av.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(n.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function yF(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ee(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Po(t){t=Nn(t,Bt);const e=Nn(t.firestore,$r);return JM(bu(e),t._key).then(n=>zN(e,t,n))}fo._jsonSchemaVersion="firestore/querySnapshot/1.0",fo._jsonSchema={type:Yt("string",fo._jsonSchemaVersion),bundleSource:Yt("string","QuerySnapshot"),bundleName:Yt("string"),bundle:Yt("string")};class zf extends mF{constructor(e){super(),this.firestore=e}convertBytes(e){return new mr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Bt(this.firestore,null,n)}}function Se(t){t=Nn(t,qr);const e=Nn(t.firestore,$r),n=bu(e),r=new zf(e);return FN(t._query),ZM(n,t._query).then(s=>new fo(e,r,t,s))}function Ro(t,e,n){t=Nn(t,Bt);const r=Nn(t.firestore,$r),s=BN(t.converter,e,n);return qf(r,[DN(wu(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,Tn.none())])}function $t(t,e,n,...r){t=Nn(t,Bt);const s=Nn(t.firestore,$r),i=wu(s);let a;return a=typeof(e=ht(e))=="string"||e instanceof Vf?dF(i,"updateDoc",t._key,e,n,r):uF(i,"updateDoc",t._key,e),qf(s,[a.toMutation(t._key,Tn.exists(!0))])}function An(t){return qf(Nn(t.firestore,$r),[new jf(t._key,Tn.none())])}function zt(t,e){const n=Nn(t.firestore,$r),r=Re(t),s=BN(t.converter,e);return qf(n,[DN(wu(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,Tn.exists(!1))]).then(()=>r)}function cn(t,...e){var c,d,f;t=ht(t);let n={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||f0(e[r])||(n=e[r++]);const s={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(f0(e[r])){const h=e[r];e[r]=(c=h.next)==null?void 0:c.bind(h),e[r+1]=(d=h.error)==null?void 0:d.bind(h),e[r+2]=(f=h.complete)==null?void 0:f.bind(h)}let i,a,l;if(t instanceof Bt)a=Nn(t.firestore,$r),l=mu(t._key.path),i={next:h=>{e[r]&&e[r](zN(a,t,h))},error:e[r+1],complete:e[r+2]};else{const h=Nn(t,qr);a=Nn(h.firestore,$r),l=h._query;const p=new zf(a);i={next:x=>{e[r]&&e[r](new fo(a,p,h,x))},error:e[r+1],complete:e[r+2]},FN(t._query)}return function(p,x,T,C){const N=new qv(C),_=new $v(x,N,T);return p.asyncQueue.enqueueAndForget(async()=>Mv(await Mh(p),_)),()=>{N.Nu(),p.asyncQueue.enqueueAndForget(async()=>Fv(await Mh(p),_))}}(bu(a),l,s,i)}function qf(t,e){return function(r,s){const i=new Vr;return r.asyncQueue.enqueueAndForget(async()=>FM(await YM(r),s,i)),i.promise}(bu(t),e)}function zN(t,e,n){const r=n.docs.get(e._key),s=new zf(t);return new ho(t,s,e._key,r,new tc(n.hasPendingWrites,n.fromCache),e.converter)}function vF(t){return _F(t,{count:gF()})}function _F(t,e){const n=Nn(t.firestore,$r),r=bu(n),s=SO(e,(i,a)=>new ZO(a,i.aggregateType,i._internalFieldPath));return eF(r,t._query,s).then(i=>function(l,c,d){const f=new zf(l);return new iF(c,f,d)}(n,t,i))}function kt(){return new Wv("serverTimestamp")}function xF(...t){return new Gv("arrayUnion",t)}function v0(t){return new Kv("increment",t)}(function(e,n=!0){(function(s){hl=s})(Fo),Fr(new Er("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new $r(new VL(r.getProvider("auth-internal")),new UL(a,r.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new le(K.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Eo(d.options.projectId,f)}(a,s),a);return i={useFetchStreams:n,...i},l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Xn(Kb,Qb,e),Xn(Kb,Qb,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qN="firebasestorage.googleapis.com",HN="storageBucket",bF=2*60*1e3,wF=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht extends Ir{constructor(e,n,r=0){super(Kp(e),`Firebase Storage: ${n} (${Kp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ht.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Kp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var qt;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(qt||(qt={}));function Kp(t){return"storage/"+t}function r_(){const t="An unknown error occurred, please check the error payload for server response.";return new Ht(qt.UNKNOWN,t)}function EF(t){return new Ht(qt.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function IF(t){return new Ht(qt.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function SF(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ht(qt.UNAUTHENTICATED,t)}function CF(){return new Ht(qt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function TF(t){return new Ht(qt.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function NF(){return new Ht(qt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function jF(){return new Ht(qt.CANCELED,"User canceled the upload/download.")}function AF(t){return new Ht(qt.INVALID_URL,"Invalid URL '"+t+"'.")}function PF(t){return new Ht(qt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function RF(){return new Ht(qt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+HN+"' property when initializing the app?")}function kF(){return new Ht(qt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function DF(){return new Ht(qt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function LF(t){return new Ht(qt.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function $g(t){return new Ht(qt.INVALID_ARGUMENT,t)}function WN(){return new Ht(qt.APP_DELETED,"The Firebase app was deleted.")}function OF(t){return new Ht(qt.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function wc(t,e){return new Ht(qt.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function $l(t){throw new Ht(qt.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=On.makeFromUrl(e,n)}catch{return new On(e,"")}if(r.path==="")return r;throw PF(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(I){I.path.charAt(I.path.length-1)==="/"&&(I.path_=I.path_.slice(0,-1))}const a="(/(.*))?$",l=new RegExp("^gs://"+s+a,"i"),c={bucket:1,path:3};function d(I){I.path_=decodeURIComponent(I.path)}const f="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",x=new RegExp(`^https?://${h}/${f}/b/${s}/o${p}`,"i"),T={bucket:1,path:3},C=n===qN?"(?:storage.googleapis.com|storage.cloud.google.com)":n,N="([^?#]*)",_=new RegExp(`^https?://${C}/${s}/${N}`,"i"),S=[{regex:l,indices:c,postModify:i},{regex:x,indices:T,postModify:d},{regex:_,indices:{bucket:1,path:2},postModify:d}];for(let I=0;I<S.length;I++){const L=S[I],V=L.regex.exec(e);if(V){const g=V[L.indices.bucket];let v=V[L.indices.path];v||(v=""),r=new On(g,v),L.postModify(r);break}}if(r==null)throw AF(e);return r}}class VF{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MF(t,e,n){let r=1,s=null,i=null,a=!1,l=0;function c(){return l===2}let d=!1;function f(...N){d||(d=!0,e.apply(null,N))}function h(N){s=setTimeout(()=>{s=null,t(x,c())},N)}function p(){i&&clearTimeout(i)}function x(N,..._){if(d){p();return}if(N){p(),f.call(null,N,..._);return}if(c()||a){p(),f.call(null,N,..._);return}r<64&&(r*=2);let S;l===1?(l=2,S=0):S=(r+Math.random())*1e3,h(S)}let T=!1;function C(N){T||(T=!0,p(),!d&&(s!==null?(N||(l=2),clearTimeout(s),h(0)):N||(l=1)))}return h(0),i=setTimeout(()=>{a=!0,C(!0)},n),C}function FF(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UF(t){return t!==void 0}function $F(t){return typeof t=="object"&&!Array.isArray(t)}function s_(t){return typeof t=="string"||t instanceof String}function _0(t){return i_()&&t instanceof Blob}function i_(){return typeof Blob<"u"}function Bg(t,e,n,r){if(r<e)throw $g(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw $g(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iu(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function GN(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var po;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(po||(po={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BF(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zF{constructor(e,n,r,s,i,a,l,c,d,f,h,p=!0,x=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=f,this.connectionFactory_=h,this.retry=p,this.isUsingEmulator=x,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((T,C)=>{this.resolve_=T,this.reject_=C,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new id(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const a=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;const l=i.getErrorCode()===po.NO_ERROR,c=i.getStatus();if(!l||BF(c,this.additionalRetryCodes_)&&this.retry){const f=i.getErrorCode()===po.ABORT;r(!1,new id(!1,null,f));return}const d=this.successCodes_.indexOf(c)!==-1;r(!0,new id(d,i))})},n=(r,s)=>{const i=this.resolve_,a=this.reject_,l=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());UF(c)?i(c):i()}catch(c){a(c)}else if(l!==null){const c=r_();c.serverResponse=l.getErrorText(),this.errorCallback_?a(this.errorCallback_(l,c)):a(c)}else if(s.canceled){const c=this.appDelete_?WN():jF();a(c)}else{const c=NF();a(c)}};this.canceled_?n(!1,new id(!1,null,!0)):this.backoffId_=MF(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&FF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class id{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function qF(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function HF(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function WF(t,e){e&&(t["X-Firebase-GMPID"]=e)}function GF(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function KF(t,e,n,r,s,i,a=!0,l=!1){const c=GN(t.urlParams),d=t.url+c,f=Object.assign({},t.headers);return WF(f,e),qF(f,n),HF(f,i),GF(f,r),new zF(d,t.method,f,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,a,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QF(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function YF(...t){const e=QF();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(i_())return new Blob(t);throw new Ht(qt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function XF(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JF(t){if(typeof atob>"u")throw LF("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ts={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Qp{constructor(e,n){this.data=e,this.contentType=n||null}}function ZF(t,e){switch(t){case ts.RAW:return new Qp(KN(e));case ts.BASE64:case ts.BASE64URL:return new Qp(QN(t,e));case ts.DATA_URL:return new Qp(t4(e),n4(e))}throw r_()}function KN(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,a=t.charCodeAt(++n);r=65536|(i&1023)<<10|a&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function e4(t){let e;try{e=decodeURIComponent(t)}catch{throw wc(ts.DATA_URL,"Malformed data URL.")}return KN(e)}function QN(t,e){switch(t){case ts.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw wc(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case ts.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw wc(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=JF(e)}catch(s){throw s.message.includes("polyfill")?s:wc(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class YN{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw wc(ts.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=r4(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function t4(t){const e=new YN(t);return e.base64?QN(ts.BASE64,e.rest):e4(e.rest)}function n4(t){return new YN(t).contentType}function r4(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,n){let r=0,s="";_0(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(_0(this.data_)){const r=this.data_,s=XF(r,e,n);return s===null?null:new ii(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new ii(r,!0)}}static getBlob(...e){if(i_()){const n=e.map(r=>r instanceof ii?r.data_:r);return new ii(YF.apply(null,n))}else{const n=e.map(a=>s_(a)?ZF(ts.RAW,a).data:a.data_);let r=0;n.forEach(a=>{r+=a.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(a=>{for(let l=0;l<a.length;l++)s[i++]=a[l]}),new ii(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o_(t){let e;try{e=JSON.parse(t)}catch{return null}return $F(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s4(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function i4(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function XN(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o4(t,e){return e}class kn{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||o4}}let od=null;function a4(t){return!s_(t)||t.length<2?t:XN(t)}function JN(){if(od)return od;const t=[];t.push(new kn("bucket")),t.push(new kn("generation")),t.push(new kn("metageneration")),t.push(new kn("name","fullPath",!0));function e(i,a){return a4(a)}const n=new kn("name");n.xform=e,t.push(n);function r(i,a){return a!==void 0?Number(a):a}const s=new kn("size");return s.xform=r,t.push(s),t.push(new kn("timeCreated")),t.push(new kn("updated")),t.push(new kn("md5Hash",null,!0)),t.push(new kn("cacheControl",null,!0)),t.push(new kn("contentDisposition",null,!0)),t.push(new kn("contentEncoding",null,!0)),t.push(new kn("contentLanguage",null,!0)),t.push(new kn("contentType",null,!0)),t.push(new kn("metadata","customMetadata",!0)),od=t,od}function l4(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new On(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function c4(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const a=n[i];r[a.local]=a.xform(r,e[a.server])}return l4(r,t),r}function ZN(t,e,n){const r=o_(e);return r===null?null:c4(t,r,n)}function u4(t,e,n,r){const s=o_(e);if(s===null||!s_(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const a=encodeURIComponent;return i.split(",").map(d=>{const f=t.bucket,h=t.fullPath,p="/b/"+a(f)+"/o/"+a(h),x=Iu(p,n,r),T=GN({alt:"media",token:d});return x+T})[0]}function d4(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x0="prefixes",b0="items";function h4(t,e,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[x0])for(const s of n[x0]){const i=s.replace(/\/$/,""),a=t._makeStorageReference(new On(e,i));r.prefixes.push(a)}if(n[b0])for(const s of n[b0]){const i=t._makeStorageReference(new On(e,s.name));r.items.push(i)}return r}function f4(t,e,n){const r=o_(n);return r===null?null:h4(t,e,r)}class Hf{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a_(t){if(!t)throw r_()}function p4(t,e){function n(r,s){const i=ZN(t,s,e);return a_(i!==null),i}return n}function m4(t,e){function n(r,s){const i=f4(t,e,s);return a_(i!==null),i}return n}function g4(t,e){function n(r,s){const i=ZN(t,s,e);return a_(i!==null),u4(i,s,t.host,t._protocol)}return n}function l_(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=CF():s=SF():n.getStatus()===402?s=IF(t.bucket):n.getStatus()===403?s=TF(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function e1(t){const e=l_(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=EF(t.path)),i.serverResponse=s.serverResponse,i}return n}function y4(t,e,n,r,s){const i={};e.isRoot?i.prefix="":i.prefix=e.path+"/",n.length>0&&(i.delimiter=n),r&&(i.pageToken=r),s&&(i.maxResults=s);const a=e.bucketOnlyServerUrl(),l=Iu(a,t.host,t._protocol),c="GET",d=t.maxOperationRetryTime,f=new Hf(l,c,m4(t,e.bucket),d);return f.urlParams=i,f.errorHandler=l_(e),f}function v4(t,e,n){const r=e.fullServerUrl(),s=Iu(r,t.host,t._protocol),i="GET",a=t.maxOperationRetryTime,l=new Hf(s,i,g4(t,n),a);return l.errorHandler=e1(e),l}function _4(t,e){const n=e.fullServerUrl(),r=Iu(n,t.host,t._protocol),s="DELETE",i=t.maxOperationRetryTime;function a(c,d){}const l=new Hf(r,s,a,i);return l.successCodes=[200,204],l.errorHandler=e1(e),l}function x4(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function b4(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=x4(null,e)),r}function w4(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function l(){let S="";for(let I=0;I<2;I++)S=S+Math.random().toString().slice(2);return S}const c=l();a["Content-Type"]="multipart/related; boundary="+c;const d=b4(e,r,s),f=d4(d,n),h="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+f+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,p=`\r
--`+c+"--",x=ii.getBlob(h,r,p);if(x===null)throw kF();const T={name:d.fullPath},C=Iu(i,t.host,t._protocol),N="POST",_=t.maxUploadRetryTime,E=new Hf(C,N,p4(t,n),_);return E.urlParams=T,E.headers=a,E.body=x.uploadData(),E.errorHandler=l_(e),E}class E4{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=po.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=po.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=po.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s,i){if(this.sent_)throw $l("cannot .send() more than once");if(ki(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const a in i)i.hasOwnProperty(a)&&this.xhr_.setRequestHeader(a,i[a].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw $l("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw $l("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw $l("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw $l("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class I4 extends E4{initXhr(){this.xhr_.responseType="text"}}function Wf(){return new I4}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(e,n){this._service=e,n instanceof On?this._location=n:this._location=On.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new ko(e,n)}get root(){const e=new On(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return XN(this._location.path)}get storage(){return this._service}get parent(){const e=s4(this._location.path);if(e===null)return null;const n=new On(this._location.bucket,e);return new ko(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw OF(e)}}function S4(t,e,n){t._throwIfRoot("uploadBytes");const r=w4(t.storage,t._location,JN(),new ii(e,!0),n);return t.storage.makeRequestWithTokens(r,Wf).then(s=>({metadata:s,ref:t}))}function C4(t){const e={prefixes:[],items:[]};return t1(t,e).then(()=>e)}async function t1(t,e,n){const s=await T4(t,{pageToken:n});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await t1(t,e,s.nextPageToken)}function T4(t,e){e!=null&&typeof e.maxResults=="number"&&Bg("options.maxResults",1,1e3,e.maxResults);const n=e||{},r=y4(t.storage,t._location,"/",n.pageToken,n.maxResults);return t.storage.makeRequestWithTokens(r,Wf)}function N4(t){t._throwIfRoot("getDownloadURL");const e=v4(t.storage,t._location,JN());return t.storage.makeRequestWithTokens(e,Wf).then(n=>{if(n===null)throw DF();return n})}function j4(t){t._throwIfRoot("deleteObject");const e=_4(t.storage,t._location);return t.storage.makeRequestWithTokens(e,Wf)}function A4(t,e){const n=i4(t._location.path,e),r=new On(t._location.bucket,n);return new ko(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P4(t){return/^[A-Za-z]+:\/\//.test(t)}function R4(t,e){return new ko(t,e)}function n1(t,e){if(t instanceof c_){const n=t;if(n._bucket==null)throw RF();const r=new ko(n,n._bucket);return e!=null?n1(r,e):r}else return e!==void 0?A4(t,e):t}function k4(t,e){if(e&&P4(e)){if(t instanceof c_)return R4(t,e);throw $g("To use ref(service, url), the first argument must be a Storage instance.")}else return n1(t,e)}function w0(t,e){const n=e==null?void 0:e[HN];return n==null?null:On.makeFromBucketSpec(n,t)}function D4(t,e,n,r={}){t.host=`${e}:${n}`;const s=ki(e);s&&(Wy(`https://${t.host}/b`),Gy("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:MS(i,t.app.options.projectId))}class c_{constructor(e,n,r,s,i,a=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=a,this._bucket=null,this._host=qN,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=bF,this._maxUploadRetryTime=wF,this._requests=new Set,s!=null?this._bucket=On.makeFromBucketSpec(s,this._host):this._bucket=w0(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=On.makeFromBucketSpec(this._url,e):this._bucket=w0(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Bg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Bg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(pr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ko(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new VF(WN());{const a=KF(e,this._appId,r,s,n,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const E0="@firebase/storage",I0="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r1="storage";function S0(t,e,n){return t=ht(t),S4(t,e,n)}function C0(t){return t=ht(t),C4(t)}function T0(t){return t=ht(t),N4(t)}function Yp(t){return t=ht(t),j4(t)}function Bl(t,e){return t=ht(t),k4(t,e)}function eo(t=df(),e){t=ht(t);const r=Di(t,r1).getImmediate({identifier:e}),s=LS("storage");return s&&L4(r,...s),r}function L4(t,e,n,r={}){D4(t,e,n,r)}function O4(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new c_(n,r,s,e,Fo)}function V4(){Fr(new Er(r1,O4,"PUBLIC").setMultipleInstances(!0)),Xn(E0,I0,""),Xn(E0,I0,"esm2020")}V4();const M4={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},u_=Yy(M4),N0=jC(u_),j0=AN(u_);eo(u_);const F4="/odontocloud-react/assets/fondo.png",s1="/odontocloud-react/assets/logo.png",A0=(t,e)=>{const n={email:t,rol:e,timestamp:Date.now()};localStorage.setItem("odc_session",JSON.stringify(n))},Xp=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},U4=()=>{const t=cs(),[e,n]=w.useState(""),[r,s]=w.useState(""),[i,a]=w.useState(""),[l,c]=w.useState(navigator.onLine);w.useEffect(()=>{const h=()=>c(!0),p=()=>c(!1);return window.addEventListener("online",h),window.addEventListener("offline",p),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",p)}},[]);const d=h=>{const p=(h||"").toLowerCase();p==="administrador"?t("/dashboard_admin",{replace:!0}):p==="doctor"?t("/dashboard_doctor",{replace:!0}):p==="recepcionista"?t("/dashboard_recepcion",{replace:!0}):a("Rol no reconocido. Contacte al administrador.")};w.useEffect(()=>{if(!navigator.onLine){const p=Xp();p!=null&&p.rol?d(p.rol):a("Sin conexin y no hay sesin guardada.");return}const h=rv(N0,async p=>{if(p){const x=Xp();if(x!=null&&x.rol){d(x.rol);return}try{const T=Le(se(j0,"users"),Xe("correo","==",p.email||"")),C=await Se(T);if(!C.empty){const N=C.docs[0].data().rol||"sin_rol";A0(p.email||"",N),d(N)}}catch{d("administrador")}}});return()=>h()},[]);const f=async h=>{if(h.preventDefault(),a(""),!l){const p=Xp();p!=null&&p.rol?d(p.rol):a("Sin conexin y no hay sesin guardada.");return}try{const x=(await x2(N0,e,r)).user,T=Le(se(j0,"users"),Xe("correo","==",e)),C=await Se(T);if(C.empty){a("Usuario no encontrado en la base de datos.");return}const _=C.docs[0].data().rol||"sin_rol";A0(e,_),d(_)}catch(p){switch(console.error("Error login:",p),p.code){case"auth/user-not-found":a("Usuario no registrado.");break;case"auth/wrong-password":a("Contrasea incorrecta.");break;case"auth/invalid-email":a("Correo no vlido.");break;case"auth/network-request-failed":a("Sin conexin. Usa la sesin guardada o reconecta.");break;default:a("Error al iniciar sesin.")}}};return o.jsx("div",{className:"login-root",style:{backgroundImage:`url(${F4})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed",width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:o.jsxs("div",{className:"container",children:[o.jsxs("div",{className:"left-panel",children:[o.jsx("img",{src:s1,alt:"OdontoCloud Logo",className:"logo"}),o.jsxs("h2",{children:["Su clnica, ",o.jsx("br",{})," ms conectada."]}),o.jsx("p",{children:"OdontoCloud optimiza cada detalle de su gestin."})]}),o.jsxs("div",{className:"right-panel",children:[o.jsx("h3",{children:"Acceso a la plataforma"}),o.jsxs("form",{onSubmit:f,children:[o.jsx("input",{type:"email",placeholder:"usuario@ejemplo.com",value:e,onChange:h=>n(h.target.value),required:l}),o.jsx("input",{type:"password",placeholder:"Contrasea",value:r,onChange:h=>s(h.target.value),required:l}),o.jsx("button",{type:"submit",children:l?"Iniciar sesin":"Entrar (modo offline)"}),i&&o.jsx("p",{style:{color:"red",marginTop:10},children:i}),!l&&o.jsx("p",{style:{color:"orange",marginTop:10},children:" Modo offline activado"})]})]})]})})},i1="@firebase/installations",d_="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1=1e4,a1=`w:${d_}`,l1="FIS_v2",$4="https://firebaseinstallations.googleapis.com/v1",B4=60*60*1e3,z4="installations",q4="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Do=new Mo(z4,q4,H4);function c1(t){return t instanceof Ir&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u1({projectId:t}){return`${$4}/projects/${t}/installations`}function d1(t){return{token:t.token,requestStatus:2,expiresIn:G4(t.expiresIn),creationTime:Date.now()}}async function h1(t,e){const r=(await e.json()).error;return Do.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function f1({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function W4(t,{refreshToken:e}){const n=f1(t);return n.append("Authorization",K4(e)),n}async function p1(t){const e=await t();return e.status>=500&&e.status<600?t():e}function G4(t){return Number(t.replace("s","000"))}function K4(t){return`${l1} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q4({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=u1(t),s=f1(t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={fid:n,authVersion:l1,appId:t.appId,sdkVersion:a1},l={method:"POST",headers:s,body:JSON.stringify(a)},c=await p1(()=>fetch(r,l));if(c.ok){const d=await c.json();return{fid:d.fid||n,registrationStatus:2,refreshToken:d.refreshToken,authToken:d1(d.authToken)}}else throw await h1("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m1(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y4(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X4=/^[cdef][\w-]{21}$/,zg="";function J4(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=Z4(t);return X4.test(n)?n:zg}catch{return zg}}function Z4(t){return Y4(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gf(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g1=new Map;function y1(t,e){const n=Gf(t);v1(n,e),e6(n,e)}function v1(t,e){const n=g1.get(t);if(n)for(const r of n)r(e)}function e6(t,e){const n=t6();n&&n.postMessage({key:t,fid:e}),n6()}let io=null;function t6(){return!io&&"BroadcastChannel"in self&&(io=new BroadcastChannel("[Firebase] FID Change"),io.onmessage=t=>{v1(t.data.key,t.data.fid)}),io}function n6(){g1.size===0&&io&&(io.close(),io=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r6="firebase-installations-database",s6=1,Lo="firebase-installations-store";let Jp=null;function h_(){return Jp||(Jp=WS(r6,s6,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Lo)}}})),Jp}async function Uh(t,e){const n=Gf(t),s=(await h_()).transaction(Lo,"readwrite"),i=s.objectStore(Lo),a=await i.get(n);return await i.put(e,n),await s.done,(!a||a.fid!==e.fid)&&y1(t,e.fid),e}async function _1(t){const e=Gf(t),r=(await h_()).transaction(Lo,"readwrite");await r.objectStore(Lo).delete(e),await r.done}async function Kf(t,e){const n=Gf(t),s=(await h_()).transaction(Lo,"readwrite"),i=s.objectStore(Lo),a=await i.get(n),l=e(a);return l===void 0?await i.delete(n):await i.put(l,n),await s.done,l&&(!a||a.fid!==l.fid)&&y1(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f_(t){let e;const n=await Kf(t.appConfig,r=>{const s=i6(r),i=o6(t,s);return e=i.registrationPromise,i.installationEntry});return n.fid===zg?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function i6(t){const e=t||{fid:J4(),registrationStatus:0};return x1(e)}function o6(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Do.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=a6(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:l6(t)}:{installationEntry:e}}async function a6(t,e){try{const n=await Q4(t,e);return Uh(t.appConfig,n)}catch(n){throw c1(n)&&n.customData.serverCode===409?await _1(t.appConfig):await Uh(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function l6(t){let e=await P0(t.appConfig);for(;e.registrationStatus===1;)await m1(100),e=await P0(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await f_(t);return r||n}return e}function P0(t){return Kf(t,e=>{if(!e)throw Do.create("installation-not-found");return x1(e)})}function x1(t){return c6(t)?{fid:t.fid,registrationStatus:0}:t}function c6(t){return t.registrationStatus===1&&t.registrationTime+o1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u6({appConfig:t,heartbeatServiceProvider:e},n){const r=d6(t,n),s=W4(t,n),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={installation:{sdkVersion:a1,appId:t.appId}},l={method:"POST",headers:s,body:JSON.stringify(a)},c=await p1(()=>fetch(r,l));if(c.ok){const d=await c.json();return d1(d)}else throw await h1("Generate Auth Token",c)}function d6(t,{fid:e}){return`${u1(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p_(t,e=!1){let n;const r=await Kf(t.appConfig,i=>{if(!b1(i))throw Do.create("not-registered");const a=i.authToken;if(!e&&p6(a))return i;if(a.requestStatus===1)return n=h6(t,e),i;{if(!navigator.onLine)throw Do.create("app-offline");const l=g6(i);return n=f6(t,l),l}});return n?await n:r.authToken}async function h6(t,e){let n=await R0(t.appConfig);for(;n.authToken.requestStatus===1;)await m1(100),n=await R0(t.appConfig);const r=n.authToken;return r.requestStatus===0?p_(t,e):r}function R0(t){return Kf(t,e=>{if(!b1(e))throw Do.create("not-registered");const n=e.authToken;return y6(n)?{...e,authToken:{requestStatus:0}}:e})}async function f6(t,e){try{const n=await u6(t,e),r={...e,authToken:n};return await Uh(t.appConfig,r),n}catch(n){if(c1(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await _1(t.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Uh(t.appConfig,r)}throw n}}function b1(t){return t!==void 0&&t.registrationStatus===2}function p6(t){return t.requestStatus===2&&!m6(t)}function m6(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+B4}function g6(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}function y6(t){return t.requestStatus===1&&t.requestTime+o1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function v6(t){const e=t,{installationEntry:n,registrationPromise:r}=await f_(e);return r?r.catch(console.error):p_(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _6(t,e=!1){const n=t;return await x6(n),(await p_(n,e)).token}async function x6(t){const{registrationPromise:e}=await f_(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b6(t){if(!t||!t.options)throw Zp("App Configuration");if(!t.name)throw Zp("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Zp(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function Zp(t){return Do.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w1="installations",w6="installations-internal",E6=t=>{const e=t.getProvider("app").getImmediate(),n=b6(e),r=Di(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},I6=t=>{const e=t.getProvider("app").getImmediate(),n=Di(e,w1).getImmediate();return{getId:()=>v6(n),getToken:s=>_6(n,s)}};function S6(){Fr(new Er(w1,E6,"PUBLIC")),Fr(new Er(w6,I6,"PRIVATE"))}S6();Xn(i1,d_);Xn(i1,d_,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $h="analytics",C6="firebase_id",T6="origin",N6=60*1e3,j6="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",m_="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fn=new uf("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A6={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},ar=new Mo("analytics","Analytics",A6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P6(t){if(!t.startsWith(m_)){const e=ar.create("invalid-gtag-resource",{gtagURL:t});return Fn.warn(e.message),""}return t}function E1(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function R6(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function k6(t,e){const n=R6("firebase-js-sdk-policy",{createScriptURL:P6}),r=document.createElement("script"),s=`${m_}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function D6(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function L6(t,e,n,r,s,i){const a=r[s];try{if(a)await e[a];else{const c=(await E1(n)).find(d=>d.measurementId===s);c&&await e[c.appId]}}catch(l){Fn.error(l)}t("config",s,i)}async function O6(t,e,n,r,s){try{let i=[];if(s&&s.send_to){let a=s.send_to;Array.isArray(a)||(a=[a]);const l=await E1(n);for(const c of a){const d=l.find(h=>h.measurementId===c),f=d&&e[d.appId];if(f)i.push(f);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),t("event",r,s||{})}catch(i){Fn.error(i)}}function V6(t,e,n,r){async function s(i,...a){try{if(i==="event"){const[l,c]=a;await O6(t,e,n,l,c)}else if(i==="config"){const[l,c]=a;await L6(t,e,n,r,l,c)}else if(i==="consent"){const[l,c]=a;t("consent",l,c)}else if(i==="get"){const[l,c,d]=a;t("get",l,c,d)}else if(i==="set"){const[l]=a;t("set",l)}else t(i,...a)}catch(l){Fn.error(l)}}return s}function M6(t,e,n,r,s){let i=function(...a){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=V6(i,t,e,n),{gtagCore:i,wrappedGtag:window[s]}}function F6(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(m_)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U6=30,$6=1e3;class B6{constructor(e={},n=$6){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const I1=new B6;function z6(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function q6(t){var a;const{appId:e,apiKey:n}=t,r={method:"GET",headers:z6(n)},s=j6.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let l="";try{const c=await i.json();(a=c.error)!=null&&a.message&&(l=c.error.message)}catch{}throw ar.create("config-fetch-failed",{httpStatus:i.status,responseMessage:l})}return i.json()}async function H6(t,e=I1,n){const{appId:r,apiKey:s,measurementId:i}=t.options;if(!r)throw ar.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw ar.create("no-api-key")}const a=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new K6;return setTimeout(async()=>{l.abort()},N6),S1({appId:r,apiKey:s,measurementId:i},a,l,e)}async function S1(t,{throttleEndTimeMillis:e,backoffCount:n},r,s=I1){var l;const{appId:i,measurementId:a}=t;try{await W6(r,e)}catch(c){if(a)return Fn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:a};throw c}try{const c=await q6(t);return s.deleteThrottleMetadata(i),c}catch(c){const d=c;if(!G6(d)){if(s.deleteThrottleMetadata(i),a)return Fn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:i,measurementId:a};throw c}const f=Number((l=d==null?void 0:d.customData)==null?void 0:l.httpStatus)===503?vb(n,s.intervalMillis,U6):vb(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+f,backoffCount:n+1};return s.setThrottleMetadata(i,h),Fn.debug(`Calling attemptFetch again in ${f} millis`),S1(t,h,r,s)}}function W6(t,e){return new Promise((n,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(n,s);t.addEventListener(()=>{clearTimeout(i),r(ar.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function G6(t){if(!(t instanceof Ir)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class K6{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Q6(t,e,n,r,s){if(s&&s.global){t("event",n,r);return}else{const i=await e,a={...r,send_to:i};t("event",n,a)}}async function Y6(t,e,n,r){if(r&&r.global){const s={};for(const i of Object.keys(n))s[`user_properties.${i}`]=n[i];return t("set",s),Promise.resolve()}else{const s=await e;t("config",s,{update:!0,user_properties:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X6(){if(Ky())try{await zS()}catch(t){return Fn.warn(ar.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return Fn.warn(ar.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function J6(t,e,n,r,s,i,a){const l=H6(t);l.then(p=>{n[p.measurementId]=p.appId,t.options.measurementId&&p.measurementId!==t.options.measurementId&&Fn.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>Fn.error(p)),e.push(l);const c=X6().then(p=>{if(p)return r.getId()}),[d,f]=await Promise.all([l,c]);F6(i)||k6(i,d.measurementId),s("js",new Date);const h=(a==null?void 0:a.config)??{};return h[T6]="firebase",h.update=!0,f!=null&&(h[C6]=f),s("config",d.measurementId,h),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z6{constructor(e){this.app=e}_delete(){return delete Oa[this.app.options.appId],Promise.resolve()}}let Oa={},k0=[];const D0={};let em="dataLayer",eU="gtag",L0,g_,O0=!1;function tU(){const t=[];if(US()&&t.push("This is a browser extension environment."),nk()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,s)=>`(${s+1}) ${r}`).join(" "),n=ar.create("invalid-analytics-context",{errorInfo:e});Fn.warn(n.message)}}function nU(t,e,n){tU();const r=t.options.appId;if(!r)throw ar.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)Fn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw ar.create("no-api-key");if(Oa[r]!=null)throw ar.create("already-exists",{id:r});if(!O0){D6(em);const{wrappedGtag:i,gtagCore:a}=M6(Oa,k0,D0,em,eU);g_=i,L0=a,O0=!0}return Oa[r]=J6(t,k0,D0,e,L0,em,n),new Z6(t)}function rU(t=df()){t=ht(t);const e=Di(t,$h);return e.isInitialized()?e.getImmediate():sU(t)}function sU(t,e={}){const n=Di(t,$h);if(n.isInitialized()){const s=n.getImmediate();if(As(e,n.getOptions()))return s;throw ar.create("already-initialized")}return n.initialize({options:e})}function iU(t,e,n){t=ht(t),Y6(g_,Oa[t.app.options.appId],e,n).catch(r=>Fn.error(r))}function oU(t,e,n,r){t=ht(t),Q6(g_,Oa[t.app.options.appId],e,n,r).catch(s=>Fn.error(s))}const V0="@firebase/analytics",M0="0.10.19";function aU(){Fr(new Er($h,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return nU(r,s,n)},"PUBLIC")),Fr(new Er("analytics-internal",t,"PRIVATE")),Xn(V0,M0),Xn(V0,M0,"esm2020");function t(e){try{const n=e.getProvider($h).getImmediate();return{logEvent:(r,s,i)=>oU(n,r,s,i),setUserProperties:(r,s)=>iU(n,r,s)}}catch(n){throw ar.create("interop-component-reg-failed",{reason:n})}}}aU();const lU={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},Qf=Yy(lU),Bh=jC(Qf),Q=AN(Qf);eo(Qf);rU(Qf);const y_=(t,e="")=>{try{return localStorage.getItem(t)??e}catch{return e}},F0=()=>{var t;return((t=document.querySelector('meta[name="company-name"]'))==null?void 0:t.getAttribute("content"))||y_("empresa_nombre","OdontoCloud")},cU=()=>{var t;return((t=document.querySelector('meta[name="company-logo"]'))==null?void 0:t.getAttribute("content"))||y_("empresa_logo_url","")},U0=()=>{var t;return((t=document.querySelector('meta[name="software-footer"]'))==null?void 0:t.getAttribute("content"))||y_("software_footer_text","Generado por OdontoCloud")},ad=()=>{const t=new Date;return t.setHours(0,0,0,0),t},Ks=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e},tm=t=>{const e=new Date(t);return e.setHours(23,59,59,999),e},Kr=(t,e)=>{const n=new Date(t);return n.setDate(n.getDate()+e),n},$0=t=>{const e=new Date(t),n=e.getDay(),r=(n===0?-6:1)-n;return e.setDate(e.getDate()+r),e.setHours(0,0,0,0),e},B0=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();var eE;const er=typeof navigator<"u"&&((eE=navigator.language)!=null&&eE.startsWith("es"))?"es-ES":"en-US",nm=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`},Zo=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),uU=t=>{try{const e=new URLSearchParams(t||""),n=e.get("date")||e.get("day")||e.get("d")||e.get("fecha")||e.get("selectedDate")||(typeof sessionStorage<"u"?sessionStorage.getItem("agenda.targetDate"):""),r=String(n||"").slice(0,10);if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return null;const[s,i,a]=r.split("-").map(c=>parseInt(c,10));return new Date(s,(i||1)-1,a||1,0,0,0,0)}catch{return null}};function dU(){const t=Bn(),[e,n]=w.useState("day"),[r,s]=w.useState(ad()),[i,a]=w.useState(ad()),[l,c]=w.useState(!0),[d,f]=w.useState([]),[h,p]=w.useState(""),[x,T]=w.useState(""),[C,N]=w.useState(""),[_,E]=w.useState([]),[S,I]=w.useState([]),[L,V]=w.useState([]);w.useEffect(()=>{const W=Le(se(Q,"profesionales"),Xe("activo","==",!0)),fe=cn(W,ge=>{E(ge.docs.map(Y=>{const X=Y.data()||{};return{id:Y.id,nombre:X.nombre||X.nombres||X.nombreCompleto||Y.id,especialidad:X.especialidad||X.especialidadNombre||"",activo:X.activo!==!1}}))},()=>E([])),ye=Le(se(Q,"consultorios"),Xe("activo","==",!0)),J=cn(ye,ge=>{I(ge.docs.map(Y=>{const X=Y.data()||{};return{id:Y.id,nombre:X.nombre||X.descripcion||Y.id,sucursalId:X.sucursalId||X.sedeId||"",sucursalNombre:X.sucursalNombre||X.sede||"",activo:X.activo!==!1}}))},()=>I([])),Z=Le(se(Q,"sucursales"),Xe("activo","==",!0)),Ie=cn(Z,ge=>{V(ge.docs.map(Y=>{const X=Y.data()||{};return{id:Y.id,nombre:X.nombre||X.alias||Y.id,activo:X.activo!==!1}}))},()=>V([]));return()=>{try{fe(),J(),Ie()}catch{}}},[]),w.useEffect(()=>{const W=uU(t.search);if(W){const fe=Ks(W);s(fe),a(fe),n("day");try{sessionStorage.removeItem("agenda.targetDate")}catch{}}},[t.search]),w.useEffect(()=>{c(!0);const W=se(Q,"citas"),fe=Le(W,gt("fecha","asc")),ye=cn(fe,J=>{const Z=J.docs.map(X=>{const B=X.data(),pe=B.horaInicio||B.hora||"00:00",[Ve="0",Be="0"]=pe.split(":"),Me=parseInt(Ve,10)||0,Ke=parseInt(Be,10)||0;let xe;if(B.fecha&&B.fecha.toDate)xe=B.fecha.toDate(),xe.setHours(Me,Ke,0,0);else if(typeof B.fecha=="string"){const[bt,q,ce]=B.fecha.split("-");xe=new Date(parseInt(bt,10),parseInt(q,10)-1,parseInt(ce,10),Me,Ke,0,0)}else B.fecha instanceof Date?(xe=new Date(B.fecha),xe.setHours(Me,Ke,0,0)):(xe=new Date,xe.setHours(Me,Ke,0,0));const lt=B.documentoPaciente||B.docPaciente||B.pacienteDocumento||B.documento||"",Ze=B.celularPaciente||B.telefonoPaciente||B.celular||B.telefono||"";return{id:X.id,raw:B,fecha:xe,horaInicio:pe,paciente:B.paciente||B.pacienteNombre||"Sin nombre",doctor:B.doctor||B.doctorNombre||"",doctorId:B.doctorId||"",sucursal:B.sucursal||B.sucursalNombre||"",sucursalId:B.sucursalId||"",espacio:B.espacio||B.consultorio||B.consultorioNombre||"",consultorioId:B.consultorioId||"",comentario:B.comentario||"",estado:B.estado||"En espera",recordatorio:B.recordatorio||"",documento:lt,telefono:Ze}});let Ie,ge;if(e==="day")Ie=Ks(r),ge=tm(r);else if(e==="week"){const X=$0(r),B=Kr(X,6);Ie=Ks(X),ge=tm(B)}else{const X=Ks(r),B=Kr(X,-30),pe=Kr(X,60);Ie=Ks(B),ge=tm(pe)}const Y=Z.filter(X=>X.fecha>=Ie&&X.fecha<=ge);f(Y),c(!1)},J=>{console.error("Error leyendo citas:",J),f([]),c(!1)});return()=>ye()},[e,r]);const g=w.useMemo(()=>{const W=L.map(ye=>ye.nombre).filter(Boolean);if(W.length)return W;const fe=new Set;return d.forEach(ye=>ye.sucursal&&fe.add(ye.sucursal)),Array.from(fe)},[d,L]),v=w.useMemo(()=>{const W=_.map(ye=>ye.nombre).filter(Boolean);if(W.length)return W;const fe=new Set;return d.forEach(ye=>ye.doctor&&fe.add(ye.doctor)),Array.from(fe)},[d,_]),b=w.useMemo(()=>{const W=C.trim().toLowerCase();return d.filter(fe=>{if(h&&fe.sucursal!==h||x&&fe.doctor!==x)return!1;if(!W)return!0;const ye=[fe.paciente,fe.doctor,fe.comentario,fe.documento,fe.sucursal,fe.espacio,fe.estado],J=fe.raw?JSON.stringify(fe.raw):"";return[...ye,J].filter(Boolean).some(Ie=>String(Ie).toLowerCase().includes(W))})},[d,h,x,C]),P=w.useMemo(()=>l?"Ocupacin: cargando...":b.length===0?"Ocupacin: sin citas para el rango seleccionado.":`Ocupacin: ${b.length} cita${b.length!==1?"s":""} en el rango actual.`,[b,l]),R=w.useMemo(()=>{const W=new Date(i.getFullYear(),i.getMonth(),1),fe=(W.getDay()+6)%7,ye=new Date(W);ye.setDate(ye.getDate()-fe);const J=[];for(let Z=0;Z<6;Z++){const Ie=[];for(let ge=0;ge<7;ge++){const Y=new Date(ye),X=Y.getMonth()===i.getMonth(),B=B0(Y,ad()),pe=B0(Y,r);Ie.push({date:Y,isCurrentMonth:X,isToday:B,isSelected:pe}),ye.setDate(ye.getDate()+1)}J.push(Ie)}return J},[i,r]),O=()=>{const W=new Date(i);W.setMonth(W.getMonth()-1),a(W)},k=()=>{const W=new Date(i);W.setMonth(W.getMonth()+1),a(W)},M=W=>{s(Ks(W)),a(Ks(W)),n("day")},z=w.useMemo(()=>i.toLocaleDateString(er,{month:"long",year:"numeric"}),[i]),ve=w.useMemo(()=>{if(e==="day")return r.toLocaleDateString(er,{weekday:"long",day:"2-digit",month:"long",year:"numeric"});if(e==="week"){const W=$0(r),fe=Kr(W,6);return W.toLocaleDateString(er,{day:"2-digit",month:"short"})+" - "+fe.toLocaleDateString(er,{day:"2-digit",month:"short",year:"numeric"})}return"ltimas citas (detalle)"},[e,r]),we=()=>{s(e==="day"?Kr(r,-1):e==="week"?Kr(r,-7):Kr(r,-1))},ee=()=>{s(e==="day"?Kr(r,1):e==="week"?Kr(r,7):Kr(r,1))},te=()=>{const W=ad();s(W),a(W),n("day")},ne=()=>{var Ke;const W=xe=>String(xe??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),fe=F0(),ye=cU(),J=U0(),Z=h||"",Ie=x||"",ge=new Date;ge.setHours(0,0,0,0);const Y=b.length===0?'<tr class="empty"><td colspan="10">No hay citas registradas para este rango.</td></tr>':b.map((xe,lt)=>{var re,ue,Ae,Pe,$e,Fe;const Ze=xe.fecha.toLocaleTimeString(er,{hour:"2-digit",minute:"2-digit",hour12:!0}),bt=xe.documento||((re=xe.raw)==null?void 0:re.documento)||((ue=xe.raw)==null?void 0:ue.nroDocumento)||"",q=((Ae=xe.raw)==null?void 0:Ae.celularPaciente)||((Pe=xe.raw)==null?void 0:Pe.celular)||"",ce=(($e=xe.raw)==null?void 0:$e.telefonoPaciente)||((Fe=xe.raw)==null?void 0:Fe.telefono)||"",D=new Date(xe.fecha.getFullYear(),xe.fecha.getMonth(),xe.fecha.getDate());let F="Futura";return D.getTime()===ge.getTime()?F="Hoy":D.getTime()<ge.getTime()&&(F="Pasada"),`<tr class="${lt%2?"zebra":""}">
                <td class="mono">${W(Ze)}</td>
                <td>${W(xe.paciente)}</td>
                <td class="mono">${W(bt)}</td>
                <td class="mono">${W(q)}</td>
                <td class="mono">${W(ce)}</td>
                <td>${W(xe.doctor)}</td>
                <td>${W(xe.espacio)}</td>
                <td>${W(xe.comentario)}</td>
                <td class="status">${W(xe.estado)}</td>
                <td class="actual">${W(F)}</td>
              </tr>`}).join(""),B=`<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Agenda  ${W(fe)}</title>
  <style>
      @page { size: A4 portrait; margin: 14mm 16mm; }
      * { box-sizing: border-box; }
      html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      body { font-family: "Segoe UI", Roboto, Arial, sans-serif; color:#0f172a; line-height:1.35; }

      /* Cabecera */
      .hdr {
        display:flex; flex-direction:column; align-items:center; text-align:center;
        margin-bottom:14px;
      }
      .logo {
        max-height:120px; width:auto; max-width:100%; object-fit:contain;
        filter: drop-shadow(0 1px 0 rgba(0,0,0,.04));
      }
      .brand {
        margin-top:4px; font-weight:800; letter-spacing:.5px; text-transform:uppercase;
        font-size:26px; color:#0a86d8;
      }
      .sub { margin-top:2px; font-size:12px; color:#64748b; }

      /* Tarjeta info Sede/Doctor */
      .info-card {
        width:100%; display:flex; justify-content:center; margin:8px 0 16px;
      }
      .info {
        width:70%; border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; border-collapse:separate;
        font-size:12px;
      }
      .info-row { display:flex; border-top:1px solid #e5e7eb; }
      .info-row:first-child { border-top:0; }
      .label {
        width:22%; padding:8px 10px; background:#f8fafc; font-weight:600; color:#334155; border-right:1px solid #e5e7eb;
      }
      .value { flex:1; padding:8px 10px; }

      /* Tabla principal */
      table { width:100%; border-collapse:separate; border-spacing:0; font-size:12px; }
      thead th {
        background:#0f172a; color:#ffffff; text-align:center; font-weight:700;
        padding:9px 8px; position:relative;
      }
      thead th + th { box-shadow: inset 1px 0 0 rgba(255,255,255,.08); }
      tbody td {
        padding:8px 8px; vertical-align:top; border-bottom:1px solid #e5e7eb;
      }
      tbody tr.zebra td { background:#fafafa; }
      tbody tr.empty td {
        padding:16px; color:#6b7280; text-align:center; background:#fafafa;
        border:1px dashed #e5e7eb; border-radius:8px;
      }
      td.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
      td.status { white-space:nowrap; }
      td.actual { font-weight:600; }
      /* Bordes exteriores suaves */
      .tbl-wrap { border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; }

      /* Notas pie */
      .note { margin-top:10px; font-size:10px; color:#6b7280; }

      /* Evitar cortes feos */
      tr, .hdr, .info-card { page-break-inside: avoid; }
    </style>
</head>
<body>
  <div class="hdr">
    ${ye?`<img src="${ye}" alt="Logo" class="logo">`:""}
    <div class="brand">${W(fe)}</div>
    <div class="sub">Agenda de citas  ${W(ve)}</div>
  </div>

  <div class="info-card">
    <div class="info">
      <div class="info-row"><div class="label">Sede</div><div class="value">${W(Z)}</div></div>
      <div class="info-row"><div class="label">Doctor</div><div class="value">${W(Ie)}</div></div>
    </div>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th style="width:9%">Hora</th>
          <th style="width:17%">Nombre paciente</th>
          <th style="width:12%">Documento</th>
          <th style="width:12%">Celular</th>
          <th style="width:12%">Telfono</th>
          <th style="width:10%">Doctor</th>
          <th style="width:11%">Espacio</th>
          <th>Comentario</th>
          <th style="width:9%">Estado</th>
          <th style="width:9%">Actualidad</th>
        </tr>
      </thead>
      <tbody>${Y}</tbody>
    </table>
  </div>

  <div class="note">
    ${W(J)}  ${W(new Date().toLocaleString(er))}
  </div>

  <script>
    window.addEventListener('load', function() {
      try { window.focus(); window.print(); } catch (e) {}
    });
  <\/script>
</body>
</html>`,pe=new Blob([B],{type:"text/html;charset=utf-8"}),Ve=URL.createObjectURL(pe),Be=window.open(Ve,"_blank","noopener,noreferrer,width=900,height=700");if(!Be){alert("El navegador bloque la ventana de impresin. Permite pop-ups para este sitio."),URL.revokeObjectURL(Ve);return}const Me=()=>{try{URL.revokeObjectURL(Ve)}catch{}};(Ke=Be.addEventListener)==null||Ke.call(Be,"load",Me),setTimeout(Me,15e3)},me=()=>alert("Funcin de confirmar citas se integrar con n8n / correo."),Ne=()=>te(),ke=()=>{if(b.length===0){alert("No hay citas para exportar.");return}const W=F0(),fe=U0(),ye=[`Empresa: ${W}`],J=["Fecha","Hora","Paciente","Doctor","Espacio","Comentario"],Z=b.map(Ve=>{const Be=Ve.fecha.toLocaleDateString(er),Me=Ve.fecha.toLocaleTimeString(er,{hour:"2-digit",minute:"2-digit",hour12:!0});return[Be,Me,Ve.paciente||"",Ve.doctor||"",Ve.espacio||"",(Ve.comentario||"").replace(/\r?\n/g," ")]}),Ie=[fe],ge=[ye,[],J,...Z,[],Ie].map(Ve=>(Ve||[]).map(Be=>`"${String(Be??"").replace(/"/g,'""')}"`).join(",")).join(`
`),Y=`citas_${W.toLowerCase().replace(/\s+/g,"_")}_${nm(Ks(r))}`+(e==="week"?"_semana":e==="detail"?"_detalle":"")+".csv",X=new Blob(["\uFEFF"+ge],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(X),pe=document.createElement("a");pe.href=B,pe.download=Y,pe.click(),URL.revokeObjectURL(B)},He=async(W,fe)=>{try{const ye=Re(Q,"citas",W);await $t(ye,{estado:fe})}catch(ye){console.error("Error actualizando estado:",ye),alert("No se pudo actualizar el estado de la cita.")}},st=(W,fe)=>{if(!W){alert("Este paciente no tiene celular registrado.");return}const ye=String(W).replace(/\D/g,""),J=fe.fecha.toLocaleDateString(er),Z=fe.fecha.toLocaleTimeString(er,{hour:"numeric",minute:"2-digit",hour12:!0}),Ie=encodeURIComponent(`Hola ${fe.paciente}, le recordamos su cita odontolgica el ${J} a las ${Z}. Por favor confirme su asistencia.`),ge=`https://wa.me/${ye}?text=${Ie}`;window.open(ge,"_blank")},De=async W=>{if(window.confirm(`Seguro que deseas eliminar la cita de ${W.paciente} del ${W.fecha.toLocaleDateString(er)}?`))try{const ye=Re(Q,"citas",W.id);await An(ye)}catch(ye){console.error("Error eliminando cita:",ye),alert(" No se pudo eliminar la cita.")}},We=()=>{const W=document.createElement("div");Object.assign(W.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const fe=document.createElement("div");Object.assign(fe.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"}),fe.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Nueva Cita</h2>
      <form id="formNuevaCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label style="font-weight:600;">Paciente existente</label>
        <div style="position:relative;">
          <input type="text" id="buscarPaciente" placeholder="Buscar por nombre, apellido o documento..." autocomplete="off"/>
          <div id="acResultados" style="position:absolute;left:0;right:0;top:calc(100% + 6px);z-index:10000;display:none;background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 8px 22px rgba(0,0,0,.12);max-height:240px;overflow:auto;"></div>
        </div>
        <small style="color:gray;">Si el paciente no existe, marca Registrar nuevo paciente.</small>

        <label style="display:flex;align-items:center;gap:8px;margin-top:5px;">
          <input type="checkbox" id="esNuevoPaciente" />
          <span>Registrar nuevo paciente</span>
        </label>

        <div id="nuevoPacienteCampos" style="display:none;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border-radius:8px;background:#f9f9f9;border:1px solid #ddd;">
          <h4 style="margin:0;text-align:center;color:#0a86d8;">Datos del paciente</h4>
          <div style="display:flex;gap:8px;">
            <input type="text" id="npNombre" placeholder="Nombre" style="flex:1;" />
            <input type="text" id="npApellido" placeholder="Apellido" style="flex:1;" />
          </div>
          <select id="npTipoDocumento">
            <option value="">Tipo de documento</option>
            <option value="CC">Cdula de Ciudadana</option>
            <option value="CE">Cdula de Extranjera</option>
            <option value="TI">Tarjeta de Identidad</option>
            <option value="PA">Pasaporte</option>
            <option value="DI">Documento Internacional</option>
            <option value="OTRO">Otro</option>
          </select>
          <input type="text" id="npDocumento" placeholder="Nmero de documento" />
          <input type="email" id="npCorreo" placeholder="Correo electrnico" />
          <div style="display:flex;gap:5px;">
            <select id="npIndicativo" style="width:40%;">
              <option value="+57"> +57</option>
              <option value="+1"> +1</option>
              <option value="+34"> +34</option>
              <option value="+52"> +52</option>
              <option value="+54"> +54</option>
              <option value="+593"> +593</option>
              <option value="+56"> +56</option>
              <option value="+58"> +58</option>
            </select>
            <input type="tel" id="npCelular" placeholder="Celular (obligatorio)" style="flex:1;" />
          </div>
          <input type="tel" id="npTelefono" placeholder="Telfono fijo (opcional)" />
          <label style="font-weight:500;">Fecha de nacimiento:</label>
          <input type="date" id="npNacimiento" />
          <select id="npSexo">
            <option value="">Sexo</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
            <option value="Otro">Otro</option>
          </select>
          <textarea id="npComentario" placeholder="Comentario o antecedentes del paciente" rows="2"></textarea>
        </div>

        <hr style="margin:10px 0;border:none;border-top:1px solid #ddd;" />
        <h4 style="margin:0;text-align:center;color:#0a86d8;">Detalles de la cita</h4>

        <!--  Catlogos -->
        <label>Doctor asignado</label>
        <select id="ncDoctorSel" required>
          <option value="">Seleccione doctor</option>
        </select>

        <label>Fecha</label>
        <input type="date" id="ncFecha" required value="${nm(r)}" />

        <label>Hora</label>
        <input type="time" id="ncHora" required />

        <label>Espacio fsico / Consultorio</label>
        <select id="ncConsultorioSel">
          <option value="">Seleccione consultorio</option>
        </select>

        <label>Sucursal</label>
        <select id="ncSucursalSel">
          <option value="">Seleccione sucursal</option>
        </select>

        <label>Comentario</label>
        <textarea id="ncComentario" placeholder="Comentario sobre la cita" rows="3"></textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarModal" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    `;const ye=document.createElement("style");ye.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      input, select, textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      input:focus, select:focus, textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
      .ac-item { padding: 8px 10px; display:flex; gap:8px; align-items:baseline; cursor:pointer; }
      .ac-item:hover, .ac-item.active { background:#f5f7fb; }
      .ac-name { font-weight:600; } .ac-doc { color:#64748b; font-size:12px; } .ac-tel { margin-left:auto; font-size:12px; color:#0f172a; }
      .ac-empty { padding:10px; color:#9aa4b2; font-size:13px; }
    `,document.head.appendChild(ye),W.appendChild(fe),document.body.appendChild(W);const J=fe.querySelector("#esNuevoPaciente"),Z=fe.querySelector("#nuevoPacienteCampos"),Ie=fe.querySelector("#buscarPaciente"),ge=fe.querySelector("#acResultados"),Y=fe.querySelector("#ncDoctorSel"),X=fe.querySelector("#ncConsultorioSel"),B=fe.querySelector("#ncSucursalSel"),pe=(D,F,re)=>{const ue=document.createElement("option");ue.value=F,ue.textContent=re,D.appendChild(ue)};(_||[]).forEach(D=>{const F=D.especialidad?`${D.nombre}  ${D.especialidad}`:D.nombre;pe(Y,D.id,F)}),(S||[]).forEach(D=>{const F=D.sucursalNombre?`${D.nombre}  ${D.sucursalNombre}`:D.nombre;pe(X,D.id,F)}),(L||[]).forEach(D=>pe(B,D.id,D.nombre)),J.addEventListener("change",()=>{Z.style.display=J.checked?"flex":"none",J.checked&&(ge.style.display="none")}),fe.querySelector("#btnCancelarModal").addEventListener("click",()=>W.remove());let Ve=null,Be=null,Me=-1,Ke=[];const xe=D=>{if(Ke=D||[],Me=-1,!D||D.length===0){ge.innerHTML='<div class="ac-empty">Sin resultados</div>',ge.style.display="block";return}ge.innerHTML=D.map((F,re)=>`
            <div class="ac-item" data-index="${re}" data-id="${F.id}">
              <span class="ac-name">${F.nombre}</span>
              <span class="ac-doc"> ${F.documento||"s/doc"}</span>
              <span class="ac-tel">${F.celular||F.telefono||""}</span>
            </div>`).join(""),ge.style.display="block",[...ge.querySelectorAll(".ac-item")].forEach(F=>{F.addEventListener("click",()=>{const re=Number(F.getAttribute("data-index"));lt(re)})})},lt=D=>{const F=Ke[D];F&&(Be=F,Ie.value=F.nombre,ge.style.display="none",J.checked=!1,Z.style.display="none")},Ze=D=>{Ke.length&&(Me=(Me+D+Ke.length)%Ke.length,[...ge.querySelectorAll(".ac-item")].forEach((F,re)=>{re===Me?F.classList.add("active"):F.classList.remove("active")}))},bt=(D,F)=>D.nombreCompleto||D.paciente||[D.nombres,D.apellidos].filter(Boolean).join(" ")||F,q=async D=>{const F=(D||"").toString().trim(),re=Zo(F);if(!re||re.length<2)return[];if(/^\d{5,}$/.test(F))try{const ue=Le(se(Q,"pacientes"),Xe("documento","==",F)),Ae=Le(se(Q,"pacientes"),Xe("nroDocumento","==",F)),[Pe,$e]=await Promise.all([Se(ue),Se(Ae)]),Fe=Pe.empty?$e:Pe;if(!Fe.empty)return Fe.docs.slice(0,10).map(rt=>{const dt=rt.data()||{};return{id:rt.id,nombre:bt(dt,rt.id),documento:dt.documento||dt.nroDocumento||rt.id,celular:dt.celularPaciente||dt.celular||"",telefono:dt.telefonoPaciente||dt.telefono||""}})}catch{}try{const ue=Le(se(Q,"pacientes"),gt("nombre_busqueda"),p0(re),m0(re+""),La(10)),Ae=await Se(ue);if(!Ae.empty)return Ae.docs.map(Pe=>{const $e=Pe.data()||{};return{id:Pe.id,nombre:bt($e,Pe.id),documento:$e.documento||$e.nroDocumento||Pe.id,celular:$e.celularPaciente||$e.celular||"",telefono:$e.telefonoPaciente||$e.telefono||""}})}catch{}try{const ue=Le(se(Q,"pacientes"),gt("creado","desc"),La(50));return(await Se(ue)).docs.map(Fe=>({id:Fe.id,...Fe.data()||{}})).map(Fe=>({id:Fe.id,nombre:bt(Fe,Fe.id),documento:Fe.documento||Fe.nroDocumento||Fe.id,celular:Fe.celularPaciente||Fe.celular||"",telefono:Fe.telefonoPaciente||Fe.telefono||"",_norm:Zo(`${Fe.nombreCompleto||Fe.paciente||""} ${Fe.nombres||""} ${Fe.apellidos||""} ${Fe.documento||Fe.nroDocumento||""}`)})).filter(Fe=>Fe._norm.includes(re)).slice(0,10).map(({_norm:Fe,...rt})=>rt)}catch{}return[]};Ie.addEventListener("input",()=>{Be=null;const D=Ie.value;if(clearTimeout(Ve),!D||D.trim().length<2){ge.style.display="none";return}Ve=setTimeout(async()=>{const F=await q(D.trim());xe(F)},220)}),Ie.addEventListener("keydown",D=>{ge.style.display==="block"&&(D.key==="ArrowDown"?(D.preventDefault(),Ze(1)):D.key==="ArrowUp"?(D.preventDefault(),Ze(-1)):D.key==="Enter"?Me>=0&&(D.preventDefault(),lt(Me)):D.key==="Escape"&&(ge.style.display="none"))}),document.addEventListener("click",D=>{fe.contains(D.target)&&!ge.contains(D.target)&&D.target!==Ie&&(ge.style.display="none")},{capture:!0});const ce=fe.querySelector("#formNuevaCita");ce.addEventListener("submit",async D=>{D.preventDefault();const F=J.checked,re=(ce.querySelector("#buscarPaciente").value||"").trim(),ue=Y.value,Ae=ce.querySelector("#ncFecha").value,Pe=ce.querySelector("#ncHora").value,$e=X.value,Fe=B.value,rt=(ce.querySelector("#ncComentario").value||"").trim();if(!Ae||!Pe){alert(" Debes seleccionar fecha y hora para la cita.");return}if(!ue){alert(" Indica el doctor asignado.");return}const dt=(_||[]).find(ut=>ut.id===ue),Vt=(dt==null?void 0:dt.nombre)||"";let Qe="",Jn="";if($e){const ut=(S||[]).find(dn=>dn.id===$e);Qe=(ut==null?void 0:ut.nombre)||"",Jn=(ut==null?void 0:ut.sucursalNombre)||""}let Wt="";if(Fe){const ut=(L||[]).find(dn=>dn.id===Fe);Wt=(ut==null?void 0:ut.nombre)||""}!Fe&&Jn&&(Wt=Jn);try{let ut=null,dn=null,yn="",vn="",Sr="";if(F){const j=(ce.querySelector("#npNombre").value||"").trim(),G=(ce.querySelector("#npApellido").value||"").trim();if(yn=`${j} ${G}`.trim(),!yn){alert(" Debes indicar nombre y apellido para el nuevo paciente.");return}const oe=(ce.querySelector("#npDocumento").value||"").trim(),_e=(ce.querySelector("#npCelular").value||"").trim(),Ce=(ce.querySelector("#npTelefono").value||"").trim();if(!_e&&!Ce){alert(" Debes registrar al menos un telfono (celular o fijo) del paciente o de un acudiente.");return}if(ut=oe||yn.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"_"),dn=Re(Q,"pacientes",ut),!(await Po(dn)).exists()){const wt=Zo(yn);await Ro(dn,{nombres:j,apellidos:G,nombreCompleto:yn,paciente:yn,nombre_busqueda:wt,variantes_busqueda:[wt,Zo(j),Zo(G)],tipoDocumento:ce.querySelector("#npTipoDocumento").value,documento:oe,correo:(ce.querySelector("#npCorreo").value||"").trim(),indicativo:ce.querySelector("#npIndicativo").value,celular:_e,telefono:Ce,celularPaciente:_e,telefonoPaciente:Ce,fechaNacimiento:ce.querySelector("#npNacimiento").value,sexo:ce.querySelector("#npSexo").value,notas:(ce.querySelector("#npComentario").value||"").trim(),creado:new Date().toISOString(),activo:!0,citas:[]},{merge:!0})}vn=_e,Sr=Ce}else if(Be)ut=Be.id,yn=Be.nombre,dn=Re(Q,"pacientes",ut),vn=Be.celular||"",Sr=Be.telefono||"";else{if(!re){alert(" Por favor, escribe o selecciona un paciente.");return}const j=Le(se(Q,"pacientes"),Xe("documento","==",re)),G=Le(se(Q,"pacientes"),Xe("nroDocumento","==",re)),[oe,_e]=await Promise.all([Se(j),Se(G)]),Ce=oe.empty?_e:oe;if(Ce.empty){let qe=null;try{const wt=Zo(re),zn=Le(se(Q,"pacientes"),gt("nombre_busqueda"),p0(wt),m0(wt+""),La(1)),Rn=await Se(zn);if(!Rn.empty){const Ct=Rn.docs[0],Pt=Ct.data()||{};qe={id:Ct.id,ref:Ct.ref,nombre:Pt.nombreCompleto||Pt.paciente||[Pt.nombres,Pt.apellidos].filter(Boolean).join(" "),cel:Pt.celularPaciente||Pt.celular||"",tel:Pt.telefonoPaciente||Pt.telefono||""}}}catch{}qe?(ut=qe.id,dn=qe.ref,yn=qe.nombre||re,vn=qe.cel||"",Sr=qe.tel||""):yn=re}else{const qe=Ce.docs[0],wt=qe.data()||{};ut=qe.id,dn=qe.ref,yn=wt.nombreCompleto||wt.paciente||[wt.nombres,wt.apellidos].filter(Boolean).join(" ")||re,vn=wt.celularPaciente||wt.celular||"",Sr=wt.telefonoPaciente||wt.telefono||""}}if(!(vn||Sr||"").trim()){alert(" Este paciente no tiene ningn telfono registrado. Edita sus datos y agrega un nmero antes de guardar la cita.");return}const us={paciente:yn||"Paciente",pacienteId:ut||null,doctorId:ue,doctor:Vt||"Doctor",consultorioId:$e||"",consultorioNombre:Qe||"",sucursalId:Fe||"",sucursal:Wt||"",espacio:Qe||"",fecha:Ae,horaInicio:Pe,comentario:rt,estado:"En espera",creado:new Date().toISOString(),celularPaciente:vn||"",telefonoPaciente:Sr||""},Fi=await zt(se(Q,"citas"),us);dn&&await Ro(dn,{citas:xF(Fi.id)},{merge:!0}),alert(" Cita registrada correctamente y vinculada al paciente."),W.remove()}catch(ut){console.error(" Error al guardar cita:",ut),alert(" Error al guardar la cita. Revisa la consola para ms detalles.")}})},Ge=W=>{var Y,X;const fe=document.createElement("div");Object.assign(fe.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const ye=document.createElement("div");Object.assign(ye.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"});const J=(Y=W.raw)!=null&&Y.fecha&&typeof W.raw.fecha=="string"?W.raw.fecha:nm(W.fecha),Z=((X=W.raw)==null?void 0:X.horaInicio)||W.fecha.toTimeString().slice(0,5);ye.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Editar Cita</h2>
      <form id="formEditarCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label>Paciente</label>
        <input type="text" id="editPaciente" value="${W.paciente||""}" />

        <label>Doctor asignado</label>
        <input type="text" id="editDoctor" value="${W.doctor||""}" />

        <div style="display:flex;gap:8px;">
          <div style="flex:1;">
            <label>Fecha</label>
            <input type="date" id="editFecha" value="${J}" />
          </div>
          <div style="flex:1;">
            <label>Hora</label>
            <input type="time" id="editHora" value="${Z}" />
          </div>
        </div>

        <label>Espacio fsico / Sala</label>
        <input type="text" id="editEspacio" value="${W.espacio||""}" />

        <label>Estado</label>
        <select id="editEstado" class="estado-select">
          <option value="En espera" ${W.estado==="En espera"?"selected":""}>En espera</option>
          <option value="En sala" ${W.estado==="En sala"?"selected":""}>En sala</option>
          <option value="Atendiendo" ${W.estado==="Atendiendo"?"selected":""}>Atendiendo</option>
          <option value="Finalizada" ${W.estado==="Finalizada"?"selected":""}>Finalizada</option>
          <option value="pendiente" ${W.estado==="pendiente"?"selected":""}>Pendiente</option>
          <option value="No asisti" ${W.estado==="No asisti"?"selected":""}>No asisti</option>
        </select>

        <label>Comentario</label>
        <textarea id="editComentario" rows="3">${W.comentario||""}</textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarEdit" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar cambios</button>
        </div>
      </form>
    `;const Ie=document.createElement("style");Ie.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      #formEditarCita input, #formEditarCita select, #formEditarCita textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      #formEditarCita input:focus, #formEditarCita select:focus, #formEditarCita textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
    `,document.head.appendChild(Ie),fe.appendChild(ye),document.body.appendChild(fe),ye.querySelector("#btnCancelarEdit").addEventListener("click",()=>fe.remove());const ge=ye.querySelector("#formEditarCita");ge.addEventListener("submit",async B=>{B.preventDefault();const pe=ge.querySelector("#editPaciente").value.trim(),Ve=ge.querySelector("#editDoctor").value.trim(),Be=ge.querySelector("#editFecha").value,Me=ge.querySelector("#editHora").value,Ke=ge.querySelector("#editEspacio").value.trim(),xe=ge.querySelector("#editEstado").value,lt=ge.querySelector("#editComentario").value.trim();if(!pe)return alert(" El nombre del paciente es obligatorio.");if(!Be||!Me)return alert(" Debes indicar fecha y hora.");try{const Ze=Re(Q,"citas",W.id);await $t(Ze,{paciente:pe,doctor:Ve,fecha:Be,horaInicio:Me,espacio:Ke,estado:xe,comentario:lt}),alert(" Cita actualizada correctamente."),fe.remove()}catch(Ze){console.error(" Error al actualizar cita:",Ze),alert(" Error al actualizar la cita. Revisa la consola para ms detalles.")}})},_t=W=>{const fe=W.fecha.toLocaleDateString(er),ye=W.fecha.toLocaleTimeString(er,{hour:"numeric",minute:"2-digit",hour12:!0}),J=`${fe}  ${ye}`;return o.jsxs("tr",{className:"fade-in-row",onClick:()=>Ge(W),style:{cursor:"pointer"},children:[o.jsx("td",{children:J}),o.jsx("td",{children:W.paciente}),o.jsx("td",{children:W.doctor}),o.jsx("td",{children:W.espacio}),o.jsx("td",{children:W.comentario}),o.jsx("td",{onClick:Z=>{Z.stopPropagation()},children:o.jsxs("select",{className:"estado-select",value:W.estado,onChange:Z=>He(W.id,Z.target.value),children:[o.jsx("option",{value:"En espera",children:"En espera"}),o.jsx("option",{value:"En sala",children:"En sala"}),o.jsx("option",{value:"Atendiendo",children:"Atendiendo"}),o.jsx("option",{value:"Finalizada",children:"Finalizada"}),o.jsx("option",{value:"pendiente",children:"Pendiente"}),o.jsx("option",{value:"No asisti",children:"No asisti"})]})}),o.jsxs("td",{className:"acciones-cell",onClick:Z=>{Z.stopPropagation()},children:[W.telefono?o.jsx("button",{type:"button",className:"btn-whatsapp",onClick:Z=>{Z.stopPropagation(),st(W.telefono,W)},children:"WhatsApp"}):o.jsx("span",{className:"acciones-texto",children:"Sin celular"}),o.jsx("button",{type:"button",className:"btn-delete",onClick:Z=>{Z.stopPropagation(),De(W)},children:"Eliminar"}),W.recordatorio&&o.jsx("span",{className:"acciones-texto",children:W.recordatorio})]})]},W.id)};return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"odc-topbar-green"}),o.jsx("div",{className:"odc-topbar-blue",children:"Agenda"}),o.jsx("section",{className:"odc-agenda-root",children:o.jsxs("div",{className:"odc-agenda-inner",children:[o.jsxs("aside",{className:"odc-left","aria-label":"Panel izquierdo - calendario y filtros",children:[o.jsxs("div",{className:"odc-mini-calendar-card",role:"region","aria-label":"Mini calendario",children:[o.jsxs("div",{className:"mini-cal-header",children:[o.jsx("button",{className:"cal-arrow",id:"miniCalPrev","aria-label":"Mes anterior",onClick:O,children:""}),o.jsx("div",{id:"miniCalMonthYear","aria-live":"polite",children:z}),o.jsx("button",{className:"cal-arrow",id:"miniCalNext","aria-label":"Mes siguiente",onClick:k,children:""})]}),o.jsxs("table",{className:"mini-month-table","aria-hidden":"false",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Lu"}),o.jsx("th",{children:"Ma"}),o.jsx("th",{children:"Mi"}),o.jsx("th",{children:"Ju"}),o.jsx("th",{children:"Vi"}),o.jsx("th",{children:"Sa"}),o.jsx("th",{children:"Do"})]})}),o.jsx("tbody",{id:"miniCalendar",children:R.map((W,fe)=>o.jsx("tr",{children:W.map((ye,J)=>o.jsx("td",{className:[ye.isCurrentMonth?"":"empty",ye.isToday?"today":"",ye.isSelected?"selected":""].filter(Boolean).join(" "),onClick:()=>ye.isCurrentMonth&&M(ye.date),children:ye.date.getDate()},J))},fe))})]})]}),o.jsxs("div",{className:"odc-filters-card","aria-label":"Filtros de agenda",children:[o.jsx("label",{htmlFor:"filterSucursal",children:"Sucursal"}),o.jsxs("select",{id:"filterSucursal",value:h,onChange:W=>p(W.target.value),children:[o.jsx("option",{value:"",children:" Todas "}),g.map(W=>o.jsx("option",{value:W,children:W},W))]}),o.jsx("label",{htmlFor:"filterDoctor",children:"Doctores"}),o.jsxs("select",{id:"filterDoctor",value:x,onChange:W=>T(W.target.value),children:[o.jsx("option",{value:"",children:" Todos "}),v.map(W=>o.jsx("option",{value:W,children:W},W))]})]})]}),o.jsxs("main",{className:"odc-right","aria-label":"Panel principal - agenda",children:[o.jsxs("div",{className:"odc-header-bar",role:"region","aria-label":"Controles de la agenda",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[o.jsxs("div",{className:"odc-header-left",style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[o.jsx("h3",{className:"odc-title",style:{marginRight:8},children:"Agenda"}),o.jsxs("div",{className:"view-buttons",role:"tablist","aria-label":"Vistas",style:{display:"flex",gap:6},children:[o.jsx("button",{className:`btn view ${e==="day"?"active":""}`,"data-view":"day",role:"tab","aria-selected":e==="day",onClick:()=>n("day"),children:"Da"}),o.jsx("button",{className:`btn view ${e==="week"?"active":""}`,"data-view":"week",role:"tab","aria-selected":e==="week",onClick:()=>n("week"),children:"Semana"}),o.jsx("button",{className:`btn view ${e==="detail"?"active":""}`,"data-view":"detail",role:"tab","aria-selected":e==="detail",onClick:()=>n("detail"),children:"Detalle"})]}),o.jsxs("div",{className:"date-nav",style:{display:"flex",alignItems:"center",gap:6,flex:"0 0 auto"},children:[o.jsx("button",{className:"btn icon",id:"btnPrev","aria-label":"Anterior",onClick:we,children:""}),o.jsx("button",{className:"btn icon",id:"btnNext","aria-label":"Siguiente",onClick:ee,children:""}),o.jsx("span",{id:"currentDateDisplay",className:"current-date","aria-live":"polite",style:{whiteSpace:"nowrap"},children:ve}),o.jsx("button",{id:"btnHoy",className:"btn small",onClick:te,children:"Hoy"})]})]}),o.jsx("div",{className:"odc-header-right",style:{display:"flex",alignItems:"center",gap:8,flexShrink:0},children:o.jsxs("div",{className:"right-actions",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{id:"searchCitas",placeholder:"Buscar...",className:"search-input","aria-label":"Buscar citas",value:C,onChange:W=>N(W.target.value)}),o.jsx("button",{id:"btnNuevaCita",className:"btn green","aria-label":"Nueva cita",onClick:We,children:"+ Nueva cita"})]})})]}),o.jsxs("div",{className:"odc-content-card",role:"region","aria-label":"Contenido agenda",children:[o.jsxs("div",{className:"tools-row",children:[o.jsx("div",{className:"tools-left",children:o.jsx("div",{id:"ocupacionInfo",className:"ocupacion-info",children:P})}),o.jsxs("div",{className:"tools-right",children:[o.jsx("button",{id:"btnPrint",className:"btn",title:"Imprimir agenda",onClick:ne,children:" Imprimir"}),o.jsx("button",{id:"btnConfirmar",className:"btn blue",title:"Confirmar citas",onClick:me,children:" Confirmar"}),o.jsx("button",{id:"btnHoyCitas",className:"btn",title:"Ver citas de hoy",onClick:Ne,children:" Hoy"}),o.jsx("button",{id:"btnExportar",className:"btn",title:"Exportar citas a CSV",onClick:ke,children:" Exportar"})]})]}),o.jsx("div",{className:"table-wrap",role:"region","aria-label":"Lista de citas",children:o.jsxs("table",{className:"appointments-table","aria-live":"polite",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:"180px"},children:"Fecha / Hora"}),o.jsx("th",{children:"Paciente"}),o.jsx("th",{children:"Doctor"}),o.jsx("th",{children:"Espacio fsico"}),o.jsx("th",{children:"Comentario"}),o.jsx("th",{style:{width:"120px"},children:"Estado"}),o.jsx("th",{children:"Acciones"})]})}),o.jsx("tbody",{id:"citasTbody",children:l?o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"no-data",children:"Cargando citas..."})}):b.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"no-data",children:"No hay citas registradas para este rango."})}):b.map(_t)})]})})]})]})]})})]})}function hU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function fU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function pU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}const ld={caja:"caja",pagos:"facturacion/pagos",facturas:"facturacion/facturas"};var tE;const nc=typeof navigator<"u"&&((tE=navigator.language)!=null&&tE.startsWith("es"))?"es-ES":"en-US",mU=["Colombia","Argentina","Bolivia","Chile","Costa Rica","Cuba","Ecuador","El Salvador","Espaa","Guatemala","Honduras","Mxico","Nicaragua","Panam","Paraguay","Per","Puerto Rico","Repblica Dominicana","Uruguay","Venezuela","Estados Unidos","Canad"],rm={Colombia:["Bogot","Medelln","Cali","Barranquilla","Cartagena","Ccuta","Bucaramanga","Pereira","Santa Marta","Ibagu"],Mxico:["Ciudad de Mxico","Guadalajara","Monterrey","Puebla","Quertaro","Tijuana","Mrida","Len"],Per:["Lima","Arequipa","Trujillo","Chiclayo","Cusco","Piura"],Chile:["Santiago","Valparaso","Concepcin","La Serena","Antofagasta"],Argentina:["Buenos Aires","Crdoba","Rosario","Mendoza","La Plata"],Espaa:["Madrid","Barcelona","Valencia","Sevilla","Zaragoza","Bilbao"],"Estados Unidos":["Miami","New York","Los ngeles","Houston","Chicago"],Ecuador:["Quito","Guayaquil","Cuenca","Manta"],Venezuela:["Caracas","Maracaibo","Valencia","Barquisimeto","Maracay"]},gU=t=>{if(!t)return"";const[e,n,r]=t.split("-").map(c=>parseInt(c,10)),s=new Date(e,(n||1)-1,r||1),i=new Date;let a=i.getFullYear()-s.getFullYear();const l=i.getMonth()-s.getMonth();return(l<0||l===0&&i.getDate()<s.getDate())&&a--,isNaN(a)?"":String(a)};async function z0(t,{maxW:e=900,maxH:n=900,quality:r=.82}={}){var p;if(!t||!((p=t.type)!=null&&p.startsWith("image/")))return t;const s=await new Promise((x,T)=>{const C=new Image;C.onload=()=>x(C),C.onerror=T,C.src=URL.createObjectURL(t)});let{width:i,height:a}=s;const l=Math.min(e/i,n/a,1);i=Math.round(i*l),a=Math.round(a*l);const c=document.createElement("canvas");c.width=i,c.height=a,c.getContext("2d").drawImage(s,0,0,i,a);const f=await new Promise(x=>c.toBlob(x,"image/jpeg",r)),h=new File([f],(t.name||"foto.jpg").replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return URL.revokeObjectURL(s.src),h}const rc=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),yU=t=>rc([t.nombres,t.apellidos,t.nombreCompleto,t.nroDocumento,t.celular,t.email].filter(Boolean).join(" ")),vU=t=>{if(!t)return"";const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${n}-${r}-${s}T${i}:${a}`},_U=t=>{try{return new Date(t).toLocaleString(nc,{dateStyle:"medium",timeStyle:"short"})}catch{return""}},ea={tipoDocumento:"",nroDocumento:"",nroHistoria:"",nombres:"",apellidos:"",nombreCompleto:"",sexo:"",estadoCivil:"",paisNacimiento:"",ciudadNacimiento:"",fechaIngreso:"",fechaNacimiento:"",edad:"",paisDomicilio:"",ciudadDomicilio:"",barrio:"",lugarResidencia:"",estrato:"",zonaResidencial:"",esExtranjero:!1,permitePublicidad:!1,celular:"",telDomicilio:"",telOficina:"",extension:"",email:"",ocupacion:"",nombreResponsable:"",parentesco:"",celularResponsable:"",telefonoResponsable:"",emailResponsable:"",nombreAcompanante:"",telefonoAcompanante:"",convenioBeneficio:"",comoConocio:"",campania:"",remitidoPor:"",asesorComercial:"",tipoVinculacion:"",nombreEps:"",polizaSalud:"",doctor:"",notas:"",rxImagenes:[],historiaClinica:{antecedentes:"",alergias:"",medicamentos:"",motivoConsulta:"",notas:""},odontograma:[],periodontograma:[],presupuestos:[],evoluciones:[],facturacion:{saldoFavor:0,saldoCredito:0},fotoUrl:"",activo:!0},sm=20,ta=t=>Number(t||0);function xU(t){const[e,n]=w.useState(!1),[r,s]=w.useState([]),[i,a]=w.useState([]),[l,c]=w.useState("");w.useEffect(()=>{let N=!0;return(async()=>{if(!t){s([]),a([]);return}n(!0),c("");try{let E=Le(se(Q,"facturas"),Xe("patientId","==",t),gt("fechaISO","desc"));const L=(await Se(E)).docs.map(P=>({id:P.id,...P.data()})).map(P=>({...P,total:ta(P.total??P.valor??P.montoTotal),estado:(P.estado||"pendiente").toLowerCase(),fechaISO:P.fechaISO||P.fecha||null}));let V=Le(se(Q,"pagos"),Xe("patientId","==",t),gt("fechaISO","desc"));const b=(await Se(V)).docs.map(P=>({id:P.id,...P.data()})).map(P=>({...P,monto:ta(P.monto??P.valor??P.total),fechaISO:P.fechaISO||P.fecha||null,medio:P.medio||P.metodo||""}));if(!N)return;s(L),a(b)}catch(E){console.warn("Finanzas: no se pudo leer colecciones. Contino solo con saldos del paciente.",E),N&&c("No se pudieron leer facturas/pagos.")}finally{N&&n(!1)}})(),()=>{N=!1}},[t]);const d=r.reduce((N,_)=>N+ta(_.total),0),f=i.reduce((N,_)=>N+ta(_.monto),0),h=r.filter(N=>["pagada","pagado","paid"].includes((N.estado||"").toLowerCase())),p=r.filter(N=>["pendiente","abierta","open","deuda"].includes((N.estado||"").toLowerCase())),x=h.reduce((N,_)=>N+ta(_.total),0),T=p.reduce((N,_)=>N+ta(_.total),0);return{loading:e,error:l,facturas:r,pagos:i,totalFacturado:d,totalPagado:f,totalFacturasPendientes:T,totalFacturasPagadas:x}}function bU(t){const[e,n]=w.useState(!1),[r,s]=w.useState([]);return w.useEffect(()=>{if(!t){s([]);return}n(!0);const i=se(Q,"citas"),a=x=>{const T=x.data()||{},C=typeof T.fecha=="string"?T.fecha:"",N=(T.horaInicio||T.hora||"00:00").slice(0,5);let _=null;if(C){const[E,S,I]=C.split("-").map(v=>parseInt(v,10)),[L,V]=N.split(":").map(v=>parseInt(v,10)||0);_=new Date(E,(S||1)-1,I||1,L,V,0,0).toISOString()}return{id:x.id,...T,fechaISO:_,motivo:T.motivo||T.comentario||"",profesional:T.doctor||T.doctorNombre||"",fechaYYYYMMDD:C}};let l=new Map;const c=()=>{const x=Array.from(l.values());x.sort((T,C)=>{const N=T.fechaISO||"",_=C.fechaISO||"";if(N<_)return 1;if(N>_)return-1;const E=T.creado||"",S=C.creado||"";return E<S?1:E>S?-1:0}),s(x),n(!1)},d=Le(i,Xe("pacienteId","==",t)),f=Le(i,Xe("patientId","==",t)),h=cn(d,x=>{x.docChanges().forEach(T=>{T.type==="removed"?l.delete(T.doc.id):l.set(T.doc.id,a(T.doc))}),c()},()=>n(!1)),p=cn(f,x=>{x.docChanges().forEach(T=>{T.type==="removed"?l.delete(T.doc.id):l.set(T.doc.id,a(T.doc))}),c()},()=>n(!1));return()=>{try{h()}catch{}try{p()}catch{}}},[t]),{loading:e,citas:r}}function wU(){var Wt,ut,dn,yn,vn,Sr,yl,us,Fi;const t=cs(),e=Bn(),n=qh.useMemo(()=>{const j=e.pathname.split("/").filter(Boolean),G=j.findIndex(Ce=>["pacientes","agenda","caja","facturacion","config","reportes","software"].includes(Ce)),_e="/"+j.slice(0,G>=0?G:j.length).join("/");return _e==="/"?"":_e},[e.pathname]),r=j=>{const G=String(j||"").replace(/^\//,""),oe=n?`${n}/`:"/";t(`${oe}${G}`)},s=(j,G)=>{const oe=String(j).replace(/^\//,""),_e=G?new URLSearchParams(G).toString():"";return`${n?`${n}/`:"/"}${oe}${_e?`?${_e}`:""}`},i=(j,G)=>{const oe=String(j||"").slice(0,10);if(!oe)return r("agenda");try{sessionStorage.setItem("agenda.targetDate",oe)}catch{}const _e=new URLSearchParams({date:oe,day:oe,d:oe,fecha:oe,selectedDate:oe,ts:String(new Date(oe+"T00:00:00").getTime()),patientId:G||""}).toString();r(`agenda?${_e}`)},[a,l]=w.useState(!0),[c,d]=w.useState([]),[f,h]=w.useState(""),[p,x]=w.useState(null),[T,C]=w.useState(!0),[N,_]=w.useState(!1),[E,S]=w.useState(null),[I,L]=w.useState(null),V=w.useRef(null),[g,v]=w.useState("datos"),[b,P]=w.useState(ea),[R,O]=w.useState(null),[k,M]=w.useState(""),[z,ve]=w.useState([]),[we,ee]=w.useState(!1),te=w.useRef(null),ne="comfy",[me,Ne]=w.useState(""),ke=w.useMemo(()=>{switch(ne){case"comfy":return{thumbW:220,thumbH:165,colMin:240};case"cozy":return{thumbW:160,thumbH:120,colMin:180};default:return{thumbW:120,thumbH:90,colMin:140}}},[ne]),He=j=>{var oe,_e;if((_e=(oe=j==null?void 0:j.type)==null?void 0:oe.startsWith)!=null&&_e.call(oe,"image/"))return!0;const G=((j==null?void 0:j.name)||(j==null?void 0:j.title)||"").toLowerCase();return/\.(png|jpe?g|gif|bmp|webp|tiff?)$/.test(G)},st=w.useMemo(()=>{const j=me.trim().toLowerCase(),G=Array.isArray(I==null?void 0:I.rxImagenes)?I.rxImagenes:[];let oe=G;return j?oe=G.filter(_e=>`${_e.name||""} ${_e.title||""} ${_e.desc||""}`.toLowerCase().includes(j)):oe=G.slice(),oe.sort((_e,Ce)=>{const qe=_e.uploadedAtMS??_e.created??0;return(Ce.uploadedAtMS??Ce.created??0)-qe}),oe},[I==null?void 0:I.rxImagenes,me]),De=async(j,G)=>{if(!(I!=null&&I.id))return;const oe=Array.isArray(I.rxImagenes)?[...I.rxImagenes]:[];oe[j]={...oe[j]||{},...G},await D({rxImagenes:oe})},We=()=>{const j=new Date,G=j.getFullYear(),oe=String(j.getMonth()+1).padStart(2,"0"),_e=String(j.getDate()).padStart(2,"0");return`${G}-${oe}-${_e}`},[Ge,_t]=w.useState(We()),[W,fe]=w.useState(""),[ye,J]=w.useState(""),[Z,Ie]=w.useState(""),[ge,Y]=w.useState("");w.useEffect(()=>{J((I==null?void 0:I.doctor)||"")},[I==null?void 0:I.doctor,I==null?void 0:I.id]);const X=async()=>{if(!(I!=null&&I.id))return alert("Paciente no cargado.");if(!Ge)return alert("Selecciona la fecha.");if(!W)return alert("Selecciona la hora.");if(!ye.trim())return alert("Indica el doctor.");const j=I.nombreCompleto||I.paciente||"Paciente",G=I.celular||I.celularPaciente||"",oe=I.telDomicilio||I.telefonoPaciente||"";if(!G&&!oe)return alert("Este paciente no tiene telfono registrado (celular o fijo). Agrega uno antes de crear la cita.");try{const _e={paciente:j,pacienteId:I.id,doctor:ye.trim(),fecha:Ge,horaInicio:W,espacio:Z||"",comentario:ge||"",estado:"En espera",creado:new Date().toISOString(),celularPaciente:G,telefonoPaciente:oe};await zt(se(Q,"citas"),_e),fe(""),Ie(""),Y(""),alert(" Cita creada. Ya aparece en la lista y en Agenda.")}catch(_e){console.error("Error creando cita:",_e),alert("No se pudo crear la cita.")}};w.useMemo(()=>rm[b.paisNacimiento]||[],[b.paisNacimiento]),w.useEffect(()=>((async()=>{l(!0);try{const oe=(await Se(se(Q,"eps"))).docs.map(Ce=>{var qe;return(qe=Ce.data())==null?void 0:qe.nombre}).filter(Boolean),_e=Array.from(new Map(oe.map(Ce=>[String(Ce).toLowerCase(),Ce])).values()).sort((Ce,qe)=>Ce.localeCompare(qe,"es"));ve(_e),await Be(!0)}catch(G){console.error(G),alert("No se pudieron cargar pacientes/EPS.")}finally{l(!1)}})(),()=>{V.current&&(V.current(),V.current=null)}),[]),w.useEffect(()=>{P(j=>({...j,nombreCompleto:`${j.nombres} ${j.apellidos}`.trim()}))},[b.nombres,b.apellidos]),w.useEffect(()=>{P(j=>({...j,nroHistoria:j.nroDocumento}))},[b.nroDocumento]),w.useEffect(()=>{P(j=>({...j,edad:gU(j.fechaNacimiento)}))},[b.fechaNacimiento]),w.useEffect(()=>{const j=new Date,G=j.toLocaleDateString(nc)+" - "+j.toLocaleTimeString(nc,{hour:"2-digit",minute:"2-digit",hour12:!0});P(oe=>({...oe,fechaIngreso:G}))},[]);const B=(j,G)=>P(oe=>({...oe,[j]:G})),pe=()=>{P(ea);const j=new Date,G=j.toLocaleDateString(nc)+" - "+j.toLocaleTimeString(nc,{hour:"2-digit",minute:"2-digit",hour12:!0});P(oe=>({...oe,fechaIngreso:G})),O(null),M(""),S(null)},Ve=async j=>{if(!j){O(null),M("");return}try{const G=await z0(j,{maxW:900,maxH:900,quality:.82});O(G);const oe=new FileReader;oe.onload=_e=>M(_e.target.result),oe.readAsDataURL(G)}catch{O(j);const G=new FileReader;G.onload=oe=>M(oe.target.result),G.readAsDataURL(j)}},Be=async(j=!1)=>{l(!0);try{let G;j||!p?G=Le(se(Q,"pacientes"),gt("creado","desc"),La(sm)):G=Le(se(Q,"pacientes"),gt("creado","desc"),pF(p),La(sm));const oe=await Se(G),_e=oe.docs.map(Ce=>({id:Ce.id,...Ce.data()}));d(j?_e:Ce=>[...Ce,..._e]),x(oe.docs[oe.docs.length-1]||null),C(oe.size===sm)}catch(G){console.error(G),alert("No se pudo cargar pacientes.")}finally{l(!1)}},Me=async j=>{if(j.preventDefault(),!b.nroDocumento.trim())return alert("El nmero de documento es obligatorio.");if(!b.nombres.trim())return alert("Los nombres son obligatorios.");if(!b.apellidos.trim())return alert("Los apellidos son obligatorios.");if(!b.sexo.trim())return alert("El sexo es obligatorio.");if(!b.fechaNacimiento.trim())return alert("La fecha de nacimiento es obligatoria.");if(!b.celular.trim())return alert("El celular es obligatorio.");if(!b.email.trim())return alert("El correo electrnico es obligatorio.");if(!b.tipoVinculacion.trim())return alert("El tipo de vinculacin es obligatorio.");if(!b.nombreEps.trim())return alert("El nombre de la EPS es obligatorio.");try{const G=b.nroDocumento.trim();if(!E&&(await Po(Re(Q,"pacientes",G))).exists())return alert("Ya existe un paciente con ese nmero de documento.");const oe=(b.nombreEps||"").trim(),_e=z.map(Ct=>Ct.toLowerCase()).includes(oe.toLowerCase());if(oe&&!_e&&window.confirm(`La EPS "${oe}" no existe. Deseas guardarla para futuras selecciones?`)){const Pt=oe.toLowerCase().replace(/\s+/g,"_");await Ro(Re(Q,"eps",Pt),{nombre:oe,nombreLower:oe.toLowerCase(),creado:kt()},{merge:!0})}let Ce=b.fotoUrl||"",qe="";if(R)try{const Ct=eo(),Pt=(R.name||"foto.jpg").replace(/\s+/g,"_");qe=`pacientes/${G}/${Date.now()}_${Pt}`;const qn=Bl(Ct,qe),Cr={contentType:R.type||"image/jpeg",cacheControl:"public, max-age=86400"};await S0(qn,R,Cr),Ce=await T0(qn)}catch(Ct){console.error("Foto (warning):",Ct)}const wt=b.creado||null,zn=E&&wt||kt(),Rn={...b,fotoUrl:Ce,nombre_busqueda:yU({...b,fotoUrl:Ce}),nombresLower:rc(b.nombres),apellidosLower:rc(b.apellidos),documentoLower:rc(b.nroDocumento),emailLower:rc(b.email),creado:zn,createdAt:zn,actualizado:kt(),updatedAt:kt(),activo:b.activo??!0,celularPaciente:b.celular,telefonoPaciente:b.telDomicilio||"",documento:b.nroDocumento,paciente:b.nombreCompleto};if(await Ro(Re(Q,"pacientes",G),Rn,{merge:!0}),qe)try{const Ct=eo(),Pt=Bl(Ct,`pacientes/${G}`),qn=await C0(Pt),Cr=qe,ds=qn.items.filter(hs=>hs.fullPath!==Cr).map(hs=>Yp(hs).catch(()=>null));await Promise.allSettled(ds)}catch(Ct){console.warn("No se pudo limpiar fotos antiguas:",Ct)}alert(E?" Paciente actualizado.":" Paciente guardado."),d(Ct=>{const Pt=Ct.filter(qn=>qn.id!==G);return[{id:G,...Rn},...Pt]}),_(!1),S(null),pe()}catch(G){console.error("Error guardando paciente:",G),alert(`No se pudo guardar el paciente.

`+((G==null?void 0:G.message)||G))}},Ke=()=>{pe(),_(!0)},xe=()=>{I&&(P({...ea,...I,fotoUrl:I.fotoUrl||""}),O(null),M(I.fotoUrl||""),S(I.id),q(),_(!0))},lt=async j=>{if(window.confirm(`Eliminar al paciente "${j.nombreCompleto}"?`))try{await An(Re(Q,"pacientes",j.id)),d(G=>G.filter(oe=>oe.id!==j.id));try{const G=eo(),oe=Bl(G,`pacientes/${j.id}`),Ce=(await C0(oe)).items.map(qe=>Yp(qe).catch(()=>null));await Promise.allSettled(Ce)}catch(G){console.warn("No se pudo borrar la carpeta de fotos:",G)}}catch(G){console.error(G),alert("No se pudo eliminar.")}},Ze=w.useMemo(()=>{const j=f.trim().toLowerCase();return j?c.filter(G=>`${G.nombreCompleto||G.paciente||""} ${G.nroDocumento||""} ${G.celular||G.celularPaciente||""} ${G.email||""}`.toLowerCase().includes(j)):c},[c,f]),bt=j=>{q();const G=Re(Q,"pacientes",j.id),oe=cn(G,_e=>{_e.exists()?L({id:_e.id,...ce(_e.data())}):L(null)});V.current=oe,v("datos")},q=()=>{V.current&&(V.current(),V.current=null),L(null)},ce=j=>({...ea,...j,historiaClinica:{...ea.historiaClinica,...j.historiaClinica||{}},facturacion:{...ea.facturacion,...j.facturacion||{}},rxImagenes:Array.isArray(j.rxImagenes)?j.rxImagenes:[],odontograma:Array.isArray(j.odontograma)?j.odontograma:[],periodontograma:Array.isArray(j.periodontograma)?j.periodontograma:[],presupuestos:Array.isArray(j.presupuestos)?j.presupuestos:[],evoluciones:Array.isArray(j.evoluciones)?j.evoluciones:[]}),D=async j=>{if(I!=null&&I.id)try{await $t(Re(Q,"pacientes",I.id),{...j,actualizado:kt(),updatedAt:kt()})}catch(G){console.error(G),alert("No se pudo actualizar.")}},F=async j=>{var oe;if(!(I!=null&&I.id)||!(j!=null&&j.length))return;const G=eo();try{ee(!0);const _e=[];for(const Ce of j){let qe=Ce;if((oe=Ce.type)!=null&&oe.startsWith("image/"))try{qe=await z0(Ce,{maxW:1600,maxH:1600,quality:.85})}catch{qe=Ce}const wt=(qe.name||"archivo").replace(/\s+/g,"_"),zn=`pacientes/${I.id}/rx/${Date.now()}_${wt}`,Rn=Bl(G,zn),Ct={contentType:qe.type||"application/octet-stream",cacheControl:"public, max-age=31536000"};await S0(Rn,qe,Ct);const Pt=await T0(Rn),qn=new Date().toISOString(),Cr=Date.now();_e.push({url:Pt,name:Ce.name,title:Ce.name.replace(/\.[^.]+$/,""),desc:"",type:Ce.type,size:Ce.size||0,created:Cr,uploadedAtMS:Cr,uploadedAtISO:qn,path:zn})}await D({rxImagenes:[...I.rxImagenes||[],..._e]})}catch(_e){console.error("RX upload error:",_e);const Ce=`No se pudo subir el/los archivo(s).
 Verifica que el usuario est autenticado.
 Revisa reglas de Storage para permitir escribir en 'pacientes/{id}/**'.
 Si usas Emulador, confirma que el bucket coincida.

`+((_e==null?void 0:_e.message)||"");alert(Ce)}finally{ee(!1);try{te.current&&(te.current.value="")}catch{}}},re=async j=>{if(!(I!=null&&I.id))return;const G=I.rxImagenes[j],oe=I.rxImagenes.filter((_e,Ce)=>Ce!==j);await D({rxImagenes:oe});try{if(G!=null&&G.path){const _e=eo();await Yp(Bl(_e,G.path))}}catch(_e){console.warn("No se pudo borrar del Storage:",_e)}},ue=(j,G)=>{const oe={...I.historiaClinica||{},[j]:G};D({historiaClinica:oe})},Ae=j=>{const G=[...I.presupuestos||[],{id:String(Date.now()),...j}];D({presupuestos:G})},Pe=j=>{D({presupuestos:(I.presupuestos||[]).filter(G=>G.id!==j)})},$e=j=>{const G=[...I.evoluciones||[],{id:String(Date.now()),fechaISO:new Date().toISOString(),nota:j}];D({evoluciones:G})},Fe=j=>{D({evoluciones:(I.evoluciones||[]).filter(G=>G.id!==j)})},rt=(j,G)=>{const oe=Array.isArray(I[j])?I[j]:[],_e=oe.find(qe=>qe.pieza===G);let Ce;_e?Ce=oe.filter(qe=>qe.pieza!==G):Ce=[...oe,{pieza:G,estado:"marcada"}],D({[j]:Ce})},dt=(I==null?void 0:I.id)||null,Vt=xU(dt),{loading:Qe,citas:Jn}=bU(dt);return o.jsxs("div",{className:"odc-container",children:[o.jsx("div",{className:"odc-topbar-green"}),o.jsx("div",{className:"odc-topbar-blue",children:o.jsx("div",{className:"odc-top-inner",children:o.jsx("div",{className:"odc-breadcrumbs",children:"Pacientes"})})}),o.jsxs("div",{className:"odc-card",children:[o.jsxs("div",{className:"odc-card-header",children:[o.jsx("h3",{className:"odc-title",children:"Pacientes"}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[o.jsx("input",{className:"search-input",style:{minWidth:280},placeholder:"Buscar por nombre, documento o telfono",value:f,onChange:j=>h(j.target.value)}),o.jsx("button",{type:"button",className:"btn green",onClick:Ke,children:"+ Nuevo paciente"})]})]}),o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Foto"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Documento"}),o.jsx("th",{children:"Celular"}),o.jsx("th",{children:"Correo"}),o.jsx("th",{children:"Estado"})]})}),o.jsx("tbody",{children:a&&c.length===0?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:6,children:"Cargando"})}):Ze.length===0?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:6,children:"No hay pacientes o no coinciden con la bsqueda."})}):Ze.map(j=>o.jsxs("tr",{className:"row-click",onClick:()=>bt(j),children:[o.jsx("td",{onClick:G=>G.stopPropagation(),children:j.fotoUrl?o.jsx("img",{src:j.fotoUrl,alt:"Foto",style:{width:36,height:36,borderRadius:"50%",objectFit:"cover"}}):o.jsx("div",{className:"avatar-fallback",children:(j.nombreCompleto||"P")[0]})}),o.jsx("td",{children:j.nombreCompleto||j.paciente||""}),o.jsx("td",{children:j.nroDocumento||j.documento||""}),o.jsx("td",{children:j.celular||j.celularPaciente||""}),o.jsx("td",{children:j.email||""}),o.jsx("td",{children:o.jsx("span",{className:"pill pill-ok",children:j.activo?"Activo":"Inactivo"})})]},j.id))})]})}),o.jsxs("div",{className:"footer-actions",children:[o.jsx("button",{type:"button",className:"btn",disabled:a||!T,onClick:()=>Be(!1),children:T?"Cargar ms":"No hay ms"}),o.jsxs("div",{className:"hint",children:[c.length," registros cargados"]})]})]}),N&&o.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[o.jsx("div",{className:"odc-modal-backdrop",onClick:()=>_(!1)}),o.jsxs("div",{className:"odc-card",style:{width:1e3,maxWidth:"95%",maxHeight:"92vh",overflowY:"auto"},children:[o.jsxs("div",{className:"odc-card-header",children:[o.jsx("h3",{className:"odc-title",children:E?"Editar paciente":"Nuevo paciente"}),o.jsx("button",{type:"button",className:"btn",onClick:()=>_(!1),children:""})]}),o.jsxs("form",{onSubmit:Me,children:[o.jsx("div",{className:"form-section-title",children:"Foto del paciente"}),o.jsxs("div",{className:"foto-row",children:[o.jsxs("label",{className:"foto-drop",children:[o.jsx("input",{type:"file",accept:"image/*",onChange:j=>{var G;return Ve(((G=j.target.files)==null?void 0:G[0])||null)},style:{display:"none"}}),k?o.jsx("img",{src:k,alt:"Preview",className:"foto-preview"}):o.jsx("div",{className:"foto-empty",children:"Arrastra o haz clic para cargar"})]}),k&&o.jsx("button",{type:"button",className:"btn",onClick:()=>Ve(null),children:"Quitar foto"})]}),o.jsx("div",{className:"form-section-title",children:"Datos de identificacin"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Tipo de documento *"}),o.jsxs("select",{className:"form-input",value:b.tipoDocumento,onChange:j=>B("tipoDocumento",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{value:"CC",children:"Cdula"}),o.jsx("option",{value:"TI",children:"Tarjeta de identidad"}),o.jsx("option",{value:"PA",children:"Pasaporte"}),o.jsx("option",{value:"OTRO",children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nro. de documento *"}),o.jsx("input",{className:"form-input",value:b.nroDocumento,onChange:j=>B("nroDocumento",j.target.value),placeholder:"Nmero de documento",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nmero de Historia"}),o.jsx("input",{className:"form-input",value:b.nroHistoria,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombres *"}),o.jsx("input",{className:"form-input",value:b.nombres,onChange:j=>B("nombres",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Apellidos *"}),o.jsx("input",{className:"form-input",value:b.apellidos,onChange:j=>B("apellidos",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombre completo"}),o.jsx("input",{className:"form-input",value:b.nombreCompleto,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Sexo *"}),o.jsxs("select",{className:"form-input",value:b.sexo,onChange:j=>B("sexo",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Masculino"}),o.jsx("option",{children:"Femenino"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Estado civil *"}),o.jsxs("select",{className:"form-input",value:b.estadoCivil,onChange:j=>B("estadoCivil",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Soltero"}),o.jsx("option",{children:"Casado"}),o.jsx("option",{children:"Unin libre"}),o.jsx("option",{children:"Divorciado"}),o.jsx("option",{children:"Viudo"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Pas de nacimiento *"}),o.jsx("input",{className:"form-input",list:"listCountries",value:b.paisNacimiento,onChange:j=>B("paisNacimiento",j.target.value),placeholder:"Escribe y elige",required:!0}),o.jsx("datalist",{id:"listCountries",children:mU.map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Ciudad de nacimiento"}),o.jsx("input",{className:"form-input",list:"listCitiesBirth",value:b.ciudadNacimiento,onChange:j=>B("ciudadNacimiento",j.target.value),placeholder:"Escribe y elige"}),o.jsx("datalist",{id:"listCitiesBirth",children:(rm[b.paisNacimiento]||[]).map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Fecha de ingreso"}),o.jsx("input",{className:"form-input",value:b.fechaIngreso,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Fecha de nacimiento *"}),o.jsx("input",{type:"date",className:"form-input",value:b.fechaNacimiento,onChange:j=>B("fechaNacimiento",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Edad"}),o.jsx("input",{className:"form-input",value:b.edad,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Pas de domicilio *"}),o.jsx("input",{className:"form-input",list:"listCountries",value:b.paisDomicilio,onChange:j=>B("paisDomicilio",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Ciudad de domicilio *"}),o.jsx("input",{className:"form-input",list:"listCitiesHome",value:b.ciudadDomicilio,onChange:j=>B("ciudadDomicilio",j.target.value),required:!0}),o.jsx("datalist",{id:"listCitiesHome",children:(rm[b.paisDomicilio]||[]).map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Barrio *"}),o.jsx("input",{className:"form-input",value:b.barrio,onChange:j=>B("barrio",j.target.value),required:!0,placeholder:"Barrio"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Lugar de residencia *"}),o.jsx("input",{className:"form-input",value:b.lugarResidencia,onChange:j=>B("lugarResidencia",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Estrato"}),o.jsxs("select",{className:"form-input",value:b.estrato,onChange:j=>B("estrato",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"1"}),o.jsx("option",{children:"2"}),o.jsx("option",{children:"3"}),o.jsx("option",{children:"4"}),o.jsx("option",{children:"5"}),o.jsx("option",{children:"6"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Zona residencial *"}),o.jsxs("select",{className:"form-input",value:b.zonaResidencial,onChange:j=>B("zonaResidencial",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Urbana"}),o.jsx("option",{children:"Rural"})]})]}),o.jsxs("div",{className:"checkbox-cell",children:[o.jsx("label",{className:"form-label",children:"Es extranjero?"}),o.jsx("input",{type:"checkbox",checked:b.esExtranjero,onChange:j=>B("esExtranjero",j.target.checked)})]}),o.jsxs("div",{className:"checkbox-cell",children:[o.jsx("label",{className:"form-label",children:"Permite publicidad?"}),o.jsx("input",{type:"checkbox",checked:b.permitePublicidad,onChange:j=>B("permitePublicidad",j.target.checked)})]})]}),o.jsx("div",{className:"form-section-title",children:"Contacto"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Celular *"}),o.jsx("input",{className:"form-input",value:b.celular,onChange:j=>B("celular",j.target.value),required:!0,placeholder:"Celular del paciente"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono de domicilio"}),o.jsx("input",{className:"form-input",value:b.telDomicilio,onChange:j=>B("telDomicilio",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono de oficina"}),o.jsx("input",{className:"form-input",value:b.telOficina,onChange:j=>B("telOficina",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Extensin"}),o.jsx("input",{className:"form-input",value:b.extension,onChange:j=>B("extension",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Correo electrnico *"}),o.jsx("input",{type:"email",className:"form-input",value:b.email,onChange:j=>B("email",j.target.value),required:!0,placeholder:"correo@dominio.com"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Ocupacin *"}),o.jsx("input",{className:"form-input",value:b.ocupacion,onChange:j=>B("ocupacion",j.target.value),required:!0})]})]}),o.jsx("div",{className:"form-section-title",children:"Datos de facturacin"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Responsable"}),o.jsx("input",{className:"form-input",value:b.nombreResponsable,onChange:j=>B("nombreResponsable",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Parentesco"}),o.jsxs("select",{className:"form-input",value:b.parentesco,onChange:j=>B("parentesco",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Padre/Madre"}),o.jsx("option",{children:"Hermano"}),o.jsx("option",{children:"Esposo/a"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Celular"}),o.jsx("input",{className:"form-input",value:b.celularResponsable,onChange:j=>B("celularResponsable",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono"}),o.jsx("input",{className:"form-input",value:b.telefonoResponsable,onChange:j=>B("telefonoResponsable",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Correo electrnico"}),o.jsx("input",{type:"email",className:"form-input",value:b.emailResponsable,onChange:j=>B("emailResponsable",j.target.value)})]})]}),o.jsx("div",{className:"form-section-title",children:"Acompaante"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombre"}),o.jsx("input",{className:"form-input",value:b.nombreAcompanante,onChange:j=>B("nombreAcompanante",j.target.value),placeholder:"Nombre acompaante"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono"}),o.jsx("input",{className:"form-input",value:b.telefonoAcompanante,onChange:j=>B("telefonoAcompanante",j.target.value),placeholder:"Telfono acompaante"})]})]}),o.jsx("div",{className:"form-section-title",children:"Mercadeo"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Convenio beneficio"}),o.jsx("input",{className:"form-input",value:b.convenioBeneficio,onChange:j=>B("convenioBeneficio",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Cmo nos conoci?"}),o.jsxs("select",{className:"form-input",value:b.comoConocio,onChange:j=>B("comoConocio",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Redes sociales"}),o.jsx("option",{children:"Publicidad"}),o.jsx("option",{children:"Recomendacin"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Campaa"}),o.jsx("input",{className:"form-input",value:b.campania,onChange:j=>B("campania",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Remitido por"}),o.jsx("input",{className:"form-input",value:b.remitidoPor,onChange:j=>B("remitidoPor",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Asesor comercial"}),o.jsx("input",{className:"form-input",value:b.asesorComercial,onChange:j=>B("asesorComercial",j.target.value)})]})]}),o.jsx("div",{className:"form-section-title",children:"EPS"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Tipo de vinculacin *"}),o.jsxs("select",{className:"form-input",value:b.tipoVinculacion,onChange:j=>B("tipoVinculacion",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Contributivo"}),o.jsx("option",{children:"Subsidiado"}),o.jsx("option",{children:"Particular"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombre de la EPS *"}),o.jsx("input",{className:"form-input",list:"listEps",value:b.nombreEps,onChange:j=>B("nombreEps",j.target.value),placeholder:"Escribe y selecciona",required:!0}),o.jsx("datalist",{id:"listEps",children:z.map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Pliza de salud"}),o.jsx("input",{className:"form-input",value:b.polizaSalud,onChange:j=>B("polizaSalud",j.target.value)})]})]}),o.jsx("div",{className:"form-section-title",children:"Doctor"}),o.jsx("div",{className:"form-grid",children:o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Doctor"}),o.jsx("input",{className:"form-input",value:b.doctor,onChange:j=>B("doctor",j.target.value),placeholder:"Usuario / Libre"})]})}),o.jsx("div",{className:"form-section-title",children:"Alertas y Notas"}),o.jsx("div",{className:"form-grid",children:o.jsx("textarea",{className:"form-input",rows:3,value:b.notas,onChange:j=>B("notas",j.target.value),placeholder:"Notas del paciente"})}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,marginTop:12},children:[E?o.jsx("button",{type:"button",className:"btn",onClick:()=>lt({id:E,nombreCompleto:b.nombreCompleto}),children:"Eliminar"}):o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{type:"button",className:"btn",onClick:()=>_(!1),children:"Cancelar"}),o.jsx("button",{type:"submit",className:"btn blue",children:E?"Actualizar":"Guardar paciente"})]})]})]})]})]}),I&&o.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[o.jsx("div",{className:"odc-modal-backdrop",onClick:q}),o.jsxs("div",{className:"odc-card ficha-card",children:[o.jsxs("div",{className:"ficha-header",children:[o.jsxs("div",{className:"ficha-header-left",children:[I.fotoUrl?o.jsx("img",{src:I.fotoUrl,alt:"Foto",className:"ficha-avatar"}):o.jsx("div",{className:"avatar-fallback ficha-avatar-fallback",children:(I.nombreCompleto||"P")[0]}),o.jsxs("div",{children:[o.jsx("div",{className:"ficha-nombre",children:I.nombreCompleto||""}),o.jsxs("div",{className:"ficha-doc",children:[I.tipoDocumento||""," ",I.nroDocumento||""]}),o.jsxs("div",{className:"ficha-badges",children:[o.jsx("span",{className:"ficha-badge blue",children:"En valoracin"}),o.jsx("span",{className:"ficha-badge green",children:"Sin deuda"})]})]})]}),o.jsx("div",{className:"ficha-header-right",children:o.jsxs("div",{className:"ficha-actions",children:[o.jsx("button",{type:"button",className:"btn",onClick:q,children:"Cerrar"}),o.jsx("button",{type:"button",className:"btn blue",onClick:xe,children:"Editar"}),o.jsx("button",{type:"button",className:"btn green",onClick:()=>t(s(ld.caja,{cobro:1,patientId:I.id})),title:"Ir a Caja para cobrar a este paciente",children:"Cobrar"})]})})]}),o.jsxs("div",{className:"ficha-body",children:[o.jsxs("aside",{className:"ficha-sidebar",children:[o.jsx("div",{className:"ficha-sidebar-title",children:"Informacin general"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="datos"?"active":""}`,onClick:()=>v("datos"),children:"Datos personales"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="marketing"?"active":""}`,onClick:()=>v("marketing"),children:"Marketing"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="eps"?"active":""}`,onClick:()=>v("eps"),children:"EPS"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="prof"?"active":""}`,onClick:()=>v("prof"),children:"Profesionales"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="rx"?"active":""}`,onClick:()=>v("rx"),children:"Rx/Imgenes/Doc"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="citas"?"active":""}`,onClick:()=>v("citas"),children:"Citas"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="crm"?"active":""}`,onClick:()=>v("crm"),children:"CRM"}),o.jsx("div",{className:"ficha-sidebar-title mt",children:"Historia clnica"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="doc"?"active":""}`,onClick:()=>v("doc"),children:"Doc. Clnicos"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="odonto"?"active":""}`,onClick:()=>v("odonto"),children:"Odontogramas"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="perio"?"active":""}`,onClick:()=>v("perio"),children:"Periodontogramas"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="presu"?"active":""}`,onClick:()=>v("presu"),children:"Presupuestos"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="evo"?"active":""}`,onClick:()=>v("evo"),children:"Evoluciones"}),o.jsx("div",{className:"ficha-sidebar-title mt",children:"Facturacin"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="fact"?"active":""}`,onClick:()=>v("fact"),children:"Resumen"}),o.jsxs("div",{className:"ficha-sidebar-actions",style:{display:"grid",gap:8,marginTop:8},children:[o.jsx("button",{type:"button",className:"btn pay",onClick:()=>t(s(ld.caja,{cobro:1,patientId:I.id})),title:"Cobrar a este paciente",children:"Realizar pago"}),o.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${ld.pagos}?patientId=${encodeURIComponent(I.id)}`),title:"Ver histrico de pagos",children:"Histrico de pagos"}),o.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${ld.facturas}?patientId=${encodeURIComponent(I.id)}`),title:"Ver histrico de facturacin",children:"Histrico de facturacin"})]})]}),o.jsxs("main",{className:"ficha-content",children:[g==="datos"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Datos personales"}),o.jsx("div",{className:"ficha-grid",children:[["Tipo de documento",I.tipoDocumento],["Nro. de documento",I.nroDocumento],["Nmero de Historia",I.nroHistoria],["Fecha de ingreso",I.fechaIngreso],["Nombres",I.nombres],["Apellidos",I.apellidos],["Nombre completo",I.nombreCompleto],["Sexo",I.sexo],["Estado civil",I.estadoCivil],["Pas de nacimiento",I.paisNacimiento],["Ciudad de nacimiento",I.ciudadNacimiento],["Fecha de nacimiento",I.fechaNacimiento],["Edad",I.edad],["Pas de domicilio",I.paisDomicilio],["Ciudad de domicilio",I.ciudadDomicilio],["Barrio",I.barrio],["Lugar de residencia",I.lugarResidencia],["Estrato",I.estrato],["Zona residencial",I.zonaResidencial],["Extranjero",I.esExtranjero?"S":"No"],["Permite publicidad",I.permitePublicidad?"S":"No"],["Celular",I.celular||I.celularPaciente],["Telfono domicilio",I.telDomicilio||I.telefonoPaciente],["Telfono oficina",I.telOficina],["Extensin",I.extension],["Correo electrnico",I.email],["Ocupacin",I.ocupacion],["Responsable",I.nombreResponsable],["Parentesco",I.parentesco],["Cel. responsable",I.celularResponsable],["Tel. responsable",I.telefonoResponsable],["Email responsable",I.emailResponsable],["Acompaante",I.nombreAcompanante],["Tel. acompaante",I.telefonoAcompanante]].map(([j,G])=>o.jsxs("div",{className:"field",children:[o.jsx("label",{children:j}),o.jsx("input",{className:"form-input",value:G||"",readOnly:!0})]},j))})]}),g==="marketing"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Marketing"}),o.jsx("div",{className:"ficha-grid",children:[["Convenio beneficio",I.convenioBeneficio],["Cmo nos conoci?",I.comoConocio],["Campaa",I.campania],["Remitido por",I.remitidoPor],["Asesor comercial",I.asesorComercial]].map(([j,G])=>o.jsxs("div",{className:"field",children:[o.jsx("label",{children:j}),o.jsx("input",{className:"form-input",value:G||"",readOnly:!0})]},j))})]}),g==="eps"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"EPS"}),o.jsx("div",{className:"ficha-grid",children:[["Tipo de vinculacin",I.tipoVinculacion],["Nombre EPS",I.nombreEps],["Pliza de salud",I.polizaSalud]].map(([j,G])=>o.jsxs("div",{className:"field",children:[o.jsx("label",{children:j}),o.jsx("input",{className:"form-input",value:G||"",readOnly:!0})]},j))})]}),g==="prof"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Profesionales"}),o.jsx("div",{className:"ficha-grid",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Doctor"}),o.jsx("input",{className:"form-input",value:I.doctor||"",readOnly:!0})]})})]}),g==="rx"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Rx / Imgenes / Documentos"}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{className:"btn blue",children:["Subir archivos",o.jsx("input",{ref:te,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",style:{display:"none"},onChange:j=>F([...j.target.files||[]])})]}),we&&o.jsx("span",{className:"hint",children:"Subiendo"}),o.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:o.jsx("input",{className:"form-input",style:{width:200},placeholder:"Buscar en Rx",value:me,onChange:j=>Ne(j.target.value),title:"Filtra por nombre, ttulo o descripcin"})})]}),o.jsxs("div",{className:"hint",style:{marginTop:6},children:[st.length," elemento(s)",me?"  filtrado(s)":"","."]}),o.jsxs("div",{className:"rx-grid",style:{display:"grid",gap:10,marginTop:12,gridTemplateColumns:`repeat(auto-fill, minmax(${ke.colMin}px, 1fr))`,alignItems:"start"},children:[st.length===0&&o.jsx("div",{className:"no-data",style:{gridColumn:"1 / -1"},children:me?"Sin coincidencias.":"Sin archivos an."}),st.map((j,G)=>{var wt,zn;const oe=He(j),_e=j.title||j.name||`archivo-${G}`,Ce=((wt=(j.name||"").split(".").pop())==null?void 0:wt.toUpperCase())||((zn=(j.type||"").split("/").pop())==null?void 0:zn.toUpperCase())||"",qe=j.uploadedAtISO||(j.created?new Date(j.created).toISOString():null);return o.jsxs("div",{className:"rx-item mini-card",style:{padding:8,display:"grid",gap:8},title:_e,children:[o.jsx("a",{href:j.url,target:"_blank",rel:"noreferrer",style:{width:"100%",height:ke.thumbH,borderRadius:8,overflow:"hidden",border:"1px solid #e5e7eb",display:"grid",placeItems:"center",background:"#fafafa"},children:oe?o.jsx("img",{src:j.url,alt:_e,style:{width:ke.thumbW,height:ke.thumbH,objectFit:"contain",display:"block"},loading:"lazy"}):o.jsxs("div",{style:{textAlign:"center",padding:10},children:[o.jsx("div",{style:{fontSize:24,fontWeight:700},children:Ce||"DOC"}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Ver / descargar"})]})}),o.jsx("div",{style:{fontWeight:600,fontSize:13,lineHeight:1.2},children:_e.length>40?_e.slice(0,37)+"":_e}),o.jsxs("details",{children:[o.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#2563eb"},children:"Editar nombre y descripcin"}),o.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[o.jsx("label",{className:"form-label",style:{marginTop:4},children:"Nombre para mostrar"}),o.jsx("input",{id:`rx-title-${G}`,className:"form-input",defaultValue:j.title||j.name||"",placeholder:"Ej. Rx aleta derecha 2025-11-29"}),o.jsx("label",{className:"form-label",children:"Descripcin"}),o.jsx("textarea",{id:`rx-desc-${G}`,className:"form-input",rows:2,defaultValue:j.desc||"",placeholder:"Observaciones, regin, tcnica, etc."}),o.jsx("label",{className:"form-label",children:"Fecha de subida"}),o.jsx("input",{id:`rx-date-${G}`,type:"datetime-local",className:"form-input",defaultValue:vU(qe)}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"space-between"},children:[o.jsx("button",{type:"button",className:"btn blue",onClick:()=>{var ds,hs,zo;const Rn=((ds=document.getElementById(`rx-title-${G}`))==null?void 0:ds.value)||"",Ct=((hs=document.getElementById(`rx-desc-${G}`))==null?void 0:hs.value)||"",Pt=((zo=document.getElementById(`rx-date-${G}`))==null?void 0:zo.value)||"";let qn=qe,Cr=j.uploadedAtMS||j.created||null;if(Pt){const fs=new Date(Pt);isNaN(fs.getTime())||(qn=fs.toISOString(),Cr=fs.getTime())}De(G,{title:Rn,name:Rn||j.name,desc:Ct,uploadedAtISO:qn,uploadedAtMS:Cr})},children:"Guardar"}),o.jsx("button",{type:"button",className:"btn",onClick:()=>re(G),children:"Eliminar"})]}),o.jsxs("div",{className:"hint",style:{fontSize:11},children:["Tipo: ",j.type||"","  Tamao: ",(j.size||0).toLocaleString()," bytes",qe?`  Subido: ${_U(qe)}`:""]})]})]})]},`${j.url}-${G}`)})]})]}),g==="doc"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Doc. Clnicos"}),o.jsxs("div",{className:"ficha-grid",children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Motivo de consulta"}),o.jsx("textarea",{className:"form-input",rows:3,value:((Wt=I.historiaClinica)==null?void 0:Wt.motivoConsulta)||"",onChange:j=>ue("motivoConsulta",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Antecedentes"}),o.jsx("textarea",{className:"form-input",rows:3,value:((ut=I.historiaClinica)==null?void 0:ut.antecedentes)||"",onChange:j=>ue("antecedentes",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Alergias"}),o.jsx("textarea",{className:"form-input",rows:2,value:((dn=I.historiaClinica)==null?void 0:dn.alergias)||"",onChange:j=>ue("alergias",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Medicamentos"}),o.jsx("textarea",{className:"form-input",rows:2,value:((yn=I.historiaClinica)==null?void 0:yn.medicamentos)||"",onChange:j=>ue("medicamentos",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Notas"}),o.jsx("textarea",{className:"form-input",rows:3,value:((vn=I.historiaClinica)==null?void 0:vn.notas)||"",onChange:j=>ue("notas",j.target.value)})]})]})]}),g==="odonto"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Odontograma (placeholder)"}),o.jsx("div",{className:"odont-grid",children:Array.from({length:32},(j,G)=>G+1).map(j=>{const G=(I.odontograma||[]).some(oe=>oe.pieza===j);return o.jsx("button",{type:"button",className:`tooth ${G?"on":""}`,onClick:()=>rt("odontograma",j),title:`Pieza ${j}`,children:j},j)})})]}),g==="perio"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Periodontograma (placeholder)"}),o.jsx("div",{className:"odont-grid",children:Array.from({length:32},(j,G)=>G+1).map(j=>{const G=(I.periodontograma||[]).some(oe=>oe.pieza===j);return o.jsx("button",{type:"button",className:`tooth ${G?"on":""}`,onClick:()=>rt("periodontograma",j),title:`Pieza ${j}`,children:j},j)})})]}),g==="presu"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Presupuestos & planes"}),o.jsx(EU,{onAdd:Ae}),o.jsxs("div",{className:"presu-list",children:[(I.presupuestos||[]).map(j=>o.jsxs("div",{className:"presu-item",children:[o.jsxs("div",{children:[o.jsx("div",{className:"presu-title",children:j.titulo}),o.jsxs("div",{className:"presu-meta",children:["Costo: $",j.costo||0,"  Estado: ",j.estado||"Pendiente"]})]}),o.jsx("button",{type:"button",className:"btn small",onClick:()=>Pe(j.id),children:"Eliminar"})]},j.id)),(!I.presupuestos||I.presupuestos.length===0)&&o.jsx("div",{className:"no-data",children:"Sin presupuestos an."})]})]}),g==="evo"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Evoluciones & Remisiones"}),o.jsx(IU,{onAdd:$e}),o.jsxs("div",{className:"evo-list",children:[(I.evoluciones||[]).map(j=>o.jsxs("div",{className:"evo-item",children:[o.jsx("div",{className:"evo-date",children:new Date(j.fechaISO).toLocaleString()}),o.jsx("div",{className:"evo-note",children:j.nota}),o.jsx("button",{type:"button",className:"btn small",onClick:()=>Fe(j.id),children:"Eliminar"})]},j.id)),(!I.evoluciones||I.evoluciones.length===0)&&o.jsx("div",{className:"no-data",children:"Sin evoluciones an."})]})]}),g==="fact"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Facturacin"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px,1fr))",gap:12},children:[o.jsx(na,{title:"Total facturado",value:`$ ${Vt.totalFacturado.toLocaleString()}`}),o.jsx(na,{title:"Total pagado",value:`$ ${Vt.totalPagado.toLocaleString()}`}),o.jsx(na,{title:"Facturas pendientes",value:`$ ${Vt.totalFacturasPendientes.toLocaleString()}`}),o.jsx(na,{title:"Saldo pendiente (facturas - pagos)",value:`$ ${(Vt.totalFacturado-Vt.totalPagado).toLocaleString()}`}),o.jsx(na,{title:"Saldo a favor",value:`$ ${(((Sr=I.facturacion)==null?void 0:Sr.saldoFavor)??0).toLocaleString()}`}),o.jsx(na,{title:"Saldo crdito",value:`$ ${(((yl=I.facturacion)==null?void 0:yl.saldoCredito)??0).toLocaleString()}`})]}),Vt.error&&o.jsxs("div",{className:"hint",style:{marginTop:6},children:[" ",Vt.error]}),o.jsxs("div",{className:"ficha-grid",style:{marginTop:12},children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Saldo a favor"}),o.jsx("input",{type:"number",className:"form-input",value:((us=I.facturacion)==null?void 0:us.saldoFavor)??0,onChange:j=>D({facturacion:{...I.facturacion||{},saldoFavor:Number(j.target.value||0)}})})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Saldo crdito"}),o.jsx("input",{type:"number",className:"form-input",value:((Fi=I.facturacion)==null?void 0:Fi.saldoCredito)??0,onChange:j=>D({facturacion:{...I.facturacion||{},saldoCredito:Number(j.target.value||0)}})})]})]})]}),g==="citas"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Citas"}),o.jsxs("div",{className:"mini-card",style:{marginBottom:12},children:[o.jsx("div",{className:"mini-card-title",children:"Crear cita para este paciente"}),o.jsxs("div",{className:"ficha-grid",style:{marginTop:8},children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Fecha"}),o.jsx("input",{type:"date",className:"form-input",value:Ge,onChange:j=>_t(j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Hora"}),o.jsx("input",{type:"time",className:"form-input",value:W,onChange:j=>fe(j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Doctor"}),o.jsx("input",{className:"form-input",value:ye,onChange:j=>J(j.target.value),placeholder:"Doctor asignado"})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Espacio / Sala"}),o.jsx("input",{className:"form-input",value:Z,onChange:j=>Ie(j.target.value),placeholder:"Consultorio / Silla"})]}),o.jsxs("div",{className:"field",style:{gridColumn:"1 / -1"},children:[o.jsx("label",{children:"Comentario"}),o.jsx("textarea",{className:"form-input",rows:2,value:ge,onChange:j=>Y(j.target.value),placeholder:"Motivo / notas de la cita"})]})]}),o.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[o.jsx("button",{type:"button",className:"btn blue",onClick:X,children:"Guardar cita"}),Ge&&o.jsx("button",{type:"button",className:"btn",onClick:()=>i(Ge,I.id),children:"Ver ese da en Agenda"})]})]}),o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Fecha"}),o.jsx("th",{children:"Estado"}),o.jsx("th",{children:"Motivo"}),o.jsx("th",{children:"Profesional / Acciones"})]})}),o.jsx("tbody",{children:Qe?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:4,children:"Cargando"})}):Jn.length===0?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:4,children:"Sin citas registradas."})}):Jn.map(j=>o.jsxs("tr",{children:[o.jsx("td",{children:j.fechaISO?new Date(j.fechaISO).toLocaleString():j.fechaYYYYMMDD||""}),o.jsx("td",{children:j.estado||""}),o.jsx("td",{children:j.motivo||""}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{children:j.profesional||""}),o.jsx("button",{type:"button",className:"btn small",onClick:()=>{const G=j.fechaYYYYMMDD||j.fecha||(j.fechaISO?new Date(j.fechaISO).toISOString().slice(0,10):"");i(G,I.id)},title:"Abrir en Agenda",children:"Ver en Agenda"})]})})]},j.id))})]})})]}),g==="crm"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"CRM"}),o.jsx("div",{className:"no-data",children:"Notas / recordatorios comerciales del paciente."})]}),o.jsx("div",{className:"ficha-footer"})]})]})]})]})]})}function na({title:t,value:e}){return o.jsxs("div",{className:"mini-card",children:[o.jsx("div",{className:"mini-card-title",children:t}),o.jsx("div",{style:{fontWeight:700,fontSize:20,marginTop:6},children:e})]})}function EU({onAdd:t}){const[e,n]=w.useState(""),[r,s]=w.useState(""),[i,a]=w.useState("Pendiente");return o.jsxs("div",{className:"presu-form",children:[o.jsx("input",{className:"form-input",placeholder:"Procedimiento / plan",value:e,onChange:l=>n(l.target.value)}),o.jsx("input",{type:"number",className:"form-input",placeholder:"Costo",value:r,onChange:l=>s(l.target.value)}),o.jsxs("select",{className:"form-input",value:i,onChange:l=>a(l.target.value),children:[o.jsx("option",{children:"Pendiente"}),o.jsx("option",{children:"Aprobado"}),o.jsx("option",{children:"Rechazado"})]}),o.jsx("button",{type:"button",className:"btn blue",onClick:()=>{if(!e)return alert("Ttulo requerido");t({titulo:e,costo:Number(r||0),estado:i}),n(""),s(""),a("Pendiente")},children:"Agregar"})]})}function IU({onAdd:t}){const[e,n]=w.useState("");return o.jsxs("div",{className:"evo-form",children:[o.jsx("textarea",{className:"form-input",rows:2,placeholder:"Escribe la evolucin / remisin",value:e,onChange:r=>n(r.target.value)}),o.jsx("button",{type:"button",className:"btn blue",onClick:()=>{e.trim()&&(t(e.trim()),n(""))},children:"Guardar evolucin"})]})}function SU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function CU({basePath:t="",className:e=""}){const n=cs(),r=()=>{const s=String(t||"").replace(/\/+$/g,"");n(`${s}/config/datos-basicos`,{replace:!1})};return o.jsx("button",{type:"button",className:`oc-icon-btn ${e}`,title:"Configuracin","aria-label":"Abrir configuracin",onClick:r,children:""})}function TU(t,e){try{let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}catch{}}const q0="empresa_datos_basicos",NU="oc_company_name",jU="empresa_nombre";function AU(){const[t,e]=w.useState({nombre:"",marca:"",pais:"Colombia",ciudad:"",tipoDocumento:"NIT",numeroDocumento:"",tipoPersona:"",telefono:"",celular:"",direccion:"",sitioWeb:"",urlAgendamiento:"",regimen:"",responsabilidadTributaria:"",correo:"",moneda:"Pesos colombianos (COP)",zonaHoraria:"Hora de Colombia",cuentaContable:"",esIPS:!1,usuarioSispro:"",tipoDocSispro:"Cdula de Ciudadana",passwordSispro:"",codigoPrestador:""});w.useEffect(()=>{var s;try{const i=localStorage.getItem(q0);if(i){const l=JSON.parse(i);e(c=>({...c,...l}));return}const a=(s=document.querySelector('meta[name="company-name"]'))==null?void 0:s.getAttribute("content");a&&e(l=>({...l,nombre:a}))}catch{}},[]);const n=s=>{const{name:i,type:a,value:l,checked:c}=s.target;e(d=>({...d,[i]:a==="checkbox"?c:l}))},r=s=>{s.preventDefault();try{localStorage.setItem(q0,JSON.stringify(t))}catch{}const i=(t.nombre||"OdontoCloud").trim();try{localStorage.setItem(NU,i),localStorage.setItem(jU,i)}catch{}TU("company-name",i);try{window.dispatchEvent(new CustomEvent("oc-company-name-updated",{detail:{nombre:i}}));const a=document.querySelector(".oc-topbar-title");a&&(a.textContent=i)}catch{}console.log(" Datos bsicos guardados:",t),alert("Datos bsicos guardados.")};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Datos bsicos"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:"Datos bsicos"}),o.jsxs("form",{className:"emp-form",onSubmit:r,children:[o.jsxs("div",{className:"oc-form-grid",children:[o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Nombre *"}),o.jsx("input",{name:"nombre",className:"emp-input",autoComplete:"organization",required:!0,value:t.nombre,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Marca"}),o.jsx("input",{name:"marca",className:"emp-input",value:t.marca,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Pas"}),o.jsxs("select",{name:"pais",className:"emp-select",value:t.pais,onChange:n,children:[o.jsx("option",{children:"Colombia"}),o.jsx("option",{children:"Mxico"}),o.jsx("option",{children:"Per"}),o.jsx("option",{children:"Chile"}),o.jsx("option",{children:"Argentina"}),o.jsx("option",{children:"Espaa"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Ciudad"}),o.jsx("input",{name:"ciudad",className:"emp-input",value:t.ciudad,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo documento *"}),o.jsxs("select",{name:"tipoDocumento",className:"emp-select",required:!0,value:t.tipoDocumento,onChange:n,children:[o.jsx("option",{children:"NIT"}),o.jsx("option",{children:"CC"}),o.jsx("option",{children:"CE"}),o.jsx("option",{children:"PA"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Nmero de documento *"}),o.jsx("input",{name:"numeroDocumento",className:"emp-input",required:!0,value:t.numeroDocumento,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo de persona"}),o.jsxs("select",{name:"tipoPersona",className:"emp-select",value:t.tipoPersona,onChange:n,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Natural"}),o.jsx("option",{children:"Jurdica"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Telfono fijo"}),o.jsx("input",{name:"telefono",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.telefono,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Celular"}),o.jsx("input",{name:"celular",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.celular,onChange:n})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Direccin"}),o.jsx("input",{name:"direccion",className:"emp-input",autoComplete:"street-address",value:t.direccion,onChange:n})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Sitio web"}),o.jsx("input",{name:"sitioWeb",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.sitioWeb,onChange:n})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Agendamiento (URL)"}),o.jsx("input",{name:"urlAgendamiento",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.urlAgendamiento,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Rgimen legal"}),o.jsxs("select",{name:"regimen",className:"emp-select",value:t.regimen,onChange:n,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Comn"}),o.jsx("option",{children:"Simplificado"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Responsabilidad tributaria"}),o.jsxs("select",{name:"responsabilidadTributaria",className:"emp-select",value:t.responsabilidadTributaria,onChange:n,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"No aplica"}),o.jsx("option",{children:"Autorretenedor"})]})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Correo electrnico"}),o.jsx("input",{name:"correo",className:"emp-input",type:"email",autoComplete:"email",value:t.correo,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Moneda"}),o.jsxs("select",{name:"moneda",className:"emp-select",value:t.moneda,onChange:n,children:[o.jsx("option",{children:"Pesos colombianos (COP)"}),o.jsx("option",{children:"Dlares (USD)"}),o.jsx("option",{children:"Euros (EUR)"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Zona horaria"}),o.jsxs("select",{name:"zonaHoraria",className:"emp-select",value:t.zonaHoraria,onChange:n,children:[o.jsx("option",{children:"Hora de Colombia"}),o.jsx("option",{children:"America/Bogota"}),o.jsx("option",{children:"UTC-5"})]})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Cuenta contable"}),o.jsx("input",{name:"cuentaContable",className:"emp-input",value:t.cuentaContable,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Es una institucin prestadora de salud (IPS)?"}),o.jsxs("div",{className:"emp-inline",children:[o.jsx("input",{id:"esIPS",type:"checkbox",name:"esIPS",checked:t.esIPS,onChange:n}),o.jsx("label",{htmlFor:"esIPS",children:"S"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Usuario SISPRO"}),o.jsx("input",{name:"usuarioSispro",className:"emp-input",value:t.usuarioSispro,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo documento SISPRO"}),o.jsxs("select",{name:"tipoDocSispro",className:"emp-select",value:t.tipoDocSispro,onChange:n,children:[o.jsx("option",{children:"Cdula de Ciudadana"}),o.jsx("option",{children:"Cdula de Extranjera"}),o.jsx("option",{children:"NIT"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Contrasea SISPRO"}),o.jsx("input",{name:"passwordSispro",className:"emp-input",type:"password",value:t.passwordSispro,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Cdigo de prestador"}),o.jsx("input",{name:"codigoPrestador",className:"emp-input",value:t.codigoPrestador,onChange:n})]})]}),o.jsx("div",{className:"oc-form-actions",children:o.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})})]})]})]})}const im="empresa_logo_url";function H0(t,e){let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}function PU(){const[t,e]=w.useState(()=>{try{return localStorage.getItem(im)||""}catch{return""}}),[n,r]=w.useState(null),[s,i]=w.useState(!1),a=w.useRef(null),l=w.useCallback(C=>{const N=C==null?void 0:C[0];if(!N)return;if(!N.type.startsWith("image/")){alert("Por favor selecciona una imagen (PNG/JPG/SVG/WebP).");return}r(N);const _=new FileReader;_.onload=E=>{var S;return e(String(((S=E.target)==null?void 0:S.result)||""))},_.readAsDataURL(N)},[]),c=C=>l(C.target.files),d=C=>{C.preventDefault(),C.stopPropagation(),i(!1),l(C.dataTransfer.files)},f=C=>{C.preventDefault(),i(!0)},h=()=>i(!1),p=()=>{var C;return(C=a.current)==null?void 0:C.click()},x=()=>{r(null),e("")},T=async()=>{try{t?(localStorage.setItem(im,t),H0("company-logo",t)):(localStorage.removeItem(im),H0("company-logo","")),alert("Logo guardado.")}catch(C){console.error(C),alert("No se pudo guardar localmente.")}};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Logo empresa"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:"Logo"}),o.jsxs("div",{className:"logo-wrap",children:[o.jsxs("div",{className:"logo-current",children:[o.jsx("div",{className:"emp-label",children:"Logo actual"}),o.jsx("div",{className:"logo-preview","aria-live":"polite",children:t?o.jsx("img",{src:t,alt:"Logo actual de la empresa"}):o.jsx("div",{className:"logo-empty",children:"Sin logo"})}),o.jsx("div",{className:"logo-actions",children:o.jsx("button",{type:"button",className:"oc-btn danger",onClick:x,disabled:!t,children:"Eliminar"})})]}),o.jsxs("div",{className:"logo-uploader",children:[o.jsx("div",{className:"emp-label",children:"Cargar foto"}),o.jsxs("div",{className:`logo-drop ${s?"over":""}`,onDragOver:f,onDragLeave:h,onDrop:d,onClick:p,role:"button",tabIndex:0,onKeyDown:C=>(C.key==="Enter"||C.key===" ")&&p(),"aria-label":"Arrastra o haz click para cargar la imagen del logo",children:[o.jsx("input",{ref:a,type:"file",accept:"image/*",onChange:c,style:{display:"none"}}),o.jsxs("div",{className:"logo-drop-hint",children:["Arrastra o click para cargar la foto.",o.jsx("div",{className:"logo-subhint",children:"Solo archivos de imagen"})]})]}),n&&o.jsxs("div",{className:"logo-file-name",children:["Archivo seleccionado: ",o.jsx("b",{children:n.name})]})]})]}),o.jsx("div",{className:"oc-form-actions",children:o.jsx("button",{type:"button",className:"oc-btn primary",onClick:T,children:"Guardar"})})]})]})}function RU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}const cd=t=>{let e=String(t??"").replace(/\D/g,"");return e===""?"":(e=e.replace(/^0+(?=\d)/,""),e.replace(/\B(?=(\d{3})+(?!\d))/g,"."))},W0=t=>Number(String(t??"").replace(/\D/g,""))||0;function v_(t,e){const n=e.map(i=>i.map(a=>{const l=String(a??"").replace(/"/g,'""');return/[",\n]/.test(l)?`"${l}"`:l}).join(",")).join(`
`),r=new Blob([n],{type:"text/csv;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(r),s.download=t,s.click(),URL.revokeObjectURL(s.href)}function kU(){w.useEffect(()=>{var r,s;(r=document.getElementById("lp-acciones-unificadas-icons26"))==null||r.remove(),(s=document.getElementById("lp-acciones-unificadas-icons_v2"))==null||s.remove();const t="lp-acciones-unificadas-icons_v2",e=`
      .lp-wrap{padding:0;}
      .lp-h2{margin:0 0 12px;font-weight:800;font-size:20px;color:#0f172a;}

      .lp-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;}
      .lp-pill{padding:7px 16px;border-radius:999px;border:1px solid #d1d5db;background:#fff;
        font-weight:600;color:#374151;cursor:pointer;font-size:14px;transition:.2s;}
      .lp-pill:hover{background:#f3f4f6;}
      .lp-pill.active{background:#2b6cb0;color:#fff;border-color:#2b6cb0;}

      .lp-card{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:18px;box-shadow:0 1px 2px rgba(0,0,0,.04);}
      .lp-card-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:12px;}
      .lp-subtitle{font-size:16px;font-weight:800;color:#111827;margin:0 0 8px;border-bottom:1px solid #e5e7eb;padding-bottom:6px;}

      .chip{display:inline-flex;align-items:center;gap:8px;height:34px;padding:0 12px;border-radius:999px;border:1px solid #d1d5db;
        background:#fff;color:#374151;font-weight:600;cursor:pointer;transition:.2s;white-space:nowrap;}
      .chip:hover{background:#f3f4f6;}
      .btn-soft{display:inline-flex;align-items:center;gap:6px;height:32px;padding:0 12px;border-radius:999px;border:none;cursor:pointer;
        font-weight:700;font-size:13px;background:#22c55e;color:#fff;}
      .btn-soft.gray{background:#6b7280;}
      .btn-soft:hover{filter:brightness(.95);}

      .lp-table-wrap{overflow-x:hidden;width:100%;}
      .lp-card table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:14px;}
      thead tr{background:#f9fafb;}
      th,td{padding:8px 10px;white-space:normal;word-break:break-word;vertical-align:middle;}
      th{text-align:left;border-bottom:1px solid #e5e7eb;font-weight:700;color:#475569;}
      tbody tr{border-top:1px solid #f1f5f9;}
      .muted{color:#6b7280;}

      /* Acciones unificadas */
      th.actions, td.actions{width:140px;text-align:right;}
      .lp-actions{display:flex;gap:8px;justify-content:flex-end;align-items:center;flex-wrap:nowrap;}

      .iconbtn{
        display:inline-flex;align-items:center;justify-content:center;
        width:32px;height:32px;border-radius:10px;border:1px solid transparent;cursor:pointer;transition:.15s;
      }
      .iconbtn.green{background:#ecfdf5;color:#0f9d5b;border-color:#bbf7d0;}
      .iconbtn.blue {background:#eff6ff;color:#1e3a8a;border-color:#bfdbfe;}
      .iconbtn.red  {background:#fef2f2;color:#b91c1c;border-color:#fecaca;}
      .iconbtn:hover{filter:brightness(.97);}

      .iconbtn > svg{
        width:38px !important;
        height:38px !important;
        display:block;
        stroke-width:2.4;
        vector-effect: non-scaling-stroke;
        pointer-events:none;
      }

      .badge{display:inline-block;padding:5px 10px;border-radius:999px;font-weight:700;font-size:12px;line-height:1;}
      .badge.green{background:#e8f7ee;color:#16a34a;border:1px solid #cbead7;}

      /* ---------- Form (nuevo/editar) ---------- */
      .np-grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:6px;}
      .np-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
      .np-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
      .np-field{display:flex;flex-direction:column;gap:6px;}
      .np-label{font-weight:700;color:#334155;font-size:13px;}
      .np-input, .np-select, .np-text{
        border:1px solid #d1d5db;border-radius:8px;padding:8px 10px;font-size:14px;background:#fff;
      }
      .np-text{min-height:72px;resize:vertical;}
      .np-toggle{display:flex;align-items:center;gap:10px;}
      .np-card-img{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:6px;}
      .np-avatar{width:140px;height:140px;border-radius:12px;background:#e5e7eb;display:flex;align-items:center;justify-content:center;color:#64748b;}
      .np-drop{border:2px dashed #d1d5db;border-radius:12px;padding:16px;text-align:center;color:#64748b;}
      .np-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;}

      @media (max-width:900px){
        .np-row, .np-row-3{grid-template-columns:1fr;}
      }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}const __=()=>o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("path",{d:"M12 20h9"}),o.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5z"})]}),x_=()=>o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),o.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),b_=()=>o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("polyline",{points:"3 6 5 6 21 6"}),o.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),o.jsx("path",{d:"M10 11v6M14 11v6"})]}),DU=()=>o.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:o.jsx("path",{d:"M20 6L9 17l-5-5"})});function LU(){const[t,e]=w.useState(!0),[n,r]=w.useState([]),[s,i]=w.useState("list"),[a,l]=w.useState(""),{pathname:c}=Bn(),d=cs(),f=w.useMemo(()=>RU(c),[c]),h=async()=>{e(!0);try{const _=Le(se(Q,"listas_precios"),Xe("tipo","==","clinicos")),S=(await Se(_)).docs.map(I=>({id:I.id,...I.data()}));S.sort((I,L)=>String(L.actualizado||L.creado||"").localeCompare(String(I.actualizado||I.creado||""))),r(S)}catch{r([])}finally{e(!1)}};w.useEffect(()=>{h()},[]);const p=async()=>{if(!a.trim())return alert("Escribe el nombre de la lista.");const _=new Date().toLocaleString("es-CO"),E={nombre:a.trim(),creado:_,actualizado:_,en_uso:!1,tipo:"clinicos"},S=await zt(se(Q,"listas_precios"),E);r(I=>[{id:S.id,...E},...I]),l(""),i("list")},x=async _=>{const E=Le(se(Q,"listas_precios"),Xe("tipo","==","clinicos")),S=await Se(E);await Promise.all(S.docs.map(I=>$t(Re(Q,"listas_precios",I.id),{en_uso:I.id===_.id}))),r(I=>I.map(L=>({...L,en_uso:L.id===_.id})))},T=async _=>{window.confirm(`Eliminar "${_==null?void 0:_.nombre}"?`)&&(await An(Re(Q,"listas_precios",_.id)),r(E=>E.filter(S=>S.id!==_.id)))},C=async _=>{const E=new Date().toLocaleString("es-CO"),{id:S,...I}=_,L={...I,nombre:`${(_==null?void 0:_.nombre)||"Lista"} (copia)`,en_uso:!1,creado:E,actualizado:E},V=await zt(se(Q,"listas_precios"),L);r(g=>[{id:V.id,...L},...g])},N=_=>d(`${f}/config/lista-de-precios/editar/${_.id}`);return o.jsxs("div",{className:"lp-card",children:[o.jsx("h3",{className:"lp-subtitle",children:"Lista de precios clnicos"}),s==="list"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsxs("button",{className:"chip",onClick:()=>i("nuevo"),children:[o.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de precios"]}),o.jsx("button",{className:"chip",onClick:()=>v_("Plantilla_Clinicos.csv",[["Categora","Cdigo","Nombre","Permite desc","Precio","Genera RIPS","Es consulta","Ver en agenda","Cuenta contable"],["Odontologa General","890201","Consulta inicial","si","0","no","si","no","4  Ingresos"]]),children:"Exportar plantilla"})]})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Fecha de creacin"}),o.jsx("th",{children:"Fecha de actualizacin"}),o.jsx("th",{children:"En uso"}),o.jsx("th",{className:"actions",children:"Acciones"})]})}),o.jsx("tbody",{children:t?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center"},children:"Cargando"})}):n.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center"},className:"muted",children:"Sin datos"})}):n.map(_=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:600},children:(_==null?void 0:_.nombre)||""}),o.jsx("td",{children:(_==null?void 0:_.creado)||""}),o.jsx("td",{children:(_==null?void 0:_.actualizado)||""}),o.jsx("td",{children:_!=null&&_.en_uso?o.jsx("span",{className:"badge green",children:"En uso"}):o.jsxs("button",{className:"btn-soft",onClick:()=>x(_),title:"Usar esta lista","aria-label":"Usar esta lista",children:[o.jsx(DU,{})," Usar"]})}),o.jsx("td",{className:"actions",children:o.jsxs("div",{className:"lp-actions",children:[o.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>C(_),"aria-label":"Clonar",children:o.jsx(x_,{})}),o.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>N(_),"aria-label":"Editar",children:o.jsx(__,{})}),o.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>T(_),"aria-label":"Eliminar",children:o.jsx(b_,{})})]})})]},_.id))})]})})]}):o.jsxs("div",{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("h4",{style:{margin:0,fontWeight:700},children:"Nueva lista de precios"}),o.jsx("button",{className:"chip",onClick:()=>i("list"),children:" Volver"})]}),o.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",maxWidth:560,marginTop:10},children:[o.jsx("input",{type:"text",placeholder:"Nombre de la lista",value:a,onChange:_=>l(_.target.value),style:{flex:1,border:"1px solid #d1d5db",borderRadius:8,padding:"8px 10px"}}),o.jsx("button",{type:"button",title:"Sugerir nombre automtico",className:"chip",onClick:()=>l("Lista de precios "+new Date().toLocaleDateString("es-CO")),children:""}),o.jsx("button",{className:"btn-soft",onClick:p,children:"Guardar"})]})]})]})}function OU(){const[t,e]=w.useState([]),[n,r]=w.useState("list"),[s,i]=w.useState(null),[a,l]=w.useState(null),[c,d]=w.useState("");w.useEffect(()=>{(async()=>{var g;try{const v=Le(se(Q,"listas_precios"),Xe("tipo","==","clinicos"),Xe("en_uso","==",!0)),P=(g=(await Se(v)).docs)==null?void 0:g[0];d(P?P.id:"")}catch{d("")}})()},[]);const f={nombre:"",referencia:"",descripcion:"",cuentaContable:"",categoria:"",esServicio:!1,precioCompra:"",marca:"",principioActivo:"",registroInvima:"",formaFarmaceutica:"",concentracion:"",presentacionComercial:"",tempAlmacenamiento:"",unidadTemperatura:"",humedadAlmacenamiento:"",unidadHumedad:"",esInventariable:!1,clasificacionRiesgo:"",vidaUtil:"",periodicidadMantenimiento:"",periodicidadCalibracion:"",extTexto1:"",extTexto2:"",extNumero1:"",extNumero2:"",extFecha1:"",extFecha2:""},[h,p]=w.useState(f),x=async()=>{try{const v=(await Se(se(Q,"listas_precios_productos"))).docs.map(b=>({id:b.id,...b.data()}));e(v)}catch{e([])}};w.useEffect(()=>{x()},[]);const T=async g=>{const{id:v,...b}=g,P=await zt(se(Q,"listas_precios_productos"),{...b,nombre:`${(g==null?void 0:g.nombre)||"Producto"} (copia)`,creado:new Date().toISOString()});e(R=>[{id:P.id,...b,nombre:`${(g==null?void 0:g.nombre)||"Producto"} (copia)`},...R])},C=async g=>{window.confirm(`Eliminar "${g==null?void 0:g.nombre}"?`)&&(await An(Re(Q,"listas_precios_productos",g.id)),e(v=>v.filter(b=>b.id!==g.id)))},N=g=>{var P;const v=(P=g.target.files)==null?void 0:P[0];if(!v)return;const b=new FileReader;b.onload=()=>i(b.result),b.readAsDataURL(v)},_=()=>{v_("Plantilla_Productos.csv",[["Nombre","Referencia","Descripcin","Cuenta contable","Categora","Es servicio","Precio compra","Marca","Principio activo","Registro Invima","Forma farmacutica","Concentracin","Presentacin comercial","Temp. almacenamiento","Unidad temp.","Humedad almac.","Unidad humedad","Es inventariable","Clasif. riesgo","Vida til","Periodicidad mant.","Periodicidad calib.","Ext. texto 1","Ext. texto 2","Ext. nmero 1","Ext. nmero 2","Ext. fecha 1","Ext. fecha 2"],["Hilo reabsorbible 3/0","","","4  Ingresos","Insumos","no","0","Marca X","","","Sutura","","","25","C","60","%","si","","","12 meses","12 meses","","","","","",""]])},E=async()=>{if(!h.nombre.trim())return alert("El nombre es obligatorio.");const g={...h,precioCompra:W0(h.precioCompra),creado:new Date().toISOString(),imgPreview:s||null,listaId:c||null},v=await zt(se(Q,"listas_precios_productos"),g);e(b=>[{id:v.id,...g},...b]),p(f),i(null),r("list"),alert("Producto guardado.")},S=g=>{l(g.id),p({nombre:g.nombre||"",referencia:g.referencia||"",descripcion:g.descripcion||"",cuentaContable:g.cuentaContable||"",categoria:g.categoria||"",esServicio:!!g.esServicio,precioCompra:g.precioCompra?cd(g.precioCompra):"",marca:g.marca||"",principioActivo:g.principioActivo||"",registroInvima:g.registroInvima||"",formaFarmaceutica:g.formaFarmaceutica||"",concentracion:g.concentracion||"",presentacionComercial:g.presentacionComercial||"",tempAlmacenamiento:g.tempAlmacenamiento||"",unidadTemperatura:g.unidadTemperatura||"",humedadAlmacenamiento:g.humedadAlmacenamiento||"",unidadHumedad:g.unidadHumedad||"",esInventariable:!!g.esInventariable,clasificacionRiesgo:g.clasificacionRiesgo||"",vidaUtil:g.vidaUtil||"",periodicidadMantenimiento:g.periodicidadMantenimiento||"",periodicidadCalibracion:g.periodicidadCalibracion||"",extTexto1:g.extTexto1||"",extTexto2:g.extTexto2||"",extNumero1:g.extNumero1??"",extNumero2:g.extNumero2??"",extFecha1:g.extFecha1||"",extFecha2:g.extFecha2||""}),i(g.imgPreview||null),r("editar")},I=async()=>{if(!a)return;if(!h.nombre.trim())return alert("El nombre es obligatorio.");const g={...h,precioCompra:W0(h.precioCompra),actualizado:new Date().toISOString(),imgPreview:s||null,listaId:c||null};await $t(Re(Q,"listas_precios_productos",a),g),e(v=>v.map(b=>b.id===a?{id:a,...g}:b)),l(null),p(f),i(null),r("list"),alert("Producto actualizado.")},L=n==="editar"?"Editar producto":"Nuevo producto",V=n==="editar"?I:E;return o.jsxs("div",{className:"lp-card",children:[o.jsx("h3",{className:"lp-subtitle",children:"Lista de precios productos"}),n==="list"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsxs("button",{className:"chip",onClick:()=>{p(f),i(null),r("nuevo")},children:[o.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo producto"]}),o.jsx("button",{className:"chip",onClick:_,children:"Exportar plantilla"})]})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Marca"}),o.jsx("th",{children:"Descripcin"}),o.jsx("th",{className:"actions",children:"Acciones"})]})}),o.jsx("tbody",{children:t.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(g=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:600},children:(g==null?void 0:g.nombre)||""}),o.jsx("td",{children:(g==null?void 0:g.marca)||""}),o.jsx("td",{children:(g==null?void 0:g.descripcion)||""}),o.jsx("td",{className:"actions",children:o.jsxs("div",{className:"lp-actions",children:[o.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>T(g),"aria-label":"Clonar",children:o.jsx(x_,{})}),o.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>S(g),"aria-label":"Editar",children:o.jsx(__,{})}),o.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>C(g),"aria-label":"Eliminar",children:o.jsx(b_,{})})]})})]},g.id))})]})})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("h4",{style:{margin:0,fontWeight:700},children:L}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"btn-soft gray",onClick:()=>{r("list"),l(null),p(f),i(null)},children:" Volver"}),o.jsx("button",{className:"btn-soft",onClick:V,children:n==="editar"?"Actualizar":"Guardar"})]})]}),o.jsxs("div",{className:"np-card-img",children:[o.jsx("div",{className:"np-avatar",children:s?o.jsx("img",{src:s,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12}}):o.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[o.jsx("circle",{cx:"12",cy:"8",r:"4"}),o.jsx("path",{d:"M6 20c0-3.314 2.686 0 6 0s6 2.686 6 6"})]})}),o.jsxs("div",{className:"np-drop",children:[o.jsxs("div",{style:{marginBottom:6},children:["Arrastra o haz click para cargar la foto.",o.jsx("br",{}),"Solo archivos de imgenes"]}),o.jsx("input",{type:"file",accept:"image/*",onChange:N})]})]}),o.jsxs("div",{className:"np-grid",children:[o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Nombre*"}),o.jsx("input",{className:"np-input",value:h.nombre,onChange:g=>p({...h,nombre:g.target.value}),placeholder:"Nombre del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Referencia"}),o.jsx("input",{className:"np-input",value:h.referencia,onChange:g=>p({...h,referencia:g.target.value}),placeholder:"Referencia del concepto"})]})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Descripcin"}),o.jsx("textarea",{className:"np-text",value:h.descripcion,onChange:g=>p({...h,descripcion:g.target.value}),placeholder:"Descripcin del concepto"})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Cuenta contable"}),o.jsx("input",{className:"np-input",value:h.cuentaContable,onChange:g=>p({...h,cuentaContable:g.target.value}),placeholder:"Buscar tem..."})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Categora*"}),o.jsxs("select",{className:"np-select",value:h.categoria,onChange:g=>p({...h,categoria:g.target.value}),children:[o.jsx("option",{value:"",children:"Seleccione..."}),o.jsx("option",{children:"Medicamentos"}),o.jsx("option",{children:"Insumos"}),o.jsx("option",{children:"Equipos"})]})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field np-toggle",children:[o.jsx("label",{className:"np-label",style:{margin:0},children:"Es servicio?"}),o.jsx("input",{type:"checkbox",checked:h.esServicio,onChange:g=>p({...h,esServicio:g.target.checked})})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Precio compra*"}),o.jsx("input",{className:"np-input",inputMode:"numeric",value:h.precioCompra,onChange:g=>p({...h,precioCompra:cd(g.target.value)}),placeholder:"$0"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Marca"}),o.jsx("input",{className:"np-input",value:h.marca,onChange:g=>p({...h,marca:g.target.value}),placeholder:"Marca del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Principio activo"}),o.jsx("input",{className:"np-input",value:h.principioActivo,onChange:g=>p({...h,principioActivo:g.target.value}),placeholder:"Principio activo del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Registro Invima"}),o.jsx("input",{className:"np-input",value:h.registroInvima,onChange:g=>p({...h,registroInvima:g.target.value}),placeholder:"Informacin Invima del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Forma farmacutica"}),o.jsx("input",{className:"np-input",value:h.formaFarmaceutica,onChange:g=>p({...h,formaFarmaceutica:g.target.value}),placeholder:"Forma farmacutica del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Concentracin"}),o.jsx("input",{className:"np-input",value:h.concentracion,onChange:g=>p({...h,concentracion:g.target.value}),placeholder:"Concentracin del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Presentacin comercial"}),o.jsx("input",{className:"np-input",value:h.presentacionComercial,onChange:g=>p({...h,presentacionComercial:g.target.value}),placeholder:"Presentacin com. del concepto"})]})]}),o.jsxs("div",{className:"np-row-3",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Temperatura de almacenamiento"}),o.jsx("input",{className:"np-input",value:h.tempAlmacenamiento,onChange:g=>p({...h,tempAlmacenamiento:g.target.value}),placeholder:"Temperatura de almacenamiento"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Unidad de temperatura"}),o.jsx("input",{className:"np-input",value:h.unidadTemperatura,onChange:g=>p({...h,unidadTemperatura:g.target.value}),placeholder:"Unidad de temp. del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Humedad de almacenamiento"}),o.jsx("input",{className:"np-input",value:h.humedadAlmacenamiento,onChange:g=>p({...h,humedadAlmacenamiento:g.target.value}),placeholder:"Humedad de almacenamiento"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Unidad de humedad"}),o.jsx("input",{className:"np-input",value:h.unidadHumedad,onChange:g=>p({...h,unidadHumedad:g.target.value}),placeholder:"Unidad de hum. del concepto"})]}),o.jsxs("div",{className:"np-field np-toggle",children:[o.jsx("label",{className:"np-label",style:{margin:0},children:"Es inventariable?"}),o.jsx("input",{type:"checkbox",checked:h.esInventariable,onChange:g=>p({...h,esInventariable:g.target.checked})})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Clasificacin de riesgo"}),o.jsx("input",{className:"np-input",value:h.clasificacionRiesgo,onChange:g=>p({...h,clasificacionRiesgo:g.target.value}),placeholder:"Clasif. riesgo del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Vida til"}),o.jsx("input",{className:"np-input",value:h.vidaUtil,onChange:g=>p({...h,vidaUtil:g.target.value}),placeholder:"Vida til del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Periodicidad mantenimiento"}),o.jsx("input",{className:"np-input",value:h.periodicidadMantenimiento,onChange:g=>p({...h,periodicidadMantenimiento:g.target.value}),placeholder:"Periodicidad mant. del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Periodicidad calibracin"}),o.jsx("input",{className:"np-input",value:h.periodicidadCalibracion,onChange:g=>p({...h,periodicidadCalibracion:g.target.value}),placeholder:"Periodicidad cal. del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin texto 1"}),o.jsx("input",{className:"np-input",value:h.extTexto1,onChange:g=>p({...h,extTexto1:g.target.value}),placeholder:"Ext. texto 1 del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin texto 2"}),o.jsx("input",{className:"np-input",value:h.extTexto2,onChange:g=>p({...h,extTexto2:g.target.value}),placeholder:"Ext. texto 2 del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin nmero 1"}),o.jsx("input",{className:"np-input",inputMode:"numeric",value:h.extNumero1,onChange:g=>p({...h,extNumero1:cd(g.target.value)}),placeholder:"Ext. nmero 1 del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin nmero 2"}),o.jsx("input",{className:"np-input",inputMode:"numeric",value:h.extNumero2,onChange:g=>p({...h,extNumero2:cd(g.target.value)}),placeholder:"Ext. nmero 2 del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin fecha 1 (dd/mm/aaaa)"}),o.jsx("input",{className:"np-input",type:"date",value:h.extFecha1,onChange:g=>p({...h,extFecha1:g.target.value})})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin fecha 2 (dd/mm/aaaa)"}),o.jsx("input",{className:"np-input",type:"date",value:h.extFecha2,onChange:g=>p({...h,extFecha2:g.target.value})})]})]}),o.jsxs("div",{className:"np-actions",children:[o.jsx("button",{className:"btn-soft gray",onClick:()=>{r("list"),l(null),p(f),i(null)},children:"Cancelar"}),o.jsx("button",{className:"btn-soft",onClick:V,children:n==="editar"?"Actualizar":"Guardar"})]})]})]})]})}function VU(){const[t,e]=w.useState([]);w.useEffect(()=>{(async()=>{try{const a=(await Se(se(Q,"listas_precios_servicios"))).docs.map(l=>({id:l.id,...l.data()}));e(a)}catch{e([])}})()},[]);const n=async i=>{const{id:a,...l}=i,c=await zt(se(Q,"listas_precios_servicios"),{...l,nombre:`${(i==null?void 0:i.nombre)||"Servicio"} (copia)`});e(d=>[{id:c.id,...l,nombre:`${(i==null?void 0:i.nombre)||"Servicio"} (copia)`},...d])},r=async i=>{window.confirm(`Eliminar "${i==null?void 0:i.nombre}"?`)&&(await An(Re(Q,"listas_precios_servicios",i.id)),e(a=>a.filter(l=>l.id!==i.id)))},s=()=>{v_("Plantilla_Servicios.csv",[["Nombre","Descripcin","Cuenta contable","Categora","Precio base","Genera RIPS"],["Toma de Rx periapical","","4  Ingresos","Radiologa","0","si"]])};return o.jsxs("div",{className:"lp-card",children:[o.jsx("h3",{className:"lp-subtitle",children:"Lista de precios servicios"}),o.jsxs("div",{className:"lp-card-header",children:[o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsxs("button",{className:"chip",onClick:()=>alert("Nuevo listado de servicios (prximamente)"),children:[o.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de servicios"]}),o.jsx("button",{className:"chip",onClick:s,children:"Exportar plantilla"})]})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Marca"}),o.jsx("th",{children:"Descripcin"}),o.jsx("th",{className:"actions",children:"Acciones"})]})}),o.jsx("tbody",{children:t.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(i=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:600},children:(i==null?void 0:i.nombre)||""}),o.jsx("td",{children:(i==null?void 0:i.marca)||""}),o.jsx("td",{children:(i==null?void 0:i.descripcion)||""}),o.jsx("td",{className:"actions",children:o.jsxs("div",{className:"lp-actions",children:[o.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>n(i),"aria-label":"Clonar",children:o.jsx(x_,{})}),o.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>alert("Editar servicio (prx.)"),"aria-label":"Editar",children:o.jsx(__,{})}),o.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>r(i),"aria-label":"Eliminar",children:o.jsx(b_,{})})]})})]},i.id))})]})})]})}function C1(){kU();const[t,e]=w.useState("clinicos");return o.jsxs("div",{className:"lp-wrap",children:[o.jsx("h2",{className:"lp-h2",children:"Configuracin  Lista de precios"}),o.jsxs("div",{className:"lp-tabs",children:[o.jsx("button",{className:`lp-pill ${t==="clinicos"?"active":""}`,onClick:()=>e("clinicos"),children:"Lista de precios clnicos"}),o.jsx("button",{className:`lp-pill ${t==="productos"?"active":""}`,onClick:()=>e("productos"),children:"Lista de precios productos"}),o.jsx("button",{className:`lp-pill ${t==="servicios"?"active":""}`,onClick:()=>e("servicios"),children:"Lista de precios servicios"})]}),t==="productos"?o.jsx(OU,{}):t==="servicios"?o.jsx(VU,{}):o.jsx(LU,{})]})}function MU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}const om=[{nombre:"Rehabilitacin Oral",comentario:""},{nombre:"Implantologa",comentario:""},{nombre:"Ciruga Oral",comentario:""},{nombre:"Periodoncia",comentario:""},{nombre:"Endodoncia",comentario:""},{nombre:"Ortodoncia",comentario:""},{nombre:"Odontologa General",comentario:""},{nombre:"Radiologa",comentario:""},{nombre:"Psicologa",comentario:""}],G0=[{codigo:"1",nombre:"Activos"},{codigo:"2",nombre:"Pasivos"},{codigo:"3",nombre:"Patrimonio"},{codigo:"4",nombre:"Ingresos"},{codigo:"5",nombre:"Gastos"},{codigo:"6",nombre:"Costos de ventas"},{codigo:"7",nombre:"Costos de produccin"},{codigo:"8",nombre:"Cuentas de orden deudoras"},{codigo:"9",nombre:"Cuentas de orden acreedoras"}],K0=t=>Re(Q,"listas_precios",t),zl=t=>se(Q,"listas_precios",t,"categorias"),Nr=(t,e)=>se(Q,"listas_precios",t,"categorias",e,"items");function FU(){w.useEffect(()=>{var r;const t="lp-edit-inline";(r=document.getElementById(t))==null||r.remove();const e=`
      .oc-main-content.lp { padding:16px 20px }
      .oc-section-title { margin-bottom:16px }
      .oc-section-title h2 { margin:0; font-weight:800; font-size:20px; color:#0f172a }
      .card { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.04) }
      .toolbar { display:flex; gap:8px; align-items:center; }

      .chip { height:34px; padding:0 12px; border-radius:999px; border:1px solid #e5e7eb; cursor:pointer; font-weight:600; background:#f9fafb; transition:.15s }
      .chip:hover { background:#e5e7eb }
      .chip.blue   { background:#3b82f6; color:#fff; border:none }
      .chip.green  { background:#22c55e; color:#fff; border:none }
      .chip.orange { background:#f59e0b; color:#fff; border:none }
      .chip.gray   { background:#64748b; color:#fff; border:none }

      .name-row { display:flex; align-items:center; gap:8px; }
      .text-inp { height:38px; padding:0 10px; border-radius:8px; border:1px solid #cbd5e1; outline:none; width:280px }

      .table-responsive { width:100%; overflow-x:auto }
      table { width:100%; border-collapse:collapse; font-size:.9rem }
      thead tr { background:#f1f5f9 }
      th, td { padding:10px 12px; white-space:nowrap; vertical-align:middle }
      th { text-align:left; border-bottom:1px solid #e2e8f0; color:#475569; font-weight:700 }
      tr + tr { border-top:1px solid #e2e8f0 }
      .muted { color:#64748b }
      .status-pill { padding:2px 8px; border-radius:999px; font-weight:600 }
      .status-on { background:#dcfce7; color:#166534 }
      .status-off{ background:#fee2e2; color:#991b1b }

      .btn { padding:4px 8px; border:none; border-radius:6px; color:#fff; cursor:pointer; margin-right:6px; font-weight:600; transition:.12s }
      .btn:hover { opacity:.9 }
      .btn.blue   { background:#3b82f6 }
      .btn.green  { background:#22c55e }
      .btn.orange { background:#f59e0b }
      .btn.red    { background:#ef4444 }
      .btn.sky    { background:#06b6d4 }
      .btn.sm { height:32px; padding:0 10px; border-radius:8px }

      .toggle-cell{width:34px}
      .arrow{font-weight:900;font-size:18px;opacity:.7;cursor:pointer;display:inline-block}
      .row-cat-actions{display:flex;gap:6px;justify-content:flex-end}

      .cat-details{background:#fafafa}
      .inner-table{width:100%; border-collapse:collapse; font-size:.88rem}
      .inner-table th, .inner-table td{padding:8px 10px}
      .inner-table thead tr{background:#f8fafc}
      .inner-actions{display:flex;gap:6px;justify-content:flex-end}
      .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

      /* Modal base */
      .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:999}
      .modal{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(880px,94vw);padding:0;border:1px solid #e5e7eb}
      .modal .hd{padding:12px 16px;border-bottom:1px solid #e5e7eb;font-weight:700}
      .modal .bd{padding:16px}
      .modal .ft{padding:12px 16px;border-top:1px solid #e5e7eb;display:flex;gap:8px;justify-content:flex-end}

      /*  Grilla de 3 columnas con field (label arriba, input abajo)  */
      .form-grid-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; align-items:start; }
      .field{ display:flex; flex-direction:column; gap:6px }
      .field label{ font-weight:700; color:#0f172a }

      .form-row-full{ margin-top:12px }

      .inp{height:36px;border:1px solid #cbd5e1;border-radius:8px;padding:0 10px;outline:none;width:100%}
      .ta{border:1px solid #cbd5e1;border-radius:8px;padding:8px;min-height:84px;outline:none;width:100%}

      /* Toggle simple / pill */
      .toggle{display:inline-flex;align-items:center;gap:10px}
      .toggle-pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #cbd5e1;border-radius:999px;padding:2px 8px;height:32px}
      .toggle-pill span{font-weight:700}

      /* Autocomplete */
      .ac-wrap{position:relative}
      .ac-list{
        position:absolute; z-index:1000; top:100%; left:0; right:0;
        background:#fff; border:1px solid #e5e7eb; border-radius:10px;
        box-shadow:0 8px 30px rgba(0,0,0,.12);
        max-height:240px; overflow:auto; margin-top:4px;
      }
      .ac-item{padding:8px 12px; cursor:pointer; display:flex; gap:8px; align-items:center}
      .ac-item:hover{background:#f1f5f9}
      .ac-code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-weight:700; color:#0f172a}
      .ac-name{color:#334155}
      .ac-empty{padding:10px 12px; color:#64748b}

      /*  Selector % | $ para Mximo descuento  */
      .seg-wrap{ display:flex; align-items:center; gap:8px; }
      .seg{ user-select:none; cursor:pointer; border:1px solid #cbd5e1; border-radius:8px; height:36px; min-width:44px; display:flex; align-items:center; justify-content:center; padding:0 10px; font-weight:700; color:#334155; background:#fff; }
      .seg.on{ background:#0ea5e9; color:#fff; border-color:#0ea5e9; }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}const ps=(t="")=>t==null?void 0:t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function ra(t){let e=String(t||"").replace(/\D/g,"");return e===""?"":(e=e.replace(/^0+(?=\d)/,""),e.replace(/\B(?=(\d{3})+(?!\d))/g,"."))}function am({value:t,onChange:e,placeholder:n,suggestions:r=[],getLabel:s=c=>(c==null?void 0:c.nombre)||"",onPick:i,renderRow:a,minChars:l=1}){const[c,d]=w.useState(!1),f=w.useRef(null);w.useEffect(()=>{function p(x){f.current&&!f.current.contains(x.target)&&d(!1)}return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const h=c&&((t==null?void 0:t.length)||0)>=l;return o.jsxs("div",{className:"ac-wrap",ref:f,children:[o.jsx("input",{className:"inp",value:t,placeholder:n,onChange:p=>{e(p.target.value),d(!0)},onFocus:()=>d(!0)}),h&&o.jsx("div",{className:"ac-list",children:r.length===0?o.jsx("div",{className:"ac-empty",children:"Sin resultados"}):r.map((p,x)=>o.jsx("div",{className:"ac-item",onClick:()=>{i==null||i(p),d(!1)},children:a?a(p):o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",children:p.codigo}),o.jsx("span",{className:"ac-name",children:s(p)})]})},x))})]})}function UU(t){FU();const e=QP(),n=(t==null?void 0:t.listaId)??e.id??e.listaId??e.priceListId??e.listId??null,{pathname:r}=Bn(),s=cs(),a=`${w.useMemo(()=>MU(r),[r])}/config/lista-de-precios`,[l,c]=w.useState(""),[d,f]=w.useState(!1),[h,p]=w.useState([]),[x,T]=w.useState(!0),[C,N]=w.useState(""),[_,E]=w.useState(!1),[S,I]=w.useState(!1),[L,V]=w.useState(!1),[g,v]=w.useState(null),[b,P]=w.useState("create"),[R,O]=w.useState(null),k={codigo:"",nombre:"",precio:"",observaciones:"",usa_pago_fijo:!1,pago_valor_fijo:"0",permite_descuento:!1,genera_rips:!1,es_consulta:!1,ver_en_agenda:!1,cuenta_contable:"",max_descuento_tipo:"pct",max_descuento_value:""},[M,z]=w.useState(k),[ve,we]=w.useState([]),[ee]=w.useState(G0),[te,ne]=w.useState(0),[me,Ne]=w.useState("none"),[ke,He]=w.useState("existentes"),[st,De]=w.useState([]),[We,Ge]=w.useState(""),[_t,W]=w.useState("");w.useEffect(()=>{async function D(){if(!n){N("Ruta invlida: falta el id de la lista."),T(!1);return}T(!0);try{const F=await Po(K0(n));c(F.exists()&&F.data().nombre||"")}catch{c(""),N("No se pudo cargar la lista. Revisa la ruta y permisos.")}try{const re=(await Se(zl(n))).docs.map(ue=>({id:ue.id,expanded:!1,itemsLoaded:!1,items:[],activa:ue.data().activa??!0,...ue.data()}));re.sort((ue,Ae)=>(ue.nombre||"").localeCompare(Ae.nombre||"")),p(re)}finally{T(!1)}}D()},[n]),w.useEffect(()=>{async function D(){try{const re=(await Se(se(Q,"catalogo_procedimientos"))).docs.map(ue=>({id:ue.id,...ue.data()})).filter(ue=>ue.codigo&&ue.nombre);we(re)}catch{we([])}}D()},[]);async function fe(){try{if(!n)return;f(!0),await $t(K0(n),{nombre:(l||"").trim(),actualizado:new Date().toLocaleString("es-CO")})}catch{alert("No se pudo actualizar el nombre.")}finally{f(!1)}}async function ye(D){if(p(F=>F.map(re=>re.id===D.id?{...re,expanded:!re.expanded}:re)),!D.itemsLoaded&&n){const F=await Se(Nr(n,D.id)).catch(()=>null),re=F?F.docs.map(ue=>({id:ue.id,...ue.data()})):[];p(ue=>ue.map(Ae=>Ae.id===D.id?{...Ae,items:re,itemsLoaded:!0}:Ae))}}async function J(D){if(!n)return;const F=(prompt("Editar nombre de la categora:",D.nombre)||"").trim();if(!F)return;const re=(prompt("Comentario (opcional):",D.comentario||"")||"").trim();await $t(Re(zl(n),D.id),{nombre:F,comentario:re}),p(ue=>ue.map(Ae=>Ae.id===D.id?{...Ae,nombre:F,comentario:re}:Ae))}async function Z(D){if(!n||!confirm(`Eliminar categora "${D.nombre}" y TODOS sus tems?`))return;const F=await Se(Nr(n,D.id)).catch(()=>null);F&&await Promise.all(F.docs.map(re=>An(Re(Nr(n,D.id),re.id)))),await An(Re(zl(n),D.id)),p(re=>re.filter(ue=>ue.id!==D.id))}async function Ie(D){if(!n)return;const F=prompt("Ajuste porcentual (ej.: 5 para +5%, -10 para -10%)","5");if(F==null)return;const re=Number(F);if(Number.isNaN(re))return alert("Valor invlido.");const ue=await Se(Nr(n,D.id)).catch(()=>null);ue&&(await Promise.all(ue.docs.map(async Ae=>{const Pe=Ae.data()||{},$e=Math.round(Number(Pe.precio||0)*(1+re/100));await $t(Re(Nr(n,D.id),Ae.id),{precio:$e,actualizado:new Date().toLocaleString("es-CO")})})),p(Ae=>Ae.map(Pe=>Pe.id===D.id?{...Pe,items:Pe.items.map($e=>({...$e,precio:Math.round(Number($e.precio||0)*(1+re/100))}))}:Pe)),alert("Precios actualizados."))}function ge(D){v(D),P("create"),O(null),z(k),V(!0)}function Y(D,F){v(D),P("edit"),O(F.id);const re=Number(F.max_descuento_pct??F.max_desc_pct??0),ue=Number(F.max_descuento_valor??F.max_desc_valor??0);let Ae="pct",Pe="";ue>0?(Ae="valor",Pe=String(ue)):re>0&&(Ae="pct",Pe=String(re)),z({codigo:F.codigo||"",nombre:F.nombre||"",precio:ra(F.precio||0),observaciones:F.comentario||"",usa_pago_fijo:!!F.usa_pago_fijo,pago_valor_fijo:String(F.pago_valor_fijo??"0"),permite_descuento:!!(F.permite_descuento??F.permite_desc??!1),genera_rips:!!F.genera_rips,es_consulta:!!F.es_consulta,ver_en_agenda:!!F.ver_en_agenda,cuenta_contable:F.cuenta_contable||"",max_descuento_tipo:Ae,max_descuento_value:Ae==="valor"?ra(Pe):Pe}),V(!0)}async function X(){if(!n||!g)return;if(!M.nombre.trim())return alert("El nombre es obligatorio.");const D=Ae=>Number(String(Ae).replace(/\D/g,""))||0;let F=0,re=0;M.permite_descuento&&(M.max_descuento_tipo==="pct"?F=Math.max(0,Number(String(M.max_descuento_value).replace(",",".")||0)):re=D(M.max_descuento_value));const ue={codigo:M.codigo.trim(),nombre:M.nombre.trim(),permite_descuento:!!M.permite_descuento,max_descuento_pct:F,max_descuento_valor:re,permite_desc:!!M.permite_descuento,max_desc_pct:F,max_desc_valor:re,genera_rips:!!M.genera_rips,es_consulta:!!M.es_consulta,ver_en_agenda:!!M.ver_en_agenda,cuenta_contable:M.cuenta_contable.trim(),comentario:M.observaciones.trim(),precio:D(M.precio),usa_pago_fijo:!!M.usa_pago_fijo,pago_valor_fijo:D(M.pago_valor_fijo),actualizado:new Date().toLocaleString("es-CO")};if(b==="create"){const Ae=await zt(Nr(n,g.id),{...ue,creado:new Date().toLocaleString("es-CO")});p(Pe=>Pe.map($e=>$e.id===g.id?{...$e,items:[...$e.items,{id:Ae.id,...ue}],expanded:!0}:$e))}else await $t(Re(Nr(n,g.id),R),ue),p(Ae=>Ae.map(Pe=>Pe.id===g.id?{...Pe,items:Pe.items.map($e=>$e.id===R?{...$e,...ue,id:R}:$e)}:Pe));V(!1)}async function B(D,F){n&&confirm(`Eliminar "${F.nombre}"?`)&&(await An(Re(Nr(n,D.id),F.id)),p(re=>re.map(ue=>ue.id===D.id?{...ue,items:ue.items.filter(Ae=>Ae.id!==F.id)}:ue)))}async function pe(){try{const D=se(Q,"catalogo_categorias");for(const F of om){const re=`${F.nombre}`.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-");await Ro(Re(D,re),{nombre:F.nombre,comentario:F.comentario||""},{merge:!0})}alert("Catlogo base creado/actualizado. Vuelve a abrir 'Categoras existentes'.")}catch{alert("No se pudo sembrar el catlogo base.")}}async function Ve(){I(!0),He("existentes"),Ge(""),W("");try{const F=(await Se(se(Q,"catalogo_categorias"))).docs.map(re=>({id:re.id,...re.data()}));De(F.length?F:om.map((re,ue)=>({id:`def-${ue}`,...re})))}catch{De(om.map((D,F)=>({id:`def-${F}`,...D})))}}async function Be(D){if(n)try{const F=zl(n);await zt(F,{nombre:D.nombre,comentario:D.comentario||"",activa:!0,creado:new Date().toLocaleString("es-CO")});const re=await Se(F);p(re.docs.map(ue=>({id:ue.id,...ue.data(),activa:ue.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),alert("Categora agregada.")}catch{alert("No se pudo agregar la categora.")}}async function Me(){if(n){if(!We.trim())return alert("Escribe el nombre de la categora.");try{const D=zl(n);await zt(D,{nombre:We.trim(),comentario:_t.trim(),activa:!0,creado:new Date().toLocaleString("es-CO")});const F=await Se(D);p(F.docs.map(re=>({id:re.id,...re.data(),activa:re.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),I(!1)}catch{alert("No se pudo crear la categora.")}}}function Ke(){return new Promise(D=>{if(typeof window<"u"&&window.XLSX)return D(window.XLSX);const F=document.createElement("script");F.src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js",F.onload=()=>D(window.XLSX||null),F.onerror=()=>D(null),document.head.appendChild(F)})}function xe(D,F){return F==="up"?Math.ceil(D):F==="down"?Math.floor(D):D}async function lt(){if(!n)return;const D=Number(te);if(!Number.isFinite(D))return alert("Ingresa un porcentaje vlido.");try{for(const F of h){const re=await Se(Nr(n,F.id)).catch(()=>null);if(re)for(const ue of re.docs){const Ae=ue.data()||{},Pe=xe(Number(Ae.precio||0)*(1+D/100),me);await $t(Re(Nr(n,F.id),ue.id),{precio:Pe,actualizado:new Date().toLocaleString("es-CO")})}}alert("Precios actualizados."),E(!1)}catch{alert("No se pudo aplicar el incremento.")}}async function Ze(){try{if(!n)return;const D=["Categora","Cdigo","Nombre","Permite desc","Precio","Genera RIPS","Es consulta","Ver en agenda","Nombre en la agenda","Tiempo","Identificador","Cuenta contable"],F=[],re=`OdontoCloud  Lista de precios  ${l||"Principal"}`,ue=`Exportado: ${new Date().toLocaleString("es-CO")}`;F.push([re]),F.push([ue]),F.push([]),F.push(D);const Ae=4,Pe=rt=>rt?"si":"no";for(const rt of h){const dt=await Se(Nr(n,rt.id)).catch(()=>null),Vt=dt?dt.docs.map(Qe=>({id:Qe.id,...Qe.data()})):[];for(const Qe of Vt)F.push([rt.nombre||"",Qe.codigo||"",Qe.nombre||"",Pe(!!(Qe.permite_descuento??Qe.permite_desc)),Number(Qe.precio||0),Pe(!!Qe.genera_rips),Pe(!!Qe.es_consulta),Pe(!!Qe.ver_en_agenda),Qe.nombre_en_agenda||"",Number(Qe.tiempo||0),Qe.identificador||"",Qe.cuenta_contable||""])}const $e=await Ke(),Fe=`OdontoCloud-ListaPrecios-${l||"Principal"}`;if($e&&$e.utils&&F.length>Ae-1){const rt=$e.utils.aoa_to_sheet(F);rt["!cols"]=[{wch:22},{wch:14},{wch:36},{wch:12},{wch:14},{wch:12},{wch:12},{wch:14},{wch:28},{wch:10},{wch:16},{wch:18}],rt["!merges"]=[{s:{r:0,c:0},e:{r:0,c:11}},{s:{r:1,c:0},e:{r:1,c:11}}];const dt=F.length;rt["!autofilter"]={ref:`A${Ae}:L${dt}`};const Vt=$e.utils.book_new();$e.utils.book_append_sheet(Vt,rt,"Lista de precios");const Qe=$e.write(Vt,{bookType:"xlsx",type:"array"}),Jn=new Blob([Qe],{type:"application/octet-stream"}),Wt=document.createElement("a");Wt.href=URL.createObjectURL(Jn),Wt.download=`${Fe}.xlsx`,Wt.click(),URL.revokeObjectURL(Wt.href)}else{const rt=F.map(Qe=>Qe.map(Jn=>{const Wt=String(Jn??"").replace(/"/g,'""');return/[",\n]/.test(Wt)?`"${Wt}"`:Wt}).join(",")).join(`
`),dt=new Blob([rt],{type:"text/csv;charset=utf-8"}),Vt=document.createElement("a");Vt.href=URL.createObjectURL(dt),Vt.download=`${Fe}.csv`,Vt.click(),URL.revokeObjectURL(Vt.href)}}catch{alert("No se pudo exportar.")}}const bt=w.useMemo(()=>{const D=ps(M.nombre);return D?ve.filter(F=>ps(F.nombre).includes(D)||ps(F.codigo).startsWith(D)).slice(0,12):[]},[M.nombre,ve]),q=w.useMemo(()=>{const D=ps(M.codigo);return D?ve.filter(F=>ps(F.codigo).startsWith(D)||ps(F.nombre).includes(D)).slice(0,12):[]},[M.codigo,ve]),ce=w.useMemo(()=>{const D=ps(M.cuenta_contable);return D?ee.filter(F=>ps(F.codigo).startsWith(D)||ps(F.nombre).includes(D)).slice(0,20):G0.slice(0,12)},[M.cuenta_contable,ee]);return o.jsxs("div",{className:"oc-main-content lp",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Edicin Lista de precios"})}),C&&o.jsx("div",{style:{marginBottom:12,padding:"8px 12px",border:"1px solid #fecaca",background:"#fef2f2",color:"#991b1b",borderRadius:8},children:C}),o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"toolbar",style:{justifyContent:"space-between",marginBottom:12},children:[o.jsxs("div",{className:"name-row",children:[o.jsx("label",{style:{fontWeight:700},children:"Nombre*"}),o.jsx("input",{className:"text-inp",value:l,placeholder:"Principal",onChange:D=>c(D.target.value)}),o.jsx("button",{className:"btn green",onClick:fe,disabled:d,title:"Guardar nombre",children:d?"Guardando":"Guardar"})]}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"chip orange",title:"Incrementar %",onClick:()=>{ne(0),Ne("none"),E(!0)},children:"%"}),o.jsx("button",{className:"chip green",onClick:Ve,children:"+ Agregar categora"}),o.jsx("button",{className:"chip blue",title:"Exportar",onClick:Ze,children:"Exportar"})]})]}),o.jsx("div",{className:"table-responsive",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{className:"toggle-cell"}),o.jsx("th",{children:"Categora"}),o.jsx("th",{children:"Comentario"}),o.jsx("th",{style:{width:140},children:"Estado"}),o.jsx("th",{style:{width:360,textAlign:"right"},children:"Acciones"})]})}),o.jsx("tbody",{children:x?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):h.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Sin categoras."})}):h.map(D=>o.jsxs(qh.Fragment,{children:[o.jsxs("tr",{children:[o.jsx("td",{className:"toggle-cell",children:o.jsx("span",{className:"arrow",onClick:()=>ye(D),children:D.expanded?"":""})}),o.jsx("td",{style:{fontWeight:700},children:D.nombre||"Categora"}),o.jsx("td",{className:"muted",children:D.comentario||""}),o.jsx("td",{children:o.jsx("span",{className:`status-pill ${D.activa?"status-on":"status-off"}`,children:D.activa?"Conectado":"Desconectado"})}),o.jsx("td",{style:{textAlign:"right"},children:o.jsxs("div",{className:"row-cat-actions",children:[o.jsx("button",{className:"btn green sm",title:"Nuevo tem",onClick:()=>ge(D),children:""}),o.jsx("button",{className:"btn orange sm",title:"Actualizar precios %",onClick:()=>Ie(D),children:"%"}),o.jsx("button",{className:"btn sky sm",title:"Editar categora",onClick:()=>J(D),children:""}),o.jsx("button",{className:"btn red sm",title:"Eliminar categora",onClick:()=>Z(D),children:""})]})})]}),D.expanded&&o.jsxs("tr",{className:"cat-details",children:[o.jsx("td",{}),o.jsx("td",{colSpan:4,children:o.jsx("div",{className:"table-responsive",children:o.jsxs("table",{className:"inner-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Lista de precios"}),o.jsx("th",{style:{width:160},children:"Permite descuento"}),o.jsx("th",{style:{width:140},children:"Precio"}),o.jsx("th",{style:{width:140,textAlign:"right"},children:"Acciones"})]})}),o.jsx("tbody",{children:!D.items||D.items.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"muted",style:{textAlign:"center",padding:12},children:"Sin tems en esta categora."})}):D.items.map(F=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:F.codigo||""}),o.jsx("td",{style:{fontWeight:600},children:F.nombre||""}),o.jsx("td",{children:F.permite_descuento??F.permite_desc?"S":"No"}),o.jsxs("td",{className:"mono",children:["$",Number(F.precio||0).toLocaleString("es-CO")]}),o.jsx("td",{style:{textAlign:"right"},children:o.jsxs("div",{className:"inner-actions",children:[o.jsx("button",{className:"btn sky sm",onClick:()=>Y(D,F),children:""}),o.jsx("button",{className:"btn red sm",onClick:()=>B(D,F),children:""})]})})]},F.id))})]})})})]})]},D.id))})]})}),o.jsx("div",{style:{marginTop:16},children:o.jsx("button",{className:"chip gray",onClick:()=>s(a),children:" Volver"})})]}),S&&o.jsx("div",{className:"modal-mask",onClick:()=>I(!1),children:o.jsxs("div",{className:"modal",onClick:D=>D.stopPropagation(),children:[o.jsx("div",{className:"hd",children:"Categora"}),o.jsxs("div",{className:"bd",children:[o.jsxs("div",{className:"row",style:{gap:6,marginBottom:12},children:[o.jsx("button",{className:`chip ${ke==="existentes"?"blue":""}`,onClick:()=>He("existentes"),children:"Categoras existentes"}),o.jsx("button",{className:`chip ${ke==="nueva"?"blue":""}`,onClick:()=>He("nueva"),children:"Editar/Nueva categora"}),o.jsx("button",{className:"chip green",onClick:pe,children:"Sembrar catlogo base"})]}),ke==="existentes"?o.jsx("div",{children:st.length===0?o.jsx("p",{className:"muted",children:"No hay catlogo disponible. Puedes crear una nueva categora en la pestaa de la derecha."}):o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Comentario"}),o.jsx("th",{children:"Acciones"})]})}),o.jsx("tbody",{children:st.map(D=>o.jsxs("tr",{children:[o.jsx("td",{children:D.nombre}),o.jsx("td",{className:"muted",children:D.comentario||""}),o.jsx("td",{children:o.jsx("button",{className:"btn green sm",onClick:()=>Be(D),children:"Agregar"})})]},D.id))})]})}):o.jsxs("div",{children:[o.jsxs("div",{className:"row",children:[o.jsx("label",{style:{minWidth:140},children:"Nombre *"}),o.jsx("input",{className:"inp",placeholder:"Ingrese el nombre de la categora",value:We,onChange:D=>Ge(D.target.value)})]}),o.jsxs("div",{className:"row",style:{alignItems:"flex-start"},children:[o.jsx("label",{style:{minWidth:140,paddingTop:6},children:"Comentario"}),o.jsx("textarea",{className:"ta",placeholder:"",value:_t,onChange:D=>W(D.target.value)})]})]})]}),o.jsxs("div",{className:"ft",children:[o.jsx("button",{className:"chip gray",onClick:()=>I(!1),children:"Cerrar"}),ke==="nueva"&&o.jsx("button",{className:"chip green",onClick:Me,children:"Guardar"})]})]})}),_&&o.jsx("div",{className:"modal-mask",onClick:()=>E(!1),children:o.jsxs("div",{className:"modal",onClick:D=>D.stopPropagation(),children:[o.jsx("div",{className:"hd",children:"Incrementar todos los precios"}),o.jsx("div",{className:"bd",children:o.jsxs("div",{className:"col",children:[o.jsx("label",{className:"label-strong",children:"Porcentaje de incremento *"}),o.jsx("div",{className:"row",children:o.jsx("input",{className:"inp",style:{maxWidth:160},type:"number",min:"0",step:"0.01",placeholder:"0",value:te,onChange:D=>ne(D.target.value)})}),o.jsxs("div",{className:"col",style:{gap:8},children:[o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"radio",name:"round",checked:me==="down",onChange:()=>Ne("down")})," Redondear hacia abajo"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"radio",name:"round",checked:me==="up",onChange:()=>Ne("up")})," Redondear hacia arriba"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"radio",name:"round",checked:me==="none",onChange:()=>Ne("none")})," No redondear"]})]})]})}),o.jsxs("div",{className:"ft",children:[o.jsx("button",{className:"chip gray",onClick:()=>E(!1),children:"Cerrar"}),o.jsx("button",{className:"chip green",onClick:lt,children:"Incrementar"})]})]})}),L&&o.jsx("div",{className:"modal-mask",onClick:()=>V(!1),children:o.jsxs("div",{className:"modal",onClick:D=>D.stopPropagation(),children:[o.jsx("div",{className:"hd",children:b==="edit"?o.jsxs(o.Fragment,{children:["Editar producto",g?`  ${g.nombre}`:""]}):o.jsxs(o.Fragment,{children:["Agregar producto",g?`  ${g.nombre}`:""]})}),o.jsxs("div",{className:"bd",children:[o.jsxs("div",{className:"form-grid-3",children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Cdigo *"}),o.jsx(am,{value:M.codigo,onChange:D=>z({...M,codigo:D}),placeholder:"Cdigo (ej. 890203)",suggestions:q,onPick:D=>z({...M,codigo:D.codigo,nombre:D.nombre}),renderRow:D=>o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",children:D.codigo}),o.jsx("span",{className:"ac-name",children:D.nombre})]}),minChars:1})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Nombre *"}),o.jsx(am,{value:M.nombre,onChange:D=>z({...M,nombre:D}),placeholder:"Nombre del procedimiento",suggestions:bt,onPick:D=>z({...M,codigo:D.codigo,nombre:D.nombre}),renderRow:D=>o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",children:D.codigo}),o.jsx("span",{className:"ac-name",children:D.nombre})]}),minChars:1})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Precio *"}),o.jsx("input",{className:"inp",type:"text",inputMode:"numeric",pattern:"\\\\d*",placeholder:"$0",value:M.precio,onChange:D=>z({...M,precio:ra(D.target.value)})})]})]}),o.jsx("div",{className:"form-row-full",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Observaciones"}),o.jsx("textarea",{className:"ta",value:M.observaciones,onChange:D=>z({...M,observaciones:D.target.value})})]})}),o.jsxs("div",{className:"form-row-full",style:{display:"grid",gridTemplateColumns:"160px auto auto",gap:"12px",alignItems:"center"},children:[o.jsxs("div",{className:"field",style:{margin:0},children:[o.jsx("label",{children:"Pago valor fijo a doctores"}),o.jsx("input",{className:"inp",type:"number",min:"0",value:M.pago_valor_fijo,onChange:D=>z({...M,pago_valor_fijo:D.target.value})})]}),o.jsxs("label",{className:"toggle",style:{marginTop:18},children:[o.jsx("input",{type:"checkbox",checked:M.usa_pago_fijo,onChange:D=>z({...M,usa_pago_fijo:D.target.checked})}),"Usar valor fijo"]}),o.jsx("div",{className:"muted",children:"Use este campo para no liquidar a los doctores por su % configurado sino por un valor fijo en dinero $"})]}),o.jsxs("div",{className:"form-row-full",style:{display:"flex",gap:18,flexWrap:"wrap"},children:[o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"checkbox",checked:M.permite_descuento,onChange:D=>z({...M,permite_descuento:D.target.checked,...D.target.checked?{}:{max_descuento_value:""}})}),"Permite descuento"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"checkbox",checked:M.genera_rips,onChange:D=>z({...M,genera_rips:D.target.checked})}),"Genera RIPS"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"checkbox",checked:M.es_consulta,onChange:D=>z({...M,es_consulta:D.target.checked})}),"Es consulta"]}),o.jsxs("div",{className:"toggle",children:[o.jsx("span",{children:"Ver en agenda"}),o.jsxs("label",{className:"toggle-pill",children:[o.jsx("input",{type:"checkbox",checked:M.ver_en_agenda,onChange:D=>z({...M,ver_en_agenda:D.target.checked})}),o.jsx("span",{children:M.ver_en_agenda?"S":"No"})]})]})]}),M.permite_descuento&&o.jsx("div",{className:"form-row-full",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Mximo descuento"}),o.jsxs("div",{className:"seg-wrap",children:[o.jsx("div",{className:`seg ${M.max_descuento_tipo==="pct"?"on":""}`,onClick:()=>z({...M,max_descuento_tipo:"pct",max_descuento_value:String(M.max_descuento_value).replace(/\D+/g,"")}),title:"Porcentaje",children:"%"}),o.jsx("div",{className:`seg ${M.max_descuento_tipo==="valor"?"on":""}`,onClick:()=>z({...M,max_descuento_tipo:"valor",max_descuento_value:ra(M.max_descuento_value)}),title:"Valor en $",children:"$"}),M.max_descuento_tipo==="pct"?o.jsx("input",{className:"inp",type:"number",min:"0",step:"0.01",placeholder:"0",value:String(M.max_descuento_value).replace(/[^\d.,-]/g,""),onChange:D=>z({...M,max_descuento_value:D.target.value})}):o.jsx("input",{className:"inp",type:"text",inputMode:"numeric",placeholder:"$0",value:ra(M.max_descuento_value),onChange:D=>z({...M,max_descuento_value:ra(D.target.value)})})]})]})}),o.jsx("div",{className:"form-row-full",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Cuenta contable"}),o.jsx(am,{value:M.cuenta_contable,onChange:D=>z({...M,cuenta_contable:D}),placeholder:"Buscar tem...",suggestions:ce,onPick:D=>z({...M,cuenta_contable:`${D.codigo}  ${D.nombre}`}),renderRow:D=>o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",style:{minWidth:72},children:D.codigo}),o.jsx("span",{className:"ac-name",children:D.nombre})]}),minChars:0})]})})]}),o.jsxs("div",{className:"ft",children:[o.jsx("button",{className:"chip gray",onClick:()=>V(!1),children:"Cerrar"}),o.jsx("button",{className:"chip green",onClick:X,children:b==="edit"?"Actualizar":"Guardar"})]})]})})]})}const ql="listas_precios_productos";function $U(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function BU(){const[t,e]=w.useState(!0),[n,r]=w.useState([]),{pathname:s}=Bn(),i=cs(),a=w.useMemo(()=>$U(s),[s]),l=h=>i(`${a}/config/lista-de-precios/productos/editar/${h.id}`);w.useEffect(()=>{async function h(){e(!0);try{const x=(await Se(se(Q,ql))).docs.map(T=>({id:T.id,...T.data()}));x.sort((T,C)=>{const N=T.actualizado||T.creado||"",_=C.actualizado||C.creado||"";return N&&_?String(_).localeCompare(String(N)):((T==null?void 0:T.nombre)||"").localeCompare((C==null?void 0:C.nombre)||"")}),r(x)}catch(p){console.error("[LP Productos] cargar:",p==null?void 0:p.code,p==null?void 0:p.message),r([])}finally{e(!1)}}h()},[]);async function c(){try{const p={nombre:`Lista de productos ${new Date().toLocaleDateString("es-CO")}`,creado:new Date().toLocaleString("es-CO"),actualizado:new Date().toLocaleString("es-CO"),en_uso:!1,tipo:"productos"},x=await zt(se(Q,ql),p);r(T=>[{id:x.id,...p},...T])}catch(h){console.error(h),alert("No se pudo crear el listado de productos.")}}async function d(h){try{const x=(await Se(se(Q,ql))).docs.map(T=>$t(Re(Q,ql,T.id),{en_uso:T.id===h.id}));await Promise.all(x),r(T=>T.map(C=>({...C,en_uso:C.id===h.id})))}catch(p){console.error(p),alert("No se pudo cambiar el estado de uso.")}}async function f(h){if(window.confirm(`Eliminar "${h==null?void 0:h.nombre}"?`))try{await An(Re(Q,ql,h.id)),r(p=>p.filter(x=>x.id!==h.id))}catch(p){console.error(p),alert("No se pudo eliminar.")}}return o.jsxs("div",{className:"lp-card",children:[o.jsxs("div",{className:"lp-tabs",style:{justifyContent:"space-between"},children:[o.jsx("div",{style:{display:"flex",gap:8},children:o.jsx("span",{className:"lp-pill active",children:"Lista de precios productos"})}),o.jsx("button",{className:"btn blue",onClick:c,children:"+ Nuevo listado de productos"})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Fecha de creacin"}),o.jsx("th",{children:"Fecha de actualizacin"}),o.jsx("th",{children:"En uso"}),o.jsx("th",{children:"Acciones"})]})}),o.jsx("tbody",{children:t?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):n.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:o.jsx("span",{className:"muted",children:"Sin datos"})})}):n.map(h=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:700},children:(h==null?void 0:h.nombre)||""}),o.jsx("td",{children:(h==null?void 0:h.creado)||""}),o.jsx("td",{children:(h==null?void 0:h.actualizado)||""}),o.jsx("td",{style:{color:h!=null&&h.en_uso?"#16a34a":"#64748b"},children:h!=null&&h.en_uso?"En uso":""}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"btn blue",onClick:()=>l(h),children:"Editar"}),o.jsx("button",{className:"btn green",onClick:()=>d(h),children:"Usar"}),o.jsx("button",{className:"btn red",onClick:()=>f(h),children:"Eliminar"})]})})]},h.id))})]})})]})}function zU(){const[t,e]=w.useState(null),[n,r]=w.useState([]),[s,i]=w.useState(!1),[a,l]=w.useState(0),[c,d]=w.useState(0),f=p=>r(x=>[...x,p]);async function h(){if(!t)return alert("Selecciona el CSV primero.");i(!0),l(0),d(0),r([]);try{const x=(await t.text()).split(/\r?\n/).filter(Boolean),T=x.shift()||"";if(!/codigo\s*;\s*nombre/i.test(T)){f('Encabezado invlido. Usa: "codigo;nombre" o "codigo;nombre;categoria" (separado por ;)'),i(!1);return}const C=250;for(let N=0;N<x.length;N+=C){const _=x.slice(N,N+C);await Promise.all(_.map(async E=>{const S=E.split(";"),I=(S[0]||"").trim().replace(/\./g,""),L=(S[1]||"").trim().replace(/^"|"$/g,""),V=(S[2]||"").trim();if(!I||!L){d(g=>g+1);return}try{await Ro(Re(Q,"catalogo_procedimientos",I),{codigo:I,nombre:L,...V?{categoria:V}:{},area:"Odontologa",activo:!0,fuente:"CUPS",version:"2024",updatedAt:new Date().toISOString()},{merge:!0}),l(g=>g+1)}catch(g){d(v=>v+1),f(`Error ${I}: ${(g==null?void 0:g.message)||g}`)}})),f(`Cargado ${Math.min(N+C,x.length)} / ${x.length}`)}f(" Importacin finalizada.")}catch(p){f(` Error: ${(p==null?void 0:p.message)||p}`)}finally{i(!1)}}return o.jsxs("div",{style:{maxWidth:760,margin:"24px auto",background:"#fff",padding:16,borderRadius:12,border:"1px solid #e5e7eb"},children:[o.jsx("h2",{style:{marginTop:0},children:"Importar procedimientos (Odontologa  CUPS 2024)"}),o.jsxs("p",{children:["Sube tu CSV con columnas ",o.jsx("b",{children:"codigo;nombre"})," o ",o.jsx("b",{children:"codigo;nombre;categoria"})," (punto y coma)."]}),o.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[o.jsx("input",{type:"file",accept:".csv",onChange:p=>{var x;return e(((x=p.target.files)==null?void 0:x[0])||null)}}),o.jsx("button",{disabled:!t||s,onClick:h,style:{padding:"8px 12px",borderRadius:8,background:"#22c55e",color:"#fff",border:"none",fontWeight:700},children:s?"Cargando...":"Cargar"})]}),o.jsxs("div",{style:{marginTop:12,display:"flex",gap:12},children:[o.jsxs("span",{children:[" OK: ",a]}),o.jsxs("span",{children:[" Fallidos: ",c]}),s&&o.jsx("span",{children:" Procesando"})]}),o.jsx("pre",{style:{background:"#f8fafc",padding:12,borderRadius:8,marginTop:12,maxHeight:260,overflow:"auto",fontSize:12},children:n.join(`
`)})]})}const on={listas_precios:"listas_precios",listas_precios_productos:"listas_precios_productos",catalogo_procedimientos:"catalogo_procedimientos",catalogo_categorias:"catalogo_categorias"},wn={precio:["precio","valor","price","monto","precioCompra","precio_venta","precioVenta"],nombre:["nombre","descripcion","descripcin","name"],codigo:["codigo","cdigo","code","referencia"],categoria:["categoria","categoriaNombre","grupo","area"],max_desc_pct:["max_desc_pct","max_descuento_pct"],max_desc_valor:["max_desc_valor","max_descuento_valor"],permite_desc:["permite_desc","permite_descuento"],genera_rips:["genera_rips"],es_consulta:["es_consulta"],ver_en_agenda:["ver_en_agenda"]},qg=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),Is=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),Rr=(t,e,n)=>Math.min(n,Math.max(e,Number.isFinite(+t)?+t:e)),vt=(t,e=0)=>{const n=Number(String(t??"").replace(/[^\d-]+/g,""));return Number.isFinite(n)?n:e},qU=t=>typeof t=="number"?t:Number(String(t??"").replace(/[^\d-]+/g,""))||0,T1=(t,e)=>{const n=Is(t),r=Is(e);return!n||!r?!1:n===r||n.includes(r)||r.includes(n)};function En(t,e,n=void 0){for(const r of e)if((t==null?void 0:t[r])!==void 0&&t[r]!==null)return t[r];return n}function HU(){w.useEffect(()=>{const t="oc-planes-styles-v4";if(document.getElementById(t))return;const e=`
      :root{
        --oc-primary:#3b82f6; --oc-primary-600:#2563eb;
        --oc-green:#22c55e; --oc-green-600:#16a34a;
        --oc-red:#ef4444; --oc-red-600:#dc2626;
        --oc-gray:#e5e7eb; --oc-muted:#64748b;
      }
      .oc-muted{color:var(--oc-muted)} .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
      .oc-input,.oc-select{height:34px;border:1px solid #d6dbe6;border-radius:8px;background:#fff;padding:0 10px;font-size:14px}
      .oc-input:focus,.oc-select:focus{outline:none;border-color:#60a5fa;box-shadow:0 0 0 2px rgba(96,165,250,.15)}
      .oc-btn{display:inline-flex;align-items:center;justify-content:center;height:30px;padding:0 10px;border-radius:8px;border:1px solid var(--oc-gray);background:#fff;color:#0f172a;font-weight:700;font-size:12px;cursor:pointer;transition:.15s}
      .oc-btn:hover{background:#f8fafc} .oc-btn.small{height:26px;padding:0 8px}
      .oc-btn.primary{background:var(--oc-primary);border-color:var(--oc-primary-600);color:#fff}
      .oc-btn.primary:hover{background:var(--oc-primary-600)}
      .oc-btn.success{background:var(--oc-green);border-color:var(--oc-green-600);color:#fff}
      .oc-btn.success:hover{background:var(--oc-green-600)}
      .oc-btn.danger{background:var(--oc-red);border-color:var(--oc-red-600);color:#fff}
      .oc-btn.danger:hover{background:var(--oc-red-600)}
      .oc-btn.outline{background:#fff;color:var(--oc-primary);border-color:var(--oc-primary)}
      .oc-btn.outline:hover{background:#eff6ff}
      .oc-tbl{width:100%;border-collapse:separate;border-spacing:0;border:1px solid #e6e9ef;border-radius:10px;overflow:hidden}
      .oc-tbl thead th{background:#f8fafc;text-align:left;padding:8px 10px;border-bottom:1px solid #e6e9ef;font-weight:700}
      .oc-tbl tbody td{padding:8px 10px;border-bottom:1px solid #f0f3f8}
      .oc-tbl tbody tr:last-child td{border-bottom:0}
      .oc-mask{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:999999;display:flex;align-items:center;justify-content:center}
      .oc-modal{width:min(1200px,96vw);max-height:92vh;background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 22px 60px rgba(0,0,0,.28);display:flex;flex-direction:column}
      .oc-modal-h,.oc-modal-f{padding:10px 12px;border-bottom:1px solid #eef2f7;display:flex;align-items:center;justify-content:space-between}
      .oc-modal-f{border-top:1px solid #eef2f7;border-bottom:0;gap:8;justify-content:flex-end}
      .oc-modal-t{padding:10px 12px;border-bottom:1px solid #eef2f7;display:grid;grid-template-columns:minmax(180px,260px) 1fr minmax(120px,160px) auto;gap:8px;align-items:center}
      .oc-modal-b{padding:12px;overflow:auto}
      .oc-sug{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #e5e7eb;border-radius:10px;margin-top:4px;max-height:260px;overflow:auto;box-shadow:0 12px 28px rgba(0,0,0,.15);z-index:99}
      .oc-sug-item{padding:8px 10px;display:flex;justify-content:space-between;gap:10px;cursor:pointer}
      .oc-sug-item:hover,.oc-sug-item.is-active{background:#eff6ff}
    `,n=document.createElement("style");n.id=t,n.textContent=e,document.head.appendChild(n)},[])}const WU={"Ciruga Oral":["cirugia","quirurg","exodon","alveolo","fenestr","colgajo","apicect"],Endodoncia:["endodon","conducto","pulpar","apex","biopul","necros"],Implantologa:["implante","implanto","pilar","injerto","osteointeg"],"Odontologa General":["profilaxis","resina","amalgama","sellante","consulta","control"],Ortodoncia:["ortodon","bracket","alinead","arco","retencion"],Periodoncia:["periodon","curet","raspaje","aliser","flap"],Psicologa:["psicol","terap","sesion"],Radiologa:["radio","rx","radiogr","periap","panoram","cefalo"],"Rehabilitacin Oral":["rehabil","corona","puente","carilla","incrusta","protes"]},GU=t=>Is(t).replace(/[^a-z0-9 ]/gi," ").split(/\s+/).filter(Boolean),KU=(t="",e="",n=WU)=>{const r=n[e]||[];if(!r.length)return"";const s=GU(t);return r.some(i=>s.some(a=>a.includes(i)))?e:""},QU=(t="",e="",n="",r=[])=>{const s=(t||"").toString();if(r&&r.length&&n){const a=r.find(l=>T1(l.nombre,n));if(a&&Array.isArray(a.prefijos)&&a.prefijos.some(l=>l&&s.startsWith((l||"").replace(/\./g,""))))return a.nombre}const i=KU(e,n);return i||""};function Ud(t,e,n=""){const r=(En(e,wn.codigo,t.id)||"").toString().trim(),s=(En(e,wn.nombre,r)||"").toString().trim(),i=qU(En(e,wn.precio,0));let a=(En(e,wn.categoria,n)||"").toString().trim();return a||(a="Sin categora"),{id:t.id,codigo:r,nombre:s,precio:i,categoria:a,max_desc_pct:Number(En(e,wn.max_desc_pct,0))||0,max_desc_valor:Number(En(e,wn.max_desc_valor,0))||0,permite_desc:!!En(e,wn.permite_desc,!0),genera_rips:!!En(e,wn.genera_rips,!1),es_consulta:!!En(e,wn.es_consulta,!1),ver_en_agenda:!!En(e,wn.ver_en_agenda,!1),_norm:Is(`${r} ${s} ${a}`)}}async function YU(t){var e;try{const n=await Se(se(Q,on.listas_precios,t,"categorias")).catch(()=>null);if(!n||n.empty)return[];const r=[];for(const s of n.docs){const i=(((e=s.data())==null?void 0:e.nombre)||"").toString().trim();let a=await Se(se(Q,on.listas_precios,t,"categorias",s.id,"items")).catch(()=>null);(!a||a.empty)&&(a=await Se(se(Q,on.listas_precios,t,"categorias",s.id,"procedimientos")).catch(()=>null)),!(!a||a.empty)&&a.forEach(l=>r.push(Ud(l,l.data()||{},i)))}return r}catch{return[]}}function XU({listaId:t,onClose:e,onLoadLines:n}){const[r,s]=w.useState(["*"]),[i,a]=w.useState("*"),[l,c]=w.useState(""),[d,f]=w.useState(1),[h,p]=w.useState([]),[x,T]=w.useState(!1),[C,N]=w.useState(!1),_=w.useRef(null),[E,S]=w.useState([]),[I,L]=w.useState([]),V=["*","Ciruga Oral","Endodoncia","Implantologa","Odontologa General","Ortodoncia","Periodoncia","Psicologa","Radiologa","Rehabilitacin Oral"],g=async()=>{const z={listaId:t||"(vaco)",fuentes:[]};let ve=0,we=[];if(t){const De=await Se(se(Q,on.listas_precios,t,"categorias")).catch(()=>null);if(De&&!De.empty)for(const We of De.docs){let Ge=await Se(se(Q,on.listas_precios,t,"categorias",We.id,"items")).catch(()=>null);(!Ge||Ge.empty)&&(Ge=await Se(se(Q,on.listas_precios,t,"categorias",We.id,"procedimientos")).catch(()=>null)),Ge&&!Ge.empty&&(ve+=Ge.size,Ge.docs.slice(0,3).forEach(_t=>{const W=_t.data()||{};we.push((En(W,wn.codigo,_t.id)||_t.id)+"")}))}}z.fuentes.push({ruta:"listas_precios/{listaId}/categorias/*/(items|procedimientos)",total:ve,sample:we.slice(0,3)});let ee=0,te=[];if(t){const De=await Se(se(Q,on.listas_precios,t,"items")).catch(()=>null);De&&!De.empty&&(ee=De.size,De.docs.slice(0,3).forEach(We=>{const Ge=We.data()||{};te.push((En(Ge,wn.codigo,We.id)||We.id)+"")}))}z.fuentes.push({ruta:"listas_precios/{listaId}/items",total:ee,sample:te});let ne=0,me=[];if(t){const De=Le(se(Q,on.listas_precios_productos),Xe("listaId","==",t)),We=await Se(De).catch(()=>null);We&&!We.empty&&(ne=We.size,We.docs.slice(0,3).forEach(Ge=>{const _t=Ge.data()||{};me.push((En(_t,wn.codigo,Ge.id)||Ge.id)+"")}))}z.fuentes.push({ruta:"listas_precios_productos (por listaId)",total:ne,sample:me});let Ne=0,ke=[];const He=await Se(se(Q,on.catalogo_procedimientos)).catch(()=>null);He&&!He.empty&&(Ne=He.size,He.docs.slice(0,3).forEach(De=>{const We=De.data()||{};ke.push((En(We,wn.codigo,De.id)||De.id)+"")})),z.fuentes.push({ruta:"catalogo_procedimientos",total:Ne,sample:ke});const st=[`Lista seleccionada: ${z.listaId}`,...z.fuentes.map(De=>` ${De.ruta}  ${De.total} items ${De.sample.length?`(ej: ${De.sample.join(", ")})`:""}`)];alert(st.join(`
`)),console.info("[Diagnstico Planes]",z)};w.useEffect(()=>{let z=!0;return(async()=>{const ve=new Set;let we=[];try{const ee=await Se(se(Q,on.catalogo_categorias)).catch(()=>null);if(ee&&!ee.empty&&(ve.add("*"),ee.forEach(te=>{const ne=te.data()||{},me=(ne.nombre||"").toString().trim(),Ne=Array.isArray(ne.prefijos)?ne.prefijos.map(ke=>(ke||"").toString()):[];me&&(ve.add(me),we.push({nombre:me,prefijos:Ne}))})),t){const te=await Se(se(Q,on.listas_precios,t,"categorias")).catch(()=>null);te==null||te.forEach(ke=>{var st;const He=(((st=ke.data())==null?void 0:st.nombre)||"").toString().trim();He&&ve.add(He)});const ne=await Se(se(Q,on.listas_precios,t,"items")).catch(()=>null);ne==null||ne.forEach(ke=>{const He=(En(ke.data()||{},wn.categoria,"")||"").toString().trim();He&&ve.add(He)});const me=Le(se(Q,on.listas_precios_productos),Xe("listaId","==",t)),Ne=await Se(me).catch(()=>null);Ne==null||Ne.forEach(ke=>{const He=(En(ke.data()||{},wn.categoria,"")||"").toString().trim();He&&ve.add(He)})}}finally{ve.size===0&&V.forEach(ee=>ve.add(ee)),ve.has("*")||ve.add("*"),z&&(s(Array.from(ve)),L(we))}})(),()=>{z=!1}},[t]),w.useEffect(()=>{N(i!=="*")},[i]),w.useEffect(()=>{let z=!0;if(!(Is(l).length>=2||i!=="*")){p([]);return}return(async()=>{T(!0);try{let we=[];if(t){const ne=await YU(t);ne.length&&(we=ne)}if(!we.length&&t){const ne=await Se(se(Q,on.listas_precios,t,"items")).catch(()=>null);ne&&!ne.empty&&(we=ne.docs.map(me=>Ud(me,me.data()||{})))}if(!we.length&&t){const ne=Le(se(Q,on.listas_precios_productos),Xe("listaId","==",t)),me=await Se(ne).catch(()=>null);we=((me==null?void 0:me.docs)||[]).map(Ne=>Ud(Ne,Ne.data()||{}))}if(!we.length){const ne=await Se(se(Q,on.catalogo_procedimientos)).catch(()=>null);ne==null||ne.forEach(me=>we.push(Ud(me,me.data()||{})))}const ee=Is(l);let te=we.filter(ne=>{if(i!=="*"){const me=QU(ne.codigo,ne.nombre,i,I)||ne.categoria||"";if(!T1(me,i))return!1}return!(ee&&!ne._norm.includes(ee))});te.sort((ne,me)=>(ne.codigo||"").localeCompare(me.codigo||"")||(ne.nombre||"").localeCompare(me.nombre||"")),i!=="*"&&!ee&&(te=te.slice(0,120)),z&&p(te)}finally{z&&T(!1)}})(),()=>{z=!1}},[t,i,l,I]);const v=z=>{const ve=Math.max(1,Number(d)||1);S(we=>{const ee=we.findIndex(Ne=>Ne.codigo===z.codigo),te={codigo:z.codigo,nombre:z.nombre,precio:Number(z.precio||0),cantidad:ve,descuentoPct:0,descuentoValor:0,observaciones:"",_max_desc_pct:Number(z.max_desc_pct||0),_max_desc_valor:Number(z.max_desc_valor||0),_permite_desc:!!(z.permite_desc??!0),_flags:{genera_rips:!!z.genera_rips,es_consulta:!!z.es_consulta,ver_en_agenda:!!z.ver_en_agenda}};if(ee>=0){const Ne=[...we],ke={...Ne[ee]};ke.cantidad=Rr((ke.cantidad||1)+ve,1,999999);const st=(ke.precio||te.precio||0)*ke.cantidad,De=st*Rr(ke.descuentoPct||0,0,te._max_desc_pct||100)/100,We=Rr(ke.descuentoValor||0,0,te._max_desc_valor||st),Ge=ke._permite_desc?Math.min(Math.max(De,We),st):0;return ke.total=Math.max(0,st-Ge),Ne[ee]=ke,Ne}const ne=te.precio*ve,me=Math.max(0,ne);return[...we,{...te,total:me}]})},b=(z,ve)=>{S(we=>{const ee=[...we],te={...ee[z],...ve};te.cantidad=Rr(vt(te.cantidad,1),1,999999),te.precio=vt(te.precio,0),te.descuentoPct=Rr(vt(te.descuentoPct,0),0,vt(te._max_desc_pct,100)),te.descuentoValor=Rr(vt(te.descuentoValor,0),0,Number.isFinite(te._max_desc_valor)?te._max_desc_valor:999999999);const ne=te.precio*te.cantidad,me=ne*te.descuentoPct/100,Ne=Rr(te.descuentoValor,0,Number.isFinite(te._max_desc_valor)?te._max_desc_valor:ne),ke=te._permite_desc?Math.min(Math.max(me,Ne),ne):0;return te.total=Math.max(0,ne-ke),ee[z]=te,ee})},P=z=>S(ve=>ve.filter((we,ee)=>ee!==z)),R=()=>{if(!E.length&&h.length){const z=Math.max(1,Number(d)||1),ve=h.map(we=>({codigo:we.codigo,nombre:we.nombre,precio:Number(we.precio||0),cantidad:z,descuentoPct:0,descuentoValor:0,observaciones:"",_max_desc_pct:Number(we.max_desc_pct||0),_max_desc_valor:Number(we.max_desc_valor||0),_permite_desc:!!(we.permite_desc??!0),_flags:{genera_rips:!!we.genera_rips,es_consulta:!!we.es_consulta,ver_en_agenda:!!we.ver_en_agenda},total:Number(we.precio||0)*z}));n(ve),c(""),N(!1),_.current&&_.current.blur(),e();return}E.length&&n(E),c(""),N(!1),_.current&&_.current.blur(),e()},O=C&&(x||h.length>0),k=h.length===0&&Is(l).length<2&&i==="*",M=!O&&i==="*";return o.jsx("div",{className:"oc-mask",role:"dialog","aria-modal":"true",children:o.jsxs("div",{className:"oc-modal",children:[o.jsxs("div",{className:"oc-modal-h",children:[o.jsx("b",{children:"Agregar productos"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:g,children:"Diagnstico"}),o.jsx("button",{className:"oc-btn",onClick:e,children:"Cerrar"})]})]}),o.jsxs("div",{className:"oc-modal-t",children:[o.jsx("select",{className:"oc-select",value:i,onChange:z=>a(z.target.value),children:r.map(z=>o.jsx("option",{value:z,children:z==="*"?"Todas las categoras":z},z))}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("input",{ref:_,className:"oc-input",placeholder:"Buscar tem por cdigo o nombre",value:l,onChange:z=>{c(z.target.value),N(!0)},onFocus:()=>{i!=="*"&&N(!0)}}),O&&o.jsx("div",{className:"oc-sug",children:x?o.jsx("div",{className:"oc-muted",style:{padding:10},children:"Cargando"}):h.length===0?o.jsx("div",{className:"oc-muted",style:{padding:10},children:"Sin resultados."}):h.map(z=>o.jsxs("div",{className:"oc-sug-item",onMouseDown:ve=>{ve.preventDefault(),v(z),c(""),N(!1),_.current&&_.current.blur()},children:[o.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:z.nombre}),o.jsx("div",{className:"mono",style:{opacity:.85},children:z.codigo})]},`${z.id}-${z.codigo}`))})]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,justifySelf:"start"},children:[o.jsx("span",{className:"oc-muted",style:{fontSize:12,fontWeight:700},children:"Cantidad"}),o.jsx("input",{type:"number",min:1,value:d,onChange:z=>f(z.target.value),className:"oc-input",style:{width:90}})]}),o.jsx("button",{className:"oc-btn success",onClick:R,children:"Agregar"})]}),o.jsxs("div",{className:"oc-modal-b",children:[k?o.jsx("div",{className:"oc-muted",children:"Escribe al menos 2 caracteres o elige una categora para ver resultados."}):x?o.jsx("div",{className:"oc-muted",children:"Cargando"}):h.length===0?o.jsx("div",{className:"oc-muted",children:"Sin resultados."}):M&&o.jsxs("table",{className:"oc-tbl",style:{marginBottom:10},children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:140},children:"Valor unit."}),o.jsx("th",{style:{width:160},children:"Categora"}),o.jsx("th",{style:{width:120},children:"Acciones"})]})}),o.jsx("tbody",{children:h.map(z=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:z.codigo}),o.jsx("td",{children:z.nombre}),o.jsx("td",{className:"mono",children:qg.format(z.precio||0)}),o.jsx("td",{children:z.categoria||""}),o.jsx("td",{children:o.jsx("button",{className:"oc-btn success small",onClick:()=>{v(z),c(""),N(!1),_.current&&_.current.blur()},children:"Agregar"})})]},`${z.id}-${z.codigo}`))})]}),!!E.length&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{margin:"6px 0 8px",fontWeight:700},className:"oc-muted",children:"tems a cargar"}),o.jsxs("table",{className:"oc-tbl",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:120},children:"Valor unit."}),o.jsx("th",{style:{width:80},children:"Cant."}),o.jsx("th",{style:{width:90},children:"Desc. %"}),o.jsx("th",{style:{width:110},children:"Desc. $"}),o.jsx("th",{children:"Observaciones"}),o.jsx("th",{style:{width:120},children:"Total"}),o.jsx("th",{style:{width:140},children:"Acciones"})]})}),o.jsx("tbody",{children:E.map((z,ve)=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:z.codigo}),o.jsx("td",{children:z.nombre}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:Number.isFinite(z.precio)?z.precio:0,onChange:we=>b(ve,{precio:we.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:1,value:z.cantidad,onChange:we=>b(ve,{cantidad:we.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,max:100,value:z.descuentoPct,onChange:we=>b(ve,{descuentoPct:we.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:z.descuentoValor||0,onChange:we=>b(ve,{descuentoValor:we.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{value:z.observaciones||"",onChange:we=>b(ve,{observaciones:we.target.value}),className:"oc-input"})}),o.jsx("td",{className:"mono",children:qg.format(z.total||0)}),o.jsx("td",{children:o.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:o.jsx("button",{className:"oc-btn success small",onClick:()=>P(ve),children:"Quitar"})})})]},ve))})]})]})]}),o.jsxs("div",{className:"oc-modal-f",children:[o.jsx("button",{className:"oc-btn",onClick:e,children:"Cerrar"}),o.jsx("button",{className:"oc-btn success",onClick:R,disabled:!E.length&&!h.length,children:"Cargar"})]})]})})}function JU({planId:t,onBack:e}){const[n,r]=w.useState(null),[s,i]=w.useState([]),[a,l]=w.useState([]),[c,d]=w.useState(!1),[f,h]=w.useState(!1);w.useEffect(()=>{let L=!0;return(async()=>{const V=await Se(Le(se(Q,on.listas_precios),gt("nombre","asc"))).catch(()=>null);L&&i(V?V.docs.map(R=>({id:R.id,...R.data()||{}})):[]);const g=await Po(Re(Q,"planes",t));if(!g.exists())return;const v={id:g.id,...g.data()||{}};L&&r(v);const P=(await Se(se(Q,"planes",t,"planes_items"))).docs.map(R=>({id:R.id,...R.data()||{}}));L&&l(P)})(),()=>{L=!1}},[t]);const p=(n==null?void 0:n.listaId)||"",x=L=>r(V=>({...V||{},...L})),T=L=>{const V=Rr(vt(L.cantidad,1),1,999999),g=vt(L.precio,0),v=!!(L._permite_desc??!0),b=Number.isFinite(L._max_desc_pct)?L._max_desc_pct:100,P=Number.isFinite(L._max_desc_valor)?L._max_desc_valor:1/0,R=Rr(vt(L.descuentoPct,0),0,b),O=Rr(vt(L.descuentoValor,0),0,P),k=g*V,M=k*(v?R:0)/100,z=v?Math.min(O,P,k):0,ve=v?Math.min(Math.max(M,z),k):0,we=Math.max(0,k-ve);return{...L,cantidad:V,precio:g,descuentoPct:R,descuentoValor:O,total:we}},C=L=>{l(V=>{const g=new Map(V.map(v=>[v.codigo,{...v}]));for(const v of L)if(g.has(v.codigo)){const b={...g.get(v.codigo)};b.cantidad=Rr(vt(b.cantidad,1)+vt(v.cantidad,1),1,999999),b.precio=vt(v.precio,b.precio||0),b.descuentoPct=vt(b.descuentoPct,0),b.descuentoValor=vt(b.descuentoValor,0),b.observaciones=b.observaciones||"",b._max_desc_pct=vt(b._max_desc_pct??v._max_desc_pct??0),b._max_desc_valor=vt(b._max_desc_valor??v._max_desc_valor??0),b._permite_desc=b._permite_desc??v._permite_desc??!0,b._flags=b._flags||v._flags||{},g.set(v.codigo,T(b))}else g.set(v.codigo,T({...v,descuentoValor:vt(v.descuentoValor,0)}));return Array.from(g.values())})},N=(L,V)=>{l(g=>{const v=[...g];return v[L]=T({...v[L],...V}),v})},_=async(L,V)=>{if(!(n!=null&&n.id)){l(g=>g.filter((v,b)=>b!==V));return}L&&await An(Re(Q,"planes",n.id,"planes_items",L)),l(g=>L?g.filter(v=>v.id!==L):g.filter((v,b)=>b!==V))},E=L=>{alert(`(Demo) Agendar: ${L.codigo}  ${L.nombre}`)},S=L=>{alert(`(Demo) Facturar: ${L.codigo}  ${L.nombre}`)},I=async()=>{var L;if(!((L=n==null?void 0:n.nombre)!=null&&L.trim()))return alert("El nombre del plan es obligatorio.");if(!(n!=null&&n.listaId))return alert("Selecciona la lista de precios.");d(!0);try{await $t(Re(Q,"planes",n.id),{nombre:n.nombre.trim(),listaId:n.listaId,actualizado:kt()});const V=se(Q,"planes",n.id,"planes_items");await Promise.all(a.map(async g=>{const v=T(g),b={codigo:v.codigo||"",nombre:v.nombre||"",precio:vt(v.precio,0),cantidad:vt(v.cantidad,1),descuentoPct:vt(v.descuentoPct,0),descuentoValor:vt(v.descuentoValor,0),observaciones:v.observaciones||"",total:vt(v.total,0),_max_desc_pct:vt(v._max_desc_pct,0),_max_desc_valor:vt(v._max_desc_valor,0),_permite_desc:!!(v._permite_desc??!0),_flags:v._flags||{},actualizado:kt()};g.id?await $t(Re(V,g.id),b):await zt(V,{...b,creado:kt()})})),alert(" Plan guardado.")}catch(V){console.error(V),alert(" No se pudo guardar el plan.")}finally{d(!1)}};return n?o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("h3",{style:{margin:0},children:"Edicin de plan"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:e,children:"Volver"}),o.jsx("button",{className:"oc-btn primary",onClick:I,disabled:c,children:c?"Guardando":"Guardar cambios"})]})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:10,alignItems:"center",marginBottom:8},children:[o.jsx("label",{children:"Nombre"}),o.jsx("input",{className:"oc-input",value:n.nombre||"",onChange:L=>x({nombre:L.target.value})})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr auto",gap:10,alignItems:"center",marginBottom:16},children:[o.jsx("label",{children:"Lista de precios"}),o.jsxs("select",{className:"oc-select",value:n.listaId||"",onChange:L=>x({listaId:L.target.value}),children:[o.jsx("option",{value:"",children:"Seleccione"}),s.map(L=>o.jsx("option",{value:L.id,children:L.nombre||L.id},L.id))]}),o.jsx("button",{className:"oc-btn outline small",onClick:()=>h(!0),children:"+ Productos"})]}),o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"oc-tbl",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:120},children:"Valor unit."}),o.jsx("th",{style:{width:80},children:"Cant."}),o.jsx("th",{style:{width:90},children:"Desc. %"}),o.jsx("th",{style:{width:110},children:"Desc. $"}),o.jsx("th",{children:"Observaciones"}),o.jsx("th",{style:{width:120},children:"Total"}),o.jsx("th",{style:{width:220},children:"Acciones"})]})}),o.jsx("tbody",{children:a.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:9,className:"oc-muted",children:"Sin productos en el plan."})}):a.map((L,V)=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:L.codigo}),o.jsx("td",{children:L.nombre}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:Number.isFinite(L.precio)?L.precio:0,onChange:g=>N(V,{precio:g.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:1,value:L.cantidad||1,onChange:g=>N(V,{cantidad:g.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,max:100,value:L.descuentoPct||0,onChange:g=>N(V,{descuentoPct:g.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:L.descuentoValor||0,onChange:g=>N(V,{descuentoValor:g.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{className:"oc-input",value:L.observaciones||"",onChange:g=>N(V,{observaciones:g.target.value})})}),o.jsx("td",{className:"mono",children:qg.format(vt(L.total,vt(L.precio,0)*vt(L.cantidad,1)))}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[o.jsx("button",{className:"oc-btn outline small",onClick:()=>E(L),children:"Agendar"}),o.jsx("button",{className:"oc-btn outline small",onClick:()=>S(L),children:"Facturar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>_(L.id,V),children:"Eliminar"})]})})]},L.id||`new-${V}`))})]})}),f&&o.jsx(XU,{listaId:p,onClose:()=>h(!1),onLoadLines:C})]}):o.jsx("div",{className:"oc-muted",children:"Cargando plan"})}function $d({mode:t,planId:e}){HU();const[n,r]=w.useState(t||"list");the[editId,setEditId]=w.useState(e||null);const[s,i]=w.useState(""),[a,l]=w.useState([]),[c,d]=w.useState(!0),[f,h]=w.useState([]),[p,x]=w.useState({nombre:"",listaId:""});w.useEffect(()=>{let _=!0;return(async()=>{d(!0);try{const E=await Se(Le(se(Q,on.listas_precios),gt("nombre","asc"))).catch(()=>null);_&&h(E?E.docs.map(I=>({id:I.id,...I.data()||{}})):[]);const S=await Se(Le(se(Q,"planes"),gt("nombre","asc")));_&&l(S.docs.map(I=>({id:I.id,...I.data()||{}})))}finally{_&&d(!1)}})(),()=>{_=!1}},[]),w.useEffect(()=>{t&&r(t)},[t]),w.useEffect(()=>{e&&setEditId(e)},[e]);const T=w.useMemo(()=>{const _=Is(s);return _?a.filter(E=>Is(`${E.nombre} ${E.listaNombre||""}`).includes(_)):a},[a,s]),C=async()=>{var S;if(!((S=p.nombre)!=null&&S.trim()))return alert("El nombre es obligatorio.");if(!p.listaId)return alert("Selecciona una lista de precios.");const _=f.find(I=>I.id===p.listaId),E=await zt(se(Q,"planes"),{nombre:p.nombre.trim(),listaId:p.listaId,listaNombre:(_==null?void 0:_.nombre)||"",creado:kt(),actualizado:kt()});l(I=>[...I,{id:E.id,nombre:p.nombre.trim(),listaId:p.listaId,listaNombre:(_==null?void 0:_.nombre)||""}]),x({nombre:"",listaId:""}),setEditId(E.id),r("edit")},N=async _=>{window.confirm(`Eliminar el plan "${_.nombre}"?`)&&(await An(Re(Q,"planes",_.id)),l(E=>E.filter(S=>S.id!==_.id)))};return n==="edit"&&editId?o.jsx(JU,{planId:editId,onBack:()=>{r("list"),setEditId(null)}}):n==="new"?o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Nuevo plan"}),o.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,marginBottom:12},children:o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(220px, 1fr) minmax(240px, 1fr) auto",gap:8,alignItems:"center"},children:[o.jsx("input",{className:"oc-input",placeholder:"Nombre del plan",value:p.nombre,onChange:_=>x(E=>({...E,nombre:_.target.value}))}),o.jsxs("select",{className:"oc-select",value:p.listaId,onChange:_=>x(E=>({...E,listaId:_.target.value})),children:[o.jsx("option",{value:"",children:"Seleccione lista de precios"}),f.map(_=>o.jsx("option",{value:_.id,children:_.nombre||_.id},_.id))]}),o.jsx("button",{className:"oc-btn primary",onClick:C,children:"Crear"})]})}),o.jsx("button",{className:"oc-btn",onClick:()=>r("list"),children:"Volver"})]}):o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Planes"}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,marginBottom:12},children:[o.jsx("h3",{style:{marginTop:0},children:"Nuevo plan"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(220px, 1fr) minmax(240px, 1fr) auto",gap:8,alignItems:"center"},children:[o.jsx("input",{className:"oc-input",placeholder:"Nombre del plan",value:p.nombre,onChange:_=>x(E=>({...E,nombre:_.target.value}))}),o.jsxs("select",{className:"oc-select",value:p.listaId,onChange:_=>x(E=>({...E,listaId:_.target.value})),children:[o.jsx("option",{value:"",children:"Seleccione lista de precios"}),f.map(_=>o.jsx("option",{value:_.id,children:_.nombre||_.id},_.id))]}),o.jsx("button",{className:"oc-btn primary",onClick:C,children:"Crear"})]})]}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[o.jsx("h3",{style:{margin:0},children:"Listado"}),o.jsx("input",{className:"oc-input",placeholder:"Buscar",value:s,onChange:_=>i(_.target.value),style:{minWidth:240}})]}),c?o.jsx("div",{className:"oc-muted",children:"Cargando"}):T.length===0?o.jsx("div",{className:"oc-muted",children:"Sin planes."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"oc-tbl",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Lista de precios"}),o.jsx("th",{style:{width:220},children:"Acciones"})]})}),o.jsx("tbody",{children:T.map(_=>o.jsxs("tr",{children:[o.jsx("td",{children:_.nombre}),o.jsx("td",{children:_.listaNombre||_.listaId||""}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[o.jsx("button",{className:"oc-btn outline small",onClick:()=>{setEditId(_.id),r("edit")},children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>N(_),children:"Eliminar"})]})})]},_.id))})]})})]})]})}const lm=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),tr=t=>{const e=parseInt(String(t||"0").replace(/\D/g,""),10);return isNaN(e)||e<0?0:e};function ZU(){const[t,e]=w.useState([]),[n,r]=w.useState(!0),[s,i]=w.useState(""),[a,l]=w.useState("list"),[c,d]=w.useState(null),[f,h]=w.useState({nombre:"",contReciboCaja:0,contNotaCredito:0,contNotaDebito:0,contEgresos:0,contPresupuestos:0,contPlanTratamiento:0,contOrdenesCompra:0,contCuentasPorCobrar:0,contUsoSaldoAFavor:0,contUsoNotasCredito:0,contRipsAutomatizados:0,numRipsRes2275:0,datosManuales:!1,facturaCompra:!1,facturaVenta:!1,facturacionElectronica:!1,enUso:!1}),p=()=>h({nombre:"",contReciboCaja:0,contNotaCredito:0,contNotaDebito:0,contEgresos:0,contPresupuestos:0,contPlanTratamiento:0,contOrdenesCompra:0,contCuentasPorCobrar:0,contUsoSaldoAFavor:0,contUsoNotasCredito:0,contRipsAutomatizados:0,numRipsRes2275:0,datosManuales:!1,facturaCompra:!1,facturaVenta:!1,facturacionElectronica:!1,enUso:!1}),x=async()=>{r(!0);try{const R=Le(se(Q,"consecutivos"),gt("nombre","asc")),k=(await Se(R)).docs.map(M=>({id:M.id,...M.data()||{}}));e(k)}catch(R){console.error("Error leyendo consecutivos:",R),e([])}finally{r(!1)}};w.useEffect(()=>{x()},[]);const T=w.useMemo(()=>{const R=lm(s);return R?t.filter(O=>lm(`${O.nombre}`).includes(R)):t},[t,s]),C=R=>O=>h(k=>({...k,[R]:!!O.target.checked})),N=R=>O=>h(k=>({...k,[R]:tr(O.target.value)})),_=R=>{const{name:O,value:k}=R.target;h(M=>({...M,[O]:k}))},E=()=>{d(null),p(),l("form"),window.scrollTo({top:0,behavior:"smooth"})},S=R=>{d(R.id),h({nombre:R.nombre||"",contReciboCaja:R.contReciboCaja??0,contNotaCredito:R.contNotaCredito??0,contNotaDebito:R.contNotaDebito??0,contEgresos:R.contEgresos??0,contPresupuestos:R.contPresupuestos??0,contPlanTratamiento:R.contPlanTratamiento??0,contOrdenesCompra:R.contOrdenesCompra??0,contCuentasPorCobrar:R.contCuentasPorCobrar??0,contUsoSaldoAFavor:R.contUsoSaldoAFavor??0,contUsoNotasCredito:R.contUsoNotasCredito??0,contRipsAutomatizados:R.contRipsAutomatizados??0,numRipsRes2275:R.numRipsRes2275??0,datosManuales:!!R.datosManuales,facturaCompra:!!R.facturaCompra,facturaVenta:!!R.facturaVenta,facturacionElectronica:!!R.facturacionElectronica,enUso:!!R.enUso}),l("form"),window.scrollTo({top:0,behavior:"smooth"})},I=()=>{d(null),p(),l("list")},L=async R=>{var k,M;(k=R==null?void 0:R.preventDefault)==null||k.call(R);const O={...f,contReciboCaja:tr(f.contReciboCaja),contNotaCredito:tr(f.contNotaCredito),contNotaDebito:tr(f.contNotaDebito),contEgresos:tr(f.contEgresos),contPresupuestos:tr(f.contPresupuestos),contPlanTratamiento:tr(f.contPlanTratamiento),contOrdenesCompra:tr(f.contOrdenesCompra),contCuentasPorCobrar:tr(f.contCuentasPorCobrar),contUsoSaldoAFavor:tr(f.contUsoSaldoAFavor),contUsoNotasCredito:tr(f.contUsoNotasCredito),contRipsAutomatizados:tr(f.contRipsAutomatizados),numRipsRes2275:tr(f.numRipsRes2275),nombre_busqueda:lm(f.nombre),actualizado:kt()};if(!((M=O.nombre)!=null&&M.trim()))return alert("El nombre del consecutivo es obligatorio.");try{if(c?await $t(Re(Q,"consecutivos",c),O):await zt(se(Q,"consecutivos"),{...O,creado:kt()}),O.enUso)try{const z=await Se(se(Q,"consecutivos"));await Promise.all(z.docs.filter(ve=>ve.id!==(c||"")).map(ve=>$t(ve.ref,{enUso:!1})))}catch{}await x(),I(),alert(" Consecutivo guardado.")}catch(z){console.error("Error guardando consecutivo:",z),alert(" No se pudo guardar el consecutivo.")}},V=async R=>{if(window.confirm(`Eliminar el consecutivo "${R.nombre}"?`))try{await An(Re(Q,"consecutivos",R.id)),await x(),alert(" Consecutivo eliminado.")}catch(O){console.error("Error eliminando consecutivo:",O),alert(" No se pudo eliminar.")}},g=({label:R,name:O,value:k,onChange:M})=>o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:R}),o.jsx("input",{name:O,value:String(k??0),onChange:M,inputMode:"numeric",pattern:"[0-9]*",placeholder:"0"})]}),v=({label:R,name:O,checked:k,onChange:M})=>o.jsxs("label",{className:"oc-switch",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{type:"checkbox",checked:!!k,onChange:M}),o.jsx("span",{children:R})]}),b=()=>o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsx("h3",{style:{marginTop:0},children:c?"Editar consecutivo":"Nuevo consecutivo"}),o.jsxs("form",{onSubmit:L,className:"oc-form-grid",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:12},children:[o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Nombre *"}),o.jsx("input",{name:"nombre",value:f.nombre,onChange:_,required:!0,placeholder:"Nombre del consecutivo"})]}),o.jsx(g,{label:"Cont. Recibo de caja",name:"contReciboCaja",value:f.contReciboCaja,onChange:N("contReciboCaja")}),o.jsx(g,{label:"Cont. Nota crdito",name:"contNotaCredito",value:f.contNotaCredito,onChange:N("contNotaCredito")}),o.jsx(g,{label:"Cont. Nota dbito",name:"contNotaDebito",value:f.contNotaDebito,onChange:N("contNotaDebito")}),o.jsx(g,{label:"Cont. Egresos",name:"contEgresos",value:f.contEgresos,onChange:N("contEgresos")}),o.jsx(g,{label:"Cont. Presupuestos",name:"contPresupuestos",value:f.contPresupuestos,onChange:N("contPresupuestos")}),o.jsx(g,{label:"Cont. Plan de tratamiento",name:"contPlanTratamiento",value:f.contPlanTratamiento,onChange:N("contPlanTratamiento")}),o.jsx(g,{label:"Cont. rdenes de compra",name:"contOrdenesCompra",value:f.contOrdenesCompra,onChange:N("contOrdenesCompra")}),o.jsx(g,{label:"Cont. Cuentas por cobrar",name:"contCuentasPorCobrar",value:f.contCuentasPorCobrar,onChange:N("contCuentasPorCobrar")}),o.jsx(g,{label:"Cont. uso saldo a favor",name:"contUsoSaldoAFavor",value:f.contUsoSaldoAFavor,onChange:N("contUsoSaldoAFavor")}),o.jsx(g,{label:"Cont. uso notas crdito",name:"contUsoNotasCredito",value:f.contUsoNotasCredito,onChange:N("contUsoNotasCredito")}),o.jsx(g,{label:"Cont. RIPS automatizados",name:"contRipsAutomatizados",value:f.contRipsAutomatizados,onChange:N("contRipsAutomatizados")}),o.jsx(g,{label:"Num. RIPS (Res. 2275)",name:"numRipsRes2275",value:f.numRipsRes2275,onChange:N("numRipsRes2275")}),o.jsx("div",{className:"oc-col-2"}),o.jsxs("div",{className:"oc-col-2",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:12},children:[o.jsx(v,{label:"Datos manuales consecutivo?",name:"datosManuales",checked:f.datosManuales,onChange:C("datosManuales")}),o.jsx(v,{label:"Factura de compra",name:"facturaCompra",checked:f.facturaCompra,onChange:C("facturaCompra")}),o.jsx(v,{label:"Factura de venta",name:"facturaVenta",checked:f.facturaVenta,onChange:C("facturaVenta")}),o.jsx(v,{label:"Facturacin electrnica",name:"facturacionElectronica",checked:f.facturacionElectronica,onChange:C("facturacionElectronica")}),o.jsx(v,{label:"Marcar como 'En uso' (por defecto)",name:"enUso",checked:f.enUso,onChange:C("enUso")})]}),o.jsxs("div",{className:"oc-form-actions oc-col-2",style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8},children:[o.jsx("button",{type:"button",className:"oc-btn",onClick:I,children:"Cancelar"}),o.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})]})]})]}),P=()=>o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:10},children:[o.jsx("h3",{style:{margin:0},children:"Consecutivos"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("input",{placeholder:"Buscar por nombre",value:s,onChange:R=>i(R.target.value),className:"search-input",style:{minWidth:240}}),o.jsx("button",{className:"oc-btn primary",onClick:E,children:"+ Nuevo consecutivo"})]})]}),n?o.jsx("div",{className:"oc-muted",children:"Cargando"}):T.length===0?o.jsx("div",{className:"oc-muted",children:"Sin consecutivos."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{className:"mono",style:{width:110},children:"RIPS 2275"}),o.jsx("th",{style:{width:90},children:"En uso"}),o.jsx("th",{style:{width:180},children:"Acciones"})]})}),o.jsx("tbody",{children:T.map(R=>o.jsxs("tr",{children:[o.jsx("td",{children:R.nombre}),o.jsx("td",{className:"mono",children:R.numRipsRes2275??0}),o.jsx("td",{children:R.enUso?"S":"No"}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn small",onClick:()=>S(R),children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>V(R),children:"Eliminar"})]})})]},R.id))})]})})]});return o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Consecutivos"}),a==="form"?b():P()]})}const cm=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function e3(){const[t,e]=w.useState("list"),[n,r]=w.useState([]),[s,i]=w.useState(!0),[a,l]=w.useState(""),[c,d]=w.useState([]),[f,h]=w.useState([]),[p,x]=w.useState([]),[T,C]=w.useState([]),[N,_]=w.useState(null),[E,S]=w.useState(!1),[I,L]=w.useState(O()),[V,g]=w.useState(!1),[v,b]=w.useState(null),[P,R]=w.useState(!1);function O(){return{nombre:"",telefonoFijo:"",celular:"",ciudad:"",direccion:"",codigoPostal:"",email:"",consecutivoId:"",listaPreciosId:"",almacenIds:[],pieHabilitado:!1,piePersonalizado:"",codigoPrestador:"",entidadExtranj:"000000",entidadNacional:"000000",centroCostos:"",usuarioSoporteId:"",codigoPrestadorPropio:"",activo:!0}}w.useEffect(()=>{(async()=>{i(!0);try{const[J,Z,Ie,ge,Y]=await Promise.all([Se(Le(se(Q,"sucursales"),gt("nombre","asc"))),Se(Le(se(Q,"almacenes"),gt("nombre","asc"))),Se(Le(se(Q,"listas_precios"),gt("nombre","asc"))),Se(Le(se(Q,"consecutivos"),gt("nombre","asc"))),Se(Le(se(Q,"usuarios"),gt("displayName","asc"))).catch(()=>({empty:!0,docs:[]}))]);r(J.docs.map(X=>({id:X.id,...X.data()||{}}))),d(Z.docs.map(X=>({id:X.id,...X.data()||{}}))),h(Ie.docs.map(X=>({id:X.id,...X.data()||{}}))),x(ge.docs.map(X=>({id:X.id,...X.data()||{}}))),C(Y.empty?[]:Y.docs.map(X=>({id:X.id,...X.data()||{}})))}catch(J){console.error("Error cargando datos:",J),r([]),d([]),h([]),x([]),C([])}finally{i(!1)}})()},[]);const k=async()=>{const J=await Se(Le(se(Q,"sucursales"),gt("nombre","asc")));r(J.docs.map(Z=>({id:Z.id,...Z.data()||{}})))},M=w.useMemo(()=>{const J=cm(a);return J?n.filter(Z=>cm(`${Z.nombre} ${Z.telefonoFijo} ${Z.celular} ${Z.direccion} ${Z.ciudad} ${Z.email}`).includes(J)):n},[n,a]),z=J=>{const{name:Z,type:Ie,checked:ge,value:Y}=J.target;L(X=>({...X,[Z]:Ie==="checkbox"?ge:Y}))},ve=()=>{_(null),L(O()),e("new"),window.scrollTo({top:0,behavior:"smooth"})},we=async J=>{_(J.id),L({nombre:J.nombre||"",telefonoFijo:J.telefonoFijo||"",celular:J.celular||"",ciudad:J.ciudad||"",direccion:J.direccion||"",codigoPostal:J.codigoPostal||"",email:J.email||"",consecutivoId:J.consecutivoId||"",listaPreciosId:J.listaPreciosId||"",almacenIds:Array.isArray(J.almacenIds)?J.almacenIds:[],pieHabilitado:!!J.pieHabilitado,piePersonalizado:J.piePersonalizado||"",codigoPrestador:J.codigoPrestador||"",entidadExtranj:J.entidadExtranj||"000000",entidadNacional:J.entidadNacional||"000000",centroCostos:J.centroCostos||"",usuarioSoporteId:J.usuarioSoporteId||"",codigoPrestadorPropio:J.codigoPrestadorPropio||"",activo:typeof J.activo=="boolean"?J.activo:!0}),e("edit"),window.scrollTo({top:0,behavior:"smooth"})},ee=()=>{_(null),L(O()),e("list")},te=()=>I.nombre.trim()?I.telefonoFijo.trim()?I.celular.trim()?I.ciudad.trim()?I.direccion.trim()?I.email.trim()?I.consecutivoId?I.listaPreciosId?null:"Selecciona una lista de precios.":"Selecciona un consecutivo.":"El correo electrnico es obligatorio.":"La direccin es obligatoria.":"La ciudad es obligatoria.":"El celular es obligatorio.":"El telfono fijo es obligatorio.":"El nombre es obligatorio.",ne=async J=>{J.preventDefault();const Z=te();if(Z)return alert(" "+Z);S(!0);const Ie={...I,nombre_busqueda:cm(I.nombre),actualizado:kt()};try{N?await $t(Re(Q,"sucursales",N),Ie):await zt(se(Q,"sucursales"),{...Ie,creado:kt()}),await k(),ee(),alert(" Sucursal guardada.")}catch(ge){console.error("Error guardando sucursal:",ge),alert(" No se pudo guardar la sucursal.")}finally{S(!1)}},me=async J=>{if(window.confirm(`Eliminar la sucursal "${J.nombre}"?`))try{await An(Re(Q,"sucursales",J.id)),await k(),alert(" Sucursal eliminada.")}catch(Z){console.error("Error eliminando sucursal:",Z),alert(" No se pudo eliminar.")}},Ne=async J=>{b(J),g(!0)},ke=async(J,Z)=>{C(Ie=>Ie.map(ge=>ge.id===J?{...ge,sucursalIds:Z?Array.from(new Set([...ge.sucursalIds||[],v])):(ge.sucursalIds||[]).filter(Y=>Y!==v)}:ge))},He=async()=>{if(v){R(!0);try{const J=T.map(async Z=>{const Ie=Array.isArray(Z.sucursalIds)?Z.sucursalIds:[],ge=Re(Q,"usuarios",Z.id),Y=await Po(ge).catch(()=>null),X=Y!=null&&Y.exists()?Y.data():{},B=Array.isArray(X==null?void 0:X.sucursalIds)?X.sucursalIds:[],pe=Array.isArray(Z.sucursalIds)?Z.sucursalIds:[];(B.length!==pe.length||B.some(Be=>!pe.includes(Be)))&&await Ro(ge,{sucursalIds:pe},{merge:!0})});await Promise.all(J),alert(" Usuarios asociados actualizados."),g(!1)}catch(J){console.error("Error guardando usuarios por oficina:",J),alert(" No se pudo actualizar la asociacin de usuarios.")}finally{R(!1)}}},[st,De]=w.useState([]),[We,Ge]=w.useState([]);w.useEffect(()=>{De([]),Ge([])},[t,I.almacenIds]);const _t=w.useMemo(()=>c.filter(J=>!(I.almacenIds||[]).includes(J.id)),[c,I.almacenIds]),W=w.useMemo(()=>(I.almacenIds||[]).map(J=>c.find(Z=>Z.id===J)).filter(Boolean),[c,I.almacenIds]),fe=()=>{L(J=>({...J,almacenIds:Array.from(new Set([...J.almacenIds||[],...st]))})),De([])},ye=()=>{L(J=>({...J,almacenIds:(J.almacenIds||[]).filter(Z=>!We.includes(Z))})),Ge([])};if(t==="new"||t==="edit"){const J=t==="new"?"Nueva sucursal":"Editar sucursal";return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("h2",{style:{margin:0},children:J}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:ee,children:"Volver"}),o.jsx("button",{className:"oc-btn primary",form:"frmSucursal",disabled:E,children:E?"Guardando...":"Guardar"})]})]}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsx("h3",{style:{marginTop:0},children:"Informacin bsica"}),o.jsxs("form",{id:"frmSucursal",onSubmit:ne,className:"oc-form-grid",style:{display:"grid",gridTemplateColumns:"repeat(2,minmax(0,1fr))",gap:12},children:[o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Nombre *"}),o.jsx("input",{name:"nombre",value:I.nombre,onChange:z,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Telfono fijo *"}),o.jsx("input",{name:"telefonoFijo",value:I.telefonoFijo,onChange:z,required:!0,inputMode:"tel"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Celular *"}),o.jsx("input",{name:"celular",value:I.celular,onChange:z,required:!0,inputMode:"tel"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Ciudad *"}),o.jsx("input",{name:"ciudad",value:I.ciudad,onChange:z,required:!0})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Direccin *"}),o.jsx("input",{name:"direccion",value:I.direccion,onChange:z,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo postal"}),o.jsx("input",{name:"codigoPostal",value:I.codigoPostal,onChange:z})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Correo electrnico *"}),o.jsx("input",{type:"email",name:"email",value:I.email,onChange:z,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Consecutivo *"}),o.jsxs("select",{name:"consecutivoId",value:I.consecutivoId,onChange:z,required:!0,children:[o.jsx("option",{value:"",children:"Seleccione..."}),p.length===0&&o.jsx("option",{value:"",disabled:!0,children:"(Sin consecutivos)"}),p.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Lista de precios *"}),o.jsxs("select",{name:"listaPreciosId",value:I.listaPreciosId,onChange:z,required:!0,children:[o.jsx("option",{value:"",children:"Seleccione..."}),f.length===0&&o.jsx("option",{value:"",disabled:!0,children:"(Sin listas de precios)"}),f.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))]})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Almacenes *"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:8},children:[o.jsx("select",{multiple:!0,size:8,value:st,onChange:Z=>De([...Z.target.selectedOptions].map(Ie=>Ie.value)),children:_t.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,alignItems:"center",justifyContent:"center"},children:[o.jsx("button",{type:"button",className:"oc-btn",onClick:fe,title:"Agregar ",children:">"}),o.jsx("button",{type:"button",className:"oc-btn",onClick:ye,title:" Quitar",children:"<"})]}),o.jsx("select",{multiple:!0,size:8,value:We,onChange:Z=>Ge([...Z.target.selectedOptions].map(Ie=>Ie.value)),children:W.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))})]}),o.jsx("small",{className:"oc-muted",children:"Usa los botones para mover almacenes entre disponibles y seleccionados."})]}),o.jsx("div",{className:"oc-col-2",children:o.jsx("hr",{style:{border:"none",borderTop:"1px solid #e5e7eb",margin:"6px 0 2px"}})}),o.jsx("h4",{className:"oc-col-2",style:{margin:"6px 0"},children:"Pie de pgina en documentos clnicos"}),o.jsxs("div",{className:"oc-field",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{id:"pieHabilitado",type:"checkbox",name:"pieHabilitado",checked:I.pieHabilitado,onChange:z}),o.jsx("label",{htmlFor:"pieHabilitado",children:"Datos de sucursal en pie de pg. doc. clnicos"})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Pie de pgina personalizado doc. clnicos"}),o.jsx("input",{name:"piePersonalizado",value:I.piePersonalizado,onChange:z,placeholder:"Texto opcional que se mostrar en el pie de pgina"})]}),o.jsx("div",{className:"oc-col-2",children:o.jsx("hr",{style:{border:"none",borderTop:"1px solid #e5e7eb",margin:"6px 0 2px"}})}),o.jsx("h4",{className:"oc-col-2",style:{margin:"6px 0"},children:"Informacin administrativa"}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo del prestador de servicio"}),o.jsx("input",{name:"codigoPrestador",value:I.codigoPrestador,onChange:z})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo de prestador propio"}),o.jsx("input",{name:"codigoPrestadorPropio",value:I.codigoPrestadorPropio,onChange:z})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Entidad Administradora Extranjeros"}),o.jsx("input",{name:"entidadExtranj",value:I.entidadExtranj,onChange:z})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Entidad Administradora Nacionales"}),o.jsx("input",{name:"entidadNacional",value:I.entidadNacional,onChange:z})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Centro de costos"}),o.jsx("input",{name:"centroCostos",value:I.centroCostos,onChange:z})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Usuario para soporte"}),o.jsxs("select",{name:"usuarioSoporteId",value:I.usuarioSoporteId,onChange:z,children:[o.jsx("option",{value:"",children:"Ninguno"}),T.map(Z=>o.jsx("option",{value:Z.id,children:Z.displayName||Z.nombre||Z.email||Z.id},Z.id))]})]})]})]})]})}return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("h2",{style:{margin:0},children:"Sucursales"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("input",{placeholder:"Buscar por nombre, telfono, direccin, ciudad, correo",value:a,onChange:J=>l(J.target.value),className:"search-input",style:{minWidth:260}}),o.jsx("button",{className:"oc-btn primary",onClick:ve,children:"+ Nueva sucursal"})]})]}),o.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:s?o.jsx("div",{className:"oc-muted",children:"Cargando"}):M.length===0?o.jsx("div",{className:"oc-muted",children:"Sin sucursales."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:120},children:"Telfono"}),o.jsx("th",{children:"Direccin"}),o.jsx("th",{children:"Correo"}),o.jsx("th",{style:{width:140},children:"Usuarios por oficina"}),o.jsx("th",{style:{width:180},children:"Acciones"})]})}),o.jsx("tbody",{children:M.map(J=>{const Z=(T||[]).filter(Ie=>(Ie.sucursalIds||[]).includes(J.id)).length;return o.jsxs("tr",{children:[o.jsx("td",{children:J.nombre}),o.jsx("td",{className:"mono",children:J.telefonoFijo||J.celular||""}),o.jsx("td",{children:J.direccion}),o.jsx("td",{className:"mono",children:J.email}),o.jsx("td",{children:o.jsxs("button",{className:"oc-btn small",onClick:()=>Ne(J.id),children:[" Ver (",Z,")"]})}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn small",onClick:()=>we(J),children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>me(J),children:"Eliminar"})]})})]},J.id)})})]})})}),V&&o.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:o.jsxs("div",{style:{background:"#fff",borderRadius:12,width:560,maxWidth:"95%",maxHeight:"90vh",overflow:"auto",padding:16,border:"1px solid #e5e7eb"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[o.jsx("h3",{style:{margin:0},children:"Usuarios asociados"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:()=>g(!1),children:"Cerrar"}),o.jsx("button",{className:"oc-btn primary",onClick:He,disabled:P,children:P?"Guardando...":"Guardar"})]})]}),T.length===0?o.jsx("div",{className:"oc-muted",children:"No hay usuarios para asociar."}):o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 120px",gap:8},children:T.map(J=>{const Z=(J.sucursalIds||[]).includes(v);return o.jsxs(qh.Fragment,{children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{type:"checkbox",checked:Z,onChange:Ie=>ke(J.id,Ie.target.checked)}),o.jsx("span",{children:J.displayName||J.nombre||J.email||J.id})]}),o.jsx("span",{className:"oc-muted mono",style:{alignSelf:"center"},children:J.email||""})]},J.id)})})]})})]})}const um=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function t3(){const[t,e]=w.useState([]),[n,r]=w.useState(!0),[s,i]=w.useState(""),[a,l]=w.useState(null),[c,d]=w.useState({codigo:"",nombre:"",color:"#38a169",orden:1,activo:!0,descripcion:""}),f=()=>d({codigo:"",nombre:"",color:"#38a169",orden:((t==null?void 0:t.length)||0)+1,activo:!0,descripcion:""}),h=async()=>{r(!0);try{const E=Le(se(Q,"especialidades"),gt("orden","asc")),S=await Se(E);e(S.docs.map(I=>({id:I.id,...I.data()||{}})))}catch(E){console.error("Error leyendo especialidades:",E),e([])}finally{r(!1)}};w.useEffect(()=>{h()},[]);const p=w.useMemo(()=>{const E=um(s);return E?t.filter(S=>um(`${S.codigo} ${S.nombre} ${S.descripcion}`).includes(E)):t},[t,s]),x=E=>{const{name:S,type:I,value:L,checked:V}=E.target;d(g=>({...g,[S]:I==="checkbox"?V:L}))},T=E=>{l(E.id),d({codigo:E.codigo||"",nombre:E.nombre||"",color:E.color||"#38a169",orden:E.orden??1,activo:!!E.activo,descripcion:E.descripcion||""}),window.scrollTo({top:0,behavior:"smooth"})},C=()=>{l(null),f()},N=async E=>{var I,L;E.preventDefault();const S={...c,nombre_busqueda:um(`${c.nombre} ${c.codigo}`),actualizado:kt()};if(!((I=S.nombre)!=null&&I.trim()))return alert("El nombre es obligatorio.");if(!((L=S.codigo)!=null&&L.trim()))return alert("El cdigo es obligatorio.");try{a?await $t(Re(Q,"especialidades",a),S):await zt(se(Q,"especialidades"),{...S,creado:kt()}),await h(),C(),alert(" Especialidad guardada.")}catch(V){console.error("Error guardando especialidad:",V),alert(" No se pudo guardar la especialidad.")}},_=async E=>{if(window.confirm(`Eliminar la especialidad "${E.nombre}"?`))try{await An(Re(Q,"especialidades",E.id)),await h(),alert(" Especialidad eliminada.")}catch(S){console.error("Error eliminando especialidad:",S),alert(" No se pudo eliminar.")}};return o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Especialidades"}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16,marginBottom:16},children:[o.jsx("h3",{style:{marginTop:0},children:a?"Editar especialidad":"Nueva especialidad"}),o.jsxs("form",{onSubmit:N,className:"oc-form-grid",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:12},children:[o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo *"}),o.jsx("input",{name:"codigo",value:c.codigo,onChange:x,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Nombre *"}),o.jsx("input",{name:"nombre",value:c.nombre,onChange:x,required:!0})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Descripcin"}),o.jsx("textarea",{name:"descripcion",value:c.descripcion,onChange:x,rows:2})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Color"}),o.jsx("input",{name:"color",value:c.color,onChange:x,type:"color"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Orden"}),o.jsx("input",{name:"orden",value:c.orden,onChange:x,type:"number"})]}),o.jsxs("div",{className:"oc-field",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{id:"activoEsp",name:"activo",checked:c.activo,onChange:x,type:"checkbox"}),o.jsx("label",{htmlFor:"activoEsp",children:"Activo"})]}),o.jsxs("div",{className:"oc-form-actions oc-col-2",style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8},children:[a&&o.jsx("button",{type:"button",className:"oc-btn",onClick:C,children:"Cancelar"}),o.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})]})]})]}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:10},children:[o.jsx("h3",{style:{margin:0},children:"Listado"}),o.jsx("input",{placeholder:"Buscar por nombre o cdigo",value:s,onChange:E=>i(E.target.value),className:"search-input",style:{minWidth:240}})]}),n?o.jsx("div",{className:"oc-muted",children:"Cargando"}):p.length===0?o.jsx("div",{className:"oc-muted",children:"Sin especialidades."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:90},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Descripcin"}),o.jsx("th",{style:{width:70},children:"Color"}),o.jsx("th",{style:{width:70},children:"Orden"}),o.jsx("th",{style:{width:90},children:"Activo"}),o.jsx("th",{style:{width:160},children:"Acciones"})]})}),o.jsx("tbody",{children:p.map(E=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:E.codigo}),o.jsx("td",{children:E.nombre}),o.jsx("td",{children:E.descripcion}),o.jsx("td",{children:o.jsx("div",{style:{width:18,height:18,borderRadius:4,background:E.color||"#999",border:"1px solid #e5e7eb"}})}),o.jsx("td",{className:"mono",children:E.orden??""}),o.jsx("td",{children:E.activo?"S":"No"}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn small",onClick:()=>T(E),children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>_(E),children:"Eliminar"})]})})]},E.id))})]})})]})]})}function n3(){const[t,e]=w.useState([]),[n,r]=w.useState({nombre:"",tipo:"Consultorio",sucursal:"",capacidad:1,profesionalesPermitidos:"",activo:!0}),[s,i]=w.useState(null),[a,l]=w.useState(!1);w.useEffect(()=>{const x=Le(se(Q,"recursos"),gt("nombre","asc")),T=cn(x,C=>{e(C.docs.map(N=>({id:N.id,...N.data()})))});return()=>T()},[]);const c=x=>{const{name:T,value:C,type:N,checked:_}=x.target;r(E=>({...E,[T]:N==="checkbox"?_:C}))},d=()=>{r({nombre:"",tipo:"Consultorio",sucursal:"",capacidad:1,profesionalesPermitidos:"",activo:!0}),i(null)},f=async x=>{if(x.preventDefault(),!n.nombre.trim()){alert("El nombre es obligatorio.");return}l(!0);try{const T={nombre:n.nombre.trim(),tipo:n.tipo,sucursal:n.sucursal.trim(),capacidad:Number(n.capacidad)||1,profesionalesPermitidos:n.profesionalesPermitidos.split(",").map(C=>C.trim()).filter(Boolean),activo:n.activo};s?await $t(Re(Q,"recursos",s),T):await zt(se(Q,"recursos"),T),d()}catch(T){console.error("Error al guardar consultorio:",T),alert("Error al guardar.")}l(!1)},h=x=>{i(x.id),r({nombre:x.nombre||"",tipo:x.tipo||"Consultorio",sucursal:x.sucursal||"",capacidad:x.capacidad||1,profesionalesPermitidos:(x.profesionalesPermitidos||[]).join(", "),activo:x.activo??!0}),window.scrollTo({top:0,behavior:"smooth"})},p=async x=>{if(window.confirm("Eliminar este consultorio?"))try{await An(Re(Q,"recursos",x))}catch(T){console.error("Error al eliminar:",T),alert("No se pudo eliminar.")}};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Consultorios"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:s?"Editar consultorio":"Nuevo consultorio"}),o.jsxs("form",{className:"emp-form",onSubmit:f,children:[o.jsxs("div",{className:"oc-form-grid",children:[o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Nombre *"}),o.jsx("input",{name:"nombre",className:"emp-input",required:!0,value:n.nombre,onChange:c})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo"}),o.jsxs("select",{name:"tipo",className:"emp-select",value:n.tipo,onChange:c,children:[o.jsx("option",{children:"Consultorio"}),o.jsx("option",{children:"Sala"}),o.jsx("option",{children:"Silla"}),o.jsx("option",{children:"Equipo"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Sucursal"}),o.jsx("input",{name:"sucursal",className:"emp-input",value:n.sucursal,onChange:c})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Capacidad"}),o.jsx("input",{name:"capacidad",className:"emp-input",inputMode:"numeric",value:n.capacidad,onChange:c})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Profesionales permitidos"}),o.jsx("input",{name:"profesionalesPermitidos",className:"emp-input",placeholder:"IDs o nombres separados por coma",value:n.profesionalesPermitidos,onChange:c}),o.jsx("small",{style:{color:"#666"},children:"(solo informativo por ahora, se enlaza con doctores ms adelante)"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Activo"}),o.jsx("input",{name:"activo",type:"checkbox",checked:n.activo,onChange:c})]})]}),o.jsxs("div",{className:"oc-form-actions",children:[o.jsx("button",{type:"submit",className:"oc-btn primary",disabled:a,children:a?"Guardando...":s?"Actualizar":"Guardar"}),s&&o.jsx("button",{type:"button",className:"oc-btn secondary",onClick:d,children:"Cancelar"})]})]})]}),o.jsxs("div",{className:"emp-card",style:{marginTop:"1.5rem"},children:[o.jsx("div",{className:"emp-title",children:"Listado de consultorios"}),t.length===0?o.jsx("p",{style:{padding:"0.5rem 1rem"},children:"No hay consultorios registrados."}):o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Tipo"}),o.jsx("th",{children:"Sucursal"}),o.jsx("th",{children:"Capacidad"}),o.jsx("th",{children:"Activo"}),o.jsx("th",{style:{width:120},children:"Acciones"})]})}),o.jsx("tbody",{children:t.map(x=>o.jsxs("tr",{children:[o.jsx("td",{children:x.nombre}),o.jsx("td",{children:x.tipo}),o.jsx("td",{children:x.sucursal}),o.jsx("td",{children:x.capacidad}),o.jsx("td",{children:x.activo?"S":"No"}),o.jsxs("td",{children:[o.jsx("button",{className:"oc-btn small",onClick:()=>h(x),title:"Editar",children:""}),o.jsx("button",{className:"oc-btn small danger",onClick:()=>p(x.id),title:"Eliminar",children:""})]})]},x.id))})]})]})]})}function r3(){const[t,e]=w.useState([]),[n,r]=w.useState([]),[s,i]=w.useState([]),[a,l]=w.useState({nombreCompleto:"",identificacion:"",registroProfesional:"",entidadRegistro:"",correo:"",telefono:"",especialidades:[],sucursal:"",consultoriosPermitidos:[],disponibilidad:[],activo:!0}),[c,d]=w.useState(null),[f,h]=w.useState(!1),[p,x]=w.useState({dia:"Lunes",desde:"08:00",hasta:"12:00"});w.useEffect(()=>{const g=cn(Le(se(Q,"profesionales"),gt("nombreCompleto")),v=>e(v.docs.map(b=>({id:b.id,...b.data()}))));return Se(se(Q,"especialidades")).then(v=>r(v.docs.map(b=>({id:b.id,...b.data()})))),Se(se(Q,"recursos")).then(v=>i(v.docs.map(b=>({id:b.id,...b.data()})))),()=>g()},[]);const T=g=>{const{name:v,value:b,type:P,checked:R}=g.target;l(O=>({...O,[v]:P==="checkbox"?R:b}))},C=g=>{l(v=>{const b=v.especialidades.includes(g)?v.especialidades.filter(P=>P!==g):[...v.especialidades,g];return{...v,especialidades:b}})},N=g=>{l(v=>{const b=v.consultoriosPermitidos.includes(g)?v.consultoriosPermitidos.filter(P=>P!==g):[...v.consultoriosPermitidos,g];return{...v,consultoriosPermitidos:b}})},_=()=>{l(g=>({...g,disponibilidad:[...g.disponibilidad,{...p}]})),x({dia:"Lunes",desde:"08:00",hasta:"12:00"})},E=g=>{l(v=>({...v,disponibilidad:v.disponibilidad.filter((b,P)=>P!==g)}))},S=()=>{l({nombreCompleto:"",identificacion:"",registroProfesional:"",entidadRegistro:"",correo:"",telefono:"",especialidades:[],sucursal:"",consultoriosPermitidos:[],disponibilidad:[],activo:!0}),d(null)},I=async g=>{if(g.preventDefault(),!a.nombreCompleto.trim())return alert("El nombre es obligatorio.");h(!0);try{const v={...a,nombreCompleto:a.nombreCompleto.trim()};c?await $t(Re(Q,"profesionales",c),v):await zt(se(Q,"profesionales"),v),S()}catch(v){console.error(v),alert("Error al guardar profesional.")}h(!1)},L=g=>{d(g.id),l({...g}),window.scrollTo({top:0,behavior:"smooth"})},V=async g=>{if(window.confirm("Eliminar este profesional?"))try{await An(Re(Q,"profesionales",g))}catch(v){console.error(v),alert("Error al eliminar.")}};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Profesionales"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:c?"Editar profesional":"Nuevo profesional"}),o.jsxs("form",{className:"emp-form",onSubmit:I,children:[o.jsxs("div",{className:"oc-form-grid",children:[o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Nombre completo *"}),o.jsx("input",{name:"nombreCompleto",className:"emp-input",required:!0,value:a.nombreCompleto,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Identificacin"}),o.jsx("input",{name:"identificacion",className:"emp-input",value:a.identificacion,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Registro profesional"}),o.jsx("input",{name:"registroProfesional",className:"emp-input",value:a.registroProfesional,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Entidad de registro"}),o.jsx("input",{name:"entidadRegistro",className:"emp-input",value:a.entidadRegistro,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Correo"}),o.jsx("input",{name:"correo",type:"email",className:"emp-input",value:a.correo,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Telfono"}),o.jsx("input",{name:"telefono",className:"emp-input",value:a.telefono,onChange:T})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Sucursal"}),o.jsx("input",{name:"sucursal",className:"emp-input",value:a.sucursal,onChange:T})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Especialidades"}),o.jsx("div",{className:"emp-checkbox-list",children:n.map(g=>o.jsxs("label",{style:{marginRight:"1rem"},children:[o.jsx("input",{type:"checkbox",checked:a.especialidades.includes(g.id),onChange:()=>C(g.id)})," ",g.nombre]},g.id))})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Consultorios permitidos"}),o.jsx("div",{className:"emp-checkbox-list",children:s.map(g=>o.jsxs("label",{style:{marginRight:"1rem"},children:[o.jsx("input",{type:"checkbox",checked:a.consultoriosPermitidos.includes(g.id),onChange:()=>N(g.id)})," ",g.nombre]},g.id))})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Disponibilidad semanal"}),o.jsxs("div",{style:{marginBottom:"0.5rem"},children:[o.jsx("select",{name:"dia",value:p.dia,onChange:g=>x(v=>({...v,dia:g.target.value})),children:["Lunes","Martes","Mircoles","Jueves","Viernes","Sbado"].map(g=>o.jsx("option",{children:g},g))})," ",o.jsx("input",{type:"time",value:p.desde,onChange:g=>x(v=>({...v,desde:g.target.value}))})," ","a"," ",o.jsx("input",{type:"time",value:p.hasta,onChange:g=>x(v=>({...v,hasta:g.target.value}))})," ",o.jsx("button",{type:"button",className:"oc-btn small",onClick:_,children:""})]}),a.disponibilidad.length>0&&o.jsx("ul",{style:{marginLeft:"1rem"},children:a.disponibilidad.map((g,v)=>o.jsxs("li",{children:[g.dia,": ",g.desde," - ",g.hasta," ",o.jsx("button",{type:"button",className:"oc-btn small danger",onClick:()=>E(v),children:""})]},v))})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Activo"}),o.jsx("input",{name:"activo",type:"checkbox",checked:a.activo,onChange:T})]})]}),o.jsxs("div",{className:"oc-form-actions",children:[o.jsx("button",{type:"submit",className:"oc-btn primary",disabled:f,children:f?"Guardando...":c?"Actualizar":"Guardar"}),c&&o.jsx("button",{type:"button",className:"oc-btn secondary",onClick:S,children:"Cancelar"})]})]})]}),o.jsxs("div",{className:"emp-card",style:{marginTop:"1.5rem"},children:[o.jsx("div",{className:"emp-title",children:"Listado de profesionales"}),t.length===0?o.jsx("p",{style:{padding:"0.5rem 1rem"},children:"No hay profesionales registrados."}):o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Registro"}),o.jsx("th",{children:"Especialidades"}),o.jsx("th",{children:"Sucursal"}),o.jsx("th",{children:"Activo"}),o.jsx("th",{style:{width:120},children:"Acciones"})]})}),o.jsx("tbody",{children:t.map(g=>{var v;return o.jsxs("tr",{children:[o.jsx("td",{children:g.nombreCompleto}),o.jsx("td",{children:g.registroProfesional}),o.jsx("td",{children:(v=g.especialidades)==null?void 0:v.map(b=>{var P;return((P=n.find(R=>R.id===b))==null?void 0:P.nombre)||""}).join(", ")}),o.jsx("td",{children:g.sucursal||""}),o.jsx("td",{children:g.activo?"S":"No"}),o.jsxs("td",{children:[o.jsx("button",{className:"oc-btn small",onClick:()=>L(g),title:"Editar",children:""}),o.jsx("button",{className:"oc-btn small danger",onClick:()=>V(g.id),title:"Eliminar",children:""})]})]},g.id)})})]})]})]})}const s3={"datos-basicos":AU,logo:PU,"lista-de-precios":C1,planes:$d,consecutivos:ZU,almacenes:void 0,"categorias-inventario":void 0,sucursales:e3,"metodos-de-pago":void 0,bancos:void 0,"formulario-de-pacientes":void 0,especialidades:t3,perfiles:void 0,usuarios:void 0,"condiciones-de-pago":void 0,parametros:void 0,"recursos-fisicos":void 0,"plantillas-doc-clinicos":void 0,"pestanas-consulta-med":void 0,cargos:void 0,impuestos:void 0,"catalogo-de-cuentas":void 0,suscripcion:void 0,consultorios:n3,profesionales:r3,"importar-procedimientos":zU};function i3(t=""){const e=t.toLowerCase().indexOf("/config/");return e===-1?[]:t.slice(e+8).split("/").filter(Boolean)}function o3(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function a3({current:t,onNav:e}){const n=[{slug:"datos-basicos",label:"Datos bsicos"},{slug:"logo",label:"Logo"},{slug:"lista-de-precios",label:"Lista de precios"},{slug:"planes",label:"Planes"},{slug:"consecutivos",label:"Consecutivos"},{slug:"almacenes",label:"Almacenes",soon:!0},{slug:"categorias-inventario",label:"Categoras inventario",soon:!0},{slug:"sucursales",label:"Sucursales"},{slug:"metodos-de-pago",label:"Mtodos de pago",soon:!0},{slug:"bancos",label:"Bancos",soon:!0},{slug:"formulario-de-pacientes",label:"Formulario de pacientes",soon:!0},{slug:"especialidades",label:"Especialidades"},{slug:"perfiles",label:"Perfiles",soon:!0},{slug:"usuarios",label:"Usuarios",soon:!0},{slug:"condiciones-de-pago",label:"Condiciones de pago",soon:!0},{slug:"parametros",label:"Parmetros",soon:!0},{slug:"recursos-fisicos",label:"Recursos fsicos",soon:!0},{slug:"plantillas-doc-clinicos",label:"Plantillas Doc. Clnicos",soon:!0},{slug:"pestanas-consulta-med",label:"Pestaas Consulta Med.",soon:!0},{slug:"cargos",label:"Cargos",soon:!0},{slug:"impuestos",label:"Impuestos",soon:!0},{slug:"catalogo-de-cuentas",label:"Catlogo de cuentas",soon:!0},{slug:"suscripcion",label:"Suscripcin",soon:!0},{slug:"consultorios",label:"Consultorios"},{slug:"profesionales",label:"Profesionales"}];return o.jsxs("aside",{style:{width:300,flex:"0 0 300px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,position:"sticky",top:12,alignSelf:"flex-start",maxHeight:"calc(100vh - 24px)",overflow:"auto"},"aria-label":"Informacin general",children:[o.jsx("h4",{style:{margin:"4px 0 10px",color:"#64748b"},children:"Informacin general"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.map(r=>{const s=r.slug===t;return o.jsxs("button",{type:"button",onClick:()=>!r.soon&&e(r.slug),title:r.soon?"Prximamente":r.label,style:{textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid "+(s?"#60a5fa":"#e5e7eb"),background:s?"#eff6ff":"#f9fafb",fontWeight:600,cursor:r.soon?"not-allowed":"pointer",color:r.soon?"#94a3b8":"#0f172a"},disabled:!!r.soon,children:[r.label," ",r.soon?"  prximamente":""]},r.slug)})})]})}function Q0(){return o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsx("h3",{style:{marginTop:0},children:"Configuracin"}),o.jsxs("p",{className:"oc-muted",style:{margin:0},children:["Selecciona una seccin del men de la izquierda para empezar (por ejemplo, ",o.jsx("b",{children:"Datos bsicos"}),")."]})]})}function l3(){const{pathname:t}=Bn(),e=cs(),n=i3(t),r=n[0]||"",s=n[1]||"",i=o3(t),a=r==="lista-de-precios"&&!s,l=r==="lista-de-precios"&&s==="productos",c=r==="lista-de-precios"&&s==="editar",d=r==="planes"&&!s,f=r==="planes"&&s==="nuevo",h=r==="planes"&&s==="editar";let p=s3[r]||Q0,x={};if(c){const C=n[2]||null;p=UU,x={listaId:C,key:`lpedit-${C||"none"}`}}else l?p=BU:a&&(p=C1);if(r==="planes")if(f)p=$d,x={mode:"new"};else if(h){const C=n[2]||null;p=$d,x={mode:"edit",planId:C,key:`pl-edit-${C||"none"}`}}else d&&(p=$d,x={mode:"list"});const T=C=>e(`${i}/config/${C}`);return w.useEffect(()=>{const C=t.toLowerCase();(C.endsWith("/config")||C.endsWith("/config/"))&&!r&&e(`${i}/config/datos-basicos`,{replace:!0})},[t,r,i,e]),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",gap:16,background:"#f8fafc",padding:16,borderRadius:12},children:[o.jsx(a3,{current:r,onNav:T}),o.jsx("div",{style:{minWidth:0,background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:r?o.jsx(p,{...x}):o.jsx(Q0,{})})]})}const Qr=t=>(Number(t)||0).toLocaleString("es-CO",{maximumFractionDigits:0}),sa=()=>new Date().toISOString().slice(0,10),c3=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),u3=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0),Y0=t=>ot.fromDate(t),d3=()=>{const[t,e]=w.useState(null);return w.useEffect(()=>{const n=rv(Bh,r=>e(r||null));return()=>n()},[]),t},sn=({children:t,align:e})=>o.jsx("th",{className:"oc-th",style:{position:"sticky",top:0,zIndex:1,textAlign:e||"left",background:"var(--oc-surface, #fff)"},children:t}),h3=()=>Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);function f3(){var bt;const t=d3(),e=[{key:"abrir",label:"Abrir caja",icon:""},{key:"abiertas",label:"Cajas abiertas",icon:""},{key:"cerradas",label:"Cajas cerradas",icon:""},{key:"mio",label:"Mi caja (hoy)",icon:""},{key:"simulados",label:"Cierres simulados",icon:""},{key:"bancos",label:"Bancos",icon:""}],[n,r]=w.useState("abiertas"),[s,i]=w.useState(""),[a,l]=w.useState(""),c=w.useRef(null),[d,f]=w.useState(!1),[h,p]=w.useState(""),[x,T]=w.useState([]),[C,N]=w.useState(!0),[_,E]=w.useState([]),[S,I]=w.useState(!0),[L,V]=w.useState(null),[g,v]=w.useState(!0),[b,P]=w.useState(""),[R,O]=w.useState([]),[k,M]=w.useState(null),[z,ve]=w.useState(""),[we,ee]=w.useState("efectivo"),[te,ne]=w.useState(!1),[me,Ne]=w.useState("ingreso"),[ke,He]=w.useState(""),[st,De]=w.useState(""),[We,Ge]=w.useState(!1),[_t,W]=w.useState([]),[fe,ye]=w.useState([]);w.useEffect(()=>{const q=Le(se(Q,"cajas"),Xe("estado","==","abierta"),gt("fechaApertura","desc")),ce=cn(q,D=>{T(D.docs.map(F=>J(F.id,F.data()))),N(!1),i("")},D=>{console.error(D),i((D==null?void 0:D.code)==="failed-precondition"?"Falta ndice (estado, fechaApertura) en Firestore.":(D==null?void 0:D.code)==="permission-denied"?"Permiso denegado en Firestore (revisa reglas).":"No se pudieron leer las cajas."),N(!1)});return()=>ce()},[]),w.useEffect(()=>{const q=Le(se(Q,"cajas"),Xe("estado","==","cerrada"),gt("fechaCierre","desc")),ce=cn(q,D=>{E(D.docs.map(F=>J(F.id,F.data()))),I(!1)},D=>{console.error(D),I(!1)});return()=>ce()},[]),w.useEffect(()=>{if(!t){V(null),v(!1);return}v(!0);const q=Le(se(Q,"cajas"),Xe("estado","==","abierta"),Xe("usuarioId","==",t.uid),Xe("fechaApertura",">=",Y0(c3())),Xe("fechaApertura","<",Y0(u3()))),ce=cn(q,D=>{const F=D.docs[0];V(F?J(F.id,F.data()):null),v(!1)},D=>{console.error(D),v(!1),(D==null?void 0:D.code)==="failed-precondition"&&i("Falta ndice (estado, usuarioId, fechaApertura) en Firestore.")});return()=>ce()},[t]),w.useEffect(()=>{if(!(L!=null&&L.id)){W([]),ye([]);return}const q=Le(se(Q,"movimientos"),Xe("cashId","==",L.id),Xe("dia","==",sa()),gt("fecha","desc")),ce=cn(q,re=>W(re.docs.map(ue=>({id:ue.id,...ue.data()}))),re=>console.error(re)),D=Le(se(Q,"payments"),Xe("cashId","==",L.id),Xe("dia","==",sa()),gt("fecha","desc")),F=cn(D,re=>ye(re.docs.map(ue=>({id:ue.id,...ue.data()}))),re=>console.error(re));return()=>{ce(),F()}},[L==null?void 0:L.id]),w.useEffect(()=>{if(!(b!=null&&b.trim())){O([]);return}const q=Le(se(Q,"patients"),Xe("q",">=",B(b)),Xe("q","<=",B(b)+""),gt("q","asc")),ce=cn(q,D=>O(D.docs.map(F=>({id:F.id,...F.data()}))),D=>console.error(D));return()=>ce()},[b]);function J(q,ce={}){const D=rt=>{var dt;return((dt=rt==null?void 0:rt.toDate)==null?void 0:dt.call(rt))||(typeof rt=="string"?new Date(rt):rt||null)},F=D(ce.fechaApertura),re=D(ce.fechaCierre),ue=Number(ce.baseInicial||0),Ae=Number(ce.baseActual!==void 0?ce.baseActual:ue),Pe=Number(ce.saldoInicial||0),$e=Number(ce.saldoActual!==void 0?ce.saldoActual:Pe),Fe=[];return $e<0&&Fe.push("Saldo negativo"),Ae<0&&Fe.push("Base negativa"),{id:q,estado:ce.estado||"abierta",usuarioId:ce.usuarioId||"",usuarioNombre:ce.usuarioNombre||"Usuario",nombre:ce.nombre||ce.usuarioNombre||"Caja",fechaApertura:F,fechaCierre:re,baseInicial:ue,baseActual:Ae,saldoInicial:Pe,saldoActual:$e,ia:Fe}}const Z=async q=>{var ce;if((ce=q==null?void 0:q.preventDefault)==null||ce.call(q),!t){i("Debes iniciar sesin para abrir una caja.");return}f(!0);try{const D=Number(h||0);await zt(se(Q,"cajas"),{estado:"abierta",usuarioId:t.uid,usuarioNombre:t.displayName||t.email||"Usuario",fechaApertura:kt(),baseInicial:D,baseActual:D,saldoInicial:0,saldoActual:0,dia:sa()}),p(""),r("mio"),i("")}catch(D){console.error(D),i("No se pudo abrir la caja.")}finally{f(!1)}},Ie=async q=>{try{await $t(Re(Q,"cajas",q),{estado:"cerrada",fechaCierre:kt()}),r("cerradas")}catch(ce){console.error(ce),i("No se pudo cerrar la caja.")}},ge=async q=>{var D;if((D=q==null?void 0:q.preventDefault)==null||D.call(q),!(L!=null&&L.id)){i("Debes abrir tu caja para registrar movimientos.");return}const ce=Number(st||0);if(!(!ce||ce<=0)){Ge(!0);try{await zt(se(Q,"movimientos"),{cashId:L.id,tipo:me,concepto:ke||(me==="ingreso"?"Ingreso":"Egreso"),valor:ce,fecha:kt(),dia:sa(),usuarioId:(t==null?void 0:t.uid)||null});const F=me==="ingreso"?ce:-ce;await $t(Re(Q,"cajas",L.id),{saldoActual:v0(F)}),He(""),De("")}catch(F){console.error(F),i("No se pudo registrar el movimiento.")}finally{Ge(!1)}}},Y=async q=>{var D;if((D=q==null?void 0:q.preventDefault)==null||D.call(q),!(L!=null&&L.id))return i("Abre tu caja para cobrar.");const ce=Number(z||0);if(!(!ce||ce<=0)){if(!k)return i("Selecciona un paciente.");ne(!0);try{const F=await zt(se(Q,"payments"),{cashId:L.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:ce,medio:we,estado:"aprobado",fecha:kt(),dia:sa()});await $t(Re(Q,"cajas",L.id),{saldoActual:v0(ce)}),ve(""),ee("efectivo"),i(`Pago registrado (${F.id}).`)}catch(F){console.error(F),i("No se pudo registrar el pago.")}finally{ne(!1)}}},X=async q=>{var D;if((D=q==null?void 0:q.preventDefault)==null||D.call(q),!(L!=null&&L.id))return i("Abre tu caja para cobrar.");const ce=Number(z||0);if(!(!ce||ce<=0)){if(!k)return i("Selecciona un paciente.");ne(!0);try{const re=`https://pay.odontocloud/mock/${h3()}`,ue=await zt(se(Q,"payments"),{cashId:L.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:ce,medio:"link",estado:"pending",linkUrl:re,fecha:kt(),dia:sa()});i(`Link de pago generado: ${re}`),ve("")}catch(F){console.error(F),i("No se pudo generar link de pago.")}finally{ne(!1)}}},B=q=>(q||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),pe=w.useMemo(()=>{const q=B(a);return q?x.filter(ce=>[ce.nombre,ce.usuarioNombre,Qr(ce.saldoActual),Qr(ce.baseActual)].map(B).some(D=>D.includes(q))):x},[a,x]),Ve=()=>o.jsxs("div",{className:"card",children:[o.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:o.jsx("h3",{children:"Abrir caja"})}),o.jsxs("form",{className:"oc-form",onSubmit:Z,style:{display:"flex",gap:12,alignItems:"end",flexWrap:"wrap"},children:[o.jsxs("label",{style:{display:"inline-flex",flexDirection:"column",gap:6},children:[o.jsx("span",{children:"Base inicial (COP)"}),o.jsx("input",{type:"number",className:"oc-input",min:"0",step:"1000",value:h,onChange:q=>p(q.target.value),placeholder:"0"})]}),o.jsx("button",{className:"oc-btn",type:"submit",disabled:d,children:d?"Abriendo...":"Abrir caja"})]}),o.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Se asociar a tu usuario y quedar visible en ",o.jsx("b",{children:"Mi caja (hoy)"}),"."]})]}),Be=()=>o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"card",style:{marginBottom:10},children:o.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("h3",{style:{margin:0},children:"Cajas Abiertas"}),o.jsx("span",{className:"oc-tag",children:pe.length}),s&&o.jsx("span",{className:"oc-tag oc-tag-danger",children:s})]}),o.jsx("input",{ref:c,className:"oc-input",style:{maxWidth:280},placeholder:"Buscar...",value:a,onChange:q=>l(q.target.value)})]})}),o.jsx("div",{className:"card",children:o.jsx("div",{className:"oc-table-wrap",children:o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{className:"oc-thead",children:o.jsxs("tr",{className:"oc-tr",children:[o.jsx(sn,{children:"Caja"}),o.jsx(sn,{children:"Fecha apertura"}),o.jsx(sn,{align:"right",children:"Base actual"}),o.jsx(sn,{align:"right",children:"Saldo inicial"}),o.jsx(sn,{align:"right",children:"Saldo actual"}),o.jsx(sn,{children:"Usuario"}),o.jsx(sn,{children:"Acciones"})]})}),o.jsx("tbody",{className:"oc-tbody",children:C?o.jsx(X0,{cols:7}):pe.length===0?o.jsx("tr",{className:"oc-tr",children:o.jsx("td",{className:"oc-td",colSpan:7,children:o.jsx("span",{className:"oc-muted",children:"Sin cajas abiertas."})})}):pe.map(q=>{var ce;return o.jsxs("tr",{className:"oc-tr",children:[o.jsxs("td",{className:"oc-td",children:[o.jsx("b",{children:q.nombre})," ",(ce=q.ia)!=null&&ce.length?o.jsx("span",{className:"oc-tag oc-tag-danger",title:q.ia.join("  "),children:"IA"}):null]}),o.jsx("td",{className:"oc-td",children:q.fechaApertura?q.fechaApertura.toLocaleString("es-CO"):""}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Qr(q.baseActual)]}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Qr(q.saldoInicial)]}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right",color:q.saldoActual<0?"#b91c1c":void 0,fontWeight:600},children:["$",Qr(q.saldoActual)]}),o.jsx("td",{className:"oc-td",children:q.usuarioNombre}),o.jsxs("td",{className:"oc-td",style:{whiteSpace:"nowrap"},children:[o.jsx("button",{className:"oc-small-btn",onClick:()=>r("mio"),children:"Ver"})," ",o.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Ie(q.id),children:"Cerrar"})]})]},q.id)})})]})})})]}),Me=()=>o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("h3",{children:"Mi caja (hoy)"}),(L==null?void 0:L.estado)==="abierta"&&o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("span",{className:"oc-tag oc-tag-success",children:"Abierta"}),o.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Ie(L.id),children:"Cerrar caja"})]})]}),g?o.jsx("div",{className:"oc-muted",children:"Cargando"}):L?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"oc-stats-row",style:{marginBottom:12},children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:"Base actual"}),o.jsxs("span",{className:"stat-value",children:["$",Qr(L.baseActual)]})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:"Saldo actual"}),o.jsxs("span",{className:"stat-value",style:{color:L.saldoActual<0?"#b91c1c":void 0},children:["$",Qr(L.saldoActual)]})]})]}),o.jsxs("div",{className:"card",style:{marginBottom:12},children:[o.jsx("h4",{style:{marginBottom:8},children:"Cobro rpido"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:8},children:[o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("label",{className:"oc-muted",children:"Paciente"}),o.jsx("input",{className:"oc-input",placeholder:"Buscar nombre o documento",value:b,onChange:q=>P(q.target.value)}),b&&R.length>0&&o.jsx("div",{className:"oc-dropdown",children:R.slice(0,6).map(q=>o.jsx("button",{className:`oc-menu-item ${(k==null?void 0:k.id)===q.id?"active":""}`,onClick:()=>{M(q),P(q.nombre||q.name||q.doc||"")},type:"button",children:(q.nombre||q.name||"Paciente")+(q.doc?`  ${q.doc}`:"")},q.id))})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("label",{className:"oc-muted",children:"Monto (COP)"}),o.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:z,onChange:q=>ve(q.target.value)})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("label",{className:"oc-muted",children:"Medio"}),o.jsxs("select",{className:"oc-input",value:we,onChange:q=>ee(q.target.value),children:[o.jsx("option",{value:"efectivo",children:"Efectivo"}),o.jsx("option",{value:"tarjeta",children:"Tarjeta"}),o.jsx("option",{value:"transferencia",children:"Transferencia"}),o.jsx("option",{value:"link",children:"Link (en lnea)"})]})]}),o.jsx("div",{style:{display:"flex",alignItems:"end",gap:6},children:we==="link"?o.jsx("button",{className:"oc-btn",onClick:X,disabled:te,children:te?"Creando":"Generar link"}):o.jsx("button",{className:"oc-btn",onClick:Y,disabled:te,children:te?"Guardando":"Registrar pago"})})]}),o.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Para link, el saldo se actualiza cuando el pago pase a ",o.jsx("b",{children:"aprobado"})," (webhook)."]})]}),o.jsxs("div",{className:"card",style:{marginBottom:12},children:[o.jsx("h4",{style:{marginBottom:8},children:"Movimiento manual"}),o.jsxs("form",{onSubmit:ge,style:{display:"grid",gridTemplateColumns:"120px 1fr 180px auto",gap:8},children:[o.jsxs("select",{className:"oc-input",value:me,onChange:q=>Ne(q.target.value),children:[o.jsx("option",{value:"ingreso",children:"Ingreso"}),o.jsx("option",{value:"egreso",children:"Egreso"})]}),o.jsx("input",{className:"oc-input",placeholder:"Concepto (ej. Caja chica, Arriendo, etc.)",value:ke,onChange:q=>He(q.target.value)}),o.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:st,onChange:q=>De(q.target.value)}),o.jsx("button",{className:"oc-btn",disabled:We,children:We?"Guardando":"Agregar"})]})]}),o.jsxs("div",{className:"card",children:[o.jsx("h4",{style:{marginBottom:8},children:"Movimientos y pagos (hoy)"}),o.jsx("div",{className:"oc-table-wrap",style:{marginBottom:12},children:o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{className:"oc-thead",children:o.jsxs("tr",{className:"oc-tr",children:[o.jsx(sn,{children:"Tipo"}),o.jsx(sn,{children:"Concepto / Paciente"}),o.jsx(sn,{children:"Medio"}),o.jsx(sn,{children:"Estado"}),o.jsx(sn,{align:"right",children:"Valor"}),o.jsx(sn,{children:"Hora"})]})}),o.jsx("tbody",{className:"oc-tbody",children:_t.length===0&&fe.length===0?o.jsx("tr",{className:"oc-tr",children:o.jsx("td",{className:"oc-td",colSpan:6,children:o.jsx("span",{className:"oc-muted",children:"Sin movimientos ni pagos an."})})}):o.jsxs(o.Fragment,{children:[fe.map(q=>{var ce,D;return o.jsxs("tr",{className:"oc-tr",children:[o.jsx("td",{className:"oc-td",children:"Pago"}),o.jsxs("td",{className:"oc-td",children:[q.patientName||"Paciente"," ",q.linkUrl?o.jsx("a",{href:q.linkUrl,target:"_blank",rel:"noreferrer",children:"(link)"}):null]}),o.jsx("td",{className:"oc-td",children:q.medio}),o.jsx("td",{className:"oc-td",children:o.jsx("span",{className:`oc-tag ${q.estado==="aprobado"?"oc-tag-success":q.estado==="pending"?"oc-tag-warning":"oc-tag-danger"}`,children:q.estado})}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Qr(q.valor)]}),o.jsx("td",{className:"oc-td",children:(D=(ce=q.fecha)==null?void 0:ce.toDate)!=null&&D.call(ce)?q.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`pay-${q.id}`)}),_t.map(q=>{var ce,D;return o.jsxs("tr",{className:"oc-tr",children:[o.jsx("td",{className:"oc-td",children:q.tipo}),o.jsx("td",{className:"oc-td",children:q.concepto}),o.jsx("td",{className:"oc-td",children:""}),o.jsx("td",{className:"oc-td",children:o.jsx("span",{className:"oc-tag",children:(q.tipo==="ingreso","ok")})}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Qr(q.valor)]}),o.jsx("td",{className:"oc-td",children:(D=(ce=q.fecha)==null?void 0:ce.toDate)!=null&&D.call(ce)?q.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`mov-${q.id}`)})]})})]})}),o.jsx("p",{className:"oc-muted",children:"Sugerencia: crea ndice compuesto para `movimientos(cashId, dia, fecha)` y `payments(cashId, dia, fecha)` para rendimiento."})]})]}):o.jsxs("div",{className:"oc-empty",children:[o.jsx("p",{className:"oc-muted",children:"No tienes una caja abierta hoy."}),o.jsx("button",{className:"oc-btn",onClick:()=>r("abrir"),children:"Abrir caja"})]})]}),Ke=()=>o.jsxs("div",{className:"card",children:[o.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:o.jsxs("h3",{children:["Cajas cerradas ",o.jsx("span",{className:"oc-tag",children:_.length})]})}),o.jsx("div",{className:"oc-table-wrap",children:o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{className:"oc-thead",children:o.jsxs("tr",{className:"oc-tr",children:[o.jsx(sn,{children:"Caja"}),o.jsx(sn,{children:"Usuario"}),o.jsx(sn,{children:"Apertura"}),o.jsx(sn,{children:"Cierre"}),o.jsx(sn,{align:"right",children:"Saldo final"})]})}),o.jsx("tbody",{className:"oc-tbody",children:S?o.jsx(X0,{cols:5}):_.length===0?o.jsx("tr",{className:"oc-tr",children:o.jsx("td",{className:"oc-td",colSpan:5,children:o.jsx("span",{className:"oc-muted",children:"Sin cajas cerradas."})})}):_.map(q=>o.jsxs("tr",{className:"oc-tr",children:[o.jsx("td",{className:"oc-td",children:q.nombre}),o.jsx("td",{className:"oc-td",children:q.usuarioNombre}),o.jsx("td",{className:"oc-td",children:q.fechaApertura?q.fechaApertura.toLocaleString("es-CO"):""}),o.jsx("td",{className:"oc-td",children:q.fechaCierre?q.fechaCierre.toLocaleString("es-CO"):""}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Qr(q.saldoActual)]})]},q.id))})]})})]}),xe=()=>o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Cierres simulados"}),o.jsx("p",{className:"oc-muted",children:"El cierre hipottico compara ventas y movimientos detectando errores y descuadres con IA. (Conectar fuente de datos para activarlo)."})]}),lt=()=>o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Bancos"}),o.jsx("p",{className:"oc-muted",children:"Conciliacin de consignaciones/pagos electrnicos contra caja del da. (Conectar pasarela o extractos para habilitar)."})]}),Ze=({m:q})=>o.jsxs("button",{type:"button",onClick:()=>r(q.key),className:`oc-menu-item ${n===q.key?"active":""}`,style:{width:"100%",textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid transparent",background:n===q.key?"var(--oc-surface-2, #f3f6ff)":"transparent",fontWeight:600},title:q.label,children:[o.jsx("span",{style:{opacity:.8,marginRight:6},children:q.icon}),q.label]});return o.jsxs("div",{className:"oc-main-content",style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:16},children:[o.jsx("aside",{className:"card",role:"navigation","aria-label":"Men de caja",style:{height:"fit-content",padding:12},children:o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:e.map(q=>o.jsx(Ze,{m:q},q.key))})}),o.jsxs("section",{children:[o.jsx("div",{className:"card",style:{marginBottom:12,padding:12},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[o.jsxs("div",{className:"oc-breadcrumb",children:[o.jsx("span",{children:"Caja"}),o.jsx("span",{children:""}),o.jsx("b",{children:(bt=e.find(q=>q.key===n))==null?void 0:bt.label})]}),n==="abiertas"&&o.jsx("input",{ref:c,className:"oc-input",placeholder:"Buscar...",value:a,onChange:q=>l(q.target.value),style:{maxWidth:300}})]})}),n==="abrir"&&o.jsx(Ve,{}),n==="abiertas"&&o.jsx(Be,{}),n==="cerradas"&&o.jsx(Ke,{}),n==="mio"&&o.jsx(Me,{}),n==="simulados"&&o.jsx(xe,{}),n==="bancos"&&o.jsx(lt,{})]})]})}function X0({cols:t=6,n:e=3}){return o.jsx(o.Fragment,{children:Array.from({length:e}).map((n,r)=>o.jsx("tr",{className:"oc-tr",children:Array.from({length:t}).map((s,i)=>o.jsx("td",{className:"oc-td",children:o.jsx("div",{style:{height:12,width:i===0?160:100+i%3*40,background:"var(--oc-skeleton, #e5e7eb)",borderRadius:6}})},i))},r))})}function p3({items:t=[]}){return o.jsxs("div",{className:"card activity-card",children:[o.jsx("h4",{children:"Actividad reciente"}),o.jsx("ul",{className:"activity-list",children:t.map(e=>o.jsxs("li",{children:[o.jsx("strong",{children:e.title}),o.jsx("div",{className:"time",children:e.time})]},e.id))})]})}function m3({status:t}){return t?o.jsxs("div",{className:"card",children:[o.jsx("h4",{children:"Automatizaciones (N8N)"}),o.jsxs("div",{className:"n8n-line",children:[o.jsx("strong",{children:"Conectado:"})," ",t.connected?"S":"No"]}),o.jsxs("div",{className:"n8n-line",children:[o.jsx("strong",{children:"Flujos activos:"})," ",t.flowsRunning]}),t.lastError&&o.jsxs("div",{className:"n8n-error",children:["Error: ",t.lastError]})]}):null}const dm={es:{nav_home:"Inicio",nav_agenda:"Agenda",nav_patients:"Pacientes",nav_billing:"Facturacin",nav_inventory:"Inventario",nav_odontogram:"Odontograma",nav_reports:"Reportes",nav_cash:"Caja",nav_admin:"Administracin",welcomeTitle:"Bienvenido a OdontoCloud",welcomeSubtitle:"Administra tus pacientes, agenda, inventario y facturacin de manera inteligente y moderna.",clinicLabel:"Clnica",userLabel:"Usuario",roleLabel:"Rol",searchPlaceholder:"Buscar acciones o ir a",stats_patientsToday:"Pacientes totales",stats_appointmentsToday:"Citas hoy",stats_revenueToday:"Facturacin hoy",stats_waiting:"En espera",stats_currency:"COP",n8n_title:"Automatizaciones (n8n)",recent_title:"Actividad reciente",recent_empty:"Sin actividad registrada.",loading:"Cargando...",logout:"Cerrar sesin",module_coming:"Mdulo prximamente.",todays_appts:"Citas de hoy",see_schedule:"Ir a Agenda",no_appts_today:"No hay citas programadas hoy.",at:"a las"},en:{nav_home:"Overview",nav_agenda:"Schedule",nav_patients:"Patients",nav_billing:"Billing",nav_inventory:"Inventory",nav_odontogram:"Odontogram",nav_reports:"Reports",nav_cash:"Cash",nav_admin:"Administration",welcomeTitle:"Welcome to OdontoCloud",welcomeSubtitle:"Manage your patients, schedule, inventory and billing in a smart and modern way.",clinicLabel:"Clinic",userLabel:"User",roleLabel:"Role",searchPlaceholder:"Search actions or go to",stats_patientsToday:"Total patients",stats_appointmentsToday:"Appointments today",stats_revenueToday:"Revenue today",stats_waiting:"In waiting room",stats_currency:"COP",n8n_title:"Automations (n8n)",recent_title:"Recent activity",recent_empty:"No activity yet.",loading:"Loading...",logout:"Log out",module_coming:"Module coming soon.",todays_appts:"Today's appointments",see_schedule:"Open Schedule",no_appts_today:"No appointments today.",at:"at"}},N1=()=>typeof navigator>"u"||(navigator.language||navigator.userLanguage||"es").toLowerCase().startsWith("es")?"es":"en",g3=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},y3=()=>w.useMemo(()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0);return{startToday:ot.fromDate(e),endToday:ot.fromDate(n),startTodayJS:e}},[]),v3=t=>`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,_3=(t,e)=>t.toLocaleTimeString(e==="es"?"es-CO":"en-US",{hour:"2-digit",minute:"2-digit"}),x3=(t,e)=>{try{const[n,r,s]=(t||"").split("-").map(l=>parseInt(l,10)),[i=0,a=0]=(e||"00:00").split(":").map(l=>parseInt(l,10));return new Date(n,(r||1)-1,s||1,i,a,0,0)}catch{return new Date}};function b3({data:t=[]}){const s=Math.max(1,...t.map(d=>Number(d.value)||0)),i=t.length||7,a=10,l=Math.max(16,Math.min(44,(640-a*(i+1))/i)),c=(l+a)*i+a;return o.jsx("div",{style:{width:"100%",overflowX:"auto"},children:o.jsxs("svg",{width:c,height:240,role:"img","aria-label":"Pacientes registrados por da en la ltima semana",children:[[.25,.5,.75,1].map((d,f)=>{const h=18+(1-d)*182;return o.jsx("line",{x1:0,x2:c,y1:h,y2:h,stroke:"#e5e7eb",strokeDasharray:"4 4"},f)}),t.map((d,f)=>{const h=Number(d.value)||0,p=Math.round(h/s*182),x=a+f*(l+a),T=200-p;return o.jsxs("g",{children:[o.jsx("rect",{x,y:T,width:l,height:p,rx:"6",ry:"6",fill:h>0?"#0ea5e9":"#cbd5e1",children:o.jsx("title",{children:`${d.label||d.shortLabel||""}  ${h} paciente${h!==1?"s":""}`})}),h>0&&p>14&&o.jsx("text",{x:x+l/2,y:T-6,textAnchor:"middle",fontSize:"11",fill:"#0f172a",children:h}),o.jsx("text",{x:x+l/2,y:214,textAnchor:"middle",fontSize:"11",fill:"#64748b",children:d.shortLabel||""})]},f)})]})})}function w3({onNavigate:t,onAction:e,placeholder:n}){const[r,s]=w.useState(""),[i,a]=w.useState(!1),[l,c]=w.useState(0),d=w.useRef(null),f=w.useMemo(()=>[{group:"Navegacin",label:"Ir a Inicio",keywords:"inicio home overview",run:()=>t==null?void 0:t("Inicio")},{group:"Navegacin",label:"Ir a Agenda",keywords:"agenda calendario schedule",run:()=>t==null?void 0:t("Agenda")},{group:"Navegacin",label:"Ir a Pacientes",keywords:"pacientes",run:()=>t==null?void 0:t("Pacientes")},{group:"Navegacin",label:"Ir a Facturacin",keywords:"facturacion facturas billing",run:()=>t==null?void 0:t("Facturacin")},{group:"Navegacin",label:"Ir a Inventario",keywords:"inventario stock",run:()=>t==null?void 0:t("Inventario")},{group:"Navegacin",label:"Ir a Odontograma",keywords:"odontograma",run:()=>t==null?void 0:t("Odontograma")},{group:"Navegacin",label:"Ir a Reportes",keywords:"reportes informes",run:()=>t==null?void 0:t("Reportes")},{group:"Acciones",label:"Nueva cita",keywords:"nueva cita agendar",run:()=>e==null?void 0:e("new_appointment")},{group:"Acciones",label:"Nuevo paciente",keywords:"nuevo paciente alta",run:()=>e==null?void 0:e("new_patient")},{group:"Acciones",label:"Nueva factura",keywords:"nueva factura",run:()=>e==null?void 0:e("new_invoice")},{group:"Acciones",label:"Exportar agenda",keywords:"exportar agenda",run:()=>e==null?void 0:e("export_agenda")},{group:"Acciones",label:"Ir a hoy (Agenda)",keywords:"hoy today",run:()=>e==null?void 0:e("agenda_today")},{group:"Acciones",label:"Cambiar modo oscuro",keywords:"oscuro dark mode",run:()=>e==null?void 0:e("toggle_dark")},{group:"Acciones",label:"Cerrar sesin",keywords:"logout salir cerrar",run:()=>e==null?void 0:e("logout")},{group:"Ayuda",label:"Ver atajos de teclado",keywords:"atajos ayuda",run:()=>e==null?void 0:e("show_shortcuts")},{group:"Ayuda",label:"Soporte / Contacto",keywords:"soporte ayuda contacto",run:()=>e==null?void 0:e("support")}],[t,e]),h=w.useMemo(()=>{const C=r.toLowerCase().trim();return C?f.filter(N=>N.label.toLowerCase().includes(C)||N.keywords.includes(C)):[]},[r,f]);w.useEffect(()=>{const C=N=>{d.current&&(d.current.contains(N.target)||a(!1))};return document.addEventListener("mousedown",C),()=>document.removeEventListener("mousedown",C)},[]);const p=C=>{var N;(N=C.run)==null||N.call(C),s(""),a(!1)},x=C=>{!i||h.length===0||(C.key==="ArrowDown"&&(C.preventDefault(),c(N=>(N+1)%h.length)),C.key==="ArrowUp"&&(C.preventDefault(),c(N=>(N-1+h.length)%h.length)),C.key==="Enter"&&(C.preventDefault(),h[l]&&p(h[l])),C.key==="Escape"&&a(!1))},T=w.useMemo(()=>{const C=new Map;return h.forEach(N=>{C.has(N.group)||C.set(N.group,[]),C.get(N.group).push(N)}),Array.from(C.entries())},[h]);return o.jsxs("div",{className:"oc-search-wrap",ref:d,children:[o.jsx("input",{className:"oc-search",type:"search",inputMode:"search",placeholder:n,"aria-label":n,value:r,onChange:C=>{s(C.target.value),a(!!C.target.value),c(0)},onFocus:()=>a(!!r),onKeyDown:x}),i&&o.jsx("div",{className:"oc-search-dropdown",role:"listbox","aria-label":"Resultados de comandos",children:T.length===0?o.jsx("div",{className:"oc-search-item empty",children:"Escribe para ver opciones"}):T.map(([C,N])=>o.jsxs("div",{children:[o.jsx("div",{className:"oc-search-group",children:C}),N.map(_=>{const E=h.indexOf(_);return o.jsx("button",{className:`oc-search-item ${E===l?"active":""}`,onMouseEnter:()=>c(E),onClick:()=>p(_),role:"option",children:o.jsx("span",{className:"oc-search-title",children:_.label})},_.label)})]},C))})]})}function E3({open:t,anchorRect:e,onClose:n,onSoon:r,onNavigatePath:s,onSetFactView:i,dark:a}){const[l,c]=w.useState(null),d=w.useRef(null);if(w.useEffect(()=>{if(!t)return;const M=ve=>ve.key==="Escape"&&(n==null?void 0:n()),z=()=>n==null?void 0:n();return window.addEventListener("keydown",M),window.addEventListener("scroll",z,!0),()=>{window.removeEventListener("keydown",M),window.removeEventListener("scroll",!0)}},[t,n]),!t)return null;const f=((e==null?void 0:e.bottom)||60)+8,h=Math.max(12,Math.min(((e==null?void 0:e.left)||300)-160,window.innerWidth-920)),p=10,x=h+360+p,T=a?"#0b1220":"#ffffff",C=a?"#e5e7eb":"#0f172a",N=a?"#0f1a32":"#f3f6ff",_=a?"#1f2a44":"#e2e8f0",E=a?"#b6c1d1":"#475569",S={position:"fixed",top:f,left:h,width:880,maxWidth:"calc(100vw - 24px)",background:T,color:C,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${_}`,zIndex:400,padding:12},I={position:"fixed",top:f,left:x,width:420,maxWidth:"calc(100vw - 24px)",background:T,color:C,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${_}`,zIndex:410,padding:12},L={display:"flex",flexDirection:"column",gap:6,padding:"8px 10px"},V={height:38,borderRadius:10,padding:"0 12px",display:"flex",alignItems:"center",gap:8,fontSize:".92rem",cursor:"pointer",border:"1px solid transparent",background:"transparent",color:C,fontWeight:500,textAlign:"left"},g=(M,z=!0)=>Object.assign(M.currentTarget.style,z?{background:N,borderColor:_}:{background:"transparent",borderColor:"transparent"}),v=()=>{d.current&&clearTimeout(d.current)},b=()=>{v(),d.current=setTimeout(()=>n==null?void 0:n(),180)},P={position:"fixed",top:f,left:h+360,width:p,height:520,zIndex:405},R=[{label:"Recibo de caja",key:"recibo",path:"facturacion/recibo"},{label:"Saldo a favor",key:"saldo",path:"facturacion/saldo"},{label:"Nota crdito",key:"nc",path:"facturacion/nc"},{label:"Nota dbito",key:"nd",path:"facturacion/nd"},{label:"Liquidaciones",key:"liq",path:"facturacion/liq"},{label:"Traslados",key:"tras",path:"facturacion/tras"},{label:"Pagos",key:"pagos",path:"facturacion/pagos"},{label:"rdenes de compra",key:"oc",path:"facturacion/oc"},{label:"Factura de venta",key:"fv",path:"facturacion/facturas"},{label:"Facturas de compra",key:"fc",path:"facturacion/fc"}],O=[{label:"RIPS anteriores (RS-3374)",key:"rips3374"},{label:"RIPS nuevo (RS-2275)",key:"rips2275"}],k=M=>{i==null||i(M.key),s==null||s(M.path),n==null||n()};return o.jsxs(o.Fragment,{children:[o.jsx("div",{onClick:n,style:{position:"fixed",inset:0,background:"transparent",zIndex:399}}),o.jsx("div",{style:S,onMouseEnter:v,onMouseLeave:b,children:o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"360px 1fr",gap:8,alignItems:"start"},children:[o.jsxs("div",{style:L,children:[o.jsx("button",{type:"button",style:V,onMouseEnter:()=>{v(),c("facturacion")},onFocus:()=>{v(),c("facturacion")},onClick:()=>c(M=>M==="facturacion"?null:"facturacion"),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Facturacin "}),o.jsx("button",{type:"button",style:V,onMouseEnter:()=>{v(),c("rips")},onFocus:()=>{v(),c("rips")},onClick:()=>c(M=>M==="rips"?null:"rips"),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" RIPS "}),o.jsx("button",{type:"button",style:V,onClick:()=>s==null?void 0:s("agenda"),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Gestin de agenda"}),o.jsx("button",{type:"button",style:V,onClick:()=>s==null?void 0:s("inventario"),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Inventario"}),o.jsx("button",{type:"button",style:V,onClick:()=>r==null?void 0:r(),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Convenios"}),o.jsx("button",{type:"button",style:V,onClick:()=>r==null?void 0:r(),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Terceros"}),o.jsx("button",{type:"button",style:V,onClick:()=>r==null?void 0:r(),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Campaas"}),o.jsx("button",{type:"button",style:V,onClick:()=>r==null?void 0:r(),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Temperatura y humedad"}),o.jsx("button",{type:"button",style:V,onClick:()=>r==null?void 0:r(),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Residuos"}),o.jsx("button",{type:"button",style:V,onClick:()=>r==null?void 0:r(),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Medicamentos y planes"}),o.jsx("button",{type:"button",style:V,onClick:()=>r==null?void 0:r(),onMouseOver:M=>g(M,!0),onMouseOut:M=>g(M,!1),children:" Esterilizacin"})]}),o.jsx("div",{style:L,children:o.jsxs("div",{style:{fontSize:".85rem",color:E},children:["Accesos rpidos a mdulos de administracin. Pasa el mouse por ",o.jsx("b",{children:"Facturacin"})," o ",o.jsx("b",{children:"RIPS"})," para ver sus acciones."]})})]})}),o.jsx("div",{style:P,onMouseEnter:v,onMouseLeave:b}),l&&o.jsx("div",{style:I,onMouseEnter:v,onMouseLeave:b,children:o.jsx("div",{style:{...L,display:"grid",gridTemplateColumns:"1fr"},children:(l==="facturacion"?R:O).map(M=>o.jsx("button",{type:"button",style:V,onClick:()=>l==="facturacion"?k(M):r==null?void 0:r(),onMouseOver:z=>g(z,!0),onMouseOut:z=>g(z,!1),children:M.label},M.label))})})]})}function I3(){return o.jsx("div",{className:"oc-main-content",children:o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Planes"}),o.jsxs("p",{className:"oc-muted",children:["Vista de Planes integrada. En el siguiente paso reemplazamos este placeholder por el mdulo real (",o.jsx("code",{children:"modules/planes/Planes.jsx"}),") con creacin/edicin, estados y vnculo a facturacin."]})]})})}function S3({t,companyName:e,userName:n,role:r,darkMode:s,weeklySeries:i,weekRangeLabel:a,todaysAppointments:l,todaysLoading:c,metrics:d,metricsLoading:f,n8nState:h,n8nLoading:p,recent:x,recentLoading:T,onGoAgenda:C}){return o.jsxs("div",{className:"oc-main-content",children:[o.jsxs("section",{className:"oc-hero","aria-label":"Resumen general",children:[o.jsxs("div",{className:"oc-hero-text",children:[o.jsx("h1",{children:t("welcomeTitle")}),o.jsx("p",{children:t("welcomeSubtitle")}),o.jsxs("p",{className:"oc-hero-meta",children:[t("clinicLabel"),": ",e,"  ",t("userLabel"),": ",n,"  ",t("roleLabel"),": ",r||""]})]}),o.jsxs("div",{className:"oc-hero-badge","aria-live":"polite",children:[o.jsx("span",{className:"oc-hero-badge-title",children:t("stats_appointmentsToday")}),o.jsx("span",{className:"oc-hero-badge-value",children:f&&c?"":d.citasHoy}),o.jsxs("span",{className:"oc-hero-badge-sub",children:[t("stats_patientsToday"),": ",f?"":d.pacientesHoy]})]})]}),o.jsxs("section",{className:"oc-stats-row","aria-label":"Indicadores del da",children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_patientsToday")}),o.jsx("span",{className:"stat-value",children:d.pacientesHoy})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_appointmentsToday")}),o.jsx("span",{className:"stat-value",children:d.citasHoy})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_revenueToday")}),o.jsxs("span",{className:"stat-value",children:[d.facturacionHoy.toLocaleString("es-CO")," ",o.jsx("span",{className:"stat-currency",children:t("stats_currency")})]})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_waiting")}),o.jsx("span",{className:"stat-value",children:d.enEspera})]})]}),o.jsxs("section",{className:"oc-grid","aria-label":"Contenido principal del dashboard",children:[o.jsx("div",{className:"oc-grid-main",children:o.jsxs("div",{className:"card card-quickcharts",children:[o.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[o.jsx("h3",{children:"Pacientes registrados  ltimos 7 das"}),o.jsx("span",{className:"oc-muted",style:{marginLeft:8,fontSize:12},children:a})]}),i.length===0||i.every(N=>((N==null?void 0:N.value)||0)===0)?o.jsx("p",{className:"oc-weekly-empty",children:"Sin pacientes registrados en la ltima semana."}):o.jsx(b3,{data:i})]})}),o.jsxs("aside",{className:"oc-grid-side","aria-label":"Panel lateral",children:[o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:t("n8n_title")}),p?o.jsx("span",{className:"oc-muted",children:t("loading")}):o.jsx(m3,{status:h})]}),o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[o.jsx("h3",{children:t("todays_appts")}),o.jsx("button",{className:"oc-small-link",type:"button",onClick:C,children:t("see_schedule")})]}),c?o.jsx("span",{className:"oc-muted",children:t("loading")}):l.length===0?o.jsx("p",{className:"oc-muted",children:t("no_appts_today")}):o.jsx("ul",{className:"oc-list",children:l.slice(0,5).map(N=>o.jsxs("li",{className:"oc-list-item",children:[o.jsxs("div",{className:"oc-list-main",children:[o.jsx("b",{children:N.pacienteNombre||"Paciente"})," ",o.jsxs("span",{className:"oc-muted",children:[t("at")," ",_3(N.fecha,N1())]})]}),o.jsx("div",{className:`oc-tag oc-tag-${(N.estado||"programada").toLowerCase().replace(/\s+/g,"-")}`,children:N.estado||"programada"})]},N.id))})]}),o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Actividad reciente"}),T?o.jsx("span",{className:"oc-muted",children:t("loading")}):x.length===0?o.jsx("p",{className:"oc-muted",children:t("recent_empty")}):o.jsx(p3,{items:x})]})]})]}),o.jsxs("footer",{className:"oc-footer",children:[" ",new Date().getFullYear()," OdontoCloud | Creado por Ingeniero Juan Madrid"]})]})}function hm(){const t=cs(),e=Bn(),[n]=w.useState(N1()),r=Y=>dm[n][Y]||Y,[s,i]=w.useState("Inicio"),[a,l]=w.useState("recibo"),[c,d]=w.useState(()=>{try{return localStorage.getItem("odontocloud:dark")==="1"}catch{return!1}});w.useEffect(()=>{try{localStorage.setItem("odontocloud:dark",c?"1":"0")}catch{}document.documentElement.classList.toggle("dark",c)},[c]);const[f]=w.useState(()=>g3()),[h]=w.useState((f==null?void 0:f.rol)||""),[p]=w.useState((f==null?void 0:f.email)||""),[x,T]=w.useState("OdontoCloud"),[C,N]=w.useState(p||"Usuario"),[_,E]=w.useState(!0);w.useEffect(()=>{const Y=rv(Bh,async X=>{try{if(!X){N(p||"Usuario"),T("OdontoCloud"),E(!1);return}N(X.displayName||X.email||p||"Usuario");const B=Re(Q,"empresas",X.uid),pe=await Po(B);T(pe.exists()&&pe.data().nombre||"OdontoCloud")}catch(B){console.error("Error cargando empresa/usuario:",B)}finally{E(!1)}});return()=>Y()},[p]);const[S,I]=w.useState({pacientesHoy:0,citasHoy:0,facturacionHoy:0,enEspera:0}),[L,V]=w.useState(!0),[g,v]=w.useState([]),[b,P]=w.useState([]),[R,O]=w.useState(!0),{startToday:k,endToday:M,startTodayJS:z}=y3(),ve=w.useMemo(()=>v3(z),[z]),we=w.useMemo(()=>{const Y=new Date,X=new Date(Y.getFullYear(),Y.getMonth(),Y.getDate()-6),B=Y,pe=Ve=>Ve.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit",month:"short"}).replace(".","");return`${pe(X)}  ${pe(B)}`},[n]),ee=Y=>{var Be;const X=Y.data()||{};let B;if((Be=X.fecha)!=null&&Be.toDate){B=X.fecha.toDate();const Me=X.horaInicio||X.hora;if(Me&&typeof Me=="string"){const[Ke=0,xe=0]=Me.split(":").map(lt=>parseInt(lt,10));B.setHours(Ke||0,xe||0,0,0)}}else if(typeof X.fecha=="string"){const Me=X.horaInicio||X.hora||"00:00";B=x3(X.fecha,Me)}else B=new Date;const pe=X.pacienteNombre||X.paciente||"Paciente",Ve=X.estado&&String(X.estado)||"programada";return{id:Y.id,fecha:B,pacienteId:X.pacienteId||"",pacienteNombre:pe,estado:Ve,motivo:X.motivo||""}};w.useEffect(()=>{const Y=Le(se(Q,"citas"),Xe("fecha",">=",k),Xe("fecha","<",M),gt("fecha","asc")),X=Le(se(Q,"citas"),Xe("fecha","==",ve));let B=new Map,pe=!1,Ve=!1;const Be=()=>{const xe=Array.from(B.values()).sort((Ze,bt)=>Ze.fecha.getTime()-bt.fecha.getTime()),lt=xe.filter(Ze=>String(Ze.estado).toLowerCase().trim()==="en espera").length;P(xe),I(Ze=>({...Ze,citasHoy:xe.length,enEspera:lt})),pe&&Ve&&O(!1)},Me=cn(Y,xe=>{pe=!0;const lt=new Map(B);xe.docs.forEach(Ze=>lt.set(Ze.id,ee(Ze))),B=lt,Be()},xe=>{console.error("Realtime citas hoy (TS):",xe),pe=!0,Be()}),Ke=cn(X,xe=>{Ve=!0;const lt=new Map(B);xe.docs.forEach(Ze=>lt.set(Ze.id,ee(Ze))),B=lt,Be()},xe=>{console.error("Realtime citas hoy (STR):",xe),Ve=!0,Be()});return()=>{try{Me(),Ke()}catch{}}},[k,M,ve]),w.useEffect(()=>{(async()=>{try{const B=(await vF(se(Q,"pacientes"))).data().count||0;let pe=0;try{const Ve=Le(se(Q,"facturas"),Xe("fecha",">=",k),Xe("fecha","<",M));(await Se(Ve)).forEach(Me=>{const Ke=Me.data();typeof Ke.monto=="number"&&(pe+=Ke.monto)})}catch{pe=0}I(Ve=>({...Ve,pacientesHoy:B,facturacionHoy:pe}))}catch(X){console.error("Error cargando mtricas:",X),I(B=>({...B,pacientesHoy:0,facturacionHoy:0}))}finally{V(!1)}})()},[k,M]),w.useEffect(()=>{const Y=new Date,X=new Date(Y.getFullYear(),Y.getMonth(),Y.getDate()-6),B=new Date(Y.getFullYear(),Y.getMonth(),Y.getDate()+1),pe=new Map;for(let Me=0;Me<7;Me++){const Ke=new Date(Y.getFullYear(),Y.getMonth(),Y.getDate()-(6-Me)),xe=Ke.toISOString().slice(0,10),lt=Ke.toLocaleDateString(n==="es"?"es-ES":"en-US"),Ze=Ke.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit"}).replace(".","");pe.set(xe,{label:lt,shortLabel:Ze,value:0})}const Ve=Le(se(Q,"pacientes"),Xe("createdAt",">=",ot.fromDate(X)),Xe("createdAt","<",ot.fromDate(B))),Be=cn(Ve,Me=>{const Ke=new Map(pe);Me.docs.forEach(xe=>{var ce;const lt=xe.data()||{},Ze=(ce=xe.data().createdAt)!=null&&ce.toDate?xe.data().createdAt.toDate():lt.createdAt?new Date(lt.createdAt):null;if(!Ze||isNaN(Ze))return;const bt=Ze.toISOString().slice(0,10);if(!Ke.has(bt))return;const q=Ke.get(bt);q.value+=1,Ke.set(bt,q)}),v(Array.from(Ke.values()))},Me=>{console.error("Error realtime serie semanal (pacientes):",Me),v(Array.from(pe.values()))});return()=>{try{Be()}catch{}}},[n]);const[te,ne]=w.useState([]),[me,Ne]=w.useState(!0);w.useEffect(()=>{(async()=>{try{const X=Le(se(Q,"actividad"),gt("fecha","desc"),La(5)),B=await Se(X);ne(B.docs.map(pe=>({id:pe.id,title:pe.data().descripcion||pe.data().titulo||"Actividad",time:pe.data().resumenTiempo||""})))}catch(X){console.error("Error cargando actividad:",X),ne([])}finally{Ne(!1)}})()},[]);const[ke,He]=w.useState(null),[st,De]=w.useState(!0);w.useEffect(()=>{(async()=>{try{const X=Re(Q,"integraciones","n8n"),B=await Po(X);He(B.exists()?{connected:!!B.data().connected,flowsRunning:B.data().flowsRunning||0,lastError:B.data().lastError||null}:{connected:!1,flowsRunning:0,lastError:null})}catch(X){console.error("Error cargando estado n8n:",X),He({connected:!1,flowsRunning:0,lastError:"No se pudo leer el estado desde Firebase."})}finally{De(!1)}})()},[]);const We=async()=>{try{localStorage.removeItem("odc_session")}catch{}try{await I2(Bh)}catch(Y){console.error("Error al cerrar sesin:",Y)}window.location.href="/"},[Ge,_t]=w.useState(!1),[W,fe]=w.useState(null),ye=w.useRef(null);w.useRef(null);const J=()=>{var X,B;const Y=(B=(X=ye.current)==null?void 0:X.getBoundingClientRect)==null?void 0:B.call(X);fe(Y),_t(!0)};w.useEffect(()=>{const Y=e.pathname.toLowerCase();if(Y.includes("/config/")){i("Config");return}const X=/\/pacientes\/[^/]+\/planes(\/|$)/.test(Y),B=Y.includes("/pacientes")&&!X,pe=Y.includes("/caja"),Ve=Y.includes("/agenda"),Be=Y.includes("/facturacion"),Me=Y.includes("/inventario"),Ke=Y.includes("/odontograma"),xe=Y.includes("/reportes");i(X?"Planes":B?"Pacientes":pe?"Caja":Ve?"Agenda":Me?"Inventario":Ke?"Odontograma":xe?"Reportes":"Inicio"),Be&&(i("Facturacin"),Y.includes("/pagos")?l("pagos"):Y.includes("/facturas")?l("fv"):Y.includes("/recibo")?l("recibo"):Y.includes("/saldo")?l("saldo"):Y.includes("/nc")?l("nc"):Y.includes("/nd")?l("nd"):Y.includes("/liq")?l("liq"):Y.includes("/tras")?l("tras"):Y.includes("/oc")?l("oc"):Y.includes("/fc")?l("fc"):l("recibo"))},[e.pathname]);const Z=w.useMemo(()=>{const Y=e.pathname.split("/").filter(Boolean),X=Y.findIndex(B=>B.startsWith("dashboard_"));return X>=0?`/${Y.slice(0,X+1).join("/")}`:""},[e.pathname]),Ie=(Y="")=>{const X=String(Y).replace(/^\/+|\/+$/g,""),B=X?`${Z}/${X}`:Z||"/",pe=e.pathname.toLowerCase()===B.toLowerCase();t(B,{replace:pe})},ge=()=>{switch(s){case"Agenda":return o.jsx(dU,{});case"Pacientes":return o.jsx(w.Suspense,{fallback:o.jsx("div",{style:{padding:16},children:"Cargando"}),children:o.jsx(wU,{})});case"Facturacin":return o.jsx(hU,{view:a});case"Inventario":return o.jsx(fU,{});case"Odontograma":return o.jsx(pU,{});case"Reportes":return o.jsx(SU,{});case"Caja":return o.jsx(f3,{});case"Config":case"Configuracin":case"Configuracion":return o.jsx(l3,{});case"Planes":return o.jsx(I3,{});case"Inicio":default:return null}};return o.jsxs("div",{className:`oc-shell ${c?"oc-dark":""}`,children:[o.jsx("a",{href:"#oc-main",className:"oc-skip-link",children:"Saltar al contenido"}),o.jsxs("header",{className:"oc-header",role:"banner",children:[o.jsxs("div",{className:"oc-header-left",children:[o.jsx("img",{src:s1,alt:"OdontoCloud",className:"oc-logo"}),o.jsxs("div",{className:"oc-brand-text",children:[o.jsx("span",{className:"oc-brand-main",children:"OdontoCloud"}),o.jsx("span",{className:"oc-brand-sub",children:_?"...":x})]})]}),o.jsxs("nav",{className:"oc-nav",role:"navigation","aria-label":"Navegacin principal",children:[o.jsx(oa,{to:Z,end:!0,className:({isActive:Y})=>Y&&s==="Inicio"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_home"),children:r("nav_home")}),o.jsx(oa,{to:`${Z}/agenda`,className:({isActive:Y})=>Y||s==="Agenda"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_agenda"),children:r("nav_agenda")}),o.jsx(oa,{to:`${Z}/pacientes`,className:({isActive:Y})=>Y||s==="Pacientes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_patients"),children:r("nav_patients")}),o.jsx(oa,{to:`${Z}/caja`,className:({isActive:Y})=>Y||s==="Caja"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_cash"),children:r("nav_cash")}),o.jsx("button",{type:"button",ref:ye,className:"oc-nav-btn",title:r("nav_admin"),"aria-haspopup":"true","aria-expanded":Ge,onClick:()=>Ge?_t(!1):J(),children:r("nav_admin")}),o.jsx(oa,{to:`${Z}/reportes`,className:({isActive:Y})=>Y||s==="Reportes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_reports"),children:r("nav_reports")})]}),o.jsxs("div",{className:"oc-header-right",children:[o.jsx(w3,{placeholder:r("searchPlaceholder"),onNavigate:Y=>{Y==="Inicio"?Ie(""):Y==="Facturacin"?(l("recibo"),Ie("facturacion/recibo")):Ie(Y.toLowerCase())},onAction:Y=>{switch(Y){case"new_appointment":case"agenda_today":case"export_agenda":Ie("agenda");break;case"new_patient":Ie("pacientes");break;case"new_invoice":l("fv"),Ie("facturacion/facturas");break;case"toggle_dark":d(X=>!X);break;case"logout":We();break;case"show_shortcuts":alert("Atajos: Ctrl/Cmd + K para abrir bsqueda, / para moverse, Enter para ejecutar.");break;case"support":window.open("https://tu-soporte.odc","_blank");break}}}),o.jsx(CU,{basePath:Z,className:"ml-2"}),o.jsx("button",{className:"oc-icon-btn",type:"button",onClick:()=>d(Y=>!Y),"aria-pressed":c,title:c?"Activar modo claro":"Activar modo oscuro",children:c?"":""}),o.jsx("button",{className:"oc-icon-btn",type:"button",onClick:We,title:dm[n].logout,children:dm[n].logout})]})]}),o.jsx(E3,{open:Ge,anchorRect:W,dark:c,onClose:()=>_t(!1),onSoon:()=>{alert("Prximamente"),_t(!1)},onNavigatePath:Y=>{Ie(Y),_t(!1)},onSetFactView:Y=>l(Y)}),o.jsxs("main",{id:"oc-main",className:"oc-main-wrapper",role:"main",children:[s!=="Inicio"&&ge(),s==="Inicio"&&o.jsx(S3,{t:r,companyName:x,userName:C,role:h,darkMode:c,weeklySeries:g,weekRangeLabel:we,todaysAppointments:b,todaysLoading:R,metrics:S,metricsLoading:L,n8nState:ke,n8nLoading:st,recent:te,recentLoading:me,onGoAgenda:()=>Ie("agenda")})]})]})}const j1=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},A1=t=>{const e=(t||"").toLowerCase();return e==="administrador"?"/dashboard_admin":e==="doctor"?"/dashboard_doctor":e==="recepcionista"?"/dashboard_recepcion":"/"};function fm({allowedRoles:t,children:e}){var s;const n=j1();if(!n)return o.jsx(fh,{to:"/",replace:!0});const r=(s=n.rol)==null?void 0:s.toLowerCase();return t.map(i=>i.toLowerCase()).includes(r)?e:o.jsx(fh,{to:A1(n.rol),replace:!0})}function C3(){const t=j1();return o.jsxs(uR,{children:[o.jsx(ia,{path:"/",element:t?o.jsx(fh,{to:A1(t.rol),replace:!0}):o.jsx(U4,{})}),o.jsx(ia,{path:"/dashboard_admin/*",element:o.jsx(fm,{allowedRoles:["administrador"],children:o.jsx(hm,{})})}),o.jsx(ia,{path:"/dashboard_doctor/*",element:o.jsx(fm,{allowedRoles:["doctor"],children:o.jsx(hm,{})})}),o.jsx(ia,{path:"/dashboard_recepcion/*",element:o.jsx(fm,{allowedRoles:["recepcionista"],children:o.jsx(hm,{})})}),o.jsx(ia,{path:"*",element:o.jsx(fh,{to:"/",replace:!0})})]})}async function T3(){try{await b2(Bh,xC),await nF(Q),console.log(" Firebase listo con sesin persistente y modo offline.")}catch(t){console.warn(" Firebase offline/persistencia fall:",t.message)}}const N3="modulepreload",j3=function(t){return"/odontocloud-react/"+t},J0={},A3=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=j3(c),c in J0)return;J0[c]=!0;const d=c.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":N3,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((p,x)=>{h.addEventListener("load",p),h.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function P3(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:a}=t;let l,c;const d=async(h=!0)=>{await c};async function f(){if("serviceWorker"in navigator){if(l=await A3(async()=>{const{Workbox:h}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:h}},[]).then(({Workbox:h})=>new h("/odontocloud-react/sw.js",{scope:"/odontocloud-react/",type:"classic"})).catch(h=>{a==null||a(h)}),!l)return;l.addEventListener("activated",h=>{(h.isUpdate||h.isExternal)&&window.location.reload()}),l.addEventListener("installed",h=>{h.isUpdate||r==null||r()}),l.register({immediate:e}).then(h=>{i?i("/odontocloud-react/sw.js",h):s==null||s(h)}).catch(h=>{a==null||a(h)})}}return c=f(),d}const R3="empresa_logo_url",Z0="empresa_nombre",k3=w.createContext(null);function D3({children:t}){const[e,n]=w.useState(""),[r,s]=w.useState("OdontoCloud"),[i,a]=w.useState(!0);w.useEffect(()=>{var h;let d="";try{d=localStorage.getItem(R3)||""}catch{}d||(d="/assets/logo.png"),n(d);let f="OdontoCloud";try{f=localStorage.getItem(Z0)||((h=document.querySelector('meta[name="company-name"]'))==null?void 0:h.getAttribute("content"))||"OdontoCloud"}catch{}s(f),a(!1)},[]);const c={logoUrl:e,clinicName:r,loading:i,setLogoUrl:n,setClinicName:d=>{const f=d||"OdontoCloud";try{localStorage.setItem(Z0,f)}catch{}let h=document.querySelector('meta[name="company-name"]');h||(h=document.createElement("meta"),h.setAttribute("name","company-name"),document.head.appendChild(h)),h.setAttribute("content",f),s(f)}};return o.jsx(k3.Provider,{value:c,children:t})}const L3="/odontocloud-react/";T3();P3({immediate:!0});pS(document.getElementById("root")).render(o.jsx(qh.StrictMode,{children:o.jsx(D3,{children:o.jsx(kR,{basename:L3,children:o.jsx(C3,{})})})}));
