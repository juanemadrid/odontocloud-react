(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function A1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Fb={exports:{}},jh={},Ub={exports:{}},Ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hc=Symbol.for("react.element"),R1=Symbol.for("react.portal"),P1=Symbol.for("react.fragment"),k1=Symbol.for("react.strict_mode"),j1=Symbol.for("react.profiler"),D1=Symbol.for("react.provider"),O1=Symbol.for("react.context"),L1=Symbol.for("react.forward_ref"),V1=Symbol.for("react.suspense"),M1=Symbol.for("react.memo"),F1=Symbol.for("react.lazy"),F_=Symbol.iterator;function U1(t){return t===null||typeof t!="object"?null:(t=F_&&t[F_]||t["@@iterator"],typeof t=="function"?t:null)}var $b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Bb=Object.assign,zb={};function Ga(t,e,n){this.props=t,this.context=e,this.refs=zb,this.updater=n||$b}Ga.prototype.isReactComponent={};Ga.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ga.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function qb(){}qb.prototype=Ga.prototype;function Rg(t,e,n){this.props=t,this.context=e,this.refs=zb,this.updater=n||$b}var Pg=Rg.prototype=new qb;Pg.constructor=Rg;Bb(Pg,Ga.prototype);Pg.isPureReactComponent=!0;var U_=Array.isArray,Hb=Object.prototype.hasOwnProperty,kg={current:null},Wb={key:!0,ref:!0,__self:!0,__source:!0};function Gb(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)Hb.call(e,r)&&!Wb.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Hc,type:t,key:i,ref:o,props:s,_owner:kg.current}}function $1(t,e){return{$$typeof:Hc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function jg(t){return typeof t=="object"&&t!==null&&t.$$typeof===Hc}function B1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var $_=/\/+/g;function Qf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?B1(""+t.key):e.toString(36)}function nd(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Hc:case R1:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Qf(o,0):r,U_(s)?(n="",t!=null&&(n=t.replace($_,"$&/")+"/"),nd(s,e,n,"",function(d){return d})):s!=null&&(jg(s)&&(s=$1(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace($_,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",U_(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Qf(i,l);o+=nd(i,e,n,c,s)}else if(c=U1(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Qf(i,l++),o+=nd(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Tu(t,e,n){if(t==null)return t;var r=[],s=0;return nd(t,r,"","",function(i){return e.call(n,i,s++)}),r}function z1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Sn={current:null},rd={transition:null},q1={ReactCurrentDispatcher:Sn,ReactCurrentBatchConfig:rd,ReactCurrentOwner:kg};function Kb(){throw Error("act(...) is not supported in production builds of React.")}Ue.Children={map:Tu,forEach:function(t,e,n){Tu(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Tu(t,function(){e++}),e},toArray:function(t){return Tu(t,function(e){return e})||[]},only:function(t){if(!jg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ue.Component=Ga;Ue.Fragment=P1;Ue.Profiler=j1;Ue.PureComponent=Rg;Ue.StrictMode=k1;Ue.Suspense=V1;Ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q1;Ue.act=Kb;Ue.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Bb({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=kg.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)Hb.call(e,c)&&!Wb.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Hc,type:t.type,key:s,ref:i,props:r,_owner:o}};Ue.createContext=function(t){return t={$$typeof:O1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:D1,_context:t},t.Consumer=t};Ue.createElement=Gb;Ue.createFactory=function(t){var e=Gb.bind(null,t);return e.type=t,e};Ue.createRef=function(){return{current:null}};Ue.forwardRef=function(t){return{$$typeof:L1,render:t}};Ue.isValidElement=jg;Ue.lazy=function(t){return{$$typeof:F1,_payload:{_status:-1,_result:t},_init:z1}};Ue.memo=function(t,e){return{$$typeof:M1,type:t,compare:e===void 0?null:e}};Ue.startTransition=function(t){var e=rd.transition;rd.transition={};try{t()}finally{rd.transition=e}};Ue.unstable_act=Kb;Ue.useCallback=function(t,e){return Sn.current.useCallback(t,e)};Ue.useContext=function(t){return Sn.current.useContext(t)};Ue.useDebugValue=function(){};Ue.useDeferredValue=function(t){return Sn.current.useDeferredValue(t)};Ue.useEffect=function(t,e){return Sn.current.useEffect(t,e)};Ue.useId=function(){return Sn.current.useId()};Ue.useImperativeHandle=function(t,e,n){return Sn.current.useImperativeHandle(t,e,n)};Ue.useInsertionEffect=function(t,e){return Sn.current.useInsertionEffect(t,e)};Ue.useLayoutEffect=function(t,e){return Sn.current.useLayoutEffect(t,e)};Ue.useMemo=function(t,e){return Sn.current.useMemo(t,e)};Ue.useReducer=function(t,e,n){return Sn.current.useReducer(t,e,n)};Ue.useRef=function(t){return Sn.current.useRef(t)};Ue.useState=function(t){return Sn.current.useState(t)};Ue.useSyncExternalStore=function(t,e,n){return Sn.current.useSyncExternalStore(t,e,n)};Ue.useTransition=function(){return Sn.current.useTransition()};Ue.version="18.3.1";Ub.exports=Ue;var I=Ub.exports;const Dg=A1(I);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H1=I,W1=Symbol.for("react.element"),G1=Symbol.for("react.fragment"),K1=Object.prototype.hasOwnProperty,Q1=H1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Y1={key:!0,ref:!0,__self:!0,__source:!0};function Qb(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)K1.call(e,r)&&!Y1.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:W1,type:t,key:i,ref:o,props:s,_owner:Q1.current}}jh.Fragment=G1;jh.jsx=Qb;jh.jsxs=Qb;Fb.exports=jh;var a=Fb.exports,Yb={exports:{}},Yn={},Xb={exports:{}},Jb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(te,ue){var ye=te.length;te.push(ue);e:for(;0<ye;){var Pe=ye-1>>>1,Qe=te[Pe];if(0<s(Qe,ue))te[Pe]=ue,te[ye]=Qe,ye=Pe;else break e}}function n(te){return te.length===0?null:te[0]}function r(te){if(te.length===0)return null;var ue=te[0],ye=te.pop();if(ye!==ue){te[0]=ye;e:for(var Pe=0,Qe=te.length,Et=Qe>>>1;Pe<Et;){var $=2*(Pe+1)-1,re=te[$],de=$+1,Ce=te[de];if(0>s(re,ye))de<Qe&&0>s(Ce,re)?(te[Pe]=Ce,te[de]=ye,Pe=de):(te[Pe]=re,te[$]=ye,Pe=$);else if(de<Qe&&0>s(Ce,ye))te[Pe]=Ce,te[de]=ye,Pe=de;else break e}}return ue}function s(te,ue){var ye=te.sortIndex-ue.sortIndex;return ye!==0?ye:te.id-ue.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],f=1,h=null,m=3,v=!1,P=!1,A=!1,C=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(te){for(var ue=n(d);ue!==null;){if(ue.callback===null)r(d);else if(ue.startTime<=te)r(d),ue.sortIndex=ue.expirationTime,e(c,ue);else break;ue=n(d)}}function T(te){if(A=!1,w(te),!P)if(n(c)!==null)P=!0,Dt(V);else{var ue=n(d);ue!==null&&Lt(T,ue.startTime-te)}}function V(te,ue){P=!1,A&&(A=!1,y(E),E=-1),v=!0;var ye=m;try{for(w(ue),h=n(c);h!==null&&(!(h.expirationTime>ue)||te&&!j());){var Pe=h.callback;if(typeof Pe=="function"){h.callback=null,m=h.priorityLevel;var Qe=Pe(h.expirationTime<=ue);ue=t.unstable_now(),typeof Qe=="function"?h.callback=Qe:h===n(c)&&r(c),w(ue)}else r(c);h=n(c)}if(h!==null)var Et=!0;else{var $=n(d);$!==null&&Lt(T,$.startTime-ue),Et=!1}return Et}finally{h=null,m=ye,v=!1}}var U=!1,b=null,E=-1,x=5,S=-1;function j(){return!(t.unstable_now()-S<x)}function L(){if(b!==null){var te=t.unstable_now();S=te;var ue=!0;try{ue=b(!0,te)}finally{ue?k():(U=!1,b=null)}}else U=!1}var k;if(typeof _=="function")k=function(){_(L)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,We=Y.port2;Y.port1.onmessage=L,k=function(){We.postMessage(null)}}else k=function(){C(L,0)};function Dt(te){b=te,U||(U=!0,k())}function Lt(te,ue){E=C(function(){te(t.unstable_now())},ue)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(te){te.callback=null},t.unstable_continueExecution=function(){P||v||(P=!0,Dt(V))},t.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<te?Math.floor(1e3/te):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(te){switch(m){case 1:case 2:case 3:var ue=3;break;default:ue=m}var ye=m;m=ue;try{return te()}finally{m=ye}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(te,ue){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var ye=m;m=te;try{return ue()}finally{m=ye}},t.unstable_scheduleCallback=function(te,ue,ye){var Pe=t.unstable_now();switch(typeof ye=="object"&&ye!==null?(ye=ye.delay,ye=typeof ye=="number"&&0<ye?Pe+ye:Pe):ye=Pe,te){case 1:var Qe=-1;break;case 2:Qe=250;break;case 5:Qe=1073741823;break;case 4:Qe=1e4;break;default:Qe=5e3}return Qe=ye+Qe,te={id:f++,callback:ue,priorityLevel:te,startTime:ye,expirationTime:Qe,sortIndex:-1},ye>Pe?(te.sortIndex=ye,e(d,te),n(c)===null&&te===n(d)&&(A?(y(E),E=-1):A=!0,Lt(T,ye-Pe))):(te.sortIndex=Qe,e(c,te),P||v||(P=!0,Dt(V))),te},t.unstable_shouldYield=j,t.unstable_wrapCallback=function(te){var ue=m;return function(){var ye=m;m=ue;try{return te.apply(this,arguments)}finally{m=ye}}}})(Jb);Xb.exports=Jb;var X1=Xb.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J1=I,Kn=X1;function J(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Zb=new Set,hc={};function To(t,e){Ta(t,e),Ta(t+"Capture",e)}function Ta(t,e){for(hc[t]=e,t=0;t<e.length;t++)Zb.add(e[t])}var ms=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),em=Object.prototype.hasOwnProperty,Z1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,B_={},z_={};function eA(t){return em.call(z_,t)?!0:em.call(B_,t)?!1:Z1.test(t)?z_[t]=!0:(B_[t]=!0,!1)}function tA(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function nA(t,e,n,r){if(e===null||typeof e>"u"||tA(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Cn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var sn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){sn[t]=new Cn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];sn[e]=new Cn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){sn[t]=new Cn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){sn[t]=new Cn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){sn[t]=new Cn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){sn[t]=new Cn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){sn[t]=new Cn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){sn[t]=new Cn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){sn[t]=new Cn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Og=/[\-:]([a-z])/g;function Lg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Og,Lg);sn[e]=new Cn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Og,Lg);sn[e]=new Cn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Og,Lg);sn[e]=new Cn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){sn[t]=new Cn(t,1,!1,t.toLowerCase(),null,!1,!1)});sn.xlinkHref=new Cn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){sn[t]=new Cn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Vg(t,e,n,r){var s=sn.hasOwnProperty(e)?sn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(nA(e,n,s,r)&&(n=null),r||s===null?eA(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Ts=J1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Su=Symbol.for("react.element"),Zo=Symbol.for("react.portal"),ea=Symbol.for("react.fragment"),Mg=Symbol.for("react.strict_mode"),tm=Symbol.for("react.profiler"),eI=Symbol.for("react.provider"),tI=Symbol.for("react.context"),Fg=Symbol.for("react.forward_ref"),nm=Symbol.for("react.suspense"),rm=Symbol.for("react.suspense_list"),Ug=Symbol.for("react.memo"),Us=Symbol.for("react.lazy"),nI=Symbol.for("react.offscreen"),q_=Symbol.iterator;function gl(t){return t===null||typeof t!="object"?null:(t=q_&&t[q_]||t["@@iterator"],typeof t=="function"?t:null)}var Ct=Object.assign,Yf;function Dl(t){if(Yf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Yf=e&&e[1]||""}return`
`+Yf+t}var Xf=!1;function Jf(t,e){if(!t||Xf)return"";Xf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,l=i.length-1;1<=o&&0<=l&&s[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==i[l]){var c=`
`+s[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{Xf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Dl(t):""}function rA(t){switch(t.tag){case 5:return Dl(t.type);case 16:return Dl("Lazy");case 13:return Dl("Suspense");case 19:return Dl("SuspenseList");case 0:case 2:case 15:return t=Jf(t.type,!1),t;case 11:return t=Jf(t.type.render,!1),t;case 1:return t=Jf(t.type,!0),t;default:return""}}function sm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ea:return"Fragment";case Zo:return"Portal";case tm:return"Profiler";case Mg:return"StrictMode";case nm:return"Suspense";case rm:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case tI:return(t.displayName||"Context")+".Consumer";case eI:return(t._context.displayName||"Context")+".Provider";case Fg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Ug:return e=t.displayName||null,e!==null?e:sm(t.type)||"Memo";case Us:e=t._payload,t=t._init;try{return sm(t(e))}catch{}}return null}function sA(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sm(e);case 8:return e===Mg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function pi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function rI(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function iA(t){var e=rI(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Cu(t){t._valueTracker||(t._valueTracker=iA(t))}function sI(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=rI(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function kd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function im(t,e){var n=e.checked;return Ct({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function H_(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=pi(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function iI(t,e){e=e.checked,e!=null&&Vg(t,"checked",e,!1)}function om(t,e){iI(t,e);var n=pi(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?am(t,e.type,n):e.hasOwnProperty("defaultValue")&&am(t,e.type,pi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function W_(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function am(t,e,n){(e!=="number"||kd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ol=Array.isArray;function ha(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+pi(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function lm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(J(91));return Ct({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function G_(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(J(92));if(Ol(n)){if(1<n.length)throw Error(J(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:pi(n)}}function oI(t,e){var n=pi(e.value),r=pi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function K_(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function aI(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cm(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?aI(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Nu,lI=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Nu=Nu||document.createElement("div"),Nu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Nu.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function fc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Gl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},oA=["Webkit","ms","Moz","O"];Object.keys(Gl).forEach(function(t){oA.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Gl[e]=Gl[t]})});function cI(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Gl.hasOwnProperty(t)&&Gl[t]?(""+e).trim():e+"px"}function uI(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=cI(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var aA=Ct({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function um(t,e){if(e){if(aA[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(J(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(J(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(J(61))}if(e.style!=null&&typeof e.style!="object")throw Error(J(62))}}function dm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hm=null;function $g(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var fm=null,fa=null,pa=null;function Q_(t){if(t=Kc(t)){if(typeof fm!="function")throw Error(J(280));var e=t.stateNode;e&&(e=Mh(e),fm(t.stateNode,t.type,e))}}function dI(t){fa?pa?pa.push(t):pa=[t]:fa=t}function hI(){if(fa){var t=fa,e=pa;if(pa=fa=null,Q_(t),e)for(t=0;t<e.length;t++)Q_(e[t])}}function fI(t,e){return t(e)}function pI(){}var Zf=!1;function mI(t,e,n){if(Zf)return t(e,n);Zf=!0;try{return fI(t,e,n)}finally{Zf=!1,(fa!==null||pa!==null)&&(pI(),hI())}}function pc(t,e){var n=t.stateNode;if(n===null)return null;var r=Mh(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(J(231,e,typeof n));return n}var pm=!1;if(ms)try{var yl={};Object.defineProperty(yl,"passive",{get:function(){pm=!0}}),window.addEventListener("test",yl,yl),window.removeEventListener("test",yl,yl)}catch{pm=!1}function lA(t,e,n,r,s,i,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(f){this.onError(f)}}var Kl=!1,jd=null,Dd=!1,mm=null,cA={onError:function(t){Kl=!0,jd=t}};function uA(t,e,n,r,s,i,o,l,c){Kl=!1,jd=null,lA.apply(cA,arguments)}function dA(t,e,n,r,s,i,o,l,c){if(uA.apply(this,arguments),Kl){if(Kl){var d=jd;Kl=!1,jd=null}else throw Error(J(198));Dd||(Dd=!0,mm=d)}}function So(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function gI(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Y_(t){if(So(t)!==t)throw Error(J(188))}function hA(t){var e=t.alternate;if(!e){if(e=So(t),e===null)throw Error(J(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Y_(s),t;if(i===r)return Y_(s),e;i=i.sibling}throw Error(J(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o)throw Error(J(189))}}if(n.alternate!==r)throw Error(J(190))}if(n.tag!==3)throw Error(J(188));return n.stateNode.current===n?t:e}function yI(t){return t=hA(t),t!==null?vI(t):null}function vI(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=vI(t);if(e!==null)return e;t=t.sibling}return null}var _I=Kn.unstable_scheduleCallback,X_=Kn.unstable_cancelCallback,fA=Kn.unstable_shouldYield,pA=Kn.unstable_requestPaint,Ot=Kn.unstable_now,mA=Kn.unstable_getCurrentPriorityLevel,Bg=Kn.unstable_ImmediatePriority,xI=Kn.unstable_UserBlockingPriority,Od=Kn.unstable_NormalPriority,gA=Kn.unstable_LowPriority,wI=Kn.unstable_IdlePriority,Dh=null,Gr=null;function yA(t){if(Gr&&typeof Gr.onCommitFiberRoot=="function")try{Gr.onCommitFiberRoot(Dh,t,void 0,(t.current.flags&128)===128)}catch{}}var br=Math.clz32?Math.clz32:xA,vA=Math.log,_A=Math.LN2;function xA(t){return t>>>=0,t===0?32:31-(vA(t)/_A|0)|0}var Au=64,Ru=4194304;function Ll(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ld(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~s;l!==0?r=Ll(l):(i&=o,i!==0&&(r=Ll(i)))}else o=n&~s,o!==0?r=Ll(o):i!==0&&(r=Ll(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-br(e),s=1<<n,r|=t[n],e&=~s;return r}function wA(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function EA(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-br(i),l=1<<o,c=s[o];c===-1?(!(l&n)||l&r)&&(s[o]=wA(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function gm(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function EI(){var t=Au;return Au<<=1,!(Au&4194240)&&(Au=64),t}function ep(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Wc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-br(e),t[e]=n}function bA(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-br(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function zg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-br(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var st=0;function bI(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var II,qg,TI,SI,CI,ym=!1,Pu=[],ei=null,ti=null,ni=null,mc=new Map,gc=new Map,Bs=[],IA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function J_(t,e){switch(t){case"focusin":case"focusout":ei=null;break;case"dragenter":case"dragleave":ti=null;break;case"mouseover":case"mouseout":ni=null;break;case"pointerover":case"pointerout":mc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":gc.delete(e.pointerId)}}function vl(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Kc(e),e!==null&&qg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function TA(t,e,n,r,s){switch(e){case"focusin":return ei=vl(ei,t,e,n,r,s),!0;case"dragenter":return ti=vl(ti,t,e,n,r,s),!0;case"mouseover":return ni=vl(ni,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return mc.set(i,vl(mc.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,gc.set(i,vl(gc.get(i)||null,t,e,n,r,s)),!0}return!1}function NI(t){var e=Wi(t.target);if(e!==null){var n=So(e);if(n!==null){if(e=n.tag,e===13){if(e=gI(n),e!==null){t.blockedOn=e,CI(t.priority,function(){TI(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function sd(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=vm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);hm=r,n.target.dispatchEvent(r),hm=null}else return e=Kc(n),e!==null&&qg(e),t.blockedOn=n,!1;e.shift()}return!0}function Z_(t,e,n){sd(t)&&n.delete(e)}function SA(){ym=!1,ei!==null&&sd(ei)&&(ei=null),ti!==null&&sd(ti)&&(ti=null),ni!==null&&sd(ni)&&(ni=null),mc.forEach(Z_),gc.forEach(Z_)}function _l(t,e){t.blockedOn===e&&(t.blockedOn=null,ym||(ym=!0,Kn.unstable_scheduleCallback(Kn.unstable_NormalPriority,SA)))}function yc(t){function e(s){return _l(s,t)}if(0<Pu.length){_l(Pu[0],t);for(var n=1;n<Pu.length;n++){var r=Pu[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ei!==null&&_l(ei,t),ti!==null&&_l(ti,t),ni!==null&&_l(ni,t),mc.forEach(e),gc.forEach(e),n=0;n<Bs.length;n++)r=Bs[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Bs.length&&(n=Bs[0],n.blockedOn===null);)NI(n),n.blockedOn===null&&Bs.shift()}var ma=Ts.ReactCurrentBatchConfig,Vd=!0;function CA(t,e,n,r){var s=st,i=ma.transition;ma.transition=null;try{st=1,Hg(t,e,n,r)}finally{st=s,ma.transition=i}}function NA(t,e,n,r){var s=st,i=ma.transition;ma.transition=null;try{st=4,Hg(t,e,n,r)}finally{st=s,ma.transition=i}}function Hg(t,e,n,r){if(Vd){var s=vm(t,e,n,r);if(s===null)up(t,e,r,Md,n),J_(t,r);else if(TA(s,t,e,n,r))r.stopPropagation();else if(J_(t,r),e&4&&-1<IA.indexOf(t)){for(;s!==null;){var i=Kc(s);if(i!==null&&II(i),i=vm(t,e,n,r),i===null&&up(t,e,r,Md,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else up(t,e,r,null,n)}}var Md=null;function vm(t,e,n,r){if(Md=null,t=$g(r),t=Wi(t),t!==null)if(e=So(t),e===null)t=null;else if(n=e.tag,n===13){if(t=gI(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Md=t,null}function AI(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mA()){case Bg:return 1;case xI:return 4;case Od:case gA:return 16;case wI:return 536870912;default:return 16}default:return 16}}var Xs=null,Wg=null,id=null;function RI(){if(id)return id;var t,e=Wg,n=e.length,r,s="value"in Xs?Xs.value:Xs.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return id=s.slice(t,1<r?1-r:void 0)}function od(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ku(){return!0}function ex(){return!1}function Xn(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?ku:ex,this.isPropagationStopped=ex,this}return Ct(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ku)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ku)},persist:function(){},isPersistent:ku}),e}var Ka={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gg=Xn(Ka),Gc=Ct({},Ka,{view:0,detail:0}),AA=Xn(Gc),tp,np,xl,Oh=Ct({},Gc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==xl&&(xl&&t.type==="mousemove"?(tp=t.screenX-xl.screenX,np=t.screenY-xl.screenY):np=tp=0,xl=t),tp)},movementY:function(t){return"movementY"in t?t.movementY:np}}),tx=Xn(Oh),RA=Ct({},Oh,{dataTransfer:0}),PA=Xn(RA),kA=Ct({},Gc,{relatedTarget:0}),rp=Xn(kA),jA=Ct({},Ka,{animationName:0,elapsedTime:0,pseudoElement:0}),DA=Xn(jA),OA=Ct({},Ka,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),LA=Xn(OA),VA=Ct({},Ka,{data:0}),nx=Xn(VA),MA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},FA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $A(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=UA[t])?!!e[t]:!1}function Kg(){return $A}var BA=Ct({},Gc,{key:function(t){if(t.key){var e=MA[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=od(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?FA[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kg,charCode:function(t){return t.type==="keypress"?od(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?od(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),zA=Xn(BA),qA=Ct({},Oh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),rx=Xn(qA),HA=Ct({},Gc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kg}),WA=Xn(HA),GA=Ct({},Ka,{propertyName:0,elapsedTime:0,pseudoElement:0}),KA=Xn(GA),QA=Ct({},Oh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),YA=Xn(QA),XA=[9,13,27,32],Qg=ms&&"CompositionEvent"in window,Ql=null;ms&&"documentMode"in document&&(Ql=document.documentMode);var JA=ms&&"TextEvent"in window&&!Ql,PI=ms&&(!Qg||Ql&&8<Ql&&11>=Ql),sx=" ",ix=!1;function kI(t,e){switch(t){case"keyup":return XA.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jI(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ta=!1;function ZA(t,e){switch(t){case"compositionend":return jI(e);case"keypress":return e.which!==32?null:(ix=!0,sx);case"textInput":return t=e.data,t===sx&&ix?null:t;default:return null}}function eR(t,e){if(ta)return t==="compositionend"||!Qg&&kI(t,e)?(t=RI(),id=Wg=Xs=null,ta=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return PI&&e.locale!=="ko"?null:e.data;default:return null}}var tR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ox(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!tR[t.type]:e==="textarea"}function DI(t,e,n,r){dI(r),e=Fd(e,"onChange"),0<e.length&&(n=new Gg("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Yl=null,vc=null;function nR(t){HI(t,0)}function Lh(t){var e=sa(t);if(sI(e))return t}function rR(t,e){if(t==="change")return e}var OI=!1;if(ms){var sp;if(ms){var ip="oninput"in document;if(!ip){var ax=document.createElement("div");ax.setAttribute("oninput","return;"),ip=typeof ax.oninput=="function"}sp=ip}else sp=!1;OI=sp&&(!document.documentMode||9<document.documentMode)}function lx(){Yl&&(Yl.detachEvent("onpropertychange",LI),vc=Yl=null)}function LI(t){if(t.propertyName==="value"&&Lh(vc)){var e=[];DI(e,vc,t,$g(t)),mI(nR,e)}}function sR(t,e,n){t==="focusin"?(lx(),Yl=e,vc=n,Yl.attachEvent("onpropertychange",LI)):t==="focusout"&&lx()}function iR(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Lh(vc)}function oR(t,e){if(t==="click")return Lh(e)}function aR(t,e){if(t==="input"||t==="change")return Lh(e)}function lR(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Sr=typeof Object.is=="function"?Object.is:lR;function _c(t,e){if(Sr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!em.call(e,s)||!Sr(t[s],e[s]))return!1}return!0}function cx(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ux(t,e){var n=cx(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cx(n)}}function VI(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?VI(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function MI(){for(var t=window,e=kd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=kd(t.document)}return e}function Yg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function cR(t){var e=MI(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&VI(n.ownerDocument.documentElement,n)){if(r!==null&&Yg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=ux(n,i);var o=ux(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var uR=ms&&"documentMode"in document&&11>=document.documentMode,na=null,_m=null,Xl=null,xm=!1;function dx(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;xm||na==null||na!==kd(r)||(r=na,"selectionStart"in r&&Yg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Xl&&_c(Xl,r)||(Xl=r,r=Fd(_m,"onSelect"),0<r.length&&(e=new Gg("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=na)))}function ju(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ra={animationend:ju("Animation","AnimationEnd"),animationiteration:ju("Animation","AnimationIteration"),animationstart:ju("Animation","AnimationStart"),transitionend:ju("Transition","TransitionEnd")},op={},FI={};ms&&(FI=document.createElement("div").style,"AnimationEvent"in window||(delete ra.animationend.animation,delete ra.animationiteration.animation,delete ra.animationstart.animation),"TransitionEvent"in window||delete ra.transitionend.transition);function Vh(t){if(op[t])return op[t];if(!ra[t])return t;var e=ra[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in FI)return op[t]=e[n];return t}var UI=Vh("animationend"),$I=Vh("animationiteration"),BI=Vh("animationstart"),zI=Vh("transitionend"),qI=new Map,hx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wi(t,e){qI.set(t,e),To(e,[t])}for(var ap=0;ap<hx.length;ap++){var lp=hx[ap],dR=lp.toLowerCase(),hR=lp[0].toUpperCase()+lp.slice(1);wi(dR,"on"+hR)}wi(UI,"onAnimationEnd");wi($I,"onAnimationIteration");wi(BI,"onAnimationStart");wi("dblclick","onDoubleClick");wi("focusin","onFocus");wi("focusout","onBlur");wi(zI,"onTransitionEnd");Ta("onMouseEnter",["mouseout","mouseover"]);Ta("onMouseLeave",["mouseout","mouseover"]);Ta("onPointerEnter",["pointerout","pointerover"]);Ta("onPointerLeave",["pointerout","pointerover"]);To("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));To("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));To("onBeforeInput",["compositionend","keypress","textInput","paste"]);To("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));To("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));To("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),fR=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vl));function fx(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,dA(r,e,void 0,t),t.currentTarget=null}function HI(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;fx(s,l,d),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;fx(s,l,d),i=c}}}if(Dd)throw t=mm,Dd=!1,mm=null,t}function mt(t,e){var n=e[Tm];n===void 0&&(n=e[Tm]=new Set);var r=t+"__bubble";n.has(r)||(WI(e,t,2,!1),n.add(r))}function cp(t,e,n){var r=0;e&&(r|=4),WI(n,t,r,e)}var Du="_reactListening"+Math.random().toString(36).slice(2);function xc(t){if(!t[Du]){t[Du]=!0,Zb.forEach(function(n){n!=="selectionchange"&&(fR.has(n)||cp(n,!1,t),cp(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Du]||(e[Du]=!0,cp("selectionchange",!1,e))}}function WI(t,e,n,r){switch(AI(e)){case 1:var s=CA;break;case 4:s=NA;break;default:s=Hg}n=s.bind(null,e,n,t),s=void 0,!pm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function up(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=Wi(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}mI(function(){var d=i,f=$g(n),h=[];e:{var m=qI.get(t);if(m!==void 0){var v=Gg,P=t;switch(t){case"keypress":if(od(n)===0)break e;case"keydown":case"keyup":v=zA;break;case"focusin":P="focus",v=rp;break;case"focusout":P="blur",v=rp;break;case"beforeblur":case"afterblur":v=rp;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":v=tx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":v=PA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":v=WA;break;case UI:case $I:case BI:v=DA;break;case zI:v=KA;break;case"scroll":v=AA;break;case"wheel":v=YA;break;case"copy":case"cut":case"paste":v=LA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":v=rx}var A=(e&4)!==0,C=!A&&t==="scroll",y=A?m!==null?m+"Capture":null:m;A=[];for(var _=d,w;_!==null;){w=_;var T=w.stateNode;if(w.tag===5&&T!==null&&(w=T,y!==null&&(T=pc(_,y),T!=null&&A.push(wc(_,T,w)))),C)break;_=_.return}0<A.length&&(m=new v(m,P,null,n,f),h.push({event:m,listeners:A}))}}if(!(e&7)){e:{if(m=t==="mouseover"||t==="pointerover",v=t==="mouseout"||t==="pointerout",m&&n!==hm&&(P=n.relatedTarget||n.fromElement)&&(Wi(P)||P[gs]))break e;if((v||m)&&(m=f.window===f?f:(m=f.ownerDocument)?m.defaultView||m.parentWindow:window,v?(P=n.relatedTarget||n.toElement,v=d,P=P?Wi(P):null,P!==null&&(C=So(P),P!==C||P.tag!==5&&P.tag!==6)&&(P=null)):(v=null,P=d),v!==P)){if(A=tx,T="onMouseLeave",y="onMouseEnter",_="mouse",(t==="pointerout"||t==="pointerover")&&(A=rx,T="onPointerLeave",y="onPointerEnter",_="pointer"),C=v==null?m:sa(v),w=P==null?m:sa(P),m=new A(T,_+"leave",v,n,f),m.target=C,m.relatedTarget=w,T=null,Wi(f)===d&&(A=new A(y,_+"enter",P,n,f),A.target=w,A.relatedTarget=C,T=A),C=T,v&&P)t:{for(A=v,y=P,_=0,w=A;w;w=Oo(w))_++;for(w=0,T=y;T;T=Oo(T))w++;for(;0<_-w;)A=Oo(A),_--;for(;0<w-_;)y=Oo(y),w--;for(;_--;){if(A===y||y!==null&&A===y.alternate)break t;A=Oo(A),y=Oo(y)}A=null}else A=null;v!==null&&px(h,m,v,A,!1),P!==null&&C!==null&&px(h,C,P,A,!0)}}e:{if(m=d?sa(d):window,v=m.nodeName&&m.nodeName.toLowerCase(),v==="select"||v==="input"&&m.type==="file")var V=rR;else if(ox(m))if(OI)V=aR;else{V=iR;var U=sR}else(v=m.nodeName)&&v.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(V=oR);if(V&&(V=V(t,d))){DI(h,V,n,f);break e}U&&U(t,m,d),t==="focusout"&&(U=m._wrapperState)&&U.controlled&&m.type==="number"&&am(m,"number",m.value)}switch(U=d?sa(d):window,t){case"focusin":(ox(U)||U.contentEditable==="true")&&(na=U,_m=d,Xl=null);break;case"focusout":Xl=_m=na=null;break;case"mousedown":xm=!0;break;case"contextmenu":case"mouseup":case"dragend":xm=!1,dx(h,n,f);break;case"selectionchange":if(uR)break;case"keydown":case"keyup":dx(h,n,f)}var b;if(Qg)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else ta?kI(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(PI&&n.locale!=="ko"&&(ta||E!=="onCompositionStart"?E==="onCompositionEnd"&&ta&&(b=RI()):(Xs=f,Wg="value"in Xs?Xs.value:Xs.textContent,ta=!0)),U=Fd(d,E),0<U.length&&(E=new nx(E,t,null,n,f),h.push({event:E,listeners:U}),b?E.data=b:(b=jI(n),b!==null&&(E.data=b)))),(b=JA?ZA(t,n):eR(t,n))&&(d=Fd(d,"onBeforeInput"),0<d.length&&(f=new nx("onBeforeInput","beforeinput",null,n,f),h.push({event:f,listeners:d}),f.data=b))}HI(h,e)})}function wc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Fd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=pc(t,n),i!=null&&r.unshift(wc(t,i,s)),i=pc(t,e),i!=null&&r.push(wc(t,i,s))),t=t.return}return r}function Oo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function px(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=pc(n,i),c!=null&&o.unshift(wc(n,c,l))):s||(c=pc(n,i),c!=null&&o.push(wc(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var pR=/\r\n?/g,mR=/\u0000|\uFFFD/g;function mx(t){return(typeof t=="string"?t:""+t).replace(pR,`
`).replace(mR,"")}function Ou(t,e,n){if(e=mx(e),mx(t)!==e&&n)throw Error(J(425))}function Ud(){}var wm=null,Em=null;function bm(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Im=typeof setTimeout=="function"?setTimeout:void 0,gR=typeof clearTimeout=="function"?clearTimeout:void 0,gx=typeof Promise=="function"?Promise:void 0,yR=typeof queueMicrotask=="function"?queueMicrotask:typeof gx<"u"?function(t){return gx.resolve(null).then(t).catch(vR)}:Im;function vR(t){setTimeout(function(){throw t})}function dp(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),yc(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);yc(e)}function ri(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function yx(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Qa=Math.random().toString(36).slice(2),zr="__reactFiber$"+Qa,Ec="__reactProps$"+Qa,gs="__reactContainer$"+Qa,Tm="__reactEvents$"+Qa,_R="__reactListeners$"+Qa,xR="__reactHandles$"+Qa;function Wi(t){var e=t[zr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[gs]||n[zr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=yx(t);t!==null;){if(n=t[zr])return n;t=yx(t)}return e}t=n,n=t.parentNode}return null}function Kc(t){return t=t[zr]||t[gs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function sa(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(J(33))}function Mh(t){return t[Ec]||null}var Sm=[],ia=-1;function Ei(t){return{current:t}}function gt(t){0>ia||(t.current=Sm[ia],Sm[ia]=null,ia--)}function dt(t,e){ia++,Sm[ia]=t.current,t.current=e}var mi={},mn=Ei(mi),jn=Ei(!1),io=mi;function Sa(t,e){var n=t.type.contextTypes;if(!n)return mi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Dn(t){return t=t.childContextTypes,t!=null}function $d(){gt(jn),gt(mn)}function vx(t,e,n){if(mn.current!==mi)throw Error(J(168));dt(mn,e),dt(jn,n)}function GI(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(J(108,sA(t)||"Unknown",s));return Ct({},n,r)}function Bd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||mi,io=mn.current,dt(mn,t),dt(jn,jn.current),!0}function _x(t,e,n){var r=t.stateNode;if(!r)throw Error(J(169));n?(t=GI(t,e,io),r.__reactInternalMemoizedMergedChildContext=t,gt(jn),gt(mn),dt(mn,t)):gt(jn),dt(jn,n)}var os=null,Fh=!1,hp=!1;function KI(t){os===null?os=[t]:os.push(t)}function wR(t){Fh=!0,KI(t)}function bi(){if(!hp&&os!==null){hp=!0;var t=0,e=st;try{var n=os;for(st=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}os=null,Fh=!1}catch(s){throw os!==null&&(os=os.slice(t+1)),_I(Bg,bi),s}finally{st=e,hp=!1}}return null}var oa=[],aa=0,zd=null,qd=0,tr=[],nr=0,oo=null,as=1,ls="";function Li(t,e){oa[aa++]=qd,oa[aa++]=zd,zd=t,qd=e}function QI(t,e,n){tr[nr++]=as,tr[nr++]=ls,tr[nr++]=oo,oo=t;var r=as;t=ls;var s=32-br(r)-1;r&=~(1<<s),n+=1;var i=32-br(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,as=1<<32-br(e)+s|n<<s|r,ls=i+t}else as=1<<i|n<<s|r,ls=t}function Xg(t){t.return!==null&&(Li(t,1),QI(t,1,0))}function Jg(t){for(;t===zd;)zd=oa[--aa],oa[aa]=null,qd=oa[--aa],oa[aa]=null;for(;t===oo;)oo=tr[--nr],tr[nr]=null,ls=tr[--nr],tr[nr]=null,as=tr[--nr],tr[nr]=null}var Wn=null,qn=null,_t=!1,wr=null;function YI(t,e){var n=ir(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function xx(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Wn=t,qn=ri(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Wn=t,qn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=oo!==null?{id:as,overflow:ls}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ir(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Wn=t,qn=null,!0):!1;default:return!1}}function Cm(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Nm(t){if(_t){var e=qn;if(e){var n=e;if(!xx(t,e)){if(Cm(t))throw Error(J(418));e=ri(n.nextSibling);var r=Wn;e&&xx(t,e)?YI(r,n):(t.flags=t.flags&-4097|2,_t=!1,Wn=t)}}else{if(Cm(t))throw Error(J(418));t.flags=t.flags&-4097|2,_t=!1,Wn=t}}}function wx(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Wn=t}function Lu(t){if(t!==Wn)return!1;if(!_t)return wx(t),_t=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!bm(t.type,t.memoizedProps)),e&&(e=qn)){if(Cm(t))throw XI(),Error(J(418));for(;e;)YI(t,e),e=ri(e.nextSibling)}if(wx(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(J(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){qn=ri(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}qn=null}}else qn=Wn?ri(t.stateNode.nextSibling):null;return!0}function XI(){for(var t=qn;t;)t=ri(t.nextSibling)}function Ca(){qn=Wn=null,_t=!1}function Zg(t){wr===null?wr=[t]:wr.push(t)}var ER=Ts.ReactCurrentBatchConfig;function wl(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(J(309));var r=n.stateNode}if(!r)throw Error(J(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var l=s.refs;o===null?delete l[i]:l[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(J(284));if(!n._owner)throw Error(J(290,t))}return t}function Vu(t,e){throw t=Object.prototype.toString.call(e),Error(J(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Ex(t){var e=t._init;return e(t._payload)}function JI(t){function e(y,_){if(t){var w=y.deletions;w===null?(y.deletions=[_],y.flags|=16):w.push(_)}}function n(y,_){if(!t)return null;for(;_!==null;)e(y,_),_=_.sibling;return null}function r(y,_){for(y=new Map;_!==null;)_.key!==null?y.set(_.key,_):y.set(_.index,_),_=_.sibling;return y}function s(y,_){return y=ai(y,_),y.index=0,y.sibling=null,y}function i(y,_,w){return y.index=w,t?(w=y.alternate,w!==null?(w=w.index,w<_?(y.flags|=2,_):w):(y.flags|=2,_)):(y.flags|=1048576,_)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function l(y,_,w,T){return _===null||_.tag!==6?(_=_p(w,y.mode,T),_.return=y,_):(_=s(_,w),_.return=y,_)}function c(y,_,w,T){var V=w.type;return V===ea?f(y,_,w.props.children,T,w.key):_!==null&&(_.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Us&&Ex(V)===_.type)?(T=s(_,w.props),T.ref=wl(y,_,w),T.return=y,T):(T=fd(w.type,w.key,w.props,null,y.mode,T),T.ref=wl(y,_,w),T.return=y,T)}function d(y,_,w,T){return _===null||_.tag!==4||_.stateNode.containerInfo!==w.containerInfo||_.stateNode.implementation!==w.implementation?(_=xp(w,y.mode,T),_.return=y,_):(_=s(_,w.children||[]),_.return=y,_)}function f(y,_,w,T,V){return _===null||_.tag!==7?(_=Ji(w,y.mode,T,V),_.return=y,_):(_=s(_,w),_.return=y,_)}function h(y,_,w){if(typeof _=="string"&&_!==""||typeof _=="number")return _=_p(""+_,y.mode,w),_.return=y,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Su:return w=fd(_.type,_.key,_.props,null,y.mode,w),w.ref=wl(y,null,_),w.return=y,w;case Zo:return _=xp(_,y.mode,w),_.return=y,_;case Us:var T=_._init;return h(y,T(_._payload),w)}if(Ol(_)||gl(_))return _=Ji(_,y.mode,w,null),_.return=y,_;Vu(y,_)}return null}function m(y,_,w,T){var V=_!==null?_.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return V!==null?null:l(y,_,""+w,T);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Su:return w.key===V?c(y,_,w,T):null;case Zo:return w.key===V?d(y,_,w,T):null;case Us:return V=w._init,m(y,_,V(w._payload),T)}if(Ol(w)||gl(w))return V!==null?null:f(y,_,w,T,null);Vu(y,w)}return null}function v(y,_,w,T,V){if(typeof T=="string"&&T!==""||typeof T=="number")return y=y.get(w)||null,l(_,y,""+T,V);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Su:return y=y.get(T.key===null?w:T.key)||null,c(_,y,T,V);case Zo:return y=y.get(T.key===null?w:T.key)||null,d(_,y,T,V);case Us:var U=T._init;return v(y,_,w,U(T._payload),V)}if(Ol(T)||gl(T))return y=y.get(w)||null,f(_,y,T,V,null);Vu(_,T)}return null}function P(y,_,w,T){for(var V=null,U=null,b=_,E=_=0,x=null;b!==null&&E<w.length;E++){b.index>E?(x=b,b=null):x=b.sibling;var S=m(y,b,w[E],T);if(S===null){b===null&&(b=x);break}t&&b&&S.alternate===null&&e(y,b),_=i(S,_,E),U===null?V=S:U.sibling=S,U=S,b=x}if(E===w.length)return n(y,b),_t&&Li(y,E),V;if(b===null){for(;E<w.length;E++)b=h(y,w[E],T),b!==null&&(_=i(b,_,E),U===null?V=b:U.sibling=b,U=b);return _t&&Li(y,E),V}for(b=r(y,b);E<w.length;E++)x=v(b,y,E,w[E],T),x!==null&&(t&&x.alternate!==null&&b.delete(x.key===null?E:x.key),_=i(x,_,E),U===null?V=x:U.sibling=x,U=x);return t&&b.forEach(function(j){return e(y,j)}),_t&&Li(y,E),V}function A(y,_,w,T){var V=gl(w);if(typeof V!="function")throw Error(J(150));if(w=V.call(w),w==null)throw Error(J(151));for(var U=V=null,b=_,E=_=0,x=null,S=w.next();b!==null&&!S.done;E++,S=w.next()){b.index>E?(x=b,b=null):x=b.sibling;var j=m(y,b,S.value,T);if(j===null){b===null&&(b=x);break}t&&b&&j.alternate===null&&e(y,b),_=i(j,_,E),U===null?V=j:U.sibling=j,U=j,b=x}if(S.done)return n(y,b),_t&&Li(y,E),V;if(b===null){for(;!S.done;E++,S=w.next())S=h(y,S.value,T),S!==null&&(_=i(S,_,E),U===null?V=S:U.sibling=S,U=S);return _t&&Li(y,E),V}for(b=r(y,b);!S.done;E++,S=w.next())S=v(b,y,E,S.value,T),S!==null&&(t&&S.alternate!==null&&b.delete(S.key===null?E:S.key),_=i(S,_,E),U===null?V=S:U.sibling=S,U=S);return t&&b.forEach(function(L){return e(y,L)}),_t&&Li(y,E),V}function C(y,_,w,T){if(typeof w=="object"&&w!==null&&w.type===ea&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Su:e:{for(var V=w.key,U=_;U!==null;){if(U.key===V){if(V=w.type,V===ea){if(U.tag===7){n(y,U.sibling),_=s(U,w.props.children),_.return=y,y=_;break e}}else if(U.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Us&&Ex(V)===U.type){n(y,U.sibling),_=s(U,w.props),_.ref=wl(y,U,w),_.return=y,y=_;break e}n(y,U);break}else e(y,U);U=U.sibling}w.type===ea?(_=Ji(w.props.children,y.mode,T,w.key),_.return=y,y=_):(T=fd(w.type,w.key,w.props,null,y.mode,T),T.ref=wl(y,_,w),T.return=y,y=T)}return o(y);case Zo:e:{for(U=w.key;_!==null;){if(_.key===U)if(_.tag===4&&_.stateNode.containerInfo===w.containerInfo&&_.stateNode.implementation===w.implementation){n(y,_.sibling),_=s(_,w.children||[]),_.return=y,y=_;break e}else{n(y,_);break}else e(y,_);_=_.sibling}_=xp(w,y.mode,T),_.return=y,y=_}return o(y);case Us:return U=w._init,C(y,_,U(w._payload),T)}if(Ol(w))return P(y,_,w,T);if(gl(w))return A(y,_,w,T);Vu(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,_!==null&&_.tag===6?(n(y,_.sibling),_=s(_,w),_.return=y,y=_):(n(y,_),_=_p(w,y.mode,T),_.return=y,y=_),o(y)):n(y,_)}return C}var Na=JI(!0),ZI=JI(!1),Hd=Ei(null),Wd=null,la=null,ey=null;function ty(){ey=la=Wd=null}function ny(t){var e=Hd.current;gt(Hd),t._currentValue=e}function Am(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ga(t,e){Wd=t,ey=la=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Pn=!0),t.firstContext=null)}function cr(t){var e=t._currentValue;if(ey!==t)if(t={context:t,memoizedValue:e,next:null},la===null){if(Wd===null)throw Error(J(308));la=t,Wd.dependencies={lanes:0,firstContext:t}}else la=la.next=t;return e}var Gi=null;function ry(t){Gi===null?Gi=[t]:Gi.push(t)}function e0(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,ry(e)):(n.next=s.next,s.next=n),e.interleaved=n,ys(t,r)}function ys(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var $s=!1;function sy(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function t0(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function hs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function si(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Ke&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ys(t,n)}return s=r.interleaved,s===null?(e.next=e,ry(r)):(e.next=s.next,s.next=e),r.interleaved=e,ys(t,n)}function ad(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zg(t,n)}}function bx(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Gd(t,e,n,r){var s=t.updateQueue;$s=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?i=d:o.next=d,o=c;var f=t.alternate;f!==null&&(f=f.updateQueue,l=f.lastBaseUpdate,l!==o&&(l===null?f.firstBaseUpdate=d:l.next=d,f.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;o=0,f=d=c=null,l=i;do{var m=l.lane,v=l.eventTime;if((r&m)===m){f!==null&&(f=f.next={eventTime:v,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var P=t,A=l;switch(m=e,v=n,A.tag){case 1:if(P=A.payload,typeof P=="function"){h=P.call(v,h,m);break e}h=P;break e;case 3:P.flags=P.flags&-65537|128;case 0:if(P=A.payload,m=typeof P=="function"?P.call(v,h,m):P,m==null)break e;h=Ct({},h,m);break e;case 2:$s=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,m=s.effects,m===null?s.effects=[l]:m.push(l))}else v={eventTime:v,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},f===null?(d=f=v,c=h):f=f.next=v,o|=m;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;m=l,l=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(!0);if(f===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=f,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);lo|=o,t.lanes=o,t.memoizedState=h}}function Ix(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(J(191,s));s.call(r)}}}var Qc={},Kr=Ei(Qc),bc=Ei(Qc),Ic=Ei(Qc);function Ki(t){if(t===Qc)throw Error(J(174));return t}function iy(t,e){switch(dt(Ic,e),dt(bc,t),dt(Kr,Qc),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:cm(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=cm(e,t)}gt(Kr),dt(Kr,e)}function Aa(){gt(Kr),gt(bc),gt(Ic)}function n0(t){Ki(Ic.current);var e=Ki(Kr.current),n=cm(e,t.type);e!==n&&(dt(bc,t),dt(Kr,n))}function oy(t){bc.current===t&&(gt(Kr),gt(bc))}var It=Ei(0);function Kd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var fp=[];function ay(){for(var t=0;t<fp.length;t++)fp[t]._workInProgressVersionPrimary=null;fp.length=0}var ld=Ts.ReactCurrentDispatcher,pp=Ts.ReactCurrentBatchConfig,ao=0,St=null,qt=null,Jt=null,Qd=!1,Jl=!1,Tc=0,bR=0;function on(){throw Error(J(321))}function ly(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Sr(t[n],e[n]))return!1;return!0}function cy(t,e,n,r,s,i){if(ao=i,St=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ld.current=t===null||t.memoizedState===null?CR:NR,t=n(r,s),Jl){i=0;do{if(Jl=!1,Tc=0,25<=i)throw Error(J(301));i+=1,Jt=qt=null,e.updateQueue=null,ld.current=AR,t=n(r,s)}while(Jl)}if(ld.current=Yd,e=qt!==null&&qt.next!==null,ao=0,Jt=qt=St=null,Qd=!1,e)throw Error(J(300));return t}function uy(){var t=Tc!==0;return Tc=0,t}function $r(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jt===null?St.memoizedState=Jt=t:Jt=Jt.next=t,Jt}function ur(){if(qt===null){var t=St.alternate;t=t!==null?t.memoizedState:null}else t=qt.next;var e=Jt===null?St.memoizedState:Jt.next;if(e!==null)Jt=e,qt=t;else{if(t===null)throw Error(J(310));qt=t,t={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},Jt===null?St.memoizedState=Jt=t:Jt=Jt.next=t}return Jt}function Sc(t,e){return typeof e=="function"?e(t):e}function mp(t){var e=ur(),n=e.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=t;var r=qt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=o=null,c=null,d=i;do{var f=d.lane;if((ao&f)===f)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var h={lane:f,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=r):c=c.next=h,St.lanes|=f,lo|=f}d=d.next}while(d!==null&&d!==i);c===null?o=r:c.next=l,Sr(r,e.memoizedState)||(Pn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,St.lanes|=i,lo|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function gp(t){var e=ur(),n=e.queue;if(n===null)throw Error(J(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);Sr(i,e.memoizedState)||(Pn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function r0(){}function s0(t,e){var n=St,r=ur(),s=e(),i=!Sr(r.memoizedState,s);if(i&&(r.memoizedState=s,Pn=!0),r=r.queue,dy(a0.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Jt!==null&&Jt.memoizedState.tag&1){if(n.flags|=2048,Cc(9,o0.bind(null,n,r,s,e),void 0,null),Zt===null)throw Error(J(349));ao&30||i0(n,e,s)}return s}function i0(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function o0(t,e,n,r){e.value=n,e.getSnapshot=r,l0(e)&&c0(t)}function a0(t,e,n){return n(function(){l0(e)&&c0(t)})}function l0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Sr(t,n)}catch{return!0}}function c0(t){var e=ys(t,1);e!==null&&Ir(e,t,1,-1)}function Tx(t){var e=$r();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Sc,lastRenderedState:t},e.queue=t,t=t.dispatch=SR.bind(null,St,t),[e.memoizedState,t]}function Cc(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=St.updateQueue,e===null?(e={lastEffect:null,stores:null},St.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function u0(){return ur().memoizedState}function cd(t,e,n,r){var s=$r();St.flags|=t,s.memoizedState=Cc(1|e,n,void 0,r===void 0?null:r)}function Uh(t,e,n,r){var s=ur();r=r===void 0?null:r;var i=void 0;if(qt!==null){var o=qt.memoizedState;if(i=o.destroy,r!==null&&ly(r,o.deps)){s.memoizedState=Cc(e,n,i,r);return}}St.flags|=t,s.memoizedState=Cc(1|e,n,i,r)}function Sx(t,e){return cd(8390656,8,t,e)}function dy(t,e){return Uh(2048,8,t,e)}function d0(t,e){return Uh(4,2,t,e)}function h0(t,e){return Uh(4,4,t,e)}function f0(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function p0(t,e,n){return n=n!=null?n.concat([t]):null,Uh(4,4,f0.bind(null,e,t),n)}function hy(){}function m0(t,e){var n=ur();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ly(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function g0(t,e){var n=ur();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ly(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function y0(t,e,n){return ao&21?(Sr(n,e)||(n=EI(),St.lanes|=n,lo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Pn=!0),t.memoizedState=n)}function IR(t,e){var n=st;st=n!==0&&4>n?n:4,t(!0);var r=pp.transition;pp.transition={};try{t(!1),e()}finally{st=n,pp.transition=r}}function v0(){return ur().memoizedState}function TR(t,e,n){var r=oi(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},_0(t))x0(e,n);else if(n=e0(t,e,n,r),n!==null){var s=bn();Ir(n,t,r,s),w0(n,e,r)}}function SR(t,e,n){var r=oi(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(_0(t))x0(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,l=i(o,n);if(s.hasEagerState=!0,s.eagerState=l,Sr(l,o)){var c=e.interleaved;c===null?(s.next=s,ry(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=e0(t,e,s,r),n!==null&&(s=bn(),Ir(n,t,r,s),w0(n,e,r))}}function _0(t){var e=t.alternate;return t===St||e!==null&&e===St}function x0(t,e){Jl=Qd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function w0(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zg(t,n)}}var Yd={readContext:cr,useCallback:on,useContext:on,useEffect:on,useImperativeHandle:on,useInsertionEffect:on,useLayoutEffect:on,useMemo:on,useReducer:on,useRef:on,useState:on,useDebugValue:on,useDeferredValue:on,useTransition:on,useMutableSource:on,useSyncExternalStore:on,useId:on,unstable_isNewReconciler:!1},CR={readContext:cr,useCallback:function(t,e){return $r().memoizedState=[t,e===void 0?null:e],t},useContext:cr,useEffect:Sx,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,cd(4194308,4,f0.bind(null,e,t),n)},useLayoutEffect:function(t,e){return cd(4194308,4,t,e)},useInsertionEffect:function(t,e){return cd(4,2,t,e)},useMemo:function(t,e){var n=$r();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=$r();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=TR.bind(null,St,t),[r.memoizedState,t]},useRef:function(t){var e=$r();return t={current:t},e.memoizedState=t},useState:Tx,useDebugValue:hy,useDeferredValue:function(t){return $r().memoizedState=t},useTransition:function(){var t=Tx(!1),e=t[0];return t=IR.bind(null,t[1]),$r().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=St,s=$r();if(_t){if(n===void 0)throw Error(J(407));n=n()}else{if(n=e(),Zt===null)throw Error(J(349));ao&30||i0(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Sx(a0.bind(null,r,i,t),[t]),r.flags|=2048,Cc(9,o0.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=$r(),e=Zt.identifierPrefix;if(_t){var n=ls,r=as;n=(r&~(1<<32-br(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Tc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=bR++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},NR={readContext:cr,useCallback:m0,useContext:cr,useEffect:dy,useImperativeHandle:p0,useInsertionEffect:d0,useLayoutEffect:h0,useMemo:g0,useReducer:mp,useRef:u0,useState:function(){return mp(Sc)},useDebugValue:hy,useDeferredValue:function(t){var e=ur();return y0(e,qt.memoizedState,t)},useTransition:function(){var t=mp(Sc)[0],e=ur().memoizedState;return[t,e]},useMutableSource:r0,useSyncExternalStore:s0,useId:v0,unstable_isNewReconciler:!1},AR={readContext:cr,useCallback:m0,useContext:cr,useEffect:dy,useImperativeHandle:p0,useInsertionEffect:d0,useLayoutEffect:h0,useMemo:g0,useReducer:gp,useRef:u0,useState:function(){return gp(Sc)},useDebugValue:hy,useDeferredValue:function(t){var e=ur();return qt===null?e.memoizedState=t:y0(e,qt.memoizedState,t)},useTransition:function(){var t=gp(Sc)[0],e=ur().memoizedState;return[t,e]},useMutableSource:r0,useSyncExternalStore:s0,useId:v0,unstable_isNewReconciler:!1};function vr(t,e){if(t&&t.defaultProps){e=Ct({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Rm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ct({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var $h={isMounted:function(t){return(t=t._reactInternals)?So(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=bn(),s=oi(t),i=hs(r,s);i.payload=e,n!=null&&(i.callback=n),e=si(t,i,s),e!==null&&(Ir(e,t,s,r),ad(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=bn(),s=oi(t),i=hs(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=si(t,i,s),e!==null&&(Ir(e,t,s,r),ad(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=bn(),r=oi(t),s=hs(n,r);s.tag=2,e!=null&&(s.callback=e),e=si(t,s,r),e!==null&&(Ir(e,t,r,n),ad(e,t,r))}};function Cx(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!_c(n,r)||!_c(s,i):!0}function E0(t,e,n){var r=!1,s=mi,i=e.contextType;return typeof i=="object"&&i!==null?i=cr(i):(s=Dn(e)?io:mn.current,r=e.contextTypes,i=(r=r!=null)?Sa(t,s):mi),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$h,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Nx(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&$h.enqueueReplaceState(e,e.state,null)}function Pm(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},sy(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=cr(i):(i=Dn(e)?io:mn.current,s.context=Sa(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Rm(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&$h.enqueueReplaceState(s,s.state,null),Gd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ra(t,e){try{var n="",r=e;do n+=rA(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function yp(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function km(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var RR=typeof WeakMap=="function"?WeakMap:Map;function b0(t,e,n){n=hs(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Jd||(Jd=!0,Bm=r),km(t,e)},n}function I0(t,e,n){n=hs(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){km(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){km(t,e),typeof r!="function"&&(ii===null?ii=new Set([this]):ii.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Ax(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new RR;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=qR.bind(null,t,e,n),e.then(t,t))}function Rx(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Px(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=hs(-1,1),e.tag=2,si(n,e,1))),n.lanes|=1),t)}var PR=Ts.ReactCurrentOwner,Pn=!1;function vn(t,e,n,r){e.child=t===null?ZI(e,null,n,r):Na(e,t.child,n,r)}function kx(t,e,n,r,s){n=n.render;var i=e.ref;return ga(e,s),r=cy(t,e,n,r,i,s),n=uy(),t!==null&&!Pn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,vs(t,e,s)):(_t&&n&&Xg(e),e.flags|=1,vn(t,e,r,s),e.child)}function jx(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!xy(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,T0(t,e,i,r,s)):(t=fd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:_c,n(o,r)&&t.ref===e.ref)return vs(t,e,s)}return e.flags|=1,t=ai(i,r),t.ref=e.ref,t.return=e,e.child=t}function T0(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(_c(i,r)&&t.ref===e.ref)if(Pn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Pn=!0);else return e.lanes=t.lanes,vs(t,e,s)}return jm(t,e,n,r,s)}function S0(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},dt(ua,Un),Un|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,dt(ua,Un),Un|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,dt(ua,Un),Un|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,dt(ua,Un),Un|=r;return vn(t,e,s,n),e.child}function C0(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function jm(t,e,n,r,s){var i=Dn(n)?io:mn.current;return i=Sa(e,i),ga(e,s),n=cy(t,e,n,r,i,s),r=uy(),t!==null&&!Pn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,vs(t,e,s)):(_t&&r&&Xg(e),e.flags|=1,vn(t,e,n,s),e.child)}function Dx(t,e,n,r,s){if(Dn(n)){var i=!0;Bd(e)}else i=!1;if(ga(e,s),e.stateNode===null)ud(t,e),E0(e,n,r),Pm(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=cr(d):(d=Dn(n)?io:mn.current,d=Sa(e,d));var f=n.getDerivedStateFromProps,h=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Nx(e,o,r,d),$s=!1;var m=e.memoizedState;o.state=m,Gd(e,r,o,s),c=e.memoizedState,l!==r||m!==c||jn.current||$s?(typeof f=="function"&&(Rm(e,n,f,r),c=e.memoizedState),(l=$s||Cx(e,n,l,r,m,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),o.props=r,o.state=c,o.context=d,r=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,t0(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:vr(e.type,l),o.props=d,h=e.pendingProps,m=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=cr(c):(c=Dn(n)?io:mn.current,c=Sa(e,c));var v=n.getDerivedStateFromProps;(f=typeof v=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||m!==c)&&Nx(e,o,r,c),$s=!1,m=e.memoizedState,o.state=m,Gd(e,r,o,s);var P=e.memoizedState;l!==h||m!==P||jn.current||$s?(typeof v=="function"&&(Rm(e,n,v,r),P=e.memoizedState),(d=$s||Cx(e,n,d,r,m,P,c)||!1)?(f||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,P,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,P,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=P),o.props=r,o.state=P,o.context=c,r=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),r=!1)}return Dm(t,e,n,r,i,s)}function Dm(t,e,n,r,s,i){C0(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&_x(e,n,!1),vs(t,e,i);r=e.stateNode,PR.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Na(e,t.child,null,i),e.child=Na(e,null,l,i)):vn(t,e,l,i),e.memoizedState=r.state,s&&_x(e,n,!0),e.child}function N0(t){var e=t.stateNode;e.pendingContext?vx(t,e.pendingContext,e.pendingContext!==e.context):e.context&&vx(t,e.context,!1),iy(t,e.containerInfo)}function Ox(t,e,n,r,s){return Ca(),Zg(s),e.flags|=256,vn(t,e,n,r),e.child}var Om={dehydrated:null,treeContext:null,retryLane:0};function Lm(t){return{baseLanes:t,cachePool:null,transitions:null}}function A0(t,e,n){var r=e.pendingProps,s=It.current,i=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),dt(It,s&1),t===null)return Nm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=qh(o,r,0,null),t=Ji(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Lm(n),e.memoizedState=Om,t):fy(e,o));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return kR(t,e,o,r,l,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=ai(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=ai(l,i):(i=Ji(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Lm(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Om,r}return i=t.child,t=i.sibling,r=ai(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function fy(t,e){return e=qh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Mu(t,e,n,r){return r!==null&&Zg(r),Na(e,t.child,null,n),t=fy(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function kR(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=yp(Error(J(422))),Mu(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=qh({mode:"visible",children:r.children},s,0,null),i=Ji(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Na(e,t.child,null,o),e.child.memoizedState=Lm(o),e.memoizedState=Om,i);if(!(e.mode&1))return Mu(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(J(419)),r=yp(i,r,void 0),Mu(t,e,o,r)}if(l=(o&t.childLanes)!==0,Pn||l){if(r=Zt,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ys(t,s),Ir(r,t,s,-1))}return _y(),r=yp(Error(J(421))),Mu(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=HR.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,qn=ri(s.nextSibling),Wn=e,_t=!0,wr=null,t!==null&&(tr[nr++]=as,tr[nr++]=ls,tr[nr++]=oo,as=t.id,ls=t.overflow,oo=e),e=fy(e,r.children),e.flags|=4096,e)}function Lx(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Am(t.return,e,n)}function vp(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function R0(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(vn(t,e,r.children,n),r=It.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Lx(t,n,e);else if(t.tag===19)Lx(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(dt(It,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Kd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),vp(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Kd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}vp(e,!0,n,null,i);break;case"together":vp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ud(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function vs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),lo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(J(153));if(e.child!==null){for(t=e.child,n=ai(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ai(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function jR(t,e,n){switch(e.tag){case 3:N0(e),Ca();break;case 5:n0(e);break;case 1:Dn(e.type)&&Bd(e);break;case 4:iy(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;dt(Hd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(dt(It,It.current&1),e.flags|=128,null):n&e.child.childLanes?A0(t,e,n):(dt(It,It.current&1),t=vs(t,e,n),t!==null?t.sibling:null);dt(It,It.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return R0(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),dt(It,It.current),r)break;return null;case 22:case 23:return e.lanes=0,S0(t,e,n)}return vs(t,e,n)}var P0,Vm,k0,j0;P0=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Vm=function(){};k0=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Ki(Kr.current);var i=null;switch(n){case"input":s=im(t,s),r=im(t,r),i=[];break;case"select":s=Ct({},s,{value:void 0}),r=Ct({},r,{value:void 0}),i=[];break;case"textarea":s=lm(t,s),r=lm(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ud)}um(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(hc.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(hc.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&mt("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};j0=function(t,e,n,r){n!==r&&(e.flags|=4)};function El(t,e){if(!_t)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function an(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function DR(t,e,n){var r=e.pendingProps;switch(Jg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return an(e),null;case 1:return Dn(e.type)&&$d(),an(e),null;case 3:return r=e.stateNode,Aa(),gt(jn),gt(mn),ay(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Lu(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,wr!==null&&(Hm(wr),wr=null))),Vm(t,e),an(e),null;case 5:oy(e);var s=Ki(Ic.current);if(n=e.type,t!==null&&e.stateNode!=null)k0(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(J(166));return an(e),null}if(t=Ki(Kr.current),Lu(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[zr]=e,r[Ec]=i,t=(e.mode&1)!==0,n){case"dialog":mt("cancel",r),mt("close",r);break;case"iframe":case"object":case"embed":mt("load",r);break;case"video":case"audio":for(s=0;s<Vl.length;s++)mt(Vl[s],r);break;case"source":mt("error",r);break;case"img":case"image":case"link":mt("error",r),mt("load",r);break;case"details":mt("toggle",r);break;case"input":H_(r,i),mt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},mt("invalid",r);break;case"textarea":G_(r,i),mt("invalid",r)}um(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Ou(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Ou(r.textContent,l,t),s=["children",""+l]):hc.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&mt("scroll",r)}switch(n){case"input":Cu(r),W_(r,i,!0);break;case"textarea":Cu(r),K_(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Ud)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=aI(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[zr]=e,t[Ec]=r,P0(t,e,!1,!1),e.stateNode=t;e:{switch(o=dm(n,r),n){case"dialog":mt("cancel",t),mt("close",t),s=r;break;case"iframe":case"object":case"embed":mt("load",t),s=r;break;case"video":case"audio":for(s=0;s<Vl.length;s++)mt(Vl[s],t);s=r;break;case"source":mt("error",t),s=r;break;case"img":case"image":case"link":mt("error",t),mt("load",t),s=r;break;case"details":mt("toggle",t),s=r;break;case"input":H_(t,r),s=im(t,r),mt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ct({},r,{value:void 0}),mt("invalid",t);break;case"textarea":G_(t,r),s=lm(t,r),mt("invalid",t);break;default:s=r}um(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?uI(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&lI(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&fc(t,c):typeof c=="number"&&fc(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(hc.hasOwnProperty(i)?c!=null&&i==="onScroll"&&mt("scroll",t):c!=null&&Vg(t,i,c,o))}switch(n){case"input":Cu(t),W_(t,r,!1);break;case"textarea":Cu(t),K_(t);break;case"option":r.value!=null&&t.setAttribute("value",""+pi(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ha(t,!!r.multiple,i,!1):r.defaultValue!=null&&ha(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Ud)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return an(e),null;case 6:if(t&&e.stateNode!=null)j0(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(J(166));if(n=Ki(Ic.current),Ki(Kr.current),Lu(e)){if(r=e.stateNode,n=e.memoizedProps,r[zr]=e,(i=r.nodeValue!==n)&&(t=Wn,t!==null))switch(t.tag){case 3:Ou(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ou(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[zr]=e,e.stateNode=r}return an(e),null;case 13:if(gt(It),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_t&&qn!==null&&e.mode&1&&!(e.flags&128))XI(),Ca(),e.flags|=98560,i=!1;else if(i=Lu(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(J(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(J(317));i[zr]=e}else Ca(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;an(e),i=!1}else wr!==null&&(Hm(wr),wr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||It.current&1?Ht===0&&(Ht=3):_y())),e.updateQueue!==null&&(e.flags|=4),an(e),null);case 4:return Aa(),Vm(t,e),t===null&&xc(e.stateNode.containerInfo),an(e),null;case 10:return ny(e.type._context),an(e),null;case 17:return Dn(e.type)&&$d(),an(e),null;case 19:if(gt(It),i=e.memoizedState,i===null)return an(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)El(i,!1);else{if(Ht!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Kd(t),o!==null){for(e.flags|=128,El(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return dt(It,It.current&1|2),e.child}t=t.sibling}i.tail!==null&&Ot()>Pa&&(e.flags|=128,r=!0,El(i,!1),e.lanes=4194304)}else{if(!r)if(t=Kd(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),El(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!_t)return an(e),null}else 2*Ot()-i.renderingStartTime>Pa&&n!==1073741824&&(e.flags|=128,r=!0,El(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ot(),e.sibling=null,n=It.current,dt(It,r?n&1|2:n&1),e):(an(e),null);case 22:case 23:return vy(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Un&1073741824&&(an(e),e.subtreeFlags&6&&(e.flags|=8192)):an(e),null;case 24:return null;case 25:return null}throw Error(J(156,e.tag))}function OR(t,e){switch(Jg(e),e.tag){case 1:return Dn(e.type)&&$d(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Aa(),gt(jn),gt(mn),ay(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return oy(e),null;case 13:if(gt(It),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(J(340));Ca()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return gt(It),null;case 4:return Aa(),null;case 10:return ny(e.type._context),null;case 22:case 23:return vy(),null;case 24:return null;default:return null}}var Fu=!1,un=!1,LR=typeof WeakSet=="function"?WeakSet:Set,ce=null;function ca(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){At(t,e,r)}else n.current=null}function Mm(t,e,n){try{n()}catch(r){At(t,e,r)}}var Vx=!1;function VR(t,e){if(wm=Vd,t=MI(),Yg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,f=0,h=t,m=null;t:for(;;){for(var v;h!==n||s!==0&&h.nodeType!==3||(l=o+s),h!==i||r!==0&&h.nodeType!==3||(c=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(v=h.firstChild)!==null;)m=h,h=v;for(;;){if(h===t)break t;if(m===n&&++d===s&&(l=o),m===i&&++f===r&&(c=o),(v=h.nextSibling)!==null)break;h=m,m=h.parentNode}h=v}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Em={focusedElem:t,selectionRange:n},Vd=!1,ce=e;ce!==null;)if(e=ce,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ce=t;else for(;ce!==null;){e=ce;try{var P=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(P!==null){var A=P.memoizedProps,C=P.memoizedState,y=e.stateNode,_=y.getSnapshotBeforeUpdate(e.elementType===e.type?A:vr(e.type,A),C);y.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(T){At(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,ce=t;break}ce=e.return}return P=Vx,Vx=!1,P}function Zl(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Mm(e,n,i)}s=s.next}while(s!==r)}}function Bh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Fm(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function D0(t){var e=t.alternate;e!==null&&(t.alternate=null,D0(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[zr],delete e[Ec],delete e[Tm],delete e[_R],delete e[xR])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function O0(t){return t.tag===5||t.tag===3||t.tag===4}function Mx(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||O0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Um(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ud));else if(r!==4&&(t=t.child,t!==null))for(Um(t,e,n),t=t.sibling;t!==null;)Um(t,e,n),t=t.sibling}function $m(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for($m(t,e,n),t=t.sibling;t!==null;)$m(t,e,n),t=t.sibling}var en=null,_r=!1;function Ds(t,e,n){for(n=n.child;n!==null;)L0(t,e,n),n=n.sibling}function L0(t,e,n){if(Gr&&typeof Gr.onCommitFiberUnmount=="function")try{Gr.onCommitFiberUnmount(Dh,n)}catch{}switch(n.tag){case 5:un||ca(n,e);case 6:var r=en,s=_r;en=null,Ds(t,e,n),en=r,_r=s,en!==null&&(_r?(t=en,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):en.removeChild(n.stateNode));break;case 18:en!==null&&(_r?(t=en,n=n.stateNode,t.nodeType===8?dp(t.parentNode,n):t.nodeType===1&&dp(t,n),yc(t)):dp(en,n.stateNode));break;case 4:r=en,s=_r,en=n.stateNode.containerInfo,_r=!0,Ds(t,e,n),en=r,_r=s;break;case 0:case 11:case 14:case 15:if(!un&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Mm(n,e,o),s=s.next}while(s!==r)}Ds(t,e,n);break;case 1:if(!un&&(ca(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){At(n,e,l)}Ds(t,e,n);break;case 21:Ds(t,e,n);break;case 22:n.mode&1?(un=(r=un)||n.memoizedState!==null,Ds(t,e,n),un=r):Ds(t,e,n);break;default:Ds(t,e,n)}}function Fx(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new LR),e.forEach(function(r){var s=WR.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function gr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:en=l.stateNode,_r=!1;break e;case 3:en=l.stateNode.containerInfo,_r=!0;break e;case 4:en=l.stateNode.containerInfo,_r=!0;break e}l=l.return}if(en===null)throw Error(J(160));L0(i,o,s),en=null,_r=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){At(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)V0(e,t),e=e.sibling}function V0(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(gr(e,t),Mr(t),r&4){try{Zl(3,t,t.return),Bh(3,t)}catch(A){At(t,t.return,A)}try{Zl(5,t,t.return)}catch(A){At(t,t.return,A)}}break;case 1:gr(e,t),Mr(t),r&512&&n!==null&&ca(n,n.return);break;case 5:if(gr(e,t),Mr(t),r&512&&n!==null&&ca(n,n.return),t.flags&32){var s=t.stateNode;try{fc(s,"")}catch(A){At(t,t.return,A)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&iI(s,i),dm(l,o);var d=dm(l,i);for(o=0;o<c.length;o+=2){var f=c[o],h=c[o+1];f==="style"?uI(s,h):f==="dangerouslySetInnerHTML"?lI(s,h):f==="children"?fc(s,h):Vg(s,f,h,d)}switch(l){case"input":om(s,i);break;case"textarea":oI(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var v=i.value;v!=null?ha(s,!!i.multiple,v,!1):m!==!!i.multiple&&(i.defaultValue!=null?ha(s,!!i.multiple,i.defaultValue,!0):ha(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ec]=i}catch(A){At(t,t.return,A)}}break;case 6:if(gr(e,t),Mr(t),r&4){if(t.stateNode===null)throw Error(J(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(A){At(t,t.return,A)}}break;case 3:if(gr(e,t),Mr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{yc(e.containerInfo)}catch(A){At(t,t.return,A)}break;case 4:gr(e,t),Mr(t);break;case 13:gr(e,t),Mr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(gy=Ot())),r&4&&Fx(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(un=(d=un)||f,gr(e,t),un=d):gr(e,t),Mr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!f&&t.mode&1)for(ce=t,f=t.child;f!==null;){for(h=ce=f;ce!==null;){switch(m=ce,v=m.child,m.tag){case 0:case 11:case 14:case 15:Zl(4,m,m.return);break;case 1:ca(m,m.return);var P=m.stateNode;if(typeof P.componentWillUnmount=="function"){r=m,n=m.return;try{e=r,P.props=e.memoizedProps,P.state=e.memoizedState,P.componentWillUnmount()}catch(A){At(r,n,A)}}break;case 5:ca(m,m.return);break;case 22:if(m.memoizedState!==null){$x(h);continue}}v!==null?(v.return=m,ce=v):$x(h)}f=f.sibling}e:for(f=null,h=t;;){if(h.tag===5){if(f===null){f=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=cI("display",o))}catch(A){At(t,t.return,A)}}}else if(h.tag===6){if(f===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(A){At(t,t.return,A)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;f===h&&(f=null),h=h.return}f===h&&(f=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gr(e,t),Mr(t),r&4&&Fx(t);break;case 21:break;default:gr(e,t),Mr(t)}}function Mr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(O0(n)){var r=n;break e}n=n.return}throw Error(J(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(fc(s,""),r.flags&=-33);var i=Mx(t);$m(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,l=Mx(t);Um(t,l,o);break;default:throw Error(J(161))}}catch(c){At(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function MR(t,e,n){ce=t,M0(t)}function M0(t,e,n){for(var r=(t.mode&1)!==0;ce!==null;){var s=ce,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Fu;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||un;l=Fu;var d=un;if(Fu=o,(un=c)&&!d)for(ce=s;ce!==null;)o=ce,c=o.child,o.tag===22&&o.memoizedState!==null?Bx(s):c!==null?(c.return=o,ce=c):Bx(s);for(;i!==null;)ce=i,M0(i),i=i.sibling;ce=s,Fu=l,un=d}Ux(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ce=i):Ux(t)}}function Ux(t){for(;ce!==null;){var e=ce;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:un||Bh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!un)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:vr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Ix(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ix(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var f=d.memoizedState;if(f!==null){var h=f.dehydrated;h!==null&&yc(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}un||e.flags&512&&Fm(e)}catch(m){At(e,e.return,m)}}if(e===t){ce=null;break}if(n=e.sibling,n!==null){n.return=e.return,ce=n;break}ce=e.return}}function $x(t){for(;ce!==null;){var e=ce;if(e===t){ce=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ce=n;break}ce=e.return}}function Bx(t){for(;ce!==null;){var e=ce;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Bh(4,e)}catch(c){At(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){At(e,s,c)}}var i=e.return;try{Fm(e)}catch(c){At(e,i,c)}break;case 5:var o=e.return;try{Fm(e)}catch(c){At(e,o,c)}}}catch(c){At(e,e.return,c)}if(e===t){ce=null;break}var l=e.sibling;if(l!==null){l.return=e.return,ce=l;break}ce=e.return}}var FR=Math.ceil,Xd=Ts.ReactCurrentDispatcher,py=Ts.ReactCurrentOwner,ar=Ts.ReactCurrentBatchConfig,Ke=0,Zt=null,Ut=null,rn=0,Un=0,ua=Ei(0),Ht=0,Nc=null,lo=0,zh=0,my=0,ec=null,Rn=null,gy=0,Pa=1/0,is=null,Jd=!1,Bm=null,ii=null,Uu=!1,Js=null,Zd=0,tc=0,zm=null,dd=-1,hd=0;function bn(){return Ke&6?Ot():dd!==-1?dd:dd=Ot()}function oi(t){return t.mode&1?Ke&2&&rn!==0?rn&-rn:ER.transition!==null?(hd===0&&(hd=EI()),hd):(t=st,t!==0||(t=window.event,t=t===void 0?16:AI(t.type)),t):1}function Ir(t,e,n,r){if(50<tc)throw tc=0,zm=null,Error(J(185));Wc(t,n,r),(!(Ke&2)||t!==Zt)&&(t===Zt&&(!(Ke&2)&&(zh|=n),Ht===4&&zs(t,rn)),On(t,r),n===1&&Ke===0&&!(e.mode&1)&&(Pa=Ot()+500,Fh&&bi()))}function On(t,e){var n=t.callbackNode;EA(t,e);var r=Ld(t,t===Zt?rn:0);if(r===0)n!==null&&X_(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&X_(n),e===1)t.tag===0?wR(zx.bind(null,t)):KI(zx.bind(null,t)),yR(function(){!(Ke&6)&&bi()}),n=null;else{switch(bI(r)){case 1:n=Bg;break;case 4:n=xI;break;case 16:n=Od;break;case 536870912:n=wI;break;default:n=Od}n=W0(n,F0.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function F0(t,e){if(dd=-1,hd=0,Ke&6)throw Error(J(327));var n=t.callbackNode;if(ya()&&t.callbackNode!==n)return null;var r=Ld(t,t===Zt?rn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=eh(t,r);else{e=r;var s=Ke;Ke|=2;var i=$0();(Zt!==t||rn!==e)&&(is=null,Pa=Ot()+500,Xi(t,e));do try{BR();break}catch(l){U0(t,l)}while(!0);ty(),Xd.current=i,Ke=s,Ut!==null?e=0:(Zt=null,rn=0,e=Ht)}if(e!==0){if(e===2&&(s=gm(t),s!==0&&(r=s,e=qm(t,s))),e===1)throw n=Nc,Xi(t,0),zs(t,r),On(t,Ot()),n;if(e===6)zs(t,r);else{if(s=t.current.alternate,!(r&30)&&!UR(s)&&(e=eh(t,r),e===2&&(i=gm(t),i!==0&&(r=i,e=qm(t,i))),e===1))throw n=Nc,Xi(t,0),zs(t,r),On(t,Ot()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(J(345));case 2:Vi(t,Rn,is);break;case 3:if(zs(t,r),(r&130023424)===r&&(e=gy+500-Ot(),10<e)){if(Ld(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){bn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Im(Vi.bind(null,t,Rn,is),e);break}Vi(t,Rn,is);break;case 4:if(zs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-br(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ot()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*FR(r/1960))-r,10<r){t.timeoutHandle=Im(Vi.bind(null,t,Rn,is),r);break}Vi(t,Rn,is);break;case 5:Vi(t,Rn,is);break;default:throw Error(J(329))}}}return On(t,Ot()),t.callbackNode===n?F0.bind(null,t):null}function qm(t,e){var n=ec;return t.current.memoizedState.isDehydrated&&(Xi(t,e).flags|=256),t=eh(t,e),t!==2&&(e=Rn,Rn=n,e!==null&&Hm(e)),t}function Hm(t){Rn===null?Rn=t:Rn.push.apply(Rn,t)}function UR(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Sr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function zs(t,e){for(e&=~my,e&=~zh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-br(e),r=1<<n;t[n]=-1,e&=~r}}function zx(t){if(Ke&6)throw Error(J(327));ya();var e=Ld(t,0);if(!(e&1))return On(t,Ot()),null;var n=eh(t,e);if(t.tag!==0&&n===2){var r=gm(t);r!==0&&(e=r,n=qm(t,r))}if(n===1)throw n=Nc,Xi(t,0),zs(t,e),On(t,Ot()),n;if(n===6)throw Error(J(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Vi(t,Rn,is),On(t,Ot()),null}function yy(t,e){var n=Ke;Ke|=1;try{return t(e)}finally{Ke=n,Ke===0&&(Pa=Ot()+500,Fh&&bi())}}function co(t){Js!==null&&Js.tag===0&&!(Ke&6)&&ya();var e=Ke;Ke|=1;var n=ar.transition,r=st;try{if(ar.transition=null,st=1,t)return t()}finally{st=r,ar.transition=n,Ke=e,!(Ke&6)&&bi()}}function vy(){Un=ua.current,gt(ua)}function Xi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,gR(n)),Ut!==null)for(n=Ut.return;n!==null;){var r=n;switch(Jg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&$d();break;case 3:Aa(),gt(jn),gt(mn),ay();break;case 5:oy(r);break;case 4:Aa();break;case 13:gt(It);break;case 19:gt(It);break;case 10:ny(r.type._context);break;case 22:case 23:vy()}n=n.return}if(Zt=t,Ut=t=ai(t.current,null),rn=Un=e,Ht=0,Nc=null,my=zh=lo=0,Rn=ec=null,Gi!==null){for(e=0;e<Gi.length;e++)if(n=Gi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}Gi=null}return t}function U0(t,e){do{var n=Ut;try{if(ty(),ld.current=Yd,Qd){for(var r=St.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Qd=!1}if(ao=0,Jt=qt=St=null,Jl=!1,Tc=0,py.current=null,n===null||n.return===null){Ht=1,Nc=e,Ut=null;break}e:{var i=t,o=n.return,l=n,c=e;if(e=rn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,f=l,h=f.tag;if(!(f.mode&1)&&(h===0||h===11||h===15)){var m=f.alternate;m?(f.updateQueue=m.updateQueue,f.memoizedState=m.memoizedState,f.lanes=m.lanes):(f.updateQueue=null,f.memoizedState=null)}var v=Rx(o);if(v!==null){v.flags&=-257,Px(v,o,l,i,e),v.mode&1&&Ax(i,d,e),e=v,c=d;var P=e.updateQueue;if(P===null){var A=new Set;A.add(c),e.updateQueue=A}else P.add(c);break e}else{if(!(e&1)){Ax(i,d,e),_y();break e}c=Error(J(426))}}else if(_t&&l.mode&1){var C=Rx(o);if(C!==null){!(C.flags&65536)&&(C.flags|=256),Px(C,o,l,i,e),Zg(Ra(c,l));break e}}i=c=Ra(c,l),Ht!==4&&(Ht=2),ec===null?ec=[i]:ec.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=b0(i,c,e);bx(i,y);break e;case 1:l=c;var _=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof _.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(ii===null||!ii.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var T=I0(i,l,e);bx(i,T);break e}}i=i.return}while(i!==null)}z0(n)}catch(V){e=V,Ut===n&&n!==null&&(Ut=n=n.return);continue}break}while(!0)}function $0(){var t=Xd.current;return Xd.current=Yd,t===null?Yd:t}function _y(){(Ht===0||Ht===3||Ht===2)&&(Ht=4),Zt===null||!(lo&268435455)&&!(zh&268435455)||zs(Zt,rn)}function eh(t,e){var n=Ke;Ke|=2;var r=$0();(Zt!==t||rn!==e)&&(is=null,Xi(t,e));do try{$R();break}catch(s){U0(t,s)}while(!0);if(ty(),Ke=n,Xd.current=r,Ut!==null)throw Error(J(261));return Zt=null,rn=0,Ht}function $R(){for(;Ut!==null;)B0(Ut)}function BR(){for(;Ut!==null&&!fA();)B0(Ut)}function B0(t){var e=H0(t.alternate,t,Un);t.memoizedProps=t.pendingProps,e===null?z0(t):Ut=e,py.current=null}function z0(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=OR(n,e),n!==null){n.flags&=32767,Ut=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ht=6,Ut=null;return}}else if(n=DR(n,e,Un),n!==null){Ut=n;return}if(e=e.sibling,e!==null){Ut=e;return}Ut=e=t}while(e!==null);Ht===0&&(Ht=5)}function Vi(t,e,n){var r=st,s=ar.transition;try{ar.transition=null,st=1,zR(t,e,n,r)}finally{ar.transition=s,st=r}return null}function zR(t,e,n,r){do ya();while(Js!==null);if(Ke&6)throw Error(J(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(J(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(bA(t,i),t===Zt&&(Ut=Zt=null,rn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Uu||(Uu=!0,W0(Od,function(){return ya(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=ar.transition,ar.transition=null;var o=st;st=1;var l=Ke;Ke|=4,py.current=null,VR(t,n),V0(n,t),cR(Em),Vd=!!wm,Em=wm=null,t.current=n,MR(n),pA(),Ke=l,st=o,ar.transition=i}else t.current=n;if(Uu&&(Uu=!1,Js=t,Zd=s),i=t.pendingLanes,i===0&&(ii=null),yA(n.stateNode),On(t,Ot()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Jd)throw Jd=!1,t=Bm,Bm=null,t;return Zd&1&&t.tag!==0&&ya(),i=t.pendingLanes,i&1?t===zm?tc++:(tc=0,zm=t):tc=0,bi(),null}function ya(){if(Js!==null){var t=bI(Zd),e=ar.transition,n=st;try{if(ar.transition=null,st=16>t?16:t,Js===null)var r=!1;else{if(t=Js,Js=null,Zd=0,Ke&6)throw Error(J(331));var s=Ke;for(Ke|=4,ce=t.current;ce!==null;){var i=ce,o=i.child;if(ce.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(ce=d;ce!==null;){var f=ce;switch(f.tag){case 0:case 11:case 15:Zl(8,f,i)}var h=f.child;if(h!==null)h.return=f,ce=h;else for(;ce!==null;){f=ce;var m=f.sibling,v=f.return;if(D0(f),f===d){ce=null;break}if(m!==null){m.return=v,ce=m;break}ce=v}}}var P=i.alternate;if(P!==null){var A=P.child;if(A!==null){P.child=null;do{var C=A.sibling;A.sibling=null,A=C}while(A!==null)}}ce=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ce=o;else e:for(;ce!==null;){if(i=ce,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Zl(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,ce=y;break e}ce=i.return}}var _=t.current;for(ce=_;ce!==null;){o=ce;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,ce=w;else e:for(o=_;ce!==null;){if(l=ce,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Bh(9,l)}}catch(V){At(l,l.return,V)}if(l===o){ce=null;break e}var T=l.sibling;if(T!==null){T.return=l.return,ce=T;break e}ce=l.return}}if(Ke=s,bi(),Gr&&typeof Gr.onPostCommitFiberRoot=="function")try{Gr.onPostCommitFiberRoot(Dh,t)}catch{}r=!0}return r}finally{st=n,ar.transition=e}}return!1}function qx(t,e,n){e=Ra(n,e),e=b0(t,e,1),t=si(t,e,1),e=bn(),t!==null&&(Wc(t,1,e),On(t,e))}function At(t,e,n){if(t.tag===3)qx(t,t,n);else for(;e!==null;){if(e.tag===3){qx(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ii===null||!ii.has(r))){t=Ra(n,t),t=I0(e,t,1),e=si(e,t,1),t=bn(),e!==null&&(Wc(e,1,t),On(e,t));break}}e=e.return}}function qR(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=bn(),t.pingedLanes|=t.suspendedLanes&n,Zt===t&&(rn&n)===n&&(Ht===4||Ht===3&&(rn&130023424)===rn&&500>Ot()-gy?Xi(t,0):my|=n),On(t,e)}function q0(t,e){e===0&&(t.mode&1?(e=Ru,Ru<<=1,!(Ru&130023424)&&(Ru=4194304)):e=1);var n=bn();t=ys(t,e),t!==null&&(Wc(t,e,n),On(t,n))}function HR(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),q0(t,n)}function WR(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(e),q0(t,n)}var H0;H0=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||jn.current)Pn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Pn=!1,jR(t,e,n);Pn=!!(t.flags&131072)}else Pn=!1,_t&&e.flags&1048576&&QI(e,qd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ud(t,e),t=e.pendingProps;var s=Sa(e,mn.current);ga(e,n),s=cy(null,e,r,t,s,n);var i=uy();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Dn(r)?(i=!0,Bd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,sy(e),s.updater=$h,e.stateNode=s,s._reactInternals=e,Pm(e,r,t,n),e=Dm(null,e,r,!0,i,n)):(e.tag=0,_t&&i&&Xg(e),vn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ud(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=KR(r),t=vr(r,t),s){case 0:e=jm(null,e,r,t,n);break e;case 1:e=Dx(null,e,r,t,n);break e;case 11:e=kx(null,e,r,t,n);break e;case 14:e=jx(null,e,r,vr(r.type,t),n);break e}throw Error(J(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vr(r,s),jm(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vr(r,s),Dx(t,e,r,s,n);case 3:e:{if(N0(e),t===null)throw Error(J(387));r=e.pendingProps,i=e.memoizedState,s=i.element,t0(t,e),Gd(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Ra(Error(J(423)),e),e=Ox(t,e,r,n,s);break e}else if(r!==s){s=Ra(Error(J(424)),e),e=Ox(t,e,r,n,s);break e}else for(qn=ri(e.stateNode.containerInfo.firstChild),Wn=e,_t=!0,wr=null,n=ZI(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ca(),r===s){e=vs(t,e,n);break e}vn(t,e,r,n)}e=e.child}return e;case 5:return n0(e),t===null&&Nm(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,bm(r,s)?o=null:i!==null&&bm(r,i)&&(e.flags|=32),C0(t,e),vn(t,e,o,n),e.child;case 6:return t===null&&Nm(e),null;case 13:return A0(t,e,n);case 4:return iy(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Na(e,null,r,n):vn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vr(r,s),kx(t,e,r,s,n);case 7:return vn(t,e,e.pendingProps,n),e.child;case 8:return vn(t,e,e.pendingProps.children,n),e.child;case 12:return vn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,dt(Hd,r._currentValue),r._currentValue=o,i!==null)if(Sr(i.value,o)){if(i.children===s.children&&!jn.current){e=vs(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=hs(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var f=d.pending;f===null?c.next=c:(c.next=f.next,f.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Am(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(J(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Am(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}vn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,ga(e,n),s=cr(s),r=r(s),e.flags|=1,vn(t,e,r,n),e.child;case 14:return r=e.type,s=vr(r,e.pendingProps),s=vr(r.type,s),jx(t,e,r,s,n);case 15:return T0(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:vr(r,s),ud(t,e),e.tag=1,Dn(r)?(t=!0,Bd(e)):t=!1,ga(e,n),E0(e,r,s),Pm(e,r,s,n),Dm(null,e,r,!0,t,n);case 19:return R0(t,e,n);case 22:return S0(t,e,n)}throw Error(J(156,e.tag))};function W0(t,e){return _I(t,e)}function GR(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ir(t,e,n,r){return new GR(t,e,n,r)}function xy(t){return t=t.prototype,!(!t||!t.isReactComponent)}function KR(t){if(typeof t=="function")return xy(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Fg)return 11;if(t===Ug)return 14}return 2}function ai(t,e){var n=t.alternate;return n===null?(n=ir(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function fd(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")xy(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case ea:return Ji(n.children,s,i,e);case Mg:o=8,s|=8;break;case tm:return t=ir(12,n,e,s|2),t.elementType=tm,t.lanes=i,t;case nm:return t=ir(13,n,e,s),t.elementType=nm,t.lanes=i,t;case rm:return t=ir(19,n,e,s),t.elementType=rm,t.lanes=i,t;case nI:return qh(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case eI:o=10;break e;case tI:o=9;break e;case Fg:o=11;break e;case Ug:o=14;break e;case Us:o=16,r=null;break e}throw Error(J(130,t==null?t:typeof t,""))}return e=ir(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Ji(t,e,n,r){return t=ir(7,t,r,e),t.lanes=n,t}function qh(t,e,n,r){return t=ir(22,t,r,e),t.elementType=nI,t.lanes=n,t.stateNode={isHidden:!1},t}function _p(t,e,n){return t=ir(6,t,null,e),t.lanes=n,t}function xp(t,e,n){return e=ir(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function QR(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ep(0),this.expirationTimes=ep(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ep(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function wy(t,e,n,r,s,i,o,l,c){return t=new QR(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ir(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},sy(i),t}function YR(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Zo,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function G0(t){if(!t)return mi;t=t._reactInternals;e:{if(So(t)!==t||t.tag!==1)throw Error(J(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Dn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(J(171))}if(t.tag===1){var n=t.type;if(Dn(n))return GI(t,n,e)}return e}function K0(t,e,n,r,s,i,o,l,c){return t=wy(n,r,!0,t,s,i,o,l,c),t.context=G0(null),n=t.current,r=bn(),s=oi(n),i=hs(r,s),i.callback=e??null,si(n,i,s),t.current.lanes=s,Wc(t,s,r),On(t,r),t}function Hh(t,e,n,r){var s=e.current,i=bn(),o=oi(s);return n=G0(n),e.context===null?e.context=n:e.pendingContext=n,e=hs(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=si(s,e,o),t!==null&&(Ir(t,s,o,i),ad(t,s,o)),o}function th(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Hx(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ey(t,e){Hx(t,e),(t=t.alternate)&&Hx(t,e)}function XR(){return null}var Q0=typeof reportError=="function"?reportError:function(t){console.error(t)};function by(t){this._internalRoot=t}Wh.prototype.render=by.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(J(409));Hh(t,e,null,null)};Wh.prototype.unmount=by.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;co(function(){Hh(null,t,null,null)}),e[gs]=null}};function Wh(t){this._internalRoot=t}Wh.prototype.unstable_scheduleHydration=function(t){if(t){var e=SI();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Bs.length&&e!==0&&e<Bs[n].priority;n++);Bs.splice(n,0,t),n===0&&NI(t)}};function Iy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Gh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Wx(){}function JR(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=th(o);i.call(d)}}var o=K0(e,r,t,0,null,!1,!1,"",Wx);return t._reactRootContainer=o,t[gs]=o.current,xc(t.nodeType===8?t.parentNode:t),co(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=th(c);l.call(d)}}var c=wy(t,0,!1,null,null,!1,!1,"",Wx);return t._reactRootContainer=c,t[gs]=c.current,xc(t.nodeType===8?t.parentNode:t),co(function(){Hh(e,c,n,r)}),c}function Kh(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var l=s;s=function(){var c=th(o);l.call(c)}}Hh(e,o,t,s)}else o=JR(n,e,t,s,r);return th(o)}II=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ll(e.pendingLanes);n!==0&&(zg(e,n|1),On(e,Ot()),!(Ke&6)&&(Pa=Ot()+500,bi()))}break;case 13:co(function(){var r=ys(t,1);if(r!==null){var s=bn();Ir(r,t,1,s)}}),Ey(t,1)}};qg=function(t){if(t.tag===13){var e=ys(t,134217728);if(e!==null){var n=bn();Ir(e,t,134217728,n)}Ey(t,134217728)}};TI=function(t){if(t.tag===13){var e=oi(t),n=ys(t,e);if(n!==null){var r=bn();Ir(n,t,e,r)}Ey(t,e)}};SI=function(){return st};CI=function(t,e){var n=st;try{return st=t,e()}finally{st=n}};fm=function(t,e,n){switch(e){case"input":if(om(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Mh(r);if(!s)throw Error(J(90));sI(r),om(r,s)}}}break;case"textarea":oI(t,n);break;case"select":e=n.value,e!=null&&ha(t,!!n.multiple,e,!1)}};fI=yy;pI=co;var ZR={usingClientEntryPoint:!1,Events:[Kc,sa,Mh,dI,hI,yy]},bl={findFiberByHostInstance:Wi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},eP={bundleType:bl.bundleType,version:bl.version,rendererPackageName:bl.rendererPackageName,rendererConfig:bl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ts.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=yI(t),t===null?null:t.stateNode},findFiberByHostInstance:bl.findFiberByHostInstance||XR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $u=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$u.isDisabled&&$u.supportsFiber)try{Dh=$u.inject(eP),Gr=$u}catch{}}Yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ZR;Yn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Iy(e))throw Error(J(200));return YR(t,e,null,n)};Yn.createRoot=function(t,e){if(!Iy(t))throw Error(J(299));var n=!1,r="",s=Q0;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=wy(t,1,!1,null,null,n,!1,r,s),t[gs]=e.current,xc(t.nodeType===8?t.parentNode:t),new by(e)};Yn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(J(188)):(t=Object.keys(t).join(","),Error(J(268,t)));return t=yI(e),t=t===null?null:t.stateNode,t};Yn.flushSync=function(t){return co(t)};Yn.hydrate=function(t,e,n){if(!Gh(e))throw Error(J(200));return Kh(null,t,e,!0,n)};Yn.hydrateRoot=function(t,e,n){if(!Iy(t))throw Error(J(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=Q0;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=K0(e,null,t,1,n??null,s,!1,i,o),t[gs]=e.current,xc(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Wh(e)};Yn.render=function(t,e,n){if(!Gh(e))throw Error(J(200));return Kh(null,t,e,!1,n)};Yn.unmountComponentAtNode=function(t){if(!Gh(t))throw Error(J(40));return t._reactRootContainer?(co(function(){Kh(null,null,t,!1,function(){t._reactRootContainer=null,t[gs]=null})}),!0):!1};Yn.unstable_batchedUpdates=yy;Yn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Gh(n))throw Error(J(200));if(t==null||t._reactInternals===void 0)throw Error(J(38));return Kh(t,e,n,!1,r)};Yn.version="18.3.1-next-f1338f8080-20240426";function Y0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Y0)}catch(t){console.error(t)}}Y0(),Yb.exports=Yn;var tP=Yb.exports,X0,Gx=tP;X0=Gx.createRoot,Gx.hydrateRoot;/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Kx="popstate";function nP(t={}){function e(r,s){let{pathname:i,search:o,hash:l}=r.location;return Wm("",{pathname:i,search:o,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Ac(s)}return sP(e,n,null,t)}function xt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function dr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function rP(){return Math.random().toString(36).substring(2,10)}function Qx(t,e){return{usr:t.state,key:t.key,idx:e}}function Wm(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Ya(e):e,state:n,key:e&&e.key||r||rP()}}function Ac({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ya(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function sP(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,l="POP",c=null,d=f();d==null&&(d=0,o.replaceState({...o.state,idx:d},""));function f(){return(o.state||{idx:null}).idx}function h(){l="POP";let C=f(),y=C==null?null:C-d;d=C,c&&c({action:l,location:A.location,delta:y})}function m(C,y){l="PUSH";let _=Wm(A.location,C,y);d=f()+1;let w=Qx(_,d),T=A.createHref(_);try{o.pushState(w,"",T)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;s.location.assign(T)}i&&c&&c({action:l,location:A.location,delta:1})}function v(C,y){l="REPLACE";let _=Wm(A.location,C,y);d=f();let w=Qx(_,d),T=A.createHref(_);o.replaceState(w,"",T),i&&c&&c({action:l,location:A.location,delta:0})}function P(C){return iP(C)}let A={get action(){return l},get location(){return t(s,o)},listen(C){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(Kx,h),c=C,()=>{s.removeEventListener(Kx,h),c=null}},createHref(C){return e(s,C)},createURL:P,encodeLocation(C){let y=P(C);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:m,replace:v,go(C){return o.go(C)}};return A}function iP(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),xt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Ac(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function J0(t,e,n="/"){return oP(t,e,n,!1)}function oP(t,e,n,r){let s=typeof e=="string"?Ya(e):e,i=_s(s.pathname||"/",n);if(i==null)return null;let o=Z0(t);aP(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=vP(i);l=gP(o[c],d,r)}return l}function Z0(t,e=[],n=[],r="",s=!1){let i=(o,l,c=s,d)=>{let f={relativePath:d===void 0?o.path||"":d,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(r)&&c)return;xt(f.relativePath.startsWith(r),`Absolute route path "${f.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(r.length)}let h=fs([r,f.relativePath]),m=n.concat(f);o.children&&o.children.length>0&&(xt(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),Z0(o.children,e,m,h,c)),!(o.path==null&&!o.index)&&e.push({path:h,score:pP(h,o.index),routesMeta:m})};return t.forEach((o,l)=>{var c;if(o.path===""||!((c=o.path)!=null&&c.includes("?")))i(o,l);else for(let d of eT(o.path))i(o,l,!0,d)}),e}function eT(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=eT(r.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...o),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function aP(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:mP(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var lP=/^:[\w-]+$/,cP=3,uP=2,dP=1,hP=10,fP=-2,Yx=t=>t==="*";function pP(t,e){let n=t.split("/"),r=n.length;return n.some(Yx)&&(r+=fP),e&&(r+=uP),n.filter(s=>!Yx(s)).reduce((s,i)=>s+(lP.test(i)?cP:i===""?dP:hP),r)}function mP(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function gP(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,f=i==="/"?e:e.slice(i.length)||"/",h=nh({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},f),m=c.route;if(!h&&d&&n&&!r[r.length-1].route.index&&(h=nh({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},f)),!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:fs([i,h.pathname]),pathnameBase:bP(fs([i,h.pathnameBase])),route:m}),h.pathnameBase!=="/"&&(i=fs([i,h.pathnameBase]))}return o}function nh(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=yP(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,{paramName:f,isOptional:h},m)=>{if(f==="*"){let P=l[m]||"";o=i.slice(0,i.length-P.length).replace(/(.)\/+$/,"$1")}const v=l[m];return h&&!v?d[f]=void 0:d[f]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:t}}function yP(t,e=!1,n=!0){dr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function vP(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return dr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function _s(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var _P=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xP=t=>_P.test(t);function wP(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Ya(t):t,i;if(n)if(xP(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),dr(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=Xx(n.substring(1),"/"):i=Xx(n,e)}else i=e;return{pathname:i,search:IP(r),hash:TP(s)}}function Xx(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function wp(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function EP(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Ty(t){let e=EP(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Sy(t,e,n,r=!1){let s;typeof t=="string"?s=Ya(t):(s={...t},xt(!s.pathname||!s.pathname.includes("?"),wp("?","pathname","search",s)),xt(!s.pathname||!s.pathname.includes("#"),wp("#","pathname","hash",s)),xt(!s.search||!s.search.includes("#"),wp("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,l;if(o==null)l=n;else{let h=e.length-1;if(!r&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),h-=1;s.pathname=m.join("/")}l=h>=0?e[h]:"/"}let c=wP(s,l),d=o&&o!=="/"&&o.endsWith("/"),f=(i||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||f)&&(c.pathname+="/"),c}var fs=t=>t.join("/").replace(/\/\/+/g,"/"),bP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),IP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,TP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function SP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var tT=["POST","PUT","PATCH","DELETE"];new Set(tT);var CP=["GET",...tT];new Set(CP);var Xa=I.createContext(null);Xa.displayName="DataRouter";var Qh=I.createContext(null);Qh.displayName="DataRouterState";I.createContext(!1);var nT=I.createContext({isTransitioning:!1});nT.displayName="ViewTransition";var NP=I.createContext(new Map);NP.displayName="Fetchers";var AP=I.createContext(null);AP.displayName="Await";var Rr=I.createContext(null);Rr.displayName="Navigation";var Yc=I.createContext(null);Yc.displayName="Location";var Pr=I.createContext({outlet:null,matches:[],isDataRoute:!1});Pr.displayName="Route";var Cy=I.createContext(null);Cy.displayName="RouteError";function RP(t,{relative:e}={}){xt(Ja(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=I.useContext(Rr),{hash:s,pathname:i,search:o}=Xc(t,{relative:e}),l=i;return n!=="/"&&(l=i==="/"?n:fs([n,i])),r.createHref({pathname:l,search:o,hash:s})}function Ja(){return I.useContext(Yc)!=null}function gn(){return xt(Ja(),"useLocation() may be used only in the context of a <Router> component."),I.useContext(Yc).location}var rT="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function sT(t){I.useContext(Rr).static||I.useLayoutEffect(t)}function kr(){let{isDataRoute:t}=I.useContext(Pr);return t?qP():PP()}function PP(){xt(Ja(),"useNavigate() may be used only in the context of a <Router> component.");let t=I.useContext(Xa),{basename:e,navigator:n}=I.useContext(Rr),{matches:r}=I.useContext(Pr),{pathname:s}=gn(),i=JSON.stringify(Ty(r)),o=I.useRef(!1);return sT(()=>{o.current=!0}),I.useCallback((c,d={})=>{if(dr(o.current,rT),!o.current)return;if(typeof c=="number"){n.go(c);return}let f=Sy(c,JSON.parse(i),s,d.relative==="path");t==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:fs([e,f.pathname])),(d.replace?n.replace:n.push)(f,d.state,d)},[e,n,i,s,t])}I.createContext(null);function kP(){let{matches:t}=I.useContext(Pr),e=t[t.length-1];return e?e.params:{}}function Xc(t,{relative:e}={}){let{matches:n}=I.useContext(Pr),{pathname:r}=gn(),s=JSON.stringify(Ty(n));return I.useMemo(()=>Sy(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function jP(t,e){return iT(t,e)}function iT(t,e,n,r,s){var _;xt(Ja(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=I.useContext(Rr),{matches:o}=I.useContext(Pr),l=o[o.length-1],c=l?l.params:{},d=l?l.pathname:"/",f=l?l.pathnameBase:"/",h=l&&l.route;{let w=h&&h.path||"";oT(d,!h||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let m=gn(),v;if(e){let w=typeof e=="string"?Ya(e):e;xt(f==="/"||((_=w.pathname)==null?void 0:_.startsWith(f)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${w.pathname}" was given in the \`location\` prop.`),v=w}else v=m;let P=v.pathname||"/",A=P;if(f!=="/"){let w=f.replace(/^\//,"").split("/");A="/"+P.replace(/^\//,"").split("/").slice(w.length).join("/")}let C=J0(t,{pathname:A});dr(h||C!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),dr(C==null||C[C.length-1].route.element!==void 0||C[C.length-1].route.Component!==void 0||C[C.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let y=MP(C&&C.map(w=>Object.assign({},w,{params:Object.assign({},c,w.params),pathname:fs([f,i.encodeLocation?i.encodeLocation(w.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?f:fs([f,i.encodeLocation?i.encodeLocation(w.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathnameBase])})),o,n,r,s);return e&&y?I.createElement(Yc.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},y):y}function DP(){let t=zP(),e=SP(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=I.createElement(I.Fragment,null,I.createElement("p",null," Hey developer "),I.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",I.createElement("code",{style:i},"ErrorBoundary")," or"," ",I.createElement("code",{style:i},"errorElement")," prop on your route.")),I.createElement(I.Fragment,null,I.createElement("h2",null,"Unexpected Application Error!"),I.createElement("h3",{style:{fontStyle:"italic"}},e),n?I.createElement("pre",{style:s},n):null,o)}var OP=I.createElement(DP,null),LP=class extends I.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?I.createElement(Pr.Provider,{value:this.props.routeContext},I.createElement(Cy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function VP({routeContext:t,match:e,children:n}){let r=I.useContext(Xa);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),I.createElement(Pr.Provider,{value:t},n)}function MP(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let f=i.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);xt(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,f+1))}let l=!1,c=-1;if(n)for(let f=0;f<i.length;f++){let h=i[f];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=f),h.route.id){let{loaderData:m,errors:v}=n,P=h.route.loader&&!m.hasOwnProperty(h.route.id)&&(!v||v[h.route.id]===void 0);if(h.route.lazy||P){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}let d=n&&r?(f,h)=>{var m,v;r(f,{location:n.location,params:((v=(m=n.matches)==null?void 0:m[0])==null?void 0:v.params)??{},errorInfo:h})}:void 0;return i.reduceRight((f,h,m)=>{let v,P=!1,A=null,C=null;n&&(v=o&&h.route.id?o[h.route.id]:void 0,A=h.route.errorElement||OP,l&&(c<0&&m===0?(oT("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),P=!0,C=null):c===m&&(P=!0,C=h.route.hydrateFallbackElement||null)));let y=e.concat(i.slice(0,m+1)),_=()=>{let w;return v?w=A:P?w=C:h.route.Component?w=I.createElement(h.route.Component,null):h.route.element?w=h.route.element:w=f,I.createElement(VP,{match:h,routeContext:{outlet:f,matches:y,isDataRoute:n!=null},children:w})};return n&&(h.route.ErrorBoundary||h.route.errorElement||m===0)?I.createElement(LP,{location:n.location,revalidation:n.revalidation,component:A,error:v,children:_(),routeContext:{outlet:null,matches:y,isDataRoute:!0},onError:d}):_()},null)}function Ny(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function FP(t){let e=I.useContext(Xa);return xt(e,Ny(t)),e}function UP(t){let e=I.useContext(Qh);return xt(e,Ny(t)),e}function $P(t){let e=I.useContext(Pr);return xt(e,Ny(t)),e}function Ay(t){let e=$P(t),n=e.matches[e.matches.length-1];return xt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function BP(){return Ay("useRouteId")}function zP(){var r;let t=I.useContext(Cy),e=UP("useRouteError"),n=Ay("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function qP(){let{router:t}=FP("useNavigate"),e=Ay("useNavigate"),n=I.useRef(!1);return sT(()=>{n.current=!0}),I.useCallback(async(s,i={})=>{dr(n.current,rT),n.current&&(typeof s=="number"?t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var Jx={};function oT(t,e,n){!e&&!Jx[t]&&(Jx[t]=!0,dr(!1,n))}I.memo(HP);function HP({routes:t,future:e,state:n,unstable_onError:r}){return iT(t,void 0,n,r,e)}function rh({to:t,replace:e,state:n,relative:r}){xt(Ja(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=I.useContext(Rr);dr(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=I.useContext(Pr),{pathname:o}=gn(),l=kr(),c=Sy(t,Ty(i),o,r==="path"),d=JSON.stringify(c);return I.useEffect(()=>{l(JSON.parse(d),{replace:e,state:n,relative:r})},[l,d,r,e,n]),null}function Go(t){xt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function WP({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1}){xt(!Ja(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),l=I.useMemo(()=>({basename:o,navigator:s,static:i,future:{}}),[o,s,i]);typeof n=="string"&&(n=Ya(n));let{pathname:c="/",search:d="",hash:f="",state:h=null,key:m="default"}=n,v=I.useMemo(()=>{let P=_s(c,o);return P==null?null:{location:{pathname:P,search:d,hash:f,state:h,key:m},navigationType:r}},[o,c,d,f,h,m,r]);return dr(v!=null,`<Router basename="${o}"> is not able to match the URL "${c}${d}${f}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:I.createElement(Rr.Provider,{value:l},I.createElement(Yc.Provider,{children:e,value:v}))}function GP({children:t,location:e}){return jP(Gm(t),e)}function Gm(t,e=[]){let n=[];return I.Children.forEach(t,(r,s)=>{if(!I.isValidElement(r))return;let i=[...e,s];if(r.type===I.Fragment){n.push.apply(n,Gm(r.props.children,i));return}xt(r.type===Go,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),xt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Gm(r.props.children,i)),n.push(o)}),n}var pd="get",md="application/x-www-form-urlencoded";function Yh(t){return t!=null&&typeof t.tagName=="string"}function KP(t){return Yh(t)&&t.tagName.toLowerCase()==="button"}function QP(t){return Yh(t)&&t.tagName.toLowerCase()==="form"}function YP(t){return Yh(t)&&t.tagName.toLowerCase()==="input"}function XP(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function JP(t,e){return t.button===0&&(!e||e==="_self")&&!XP(t)}var Bu=null;function ZP(){if(Bu===null)try{new FormData(document.createElement("form"),0),Bu=!1}catch{Bu=!0}return Bu}var ek=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ep(t){return t!=null&&!ek.has(t)?(dr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${md}"`),null):t}function tk(t,e){let n,r,s,i,o;if(QP(t)){let l=t.getAttribute("action");r=l?_s(l,e):null,n=t.getAttribute("method")||pd,s=Ep(t.getAttribute("enctype"))||md,i=new FormData(t)}else if(KP(t)||YP(t)&&(t.type==="submit"||t.type==="image")){let l=t.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||l.getAttribute("action");if(r=c?_s(c,e):null,n=t.getAttribute("formmethod")||l.getAttribute("method")||pd,s=Ep(t.getAttribute("formenctype"))||Ep(l.getAttribute("enctype"))||md,i=new FormData(l,t),!ZP()){let{name:d,type:f,value:h}=t;if(f==="image"){let m=d?`${d}.`:"";i.append(`${m}x`,"0"),i.append(`${m}y`,"0")}else d&&i.append(d,h)}}else{if(Yh(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=pd,r=null,s=md,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Ry(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function nk(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&_s(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function rk(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function sk(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function ik(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await rk(i,n);return o.links?o.links():[]}return[]}));return ck(r.flat(1).filter(sk).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function Zx(t,e,n,r,s,i){let o=(c,d)=>n[d]?c.route.id!==n[d].route.id:!0,l=(c,d)=>{var f;return n[d].pathname!==c.pathname||((f=n[d].route.path)==null?void 0:f.endsWith("*"))&&n[d].params["*"]!==c.params["*"]};return i==="assets"?e.filter((c,d)=>o(c,d)||l(c,d)):i==="data"?e.filter((c,d)=>{var h;let f=r.routes[c.route.id];if(!f||!f.hasLoader)return!1;if(o(c,d)||l(c,d))return!0;if(c.route.shouldRevalidate){let m=c.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((h=n[0])==null?void 0:h.params)||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function ok(t,e,{includeHydrateFallback:n}={}){return ak(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function ak(t){return[...new Set(t)]}function lk(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function ck(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let i=JSON.stringify(lk(s));return n.has(i)||(n.add(i),r.push({key:i,link:s})),r},[])}function aT(){let t=I.useContext(Xa);return Ry(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function uk(){let t=I.useContext(Qh);return Ry(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Py=I.createContext(void 0);Py.displayName="FrameworkContext";function lT(){let t=I.useContext(Py);return Ry(t,"You must render this element inside a <HydratedRouter> element"),t}function dk(t,e){let n=I.useContext(Py),[r,s]=I.useState(!1),[i,o]=I.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:d,onMouseLeave:f,onTouchStart:h}=e,m=I.useRef(null);I.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let A=y=>{y.forEach(_=>{o(_.isIntersecting)})},C=new IntersectionObserver(A,{threshold:.5});return m.current&&C.observe(m.current),()=>{C.disconnect()}}},[t]),I.useEffect(()=>{if(r){let A=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(A)}}},[r]);let v=()=>{s(!0)},P=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,m,{}]:[i,m,{onFocus:Il(l,v),onBlur:Il(c,P),onMouseEnter:Il(d,v),onMouseLeave:Il(f,P),onTouchStart:Il(h,v)}]:[!1,m,{}]}function Il(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function hk({page:t,...e}){let{router:n}=aT(),r=I.useMemo(()=>J0(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?I.createElement(pk,{page:t,matches:r,...e}):null}function fk(t){let{manifest:e,routeModules:n}=lT(),[r,s]=I.useState([]);return I.useEffect(()=>{let i=!1;return ik(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function pk({page:t,matches:e,...n}){let r=gn(),{manifest:s,routeModules:i}=lT(),{basename:o}=aT(),{loaderData:l,matches:c}=uk(),d=I.useMemo(()=>Zx(t,e,c,s,r,"data"),[t,e,c,s,r]),f=I.useMemo(()=>Zx(t,e,c,s,r,"assets"),[t,e,c,s,r]),h=I.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let P=new Set,A=!1;if(e.forEach(y=>{var w;let _=s.routes[y.route.id];!_||!_.hasLoader||(!d.some(T=>T.route.id===y.route.id)&&y.route.id in l&&((w=i[y.route.id])!=null&&w.shouldRevalidate)||_.hasClientLoader?A=!0:P.add(y.route.id))}),P.size===0)return[];let C=nk(t,o,"data");return A&&P.size>0&&C.searchParams.set("_routes",e.filter(y=>P.has(y.route.id)).map(y=>y.route.id).join(",")),[C.pathname+C.search]},[o,l,r,s,d,e,t,i]),m=I.useMemo(()=>ok(f,s),[f,s]),v=fk(f);return I.createElement(I.Fragment,null,h.map(P=>I.createElement("link",{key:P,rel:"prefetch",as:"fetch",href:P,...n})),m.map(P=>I.createElement("link",{key:P,rel:"modulepreload",href:P,...n})),v.map(({key:P,link:A})=>I.createElement("link",{key:P,nonce:n.nonce,...A})))}function mk(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var cT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{cT&&(window.__reactRouterVersion="7.9.6")}catch{}function gk({basename:t,children:e,window:n}){let r=I.useRef();r.current==null&&(r.current=nP({window:n,v5Compat:!0}));let s=r.current,[i,o]=I.useState({action:s.action,location:s.location}),l=I.useCallback(c=>{I.startTransition(()=>o(c))},[o]);return I.useLayoutEffect(()=>s.listen(l),[s,l]),I.createElement(WP,{basename:t,children:e,location:i.location,navigationType:i.action,navigator:s})}var uT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,dT=I.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:l,target:c,to:d,preventScrollReset:f,viewTransition:h,...m},v){let{basename:P}=I.useContext(Rr),A=typeof d=="string"&&uT.test(d),C,y=!1;if(typeof d=="string"&&A&&(C=d,cT))try{let x=new URL(window.location.href),S=d.startsWith("//")?new URL(x.protocol+d):new URL(d),j=_s(S.pathname,P);S.origin===x.origin&&j!=null?d=j+S.search+S.hash:y=!0}catch{dr(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let _=RP(d,{relative:s}),[w,T,V]=dk(r,m),U=_k(d,{replace:o,state:l,target:c,preventScrollReset:f,relative:s,viewTransition:h});function b(x){e&&e(x),x.defaultPrevented||U(x)}let E=I.createElement("a",{...m,...V,href:C||_,onClick:y||i?e:b,ref:mk(v,T),target:c,"data-discover":!A&&n==="render"?"true":void 0});return w&&!A?I.createElement(I.Fragment,null,E,I.createElement(hk,{page:_})):E});dT.displayName="Link";var Ko=I.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:l,children:c,...d},f){let h=Xc(o,{relative:d.relative}),m=gn(),v=I.useContext(Qh),{navigator:P,basename:A}=I.useContext(Rr),C=v!=null&&Ik(h)&&l===!0,y=P.encodeLocation?P.encodeLocation(h).pathname:h.pathname,_=m.pathname,w=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;n||(_=_.toLowerCase(),w=w?w.toLowerCase():null,y=y.toLowerCase()),w&&A&&(w=_s(w,A)||w);const T=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let V=_===y||!s&&_.startsWith(y)&&_.charAt(T)==="/",U=w!=null&&(w===y||!s&&w.startsWith(y)&&w.charAt(y.length)==="/"),b={isActive:V,isPending:U,isTransitioning:C},E=V?e:void 0,x;typeof r=="function"?x=r(b):x=[r,V?"active":null,U?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let S=typeof i=="function"?i(b):i;return I.createElement(dT,{...d,"aria-current":E,className:x,ref:f,style:S,to:o,viewTransition:l},typeof c=="function"?c(b):c)});Ko.displayName="NavLink";var yk=I.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=pd,action:l,onSubmit:c,relative:d,preventScrollReset:f,viewTransition:h,...m},v)=>{let P=Ek(),A=bk(l,{relative:d}),C=o.toLowerCase()==="get"?"get":"post",y=typeof l=="string"&&uT.test(l),_=w=>{if(c&&c(w),w.defaultPrevented)return;w.preventDefault();let T=w.nativeEvent.submitter,V=(T==null?void 0:T.getAttribute("formmethod"))||o;P(T||w.currentTarget,{fetcherKey:e,method:V,navigate:n,replace:s,state:i,relative:d,preventScrollReset:f,viewTransition:h})};return I.createElement("form",{ref:v,method:C,action:A,onSubmit:r?c:_,...m,"data-discover":!y&&t==="render"?"true":void 0})});yk.displayName="Form";function vk(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function hT(t){let e=I.useContext(Xa);return xt(e,vk(t)),e}function _k(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let l=kr(),c=gn(),d=Xc(t,{relative:i});return I.useCallback(f=>{if(JP(f,e)){f.preventDefault();let h=n!==void 0?n:Ac(c)===Ac(d);l(t,{replace:h,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[c,l,d,n,r,e,t,s,i,o])}var xk=0,wk=()=>`__${String(++xk)}__`;function Ek(){let{router:t}=hT("useSubmit"),{basename:e}=I.useContext(Rr),n=BP();return I.useCallback(async(r,s={})=>{let{action:i,method:o,encType:l,formData:c,body:d}=tk(r,e);if(s.navigate===!1){let f=s.fetcherKey||wk();await t.fetch(f,n,s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||o,formEncType:s.encType||l,flushSync:s.flushSync})}else await t.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||o,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:n,flushSync:s.flushSync,viewTransition:s.viewTransition})},[t,e,n])}function bk(t,{relative:e}={}){let{basename:n}=I.useContext(Rr),r=I.useContext(Pr);xt(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Xc(t||".",{relative:e})},o=gn();if(t==null){i.search=o.search;let l=new URLSearchParams(i.search),c=l.getAll("index");if(c.some(f=>f==="")){l.delete("index"),c.filter(h=>h).forEach(h=>l.append("index",h));let f=l.toString();i.search=f?`?${f}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:fs([n,i.pathname])),Ac(i)}function Ik(t,{relative:e}={}){let n=I.useContext(nT);xt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=hT("useViewTransitionState"),s=Xc(t,{relative:e});if(!n.isTransitioning)return!1;let i=_s(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=_s(n.nextLocation.pathname,r)||n.nextLocation.pathname;return nh(s.pathname,o)!=null||nh(s.pathname,i)!=null}const Tk=()=>{};var ew={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fT=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},Sk=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},pT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,l=o?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,f=i>>2,h=(i&3)<<4|l>>4;let m=(l&15)<<2|d>>6,v=d&63;c||(v=64,o||(m=64)),r.push(n[f],n[h],n[m],n[v])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(fT(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Sk(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||h==null)throw new Ck;const m=i<<2|l>>4;if(r.push(m),d!==64){const v=l<<4&240|d>>2;if(r.push(v),h!==64){const P=d<<6&192|h;r.push(P)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Ck extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Nk=function(t){const e=fT(t);return pT.encodeByteArray(e,!0)},sh=function(t){return Nk(t).replace(/\./g,"")},mT=function(t){try{return pT.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gT(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ak=()=>gT().__FIREBASE_DEFAULTS__,Rk=()=>{if(typeof process>"u"||typeof ew>"u")return;const t=ew.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Pk=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&mT(t[1]);return e&&JSON.parse(e)},Xh=()=>{try{return Tk()||Ak()||Rk()||Pk()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},yT=t=>{var e,n;return(n=(e=Xh())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},vT=t=>{const e=yT(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},_T=()=>{var t;return(t=Xh())==null?void 0:t.config},xT=t=>{var e;return(e=Xh())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ky(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wT(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[sh(JSON.stringify(n)),sh(JSON.stringify(o)),""].join(".")}const nc={};function jk(){const t={prod:[],emulator:[]};for(const e of Object.keys(nc))nc[e]?t.emulator.push(e):t.prod.push(e);return t}function Dk(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let tw=!1;function jy(t,e){if(typeof window>"u"||typeof document>"u"||!Ii(window.location.host)||nc[t]===e||nc[t]||tw)return;nc[t]=e;function n(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=jk().prod.length>0;function o(){const m=document.getElementById(r);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,v){m.setAttribute("width","24"),m.setAttribute("id",v),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function d(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{tw=!0,o()},m}function f(m,v){m.setAttribute("id",v),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function h(){const m=Dk(r),v=n("text"),P=document.getElementById(v)||document.createElement("span"),A=n("learnmore"),C=document.getElementById(A)||document.createElement("a"),y=n("preprendIcon"),_=document.getElementById(y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const w=m.element;l(w),f(C,A);const T=d();c(_,y),w.append(_,P,C,T),document.body.appendChild(w)}i?(P.innerText="Preview backend disconnected.",_.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(_.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",v)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ok(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wt())}function ET(){var e;const t=(e=Xh())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Lk(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function bT(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Vk(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Mk(){const t=Wt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function IT(){return!ET()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function TT(){return!ET()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Dy(){try{return typeof indexedDB=="object"}catch{return!1}}function ST(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}function Fk(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk="FirebaseError";class fr extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Uk,Object.setPrototypeOf(this,fr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Co.prototype.create)}}class Co{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?$k(i,r):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new fr(s,l,r)}}function $k(t,e){return t.replace(Bk,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Bk=/\{\$([^}]+)}/g;function zk(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function xs(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(nw(i)&&nw(o)){if(!xs(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function nw(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jc(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Ml(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Fl(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function qk(t,e){const n=new Hk(t,e);return n.subscribe.bind(n)}class Hk{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Wk(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=bp),s.error===void 0&&(s.error=bp),s.complete===void 0&&(s.complete=bp);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Wk(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function bp(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk=1e3,Kk=2,Qk=4*60*60*1e3,Yk=.5;function rw(t,e=Gk,n=Kk){const r=e*Math.pow(n,t),s=Math.round(Yk*r*(Math.random()-.5)*2);return Math.min(Qk,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function et(t){return t&&t._delegate?t._delegate:t}class hr{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new kk;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Zk(e))try{this.getOrInitializeService({instanceIdentifier:Mi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Mi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Mi){return this.instances.has(e)}getOptions(e=Mi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Jk(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Mi){return this.component?this.component.multipleInstances?e:Mi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Jk(t){return t===Mi?void 0:t}function Zk(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Xk(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $e;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})($e||($e={}));const tj={debug:$e.DEBUG,verbose:$e.VERBOSE,info:$e.INFO,warn:$e.WARN,error:$e.ERROR,silent:$e.SILENT},nj=$e.INFO,rj={[$e.DEBUG]:"log",[$e.VERBOSE]:"log",[$e.INFO]:"info",[$e.WARN]:"warn",[$e.ERROR]:"error"},sj=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=rj[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Jh{constructor(e){this.name=e,this._logLevel=nj,this._logHandler=sj,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in $e))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tj[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,$e.DEBUG,...e),this._logHandler(this,$e.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,$e.VERBOSE,...e),this._logHandler(this,$e.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,$e.INFO,...e),this._logHandler(this,$e.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,$e.WARN,...e),this._logHandler(this,$e.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,$e.ERROR,...e),this._logHandler(this,$e.ERROR,...e)}}const ij=(t,e)=>e.some(n=>t instanceof n);let sw,iw;function oj(){return sw||(sw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aj(){return iw||(iw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const CT=new WeakMap,Km=new WeakMap,NT=new WeakMap,Ip=new WeakMap,Oy=new WeakMap;function lj(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(li(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&CT.set(n,t)}).catch(()=>{}),Oy.set(e,t),e}function cj(t){if(Km.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});Km.set(t,e)}let Qm={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Km.get(t);if(e==="objectStoreNames")return t.objectStoreNames||NT.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return li(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function uj(t){Qm=t(Qm)}function dj(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Tp(this),e,...n);return NT.set(r,e.sort?e.sort():[e]),li(r)}:aj().includes(t)?function(...e){return t.apply(Tp(this),e),li(CT.get(this))}:function(...e){return li(t.apply(Tp(this),e))}}function hj(t){return typeof t=="function"?dj(t):(t instanceof IDBTransaction&&cj(t),ij(t,oj())?new Proxy(t,Qm):t)}function li(t){if(t instanceof IDBRequest)return lj(t);if(Ip.has(t))return Ip.get(t);const e=hj(t);return e!==t&&(Ip.set(t,e),Oy.set(e,t)),e}const Tp=t=>Oy.get(t);function AT(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),l=li(o);return r&&o.addEventListener("upgradeneeded",c=>{r(li(o.result),c.oldVersion,c.newVersion,li(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const fj=["get","getKey","getAll","getAllKeys","count"],pj=["put","add","delete","clear"],Sp=new Map;function ow(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Sp.get(e))return Sp.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=pj.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||fj.includes(n)))return;const i=async function(o,...l){const c=this.transaction(o,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return Sp.set(e,i),i}uj(t=>({...t,get:(e,n,r)=>ow(e,n)||t.get(e,n,r),has:(e,n)=>!!ow(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mj{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(gj(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function gj(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ym="@firebase/app",aw="0.14.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ws=new Jh("@firebase/app"),yj="@firebase/app-compat",vj="@firebase/analytics-compat",_j="@firebase/analytics",xj="@firebase/app-check-compat",wj="@firebase/app-check",Ej="@firebase/auth",bj="@firebase/auth-compat",Ij="@firebase/database",Tj="@firebase/data-connect",Sj="@firebase/database-compat",Cj="@firebase/functions",Nj="@firebase/functions-compat",Aj="@firebase/installations",Rj="@firebase/installations-compat",Pj="@firebase/messaging",kj="@firebase/messaging-compat",jj="@firebase/performance",Dj="@firebase/performance-compat",Oj="@firebase/remote-config",Lj="@firebase/remote-config-compat",Vj="@firebase/storage",Mj="@firebase/storage-compat",Fj="@firebase/firestore",Uj="@firebase/ai",$j="@firebase/firestore-compat",Bj="firebase",zj="12.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xm="[DEFAULT]",qj={[Ym]:"fire-core",[yj]:"fire-core-compat",[_j]:"fire-analytics",[vj]:"fire-analytics-compat",[wj]:"fire-app-check",[xj]:"fire-app-check-compat",[Ej]:"fire-auth",[bj]:"fire-auth-compat",[Ij]:"fire-rtdb",[Tj]:"fire-data-connect",[Sj]:"fire-rtdb-compat",[Cj]:"fire-fn",[Nj]:"fire-fn-compat",[Aj]:"fire-iid",[Rj]:"fire-iid-compat",[Pj]:"fire-fcm",[kj]:"fire-fcm-compat",[jj]:"fire-perf",[Dj]:"fire-perf-compat",[Oj]:"fire-rc",[Lj]:"fire-rc-compat",[Vj]:"fire-gcs",[Mj]:"fire-gcs-compat",[Fj]:"fire-fst",[$j]:"fire-fst-compat",[Uj]:"fire-vertex","fire-js":"fire-js",[Bj]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ih=new Map,Hj=new Map,Jm=new Map;function lw(t,e){try{t.container.addComponent(e)}catch(n){ws.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Cr(t){const e=t.name;if(Jm.has(e))return ws.debug(`There were multiple attempts to register component ${e}.`),!1;Jm.set(e,t);for(const n of ih.values())lw(n,t);for(const n of Hj.values())lw(n,t);return!0}function Ti(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function rr(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wj={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ci=new Co("app","Firebase",Wj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gj{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new hr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ci.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const No=zj;function Ly(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Xm,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw ci.create("bad-app-name",{appName:String(s)});if(n||(n=_T()),!n)throw ci.create("no-options");const i=ih.get(s);if(i){if(xs(n,i.options)&&xs(r,i.config))return i;throw ci.create("duplicate-app",{appName:s})}const o=new ej(s);for(const c of Jm.values())o.addComponent(c);const l=new Gj(n,r,o);return ih.set(s,l),l}function Zh(t=Xm){const e=ih.get(t);if(!e&&t===Xm&&_T())return Ly();if(!e)throw ci.create("no-app",{appName:t});return e}function Ln(t,e,n){let r=qj[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ws.warn(o.join(" "));return}Cr(new hr(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kj="firebase-heartbeat-database",Qj=1,Rc="firebase-heartbeat-store";let Cp=null;function RT(){return Cp||(Cp=AT(Kj,Qj,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Rc)}catch(n){console.warn(n)}}}}).catch(t=>{throw ci.create("idb-open",{originalErrorMessage:t.message})})),Cp}async function Yj(t){try{const n=(await RT()).transaction(Rc),r=await n.objectStore(Rc).get(PT(t));return await n.done,r}catch(e){if(e instanceof fr)ws.warn(e.message);else{const n=ci.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ws.warn(n.message)}}}async function cw(t,e){try{const r=(await RT()).transaction(Rc,"readwrite");await r.objectStore(Rc).put(e,PT(t)),await r.done}catch(n){if(n instanceof fr)ws.warn(n.message);else{const r=ci.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ws.warn(r.message)}}}function PT(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xj=1024,Jj=30;class Zj{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new tD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=uw();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>Jj){const o=nD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ws.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=uw(),{heartbeatsToSend:r,unsentEntries:s}=eD(this._heartbeatsCache.heartbeats),i=sh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ws.warn(n),""}}}function uw(){return new Date().toISOString().substring(0,10)}function eD(t,e=Xj){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),dw(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),dw(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class tD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Dy()?ST().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Yj(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return cw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return cw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function dw(t){return sh(JSON.stringify({version:2,heartbeats:t})).length}function nD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rD(t){Cr(new hr("platform-logger",e=>new mj(e),"PRIVATE")),Cr(new hr("heartbeat",e=>new Zj(e),"PRIVATE")),Ln(Ym,aw,t),Ln(Ym,aw,"esm2020"),Ln("fire-js","")}rD("");var sD="firebase",iD="12.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ln(sD,iD,"app");function kT(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const oD=kT,jT=new Co("auth","Firebase",kT());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oh=new Jh("@firebase/auth");function aD(t,...e){oh.logLevel<=$e.WARN&&oh.warn(`Auth (${No}): ${t}`,...e)}function gd(t,...e){oh.logLevel<=$e.ERROR&&oh.error(`Auth (${No}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nr(t,...e){throw Vy(t,...e)}function Qr(t,...e){return Vy(t,...e)}function DT(t,e,n){const r={...oD(),[e]:n};return new Co("auth","Firebase",r).create(e,{appName:t.name})}function ui(t){return DT(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Vy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return jT.create(t,...e)}function Ie(t,e,...n){if(!t)throw Vy(e,...n)}function cs(t){const e="INTERNAL ASSERTION FAILED: "+t;throw gd(e),new Error(e)}function Es(t,e){t||cs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zm(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function lD(){return hw()==="http:"||hw()==="https:"}function hw(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(lD()||bT()||"connection"in navigator)?navigator.onLine:!0}function uD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(e,n){this.shortDelay=e,this.longDelay=n,Es(n>e,"Short delay should be less than long delay!"),this.isMobile=Ok()||Vk()}get(){return cD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function My(t,e){Es(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OT{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;cs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;cs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;cs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dD={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hD=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],fD=new Zc(3e4,6e4);function Ao(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Si(t,e,n,r,s={}){return LT(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const l=Jc({key:t.config.apiKey,...o}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return Lk()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&Ii(t.emulatorConfig.host)&&(d.credentials="include"),OT.fetch()(await VT(t,t.config.apiHost,n,l),d)})}async function LT(t,e,n){t._canInitEmulator=!1;const r={...dD,...e};try{const s=new mD(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw zu(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const l=i.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw zu(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw zu(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw zu(t,"user-disabled",o);const f=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw DT(t,f,d);Nr(t,f)}}catch(s){if(s instanceof fr)throw s;Nr(t,"network-request-failed",{message:String(s)})}}async function ef(t,e,n,r,s={}){const i=await Si(t,e,n,r,s);return"mfaPendingCredential"in i&&Nr(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function VT(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?My(t.config,s):`${t.config.apiScheme}://${s}`;return hD.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function pD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class mD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Qr(this.auth,"network-request-failed")),fD.get())})}}function zu(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Qr(t,e,r);return s.customData._tokenResponse=n,s}function fw(t){return t!==void 0&&t.enterprise!==void 0}class gD{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return pD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function yD(t,e){return Si(t,"GET","/v2/recaptchaConfig",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vD(t,e){return Si(t,"POST","/v1/accounts:delete",e)}async function ah(t,e){return Si(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function _D(t,e=!1){const n=et(t),r=await n.getIdToken(e),s=Fy(r);Ie(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:rc(Np(s.auth_time)),issuedAtTime:rc(Np(s.iat)),expirationTime:rc(Np(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Np(t){return Number(t)*1e3}function Fy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return gd("JWT malformed, contained fewer than 3 sections"),null;try{const s=mT(n);return s?JSON.parse(s):(gd("Failed to decode base64 JWT payload"),null)}catch(s){return gd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function pw(t){const e=Fy(t);return Ie(e,"internal-error"),Ie(typeof e.exp<"u","internal-error"),Ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof fr&&xD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function xD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=rc(this.lastLoginAt),this.creationTime=rc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lh(t){var h;const e=t.auth,n=await t.getIdToken(),r=await Pc(t,ah(e,{idToken:n}));Ie(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?MT(s.providerUserInfo):[],o=bD(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),d=l?c:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new eg(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,f)}async function ED(t){const e=et(t);await lh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function bD(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function MT(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ID(t,e){const n=await LT(t,{},async()=>{const r=Jc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await VT(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&Ii(t.emulatorConfig.host)&&(c.credentials="include"),OT.fetch()(o,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function TD(t,e){return Si(t,"POST","/v2/accounts:revokeToken",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ie(e.idToken,"internal-error"),Ie(typeof e.idToken<"u","internal-error"),Ie(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):pw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ie(e.length!==0,"internal-error");const n=pw(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await ID(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new va;return r&&(Ie(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Ie(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Ie(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new va,this.toJSON())}_performRefresh(){return cs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Os(t,e){Ie(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Er{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new wD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new eg(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Pc(this,this.stsTokenManager.getToken(this.auth,e));return Ie(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return _D(this,e)}reload(){return ED(this)}_assign(e){this!==e&&(Ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Er({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await lh(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(rr(this.auth.app))return Promise.reject(ui(this.auth));const e=await this.getIdToken();return await Pc(this,vD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,f=n.lastLoginAt??void 0,{uid:h,emailVerified:m,isAnonymous:v,providerData:P,stsTokenManager:A}=n;Ie(h&&A,e,"internal-error");const C=va.fromJSON(this.name,A);Ie(typeof h=="string",e,"internal-error"),Os(r,e.name),Os(s,e.name),Ie(typeof m=="boolean",e,"internal-error"),Ie(typeof v=="boolean",e,"internal-error"),Os(i,e.name),Os(o,e.name),Os(l,e.name),Os(c,e.name),Os(d,e.name),Os(f,e.name);const y=new Er({uid:h,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:v,photoURL:o,phoneNumber:i,tenantId:l,stsTokenManager:C,createdAt:d,lastLoginAt:f});return P&&Array.isArray(P)&&(y.providerData=P.map(_=>({..._}))),c&&(y._redirectEventId=c),y}static async _fromIdTokenResponse(e,n,r=!1){const s=new va;s.updateFromServerResponse(n);const i=new Er({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await lh(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Ie(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?MT(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new va;l.updateFromIdToken(r);const c=new Er({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new eg(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mw=new Map;function us(t){Es(t instanceof Function,"Expected a class definition");let e=mw.get(t);return e?(Es(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,mw.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FT{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}FT.type="NONE";const gw=FT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yd(t,e,n){return`firebase:${t}:${e}:${n}`}class _a{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=yd(this.userKey,s.apiKey,i),this.fullPersistenceKey=yd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await ah(this.auth,{idToken:e}).catch(()=>{});return n?Er._fromGetAccountInfoResponse(this.auth,n,e):null}return Er._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new _a(us(gw),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||us(gw);const o=yd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const f=await d._get(o);if(f){let h;if(typeof f=="string"){const m=await ah(e,{idToken:f}).catch(()=>{});if(!m)break;h=await Er._fromGetAccountInfoResponse(e,m,f)}else h=Er._fromJSON(e,f);d!==i&&(l=h),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new _a(i,e,r):(i=c[0],l&&await i._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(o)}catch{}})),new _a(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(UT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(HT(e))return"Blackberry";if(WT(e))return"Webos";if($T(e))return"Safari";if((e.includes("chrome/")||BT(e))&&!e.includes("edge/"))return"Chrome";if(qT(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function UT(t=Wt()){return/firefox\//i.test(t)}function $T(t=Wt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function BT(t=Wt()){return/crios\//i.test(t)}function zT(t=Wt()){return/iemobile/i.test(t)}function qT(t=Wt()){return/android/i.test(t)}function HT(t=Wt()){return/blackberry/i.test(t)}function WT(t=Wt()){return/webos/i.test(t)}function Uy(t=Wt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function SD(t=Wt()){var e;return Uy(t)&&!!((e=window.navigator)!=null&&e.standalone)}function CD(){return Mk()&&document.documentMode===10}function GT(t=Wt()){return Uy(t)||qT(t)||WT(t)||HT(t)||/windows phone/i.test(t)||zT(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KT(t,e=[]){let n;switch(t){case"Browser":n=yw(Wt());break;case"Worker":n=`${yw(Wt())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${No}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ND{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,l)=>{try{const c=e(i);o(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AD(t,e={}){return Si(t,"GET","/v2/passwordPolicy",Ao(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RD=6;class PD{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??RD,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new vw(this),this.idTokenSubscription=new vw(this),this.beforeStateQueue=new ND(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jT,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=us(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await _a.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await ah(this,{idToken:e}),r=await Er._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(rr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await lh(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=uD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(rr(this.app))return Promise.reject(ui(this));const n=e?et(e):null;return n&&Ie(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return rr(this.app)?Promise.reject(ui(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return rr(this.app)?Promise.reject(ui(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(us(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await AD(this),n=new PD(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Co("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await TD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&us(e)||this._popupRedirectResolver;Ie(n,this,"argument-error"),this.redirectPersistenceManager=await _a.create(this,[us(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ie(l,this,"internal-error"),l.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=KT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(rr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&aD(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Za(t){return et(t)}class vw{constructor(e){this.auth=e,this.observer=null,this.addObserver=qk(n=>this.observer=n)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function jD(t){tf=t}function QT(t){return tf.loadJS(t)}function DD(){return tf.recaptchaEnterpriseScript}function OD(){return tf.gapiScript}function LD(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class VD{constructor(){this.enterprise=new MD}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class MD{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const FD="recaptcha-enterprise",YT="NO_RECAPTCHA";class UD{constructor(e){this.type=FD,this.auth=Za(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,l)=>{yD(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new gD(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,o,l){const c=window.grecaptcha;fw(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{o(d)}).catch(()=>{o(YT)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new VD().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(l=>{if(!n&&fw(window.grecaptcha))s(l,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=DD();c.length!==0&&(c+=l),QT(c).then(()=>{s(l,i,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function _w(t,e,n,r=!1,s=!1){const i=new UD(t);let o;if(s)o=YT;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:o}):Object.assign(l,{captchaResponse:o}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function xw(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await _w(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await _w(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $D(t,e){const n=Ti(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(xs(i,e??{}))return s;Nr(s,"already-initialized")}return n.initialize({options:e})}function BD(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(us);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function zD(t,e,n){const r=Za(t);Ie(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=XT(e),{host:o,port:l}=qD(e),c=l===null?"":`:${l}`,d={url:`${i}//${o}${c}/`},f=Object.freeze({host:o,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Ie(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ie(xs(d,r.config.emulator)&&xs(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,Ii(o)?(ky(`${i}//${o}${c}`),jy("Auth",!0)):HD()}function XT(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function qD(t){const e=XT(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:ww(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:ww(o)}}}function ww(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function HD(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $y{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return cs("not implemented")}_getIdTokenResponse(e){return cs("not implemented")}_linkToIdToken(e,n){return cs("not implemented")}_getReauthenticationResolver(e){return cs("not implemented")}}async function WD(t,e){return Si(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GD(t,e){return ef(t,"POST","/v1/accounts:signInWithPassword",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KD(t,e){return ef(t,"POST","/v1/accounts:signInWithEmailLink",Ao(t,e))}async function QD(t,e){return ef(t,"POST","/v1/accounts:signInWithEmailLink",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kc extends $y{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new kc(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new kc(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xw(e,n,"signInWithPassword",GD);case"emailLink":return KD(e,{email:this._email,oobCode:this._password});default:Nr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xw(e,r,"signUpPassword",WD);case"emailLink":return QD(e,{idToken:n,email:this._email,oobCode:this._password});default:Nr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xa(t,e){return ef(t,"POST","/v1/accounts:signInWithIdp",Ao(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YD="http://localhost";class uo extends $y{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new uo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Nr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new uo(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return xa(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,xa(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,xa(e,n)}buildRequest(){const e={requestUri:YD,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Jc(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XD(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function JD(t){const e=Ml(Fl(t)).link,n=e?Ml(Fl(e)).deep_link_id:null,r=Ml(Fl(t)).deep_link_id;return(r?Ml(Fl(r)).link:null)||r||n||e||t}class By{constructor(e){const n=Ml(Fl(e)),r=n.apiKey??null,s=n.oobCode??null,i=XD(n.mode??null);Ie(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=JD(e);try{return new By(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(){this.providerId=el.PROVIDER_ID}static credential(e,n){return kc._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=By.parseLink(n);return Ie(r,"argument-error"),kc._fromEmailAndCode(e,r.code,r.tenantId)}}el.PROVIDER_ID="password";el.EMAIL_PASSWORD_SIGN_IN_METHOD="password";el.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu extends JT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs extends eu{constructor(){super("facebook.com")}static credential(e){return uo._fromParams({providerId:qs.PROVIDER_ID,signInMethod:qs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qs.credentialFromTaggedObject(e)}static credentialFromError(e){return qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qs.credential(e.oauthAccessToken)}catch{return null}}}qs.FACEBOOK_SIGN_IN_METHOD="facebook.com";qs.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs extends eu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return uo._fromParams({providerId:Hs.PROVIDER_ID,signInMethod:Hs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Hs.credentialFromTaggedObject(e)}static credentialFromError(e){return Hs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Hs.credential(n,r)}catch{return null}}}Hs.GOOGLE_SIGN_IN_METHOD="google.com";Hs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws extends eu{constructor(){super("github.com")}static credential(e){return uo._fromParams({providerId:Ws.PROVIDER_ID,signInMethod:Ws.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ws.credentialFromTaggedObject(e)}static credentialFromError(e){return Ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ws.credential(e.oauthAccessToken)}catch{return null}}}Ws.GITHUB_SIGN_IN_METHOD="github.com";Ws.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs extends eu{constructor(){super("twitter.com")}static credential(e,n){return uo._fromParams({providerId:Gs.PROVIDER_ID,signInMethod:Gs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Gs.credentialFromTaggedObject(e)}static credentialFromError(e){return Gs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Gs.credential(n,r)}catch{return null}}}Gs.TWITTER_SIGN_IN_METHOD="twitter.com";Gs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Er._fromIdTokenResponse(e,r,s),o=Ew(r);return new ka({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=Ew(r);return new ka({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function Ew(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch extends fr{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,ch.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new ch(e,n,r,s)}}function ZT(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ch._fromErrorAndOperation(t,i,e,r):i})}async function ZD(t,e,n=!1){const r=await Pc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ka._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e2(t,e,n=!1){const{auth:r}=t;if(rr(r.app))return Promise.reject(ui(r));const s="reauthenticate";try{const i=await Pc(t,ZT(r,s,e,t),n);Ie(i.idToken,r,"internal-error");const o=Fy(i.idToken);Ie(o,r,"internal-error");const{sub:l}=o;return Ie(t.uid===l,r,"user-mismatch"),ka._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Nr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eS(t,e,n=!1){if(rr(t.app))return Promise.reject(ui(t));const r="signIn",s=await ZT(t,r,e),i=await ka._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function t2(t,e){return eS(Za(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n2(t){const e=Za(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function r2(t,e,n){return rr(t.app)?Promise.reject(ui(t)):t2(et(t),el.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&n2(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(t,e){return et(t).setPersistence(e)}function i2(t,e,n,r){return et(t).onIdTokenChanged(e,n,r)}function o2(t,e,n){return et(t).beforeAuthStateChanged(e,n)}function zy(t,e,n,r){return et(t).onAuthStateChanged(e,n,r)}function a2(t){return et(t).signOut()}const uh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tS{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(uh,"1"),this.storage.removeItem(uh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l2=1e3,c2=10;class nS extends tS{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=GT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);CD()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,c2):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},l2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}nS.type="LOCAL";const rS=nS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sS extends tS{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}sS.type="SESSION";const iS=sS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new nf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(o).map(async d=>d(n.origin,i)),c=await u2(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}nf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qy(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((l,c)=>{const d=qy("",20);s.port1.start();const f=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const m=h;if(m.data.eventId===d)switch(m.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(m.data.response);break;default:clearTimeout(f),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yr(){return window}function h2(t){Yr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oS(){return typeof Yr().WorkerGlobalScope<"u"&&typeof Yr().importScripts=="function"}async function f2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function p2(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function m2(){return oS()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aS="firebaseLocalStorageDb",g2=1,dh="firebaseLocalStorage",lS="fbase_key";class tu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function rf(t,e){return t.transaction([dh],e?"readwrite":"readonly").objectStore(dh)}function y2(){const t=indexedDB.deleteDatabase(aS);return new tu(t).toPromise()}function tg(){const t=indexedDB.open(aS,g2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(dh,{keyPath:lS})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(dh)?e(r):(r.close(),await y2(),e(await tg()))})})}async function bw(t,e,n){const r=rf(t,!0).put({[lS]:e,value:n});return new tu(r).toPromise()}async function v2(t,e){const n=rf(t,!1).get(e),r=await new tu(n).toPromise();return r===void 0?null:r.value}function Iw(t,e){const n=rf(t,!0).delete(e);return new tu(n).toPromise()}const _2=800,x2=3;class cS{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await tg(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>x2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return oS()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nf._getInstance(m2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await f2(),!this.activeServiceWorker)return;this.sender=new d2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||p2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await tg();return await bw(e,uh,"1"),await Iw(e,uh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>bw(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>v2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Iw(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=rf(s,!1).getAll();return new tu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}cS.type="LOCAL";const w2=cS;new Zc(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E2(t,e){return e?us(e):(Ie(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hy extends $y{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return xa(e,this._buildIdpRequest())}_linkToIdToken(e,n){return xa(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return xa(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function b2(t){return eS(t.auth,new Hy(t),t.bypassAuthState)}function I2(t){const{auth:e,user:n}=t;return Ie(n,e,"internal-error"),e2(n,new Hy(t),t.bypassAuthState)}async function T2(t){const{auth:e,user:n}=t;return Ie(n,e,"internal-error"),ZD(n,new Hy(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uS{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return b2;case"linkViaPopup":case"linkViaRedirect":return T2;case"reauthViaPopup":case"reauthViaRedirect":return I2;default:Nr(this.auth,"internal-error")}}resolve(e){Es(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Es(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S2=new Zc(2e3,1e4);class da extends uS{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,da.currentPopupAction&&da.currentPopupAction.cancel(),da.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ie(e,this.auth,"internal-error"),e}async onExecution(){Es(this.filter.length===1,"Popup operations only handle one event");const e=qy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Qr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Qr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,da.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,S2.get())};e()}}da.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C2="pendingRedirect",vd=new Map;class N2 extends uS{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=vd.get(this.auth._key());if(!e){try{const r=await A2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}vd.set(this.auth._key(),e)}return this.bypassAuthState||vd.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function A2(t,e){const n=k2(e),r=P2(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function R2(t,e){vd.set(t._key(),e)}function P2(t){return us(t._redirectPersistence)}function k2(t){return yd(C2,t.config.apiKey,t.name)}async function j2(t,e,n=!1){if(rr(t.app))return Promise.reject(ui(t));const r=Za(t),s=E2(r,e),o=await new N2(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D2=10*60*1e3;class O2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!L2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!dS(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Qr(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=D2&&this.cachedEventUids.clear(),this.cachedEventUids.has(Tw(e))}saveEventToCache(e){this.cachedEventUids.add(Tw(e)),this.lastProcessedEventTime=Date.now()}}function Tw(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function dS({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function L2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return dS(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function V2(t,e={}){return Si(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,F2=/^https?/;async function U2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await V2(t);for(const n of e)try{if($2(n))return}catch{}Nr(t,"unauthorized-domain")}function $2(t){const e=Zm(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!F2.test(n))return!1;if(M2.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B2=new Zc(3e4,6e4);function Sw(){const t=Yr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function z2(t){return new Promise((e,n)=>{var s,i,o;function r(){Sw(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Sw(),n(Qr(t,"network-request-failed"))},timeout:B2.get()})}if((i=(s=Yr().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Yr().gapi)!=null&&o.load)r();else{const l=LD("iframefcb");return Yr()[l]=()=>{gapi.load?r():n(Qr(t,"network-request-failed"))},QT(`${OD()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw _d=null,e})}let _d=null;function q2(t){return _d=_d||z2(t),_d}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H2=new Zc(5e3,15e3),W2="__/auth/iframe",G2="emulator/auth/iframe",K2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Q2=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Y2(t){const e=t.config;Ie(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?My(e,G2):`https://${t.config.authDomain}/${W2}`,r={apiKey:e.apiKey,appName:t.name,v:No},s=Q2.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Jc(r).slice(1)}`}async function X2(t){const e=await q2(t),n=Yr().gapi;return Ie(n,t,"internal-error"),e.open({where:document.body,url:Y2(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:K2,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Qr(t,"network-request-failed"),l=Yr().setTimeout(()=>{i(o)},H2.get());function c(){Yr().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J2={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Z2=500,eO=600,tO="_blank",nO="http://localhost";class Cw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function rO(t,e,n,r=Z2,s=eO){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...J2,width:r.toString(),height:s.toString(),top:i,left:o},d=Wt().toLowerCase();n&&(l=BT(d)?tO:n),UT(d)&&(e=e||nO,c.scrollbars="yes");const f=Object.entries(c).reduce((m,[v,P])=>`${m}${v}=${P},`,"");if(SD(d)&&l!=="_self")return sO(e||"",l),new Cw(null);const h=window.open(e||"",l,f);Ie(h,t,"popup-blocked");try{h.focus()}catch{}return new Cw(h)}function sO(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iO="__/auth/handler",oO="emulator/auth/handler",aO=encodeURIComponent("fac");async function Nw(t,e,n,r,s,i){Ie(t.config.authDomain,t,"auth-domain-config-required"),Ie(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:No,eventId:s};if(e instanceof JT){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",zk(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,h]of Object.entries({}))o[f]=h}if(e instanceof eu){const f=e.getScopes().filter(h=>h!=="");f.length>0&&(o.scopes=f.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const c=await t._getAppCheckToken(),d=c?`#${aO}=${encodeURIComponent(c)}`:"";return`${lO(t)}?${Jc(l).slice(1)}${d}`}function lO({config:t}){return t.emulator?My(t,oO):`https://${t.authDomain}/${iO}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ap="webStorageSupport";class cO{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=iS,this._completeRedirectFn=j2,this._overrideRedirectResult=R2}async _openPopup(e,n,r,s){var o;Es((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await Nw(e,n,r,Zm(),s);return rO(e,i,qy())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Nw(e,n,r,Zm(),s);return h2(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(Es(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await X2(e),r=new O2(e);return n.register("authEvent",s=>(Ie(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Ap,{type:Ap},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Ap];i!==void 0&&n(!!i),Nr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=U2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return GT()||$T()||Uy()}}const uO=cO;var Aw="@firebase/auth",Rw="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dO{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hO(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function fO(t){Cr(new hr("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;Ie(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:KT(t)},d=new kD(r,s,i,c);return BD(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Cr(new hr("auth-internal",e=>{const n=Za(e.getProvider("auth").getImmediate());return(r=>new dO(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ln(Aw,Rw,hO(t)),Ln(Aw,Rw,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pO=5*60,mO=xT("authIdTokenMaxAge")||pO;let Pw=null;const gO=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>mO)return;const s=n==null?void 0:n.token;Pw!==s&&(Pw=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function hS(t=Zh()){const e=Ti(t,"auth");if(e.isInitialized())return e.getImmediate();const n=$D(t,{popupRedirectResolver:uO,persistence:[w2,rS,iS]}),r=xT("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=gO(i.toString());o2(n,o,()=>o(n.currentUser)),i2(n,l=>o(l))}}const s=yT("auth");return s&&zD(n,`http://${s}`),n}function yO(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}jD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Qr("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",yO().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});fO("Browser");var kw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var di,fS;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(b,E){function x(){}x.prototype=E.prototype,b.F=E.prototype,b.prototype=new x,b.prototype.constructor=b,b.D=function(S,j,L){for(var k=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)k[Y-2]=arguments[Y];return E.prototype[j].apply(S,k)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(b,E,x){x||(x=0);const S=Array(16);if(typeof E=="string")for(var j=0;j<16;++j)S[j]=E.charCodeAt(x++)|E.charCodeAt(x++)<<8|E.charCodeAt(x++)<<16|E.charCodeAt(x++)<<24;else for(j=0;j<16;++j)S[j]=E[x++]|E[x++]<<8|E[x++]<<16|E[x++]<<24;E=b.g[0],x=b.g[1],j=b.g[2];let L=b.g[3],k;k=E+(L^x&(j^L))+S[0]+3614090360&4294967295,E=x+(k<<7&4294967295|k>>>25),k=L+(j^E&(x^j))+S[1]+3905402710&4294967295,L=E+(k<<12&4294967295|k>>>20),k=j+(x^L&(E^x))+S[2]+606105819&4294967295,j=L+(k<<17&4294967295|k>>>15),k=x+(E^j&(L^E))+S[3]+3250441966&4294967295,x=j+(k<<22&4294967295|k>>>10),k=E+(L^x&(j^L))+S[4]+4118548399&4294967295,E=x+(k<<7&4294967295|k>>>25),k=L+(j^E&(x^j))+S[5]+1200080426&4294967295,L=E+(k<<12&4294967295|k>>>20),k=j+(x^L&(E^x))+S[6]+2821735955&4294967295,j=L+(k<<17&4294967295|k>>>15),k=x+(E^j&(L^E))+S[7]+4249261313&4294967295,x=j+(k<<22&4294967295|k>>>10),k=E+(L^x&(j^L))+S[8]+1770035416&4294967295,E=x+(k<<7&4294967295|k>>>25),k=L+(j^E&(x^j))+S[9]+2336552879&4294967295,L=E+(k<<12&4294967295|k>>>20),k=j+(x^L&(E^x))+S[10]+4294925233&4294967295,j=L+(k<<17&4294967295|k>>>15),k=x+(E^j&(L^E))+S[11]+2304563134&4294967295,x=j+(k<<22&4294967295|k>>>10),k=E+(L^x&(j^L))+S[12]+1804603682&4294967295,E=x+(k<<7&4294967295|k>>>25),k=L+(j^E&(x^j))+S[13]+4254626195&4294967295,L=E+(k<<12&4294967295|k>>>20),k=j+(x^L&(E^x))+S[14]+2792965006&4294967295,j=L+(k<<17&4294967295|k>>>15),k=x+(E^j&(L^E))+S[15]+1236535329&4294967295,x=j+(k<<22&4294967295|k>>>10),k=E+(j^L&(x^j))+S[1]+4129170786&4294967295,E=x+(k<<5&4294967295|k>>>27),k=L+(x^j&(E^x))+S[6]+3225465664&4294967295,L=E+(k<<9&4294967295|k>>>23),k=j+(E^x&(L^E))+S[11]+643717713&4294967295,j=L+(k<<14&4294967295|k>>>18),k=x+(L^E&(j^L))+S[0]+3921069994&4294967295,x=j+(k<<20&4294967295|k>>>12),k=E+(j^L&(x^j))+S[5]+3593408605&4294967295,E=x+(k<<5&4294967295|k>>>27),k=L+(x^j&(E^x))+S[10]+38016083&4294967295,L=E+(k<<9&4294967295|k>>>23),k=j+(E^x&(L^E))+S[15]+3634488961&4294967295,j=L+(k<<14&4294967295|k>>>18),k=x+(L^E&(j^L))+S[4]+3889429448&4294967295,x=j+(k<<20&4294967295|k>>>12),k=E+(j^L&(x^j))+S[9]+568446438&4294967295,E=x+(k<<5&4294967295|k>>>27),k=L+(x^j&(E^x))+S[14]+3275163606&4294967295,L=E+(k<<9&4294967295|k>>>23),k=j+(E^x&(L^E))+S[3]+4107603335&4294967295,j=L+(k<<14&4294967295|k>>>18),k=x+(L^E&(j^L))+S[8]+1163531501&4294967295,x=j+(k<<20&4294967295|k>>>12),k=E+(j^L&(x^j))+S[13]+2850285829&4294967295,E=x+(k<<5&4294967295|k>>>27),k=L+(x^j&(E^x))+S[2]+4243563512&4294967295,L=E+(k<<9&4294967295|k>>>23),k=j+(E^x&(L^E))+S[7]+1735328473&4294967295,j=L+(k<<14&4294967295|k>>>18),k=x+(L^E&(j^L))+S[12]+2368359562&4294967295,x=j+(k<<20&4294967295|k>>>12),k=E+(x^j^L)+S[5]+4294588738&4294967295,E=x+(k<<4&4294967295|k>>>28),k=L+(E^x^j)+S[8]+2272392833&4294967295,L=E+(k<<11&4294967295|k>>>21),k=j+(L^E^x)+S[11]+1839030562&4294967295,j=L+(k<<16&4294967295|k>>>16),k=x+(j^L^E)+S[14]+4259657740&4294967295,x=j+(k<<23&4294967295|k>>>9),k=E+(x^j^L)+S[1]+2763975236&4294967295,E=x+(k<<4&4294967295|k>>>28),k=L+(E^x^j)+S[4]+1272893353&4294967295,L=E+(k<<11&4294967295|k>>>21),k=j+(L^E^x)+S[7]+4139469664&4294967295,j=L+(k<<16&4294967295|k>>>16),k=x+(j^L^E)+S[10]+3200236656&4294967295,x=j+(k<<23&4294967295|k>>>9),k=E+(x^j^L)+S[13]+681279174&4294967295,E=x+(k<<4&4294967295|k>>>28),k=L+(E^x^j)+S[0]+3936430074&4294967295,L=E+(k<<11&4294967295|k>>>21),k=j+(L^E^x)+S[3]+3572445317&4294967295,j=L+(k<<16&4294967295|k>>>16),k=x+(j^L^E)+S[6]+76029189&4294967295,x=j+(k<<23&4294967295|k>>>9),k=E+(x^j^L)+S[9]+3654602809&4294967295,E=x+(k<<4&4294967295|k>>>28),k=L+(E^x^j)+S[12]+3873151461&4294967295,L=E+(k<<11&4294967295|k>>>21),k=j+(L^E^x)+S[15]+530742520&4294967295,j=L+(k<<16&4294967295|k>>>16),k=x+(j^L^E)+S[2]+3299628645&4294967295,x=j+(k<<23&4294967295|k>>>9),k=E+(j^(x|~L))+S[0]+4096336452&4294967295,E=x+(k<<6&4294967295|k>>>26),k=L+(x^(E|~j))+S[7]+1126891415&4294967295,L=E+(k<<10&4294967295|k>>>22),k=j+(E^(L|~x))+S[14]+2878612391&4294967295,j=L+(k<<15&4294967295|k>>>17),k=x+(L^(j|~E))+S[5]+4237533241&4294967295,x=j+(k<<21&4294967295|k>>>11),k=E+(j^(x|~L))+S[12]+1700485571&4294967295,E=x+(k<<6&4294967295|k>>>26),k=L+(x^(E|~j))+S[3]+2399980690&4294967295,L=E+(k<<10&4294967295|k>>>22),k=j+(E^(L|~x))+S[10]+4293915773&4294967295,j=L+(k<<15&4294967295|k>>>17),k=x+(L^(j|~E))+S[1]+2240044497&4294967295,x=j+(k<<21&4294967295|k>>>11),k=E+(j^(x|~L))+S[8]+1873313359&4294967295,E=x+(k<<6&4294967295|k>>>26),k=L+(x^(E|~j))+S[15]+4264355552&4294967295,L=E+(k<<10&4294967295|k>>>22),k=j+(E^(L|~x))+S[6]+2734768916&4294967295,j=L+(k<<15&4294967295|k>>>17),k=x+(L^(j|~E))+S[13]+1309151649&4294967295,x=j+(k<<21&4294967295|k>>>11),k=E+(j^(x|~L))+S[4]+4149444226&4294967295,E=x+(k<<6&4294967295|k>>>26),k=L+(x^(E|~j))+S[11]+3174756917&4294967295,L=E+(k<<10&4294967295|k>>>22),k=j+(E^(L|~x))+S[2]+718787259&4294967295,j=L+(k<<15&4294967295|k>>>17),k=x+(L^(j|~E))+S[9]+3951481745&4294967295,b.g[0]=b.g[0]+E&4294967295,b.g[1]=b.g[1]+(j+(k<<21&4294967295|k>>>11))&4294967295,b.g[2]=b.g[2]+j&4294967295,b.g[3]=b.g[3]+L&4294967295}r.prototype.v=function(b,E){E===void 0&&(E=b.length);const x=E-this.blockSize,S=this.C;let j=this.h,L=0;for(;L<E;){if(j==0)for(;L<=x;)s(this,b,L),L+=this.blockSize;if(typeof b=="string"){for(;L<E;)if(S[j++]=b.charCodeAt(L++),j==this.blockSize){s(this,S),j=0;break}}else for(;L<E;)if(S[j++]=b[L++],j==this.blockSize){s(this,S),j=0;break}}this.h=j,this.o+=E},r.prototype.A=function(){var b=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);b[0]=128;for(var E=1;E<b.length-8;++E)b[E]=0;E=this.o*8;for(var x=b.length-8;x<b.length;++x)b[x]=E&255,E/=256;for(this.v(b),b=Array(16),E=0,x=0;x<4;++x)for(let S=0;S<32;S+=8)b[E++]=this.g[x]>>>S&255;return b};function i(b,E){var x=l;return Object.prototype.hasOwnProperty.call(x,b)?x[b]:x[b]=E(b)}function o(b,E){this.h=E;const x=[];let S=!0;for(let j=b.length-1;j>=0;j--){const L=b[j]|0;S&&L==E||(x[j]=L,S=!1)}this.g=x}var l={};function c(b){return-128<=b&&b<128?i(b,function(E){return new o([E|0],E<0?-1:0)}):new o([b|0],b<0?-1:0)}function d(b){if(isNaN(b)||!isFinite(b))return h;if(b<0)return C(d(-b));const E=[];let x=1;for(let S=0;b>=x;S++)E[S]=b/x|0,x*=4294967296;return new o(E,0)}function f(b,E){if(b.length==0)throw Error("number format error: empty string");if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(b.charAt(0)=="-")return C(f(b.substring(1),E));if(b.indexOf("-")>=0)throw Error('number format error: interior "-" character');const x=d(Math.pow(E,8));let S=h;for(let L=0;L<b.length;L+=8){var j=Math.min(8,b.length-L);const k=parseInt(b.substring(L,L+j),E);j<8?(j=d(Math.pow(E,j)),S=S.j(j).add(d(k))):(S=S.j(x),S=S.add(d(k)))}return S}var h=c(0),m=c(1),v=c(16777216);t=o.prototype,t.m=function(){if(A(this))return-C(this).m();let b=0,E=1;for(let x=0;x<this.g.length;x++){const S=this.i(x);b+=(S>=0?S:4294967296+S)*E,E*=4294967296}return b},t.toString=function(b){if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(P(this))return"0";if(A(this))return"-"+C(this).toString(b);const E=d(Math.pow(b,6));var x=this;let S="";for(;;){const j=T(x,E).g;x=y(x,j.j(E));let L=((x.g.length>0?x.g[0]:x.h)>>>0).toString(b);if(x=j,P(x))return L+S;for(;L.length<6;)L="0"+L;S=L+S}},t.i=function(b){return b<0?0:b<this.g.length?this.g[b]:this.h};function P(b){if(b.h!=0)return!1;for(let E=0;E<b.g.length;E++)if(b.g[E]!=0)return!1;return!0}function A(b){return b.h==-1}t.l=function(b){return b=y(this,b),A(b)?-1:P(b)?0:1};function C(b){const E=b.g.length,x=[];for(let S=0;S<E;S++)x[S]=~b.g[S];return new o(x,~b.h).add(m)}t.abs=function(){return A(this)?C(this):this},t.add=function(b){const E=Math.max(this.g.length,b.g.length),x=[];let S=0;for(let j=0;j<=E;j++){let L=S+(this.i(j)&65535)+(b.i(j)&65535),k=(L>>>16)+(this.i(j)>>>16)+(b.i(j)>>>16);S=k>>>16,L&=65535,k&=65535,x[j]=k<<16|L}return new o(x,x[x.length-1]&-2147483648?-1:0)};function y(b,E){return b.add(C(E))}t.j=function(b){if(P(this)||P(b))return h;if(A(this))return A(b)?C(this).j(C(b)):C(C(this).j(b));if(A(b))return C(this.j(C(b)));if(this.l(v)<0&&b.l(v)<0)return d(this.m()*b.m());const E=this.g.length+b.g.length,x=[];for(var S=0;S<2*E;S++)x[S]=0;for(S=0;S<this.g.length;S++)for(let j=0;j<b.g.length;j++){const L=this.i(S)>>>16,k=this.i(S)&65535,Y=b.i(j)>>>16,We=b.i(j)&65535;x[2*S+2*j]+=k*We,_(x,2*S+2*j),x[2*S+2*j+1]+=L*We,_(x,2*S+2*j+1),x[2*S+2*j+1]+=k*Y,_(x,2*S+2*j+1),x[2*S+2*j+2]+=L*Y,_(x,2*S+2*j+2)}for(b=0;b<E;b++)x[b]=x[2*b+1]<<16|x[2*b];for(b=E;b<2*E;b++)x[b]=0;return new o(x,0)};function _(b,E){for(;(b[E]&65535)!=b[E];)b[E+1]+=b[E]>>>16,b[E]&=65535,E++}function w(b,E){this.g=b,this.h=E}function T(b,E){if(P(E))throw Error("division by zero");if(P(b))return new w(h,h);if(A(b))return E=T(C(b),E),new w(C(E.g),C(E.h));if(A(E))return E=T(b,C(E)),new w(C(E.g),E.h);if(b.g.length>30){if(A(b)||A(E))throw Error("slowDivide_ only works with positive integers.");for(var x=m,S=E;S.l(b)<=0;)x=V(x),S=V(S);var j=U(x,1),L=U(S,1);for(S=U(S,2),x=U(x,2);!P(S);){var k=L.add(S);k.l(b)<=0&&(j=j.add(x),L=k),S=U(S,1),x=U(x,1)}return E=y(b,j.j(E)),new w(j,E)}for(j=h;b.l(E)>=0;){for(x=Math.max(1,Math.floor(b.m()/E.m())),S=Math.ceil(Math.log(x)/Math.LN2),S=S<=48?1:Math.pow(2,S-48),L=d(x),k=L.j(E);A(k)||k.l(b)>0;)x-=S,L=d(x),k=L.j(E);P(L)&&(L=m),j=j.add(L),b=y(b,k)}return new w(j,b)}t.B=function(b){return T(this,b).h},t.and=function(b){const E=Math.max(this.g.length,b.g.length),x=[];for(let S=0;S<E;S++)x[S]=this.i(S)&b.i(S);return new o(x,this.h&b.h)},t.or=function(b){const E=Math.max(this.g.length,b.g.length),x=[];for(let S=0;S<E;S++)x[S]=this.i(S)|b.i(S);return new o(x,this.h|b.h)},t.xor=function(b){const E=Math.max(this.g.length,b.g.length),x=[];for(let S=0;S<E;S++)x[S]=this.i(S)^b.i(S);return new o(x,this.h^b.h)};function V(b){const E=b.g.length+1,x=[];for(let S=0;S<E;S++)x[S]=b.i(S)<<1|b.i(S-1)>>>31;return new o(x,b.h)}function U(b,E){const x=E>>5;E%=32;const S=b.g.length-x,j=[];for(let L=0;L<S;L++)j[L]=E>0?b.i(L+x)>>>E|b.i(L+x+1)<<32-E:b.i(L+x);return new o(j,b.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,fS=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=f,di=o}).apply(typeof kw<"u"?kw:typeof self<"u"?self:typeof window<"u"?window:{});var qu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var pS,Ul,mS,xd,ng,gS,yS,vS;(function(){var t,e=Object.defineProperty;function n(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof qu=="object"&&qu];for(var p=0;p<u.length;++p){var g=u[p];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=n(this);function s(u,p){if(p)e:{var g=r;u=u.split(".");for(var R=0;R<u.length-1;R++){var F=u[R];if(!(F in g))break e;g=g[F]}u=u[u.length-1],R=g[u],p=p(R),p!=R&&p!=null&&e(g,u,{configurable:!0,writable:!0,value:p})}}s("Symbol.dispose",function(u){return u||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(u){return u||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(u){return u||function(p){var g=[],R;for(R in p)Object.prototype.hasOwnProperty.call(p,R)&&g.push([R,p[R]]);return g}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function l(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function c(u,p,g){return u.call.apply(u.bind,arguments)}function d(u,p,g){return d=c,d.apply(null,arguments)}function f(u,p){var g=Array.prototype.slice.call(arguments,1);return function(){var R=g.slice();return R.push.apply(R,arguments),u.apply(this,R)}}function h(u,p){function g(){}g.prototype=p.prototype,u.Z=p.prototype,u.prototype=new g,u.prototype.constructor=u,u.Ob=function(R,F,B){for(var ne=Array(arguments.length-2),Oe=2;Oe<arguments.length;Oe++)ne[Oe-2]=arguments[Oe];return p.prototype[F].apply(R,ne)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?u=>u&&AsyncContext.Snapshot.wrap(u):u=>u;function v(u){const p=u.length;if(p>0){const g=Array(p);for(let R=0;R<p;R++)g[R]=u[R];return g}return[]}function P(u,p){for(let R=1;R<arguments.length;R++){const F=arguments[R];var g=typeof F;if(g=g!="object"?g:F?Array.isArray(F)?"array":g:"null",g=="array"||g=="object"&&typeof F.length=="number"){g=u.length||0;const B=F.length||0;u.length=g+B;for(let ne=0;ne<B;ne++)u[g+ne]=F[ne]}else u.push(F)}}class A{constructor(p,g){this.i=p,this.j=g,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function C(u){o.setTimeout(()=>{throw u},0)}function y(){var u=b;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class _{constructor(){this.h=this.g=null}add(p,g){const R=w.get();R.set(p,g),this.h?this.h.next=R:this.g=R,this.h=R}}var w=new A(()=>new T,u=>u.reset());class T{constructor(){this.next=this.g=this.h=null}set(p,g){this.h=p,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let V,U=!1,b=new _,E=()=>{const u=Promise.resolve(void 0);V=()=>{u.then(x)}};function x(){for(var u;u=y();){try{u.h.call(u.g)}catch(g){C(g)}var p=w;p.j(u),p.h<100&&(p.h++,u.next=p.g,p.g=u)}U=!1}function S(){this.u=this.u,this.C=this.C}S.prototype.u=!1,S.prototype.dispose=function(){this.u||(this.u=!0,this.N())},S.prototype[Symbol.dispose]=function(){this.dispose()},S.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function j(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}j.prototype.h=function(){this.defaultPrevented=!0};var L=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const g=()=>{};o.addEventListener("test",g,p),o.removeEventListener("test",g,p)}catch{}return u}();function k(u){return/^[\s\xa0]*$/.test(u)}function Y(u,p){j.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u&&this.init(u,p)}h(Y,j),Y.prototype.init=function(u,p){const g=this.type=u.type,R=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget,p||(g=="mouseover"?p=u.fromElement:g=="mouseout"&&(p=u.toElement)),this.relatedTarget=p,R?(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=u.pointerType,this.state=u.state,this.i=u,u.defaultPrevented&&Y.Z.h.call(this)},Y.prototype.h=function(){Y.Z.h.call(this);const u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var We="closure_listenable_"+(Math.random()*1e6|0),Dt=0;function Lt(u,p,g,R,F){this.listener=u,this.proxy=null,this.src=p,this.type=g,this.capture=!!R,this.ha=F,this.key=++Dt,this.da=this.fa=!1}function te(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function ue(u,p,g){for(const R in u)p.call(g,u[R],R,u)}function ye(u,p){for(const g in u)p.call(void 0,u[g],g,u)}function Pe(u){const p={};for(const g in u)p[g]=u[g];return p}const Qe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Et(u,p){let g,R;for(let F=1;F<arguments.length;F++){R=arguments[F];for(g in R)u[g]=R[g];for(let B=0;B<Qe.length;B++)g=Qe[B],Object.prototype.hasOwnProperty.call(R,g)&&(u[g]=R[g])}}function $(u){this.src=u,this.g={},this.h=0}$.prototype.add=function(u,p,g,R,F){const B=u.toString();u=this.g[B],u||(u=this.g[B]=[],this.h++);const ne=de(u,p,R,F);return ne>-1?(p=u[ne],g||(p.fa=!1)):(p=new Lt(p,this.src,B,!!R,F),p.fa=g,u.push(p)),p};function re(u,p){const g=p.type;if(g in u.g){var R=u.g[g],F=Array.prototype.indexOf.call(R,p,void 0),B;(B=F>=0)&&Array.prototype.splice.call(R,F,1),B&&(te(p),u.g[g].length==0&&(delete u.g[g],u.h--))}}function de(u,p,g,R){for(let F=0;F<u.length;++F){const B=u[F];if(!B.da&&B.listener==p&&B.capture==!!g&&B.ha==R)return F}return-1}var Ce="closure_lm_"+(Math.random()*1e6|0),Ne={};function je(u,p,g,R,F){if(Array.isArray(p)){for(let B=0;B<p.length;B++)je(u,p[B],g,R,F);return null}return g=oe(g),u&&u[We]?u.J(p,g,l(R)?!!R.capture:!1,F):Ee(u,p,g,!1,R,F)}function Ee(u,p,g,R,F,B){if(!p)throw Error("Invalid event type");const ne=l(F)?!!F.capture:!!F;let Oe=tt(u);if(Oe||(u[Ce]=Oe=new $(u)),g=Oe.add(p,g,R,ne,B),g.proxy)return g;if(R=ot(),g.proxy=R,R.src=u,R.listener=g,u.addEventListener)L||(F=ne),F===void 0&&(F=!1),u.addEventListener(p.toString(),R,F);else if(u.attachEvent)u.attachEvent(De(p.toString()),R);else if(u.addListener&&u.removeListener)u.addListener(R);else throw Error("addEventListener and attachEvent are unavailable.");return g}function ot(){function u(g){return p.call(u.src,u.listener,g)}const p=Fe;return u}function ke(u,p,g,R,F){if(Array.isArray(p))for(var B=0;B<p.length;B++)ke(u,p[B],g,R,F);else R=l(R)?!!R.capture:!!R,g=oe(g),u&&u[We]?(u=u.i,B=String(p).toString(),B in u.g&&(p=u.g[B],g=de(p,g,R,F),g>-1&&(te(p[g]),Array.prototype.splice.call(p,g,1),p.length==0&&(delete u.g[B],u.h--)))):u&&(u=tt(u))&&(p=u.g[p.toString()],u=-1,p&&(u=de(p,g,R,F)),(g=u>-1?p[u]:null)&&fe(g))}function fe(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[We])re(p.i,u);else{var g=u.type,R=u.proxy;p.removeEventListener?p.removeEventListener(g,R,u.capture):p.detachEvent?p.detachEvent(De(g),R):p.addListener&&p.removeListener&&p.removeListener(R),(g=tt(p))?(re(g,u),g.h==0&&(g.src=null,p[Ce]=null)):te(u)}}}function De(u){return u in Ne?Ne[u]:Ne[u]="on"+u}function Fe(u,p){if(u.da)u=!0;else{p=new Y(p,this);const g=u.listener,R=u.ha||u.src;u.fa&&fe(u),u=g.call(R,p)}return u}function tt(u){return u=u[Ce],u instanceof $?u:null}var Q="__closure_events_fn_"+(Math.random()*1e9>>>0);function oe(u){return typeof u=="function"?u:(u[Q]||(u[Q]=function(p){return u.handleEvent(p)}),u[Q])}function z(){S.call(this),this.i=new $(this),this.M=this,this.G=null}h(z,S),z.prototype[We]=!0,z.prototype.removeEventListener=function(u,p,g,R){ke(this,u,p,g,R)};function ie(u,p){var g,R=u.G;if(R)for(g=[];R;R=R.G)g.push(R);if(u=u.M,R=p.type||p,typeof p=="string")p=new j(p,u);else if(p instanceof j)p.target=p.target||u;else{var F=p;p=new j(R,u),Et(p,F)}F=!0;let B,ne;if(g)for(ne=g.length-1;ne>=0;ne--)B=p.g=g[ne],F=le(B,R,!0,p)&&F;if(B=p.g=u,F=le(B,R,!0,p)&&F,F=le(B,R,!1,p)&&F,g)for(ne=0;ne<g.length;ne++)B=p.g=g[ne],F=le(B,R,!1,p)&&F}z.prototype.N=function(){if(z.Z.N.call(this),this.i){var u=this.i;for(const p in u.g){const g=u.g[p];for(let R=0;R<g.length;R++)te(g[R]);delete u.g[p],u.h--}}this.G=null},z.prototype.J=function(u,p,g,R){return this.i.add(String(u),p,!1,g,R)},z.prototype.K=function(u,p,g,R){return this.i.add(String(u),p,!0,g,R)};function le(u,p,g,R){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();let F=!0;for(let B=0;B<p.length;++B){const ne=p[B];if(ne&&!ne.da&&ne.capture==g){const Oe=ne.listener,zt=ne.ha||ne.src;ne.fa&&re(u.i,ne),F=Oe.call(zt,R)!==!1&&F}}return F&&!R.defaultPrevented}function _e(u,p){if(typeof u!="function")if(u&&typeof u.handleEvent=="function")u=d(u.handleEvent,u);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:o.setTimeout(u,p||0)}function xe(u){u.g=_e(()=>{u.g=null,u.i&&(u.i=!1,xe(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class Me extends S{constructor(p,g){super(),this.m=p,this.l=g,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:xe(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ae(u){S.call(this),this.h=u,this.g={}}h(Ae,S);var Le=[];function O(u){ue(u.g,function(p,g){this.g.hasOwnProperty(g)&&fe(p)},u),u.g={}}Ae.prototype.N=function(){Ae.Z.N.call(this),O(this)},Ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var G=o.JSON.stringify,D=o.JSON.parse,H=class{stringify(u){return o.JSON.stringify(u,void 0)}parse(u){return o.JSON.parse(u,void 0)}};function K(){}function pe(){}var Te={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ht(){j.call(this,"d")}h(ht,j);function at(){j.call(this,"c")}h(at,j);var ft={},bt=null;function ze(){return bt=bt||new z}ft.Ia="serverreachability";function yt(u){j.call(this,ft.Ia,u)}h(yt,j);function lt(u){const p=ze();ie(p,new yt(p))}ft.STAT_EVENT="statevent";function Kt(u,p){j.call(this,ft.STAT_EVENT,u),this.stat=p}h(Kt,j);function Ze(u){const p=ze();ie(p,new Kt(p,u))}ft.Ja="timingevent";function Vt(u,p){j.call(this,ft.Ja,u),this.size=p}h(Vt,j);function Dr(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){u()},p)}function pr(){this.g=!0}pr.prototype.ua=function(){this.g=!1};function Ns(u,p,g,R,F,B){u.info(function(){if(u.g)if(B){var ne="",Oe=B.split("&");for(let ct=0;ct<Oe.length;ct++){var zt=Oe[ct].split("=");if(zt.length>1){const Qt=zt[0];zt=zt[1];const Vr=Qt.split("_");ne=Vr.length>=2&&Vr[1]=="type"?ne+(Qt+"="+zt+"&"):ne+(Qt+"=redacted&")}}}else ne=null;else ne=B;return"XMLHTTP REQ ("+R+") [attempt "+F+"]: "+p+`
`+g+`
`+ne})}function Vn(u,p,g,R,F,B,ne){u.info(function(){return"XMLHTTP RESP ("+R+") [ attempt "+F+"]: "+p+`
`+g+`
`+B+" "+ne})}function es(u,p,g,R){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+gu(u,g)+(R?" "+R:"")})}function mu(u,p){u.info(function(){return"TIMEOUT: "+p})}pr.prototype.info=function(){};function gu(u,p){if(!u.g)return p;if(!p)return null;try{const B=JSON.parse(p);if(B){for(u=0;u<B.length;u++)if(Array.isArray(B[u])){var g=B[u];if(!(g.length<2)){var R=g[1];if(Array.isArray(R)&&!(R.length<1)){var F=R[0];if(F!="noop"&&F!="stop"&&F!="close")for(let ne=1;ne<R.length;ne++)R[ne]=""}}}}return G(B)}catch{return p}}var Ri={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ol={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},N;function W(){}h(W,K),W.prototype.g=function(){return new XMLHttpRequest},N=new W;function ee(u){return encodeURIComponent(String(u))}function me(u){var p=1;u=u.split(":");const g=[];for(;p>0&&u.length;)g.push(u.shift()),p--;return u.length&&g.push(u.join(":")),g}function we(u,p,g,R){this.j=u,this.i=p,this.l=g,this.S=R||1,this.V=new Ae(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Xe}function Xe(){this.i=null,this.g="",this.h=!1}var Or={},Jn={};function Zn(u,p,g){u.M=1,u.A=yu(Lr(p)),u.u=g,u.R=!0,Mt(u,null)}function Mt(u,p){u.F=Date.now(),ts(u),u.B=Lr(u.A);var g=u.B,R=u.S;Array.isArray(R)||(R=[String(R)]),y_(g.i,"t",R),u.C=0,g=u.j.L,u.h=new Xe,u.g=O_(u.j,g?p:null,!u.u),u.P>0&&(u.O=new Me(d(u.Y,u,u.g),u.P)),p=u.V,g=u.g,R=u.ba;var F="readystatechange";Array.isArray(F)||(F&&(Le[0]=F.toString()),F=Le);for(let B=0;B<F.length;B++){const ne=je(g,F[B],R||p.handleEvent,!1,p.h||p);if(!ne)break;p.g[ne.key]=ne}p=u.J?Pe(u.J):{},u.u?(u.v||(u.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.B,u.v,u.u,p)):(u.v="GET",u.g.ea(u.B,u.v,null,p)),lt(),Ns(u.i,u.v,u.B,u.l,u.S,u.u)}we.prototype.ba=function(u){u=u.target;const p=this.O;p&&Ps(u)==3?p.j():this.Y(u)},we.prototype.Y=function(u){try{if(u==this.g)e:{const Oe=Ps(this.g),zt=this.g.ya(),ct=this.g.ca();if(!(Oe<3)&&(Oe!=3||this.g&&(this.h.h||this.g.la()||I_(this.g)))){this.K||Oe!=4||zt==7||(zt==8||ct<=0?lt(3):lt(2)),ko(this);var p=this.g.ca();this.X=p;var g=Nn(this);if(this.o=p==200,Vn(this.i,this.v,this.B,this.l,this.S,Oe,p),this.o){if(this.U&&!this.L){t:{if(this.g){var R,F=this.g;if((R=F.g?F.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(R)){var B=R;break t}}B=null}if(u=B)es(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ff(this,u);else{this.o=!1,this.m=3,Ze(12),Pi(this),rs(this);break e}}if(this.R){u=!0;let Qt;for(;!this.K&&this.C<g.length;)if(Qt=mr(this,g),Qt==Jn){Oe==4&&(this.m=4,Ze(14),u=!1),es(this.i,this.l,null,"[Incomplete Response]");break}else if(Qt==Or){this.m=4,Ze(15),es(this.i,this.l,g,"[Invalid Chunk]"),u=!1;break}else es(this.i,this.l,Qt,null),Ff(this,Qt);if(An(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Oe!=4||g.length!=0||this.h.h||(this.m=1,Ze(16),u=!1),this.o=this.o&&u,!u)es(this.i,this.l,g,"[Invalid Chunked Response]"),Pi(this),rs(this);else if(g.length>0&&!this.W){this.W=!0;var ne=this.j;ne.g==this&&ne.aa&&!ne.P&&(ne.j.info("Great, no buffering proxy detected. Bytes received: "+g.length),Gf(ne),ne.P=!0,Ze(11))}}else es(this.i,this.l,g,null),Ff(this,g);Oe==4&&Pi(this),this.o&&!this.K&&(Oe==4?P_(this.j,this):(this.o=!1,ts(this)))}else C1(this.g),p==400&&g.indexOf("Unknown SID")>0?(this.m=3,Ze(12)):(this.m=0,Ze(13)),Pi(this),rs(this)}}}catch{}finally{}};function Nn(u){if(!An(u))return u.g.la();const p=I_(u.g);if(p==="")return"";let g="";const R=p.length,F=Ps(u.g)==4;if(!u.h.i){if(typeof TextDecoder>"u")return Pi(u),rs(u),"";u.h.i=new o.TextDecoder}for(let B=0;B<R;B++)u.h.h=!0,g+=u.h.i.decode(p[B],{stream:!(F&&B==R-1)});return p.length=0,u.h.g+=g,u.C=0,u.h.g}function An(u){return u.g?u.v=="GET"&&u.M!=2&&u.j.Aa:!1}function mr(u,p){var g=u.C,R=p.indexOf(`
`,g);return R==-1?Jn:(g=Number(p.substring(g,R)),isNaN(g)?Or:(R+=1,R+g>p.length?Jn:(p=p.slice(R,R+g),u.C=R+g,p)))}we.prototype.cancel=function(){this.K=!0,Pi(this)};function ts(u){u.T=Date.now()+u.H,ns(u,u.H)}function ns(u,p){if(u.D!=null)throw Error("WatchDog timer not null");u.D=Dr(d(u.aa,u),p)}function ko(u){u.D&&(o.clearTimeout(u.D),u.D=null)}we.prototype.aa=function(){this.D=null;const u=Date.now();u-this.T>=0?(mu(this.i,this.B),this.M!=2&&(lt(),Ze(17)),Pi(this),this.m=2,rs(this)):ns(this,this.T-u)};function rs(u){u.j.I==0||u.K||P_(u.j,u)}function Pi(u){ko(u);var p=u.O;p&&typeof p.dispose=="function"&&p.dispose(),u.O=null,O(u.V),u.g&&(p=u.g,u.g=null,p.abort(),p.dispose())}function Ff(u,p){try{var g=u.j;if(g.I!=0&&(g.g==u||Uf(g.h,u))){if(!u.L&&Uf(g.h,u)&&g.I==3){try{var R=g.Ba.g.parse(p)}catch{R=null}if(Array.isArray(R)&&R.length==3){var F=R;if(F[0]==0){e:if(!g.v){if(g.g)if(g.g.F+3e3<u.F)Eu(g),xu(g);else break e;Wf(g),Ze(18)}}else g.xa=F[1],0<g.xa-g.K&&F[2]<37500&&g.F&&g.A==0&&!g.C&&(g.C=Dr(d(g.Va,g),6e3));c_(g.h)<=1&&g.ta&&(g.ta=void 0)}else ji(g,11)}else if((u.L||g.g==u)&&Eu(g),!k(p))for(F=g.Ba.g.parse(p),p=0;p<F.length;p++){let ct=F[p];const Qt=ct[0];if(!(Qt<=g.K))if(g.K=Qt,ct=ct[1],g.I==2)if(ct[0]=="c"){g.M=ct[1],g.ba=ct[2];const Vr=ct[3];Vr!=null&&(g.ka=Vr,g.j.info("VER="+g.ka));const Di=ct[4];Di!=null&&(g.za=Di,g.j.info("SVER="+g.za));const ks=ct[5];ks!=null&&typeof ks=="number"&&ks>0&&(R=1.5*ks,g.O=R,g.j.info("backChannelRequestTimeoutMs_="+R)),R=g;const js=u.g;if(js){const Iu=js.g?js.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Iu){var B=R.h;B.g||Iu.indexOf("spdy")==-1&&Iu.indexOf("quic")==-1&&Iu.indexOf("h2")==-1||(B.j=B.l,B.g=new Set,B.h&&($f(B,B.h),B.h=null))}if(R.G){const Kf=js.g?js.g.getResponseHeader("X-HTTP-Session-Id"):null;Kf&&(R.wa=Kf,pt(R.J,R.G,Kf))}}g.I=3,g.l&&g.l.ra(),g.aa&&(g.T=Date.now()-u.F,g.j.info("Handshake RTT: "+g.T+"ms")),R=g;var ne=u;if(R.na=D_(R,R.L?R.ba:null,R.W),ne.L){u_(R.h,ne);var Oe=ne,zt=R.O;zt&&(Oe.H=zt),Oe.D&&(ko(Oe),ts(Oe)),R.g=ne}else A_(R);g.i.length>0&&wu(g)}else ct[0]!="stop"&&ct[0]!="close"||ji(g,7);else g.I==3&&(ct[0]=="stop"||ct[0]=="close"?ct[0]=="stop"?ji(g,7):Hf(g):ct[0]!="noop"&&g.l&&g.l.qa(ct),g.A=0)}}lt(4)}catch{}}var p1=class{constructor(u,p){this.g=u,this.map=p}};function a_(u){this.l=u||10,o.PerformanceNavigationTiming?(u=o.performance.getEntriesByType("navigation"),u=u.length>0&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function l_(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function c_(u){return u.h?1:u.g?u.g.size:0}function Uf(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function $f(u,p){u.g?u.g.add(p):u.h=p}function u_(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}a_.prototype.cancel=function(){if(this.i=d_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function d_(u){if(u.h!=null)return u.i.concat(u.h.G);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const g of u.g.values())p=p.concat(g.G);return p}return v(u.i)}var h_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function m1(u,p){if(u){u=u.split("&");for(let g=0;g<u.length;g++){const R=u[g].indexOf("=");let F,B=null;R>=0?(F=u[g].substring(0,R),B=u[g].substring(R+1)):F=u[g],p(F,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}function As(u){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;u instanceof As?(this.l=u.l,al(this,u.j),this.o=u.o,this.g=u.g,ll(this,u.u),this.h=u.h,Bf(this,v_(u.i)),this.m=u.m):u&&(p=String(u).match(h_))?(this.l=!1,al(this,p[1]||"",!0),this.o=cl(p[2]||""),this.g=cl(p[3]||"",!0),ll(this,p[4]),this.h=cl(p[5]||"",!0),Bf(this,p[6]||"",!0),this.m=cl(p[7]||"")):(this.l=!1,this.i=new dl(null,this.l))}As.prototype.toString=function(){const u=[];var p=this.j;p&&u.push(ul(p,f_,!0),":");var g=this.g;return(g||p=="file")&&(u.push("//"),(p=this.o)&&u.push(ul(p,f_,!0),"@"),u.push(ee(g).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.u,g!=null&&u.push(":",String(g))),(g=this.h)&&(this.g&&g.charAt(0)!="/"&&u.push("/"),u.push(ul(g,g.charAt(0)=="/"?v1:y1,!0))),(g=this.i.toString())&&u.push("?",g),(g=this.m)&&u.push("#",ul(g,x1)),u.join("")},As.prototype.resolve=function(u){const p=Lr(this);let g=!!u.j;g?al(p,u.j):g=!!u.o,g?p.o=u.o:g=!!u.g,g?p.g=u.g:g=u.u!=null;var R=u.h;if(g)ll(p,u.u);else if(g=!!u.h){if(R.charAt(0)!="/")if(this.g&&!this.h)R="/"+R;else{var F=p.h.lastIndexOf("/");F!=-1&&(R=p.h.slice(0,F+1)+R)}if(F=R,F==".."||F==".")R="";else if(F.indexOf("./")!=-1||F.indexOf("/.")!=-1){R=F.lastIndexOf("/",0)==0,F=F.split("/");const B=[];for(let ne=0;ne<F.length;){const Oe=F[ne++];Oe=="."?R&&ne==F.length&&B.push(""):Oe==".."?((B.length>1||B.length==1&&B[0]!="")&&B.pop(),R&&ne==F.length&&B.push("")):(B.push(Oe),R=!0)}R=B.join("/")}else R=F}return g?p.h=R:g=u.i.toString()!=="",g?Bf(p,v_(u.i)):g=!!u.m,g&&(p.m=u.m),p};function Lr(u){return new As(u)}function al(u,p,g){u.j=g?cl(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function ll(u,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);u.u=p}else u.u=null}function Bf(u,p,g){p instanceof dl?(u.i=p,w1(u.i,u.l)):(g||(p=ul(p,_1)),u.i=new dl(p,u.l))}function pt(u,p,g){u.i.set(p,g)}function yu(u){return pt(u,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),u}function cl(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function ul(u,p,g){return typeof u=="string"?(u=encodeURI(u).replace(p,g1),g&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function g1(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var f_=/[#\/\?@]/g,y1=/[#\?:]/g,v1=/[#\?]/g,_1=/[#\?@]/g,x1=/#/g;function dl(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function ki(u){u.g||(u.g=new Map,u.h=0,u.i&&m1(u.i,function(p,g){u.add(decodeURIComponent(p.replace(/\+/g," ")),g)}))}t=dl.prototype,t.add=function(u,p){ki(this),this.i=null,u=jo(this,u);let g=this.g.get(u);return g||this.g.set(u,g=[]),g.push(p),this.h+=1,this};function p_(u,p){ki(u),p=jo(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function m_(u,p){return ki(u),p=jo(u,p),u.g.has(p)}t.forEach=function(u,p){ki(this),this.g.forEach(function(g,R){g.forEach(function(F){u.call(p,F,R,this)},this)},this)};function g_(u,p){ki(u);let g=[];if(typeof p=="string")m_(u,p)&&(g=g.concat(u.g.get(jo(u,p))));else for(u=Array.from(u.g.values()),p=0;p<u.length;p++)g=g.concat(u[p]);return g}t.set=function(u,p){return ki(this),this.i=null,u=jo(this,u),m_(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},t.get=function(u,p){return u?(u=g_(this,u),u.length>0?String(u[0]):p):p};function y_(u,p,g){p_(u,p),g.length>0&&(u.i=null,u.g.set(jo(u,p),v(g)),u.h+=g.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(let R=0;R<p.length;R++){var g=p[R];const F=ee(g);g=g_(this,g);for(let B=0;B<g.length;B++){let ne=F;g[B]!==""&&(ne+="="+ee(g[B])),u.push(ne)}}return this.i=u.join("&")};function v_(u){const p=new dl;return p.i=u.i,u.g&&(p.g=new Map(u.g),p.h=u.h),p}function jo(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function w1(u,p){p&&!u.j&&(ki(u),u.i=null,u.g.forEach(function(g,R){const F=R.toLowerCase();R!=F&&(p_(this,R),y_(this,F,g))},u)),u.j=p}function E1(u,p){const g=new pr;if(o.Image){const R=new Image;R.onload=f(Rs,g,"TestLoadImage: loaded",!0,p,R),R.onerror=f(Rs,g,"TestLoadImage: error",!1,p,R),R.onabort=f(Rs,g,"TestLoadImage: abort",!1,p,R),R.ontimeout=f(Rs,g,"TestLoadImage: timeout",!1,p,R),o.setTimeout(function(){R.ontimeout&&R.ontimeout()},1e4),R.src=u}else p(!1)}function b1(u,p){const g=new pr,R=new AbortController,F=setTimeout(()=>{R.abort(),Rs(g,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:R.signal}).then(B=>{clearTimeout(F),B.ok?Rs(g,"TestPingServer: ok",!0,p):Rs(g,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout(F),Rs(g,"TestPingServer: error",!1,p)})}function Rs(u,p,g,R,F){try{F&&(F.onload=null,F.onerror=null,F.onabort=null,F.ontimeout=null),R(g)}catch{}}function I1(){this.g=new H}function zf(u){this.i=u.Sb||null,this.h=u.ab||!1}h(zf,K),zf.prototype.g=function(){return new vu(this.i,this.h)};function vu(u,p){z.call(this),this.H=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(vu,z),t=vu.prototype,t.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=u,this.D=p,this.readyState=1,fl(this)},t.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};u&&(p.body=u),(this.H||o).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,hl(this)),this.readyState=0},t.Pa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,fl(this)),this.g&&(this.readyState=3,fl(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;__(this)}else u.text().then(this.Oa.bind(this),this.ga.bind(this))};function __(u){u.j.read().then(u.Ma.bind(u)).catch(u.ga.bind(u))}t.Ma=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?hl(this):fl(this),this.readyState==3&&__(this)}},t.Oa=function(u){this.g&&(this.response=this.responseText=u,hl(this))},t.Na=function(u){this.g&&(this.response=u,hl(this))},t.ga=function(){this.g&&hl(this)};function hl(u){u.readyState=4,u.l=null,u.j=null,u.B=null,fl(u)}t.setRequestHeader=function(u,p){this.A.append(u,p)},t.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var g=p.next();!g.done;)g=g.value,u.push(g[0]+": "+g[1]),g=p.next();return u.join(`\r
`)};function fl(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(vu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function x_(u){let p="";return ue(u,function(g,R){p+=R,p+=":",p+=g,p+=`\r
`}),p}function qf(u,p,g){e:{for(R in g){var R=!1;break e}R=!0}R||(g=x_(g),typeof u=="string"?g!=null&&ee(g):pt(u,p,g))}function Nt(u){z.call(this),this.headers=new Map,this.L=u||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(Nt,z);var T1=/^https?$/i,S1=["POST","PUT"];t=Nt.prototype,t.Fa=function(u){this.H=u},t.ea=function(u,p,g,R){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():N.g(),this.g.onreadystatechange=m(d(this.Ca,this));try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(B){w_(this,B);return}if(u=g||"",g=new Map(this.headers),R)if(Object.getPrototypeOf(R)===Object.prototype)for(var F in R)g.set(F,R[F]);else if(typeof R.keys=="function"&&typeof R.get=="function")for(const B of R.keys())g.set(B,R.get(B));else throw Error("Unknown input type for opt_headers: "+String(R));R=Array.from(g.keys()).find(B=>B.toLowerCase()=="content-type"),F=o.FormData&&u instanceof o.FormData,!(Array.prototype.indexOf.call(S1,p,void 0)>=0)||R||F||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[B,ne]of g)this.g.setRequestHeader(B,ne);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(u),this.v=!1}catch(B){w_(this,B)}};function w_(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.o=5,E_(u),_u(u)}function E_(u){u.A||(u.A=!0,ie(u,"complete"),ie(u,"error"))}t.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=u||7,ie(this,"complete"),ie(this,"abort"),_u(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),_u(this,!0)),Nt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?b_(this):this.Xa())},t.Xa=function(){b_(this)};function b_(u){if(u.h&&typeof i<"u"){if(u.v&&Ps(u)==4)setTimeout(u.Ca.bind(u),0);else if(ie(u,"readystatechange"),Ps(u)==4){u.h=!1;try{const B=u.ca();e:switch(B){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var g;if(!(g=p)){var R;if(R=B===0){let ne=String(u.D).match(h_)[1]||null;!ne&&o.self&&o.self.location&&(ne=o.self.location.protocol.slice(0,-1)),R=!T1.test(ne?ne.toLowerCase():"")}g=R}if(g)ie(u,"complete"),ie(u,"success");else{u.o=6;try{var F=Ps(u)>2?u.g.statusText:""}catch{F=""}u.l=F+" ["+u.ca()+"]",E_(u)}}finally{_u(u)}}}}function _u(u,p){if(u.g){u.m&&(clearTimeout(u.m),u.m=null);const g=u.g;u.g=null,p||ie(u,"ready");try{g.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Ps(u){return u.g?u.g.readyState:0}t.ca=function(){try{return Ps(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),D(p)}};function I_(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.F){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function C1(u){const p={};u=(u.g&&Ps(u)>=2&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let R=0;R<u.length;R++){if(k(u[R]))continue;var g=me(u[R]);const F=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const B=p[F]||[];p[F]=B,B.push(g)}ye(p,function(R){return R.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function pl(u,p,g){return g&&g.internalChannelParams&&g.internalChannelParams[u]||p}function T_(u){this.za=0,this.i=[],this.j=new pr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=pl("failFast",!1,u),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=pl("baseRetryDelayMs",5e3,u),this.Za=pl("retryDelaySeedMs",1e4,u),this.Ta=pl("forwardChannelMaxRetries",2,u),this.va=pl("forwardChannelRequestTimeoutMs",2e4,u),this.ma=u&&u.xmlHttpFactory||void 0,this.Ua=u&&u.Rb||void 0,this.Aa=u&&u.useFetchStreams||!1,this.O=void 0,this.L=u&&u.supportsCrossDomainXhr||!1,this.M="",this.h=new a_(u&&u.concurrentRequestLimit),this.Ba=new I1,this.S=u&&u.fastHandshake||!1,this.R=u&&u.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=u&&u.Pb||!1,u&&u.ua&&this.j.ua(),u&&u.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&u&&u.detectBufferingProxy||!1,this.ia=void 0,u&&u.longPollingTimeout&&u.longPollingTimeout>0&&(this.ia=u.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=T_.prototype,t.ka=8,t.I=1,t.connect=function(u,p,g,R){Ze(0),this.W=u,this.H=p||{},g&&R!==void 0&&(this.H.OSID=g,this.H.OAID=R),this.F=this.X,this.J=D_(this,null,this.W),wu(this)};function Hf(u){if(S_(u),u.I==3){var p=u.V++,g=Lr(u.J);if(pt(g,"SID",u.M),pt(g,"RID",p),pt(g,"TYPE","terminate"),ml(u,g),p=new we(u,u.j,p),p.M=2,p.A=yu(Lr(g)),g=!1,o.navigator&&o.navigator.sendBeacon)try{g=o.navigator.sendBeacon(p.A.toString(),"")}catch{}!g&&o.Image&&(new Image().src=p.A,g=!0),g||(p.g=O_(p.j,null),p.g.ea(p.A)),p.F=Date.now(),ts(p)}j_(u)}function xu(u){u.g&&(Gf(u),u.g.cancel(),u.g=null)}function S_(u){xu(u),u.v&&(o.clearTimeout(u.v),u.v=null),Eu(u),u.h.cancel(),u.m&&(typeof u.m=="number"&&o.clearTimeout(u.m),u.m=null)}function wu(u){if(!l_(u.h)&&!u.m){u.m=!0;var p=u.Ea;V||E(),U||(V(),U=!0),b.add(p,u),u.D=0}}function N1(u,p){return c_(u.h)>=u.h.j-(u.m?1:0)?!1:u.m?(u.i=p.G.concat(u.i),!0):u.I==1||u.I==2||u.D>=(u.Sa?0:u.Ta)?!1:(u.m=Dr(d(u.Ea,u,p),k_(u,u.D)),u.D++,!0)}t.Ea=function(u){if(this.m)if(this.m=null,this.I==1){if(!u){this.V=Math.floor(Math.random()*1e5),u=this.V++;const F=new we(this,this.j,u);let B=this.o;if(this.U&&(B?(B=Pe(B),Et(B,this.U)):B=this.U),this.u!==null||this.R||(F.J=B,B=null),this.S)e:{for(var p=0,g=0;g<this.i.length;g++){t:{var R=this.i[g];if("__data__"in R.map&&(R=R.map.__data__,typeof R=="string")){R=R.length;break t}R=void 0}if(R===void 0)break;if(p+=R,p>4096){p=g;break e}if(p===4096||g===this.i.length-1){p=g+1;break e}}p=1e3}else p=1e3;p=N_(this,F,p),g=Lr(this.J),pt(g,"RID",u),pt(g,"CVER",22),this.G&&pt(g,"X-HTTP-Session-Id",this.G),ml(this,g),B&&(this.R?p="headers="+ee(x_(B))+"&"+p:this.u&&qf(g,this.u,B)),$f(this.h,F),this.Ra&&pt(g,"TYPE","init"),this.S?(pt(g,"$req",p),pt(g,"SID","null"),F.U=!0,Zn(F,g,null)):Zn(F,g,p),this.I=2}}else this.I==3&&(u?C_(this,u):this.i.length==0||l_(this.h)||C_(this))};function C_(u,p){var g;p?g=p.l:g=u.V++;const R=Lr(u.J);pt(R,"SID",u.M),pt(R,"RID",g),pt(R,"AID",u.K),ml(u,R),u.u&&u.o&&qf(R,u.u,u.o),g=new we(u,u.j,g,u.D+1),u.u===null&&(g.J=u.o),p&&(u.i=p.G.concat(u.i)),p=N_(u,g,1e3),g.H=Math.round(u.va*.5)+Math.round(u.va*.5*Math.random()),$f(u.h,g),Zn(g,R,p)}function ml(u,p){u.H&&ue(u.H,function(g,R){pt(p,R,g)}),u.l&&ue({},function(g,R){pt(p,R,g)})}function N_(u,p,g){g=Math.min(u.i.length,g);const R=u.l?d(u.l.Ka,u.l,u):null;e:{var F=u.i;let Oe=-1;for(;;){const zt=["count="+g];Oe==-1?g>0?(Oe=F[0].g,zt.push("ofs="+Oe)):Oe=0:zt.push("ofs="+Oe);let ct=!0;for(let Qt=0;Qt<g;Qt++){var B=F[Qt].g;const Vr=F[Qt].map;if(B-=Oe,B<0)Oe=Math.max(0,F[Qt].g-100),ct=!1;else try{B="req"+B+"_"||"";try{var ne=Vr instanceof Map?Vr:Object.entries(Vr);for(const[Di,ks]of ne){let js=ks;l(ks)&&(js=G(ks)),zt.push(B+Di+"="+encodeURIComponent(js))}}catch(Di){throw zt.push(B+"type="+encodeURIComponent("_badmap")),Di}}catch{R&&R(Vr)}}if(ct){ne=zt.join("&");break e}}ne=void 0}return u=u.i.splice(0,g),p.G=u,ne}function A_(u){if(!u.g&&!u.v){u.Y=1;var p=u.Da;V||E(),U||(V(),U=!0),b.add(p,u),u.A=0}}function Wf(u){return u.g||u.v||u.A>=3?!1:(u.Y++,u.v=Dr(d(u.Da,u),k_(u,u.A)),u.A++,!0)}t.Da=function(){if(this.v=null,R_(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var u=4*this.T;this.j.info("BP detection timer enabled: "+u),this.B=Dr(d(this.Wa,this),u)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ze(10),xu(this),R_(this))};function Gf(u){u.B!=null&&(o.clearTimeout(u.B),u.B=null)}function R_(u){u.g=new we(u,u.j,"rpc",u.Y),u.u===null&&(u.g.J=u.o),u.g.P=0;var p=Lr(u.na);pt(p,"RID","rpc"),pt(p,"SID",u.M),pt(p,"AID",u.K),pt(p,"CI",u.F?"0":"1"),!u.F&&u.ia&&pt(p,"TO",u.ia),pt(p,"TYPE","xmlhttp"),ml(u,p),u.u&&u.o&&qf(p,u.u,u.o),u.O&&(u.g.H=u.O);var g=u.g;u=u.ba,g.M=1,g.A=yu(Lr(p)),g.u=null,g.R=!0,Mt(g,u)}t.Va=function(){this.C!=null&&(this.C=null,xu(this),Wf(this),Ze(19))};function Eu(u){u.C!=null&&(o.clearTimeout(u.C),u.C=null)}function P_(u,p){var g=null;if(u.g==p){Eu(u),Gf(u),u.g=null;var R=2}else if(Uf(u.h,p))g=p.G,u_(u.h,p),R=1;else return;if(u.I!=0){if(p.o)if(R==1){g=p.u?p.u.length:0,p=Date.now()-p.F;var F=u.D;R=ze(),ie(R,new Vt(R,g)),wu(u)}else A_(u);else if(F=p.m,F==3||F==0&&p.X>0||!(R==1&&N1(u,p)||R==2&&Wf(u)))switch(g&&g.length>0&&(p=u.h,p.i=p.i.concat(g)),F){case 1:ji(u,5);break;case 4:ji(u,10);break;case 3:ji(u,6);break;default:ji(u,2)}}}function k_(u,p){let g=u.Qa+Math.floor(Math.random()*u.Za);return u.isActive()||(g*=2),g*p}function ji(u,p){if(u.j.info("Error code "+p),p==2){var g=d(u.bb,u),R=u.Ua;const F=!R;R=new As(R||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||al(R,"https"),yu(R),F?E1(R.toString(),g):b1(R.toString(),g)}else Ze(2);u.I=0,u.l&&u.l.pa(p),j_(u),S_(u)}t.bb=function(u){u?(this.j.info("Successfully pinged google.com"),Ze(2)):(this.j.info("Failed to ping google.com"),Ze(1))};function j_(u){if(u.I=0,u.ja=[],u.l){const p=d_(u.h);(p.length!=0||u.i.length!=0)&&(P(u.ja,p),P(u.ja,u.i),u.h.i.length=0,v(u.i),u.i.length=0),u.l.oa()}}function D_(u,p,g){var R=g instanceof As?Lr(g):new As(g);if(R.g!="")p&&(R.g=p+"."+R.g),ll(R,R.u);else{var F=o.location;R=F.protocol,p=p?p+"."+F.hostname:F.hostname,F=+F.port;const B=new As(null);R&&al(B,R),p&&(B.g=p),F&&ll(B,F),g&&(B.h=g),R=B}return g=u.G,p=u.wa,g&&p&&pt(R,g,p),pt(R,"VER",u.ka),ml(u,R),R}function O_(u,p,g){if(p&&!u.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Aa&&!u.ma?new Nt(new zf({ab:g})):new Nt(u.ma),p.Fa(u.L),p}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function L_(){}t=L_.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function bu(){}bu.prototype.g=function(u,p){return new Mn(u,p)};function Mn(u,p){z.call(this),this.g=new T_(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(u?u["X-WebChannel-Client-Profile"]=p.sa:u={"X-WebChannel-Client-Profile":p.sa}),this.g.U=u,(u=p&&p.Qb)&&!k(u)&&(this.g.u=u),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!k(p)&&(this.g.G=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Do(this)}h(Mn,z),Mn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Mn.prototype.close=function(){Hf(this.g)},Mn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var g={};g.__data__=u,u=g}else this.v&&(g={},g.__data__=G(u),u=g);p.i.push(new p1(p.Ya++,u)),p.I==3&&wu(p)},Mn.prototype.N=function(){this.g.l=null,delete this.j,Hf(this.g),delete this.g,Mn.Z.N.call(this)};function V_(u){ht.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const g in p){u=g;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}h(V_,ht);function M_(){at.call(this),this.status=1}h(M_,at);function Do(u){this.g=u}h(Do,L_),Do.prototype.ra=function(){ie(this.g,"a")},Do.prototype.qa=function(u){ie(this.g,new V_(u))},Do.prototype.pa=function(u){ie(this.g,new M_)},Do.prototype.oa=function(){ie(this.g,"b")},bu.prototype.createWebChannel=bu.prototype.g,Mn.prototype.send=Mn.prototype.o,Mn.prototype.open=Mn.prototype.m,Mn.prototype.close=Mn.prototype.close,vS=function(){return new bu},yS=function(){return ze()},gS=ft,ng={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ri.NO_ERROR=0,Ri.TIMEOUT=8,Ri.HTTP_ERROR=6,xd=Ri,ol.COMPLETE="complete",mS=ol,pe.EventType=Te,Te.OPEN="a",Te.CLOSE="b",Te.ERROR="c",Te.MESSAGE="d",z.prototype.listen=z.prototype.J,Ul=pe,Nt.prototype.listenOnce=Nt.prototype.K,Nt.prototype.getLastError=Nt.prototype.Ha,Nt.prototype.getLastErrorCode=Nt.prototype.ya,Nt.prototype.getStatus=Nt.prototype.ca,Nt.prototype.getResponseJson=Nt.prototype.La,Nt.prototype.getResponseText=Nt.prototype.la,Nt.prototype.send=Nt.prototype.ea,Nt.prototype.setWithCredentials=Nt.prototype.Fa,pS=Nt}).apply(typeof qu<"u"?qu:typeof self<"u"?self:typeof window<"u"?window:{});const jw="@firebase/firestore",Dw="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tn.UNAUTHENTICATED=new tn(null),tn.GOOGLE_CREDENTIALS=new tn("google-credentials-uid"),tn.FIRST_PARTY=new tn("first-party-uid"),tn.MOCK_USER=new tn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tl="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ho=new Jh("@firebase/firestore");function Qo(){return ho.logLevel}function X(t,...e){if(ho.logLevel<=$e.DEBUG){const n=e.map(Wy);ho.debug(`Firestore (${tl}): ${t}`,...n)}}function _n(t,...e){if(ho.logLevel<=$e.ERROR){const n=e.map(Wy);ho.error(`Firestore (${tl}): ${t}`,...n)}}function fo(t,...e){if(ho.logLevel<=$e.WARN){const n=e.map(Wy);ho.warn(`Firestore (${tl}): ${t}`,...n)}}function Wy(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,_S(t,r,n)}function _S(t,e,n){let r=`FIRESTORE (${tl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw _n(r),new Error(r)}function ge(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||_S(e,s,r)}function Se(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Z extends fr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class vO{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(tn.UNAUTHENTICATED))}shutdown(){}}class _O{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class xO{constructor(e){this.t=e,this.currentUser=tn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){ge(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let i=new Tr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Tr,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{X("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(X("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Tr)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(X("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ge(typeof r.accessToken=="string",31837,{l:r}),new xS(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ge(e===null||typeof e=="string",2055,{h:e}),new tn(e)}}class wO{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=tn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class EO{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new wO(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(tn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ow{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bO{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,rr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){ge(this.o===void 0,3512);const r=i=>{i.error!=null&&X("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,X("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{X("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):X("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ow(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(ge(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Ow(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IO(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gy{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=IO(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%62))}return r}}function Re(t,e){return t<e?-1:t>e?1:0}function rg(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),i=e.charAt(r);if(s!==i)return Rp(s)===Rp(i)?Re(s,i):Rp(s)?1:-1}return Re(t.length,e.length)}const TO=55296,SO=57343;function Rp(t){const e=t.charCodeAt(0);return e>=TO&&e<=SO}function ja(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function wS(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lw="__name__";class Br{constructor(e,n,r){n===void 0?n=0:n>e.length&&he(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&he(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Br.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Br?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=Br.compareSegments(e.get(s),n.get(s));if(i!==0)return i}return Re(e.length,n.length)}static compareSegments(e,n){const r=Br.isNumericId(e),s=Br.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?Br.extractNumericId(e).compare(Br.extractNumericId(n)):rg(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return di.fromString(e.substring(4,e.length-2))}}class Ye extends Br{construct(e,n,r){return new Ye(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new Z(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Ye(n)}static emptyPath(){return new Ye([])}}const CO=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Tt extends Br{construct(e,n,r){return new Tt(e,n,r)}static isValidIdentifier(e){return CO.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Tt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Lw}static keyField(){return new Tt([Lw])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new Z(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new Z(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new Z(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(o=!o,s++):l!=="."||o?(r+=l,s++):(i(),s++)}if(i(),o)throw new Z(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Tt(n)}static emptyPath(){return new Tt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(e){this.path=e}static fromPath(e){return new se(Ye.fromString(e))}static fromName(e){return new se(Ye.fromString(e).popFirst(5))}static empty(){return new se(Ye.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ye.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ye.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new se(new Ye(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ES(t,e,n){if(!n)throw new Z(q.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function NO(t,e,n,r){if(e===!0&&r===!0)throw new Z(q.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Vw(t){if(!se.isDocumentKey(t))throw new Z(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Mw(t){if(se.isDocumentKey(t))throw new Z(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function bS(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function sf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":he(12329,{type:typeof t})}function fn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Z(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=sf(t);throw new Z(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function AO(t,e){if(e<=0)throw new Z(q.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $t(t,e){const n={typeString:t};return e&&(n.value=e),n}function nu(t,e){if(!bS(t))throw new Z(q.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const o=t[r];if(s&&typeof o!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new Z(q.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fw=-62135596800,Uw=1e6;class He{static now(){return He.fromMillis(Date.now())}static fromDate(e){return He.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Uw);return new He(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Z(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Z(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Fw)throw new Z(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Z(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Uw}_compareTo(e){return this.seconds===e.seconds?Re(this.nanoseconds,e.nanoseconds):Re(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:He._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(nu(e,He._jsonSchema))return new He(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Fw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}He._jsonSchemaVersion="firestore/timestamp/1.0",He._jsonSchema={type:$t("string",He._jsonSchemaVersion),seconds:$t("number"),nanoseconds:$t("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ve{static fromTimestamp(e){return new ve(e)}static min(){return new ve(new He(0,0))}static max(){return new ve(new He(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc=-1;class hh{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function sg(t){return t.fields.find(e=>e.kind===2)}function Fi(t){return t.fields.filter(e=>e.kind!==2)}hh.UNKNOWN_ID=-1;class wd{constructor(e,n){this.fieldPath=e,this.kind=n}}class Dc{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Dc(0,Qn.min())}}function RO(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=ve.fromTimestamp(r===1e9?new He(n+1,0):new He(n,r));return new Qn(s,se.empty(),e)}function IS(t){return new Qn(t.readTime,t.key,jc)}class Qn{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Qn(ve.min(),se.empty(),jc)}static max(){return new Qn(ve.max(),se.empty(),jc)}}function Ky(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=se.comparator(t.documentKey,e.documentKey),n!==0?n:Re(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TS="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class SS{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ro(t){if(t.code!==q.FAILED_PRECONDITION||t.message!==TS)throw t;X("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&he(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new M((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof M?n:M.resolve(n)}catch(n){return M.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):M.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):M.reject(n)}static resolve(e){return new M((n,r)=>{n(e)})}static reject(e){return new M((n,r)=>{r(e)})}static waitFor(e){return new M((n,r)=>{let s=0,i=0,o=!1;e.forEach(l=>{++s,l.next(()=>{++i,o&&i===s&&n()},c=>r(c))}),o=!0,i===s&&n()})}static or(e){let n=M.resolve(!1);for(const r of e)n=n.next(s=>s?M.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new M((r,s)=>{const i=e.length,o=new Array(i);let l=0;for(let c=0;c<i;c++){const d=c;n(e[d]).next(f=>{o[d]=f,++l,l===i&&r(o)},f=>s(f))}})}static doWhile(e,n){return new M((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $n="SimpleDb";class of{static open(e,n,r,s){try{return new of(n,e.transaction(s,r))}catch(i){throw new sc(n,i)}}constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.S=new Tr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{n.error?this.S.reject(new sc(e,n.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=Qy(r.target.error);this.S.reject(new sc(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(X($n,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new kO(n)}}class hi{static delete(e){return X($n,"Removing database:",e),$i(gT().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Dy())return!1;if(hi.F())return!0;const e=Wt(),n=hi.M(e),r=0<n&&n<10,s=CS(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,n){return e.store(n)}static M(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,n,r){this.name=e,this.version=n,this.N=r,this.B=null,hi.M(Wt())===12.2&&_n("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(X($n,"Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;n(o)},s.onblocked=()=>{r(new sc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new Z(q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new Z(q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new sc(e,o))},s.onupgradeneeded=i=>{X($n,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{X($n,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=n=>this.q(n)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const l=of.open(this.db,e,i?"readonly":"readwrite",r),c=s(l).next(d=>(l.C(),d)).catch(d=>(l.abort(d),M.reject(d))).toPromise();return c.catch(()=>{}),await l.D,c}catch(l){const c=l,d=c.name!=="FirebaseError"&&o<3;if(X($n,"Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function CS(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class PO{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return $i(this.U.delete())}}class sc extends Z{constructor(e,n){super(q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function Ci(t){return t.name==="IndexedDbTransactionError"}class kO{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(X($n,"PUT",this.store.name,e,n),r=this.store.put(n,e)):(X($n,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),$i(r)}add(e){return X($n,"ADD",this.store.name,e,e),$i(this.store.add(e))}get(e){return $i(this.store.get(e)).next(n=>(n===void 0&&(n=null),X($n,"GET",this.store.name,e,n),n))}delete(e){return X($n,"DELETE",this.store.name,e),$i(this.store.delete(e))}count(){return X($n,"COUNT",this.store.name),$i(this.store.count())}J(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new M((o,l)=>{i.onerror=c=>{l(c.target.error)},i.onsuccess=c=>{o(c.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(l,c)=>{o.push(c)}).next(()=>o)}}Y(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new M((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,n){X($n,"DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,l)=>l.delete())}ee(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.H(s,n)}te(e){const n=this.cursor({});return new M((r,s)=>{n.onerror=i=>{const o=Qy(i.target.error);s(o)},n.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(l=>{l?o.continue():r()}):r()}})}H(e,n){const r=[];return new M((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const l=o.target.result;if(!l)return void s();const c=new PO(l),d=n(l.primaryKey,l.value,c);if(d instanceof M){const f=d.catch(h=>(c.done(),M.reject(h)));r.push(f)}c.isDone?s():c.G===null?l.continue():l.continue(c.G)}}).next(()=>M.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function $i(t){return new M((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=Qy(r.target.error);n(s)}})}let $w=!1;function Qy(t){const e=hi.M(Wt());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new Z("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return $w||($w=!0,setTimeout(()=>{throw r},0)),r}}return t}const ic="IndexBackfiller";class jO{constructor(e,n){this.asyncQueue=e,this.ne=n,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){X(ic,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const n=await this.ne.ie();X(ic,`Documents written: ${n}`)}catch(n){Ci(n)?X(ic,"Ignoring IndexedDB error during index backfill: ",n):await Ro(n)}await this.re(6e4)})}}class DO{constructor(e,n){this.localStore=e,this.persistence=n}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.se(n,e))}se(e,n){const r=new Set;let s=n,i=!0;return M.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return X(ic,`Processing collection: ${o}`),this.oe(e,o,s).next(l=>{s-=l,r.add(o)});i=!1})).next(()=>n-s)}oe(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(l=>(X(ic,`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,n,l))).next(()=>o.size)}))}_e(e,n){let r=e;return n.changes.forEach((s,i)=>{const o=IS(i);Ky(o,r)>0&&(r=o)}),new Qn(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}or.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zi=-1;function af(t){return t==null}function Oc(t){return t===0&&1/t==-1/0}function OO(t){return typeof t=="number"&&Number.isInteger(t)&&!Oc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fh="";function pn(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Bw(e)),e=LO(t.get(n),e);return Bw(e)}function LO(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case fh:n+="";break;default:n+=i}}return n}function Bw(t){return t+fh+""}function qr(t){const e=t.length;if(ge(e>=2,64408,{path:t}),e===2)return ge(t.charAt(0)===fh&&t.charAt(1)==="",56145,{path:t}),Ye.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const o=t.indexOf(fh,i);switch((o<0||o>n)&&he(50515,{path:t}),t.charAt(o+1)){case"":const l=t.substring(i,o);let c;s.length===0?c=l:(s+=l,c=s,s=""),r.push(c);break;case"":s+=t.substring(i,o),s+="\0";break;case"":s+=t.substring(i,o+1);break;default:he(61167,{path:t})}i=o+2}return new Ye(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ui="remoteDocuments",ru="owner",Lo="owner",Lc="mutationQueues",VO="userId",xr="mutations",zw="batchId",Qi="userMutationsIndex",qw=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ed(t,e){return[t,pn(e)]}function NS(t,e,n){return[t,pn(e),n]}const MO={},Da="documentMutations",ph="remoteDocumentsV14",FO=["prefixPath","collectionGroup","readTime","documentId"],bd="documentKeyIndex",UO=["prefixPath","collectionGroup","documentId"],AS="collectionGroupIndex",$O=["collectionGroup","readTime","prefixPath","documentId"],Vc="remoteDocumentGlobal",ig="remoteDocumentGlobalKey",Oa="targets",RS="queryTargetsIndex",BO=["canonicalId","targetId"],La="targetDocuments",zO=["targetId","path"],Yy="documentTargetsIndex",qO=["path","targetId"],mh="targetGlobalKey",eo="targetGlobal",Mc="collectionParents",HO=["collectionId","parent"],Va="clientMetadata",WO="clientId",lf="bundles",GO="bundleId",cf="namedQueries",KO="name",Xy="indexConfiguration",QO="indexId",og="collectionGroupIndex",YO="collectionGroup",oc="indexState",XO=["indexId","uid"],PS="sequenceNumberIndex",JO=["uid","sequenceNumber"],ac="indexEntries",ZO=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],kS="documentKeyIndex",eL=["indexId","uid","orderedDocumentKey"],uf="documentOverlays",tL=["userId","collectionPath","documentId"],ag="collectionPathOverlayIndex",nL=["userId","collectionPath","largestBatchId"],jS="collectionGroupOverlayIndex",rL=["userId","collectionGroup","largestBatchId"],Jy="globals",sL="name",DS=[Lc,xr,Da,Ui,Oa,ru,eo,La,Va,Vc,Mc,lf,cf],iL=[...DS,uf],OS=[Lc,xr,Da,ph,Oa,ru,eo,La,Va,Vc,Mc,lf,cf,uf],LS=OS,Zy=[...LS,Xy,oc,ac],oL=Zy,VS=[...Zy,Jy],aL=VS;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg extends SS{constructor(e,n){super(),this.le=e,this.currentSequenceNumber=n}}function Gt(t,e){const n=Se(t);return hi.O(n.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ni(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function lL(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function MS(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,n){this.comparator=e,this.root=n||nn.EMPTY}insert(e,n){return new wt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,nn.BLACK,null,null))}remove(e){return new wt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Hu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Hu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Hu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Hu(this.root,e,this.comparator,!0)}}class Hu{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??nn.RED,this.left=s??nn.EMPTY,this.right=i??nn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new nn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return nn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return nn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,nn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,nn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw he(43730,{key:this.key,value:this.value});if(this.right.isRed())throw he(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw he(27949);return e+(this.isRed()?0:1)}}nn.EMPTY=null,nn.RED=!0,nn.BLACK=!1;nn.EMPTY=new class{constructor(){this.size=0}get key(){throw he(57766)}get value(){throw he(16141)}get color(){throw he(16727)}get left(){throw he(29726)}get right(){throw he(36894)}copy(e,n,r,s,i){return this}insert(e,n,r){return new nn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e){this.comparator=e,this.data=new wt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Ww(this.data.getIterator())}getIteratorFrom(e){return new Ww(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof it)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new it(this.comparator);return n.data=e,n}}class Ww{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Vo(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e){this.fields=e,e.sort(Tt.comparator)}static empty(){return new kn([])}unionWith(e){let n=new it(Tt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new kn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ja(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new FS("Invalid base64 string: "+i):i}}(e);return new Bt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Bt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Re(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Bt.EMPTY_BYTE_STRING=new Bt("");const cL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bs(t){if(ge(!!t,39018),typeof t=="string"){let e=0;const n=cL.exec(t);if(ge(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:vt(t.seconds),nanos:vt(t.nanos)}}function vt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Is(t){return typeof t=="string"?Bt.fromBase64String(t):Bt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const US="server_timestamp",$S="__type__",BS="__previous_value__",zS="__local_write_time__";function df(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[$S])==null?void 0:r.stringValue)===US}function hf(t){const e=t.mapValue.fields[BS];return df(e)?hf(e):e}function Fc(t){const e=bs(t.mapValue.fields[zS].timestampValue);return new He(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uL{constructor(e,n,r,s,i,o,l,c,d,f){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=f}}const gh="(default)";class po{constructor(e,n){this.projectId=e,this.database=n||gh}static empty(){return new po("","")}get isDefaultDatabase(){return this.database===gh}isEqual(e){return e instanceof po&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ev="__type__",qS="__max__",Zs={mapValue:{fields:{__type__:{stringValue:qS}}}},tv="__vector__",Ma="value",Id={nullValue:"NULL_VALUE"};function gi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?df(t)?4:HS(t)?9007199254740991:ff(t)?10:11:he(28295,{value:t})}function Zr(t,e){if(t===e)return!0;const n=gi(t);if(n!==gi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Fc(t).isEqual(Fc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=bs(s.timestampValue),l=bs(i.timestampValue);return o.seconds===l.seconds&&o.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return Is(s.bytesValue).isEqual(Is(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return vt(s.geoPointValue.latitude)===vt(i.geoPointValue.latitude)&&vt(s.geoPointValue.longitude)===vt(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return vt(s.integerValue)===vt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=vt(s.doubleValue),l=vt(i.doubleValue);return o===l?Oc(o)===Oc(l):isNaN(o)&&isNaN(l)}return!1}(t,e);case 9:return ja(t.arrayValue.values||[],e.arrayValue.values||[],Zr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},l=i.mapValue.fields||{};if(Hw(o)!==Hw(l))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(l[c]===void 0||!Zr(o[c],l[c])))return!1;return!0}(t,e);default:return he(52216,{left:t})}}function Uc(t,e){return(t.values||[]).find(n=>Zr(n,e))!==void 0}function yi(t,e){if(t===e)return 0;const n=gi(t),r=gi(e);if(n!==r)return Re(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Re(t.booleanValue,e.booleanValue);case 2:return function(i,o){const l=vt(i.integerValue||i.doubleValue),c=vt(o.integerValue||o.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return Gw(t.timestampValue,e.timestampValue);case 4:return Gw(Fc(t),Fc(e));case 5:return rg(t.stringValue,e.stringValue);case 6:return function(i,o){const l=Is(i),c=Is(o);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const l=i.split("/"),c=o.split("/");for(let d=0;d<l.length&&d<c.length;d++){const f=Re(l[d],c[d]);if(f!==0)return f}return Re(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const l=Re(vt(i.latitude),vt(o.latitude));return l!==0?l:Re(vt(i.longitude),vt(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Kw(t.arrayValue,e.arrayValue);case 10:return function(i,o){var m,v,P,A;const l=i.fields||{},c=o.fields||{},d=(m=l[Ma])==null?void 0:m.arrayValue,f=(v=c[Ma])==null?void 0:v.arrayValue,h=Re(((P=d==null?void 0:d.values)==null?void 0:P.length)||0,((A=f==null?void 0:f.values)==null?void 0:A.length)||0);return h!==0?h:Kw(d,f)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===Zs.mapValue&&o===Zs.mapValue)return 0;if(i===Zs.mapValue)return 1;if(o===Zs.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),d=o.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let h=0;h<c.length&&h<f.length;++h){const m=rg(c[h],f[h]);if(m!==0)return m;const v=yi(l[c[h]],d[f[h]]);if(v!==0)return v}return Re(c.length,f.length)}(t.mapValue,e.mapValue);default:throw he(23264,{he:n})}}function Gw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Re(t,e);const n=bs(t),r=bs(e),s=Re(n.seconds,r.seconds);return s!==0?s:Re(n.nanos,r.nanos)}function Kw(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=yi(n[s],r[s]);if(i)return i}return Re(n.length,r.length)}function Fa(t){return cg(t)}function cg(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=bs(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Is(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return se.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=cg(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${cg(n.fields[o])}`;return s+"}"}(t.mapValue):he(61005,{value:t})}function Td(t){switch(gi(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=hf(t);return e?16+Td(e):16;case 5:return 2*t.stringValue.length;case 6:return Is(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Td(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return Ni(r.fields,(i,o)=>{s+=i.length+Td(o)}),s}(t.mapValue);default:throw he(13486,{value:t})}}function mo(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function ug(t){return!!t&&"integerValue"in t}function $c(t){return!!t&&"arrayValue"in t}function Qw(t){return!!t&&"nullValue"in t}function Yw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Sd(t){return!!t&&"mapValue"in t}function ff(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[ev])==null?void 0:r.stringValue)===tv}function lc(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Ni(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=lc(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=lc(t.arrayValue.values[n]);return e}return{...t}}function HS(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===qS}const WS={mapValue:{fields:{[ev]:{stringValue:tv},[Ma]:{arrayValue:{}}}}};function dL(t){return"nullValue"in t?Id:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?mo(po.empty(),se.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?ff(t)?WS:{mapValue:{}}:he(35942,{value:t})}function hL(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?mo(po.empty(),se.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?WS:"mapValue"in t?ff(t)?{mapValue:{}}:Zs:he(61959,{value:t})}function Xw(t,e){const n=yi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function Jw(t,e){const n=yi(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dn{constructor(e){this.value=e}static empty(){return new dn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Sd(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=lc(n)}setAll(e){let n=Tt.emptyPath(),r={},s=[];e.forEach((o,l)=>{if(!n.isImmediateParentOf(l)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=l.popLast()}o?r[l.lastSegment()]=lc(o):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Sd(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Zr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Sd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Ni(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new dn(lc(this.value))}}function GS(t){const e=[];return Ni(t.fields,(n,r)=>{const s=new Tt([n]);if(Sd(r)){const i=GS(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new kn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e,n,r,s,i,o,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=l}static newInvalidDocument(e){return new Rt(e,0,ve.min(),ve.min(),ve.min(),dn.empty(),0)}static newFoundDocument(e,n,r,s){return new Rt(e,1,n,ve.min(),r,s,0)}static newNoDocument(e,n){return new Rt(e,2,n,ve.min(),ve.min(),dn.empty(),0)}static newUnknownDocument(e,n){return new Rt(e,3,n,ve.min(),ve.min(),dn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(ve.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=dn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=dn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ve.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Rt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Rt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e,n){this.position=e,this.inclusive=n}}function Zw(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(i.field.isKeyField()?r=se.comparator(se.fromName(o.referenceValue),n.key):r=yi(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function eE(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Zr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e,n="asc"){this.field=e,this.dir=n}}function fL(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KS{}class Be extends KS{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new pL(e,n,r):n==="array-contains"?new yL(e,r):n==="in"?new eC(e,r):n==="not-in"?new vL(e,r):n==="array-contains-any"?new _L(e,r):new Be(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new mL(e,r):new gL(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(yi(n,this.value)):n!==null&&gi(this.value)===gi(n)&&this.matchesComparison(yi(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return he(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rt extends KS{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new rt(e,n)}matches(e){return Ua(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ua(t){return t.op==="and"}function dg(t){return t.op==="or"}function nv(t){return QS(t)&&Ua(t)}function QS(t){for(const e of t.filters)if(e instanceof rt)return!1;return!0}function hg(t){if(t instanceof Be)return t.field.canonicalString()+t.op.toString()+Fa(t.value);if(nv(t))return t.filters.map(e=>hg(e)).join(",");{const e=t.filters.map(n=>hg(n)).join(",");return`${t.op}(${e})`}}function YS(t,e){return t instanceof Be?function(r,s){return s instanceof Be&&r.op===s.op&&r.field.isEqual(s.field)&&Zr(r.value,s.value)}(t,e):t instanceof rt?function(r,s){return s instanceof rt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,l)=>i&&YS(o,s.filters[l]),!0):!1}(t,e):void he(19439)}function XS(t,e){const n=t.filters.concat(e);return rt.create(n,t.op)}function JS(t){return t instanceof Be?function(n){return`${n.field.canonicalString()} ${n.op} ${Fa(n.value)}`}(t):t instanceof rt?function(n){return n.op.toString()+" {"+n.getFilters().map(JS).join(" ,")+"}"}(t):"Filter"}class pL extends Be{constructor(e,n,r){super(e,n,r),this.key=se.fromName(r.referenceValue)}matches(e){const n=se.comparator(e.key,this.key);return this.matchesComparison(n)}}class mL extends Be{constructor(e,n){super(e,"in",n),this.keys=ZS("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class gL extends Be{constructor(e,n){super(e,"not-in",n),this.keys=ZS("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function ZS(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>se.fromName(r.referenceValue))}class yL extends Be{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return $c(n)&&Uc(n.arrayValue,this.value)}}class eC extends Be{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Uc(this.value.arrayValue,n)}}class vL extends Be{constructor(e,n){super(e,"not-in",n)}matches(e){if(Uc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Uc(this.value.arrayValue,n)}}class _L extends Be{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!$c(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Uc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xL{constructor(e,n=null,r=[],s=[],i=null,o=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=l,this.Te=null}}function fg(t,e=null,n=[],r=[],s=null,i=null,o=null){return new xL(t,e,n,r,s,i,o)}function go(t){const e=Se(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>hg(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),af(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Fa(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Fa(r)).join(",")),e.Te=n}return e.Te}function su(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!fL(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!YS(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!eE(t.startAt,e.startAt)&&eE(t.endAt,e.endAt)}function yh(t){return se.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function vh(t,e){return t.filters.filter(n=>n instanceof Be&&n.field.isEqual(e))}function tE(t,e,n){let r=Id,s=!0;for(const i of vh(t,e)){let o=Id,l=!0;switch(i.op){case"<":case"<=":o=dL(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,l=!1;break;case"!=":case"not-in":o=Id}Xw({value:r,inclusive:s},{value:o,inclusive:l})<0&&(r=o,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];Xw({value:r,inclusive:s},{value:o,inclusive:n.inclusive})<0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}function nE(t,e,n){let r=Zs,s=!0;for(const i of vh(t,e)){let o=Zs,l=!0;switch(i.op){case">=":case">":o=hL(i.value),l=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,l=!1;break;case"!=":case"not-in":o=Zs}Jw({value:r,inclusive:s},{value:o,inclusive:l})>0&&(r=o,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];Jw({value:r,inclusive:s},{value:o,inclusive:n.inclusive})>0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(e,n=null,r=[],s=[],i=null,o="F",l=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function wL(t,e,n,r,s,i,o,l){return new Ai(t,e,n,r,s,i,o,l)}function iu(t){return new Ai(t)}function rE(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function rv(t){return t.collectionGroup!==null}function wa(t){const e=Se(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let l=new it(Tt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Bc(i,r))}),n.has(Tt.keyField().canonicalString())||e.Ie.push(new Bc(Tt.keyField(),r))}return e.Ie}function lr(t){const e=Se(t);return e.Ee||(e.Ee=tC(e,wa(t))),e.Ee}function EL(t){const e=Se(t);return e.de||(e.de=tC(e,t.explicitOrderBy)),e.de}function tC(t,e){if(t.limitType==="F")return fg(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Bc(s.field,i)});const n=t.endAt?new vi(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new vi(t.startAt.position,t.startAt.inclusive):null;return fg(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function pg(t,e){const n=t.filters.concat([e]);return new Ai(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function _h(t,e,n){return new Ai(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function pf(t,e){return su(lr(t),lr(e))&&t.limitType===e.limitType}function nC(t){return`${go(lr(t))}|lt:${t.limitType}`}function Yo(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>JS(s)).join(", ")}]`),af(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Fa(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Fa(s)).join(",")),`Target(${r})`}(lr(t))}; limitType=${t.limitType})`}function ou(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):se.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of wa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,l,c){const d=Zw(o,l,c);return o.inclusive?d<=0:d<0}(r.startAt,wa(r),s)||r.endAt&&!function(o,l,c){const d=Zw(o,l,c);return o.inclusive?d>=0:d>0}(r.endAt,wa(r),s))}(t,e)}function bL(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function rC(t){return(e,n)=>{let r=!1;for(const s of wa(t)){const i=IL(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function IL(t,e,n){const r=t.field.isKeyField()?se.comparator(e.key,n.key):function(i,o,l){const c=o.data.field(i),d=l.data.field(i);return c!==null&&d!==null?yi(c,d):he(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return he(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ni(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return MS(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TL=new wt(se.comparator);function Hn(){return TL}const sC=new wt(se.comparator);function $l(...t){let e=sC;for(const n of t)e=e.insert(n.key,n);return e}function iC(t){let e=sC;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Hr(){return cc()}function oC(){return cc()}function cc(){return new Ss(t=>t.toString(),(t,e)=>t.isEqual(e))}const SL=new wt(se.comparator),CL=new it(se.comparator);function Ve(...t){let e=CL;for(const n of t)e=e.add(n);return e}const NL=new it(Re);function AL(){return NL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sv(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Oc(e)?"-0":e}}function aC(t){return{integerValue:""+t}}function lC(t,e){return OO(e)?aC(e):sv(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(){this._=void 0}}function RL(t,e,n){return t instanceof $a?function(s,i){const o={fields:{[$S]:{stringValue:US},[zS]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&df(i)&&(i=hf(i)),i&&(o.fields[BS]=i),{mapValue:o}}(n,e):t instanceof yo?uC(t,e):t instanceof Ba?dC(t,e):function(s,i){const o=cC(s,i),l=sE(o)+sE(s.Ae);return ug(o)&&ug(s.Ae)?aC(l):sv(s.serializer,l)}(t,e)}function PL(t,e,n){return t instanceof yo?uC(t,e):t instanceof Ba?dC(t,e):n}function cC(t,e){return t instanceof za?function(r){return ug(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class $a extends mf{}class yo extends mf{constructor(e){super(),this.elements=e}}function uC(t,e){const n=hC(e);for(const r of t.elements)n.some(s=>Zr(s,r))||n.push(r);return{arrayValue:{values:n}}}class Ba extends mf{constructor(e){super(),this.elements=e}}function dC(t,e){let n=hC(e);for(const r of t.elements)n=n.filter(s=>!Zr(s,r));return{arrayValue:{values:n}}}class za extends mf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function sE(t){return vt(t.integerValue||t.doubleValue)}function hC(t){return $c(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e,n){this.field=e,this.transform=n}}function kL(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof yo&&s instanceof yo||r instanceof Ba&&s instanceof Ba?ja(r.elements,s.elements,Zr):r instanceof za&&s instanceof za?Zr(r.Ae,s.Ae):r instanceof $a&&s instanceof $a}(t.transform,e.transform)}class jL{constructor(e,n){this.version=e,this.transformResults=n}}class hn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new hn}static exists(e){return new hn(void 0,e)}static updateTime(e){return new hn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Cd(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class yf{}function fC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new vf(t.key,hn.none()):new nl(t.key,t.data,hn.none());{const n=t.data,r=dn.empty();let s=new it(Tt.comparator);for(let i of e.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new Cs(t.key,r,new kn(s.toArray()),hn.none())}}function DL(t,e,n){t instanceof nl?function(s,i,o){const l=s.value.clone(),c=oE(s.fieldTransforms,i,o.transformResults);l.setAll(c),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Cs?function(s,i,o){if(!Cd(s.precondition,i))return void i.convertToUnknownDocument(o.version);const l=oE(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(pC(s)),c.setAll(l),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function uc(t,e,n,r){return t instanceof nl?function(i,o,l,c){if(!Cd(i.precondition,o))return l;const d=i.value.clone(),f=aE(i.fieldTransforms,c,o);return d.setAll(f),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Cs?function(i,o,l,c){if(!Cd(i.precondition,o))return l;const d=aE(i.fieldTransforms,c,o),f=o.data;return f.setAll(pC(i)),f.setAll(d),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(t,e,n,r):function(i,o,l){return Cd(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):l}(t,e,n)}function OL(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=cC(r.transform,s||null);i!=null&&(n===null&&(n=dn.empty()),n.set(r.field,i))}return n||null}function iE(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ja(r,s,(i,o)=>kL(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class nl extends yf{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Cs extends yf{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function pC(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function oE(t,e,n){const r=new Map;ge(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,l=e.data.field(i.field);r.set(i.field,PL(o,l,n[s]))}return r}function aE(t,e,n){const r=new Map;for(const s of t){const i=s.transform,o=n.data.field(s.field);r.set(s.field,RL(i,o,e))}return r}class vf extends yf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class mC extends yf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&DL(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=uc(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=uc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=oC();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let l=this.applyToLocalView(o,i.mutatedFields);l=n.has(s.key)?null:l;const c=fC(o,l);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(ve.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ve())}isEqual(e){return this.batchId===e.batchId&&ja(this.mutations,e.mutations,(n,r)=>iE(n,r))&&ja(this.baseMutations,e.baseMutations,(n,r)=>iE(n,r))}}class ov{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){ge(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return SL}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new ov(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class av{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LL{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VL{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ft,qe;function ML(t){switch(t){case q.OK:return he(64938);case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0;default:return he(15467,{code:t})}}function gC(t){if(t===void 0)return _n("GRPC error has no .code"),q.UNKNOWN;switch(t){case Ft.OK:return q.OK;case Ft.CANCELLED:return q.CANCELLED;case Ft.UNKNOWN:return q.UNKNOWN;case Ft.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case Ft.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case Ft.INTERNAL:return q.INTERNAL;case Ft.UNAVAILABLE:return q.UNAVAILABLE;case Ft.UNAUTHENTICATED:return q.UNAUTHENTICATED;case Ft.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case Ft.NOT_FOUND:return q.NOT_FOUND;case Ft.ALREADY_EXISTS:return q.ALREADY_EXISTS;case Ft.PERMISSION_DENIED:return q.PERMISSION_DENIED;case Ft.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case Ft.ABORTED:return q.ABORTED;case Ft.OUT_OF_RANGE:return q.OUT_OF_RANGE;case Ft.UNIMPLEMENTED:return q.UNIMPLEMENTED;case Ft.DATA_LOSS:return q.DATA_LOSS;default:return he(39323,{code:t})}}(qe=Ft||(Ft={}))[qe.OK=0]="OK",qe[qe.CANCELLED=1]="CANCELLED",qe[qe.UNKNOWN=2]="UNKNOWN",qe[qe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",qe[qe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",qe[qe.NOT_FOUND=5]="NOT_FOUND",qe[qe.ALREADY_EXISTS=6]="ALREADY_EXISTS",qe[qe.PERMISSION_DENIED=7]="PERMISSION_DENIED",qe[qe.UNAUTHENTICATED=16]="UNAUTHENTICATED",qe[qe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",qe[qe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",qe[qe.ABORTED=10]="ABORTED",qe[qe.OUT_OF_RANGE=11]="OUT_OF_RANGE",qe[qe.UNIMPLEMENTED=12]="UNIMPLEMENTED",qe[qe.INTERNAL=13]="INTERNAL",qe[qe.UNAVAILABLE=14]="UNAVAILABLE",qe[qe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UL=new di([4294967295,4294967295],0);function lE(t){const e=FL().encode(t),n=new fS;return n.update(e),new Uint8Array(n.digest())}function cE(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new di([n,r],0),new di([s,i],0)]}class lv{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Bl(`Invalid padding: ${n}`);if(r<0)throw new Bl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Bl(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Bl(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=di.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(di.fromNumber(r)));return s.compare(UL)===1&&(s=new di([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=lE(e),[r,s]=cE(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new lv(i,s,n);return r.forEach(l=>o.insert(l)),o}insert(e){if(this.ge===0)return;const n=lE(e),[r,s]=cE(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Bl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,au.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new _f(ve.min(),s,new wt(Re),Hn(),Ve())}}class au{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new au(r,n,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nd{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class yC{constructor(e,n){this.targetId=e,this.Ce=n}}class vC{constructor(e,n,r=Bt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class uE{constructor(){this.ve=0,this.Fe=dE(),this.Me=Bt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ve(),n=Ve(),r=Ve();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:he(38017,{changeType:i})}}),new au(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=dE()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ge(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class $L{constructor(e){this.Ge=e,this.ze=new Map,this.je=Hn(),this.Je=Wu(),this.He=Wu(),this.Ye=new wt(Re)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:he(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,s)=>{this.rt(s)&&n(s)})}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const i=s.target;if(yh(i))if(r===0){const o=new se(i.path);this.et(n,o,Rt.newNoDocument(o,ve.min()))}else ge(r===1,20013,{expectedCount:r});else{const o=this._t(n);if(o!==r){const l=this.ut(e),c=l?this.ct(l,e,o):1;if(c!==0){this.it(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,d)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let o,l;try{o=Is(r).toUint8Array()}catch(c){if(c instanceof FS)return fo("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new lv(o,s,i)}catch(c){return fo(c instanceof Bl?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),l=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(n,i,null),s++)}),s}Tt(e){const n=new Map;this.ze.forEach((i,o)=>{const l=this.ot(o);if(l){if(i.current&&yh(l.target)){const c=new se(l.target.path);this.It(c).has(o)||this.Et(o,c)||this.et(o,c,Rt.newNoDocument(c,e))}i.Be&&(n.set(o,i.ke()),i.qe())}});let r=Ve();this.He.forEach((i,o)=>{let l=!0;o.forEachWhile(c=>{const d=this.ot(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new _f(e,n,this.Ye,this.je,r);return this.je=Hn(),this.Je=Wu(),this.He=Wu(),this.Ye=new wt(Re),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new uE,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new it(Re),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new it(Re),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||X("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new uE),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Wu(){return new wt(se.comparator)}function dE(){return new wt(se.comparator)}const BL={asc:"ASCENDING",desc:"DESCENDING"},zL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qL={and:"AND",or:"OR"};class HL{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function mg(t,e){return t.useProto3Json||af(e)?e:{value:e}}function qa(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function _C(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function WL(t,e){return qa(t,e.toTimestamp())}function In(t){return ge(!!t,49232),ve.fromTimestamp(function(n){const r=bs(n);return new He(r.seconds,r.nanos)}(t))}function cv(t,e){return gg(t,e).canonicalString()}function gg(t,e){const n=function(s){return new Ye(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function xC(t){const e=Ye.fromString(t);return ge(NC(e),10190,{key:e.toString()}),e}function xh(t,e){return cv(t.databaseId,e.path)}function to(t,e){const n=xC(e);if(n.get(1)!==t.databaseId.projectId)throw new Z(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Z(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new se(bC(n))}function wC(t,e){return cv(t.databaseId,e)}function EC(t){const e=xC(t);return e.length===4?Ye.emptyPath():bC(e)}function yg(t){return new Ye(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function bC(t){return ge(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function hE(t,e,n){return{name:xh(t,e),fields:n.value.mapValue.fields}}function GL(t,e,n){const r=to(t,e.name),s=In(e.updateTime),i=e.createTime?In(e.createTime):ve.min(),o=new dn({mapValue:{fields:e.fields}}),l=Rt.newFoundDocument(r,s,i,o);return n&&l.setHasCommittedMutations(),n?l.setHasCommittedMutations():l}function KL(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:he(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(ge(f===void 0||typeof f=="string",58123),Bt.fromBase64String(f||"")):(ge(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Bt.fromUint8Array(f||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,l=o&&function(d){const f=d.code===void 0?q.UNKNOWN:gC(d.code);return new Z(f,d.message||"")}(o);n=new vC(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=to(t,r.document.name),i=In(r.document.updateTime),o=r.document.createTime?In(r.document.createTime):ve.min(),l=new dn({mapValue:{fields:r.document.fields}}),c=Rt.newFoundDocument(s,i,o,l),d=r.targetIds||[],f=r.removedTargetIds||[];n=new Nd(d,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=to(t,r.document),i=r.readTime?In(r.readTime):ve.min(),o=Rt.newNoDocument(s,i),l=r.removedTargetIds||[];n=new Nd([],l,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=to(t,r.document),i=r.removedTargetIds||[];n=new Nd([],i,s,null)}else{if(!("filter"in e))return he(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new VL(s,i),l=r.targetId;n=new yC(l,o)}}return n}function wh(t,e){let n;if(e instanceof nl)n={update:hE(t,e.key,e.value)};else if(e instanceof vf)n={delete:xh(t,e.key)};else if(e instanceof Cs)n={update:hE(t,e.key,e.data),updateMask:tV(e.fieldMask)};else{if(!(e instanceof mC))return he(16599,{Vt:e.type});n={verify:xh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const l=o.transform;if(l instanceof $a)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof yo)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ba)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof za)return{fieldPath:o.field.canonicalString(),increment:l.Ae};throw he(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:WL(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:he(27497)}(t,e.precondition)),n}function vg(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?hn.updateTime(In(i.updateTime)):i.exists!==void 0?hn.exists(i.exists):hn.none()}(e.currentDocument):hn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,l){let c=null;if("setToServerValue"in l)ge(l.setToServerValue==="REQUEST_TIME",16630,{proto:l}),c=new $a;else if("appendMissingElements"in l){const f=l.appendMissingElements.values||[];c=new yo(f)}else if("removeAllFromArray"in l){const f=l.removeAllFromArray.values||[];c=new Ba(f)}else"increment"in l?c=new za(o,l.increment):he(16584,{proto:l});const d=Tt.fromServerFormat(l.fieldPath);return new gf(d,c)}(t,s)):[];if(e.update){e.update.name;const s=to(t,e.update.name),i=new dn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const d=c.fieldPaths||[];return new kn(d.map(f=>Tt.fromServerFormat(f)))}(e.updateMask);return new Cs(s,i,o,n,r)}return new nl(s,i,n,r)}if(e.delete){const s=to(t,e.delete);return new vf(s,n)}if(e.verify){const s=to(t,e.verify);return new mC(s,n)}return he(1463,{proto:e})}function QL(t,e){return t&&t.length>0?(ge(e!==void 0,14353),t.map(n=>function(s,i){let o=s.updateTime?In(s.updateTime):In(i);return o.isEqual(ve.min())&&(o=In(i)),new jL(o,s.transformResults||[])}(n,e))):[]}function IC(t,e){return{documents:[wC(t,e.path)]}}function uv(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=wC(t,s);const i=function(d){if(d.length!==0)return CC(rt.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(d){if(d.length!==0)return d.map(f=>function(m){return{field:Ks(m.field),direction:JL(m.dir)}}(f))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const l=mg(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:n,parent:s}}function YL(t,e,n,r){const{ft:s,parent:i}=uv(t,e),o={},l=[];let c=0;return n.forEach(d=>{const f="aggregate_"+c++;o[f]=d.alias,d.aggregateType==="count"?l.push({alias:f,count:{}}):d.aggregateType==="avg"?l.push({alias:f,avg:{field:Ks(d.fieldPath)}}):d.aggregateType==="sum"&&l.push({alias:f,sum:{field:Ks(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:l,structuredQuery:s.structuredQuery},parent:s.parent},gt:o,parent:i}}function TC(t){let e=EC(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){ge(r===1,65062);const f=n.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];n.where&&(i=function(h){const m=SC(h);return m instanceof rt&&nv(m)?m.getFilters():[m]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(m=>function(P){return new Bc(Xo(P.field),function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(P.direction))}(m))}(n.orderBy));let l=null;n.limit&&(l=function(h){let m;return m=typeof h=="object"?h.value:h,af(m)?null:m}(n.limit));let c=null;n.startAt&&(c=function(h){const m=!!h.before,v=h.values||[];return new vi(v,m)}(n.startAt));let d=null;return n.endAt&&(d=function(h){const m=!h.before,v=h.values||[];return new vi(v,m)}(n.endAt)),wL(e,s,o,i,l,"F",c,d)}function XL(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return he(28987,{purpose:s})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function SC(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Xo(n.unaryFilter.field);return Be.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Xo(n.unaryFilter.field);return Be.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Xo(n.unaryFilter.field);return Be.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Xo(n.unaryFilter.field);return Be.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return he(61313);default:return he(60726)}}(t):t.fieldFilter!==void 0?function(n){return Be.create(Xo(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return he(58110);default:return he(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return rt.create(n.compositeFilter.filters.map(r=>SC(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return he(1026)}}(n.compositeFilter.op))}(t):he(30097,{filter:t})}function JL(t){return BL[t]}function ZL(t){return zL[t]}function eV(t){return qL[t]}function Ks(t){return{fieldPath:t.canonicalString()}}function Xo(t){return Tt.fromServerFormat(t.fieldPath)}function CC(t){return t instanceof Be?function(n){if(n.op==="=="){if(Yw(n.value))return{unaryFilter:{field:Ks(n.field),op:"IS_NAN"}};if(Qw(n.value))return{unaryFilter:{field:Ks(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Yw(n.value))return{unaryFilter:{field:Ks(n.field),op:"IS_NOT_NAN"}};if(Qw(n.value))return{unaryFilter:{field:Ks(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ks(n.field),op:ZL(n.op),value:n.value}}}(t):t instanceof rt?function(n){const r=n.getFilters().map(s=>CC(s));return r.length===1?r[0]:{compositeFilter:{op:eV(n.op),filters:r}}}(t):he(54877,{filter:t})}function tV(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function NC(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds{constructor(e,n,r,s,i=ve.min(),o=ve.min(),l=Bt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new ds(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ds(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ds(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ds(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AC{constructor(e){this.yt=e}}function nV(t,e){let n;if(e.document)n=GL(t.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=se.fromSegments(e.noDocument.path),s=_o(e.noDocument.readTime);n=Rt.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return he(56709);{const r=se.fromSegments(e.unknownDocument.path),s=_o(e.unknownDocument.version);n=Rt.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new He(s[0],s[1]);return ve.fromTimestamp(i)}(e.readTime)),n}function fE(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Eh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:xh(i,o.key),fields:o.data.value.mapValue.fields,updateTime:qa(i,o.version.toTimestamp()),createTime:qa(i,o.createTime.toTimestamp())}}(t.yt,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:vo(e.version)};else{if(!e.isUnknownDocument())return he(57904,{document:e});r.unknownDocument={path:n.path.toArray(),version:vo(e.version)}}return r}function Eh(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function vo(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function _o(t){const e=new He(t.seconds,t.nanoseconds);return ve.fromTimestamp(e)}function Bi(t,e){const n=(e.baseMutations||[]).map(i=>vg(t.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>vg(t.yt,i)),s=He.fromMillis(e.localWriteTimeMs);return new iv(e.batchId,s,n,r)}function zl(t){const e=_o(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?_o(t.lastLimboFreeSnapshotVersion):ve.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){const o=i.documents.length;return ge(o===1,1966,{count:o}),lr(iu(EC(i.documents[0])))}(t.query):function(i){return lr(TC(i))}(t.query),new ds(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,Bt.fromBase64String(t.resumeToken))}function RC(t,e){const n=vo(e.snapshotVersion),r=vo(e.lastLimboFreeSnapshotVersion);let s;s=yh(e.target)?IC(t.yt,e.target):uv(t.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:go(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function PC(t){const e=TC({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?_h(e,e.limit,"L"):e}function Pp(t,e){return new av(e.largestBatchId,vg(t.yt,e.overlayMutation))}function pE(t,e){const n=e.path.lastSegment();return[t,pn(e.path.popLast()),n]}function mE(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:vo(r.readTime),documentKey:pn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{getBundleMetadata(e,n){return gE(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:_o(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return gE(e).put(function(s){return{bundleId:s.id,createTime:vo(In(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return yE(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:PC(i.bundledQuery),readTime:_o(i.readTime)}}(r)})}saveNamedQuery(e,n){return yE(e).put(function(s){return{name:s.name,readTime:vo(In(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function gE(t){return Gt(t,lf)}function yE(t){return Gt(t,cf)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(e,n){this.serializer=e,this.userId=n}static wt(e,n){const r=n.uid||"";return new xf(e,r)}getOverlay(e,n){return Tl(e).get(pE(this.userId,n)).next(r=>r?Pp(this.serializer,r):null)}getOverlays(e,n){const r=Hr();return M.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,o)=>{const l=new av(n,o);s.push(this.St(e,l))}),M.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(o=>s.add(pn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const l=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Tl(e).Z(ag,l))}),M.waitFor(i)}getOverlaysForCollection(e,n,r){const s=Hr(),i=pn(n),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Tl(e).J(ag,o).next(l=>{for(const c of l){const d=Pp(this.serializer,c);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=Hr();let o;const l=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return Tl(e).ee({index:jS,range:l},(c,d,f)=>{const h=Pp(this.serializer,d);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):f.done()}).next(()=>i)}St(e,n){return Tl(e).put(function(s,i,o){const[l,c,d]=pE(i,o.mutation.key);return{userId:i,collectionPath:c,documentId:d,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:wh(s.yt,o.mutation)}}(this.serializer,this.userId,n))}}function Tl(t){return Gt(t,uf)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sV{bt(e){return Gt(e,Jy)}getSessionToken(e){return this.bt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?Bt.fromUint8Array(r):Bt.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.bt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zi{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(vt(e.integerValue));else if("doubleValue"in e){const r=vt(e.doubleValue);isNaN(r)?this.Ft(n,13):(this.Ft(n,15),Oc(r)?n.Mt(0):n.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(n,20),typeof r=="string"&&(r=bs(r)),n.xt(`${r.seconds||""}`),n.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(Is(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(n,45),n.Mt(r.latitude||0),n.Mt(r.longitude||0)}else"mapValue"in e?HS(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):ff(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):he(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){const r=e.fields||{};this.Ft(n,55);for(const s of Object.keys(r))this.Ot(s,n),this.Ct(r[s],n)}kt(e,n){var o,l;const r=e.fields||{};this.Ft(n,53);const s=Ma,i=((l=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:l.length)||0;this.Ft(n,15),n.Mt(vt(i)),this.Ot(s,n),this.Ct(r[s],n)}Qt(e,n){const r=e.values||[];this.Ft(n,50);for(const s of r)this.Ct(s,n)}Lt(e,n){this.Ft(n,37),se.fromName(e).path.forEach(r=>{this.Ft(n,60),this.Ut(r,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}}zi.Kt=new zi;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mo=255;function iV(t){if(t===0)return 8;let e=0;return t>>4||(e+=4,t<<=4),t>>6||(e+=2,t<<=2),t>>7||(e+=1),e}function vE(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=iV(255&r[i]);if(s+=o,o!==8)break}return s}(t);return Math.ceil(e/8)}class oV{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Gt(r.value),r=n.next();this.zt()}jt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Jt(r.value),r=n.next();this.Ht()}Yt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=n.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=n.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const n=this.en(e),r=vE(n);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}nn(e){const n=this.en(e),r=vE(n);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}rn(){this.sn(Mo),this.sn(255)}_n(){this.an(Mo),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const n=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&n[0]);n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Gt(e){const n=255&e;n===0?(this.sn(0),this.sn(255)):n===Mo?(this.sn(Mo),this.sn(0)):this.sn(n)}Jt(e){const n=255&e;n===0?(this.an(0),this.an(255)):n===Mo?(this.an(Mo),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class aV{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class lV{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Sl{constructor(){this.cn=new oV,this.ln=new aV(this.cn),this.hn=new lV(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e,n,r,s){this.Tn=e,this.In=n,this.En=r,this.dn=s}An(){const e=this.dn.length,n=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.dn,0),n!==e?r.set([0],this.dn.length):++r[r.length-1],new qi(this.Tn,this.In,this.En,r)}Rn(e,n,r){return{indexId:this.Tn,uid:e,arrayValue:Ad(this.En),directionalValue:Ad(this.dn),orderedDocumentKey:Ad(n),documentKey:r.path.toArray()}}Vn(e,n,r){const s=this.Rn(e,n,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Ls(t,e){let n=t.Tn-e.Tn;return n!==0?n:(n=_E(t.En,e.En),n!==0?n:(n=_E(t.dn,e.dn),n!==0?n:se.comparator(t.In,e.In)))}function _E(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}function Ad(t){return TT()?function(n){let r="";for(let s=0;s<n.length;s++)r+=String.fromCharCode(n[s]);return r}(t):t}function xE(t){return typeof t!="string"?t:function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(t)}class wE{constructor(e){this.mn=new it((n,r)=>Tt.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const n of e.filters){const r=n;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(ge(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const n=sg(e);if(n!==void 0&&!this.wn(n))return!1;const r=Fi(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const l=this.mn.getIterator().getNext();if(!s.has(l.field.canonicalString())){const c=r[i];if(!this.Sn(l,c)||!this.bn(this.fn[o++],c))return!1}++i}for(;i<r.length;++i){const l=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],l))return!1}return!0}Dn(){if(this.pn)return null;let e=new it(Tt.comparator);const n=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new wd(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new wd(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new wd(r.field,r.dir==="asc"?0:1)));return new hh(hh.UNKNOWN_ID,this.collectionId,n,Dc.empty())}wn(e){for(const n of this.gn)if(this.Sn(n,e))return!0;return!1}Sn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}bn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kC(t){var n,r;if(ge(t instanceof Be||t instanceof rt,20012),t instanceof Be){if(t instanceof eC){const s=((r=(n=t.value.arrayValue)==null?void 0:n.values)==null?void 0:r.map(i=>Be.create(t.field,"==",i)))||[];return rt.create(s,"or")}return t}const e=t.filters.map(s=>kC(s));return rt.create(e,t.op)}function cV(t){if(t.getFilters().length===0)return[];const e=wg(kC(t));return ge(jC(e),7391),_g(e)||xg(e)?[e]:e.getFilters()}function _g(t){return t instanceof Be}function xg(t){return t instanceof rt&&nv(t)}function jC(t){return _g(t)||xg(t)||function(n){if(n instanceof rt&&dg(n)){for(const r of n.getFilters())if(!_g(r)&&!xg(r))return!1;return!0}return!1}(t)}function wg(t){if(ge(t instanceof Be||t instanceof rt,34018),t instanceof Be)return t;if(t.filters.length===1)return wg(t.filters[0]);const e=t.filters.map(r=>wg(r));let n=rt.create(e,t.op);return n=bh(n),jC(n)?n:(ge(n instanceof rt,64498),ge(Ua(n),40251),ge(n.filters.length>1,57927),n.filters.reduce((r,s)=>dv(r,s)))}function dv(t,e){let n;return ge(t instanceof Be||t instanceof rt,38388),ge(e instanceof Be||e instanceof rt,25473),n=t instanceof Be?e instanceof Be?function(s,i){return rt.create([s,i],"and")}(t,e):EE(t,e):e instanceof Be?EE(e,t):function(s,i){if(ge(s.filters.length>0&&i.filters.length>0,48005),Ua(s)&&Ua(i))return XS(s,i.getFilters());const o=dg(s)?s:i,l=dg(s)?i:s,c=o.filters.map(d=>dv(d,l));return rt.create(c,"or")}(t,e),bh(n)}function EE(t,e){if(Ua(e))return XS(e,t.getFilters());{const n=e.filters.map(r=>dv(t,r));return rt.create(n,"or")}}function bh(t){if(ge(t instanceof Be||t instanceof rt,11850),t instanceof Be)return t;const e=t.getFilters();if(e.length===1)return bh(e[0]);if(QS(t))return t;const n=e.map(s=>bh(s)),r=[];return n.forEach(s=>{s instanceof Be?r.push(s):s instanceof rt&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:rt.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uV{constructor(){this.Cn=new hv}addToCollectionParentIndex(e,n){return this.Cn.add(n),M.resolve()}getCollectionParents(e,n){return M.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return M.resolve()}deleteFieldIndex(e,n){return M.resolve()}deleteAllFieldIndexes(e){return M.resolve()}createTargetIndexes(e,n){return M.resolve()}getDocumentsMatchingTarget(e,n){return M.resolve(null)}getIndexType(e,n){return M.resolve(0)}getFieldIndexes(e,n){return M.resolve([])}getNextCollectionGroupToUpdate(e){return M.resolve(null)}getMinOffset(e,n){return M.resolve(Qn.min())}getMinOffsetFromCollectionGroup(e,n){return M.resolve(Qn.min())}updateCollectionGroup(e,n,r){return M.resolve()}updateIndexEntries(e,n){return M.resolve()}}class hv{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new it(Ye.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new it(Ye.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bE="IndexedDbIndexManager",Gu=new Uint8Array(0);class dV{constructor(e,n){this.databaseId=n,this.vn=new hv,this.Fn=new Ss(r=>go(r),(r,s)=>su(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.vn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.vn.add(n)});const i={collectionId:r,parent:pn(s)};return IE(e).put(i)}return M.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[wS(n),""],!1,!0);return IE(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==n)break;r.push(qr(o.parent))}return r})}addFieldIndex(e,n){const r=Cl(e),s=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const o=Uo(e);return i.next(l=>{o.put(mE(l,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=Cl(e),s=Uo(e),i=Fo(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=Cl(e),r=Fo(e),s=Uo(e);return n.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,n){return M.forEach(this.Mn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new wE(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=Fo(e);let s=!0;const i=new Map;return M.forEach(this.Mn(n),o=>this.xn(e,o).next(l=>{s&&(s=!!l),i.set(o,l)})).next(()=>{if(s){let o=Ve();const l=[];return M.forEach(i,(c,d)=>{X(bE,`Using index ${function(w){return`id=${w.indexId}|cg=${w.collectionGroup}|f=${w.fields.map(T=>`${T.fieldPath}:${T.kind}`).join(",")}`}(c)} to execute ${go(n)}`);const f=function(w,T){const V=sg(T);if(V===void 0)return null;for(const U of vh(w,V.fieldPath))switch(U.op){case"array-contains-any":return U.value.arrayValue.values||[];case"array-contains":return[U.value]}return null}(d,c),h=function(w,T){const V=new Map;for(const U of Fi(T))for(const b of vh(w,U.fieldPath))switch(b.op){case"==":case"in":V.set(U.fieldPath.canonicalString(),b.value);break;case"not-in":case"!=":return V.set(U.fieldPath.canonicalString(),b.value),Array.from(V.values())}return null}(d,c),m=function(w,T){const V=[];let U=!0;for(const b of Fi(T)){const E=b.kind===0?tE(w,b.fieldPath,w.startAt):nE(w,b.fieldPath,w.startAt);V.push(E.value),U&&(U=E.inclusive)}return new vi(V,U)}(d,c),v=function(w,T){const V=[];let U=!0;for(const b of Fi(T)){const E=b.kind===0?nE(w,b.fieldPath,w.endAt):tE(w,b.fieldPath,w.endAt);V.push(E.value),U&&(U=E.inclusive)}return new vi(V,U)}(d,c),P=this.On(c,d,m),A=this.On(c,d,v),C=this.Nn(c,d,h),y=this.Bn(c.indexId,f,P,m.inclusive,A,v.inclusive,C);return M.forEach(y,_=>r.Y(_,n.limit).next(w=>{w.forEach(T=>{const V=se.fromSegments(T.documentKey);o.has(V)||(o=o.add(V),l.push(V))})}))}).next(()=>l)}return M.resolve(null)})}Mn(e){let n=this.Fn.get(e);return n||(e.filters.length===0?n=[e]:n=cV(rt.create(e.filters,"and")).map(r=>fg(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,n),n)}Bn(e,n,r,s,i,o,l){const c=(n!=null?n.length:1)*Math.max(r.length,i.length),d=c/(n!=null?n.length:1),f=[];for(let h=0;h<c;++h){const m=n?this.Ln(n[h/d]):Gu,v=this.kn(e,m,r[h%d],s),P=this.qn(e,m,i[h%d],o),A=l.map(C=>this.kn(e,m,C,!0));f.push(...this.createRange(v,P,A))}return f}kn(e,n,r,s){const i=new qi(e,se.empty(),n,r);return s?i:i.An()}qn(e,n,r,s){const i=new qi(e,se.empty(),n,r);return s?i.An():i}xn(e,n){const r=new wE(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const l of i)r.yn(l)&&(!o||l.fields.length>o.fields.length)&&(o=l);return o})}getIndexType(e,n){let r=2;const s=this.Mn(n);return M.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(c){let d=new it(Tt.comparator),f=!1;for(const h of c.filters)for(const m of h.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?f=!0:d=d.add(m.field));for(const h of c.orderBy)h.field.isKeyField()||(d=d.add(h.field));return d.size+(f?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(n)&&s.length>1&&r===2?1:r)}Qn(e,n){const r=new Sl;for(const s of Fi(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);zi.Kt.Dt(i,o)}return r.un()}Ln(e){const n=new Sl;return zi.Kt.Dt(e,n.Pn(0)),n.un()}$n(e,n){const r=new Sl;return zi.Kt.Dt(mo(this.databaseId,n),r.Pn(function(i){const o=Fi(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,n,r){if(r===null)return[];let s=[];s.push(new Sl);let i=0;for(const o of Fi(e)){const l=r[i++];for(const c of s)if(this.Un(n,o.fieldPath)&&$c(l))s=this.Kn(s,o,l);else{const d=c.Pn(o.kind);zi.Kt.Dt(l,d)}}return this.Wn(s)}On(e,n,r){return this.Nn(e,n,r.position)}Wn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].un();return n}Kn(e,n,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const l of s){const c=new Sl;c.seed(l.un()),zi.Kt.Dt(o,c.Pn(n.kind)),i.push(c)}return i}Un(e,n){return!!e.filters.find(r=>r instanceof Be&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=Cl(e),s=Uo(e);return(n?r.J(og,IDBKeyRange.bound(n,n)):r.J()).next(i=>{const o=[];return M.forEach(i,l=>s.get([l.indexId,this.uid]).next(c=>{o.push(function(f,h){const m=h?new Dc(h.sequenceNumber,new Qn(_o(h.readTime),new se(qr(h.documentKey)),h.largestBatchId)):Dc.empty(),v=f.fields.map(([P,A])=>new wd(Tt.fromServerFormat(P),A));return new hh(f.indexId,f.collectionGroup,v,m)}(l,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Re(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Cl(e),i=Uo(e);return this.Gn(e).next(o=>s.J(og,IDBKeyRange.bound(n,n)).next(l=>M.forEach(l,c=>i.put(mE(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,n){const r=new Map;return M.forEach(n,(s,i)=>{const o=r.get(s.collectionGroup);return(o?M.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(l=>(r.set(s.collectionGroup,l),M.forEach(l,c=>this.zn(e,s,c).next(d=>{const f=this.jn(i,c);return d.isEqual(f)?M.resolve():this.Jn(e,i,c,d,f)}))))})}Hn(e,n,r,s){return Fo(e).put(s.Rn(this.uid,this.$n(r,n.key),n.key))}Yn(e,n,r,s){return Fo(e).delete(s.Vn(this.uid,this.$n(r,n.key),n.key))}zn(e,n,r){const s=Fo(e);let i=new it(Ls);return s.ee({index:kS,range:IDBKeyRange.only([r.indexId,this.uid,Ad(this.$n(r,n))])},(o,l)=>{i=i.add(new qi(r.indexId,n,xE(l.arrayValue),xE(l.directionalValue)))}).next(()=>i)}jn(e,n){let r=new it(Ls);const s=this.Qn(n,e);if(s==null)return r;const i=sg(n);if(i!=null){const o=e.data.field(i.fieldPath);if($c(o))for(const l of o.arrayValue.values||[])r=r.add(new qi(n.indexId,e.key,this.Ln(l),s))}else r=r.add(new qi(n.indexId,e.key,Gu,s));return r}Jn(e,n,r,s,i){X(bE,"Updating index entries for document '%s'",n.key);const o=[];return function(c,d,f,h,m){const v=c.getIterator(),P=d.getIterator();let A=Vo(v),C=Vo(P);for(;A||C;){let y=!1,_=!1;if(A&&C){const w=f(A,C);w<0?_=!0:w>0&&(y=!0)}else A!=null?_=!0:y=!0;y?(h(C),C=Vo(P)):_?(m(A),A=Vo(v)):(A=Vo(v),C=Vo(P))}}(s,i,Ls,l=>{o.push(this.Hn(e,n,r,l))},l=>{o.push(this.Yn(e,n,r,l))}),M.waitFor(o)}Gn(e){let n=1;return Uo(e).ee({index:PS,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((o,l)=>Ls(o,l)).filter((o,l,c)=>!l||Ls(o,c[l-1])!==0);const s=[];s.push(e);for(const o of r){const l=Ls(o,e),c=Ls(o,n);if(l===0)s[0]=e.An();else if(l>0&&c<0)s.push(o),s.push(o.An());else if(c>0)break}s.push(n);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const l=s[o].Vn(this.uid,Gu,se.empty()),c=s[o+1].Vn(this.uid,Gu,se.empty());i.push(IDBKeyRange.bound(l,c))}return i}Zn(e,n){return Ls(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(TE)}getMinOffset(e,n){return M.mapArray(this.Mn(n),r=>this.xn(e,r).next(s=>s||he(44426))).next(TE)}}function IE(t){return Gt(t,Mc)}function Fo(t){return Gt(t,ac)}function Cl(t){return Gt(t,Xy)}function Uo(t){return Gt(t,oc)}function TE(t){ge(t.length!==0,28825);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;Ky(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new Qn(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},DC=41943040;class cn{static withCacheSize(e){return new cn(e,cn.DEFAULT_COLLECTION_PERCENTILE,cn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OC(t,e,n){const r=t.store(xr),s=t.store(Da),i=[],o=IDBKeyRange.only(n.batchId);let l=0;const c=r.ee({range:o},(f,h,m)=>(l++,m.delete()));i.push(c.next(()=>{ge(l===1,47070,{batchId:n.batchId})}));const d=[];for(const f of n.mutations){const h=NS(e,f.key.path,n.batchId);i.push(s.delete(h)),d.push(f.key)}return M.waitFor(i).next(()=>d)}function Ih(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw he(14731);e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */cn.DEFAULT_COLLECTION_PERCENTILE=10,cn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,cn.DEFAULT=new cn(DC,cn.DEFAULT_COLLECTION_PERCENTILE,cn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),cn.DISABLED=new cn(-1,0,0);class wf{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,n,r,s){ge(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new wf(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Vs(e).ee({index:Qi,range:r},(s,i,o)=>{n=!1,o.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=Jo(e),o=Vs(e);return o.add({}).next(l=>{ge(typeof l=="number",49019);const c=new iv(l,n,r,s),d=function(v,P,A){const C=A.baseMutations.map(_=>wh(v.yt,_)),y=A.mutations.map(_=>wh(v.yt,_));return{userId:P,batchId:A.batchId,localWriteTimeMs:A.localWriteTime.toMillis(),baseMutations:C,mutations:y}}(this.serializer,this.userId,c),f=[];let h=new it((m,v)=>Re(m.canonicalString(),v.canonicalString()));for(const m of s){const v=NS(this.userId,m.key.path,l);h=h.add(m.key.path.popLast()),f.push(o.put(d)),f.push(i.put(v,MO))}return h.forEach(m=>{f.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Xn[l]=c.keys()}),M.waitFor(f).next(()=>c)})}lookupMutationBatch(e,n){return Vs(e).get(n).next(r=>r?(ge(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:n}),Bi(this.serializer,r)):null)}er(e,n){return this.Xn[n]?M.resolve(this.Xn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Xn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Vs(e).ee({index:Qi,range:s},(o,l,c)=>{l.userId===this.userId&&(ge(l.batchId>=r,47524,{tr:r}),i=Bi(this.serializer,l)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Zi;return Vs(e).ee({index:Qi,range:n,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,Zi],[this.userId,Number.POSITIVE_INFINITY]);return Vs(e).J(Qi,n).next(r=>r.map(s=>Bi(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=Ed(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return Jo(e).ee({range:s},(o,l,c)=>{const[d,f,h]=o,m=qr(f);if(d===this.userId&&n.path.isEqual(m))return Vs(e).get(h).next(v=>{if(!v)throw he(61480,{nr:o,batchId:h});ge(v.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:v.userId,batchId:h}),i.push(Bi(this.serializer,v))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new it(Re);const s=[];return n.forEach(i=>{const o=Ed(this.userId,i.path),l=IDBKeyRange.lowerBound(o),c=Jo(e).ee({range:l},(d,f,h)=>{const[m,v,P]=d,A=qr(v);m===this.userId&&i.path.isEqual(A)?r=r.add(P):h.done()});s.push(c)}),M.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=Ed(this.userId,r),o=IDBKeyRange.lowerBound(i);let l=new it(Re);return Jo(e).ee({range:o},(c,d,f)=>{const[h,m,v]=c,P=qr(m);h===this.userId&&r.isPrefixOf(P)?P.length===s&&(l=l.add(v)):f.done()}).next(()=>this.rr(e,l))}rr(e,n){const r=[],s=[];return n.forEach(i=>{s.push(Vs(e).get(i).next(o=>{if(o===null)throw he(35274,{batchId:i});ge(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(Bi(this.serializer,o))}))}),M.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return OC(e.le,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.ir(n.batchId)}),M.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return M.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Jo(e).ee({range:r},(i,o,l)=>{if(i[0]===this.userId){const c=qr(i[1]);s.push(c)}else l.done()}).next(()=>{ge(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,n){return LC(e,this.userId,n)}_r(e){return VC(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:Zi,lastStreamToken:""})}}function LC(t,e,n){const r=Ed(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Jo(t).ee({range:i,X:!0},(l,c,d)=>{const[f,h,m]=l;f===e&&h===s&&(o=!0),d.done()}).next(()=>o)}function Vs(t){return Gt(t,xr)}function Jo(t){return Gt(t,Da)}function VC(t){return Gt(t,Lc)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new xo(0)}static cr(){return new xo(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hV{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.lr(e).next(n=>{const r=new xo(n.highestTargetId);return n.highestTargetId=r.next(),this.hr(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(n=>ve.fromTimestamp(new He(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.hr(e,s)))}addTargetData(e,n){return this.Pr(e,n).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(n,r),this.hr(e,r))))}updateTargetData(e,n){return this.Pr(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>$o(e).delete(n.targetId)).next(()=>this.lr(e)).next(r=>(ge(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return $o(e).ee((o,l)=>{const c=zl(l);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>M.waitFor(i)).next(()=>s)}forEachTarget(e,n){return $o(e).ee((r,s)=>{const i=zl(s);n(i)})}lr(e){return CE(e).get(mh).next(n=>(ge(n!==null,2888),n))}hr(e,n){return CE(e).put(mh,n)}Pr(e,n){return $o(e).put(RC(this.serializer,n))}Tr(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(n=>n.targetCount)}getTargetData(e,n){const r=go(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return $o(e).ee({range:s,index:RS},(o,l,c)=>{const d=zl(l);su(n,d.target)&&(i=d,c.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=Qs(e);return n.forEach(o=>{const l=pn(o.path);s.push(i.put({targetId:r,path:l})),s.push(this.referenceDelegate.addReference(e,r,o))}),M.waitFor(s)}removeMatchingKeys(e,n,r){const s=Qs(e);return M.forEach(n,i=>{const o=pn(i.path);return M.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=Qs(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=Qs(e);let i=Ve();return s.ee({range:r,X:!0},(o,l,c)=>{const d=qr(o[1]),f=new se(d);i=i.add(f)}).next(()=>i)}containsKey(e,n){const r=pn(n.path),s=IDBKeyRange.bound([r],[wS(r)],!1,!0);let i=0;return Qs(e).ee({index:Yy,X:!0,range:s},([o,l],c,d)=>{o!==0&&(i++,d.done())}).next(()=>i>0)}At(e,n){return $o(e).get(n).next(r=>r?zl(r):null)}}function $o(t){return Gt(t,Oa)}function CE(t){return Gt(t,eo)}function Qs(t){return Gt(t,La)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NE="LruGarbageCollector",fV=1048576;function AE([t,e],[n,r]){const s=Re(t,n);return s===0?Re(e,r):s}class pV{constructor(e){this.Ir=e,this.buffer=new it(AE),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();AE(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class MC{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){X(NE,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Ci(n)?X(NE,"Ignoring IndexedDB error during garbage collection: ",n):await Ro(n)}await this.Vr(3e5)})}}class mV{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return M.resolve(or.ce);const r=new pV(n);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(X("LruGarbageCollector","Garbage collection skipped; disabled"),M.resolve(SE)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(X("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),SE):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,i,o,l,c,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(X("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,l=Date.now(),this.removeTargets(e,r,n))).next(h=>(i=h,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(d=Date.now(),Qo()<=$e.DEBUG&&X("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${s} in `+(l-o)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${h} documents in `+(d-c)+`ms
Total Duration: ${d-f}ms`),M.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function FC(t,e){return new mV(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gV{constructor(e,n){this.db=e,this.garbageCollector=FC(this,n)}gr(e){const n=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}pr(e,n){return this.Sr(e,(r,s)=>n(s))}addReference(e,n,r){return Ku(e,r)}removeReference(e,n,r){return Ku(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Ku(e,n)}br(e,n){return function(s,i){let o=!1;return VC(s).te(l=>LC(s,l,i).next(c=>(c&&(o=!0),M.resolve(!c)))).next(()=>o)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,l)=>{if(l<=n){const c=this.br(e,o).next(d=>{if(!d)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ve.min()),Qs(e).delete(function(h){return[0,pn(h.path)]}(o))))});s.push(c)}}).next(()=>M.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Ku(e,n)}Sr(e,n){const r=Qs(e);let s,i=or.ce;return r.ee({index:Yy},([o,l],{path:c,sequenceNumber:d})=>{o===0?(i!==or.ce&&n(new se(qr(s)),i),i=d,s=c):i=or.ce}).next(()=>{i!==or.ce&&n(new se(qr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ku(t,e){return Qs(t).put(function(r,s){return{targetId:0,path:pn(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UC{constructor(){this.changes=new Ss(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Rt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?M.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yV{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return Oi(e).put(r)}removeEntry(e,n,r){return Oi(e).delete(function(i,o){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],Eh(o),l[l.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Dr(e,r)))}getEntry(e,n){let r=Rt.newInvalidDocument(n);return Oi(e).ee({index:bd,range:IDBKeyRange.only(Nl(n))},(s,i)=>{r=this.Cr(n,i)}).next(()=>r)}vr(e,n){let r={size:0,document:Rt.newInvalidDocument(n)};return Oi(e).ee({index:bd,range:IDBKeyRange.only(Nl(n))},(s,i)=>{r={document:this.Cr(n,i),size:Ih(i)}}).next(()=>r)}getEntries(e,n){let r=Hn();return this.Fr(e,n,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,n){let r=Hn(),s=new wt(se.comparator);return this.Fr(e,n,(i,o)=>{const l=this.Cr(i,o);r=r.insert(i,l),s=s.insert(i,Ih(o))}).next(()=>({documents:r,Or:s}))}Fr(e,n,r){if(n.isEmpty())return M.resolve();let s=new it(kE);n.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(Nl(s.first()),Nl(s.last())),o=s.getIterator();let l=o.getNext();return Oi(e).ee({index:bd,range:i},(c,d,f)=>{const h=se.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;l&&kE(l,h)<0;)r(l,null),l=o.getNext();l&&l.isEqual(h)&&(r(l,d),l=o.hasNext()?o.getNext():null),l?f.j(Nl(l)):f.done()}).next(()=>{for(;l;)r(l,null),l=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const o=n.path,l=[o.popLast().toArray(),o.lastSegment(),Eh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Oi(e).J(IDBKeyRange.bound(l,c,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let f=Hn();for(const h of d){const m=this.Cr(se.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);m.isFoundDocument()&&(ou(n,m)||s.has(m.key))&&(f=f.insert(m.key,m))}return f})}getAllFromCollectionGroup(e,n,r,s){let i=Hn();const o=PE(n,r),l=PE(n,Qn.max());return Oi(e).ee({index:AS,range:IDBKeyRange.bound(o,l,!0)},(c,d,f)=>{const h=this.Cr(se.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(h.key,h),i.size===s&&f.done()}).next(()=>i)}newChangeBuffer(e){return new vV(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return RE(e).get(ig).next(n=>(ge(!!n,20021),n))}Dr(e,n){return RE(e).put(ig,n)}Cr(e,n){if(n){const r=nV(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(ve.min())))return r}return Rt.newInvalidDocument(e)}}function $C(t){return new yV(t)}class vV extends UC{constructor(e,n){super(),this.Nr=e,this.trackRemovals=n,this.Br=new Ss(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new it((i,o)=>Re(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const l=this.Br.get(i);if(n.push(this.Nr.removeEntry(e,i,l.readTime)),o.isValidDocument()){const c=fE(this.Nr.serializer,o);s=s.add(i.path.popLast());const d=Ih(c);r+=d-l.size,n.push(this.Nr.addEntry(e,i,c))}else if(r-=l.size,this.trackRemovals){const c=fE(this.Nr.serializer,o.convertToNoDocument(ve.min()));n.push(this.Nr.addEntry(e,i,c))}}),s.forEach(i=>{n.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.Nr.updateMetadata(e,r)),M.waitFor(n)}getFromCache(e,n){return this.Nr.vr(e,n).next(r=>(this.Br.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Nr.Mr(e,n).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function RE(t){return Gt(t,Vc)}function Oi(t){return Gt(t,ph)}function Nl(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function PE(t,e){const n=e.documentKey.path.toArray();return[t,Eh(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function kE(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=Re(n[i],r[i]),s)return s;return s=Re(n.length,r.length),s||(s=Re(n[n.length-2],r[r.length-2]),s||Re(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _V{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&uc(r.mutation,s,kn.empty(),He.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ve()){const s=Hr();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let o=$l();return i.forEach((l,c)=>{o=o.insert(l,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=Hr();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ve()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,l)=>{n.set(o,l)})})}computeViews(e,n,r,s){let i=Hn();const o=cc(),l=function(){return cc()}();return n.forEach((c,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof Cs)?i=i.insert(d.key,d):f!==void 0?(o.set(d.key,f.mutation.getFieldMask()),uc(f.mutation,d,f.mutation.getFieldMask(),He.now())):o.set(d.key,kn.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,f)=>o.set(d,f)),n.forEach((d,f)=>l.set(d,new _V(f,o.get(d)??null))),l))}recalculateAndSaveOverlays(e,n){const r=cc();let s=new wt((o,l)=>o-l),i=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const l of o)l.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let f=r.get(c)||kn.empty();f=l.applyToLocalView(d,f),r.set(c,f);const h=(s.get(l.batchId)||Ve()).add(c);s=s.insert(l.batchId,h)})}).next(()=>{const o=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,f=c.value,h=oC();f.forEach(m=>{if(!i.has(m)){const v=fC(n.get(m),r.get(m));v!==null&&h.set(m,v),i=i.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,h))}return M.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return se.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):rv(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):M.resolve(Hr());let l=jc,c=i;return o.next(d=>M.forEach(d,(f,h)=>(l<h.largestBatchId&&(l=h.largestBatchId),i.get(f)?M.resolve():this.remoteDocumentCache.getEntry(e,f).next(m=>{c=c.insert(f,m)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,Ve())).next(f=>({batchId:l,changes:iC(f)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new se(n)).next(r=>{let s=$l();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let o=$l();return this.indexManager.getCollectionParents(e,i).next(l=>M.forEach(l,c=>{const d=function(h,m){return new Ai(m,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(f=>{f.forEach((h,m)=>{o=o.insert(h,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(o=>{i.forEach((c,d)=>{const f=d.getKey();o.get(f)===null&&(o=o.insert(f,Rt.newInvalidDocument(f)))});let l=$l();return o.forEach((c,d)=>{const f=i.get(c);f!==void 0&&uc(f.mutation,d,kn.empty(),He.now()),ou(n,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return M.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:In(s.createTime)}}(n)),M.resolve()}getNamedQuery(e,n){return M.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(s){return{name:s.name,query:PC(s.bundledQuery),readTime:In(s.readTime)}}(n)),M.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(){this.overlays=new wt(se.comparator),this.qr=new Map}getOverlay(e,n){return M.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Hr();return M.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.St(e,n,i)}),M.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),M.resolve()}getOverlaysForCollection(e,n,r){const s=Hr(),i=n.length+1,o=new se(n.child("")),l=this.overlays.getIteratorFrom(o);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return M.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new wt((d,f)=>d-f);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=Hr(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Hr(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>l.set(d,f)),!(l.size()>=s)););return M.resolve(l)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new av(n,r));let i=this.qr.get(n);i===void 0&&(i=Ve(),this.qr.set(n,i)),this.qr.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EV{constructor(){this.sessionToken=Bt.EMPTY_BYTE_STRING}getSessionToken(e){return M.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,M.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fv{constructor(){this.Qr=new it(Xt.$r),this.Ur=new it(Xt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new Xt(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new Xt(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new se(new Ye([])),r=new Xt(n,e),s=new Xt(n,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new se(new Ye([])),r=new Xt(n,e),s=new Xt(n,e+1);let i=Ve();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new Xt(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Xt{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return se.comparator(e.key,n.key)||Re(e.Yr,n.Yr)}static Kr(e,n){return Re(e.Yr,n.Yr)||se.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new it(Xt.$r)}checkEmpty(e){return M.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new iv(i,n,r,s);this.mutationQueue.push(o);for(const l of s)this.Zr=this.Zr.add(new Xt(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return M.resolve(o)}lookupMutationBatch(e,n){return M.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),i=s<0?0:s;return M.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return M.resolve(this.mutationQueue.length===0?Zi:this.tr-1)}getAllMutationBatches(e){return M.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Xt(n,0),s=new Xt(n,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const l=this.Xr(o.Yr);i.push(l)}),M.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new it(Re);return n.forEach(s=>{const i=new Xt(s,0),o=new Xt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],l=>{r=r.add(l.Yr)})}),M.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;se.isDocumentKey(i)||(i=i.child(""));const o=new Xt(new se(i),0);let l=new it(Re);return this.Zr.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.Yr)),!0)},o),M.resolve(this.ti(l))}ti(e){const n=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){ge(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return M.forEach(n.mutations,s=>{const i=new Xt(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new Xt(n,0),s=this.Zr.firstAfterOrEqual(r);return M.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,M.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IV{constructor(e){this.ri=e,this.docs=function(){return new wt(se.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return M.resolve(r?r.document.mutableCopy():Rt.newInvalidDocument(n))}getEntries(e,n){let r=Hn();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Rt.newInvalidDocument(s))}),M.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=Hn();const o=n.path,l=new se(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:f}}=c.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||Ky(IS(f),r)<=0||(s.has(f.key)||ou(n,f))&&(i=i.insert(f.key,f.mutableCopy()))}return M.resolve(i)}getAllFromCollectionGroup(e,n,r,s){he(9500)}ii(e,n){return M.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new TV(this)}getSize(e){return M.resolve(this.size)}}class TV extends UC{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),M.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SV{constructor(e){this.persistence=e,this.si=new Ss(n=>go(n),su),this.lastRemoteSnapshotVersion=ve.min(),this.highestTargetId=0,this.oi=0,this._i=new fv,this.targetCount=0,this.ai=xo.ur()}forEachTarget(e,n){return this.si.forEach((r,s)=>n(s)),M.resolve()}getLastRemoteSnapshotVersion(e){return M.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return M.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),M.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),M.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new xo(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,M.resolve()}updateTargetData(e,n){return this.Pr(n),M.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,M.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.si.forEach((o,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),M.waitFor(i).next(()=>s)}getTargetCount(e){return M.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return M.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),M.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),M.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),M.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return M.resolve(r)}containsKey(e,n){return M.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv{constructor(e,n){this.ui={},this.overlays={},this.ci=new or(0),this.li=!1,this.li=!0,this.hi=new EV,this.referenceDelegate=e(this),this.Pi=new SV(this),this.indexManager=new uV,this.remoteDocumentCache=function(s){return new IV(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new AC(n),this.Ii=new xV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new wV,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new bV(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){X("MemoryPersistence","Starting transaction:",e);const s=new CV(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,n){return M.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class CV extends SS{constructor(e){super(),this.currentSequenceNumber=e}}class Ef{constructor(e){this.persistence=e,this.Ri=new fv,this.Vi=null}static mi(e){return new Ef(e)}get fi(){if(this.Vi)return this.Vi;throw he(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),M.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),M.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),M.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return M.forEach(this.fi,r=>{const s=se.fromPath(r);return this.gi(e,s).next(i=>{i||n.removeEntry(s,ve.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return M.or([()=>M.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Th{constructor(e,n){this.persistence=e,this.pi=new Ss(r=>pn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=FC(this,n)}static mi(e,n){return new Th(e,n)}Ei(){}di(e){return M.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return M.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?M.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,n).next(l=>{l||(r++,i.removeEntry(o,ve.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),M.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),M.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),M.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),M.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Td(e.data.value)),n}br(e,n,r){return M.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return M.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NV{constructor(e){this.serializer=e}k(e,n,r,s){const i=new of("createOrUpgrade",n);r<1&&s>=1&&(function(c){c.createObjectStore(ru)}(e),function(c){c.createObjectStore(Lc,{keyPath:VO}),c.createObjectStore(xr,{keyPath:zw,autoIncrement:!0}).createIndex(Qi,qw,{unique:!0}),c.createObjectStore(Da)}(e),jE(e),function(c){c.createObjectStore(Ui)}(e));let o=M.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore(La),c.deleteObjectStore(Oa),c.deleteObjectStore(eo)}(e),jE(e)),o=o.next(()=>function(c){const d=c.store(eo),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ve.min().toTimestamp(),targetCount:0};return d.put(mh,f)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(c,d){return d.store(xr).J().next(h=>{c.deleteObjectStore(xr),c.createObjectStore(xr,{keyPath:zw,autoIncrement:!0}).createIndex(Qi,qw,{unique:!0});const m=d.store(xr),v=h.map(P=>m.put(P));return M.waitFor(v)})}(e,i))),o=o.next(()=>{(function(c){c.createObjectStore(Va,{keyPath:WO})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(c){c.createObjectStore(Vc)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(lf,{keyPath:GO})})(e),function(c){c.createObjectStore(cf,{keyPath:KO})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(c){const d=c.createObjectStore(uf,{keyPath:tL});d.createIndex(ag,nL,{unique:!1}),d.createIndex(jS,rL,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(c){const d=c.createObjectStore(ph,{keyPath:FO});d.createIndex(bd,UO),d.createIndex(AS,$O)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Ui))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(c){c.createObjectStore(Xy,{keyPath:QO,autoIncrement:!0}).createIndex(og,YO,{unique:!1}),c.createObjectStore(oc,{keyPath:XO}).createIndex(PS,JO,{unique:!1}),c.createObjectStore(ac,{keyPath:ZO}).createIndex(kS,eL,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{n.objectStore(oc).clear()}).next(()=>{n.objectStore(ac).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(Jy,{keyPath:sL})})(e)})),r<18&&s>=18&&TT()&&(o=o.next(()=>{n.objectStore(oc).clear()}).next(()=>{n.objectStore(ac).clear()})),o}wi(e){let n=0;return e.store(Ui).ee((r,s)=>{n+=Ih(s)}).next(()=>{const r={byteSize:n};return e.store(Vc).put(ig,r)})}yi(e){const n=e.store(Lc),r=e.store(xr);return n.J().next(s=>M.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,Zi],[i.userId,i.lastAcknowledgedBatchId]);return r.J(Qi,o).next(l=>M.forEach(l,c=>{ge(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const d=Bi(this.serializer,c);return OC(e,i.userId,d).next(()=>{})}))}))}Si(e){const n=e.store(La),r=e.store(Ui);return e.store(eo).get(mh).next(s=>{const i=[];return r.ee((o,l)=>{const c=new Ye(o),d=function(h){return[0,pn(h)]}(c);i.push(n.get(d).next(f=>f?M.resolve():(h=>n.put({targetId:0,path:pn(h),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>M.waitFor(i))})}bi(e,n){e.createObjectStore(Mc,{keyPath:HO});const r=n.store(Mc),s=new hv,i=o=>{if(s.add(o)){const l=o.lastSegment(),c=o.popLast();return r.put({collectionId:l,parent:pn(c)})}};return n.store(Ui).ee({X:!0},(o,l)=>{const c=new Ye(o);return i(c.popLast())}).next(()=>n.store(Da).ee({X:!0},([o,l,c],d)=>{const f=qr(l);return i(f.popLast())}))}Di(e){const n=e.store(Oa);return n.ee((r,s)=>{const i=zl(s),o=RC(this.serializer,i);return n.put(o)})}Ci(e,n){const r=n.store(Ui),s=[];return r.ee((i,o)=>{const l=n.store(ph),c=function(h){return h.document?new se(Ye.fromString(h.document.name).popFirst(5)):h.noDocument?se.fromSegments(h.noDocument.path):h.unknownDocument?se.fromSegments(h.unknownDocument.path):he(36783)}(o).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(l.put(d))}).next(()=>M.waitFor(s))}Fi(e,n){const r=n.store(xr),s=$C(this.serializer),i=new pv(Ef.mi,this.serializer.yt);return r.J().next(o=>{const l=new Map;return o.forEach(c=>{let d=l.get(c.userId)??Ve();Bi(this.serializer,c).keys().forEach(f=>d=d.add(f)),l.set(c.userId,d)}),M.forEach(l,(c,d)=>{const f=new tn(d),h=xf.wt(this.serializer,f),m=i.getIndexManager(f),v=wf.wt(f,this.serializer,m,i.referenceDelegate);return new BC(s,v,h,m).recalculateAndSaveOverlaysForDocumentKeys(new lg(n,or.ce),c).next()})})}}function jE(t){t.createObjectStore(La,{keyPath:zO}).createIndex(Yy,qO,{unique:!0}),t.createObjectStore(Oa,{keyPath:"targetId"}).createIndex(RS,BO,{unique:!0}),t.createObjectStore(eo)}const Ms="IndexedDbPersistence",kp=18e5,jp=5e3,Dp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",AV="main";class mv{constructor(e,n,r,s,i,o,l,c,d,f,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Mi=i,this.window=o,this.document=l,this.xi=d,this.Oi=f,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=m=>Promise.resolve(),!mv.v())throw new Z(q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new gV(this,s),this.$i=n+AV,this.serializer=new AC(c),this.Ui=new hi(this.$i,this.Ni,new NV(this.serializer)),this.hi=new sV,this.Pi=new hV(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$C(this.serializer),this.Ii=new rV,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&_n(Ms,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Z(q.FAILED_PRECONDITION,Dp);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new or(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Qu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(n=>{n||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(n=>this.isPrimary&&!n?this.Zi(e).next(()=>!1):!!n&&this.Xi(e).next(()=>!0))).catch(e=>{if(Ci(e))return X(Ms,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return X(Ms,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Al(e).get(Lo).next(n=>M.resolve(this.es(n)))}ts(e){return Qu(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,kp)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=Gt(n,Va);return r.J().next(s=>{const i=this.ss(s,kp),o=s.filter(l=>i.indexOf(l)===-1);return M.forEach(o,l=>r.delete(l.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const n of e)this.Ki.removeItem(this._s(n.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?M.resolve(!0):Al(e).get(Lo).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,jp)&&!this.us(n.ownerId)){if(this.es(n)&&this.networkEnabled)return!0;if(!this.es(n)){if(!n.allowTabSynchronization)throw new Z(q.FAILED_PRECONDITION,Dp);return!1}}return!(!this.networkEnabled||!this.inForeground)||Qu(e).J().next(r=>this.ss(r,jp).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,l=this.networkEnabled===s.networkEnabled;if(i||o&&l)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&X(Ms,`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[ru,Va],e=>{const n=new lg(e,or.ce);return this.Zi(n).next(()=>this.ts(n))}),this.Ui.close(),this.Ps()}ss(e,n){return e.filter(r=>this.rs(r.updateTimeMs,n)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Qu(e).J().next(n=>this.ss(n,kp).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,n){return wf.wt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new dV(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return xf.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,n,r){X(Ms,"Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(c){return c===18?aL:c===17?VS:c===16?oL:c===15?Zy:c===14?LS:c===13?OS:c===12?iL:c===11?DS:void he(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,l=>(o=new lg(l,this.ci?this.ci.next():or.ce),n==="readwrite-primary"?this.Hi(o).next(c=>!!c||this.Yi(o)).next(c=>{if(!c)throw _n(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new Z(q.FAILED_PRECONDITION,TS);return r(o)}).next(c=>this.Xi(o).next(()=>c)):this.Is(o).next(()=>r(o)))).then(l=>(o.raiseOnCommittedEvent(),l))}Is(e){return Al(e).get(Lo).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,jp)&&!this.us(n.ownerId)&&!this.es(n)&&!(this.Oi||this.allowTabSynchronization&&n.allowTabSynchronization))throw new Z(q.FAILED_PRECONDITION,Dp)})}Xi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Al(e).put(Lo,n)}static v(){return hi.v()}Zi(e){const n=Al(e);return n.get(Lo).next(r=>this.es(r)?(X(Ms,"Releasing primary lease."),n.delete(Lo)):M.resolve())}rs(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(_n(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const n=/(?:Version|Mobile)\/1[456]/;IT()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var n;try{const r=((n=this.Ki)==null?void 0:n.getItem(this._s(e)))!==null;return X(Ms,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return _n(Ms,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){_n("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Al(t){return Gt(t,ru)}function Qu(t){return Gt(t,Va)}function RV(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=Ve(),s=Ve();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new gv(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return IT()?8:CS(Wt())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.ys(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new PV;return this.Ss(e,n,o).next(l=>{if(i.result=l,this.Vs)return this.bs(e,n,o,l.size)})}).next(()=>i.result)}bs(e,n,r,s){return r.documentReadCount<this.fs?(Qo()<=$e.DEBUG&&X("QueryEngine","SDK will not create cache indexes for query:",Yo(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),M.resolve()):(Qo()<=$e.DEBUG&&X("QueryEngine","Query:",Yo(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Qo()<=$e.DEBUG&&X("QueryEngine","The SDK decides to create cache indexes for query:",Yo(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,lr(n))):M.resolve())}ys(e,n){if(rE(n))return M.resolve(null);let r=lr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=_h(n,null,"F"),r=lr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ve(...i);return this.ps.getDocuments(e,o).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.Ds(n,l);return this.Cs(n,d,o,c.readTime)?this.ys(e,_h(n,null,"F")):this.vs(e,d,n,c)}))})))}ws(e,n,r,s){return rE(n)||s.isEqual(ve.min())?M.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(n,i);return this.Cs(n,o,r,s)?M.resolve(null):(Qo()<=$e.DEBUG&&X("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Yo(n)),this.vs(e,o,n,RO(s,jc)).next(l=>l))})}Ds(e,n){let r=new it(rC(e));return n.forEach((s,i)=>{ou(e,i)&&(r=r.add(i))}),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,n,r){return Qo()<=$e.DEBUG&&X("QueryEngine","Using full collection scan to execute query:",Yo(n)),this.ps.getDocumentsMatchingQuery(e,n,Qn.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yv="LocalStore",kV=3e8;class jV{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new wt(Re),this.xs=new Ss(i=>go(i),su),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new BC(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function qC(t,e,n,r){return new jV(t,e,n,r)}async function HC(t,e){const n=Se(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],l=[];let c=Ve();for(const d of s){o.push(d.batchId);for(const f of d.mutations)c=c.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)c=c.add(f.key)}return n.localDocuments.getDocuments(r,c).next(d=>({Ls:d,removedBatchIds:o,addedBatchIds:l}))})})}function DV(t,e){const n=Se(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(l,c,d,f){const h=d.batch,m=h.keys();let v=M.resolve();return m.forEach(P=>{v=v.next(()=>f.getEntry(c,P)).next(A=>{const C=d.docVersions.get(P);ge(C!==null,48541),A.version.compareTo(C)<0&&(h.applyToRemoteDocument(A,d),A.isValidDocument()&&(A.setReadTime(d.commitVersion),f.addEntry(A)))})}),v.next(()=>l.mutationQueue.removeMutationBatch(c,h))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=Ve();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function WC(t){const e=Se(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function OV(t,e){const n=Se(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const l=[];e.targetChanges.forEach((f,h)=>{const m=s.get(h);if(!m)return;l.push(n.Pi.removeMatchingKeys(i,f.removedDocuments,h).next(()=>n.Pi.addMatchingKeys(i,f.addedDocuments,h)));let v=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?v=v.withResumeToken(Bt.EMPTY_BYTE_STRING,ve.min()).withLastLimboFreeSnapshotVersion(ve.min()):f.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(f.resumeToken,r)),s=s.insert(h,v),function(A,C,y){return A.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-A.snapshotVersion.toMicroseconds()>=kV?!0:y.addedDocuments.size+y.modifiedDocuments.size+y.removedDocuments.size>0}(m,v,f)&&l.push(n.Pi.updateTargetData(i,v))});let c=Hn(),d=Ve();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,f))}),l.push(LV(i,o,e.documentUpdates).next(f=>{c=f.ks,d=f.qs})),!r.isEqual(ve.min())){const f=n.Pi.getLastRemoteSnapshotVersion(i).next(h=>n.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(f)}return M.waitFor(l).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(n.Ms=s,i))}function LV(t,e,n){let r=Ve(),s=Ve();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let o=Hn();return n.forEach((l,c)=>{const d=i.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(ve.min())?(e.removeEntry(l,c.readTime),o=o.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),o=o.insert(l,c)):X(yv,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{ks:o,qs:s}})}function VV(t,e){const n=Se(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Zi),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function MV(t,e){const n=Se(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Pi.getTargetData(r,e).next(i=>i?(s=i,M.resolve(s)):n.Pi.allocateTargetId(r).next(o=>(s=new ds(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r})}async function Eg(t,e,n){const r=Se(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ci(o))throw o;X(yv,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function DE(t,e,n){const r=Se(t);let s=ve.min(),i=Ve();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,d,f){const h=Se(c),m=h.xs.get(f);return m!==void 0?M.resolve(h.Ms.get(m)):h.Pi.getTargetData(d,f)}(r,o,lr(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,l.targetId).next(c=>{i=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,n?s:ve.min(),n?i:Ve())).next(l=>(FV(r,bL(e),l),{documents:l,Qs:i})))}function FV(t,e,n){let r=t.Os.get(e)||ve.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.Os.set(e,r)}class OE{constructor(){this.activeTargetIds=AL()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class GC{constructor(){this.Mo=new OE,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new OE,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UV{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LE="ConnectivityMonitor";class VE{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){X(LE,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){X(LE,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yu=null;function bg(){return Yu===null?Yu=function(){return 268435456+Math.round(2147483648*Math.random())}():Yu++,"0x"+Yu.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Op="RestConnection",$V={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class BV{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===gh?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,i){const o=bg(),l=this.zo(e,n.toUriEncodedString());X(Op,`Sending RPC '${e}' ${o}:`,l,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:d}=new URL(l),f=Ii(d);return this.Jo(e,l,c,r,f).then(h=>(X(Op,`Received RPC '${e}' ${o}: `,h),h),h=>{throw fo(Op,`RPC '${e}' ${o} failed with error: `,h,"url: ",l,"request:",r),h})}Ho(e,n,r,s,i,o){return this.Go(e,n,r,s,i)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+tl}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,n){const r=$V[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zV{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ln="WebChannelConnection";class qV extends BV{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,i){const o=bg();return new Promise((l,c)=>{const d=new pS;d.setWithCredentials(!0),d.listenOnce(mS.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case xd.NO_ERROR:const h=d.getResponseJson();X(ln,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),l(h);break;case xd.TIMEOUT:X(ln,`RPC '${e}' ${o} timed out`),c(new Z(q.DEADLINE_EXCEEDED,"Request time out"));break;case xd.HTTP_ERROR:const m=d.getStatus();if(X(ln,`RPC '${e}' ${o} failed with status:`,m,"response text:",d.getResponseText()),m>0){let v=d.getResponseJson();Array.isArray(v)&&(v=v[0]);const P=v==null?void 0:v.error;if(P&&P.status&&P.message){const A=function(y){const _=y.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(_)>=0?_:q.UNKNOWN}(P.status);c(new Z(A,P.message))}else c(new Z(q.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new Z(q.UNAVAILABLE,"Connection failed."));break;default:he(9055,{l_:e,streamId:o,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{X(ln,`RPC '${e}' ${o} completed.`)}});const f=JSON.stringify(s);X(ln,`RPC '${e}' ${o} sending request:`,s),d.send(n,"POST",f,r,15)})}T_(e,n,r){const s=bg(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=vS(),l=yS(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const f=i.join("");X(ln,`Creating RPC '${e}' stream ${s}: ${f}`,c);const h=o.createWebChannel(f,c);this.I_(h);let m=!1,v=!1;const P=new zV({Yo:C=>{v?X(ln,`Not sending because RPC '${e}' stream ${s} is closed:`,C):(m||(X(ln,`Opening RPC '${e}' stream ${s} transport.`),h.open(),m=!0),X(ln,`RPC '${e}' stream ${s} sending:`,C),h.send(C))},Zo:()=>h.close()}),A=(C,y,_)=>{C.listen(y,w=>{try{_(w)}catch(T){setTimeout(()=>{throw T},0)}})};return A(h,Ul.EventType.OPEN,()=>{v||(X(ln,`RPC '${e}' stream ${s} transport opened.`),P.o_())}),A(h,Ul.EventType.CLOSE,()=>{v||(v=!0,X(ln,`RPC '${e}' stream ${s} transport closed`),P.a_(),this.E_(h))}),A(h,Ul.EventType.ERROR,C=>{v||(v=!0,fo(ln,`RPC '${e}' stream ${s} transport errored. Name:`,C.name,"Message:",C.message),P.a_(new Z(q.UNAVAILABLE,"The operation could not be completed")))}),A(h,Ul.EventType.MESSAGE,C=>{var y;if(!v){const _=C.data[0];ge(!!_,16349);const w=_,T=(w==null?void 0:w.error)||((y=w[0])==null?void 0:y.error);if(T){X(ln,`RPC '${e}' stream ${s} received error:`,T);const V=T.status;let U=function(x){const S=Ft[x];if(S!==void 0)return gC(S)}(V),b=T.message;U===void 0&&(U=q.INTERNAL,b="Unknown error status: "+V+" with message "+T.message),v=!0,P.a_(new Z(U,b)),h.close()}else X(ln,`RPC '${e}' stream ${s} received:`,_),P.u_(_)}}),A(l,gS.STAT_EVENT,C=>{C.stat===ng.PROXY?X(ln,`RPC '${e}' stream ${s} detected buffering proxy`):C.stat===ng.NOPROXY&&X(ln,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{P.__()},0),P}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HV(){return typeof window<"u"?window:null}function Rd(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bf(t){return new HL(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(e,n,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&X("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ME="PersistentStream";class QC{constructor(e,n,r,s,i,o,l,c){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new KC(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===q.RESOURCE_EXHAUSTED?(_n(n.toString()),_n("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===n&&this.G_(r,s)},r=>{e(()=>{const s=new Z(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return X(ME,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(X(ME,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class WV extends QC{constructor(e,n,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=KL(this.serializer,e),r=function(i){if(!("targetChange"in i))return ve.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ve.min():o.readTime?In(o.readTime):ve.min()}(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=yg(this.serializer),n.addTarget=function(i,o){let l;const c=o.target;if(l=yh(c)?{documents:IC(i,c)}:{query:uv(i,c).ft},l.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){l.resumeToken=_C(i,o.resumeToken);const d=mg(i,o.expectedCount);d!==null&&(l.expectedCount=d)}else if(o.snapshotVersion.compareTo(ve.min())>0){l.readTime=qa(i,o.snapshotVersion.toTimestamp());const d=mg(i,o.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=XL(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=yg(this.serializer),n.removeTarget=e,this.q_(n)}}class GV extends QC{constructor(e,n,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return ge(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ge(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ge(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=QL(e.writeResults,e.commitTime),r=In(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=yg(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>wh(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KV{}class QV extends KV{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new Z(q.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,gg(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new Z(q.UNKNOWN,i.toString())})}Ho(e,n,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,l])=>this.connection.Ho(e,gg(n,r),s,o,l,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Z(q.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class YV{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(_n(n),this.aa=!1):X("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wo="RemoteStore";class XV{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{Po(this)&&(X(wo,"Restarting streams for network reachability change."),await async function(c){const d=Se(c);d.Ea.add(4),await lu(d),d.Ra.set("Unknown"),d.Ea.delete(4),await If(d)}(this))})}),this.Ra=new YV(r,s)}}async function If(t){if(Po(t))for(const e of t.da)await e(!0)}async function lu(t){for(const e of t.da)await e(!1)}function YC(t,e){const n=Se(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),wv(n)?xv(n):rl(n).O_()&&_v(n,e))}function vv(t,e){const n=Se(t),r=rl(n);n.Ia.delete(e),r.O_()&&XC(n,e),n.Ia.size===0&&(r.O_()?r.L_():Po(n)&&n.Ra.set("Unknown"))}function _v(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ve.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}rl(t).Y_(e)}function XC(t,e){t.Va.Ue(e),rl(t).Z_(e)}function xv(t){t.Va=new $L({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),rl(t).start(),t.Ra.ua()}function wv(t){return Po(t)&&!rl(t).x_()&&t.Ia.size>0}function Po(t){return Se(t).Ea.size===0}function JC(t){t.Va=void 0}async function JV(t){t.Ra.set("Online")}async function ZV(t){t.Ia.forEach((e,n)=>{_v(t,e)})}async function eM(t,e){JC(t),wv(t)?(t.Ra.ha(e),xv(t)):t.Ra.set("Unknown")}async function tM(t,e,n){if(t.Ra.set("Online"),e instanceof vC&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,o),s.Ia.delete(l),s.Va.removeTarget(l))}(t,e)}catch(r){X(wo,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Sh(t,r)}else if(e instanceof Nd?t.Va.Ze(e):e instanceof yC?t.Va.st(e):t.Va.tt(e),!n.isEqual(ve.min()))try{const r=await WC(t.localStore);n.compareTo(r)>=0&&await function(i,o){const l=i.Va.Tt(o);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(c.resumeToken,o))}}),l.targetMismatches.forEach((c,d)=>{const f=i.Ia.get(c);if(!f)return;i.Ia.set(c,f.withResumeToken(Bt.EMPTY_BYTE_STRING,f.snapshotVersion)),XC(i,c);const h=new ds(f.target,c,d,f.sequenceNumber);_v(i,h)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){X(wo,"Failed to raise snapshot:",r),await Sh(t,r)}}async function Sh(t,e,n){if(!Ci(e))throw e;t.Ea.add(1),await lu(t),t.Ra.set("Offline"),n||(n=()=>WC(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{X(wo,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await If(t)})}function ZC(t,e){return e().catch(n=>Sh(t,n,e))}async function cu(t){const e=Se(t),n=_i(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Zi;for(;nM(e);)try{const s=await VV(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,rM(e,s)}catch(s){await Sh(e,s)}eN(e)&&tN(e)}function nM(t){return Po(t)&&t.Ta.length<10}function rM(t,e){t.Ta.push(e);const n=_i(t);n.O_()&&n.X_&&n.ea(e.mutations)}function eN(t){return Po(t)&&!_i(t).x_()&&t.Ta.length>0}function tN(t){_i(t).start()}async function sM(t){_i(t).ra()}async function iM(t){const e=_i(t);for(const n of t.Ta)e.ea(n.mutations)}async function oM(t,e,n){const r=t.Ta.shift(),s=ov.from(r,e,n);await ZC(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await cu(t)}async function aM(t,e){e&&_i(t).X_&&await async function(r,s){if(function(o){return ML(o)&&o!==q.ABORTED}(s.code)){const i=r.Ta.shift();_i(r).B_(),await ZC(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await cu(r)}}(t,e),eN(t)&&tN(t)}async function FE(t,e){const n=Se(t);n.asyncQueue.verifyOperationInProgress(),X(wo,"RemoteStore received new credentials");const r=Po(n);n.Ea.add(3),await lu(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await If(n)}async function lM(t,e){const n=Se(t);e?(n.Ea.delete(2),await If(n)):e||(n.Ea.add(2),await lu(n),n.Ra.set("Unknown"))}function rl(t){return t.ma||(t.ma=function(n,r,s){const i=Se(n);return i.sa(),new WV(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:JV.bind(null,t),t_:ZV.bind(null,t),r_:eM.bind(null,t),H_:tM.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),wv(t)?xv(t):t.Ra.set("Unknown")):(await t.ma.stop(),JC(t))})),t.ma}function _i(t){return t.fa||(t.fa=function(n,r,s){const i=Se(n);return i.sa(),new GV(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:sM.bind(null,t),r_:aM.bind(null,t),ta:iM.bind(null,t),na:oM.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await cu(t)):(await t.fa.stop(),t.Ta.length>0&&(X(wo,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Tr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const o=Date.now()+r,l=new Ev(e,n,o,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Z(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function bv(t,e){if(_n("AsyncQueue",`${e}: ${t}`),Ci(t))return new Z(q.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{static emptySet(e){return new Ea(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||se.comparator(n.key,r.key):(n,r)=>se.comparator(n.key,r.key),this.keyedMap=$l(),this.sortedSet=new wt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Ea)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Ea;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UE{constructor(){this.ga=new wt(se.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):he(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class Ha{constructor(e,n,r,s,i,o,l,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const o=[];return n.forEach(l=>{o.push({type:0,doc:l})}),new Ha(e,n,Ea.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&pf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cM{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class uM{constructor(){this.queries=$E(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=Se(n),i=s.queries;s.queries=$E(),i.forEach((o,l)=>{for(const c of l.Sa)c.onError(r)})})(this,new Z(q.ABORTED,"Firestore shutting down"))}}function $E(){return new Ss(t=>nC(t),pf)}async function Iv(t,e){const n=Se(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new cM,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const l=bv(o,`Initialization of query '${Yo(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&Sv(n)}async function Tv(t,e){const n=Se(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function dM(t,e){const n=Se(t);let r=!1;for(const s of e){const i=s.query,o=n.queries.get(i);if(o){for(const l of o.Sa)l.Fa(s)&&(r=!0);o.wa=s}}r&&Sv(n)}function hM(t,e,n){const r=Se(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function Sv(t){t.Ca.forEach(e=>{e.next()})}var Ig,BE;(BE=Ig||(Ig={})).Ma="default",BE.Cache="cache";class Cv{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Ha(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Ha.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ig.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nN{constructor(e){this.key=e}}class rN{constructor(e){this.key=e}}class fM{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ve(),this.mutatedKeys=Ve(),this.eu=rC(e),this.tu=new Ea(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new UE,s=n?n.tu:this.tu;let i=n?n.mutatedKeys:this.mutatedKeys,o=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((f,h)=>{const m=s.get(f),v=ou(this.query,h)?h:null,P=!!m&&this.mutatedKeys.has(m.key),A=!!v&&(v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations);let C=!1;m&&v?m.data.isEqual(v.data)?P!==A&&(r.track({type:3,doc:v}),C=!0):this.su(m,v)||(r.track({type:2,doc:v}),C=!0,(c&&this.eu(v,c)>0||d&&this.eu(v,d)<0)&&(l=!0)):!m&&v?(r.track({type:0,doc:v}),C=!0):m&&!v&&(r.track({type:1,doc:m}),C=!0,(c||d)&&(l=!0)),C&&(v?(o=o.add(v),i=A?i.add(f):i.delete(f)):(o=o.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:o,iu:r,Cs:l,mutatedKeys:i}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((f,h)=>function(v,P){const A=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return he(20277,{Rt:C})}};return A(v)-A(P)}(f.type,h.type)||this.eu(f.doc,h.doc)),this.ou(r),s=s??!1;const l=n&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,d=c!==this.Za;return this.Za=c,o.length!==0||d?{snapshot:new Ha(this.query,e.tu,i,o,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new UE,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ve(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const n=[];return e.forEach(r=>{this.Xa.has(r)||n.push(new rN(r))}),this.Xa.forEach(r=>{e.has(r)||n.push(new nN(r))}),n}cu(e){this.Ya=e.Qs,this.Xa=Ve();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Ha.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Nv="SyncEngine";class pM{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class mM{constructor(e){this.key=e,this.hu=!1}}class gM{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new Ss(l=>nC(l),pf),this.Iu=new Map,this.Eu=new Set,this.du=new wt(se.comparator),this.Au=new Map,this.Ru=new fv,this.Vu={},this.mu=new Map,this.fu=xo.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function yM(t,e,n=!0){const r=cN(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await sN(r,e,n,!0),s}async function vM(t,e){const n=cN(t);await sN(n,e,!0,!1)}async function sN(t,e,n,r){const s=await MV(t.localStore,lr(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await _M(t,e,i,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&YC(t.remoteStore,s),l}async function _M(t,e,n,r,s){t.pu=(h,m,v)=>async function(A,C,y,_){let w=C.view.ru(y);w.Cs&&(w=await DE(A.localStore,C.query,!1).then(({documents:b})=>C.view.ru(b,w)));const T=_&&_.targetChanges.get(C.targetId),V=_&&_.targetMismatches.get(C.targetId)!=null,U=C.view.applyChanges(w,A.isPrimaryClient,T,V);return qE(A,C.targetId,U.au),U.snapshot}(t,h,m,v);const i=await DE(t.localStore,e,!0),o=new fM(e,i.Qs),l=o.ru(i.documents),c=au.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=o.applyChanges(l,t.isPrimaryClient,c);qE(t,n,d.au);const f=new pM(e,n,o);return t.Tu.set(e,f),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),d.snapshot}async function xM(t,e,n){const r=Se(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!pf(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Eg(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&vv(r.remoteStore,s.targetId),Tg(r,s.targetId)}).catch(Ro)):(Tg(r,s.targetId),await Eg(r.localStore,s.targetId,!0))}async function wM(t,e){const n=Se(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),vv(n.remoteStore,r.targetId))}async function EM(t,e,n){const r=uN(t);try{const s=await function(o,l){const c=Se(o),d=He.now(),f=l.reduce((v,P)=>v.add(P.key),Ve());let h,m;return c.persistence.runTransaction("Locally write mutations","readwrite",v=>{let P=Hn(),A=Ve();return c.Ns.getEntries(v,f).next(C=>{P=C,P.forEach((y,_)=>{_.isValidDocument()||(A=A.add(y))})}).next(()=>c.localDocuments.getOverlayedDocuments(v,P)).next(C=>{h=C;const y=[];for(const _ of l){const w=OL(_,h.get(_.key).overlayedDocument);w!=null&&y.push(new Cs(_.key,w,GS(w.value.mapValue),hn.exists(!0)))}return c.mutationQueue.addMutationBatch(v,d,y,l)}).next(C=>{m=C;const y=C.applyToLocalDocumentSet(h,A);return c.documentOverlayCache.saveOverlays(v,C.batchId,y)})}).then(()=>({batchId:m.batchId,changes:iC(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,l,c){let d=o.Vu[o.currentUser.toKey()];d||(d=new wt(Re)),d=d.insert(l,c),o.Vu[o.currentUser.toKey()]=d}(r,s.batchId,n),await uu(r,s.changes),await cu(r.remoteStore)}catch(s){const i=bv(s,"Failed to persist write");n.reject(i)}}async function iN(t,e){const n=Se(t);try{const r=await OV(n.localStore,e);e.targetChanges.forEach((s,i)=>{const o=n.Au.get(i);o&&(ge(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?ge(o.hu,14607):s.removedDocuments.size>0&&(ge(o.hu,42227),o.hu=!1))}),await uu(n,r,e)}catch(r){await Ro(r)}}function zE(t,e,n){const r=Se(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach((i,o)=>{const l=o.view.va(e);l.snapshot&&s.push(l.snapshot)}),function(o,l){const c=Se(o);c.onlineState=l;let d=!1;c.queries.forEach((f,h)=>{for(const m of h.Sa)m.va(l)&&(d=!0)}),d&&Sv(c)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function bM(t,e,n){const r=Se(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new wt(se.comparator);o=o.insert(i,Rt.newNoDocument(i,ve.min()));const l=Ve().add(i),c=new _f(ve.min(),new Map,new wt(Re),o,l);await iN(r,c),r.du=r.du.remove(i),r.Au.delete(e),Av(r)}else await Eg(r.localStore,e,!1).then(()=>Tg(r,e,n)).catch(Ro)}async function IM(t,e){const n=Se(t),r=e.batch.batchId;try{const s=await DV(n.localStore,e);aN(n,r,null),oN(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await uu(n,s)}catch(s){await Ro(s)}}async function TM(t,e,n){const r=Se(t);try{const s=await function(o,l){const c=Se(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,l).next(h=>(ge(h!==null,37113),f=h.keys(),c.mutationQueue.removeMutationBatch(d,h))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(r.localStore,e);aN(r,e,n),oN(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await uu(r,s)}catch(s){await Ro(s)}}function oN(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function aN(t,e,n){const r=Se(t);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Tg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(r=>{t.Ru.containsKey(r)||lN(t,r)})}function lN(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(vv(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Av(t))}function qE(t,e,n){for(const r of n)r instanceof nN?(t.Ru.addReference(r.key,e),SM(t,r)):r instanceof rN?(X(Nv,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||lN(t,r.key)):he(19791,{wu:r})}function SM(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(X(Nv,"New document in limbo: "+n),t.Eu.add(r),Av(t))}function Av(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new se(Ye.fromString(e)),r=t.fu.next();t.Au.set(r,new mM(n)),t.du=t.du.insert(n,r),YC(t.remoteStore,new ds(lr(iu(n.path)),r,"TargetPurposeLimboResolution",or.ce))}}async function uu(t,e,n){const r=Se(t),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((l,c)=>{o.push(r.pu(c,e,n).then(d=>{var f;if((d||n)&&r.isPrimaryClient){const h=d?!d.fromCache:(f=n==null?void 0:n.targetChanges.get(c.targetId))==null?void 0:f.current;r.sharedClientState.updateQueryState(c.targetId,h?"current":"not-current")}if(d){s.push(d);const h=gv.As(c.targetId,d);i.push(h)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(c,d){const f=Se(c);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>M.forEach(d,m=>M.forEach(m.Es,v=>f.persistence.referenceDelegate.addReference(h,m.targetId,v)).next(()=>M.forEach(m.ds,v=>f.persistence.referenceDelegate.removeReference(h,m.targetId,v)))))}catch(h){if(!Ci(h))throw h;X(yv,"Failed to update sequence numbers: "+h)}for(const h of d){const m=h.targetId;if(!h.fromCache){const v=f.Ms.get(m),P=v.snapshotVersion,A=v.withLastLimboFreeSnapshotVersion(P);f.Ms=f.Ms.insert(m,A)}}}(r.localStore,i))}async function CM(t,e){const n=Se(t);if(!n.currentUser.isEqual(e)){X(Nv,"User change. New user:",e.toKey());const r=await HC(n.localStore,e);n.currentUser=e,function(i,o){i.mu.forEach(l=>{l.forEach(c=>{c.reject(new Z(q.CANCELLED,o))})}),i.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await uu(n,r.Ls)}}function NM(t,e){const n=Se(t),r=n.Au.get(e);if(r&&r.hu)return Ve().add(r.key);{let s=Ve();const i=n.Iu.get(e);if(!i)return s;for(const o of i){const l=n.Tu.get(o);s=s.unionWith(l.view.nu)}return s}}function cN(t){const e=Se(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=iN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=NM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bM.bind(null,e),e.Pu.H_=dM.bind(null,e.eventManager),e.Pu.yu=hM.bind(null,e.eventManager),e}function uN(t){const e=Se(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=IM.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=TM.bind(null,e),e}class zc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=bf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return qC(this.persistence,new zC,e.initialUser,this.serializer)}Cu(e){return new pv(Ef.mi,this.serializer)}Du(e){return new GC}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}zc.provider={build:()=>new zc};class AM extends zc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){ge(this.persistence.referenceDelegate instanceof Th,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new MC(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?cn.withCacheSize(this.cacheSizeBytes):cn.DEFAULT;return new pv(r=>Th.mi(r,n),this.serializer)}}class RM extends zc{constructor(e,n,r){super(),this.xu=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await uN(this.xu.syncEngine),await cu(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return qC(this.persistence,new zC,e.initialUser,this.serializer)}Fu(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new MC(r,e.asyncQueue,n)}Mu(e,n){const r=new DO(n,this.persistence);return new jO(e.asyncQueue,r)}Cu(e){const n=RV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?cn.withCacheSize(this.cacheSizeBytes):cn.DEFAULT;return new mv(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,HV(),Rd(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new GC}}class Ch{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>zE(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=CM.bind(null,this.syncEngine),await lM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new uM}()}createDatastore(e){const n=bf(e.databaseInfo.databaseId),r=function(i){return new qV(i)}(e.databaseInfo);return function(i,o,l,c){return new QV(i,o,l,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,o,l){return new XV(r,s,i,o,l)}(this.localStore,this.datastore,e.asyncQueue,n=>zE(this.syncEngine,n,0),function(){return VE.v()?new VE:new UV}())}createSyncEngine(e,n){return function(s,i,o,l,c,d,f){const h=new gM(s,i,o,l,c,d);return f&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=Se(s);X(wo,"RemoteStore shutting down."),i.Ea.add(5),await lu(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}Ch.provider={build:()=>new Ch};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):_n("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xi="FirestoreClient";class PM{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=tn.UNAUTHENTICATED,this.clientId=Gy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{X(xi,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(X(xi,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Tr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=bv(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Lp(t,e){t.asyncQueue.verifyOperationInProgress(),X(xi,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await HC(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function HE(t,e){t.asyncQueue.verifyOperationInProgress();const n=await kM(t);X(xi,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>FE(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>FE(e.remoteStore,s)),t._onlineComponents=e}async function kM(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){X(xi,"Using user provided OfflineComponentProvider");try{await Lp(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===q.FAILED_PRECONDITION||s.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;fo("Error using user provided cache. Falling back to memory cache: "+n),await Lp(t,new zc)}}else X(xi,"Using default OfflineComponentProvider"),await Lp(t,new AM(void 0));return t._offlineComponents}async function Pv(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(X(xi,"Using user provided OnlineComponentProvider"),await HE(t,t._uninitializedComponentsProvider._online)):(X(xi,"Using default OnlineComponentProvider"),await HE(t,new Ch))),t._onlineComponents}function jM(t){return Pv(t).then(e=>e.syncEngine)}function DM(t){return Pv(t).then(e=>e.datastore)}async function Nh(t){const e=await Pv(t),n=e.eventManager;return n.onListen=yM.bind(null,e.syncEngine),n.onUnlisten=xM.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=vM.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=wM.bind(null,e.syncEngine),n}function OM(t,e,n={}){const r=new Tr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,d){const f=new Rv({next:m=>{f.Nu(),o.enqueueAndForget(()=>Tv(i,h));const v=m.docs.has(l);!v&&m.fromCache?d.reject(new Z(q.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&m.fromCache&&c&&c.source==="server"?d.reject(new Z(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(m)},error:m=>d.reject(m)}),h=new Cv(iu(l.path),f,{includeMetadataChanges:!0,qa:!0});return Iv(i,h)}(await Nh(t),t.asyncQueue,e,n,r)),r.promise}function LM(t,e,n={}){const r=new Tr;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,l,c,d){const f=new Rv({next:m=>{f.Nu(),o.enqueueAndForget(()=>Tv(i,h)),m.fromCache&&c.source==="server"?d.reject(new Z(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(m)},error:m=>d.reject(m)}),h=new Cv(l,f,{includeMetadataChanges:!0,qa:!0});return Iv(i,h)}(await Nh(t),t.asyncQueue,e,n,r)),r.promise}function VM(t,e,n){const r=new Tr;return t.asyncQueue.enqueueAndForget(async()=>{try{const s=await DM(t);r.resolve(async function(o,l,c){var A;const d=Se(o),{request:f,gt:h,parent:m}=YL(d.serializer,EL(l),c);d.connection.$o||delete f.parent;const v=(await d.Ho("RunAggregationQuery",d.serializer.databaseId,m,f,1)).filter(C=>!!C.result);ge(v.length===1,64727);const P=(A=v[0].result)==null?void 0:A.aggregateFields;return Object.keys(P).reduce((C,y)=>(C[h[y]]=P[y],C),{})}(s,e,n))}catch(s){r.reject(s)}}),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WE=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hN="firestore.googleapis.com",GE=!0;class KE{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Z(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=hN,this.ssl=GE}else this.host=e.host,this.ssl=e.ssl??GE;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=DC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<fV)throw new Z(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}NO("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=dN(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new Z(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new Z(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new Z(q.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Tf{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new KE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Z(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Z(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new KE(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new vO;switch(r.type){case"firstParty":return new EO(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Z(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=WE.get(n);r&&(X("ComponentProvider","Removing Datastore"),WE.delete(n),r.terminate())}(this),Promise.resolve()}}function MM(t,e,n,r={}){var d;t=fn(t,Tf);const s=Ii(e),i=t._getSettings(),o={...i,emulatorOptions:t._getEmulatorOptions()},l=`${e}:${n}`;s&&(ky(`https://${l}`),jy("Firestore",!0)),i.host!==hN&&i.host!==l&&fo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:l,ssl:s,emulatorOptions:r};if(!xs(c,o)&&(t._setSettings(c),r.mockUserToken)){let f,h;if(typeof r.mockUserToken=="string")f=r.mockUserToken,h=tn.MOCK_USER;else{f=wT(r.mockUserToken,(d=t._app)==null?void 0:d.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new Z(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new tn(m)}t._authCredentials=new _O(new xS(f,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new jr(this.firestore,e,this._query)}}class Pt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pt(this.firestore,e,this._key)}toJSON(){return{type:Pt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(nu(n,Pt._jsonSchema))return new Pt(e,r||null,new se(Ye.fromString(n.referencePath)))}}Pt._jsonSchemaVersion="firestore/documentReference/1.0",Pt._jsonSchema={type:$t("string",Pt._jsonSchemaVersion),referencePath:$t("string")};class fi extends jr{constructor(e,n,r){super(e,n,iu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pt(this.firestore,null,new se(e))}withConverter(e){return new fi(this.firestore,e,this._path)}}function be(t,e,...n){if(t=et(t),ES("collection","path",e),t instanceof Tf){const r=Ye.fromString(e,...n);return Mw(r),new fi(t,null,r)}{if(!(t instanceof Pt||t instanceof fi))throw new Z(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ye.fromString(e,...n));return Mw(r),new fi(t.firestore,null,r)}}function Ge(t,e,...n){if(t=et(t),arguments.length===1&&(e=Gy.newId()),ES("doc","path",e),t instanceof Tf){const r=Ye.fromString(e,...n);return Vw(r),new Pt(t,null,new se(r))}{if(!(t instanceof Pt||t instanceof fi))throw new Z(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ye.fromString(e,...n));return Vw(r),new Pt(t.firestore,t instanceof fi?t.converter:null,new se(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QE="AsyncQueue";class YE{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new KC(this,"async_queue_retry"),this._c=()=>{const r=Rd();r&&X(QE,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Rd();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Rd();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new Tr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Ci(e))throw e;X(QE,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,_n("INTERNAL UNHANDLED ERROR: ",XE(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=Ev.createAndSchedule(this,e,n,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&he(47125,{Pc:XE(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function XE(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JE(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Ar extends Tf{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new YE,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new YE(e),this._firestoreClient=void 0,await e}}}function fN(t,e){const n=typeof t=="object"?t:Zh(),r=typeof t=="string"?t:gh,s=Ti(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=vT("firestore");i&&MM(s,...i)}return s}function du(t){if(t._terminated)throw new Z(q.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||pN(t),t._firestoreClient}function pN(t){var r,s,i;const e=t._freezeSettings(),n=function(l,c,d,f){return new uL(l,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,dN(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new PM(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}function FM(t,e){fo("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return UM(t,Ch.provider,{build:r=>new RM(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function UM(t,e,n){if((t=fn(t,Ar))._firestoreClient||t._terminated)throw new Z(q.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new Z(q.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},pN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $M{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class BM{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new sr(Bt.fromBase64String(e))}catch(n){throw new Z(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new sr(Bt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:sr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(nu(e,sr._jsonSchema))return sr.fromBase64String(e.bytes)}}sr._jsonSchemaVersion="firestore/bytes/1.0",sr._jsonSchema={type:$t("string",sr._jsonSchemaVersion),bytes:$t("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Z(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Tt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Z(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Z(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Re(this._lat,e._lat)||Re(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Xr._jsonSchemaVersion}}static fromJSON(e){if(nu(e,Xr._jsonSchema))return new Xr(e.latitude,e.longitude)}}Xr._jsonSchemaVersion="firestore/geoPoint/1.0",Xr._jsonSchema={type:$t("string",Xr._jsonSchemaVersion),latitude:$t("number"),longitude:$t("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Jr._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(nu(e,Jr._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new Jr(e.vectorValues);throw new Z(q.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Jr._jsonSchemaVersion="firestore/vectorValue/1.0",Jr._jsonSchema={type:$t("string",Jr._jsonSchemaVersion),vectorValues:$t("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zM=/^__.*__$/;class qM{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Cs(e,this.data,this.fieldMask,n,this.fieldTransforms):new nl(e,this.data,n,this.fieldTransforms)}}class mN{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Cs(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function gN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw he(40011,{Ac:t})}}class Cf{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Cf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ah(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(gN(this.Ac)&&zM.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class HM{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||bf(e)}Cc(e,n,r,s=!1){return new Cf({Ac:e,methodName:n,Dc:r,path:Tt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hu(t){const e=t._freezeSettings(),n=bf(t._databaseId);return new HM(t._databaseId,!!e.ignoreUndefinedProperties,n)}function yN(t,e,n,r,s,i={}){const o=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);Ov("Data must be an object, but it was:",o,r);const l=_N(r,o);let c,d;if(i.merge)c=new kn(o.fieldMask),d=o.fieldTransforms;else if(i.mergeFields){const f=[];for(const h of i.mergeFields){const m=Sg(e,h,n);if(!o.contains(m))throw new Z(q.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);wN(f,m)||f.push(m)}c=new kn(f),d=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,d=o.fieldTransforms;return new qM(new dn(l),c,d)}class Nf extends sl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Nf}}function WM(t,e,n){return new Cf({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class kv extends sl{_toFieldTransform(e){return new gf(e.path,new $a)}isEqual(e){return e instanceof kv}}class jv extends sl{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=WM(this,e,!0),r=this.vc.map(i=>il(i,n)),s=new yo(r);return new gf(e.path,s)}isEqual(e){return e instanceof jv&&xs(this.vc,e.vc)}}class Dv extends sl{constructor(e,n){super(e),this.Fc=n}_toFieldTransform(e){const n=new za(e.serializer,lC(e.serializer,this.Fc));return new gf(e.path,n)}isEqual(e){return e instanceof Dv&&this.Fc===e.Fc}}function GM(t,e,n,r){const s=t.Cc(1,e,n);Ov("Data must be an object, but it was:",s,r);const i=[],o=dn.empty();Ni(r,(c,d)=>{const f=Lv(e,c,n);d=et(d);const h=s.yc(f);if(d instanceof Nf)i.push(f);else{const m=il(d,h);m!=null&&(i.push(f),o.set(f,m))}});const l=new kn(i);return new mN(o,l,s.fieldTransforms)}function KM(t,e,n,r,s,i){const o=t.Cc(1,e,n),l=[Sg(e,r,n)],c=[s];if(i.length%2!=0)throw new Z(q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)l.push(Sg(e,i[m])),c.push(i[m+1]);const d=[],f=dn.empty();for(let m=l.length-1;m>=0;--m)if(!wN(d,l[m])){const v=l[m];let P=c[m];P=et(P);const A=o.yc(v);if(P instanceof Nf)d.push(v);else{const C=il(P,A);C!=null&&(d.push(v),f.set(v,C))}}const h=new kn(d);return new mN(f,h,o.fieldTransforms)}function vN(t,e,n,r=!1){return il(n,t.Cc(r?4:3,e))}function il(t,e){if(xN(t=et(t)))return Ov("Unsupported field value:",e,t),_N(t,e);if(t instanceof sl)return function(r,s){if(!gN(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const l of r){let c=il(l,s.wc(o));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),o++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=et(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return lC(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=He.fromDate(r);return{timestampValue:qa(s.serializer,i)}}if(r instanceof He){const i=new He(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:qa(s.serializer,i)}}if(r instanceof Xr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof sr)return{bytesValue:_C(s.serializer,r._byteString)};if(r instanceof Pt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:cv(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Jr)return function(o,l){return{mapValue:{fields:{[ev]:{stringValue:tv},[Ma]:{arrayValue:{values:o.toArray().map(d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return sv(l.serializer,d)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${sf(r)}`)}(t,e)}function _N(t,e){const n={};return MS(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ni(t,(r,s)=>{const i=il(s,e.mc(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function xN(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof He||t instanceof Xr||t instanceof sr||t instanceof Pt||t instanceof sl||t instanceof Jr)}function Ov(t,e,n){if(!xN(n)||!bS(n)){const r=sf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Sg(t,e,n){if((e=et(e))instanceof Sf)return e._internalPath;if(typeof e=="string")return Lv(t,e);throw Ah("Field path arguments must be of type string or ",t,!1,void 0,n)}const QM=new RegExp("[~\\*/\\[\\]]");function Lv(t,e,n){if(e.search(QM)>=0)throw Ah(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Sf(...e.split("."))._internalPath}catch{throw Ah(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ah(t,e,n,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new Z(q.INVALID_ARGUMENT,l+t+c)}function wN(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vv{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Pt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new YM(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Af("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class YM extends Vv{data(){return super.data()}}function Af(t,e){return typeof e=="string"?Lv(t,e):e instanceof Sf?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EN(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Z(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Mv{}class fu extends Mv{}function ut(t,e,...n){let r=[];e instanceof Mv&&r.push(e),r=r.concat(n),function(i){const o=i.filter(c=>c instanceof Fv).length,l=i.filter(c=>c instanceof Rf).length;if(o>1||o>0&&l>0)throw new Z(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Rf extends fu{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Rf(e,n,r)}_apply(e){const n=this._parse(e);return IN(e._query,n),new jr(e.firestore,e.converter,pg(e._query,n))}_parse(e){const n=hu(e.firestore);return function(i,o,l,c,d,f,h){let m;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new Z(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){nb(h,f);const P=[];for(const A of h)P.push(tb(c,i,A));m={arrayValue:{values:P}}}else m=tb(c,i,h)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||nb(h,f),m=vN(l,o,h,f==="in"||f==="not-in");return Be.create(d,f,m)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function nt(t,e,n){const r=e,s=Af("where",t);return Rf._create(s,r,n)}class Fv extends Mv{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Fv(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:rt.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let o=s;const l=i.getFlattenedFilters();for(const c of l)IN(o,c),o=pg(o,c)}(e._query,n),new jr(e.firestore,e.converter,pg(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Uv extends fu{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Uv(e,n)}_apply(e){const n=function(s,i,o){if(s.startAt!==null)throw new Z(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new Z(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Bc(i,o)}(e._query,this._field,this._direction);return new jr(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Ai(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function xn(t,e="asc"){const n=e,r=Af("orderBy",t);return Uv._create(r,n)}class $v extends fu{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new $v(e,n,r)}_apply(e){return new jr(e.firestore,e.converter,_h(e._query,this._limit,this._limitType))}}function ba(t){return AO("limit",t),$v._create("limit",t,"F")}class Pf extends fu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Pf(e,n,r)}_apply(e){const n=bN(e,this.type,this._docOrFields,this._inclusive);return new jr(e.firestore,e.converter,function(s,i){return new Ai(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,n))}}function ZE(...t){return Pf._create("startAt",t,!0)}function XM(...t){return Pf._create("startAfter",t,!1)}class Bv extends fu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Bv(e,n,r)}_apply(e){const n=bN(e,this.type,this._docOrFields,this._inclusive);return new jr(e.firestore,e.converter,function(s,i){return new Ai(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,n))}}function eb(...t){return Bv._create("endAt",t,!0)}function bN(t,e,n,r){if(n[0]=et(n[0]),n[0]instanceof Vv)return function(i,o,l,c,d){if(!c)throw new Z(q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const f=[];for(const h of wa(i))if(h.field.isKeyField())f.push(mo(o,c.key));else{const m=c.data.field(h.field);if(df(m))throw new Z(q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const v=h.field.canonicalString();throw new Z(q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${v}' (used as the orderBy) does not exist.`)}f.push(m)}return new vi(f,d)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=hu(t.firestore);return function(o,l,c,d,f,h){const m=o.explicitOrderBy;if(f.length>m.length)throw new Z(q.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const v=[];for(let P=0;P<f.length;P++){const A=f[P];if(m[P].field.isKeyField()){if(typeof A!="string")throw new Z(q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof A}`);if(!rv(o)&&A.indexOf("/")!==-1)throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${A}' contains a slash.`);const C=o.path.child(Ye.fromString(A));if(!se.isDocumentKey(C))throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${C}' is not because it contains an odd number of segments.`);const y=new se(C);v.push(mo(l,y))}else{const C=vN(c,d,A);v.push(C)}}return new vi(v,h)}(t._query,t.firestore._databaseId,s,e,n,r)}}function tb(t,e,n){if(typeof(n=et(n))=="string"){if(n==="")throw new Z(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rv(e)&&n.indexOf("/")!==-1)throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ye.fromString(n));if(!se.isDocumentKey(r))throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return mo(t,new se(r))}if(n instanceof Pt)return mo(t,n._key);throw new Z(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${sf(n)}.`)}function nb(t,e){if(!Array.isArray(t)||t.length===0)throw new Z(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function IN(t,e){const n=function(s,i){for(const o of s)for(const l of o.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new Z(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Z(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class JM{convertValue(e,n="none"){switch(gi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return vt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Is(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw he(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ni(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var r,s,i;const n=(i=(s=(r=e.fields)==null?void 0:r[Ma].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>vt(o.doubleValue));return new Jr(n)}convertGeoPoint(e){return new Xr(vt(e.latitude),vt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=hf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Fc(e));default:return null}}convertTimestamp(e){const n=bs(e);return new He(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ye.fromString(e);ge(NC(r),9688,{name:e});const s=new po(r.get(1),r.get(3)),i=new se(r.popFirst(5));return s.isEqual(n)||_n(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TN(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}function ZM(){return new $M("count")}class ql{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class no extends Vv{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Pd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Af("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Z(q.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=no._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}no._jsonSchemaVersion="firestore/documentSnapshot/1.0",no._jsonSchema={type:$t("string",no._jsonSchemaVersion),bundleSource:$t("string","DocumentSnapshot"),bundleName:$t("string"),bundle:$t("string")};class Pd extends no{data(e={}){return super.data(e)}}class ro{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new ql(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Pd(this._firestore,this._userDataWriter,r.key,r,new ql(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Z(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(l=>{const c=new Pd(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ql(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new Pd(s._firestore,s._userDataWriter,l.doc.key,l.doc,new ql(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=o.indexOf(l.doc.key),o=o.delete(l.doc.key)),l.type!==1&&(o=o.add(l.doc),f=o.indexOf(l.doc.key)),{type:eF(l.type),doc:c,oldIndex:d,newIndex:f}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Z(q.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ro._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Gy.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(n.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function eF(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return he(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qc(t){t=fn(t,Pt);const e=fn(t.firestore,Ar);return OM(du(e),t._key).then(n=>SN(e,t,n))}ro._jsonSchemaVersion="firestore/querySnapshot/1.0",ro._jsonSchema={type:$t("string",ro._jsonSchemaVersion),bundleSource:$t("string","QuerySnapshot"),bundleName:$t("string"),bundle:$t("string")};class kf extends JM{constructor(e){super(),this.firestore=e}convertBytes(e){return new sr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Pt(this.firestore,null,n)}}function Je(t){t=fn(t,jr);const e=fn(t.firestore,Ar),n=du(e),r=new kf(e);return EN(t._query),LM(n,t._query).then(s=>new ro(e,r,t,s))}function Wa(t,e,n){t=fn(t,Pt);const r=fn(t.firestore,Ar),s=TN(t.converter,e,n);return jf(r,[yN(hu(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,hn.none())])}function zn(t,e,n,...r){t=fn(t,Pt);const s=fn(t.firestore,Ar),i=hu(s);let o;return o=typeof(e=et(e))=="string"||e instanceof Sf?KM(i,"updateDoc",t._key,e,n,r):GM(i,"updateDoc",t._key,e),jf(s,[o.toMutation(t._key,hn.exists(!0))])}function ps(t){return jf(fn(t.firestore,Ar),[new vf(t._key,hn.none())])}function wn(t,e){const n=fn(t.firestore,Ar),r=Ge(t),s=TN(t.converter,e);return jf(n,[yN(hu(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,hn.exists(!1))]).then(()=>r)}function Bn(t,...e){var c,d,f;t=et(t);let n={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||JE(e[r])||(n=e[r++]);const s={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(JE(e[r])){const h=e[r];e[r]=(c=h.next)==null?void 0:c.bind(h),e[r+1]=(d=h.error)==null?void 0:d.bind(h),e[r+2]=(f=h.complete)==null?void 0:f.bind(h)}let i,o,l;if(t instanceof Pt)o=fn(t.firestore,Ar),l=iu(t._key.path),i={next:h=>{e[r]&&e[r](SN(o,t,h))},error:e[r+1],complete:e[r+2]};else{const h=fn(t,jr);o=fn(h.firestore,Ar),l=h._query;const m=new kf(o);i={next:v=>{e[r]&&e[r](new ro(o,m,h,v))},error:e[r+1],complete:e[r+2]},EN(t._query)}return function(m,v,P,A){const C=new Rv(A),y=new Cv(v,C,P);return m.asyncQueue.enqueueAndForget(async()=>Iv(await Nh(m),y)),()=>{C.Nu(),m.asyncQueue.enqueueAndForget(async()=>Tv(await Nh(m),y))}}(du(o),l,s,i)}function jf(t,e){return function(r,s){const i=new Tr;return r.asyncQueue.enqueueAndForget(async()=>EM(await jM(r),s,i)),i.promise}(du(t),e)}function SN(t,e,n){const r=n.docs.get(e._key),s=new kf(t);return new no(t,s,e._key,r,new ql(n.hasPendingWrites,n.fromCache),e.converter)}function tF(t){return nF(t,{count:ZM()})}function nF(t,e){const n=fn(t.firestore,Ar),r=du(n),s=lL(e,(i,o)=>new LL(o,i.aggregateType,i._internalFieldPath));return VM(r,t._query,s).then(i=>function(l,c,d){const f=new kf(l);return new BM(c,f,d)}(n,t,i))}function er(){return new kv("serverTimestamp")}function rF(...t){return new jv("arrayUnion",t)}function rb(t){return new Dv("increment",t)}(function(e,n=!0){(function(s){tl=s})(No),Cr(new hr("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),l=new Ar(new xO(r.getProvider("auth-internal")),new bO(o,r.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new Z(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new po(d.options.projectId,f)}(o,s),o);return i={useFetchStreams:n,...i},l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Ln(jw,Dw,e),Ln(jw,Dw,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CN="firebasestorage.googleapis.com",NN="storageBucket",sF=2*60*1e3,iF=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt extends fr{constructor(e,n,r=0){super(Vp(e),`Firebase Storage: ${n} (${Vp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,jt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Vp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var kt;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(kt||(kt={}));function Vp(t){return"storage/"+t}function zv(){const t="An unknown error occurred, please check the error payload for server response.";return new jt(kt.UNKNOWN,t)}function oF(t){return new jt(kt.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function aF(t){return new jt(kt.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function lF(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new jt(kt.UNAUTHENTICATED,t)}function cF(){return new jt(kt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function uF(t){return new jt(kt.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function dF(){return new jt(kt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function hF(){return new jt(kt.CANCELED,"User canceled the upload/download.")}function fF(t){return new jt(kt.INVALID_URL,"Invalid URL '"+t+"'.")}function pF(t){return new jt(kt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function mF(){return new jt(kt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+NN+"' property when initializing the app?")}function gF(){return new jt(kt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function yF(){return new jt(kt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function vF(t){return new jt(kt.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Cg(t){return new jt(kt.INVALID_ARGUMENT,t)}function AN(){return new jt(kt.APP_DELETED,"The Firebase app was deleted.")}function _F(t){return new jt(kt.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function dc(t,e){return new jt(kt.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Rl(t){throw new jt(kt.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=En.makeFromUrl(e,n)}catch{return new En(e,"")}if(r.path==="")return r;throw pF(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(T){T.path.charAt(T.path.length-1)==="/"&&(T.path_=T.path_.slice(0,-1))}const o="(/(.*))?$",l=new RegExp("^gs://"+s+o,"i"),c={bucket:1,path:3};function d(T){T.path_=decodeURIComponent(T.path)}const f="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",v=new RegExp(`^https?://${h}/${f}/b/${s}/o${m}`,"i"),P={bucket:1,path:3},A=n===CN?"(?:storage.googleapis.com|storage.cloud.google.com)":n,C="([^?#]*)",y=new RegExp(`^https?://${A}/${s}/${C}`,"i"),w=[{regex:l,indices:c,postModify:i},{regex:v,indices:P,postModify:d},{regex:y,indices:{bucket:1,path:2},postModify:d}];for(let T=0;T<w.length;T++){const V=w[T],U=V.regex.exec(e);if(U){const b=U[V.indices.bucket];let E=U[V.indices.path];E||(E=""),r=new En(b,E),V.postModify(r);break}}if(r==null)throw fF(e);return r}}class xF{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wF(t,e,n){let r=1,s=null,i=null,o=!1,l=0;function c(){return l===2}let d=!1;function f(...C){d||(d=!0,e.apply(null,C))}function h(C){s=setTimeout(()=>{s=null,t(v,c())},C)}function m(){i&&clearTimeout(i)}function v(C,...y){if(d){m();return}if(C){m(),f.call(null,C,...y);return}if(c()||o){m(),f.call(null,C,...y);return}r<64&&(r*=2);let w;l===1?(l=2,w=0):w=(r+Math.random())*1e3,h(w)}let P=!1;function A(C){P||(P=!0,m(),!d&&(s!==null?(C||(l=2),clearTimeout(s),h(0)):C||(l=1)))}return h(0),i=setTimeout(()=>{o=!0,A(!0)},n),A}function EF(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bF(t){return t!==void 0}function IF(t){return typeof t=="object"&&!Array.isArray(t)}function qv(t){return typeof t=="string"||t instanceof String}function sb(t){return Hv()&&t instanceof Blob}function Hv(){return typeof Blob<"u"}function Ng(t,e,n,r){if(r<e)throw Cg(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Cg(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pu(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function RN(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var so;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(so||(so={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TF(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SF{constructor(e,n,r,s,i,o,l,c,d,f,h,m=!0,v=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=f,this.connectionFactory_=h,this.retry=m,this.isUsingEmulator=v,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((P,A)=>{this.resolve_=P,this.reject_=A,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Xu(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const l=i.getErrorCode()===so.NO_ERROR,c=i.getStatus();if(!l||TF(c,this.additionalRetryCodes_)&&this.retry){const f=i.getErrorCode()===so.ABORT;r(!1,new Xu(!1,null,f));return}const d=this.successCodes_.indexOf(c)!==-1;r(!0,new Xu(d,i))})},n=(r,s)=>{const i=this.resolve_,o=this.reject_,l=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());bF(c)?i(c):i()}catch(c){o(c)}else if(l!==null){const c=zv();c.serverResponse=l.getErrorText(),this.errorCallback_?o(this.errorCallback_(l,c)):o(c)}else if(s.canceled){const c=this.appDelete_?AN():hF();o(c)}else{const c=dF();o(c)}};this.canceled_?n(!1,new Xu(!1,null,!0)):this.backoffId_=wF(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&EF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Xu{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function CF(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function NF(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function AF(t,e){e&&(t["X-Firebase-GMPID"]=e)}function RF(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function PF(t,e,n,r,s,i,o=!0,l=!1){const c=RN(t.urlParams),d=t.url+c,f=Object.assign({},t.headers);return AF(f,e),CF(f,n),NF(f,i),RF(f,r),new SF(d,t.method,f,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kF(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function jF(...t){const e=kF();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(Hv())return new Blob(t);throw new jt(kt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function DF(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OF(t){if(typeof atob>"u")throw vF("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wr={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Mp{constructor(e,n){this.data=e,this.contentType=n||null}}function LF(t,e){switch(t){case Wr.RAW:return new Mp(PN(e));case Wr.BASE64:case Wr.BASE64URL:return new Mp(kN(t,e));case Wr.DATA_URL:return new Mp(MF(e),FF(e))}throw zv()}function PN(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=t.charCodeAt(++n);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function VF(t){let e;try{e=decodeURIComponent(t)}catch{throw dc(Wr.DATA_URL,"Malformed data URL.")}return PN(e)}function kN(t,e){switch(t){case Wr.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw dc(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Wr.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw dc(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=OF(e)}catch(s){throw s.message.includes("polyfill")?s:dc(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class jN{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw dc(Wr.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=UF(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function MF(t){const e=new jN(t);return e.base64?kN(Wr.BASE64,e.rest):VF(e.rest)}function FF(t){return new jN(t).contentType}function UF(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e,n){let r=0,s="";sb(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(sb(this.data_)){const r=this.data_,s=DF(r,e,n);return s===null?null:new Ys(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new Ys(r,!0)}}static getBlob(...e){if(Hv()){const n=e.map(r=>r instanceof Ys?r.data_:r);return new Ys(jF.apply(null,n))}else{const n=e.map(o=>qv(o)?LF(Wr.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(o=>{for(let l=0;l<o.length;l++)s[i++]=o[l]}),new Ys(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wv(t){let e;try{e=JSON.parse(t)}catch{return null}return IF(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $F(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function BF(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function DN(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zF(t,e){return e}class yn{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||zF}}let Ju=null;function qF(t){return!qv(t)||t.length<2?t:DN(t)}function ON(){if(Ju)return Ju;const t=[];t.push(new yn("bucket")),t.push(new yn("generation")),t.push(new yn("metageneration")),t.push(new yn("name","fullPath",!0));function e(i,o){return qF(o)}const n=new yn("name");n.xform=e,t.push(n);function r(i,o){return o!==void 0?Number(o):o}const s=new yn("size");return s.xform=r,t.push(s),t.push(new yn("timeCreated")),t.push(new yn("updated")),t.push(new yn("md5Hash",null,!0)),t.push(new yn("cacheControl",null,!0)),t.push(new yn("contentDisposition",null,!0)),t.push(new yn("contentEncoding",null,!0)),t.push(new yn("contentLanguage",null,!0)),t.push(new yn("contentType",null,!0)),t.push(new yn("metadata","customMetadata",!0)),Ju=t,Ju}function HF(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new En(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function WF(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const o=n[i];r[o.local]=o.xform(r,e[o.server])}return HF(r,t),r}function LN(t,e,n){const r=Wv(e);return r===null?null:WF(t,r,n)}function GF(t,e,n,r){const s=Wv(e);if(s===null||!qv(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(d=>{const f=t.bucket,h=t.fullPath,m="/b/"+o(f)+"/o/"+o(h),v=pu(m,n,r),P=RN({alt:"media",token:d});return v+P})[0]}function KF(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ib="prefixes",ob="items";function QF(t,e,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[ib])for(const s of n[ib]){const i=s.replace(/\/$/,""),o=t._makeStorageReference(new En(e,i));r.prefixes.push(o)}if(n[ob])for(const s of n[ob]){const i=t._makeStorageReference(new En(e,s.name));r.items.push(i)}return r}function YF(t,e,n){const r=Wv(n);return r===null?null:QF(t,e,r)}class Df{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gv(t){if(!t)throw zv()}function XF(t,e){function n(r,s){const i=LN(t,s,e);return Gv(i!==null),i}return n}function JF(t,e){function n(r,s){const i=YF(t,e,s);return Gv(i!==null),i}return n}function ZF(t,e){function n(r,s){const i=LN(t,s,e);return Gv(i!==null),GF(i,s,t.host,t._protocol)}return n}function Kv(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=cF():s=lF():n.getStatus()===402?s=aF(t.bucket):n.getStatus()===403?s=uF(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function VN(t){const e=Kv(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=oF(t.path)),i.serverResponse=s.serverResponse,i}return n}function e4(t,e,n,r,s){const i={};e.isRoot?i.prefix="":i.prefix=e.path+"/",n.length>0&&(i.delimiter=n),r&&(i.pageToken=r),s&&(i.maxResults=s);const o=e.bucketOnlyServerUrl(),l=pu(o,t.host,t._protocol),c="GET",d=t.maxOperationRetryTime,f=new Df(l,c,JF(t,e.bucket),d);return f.urlParams=i,f.errorHandler=Kv(e),f}function t4(t,e,n){const r=e.fullServerUrl(),s=pu(r,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,l=new Df(s,i,ZF(t,n),o);return l.errorHandler=VN(e),l}function n4(t,e){const n=e.fullServerUrl(),r=pu(n,t.host,t._protocol),s="DELETE",i=t.maxOperationRetryTime;function o(c,d){}const l=new Df(r,s,o,i);return l.successCodes=[200,204],l.errorHandler=VN(e),l}function r4(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function s4(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=r4(null,e)),r}function i4(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function l(){let w="";for(let T=0;T<2;T++)w=w+Math.random().toString().slice(2);return w}const c=l();o["Content-Type"]="multipart/related; boundary="+c;const d=s4(e,r,s),f=KF(d,n),h="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+f+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,m=`\r
--`+c+"--",v=Ys.getBlob(h,r,m);if(v===null)throw gF();const P={name:d.fullPath},A=pu(i,t.host,t._protocol),C="POST",y=t.maxUploadRetryTime,_=new Df(A,C,XF(t,n),y);return _.urlParams=P,_.headers=o,_.body=v.uploadData(),_.errorHandler=Kv(e),_}class o4{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=so.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=so.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=so.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s,i){if(this.sent_)throw Rl("cannot .send() more than once");if(Ii(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Rl("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Rl("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Rl("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Rl("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class a4 extends o4{initXhr(){this.xhr_.responseType="text"}}function Of(){return new a4}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eo{constructor(e,n){this._service=e,n instanceof En?this._location=n:this._location=En.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new Eo(e,n)}get root(){const e=new En(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return DN(this._location.path)}get storage(){return this._service}get parent(){const e=$F(this._location.path);if(e===null)return null;const n=new En(this._location.bucket,e);return new Eo(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw _F(e)}}function l4(t,e,n){t._throwIfRoot("uploadBytes");const r=i4(t.storage,t._location,ON(),new Ys(e,!0),n);return t.storage.makeRequestWithTokens(r,Of).then(s=>({metadata:s,ref:t}))}function c4(t){const e={prefixes:[],items:[]};return MN(t,e).then(()=>e)}async function MN(t,e,n){const s=await u4(t,{pageToken:n});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await MN(t,e,s.nextPageToken)}function u4(t,e){e!=null&&typeof e.maxResults=="number"&&Ng("options.maxResults",1,1e3,e.maxResults);const n=e||{},r=e4(t.storage,t._location,"/",n.pageToken,n.maxResults);return t.storage.makeRequestWithTokens(r,Of)}function d4(t){t._throwIfRoot("getDownloadURL");const e=t4(t.storage,t._location,ON());return t.storage.makeRequestWithTokens(e,Of).then(n=>{if(n===null)throw yF();return n})}function h4(t){t._throwIfRoot("deleteObject");const e=n4(t.storage,t._location);return t.storage.makeRequestWithTokens(e,Of)}function f4(t,e){const n=BF(t._location.path,e),r=new En(t._location.bucket,n);return new Eo(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p4(t){return/^[A-Za-z]+:\/\//.test(t)}function m4(t,e){return new Eo(t,e)}function FN(t,e){if(t instanceof Qv){const n=t;if(n._bucket==null)throw mF();const r=new Eo(n,n._bucket);return e!=null?FN(r,e):r}else return e!==void 0?f4(t,e):t}function g4(t,e){if(e&&p4(e)){if(t instanceof Qv)return m4(t,e);throw Cg("To use ref(service, url), the first argument must be a Storage instance.")}else return FN(t,e)}function ab(t,e){const n=e==null?void 0:e[NN];return n==null?null:En.makeFromBucketSpec(n,t)}function y4(t,e,n,r={}){t.host=`${e}:${n}`;const s=Ii(e);s&&(ky(`https://${t.host}/b`),jy("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:wT(i,t.app.options.projectId))}class Qv{constructor(e,n,r,s,i,o=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=CN,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=sF,this._maxUploadRetryTime=iF,this._requests=new Set,s!=null?this._bucket=En.makeFromBucketSpec(s,this._host):this._bucket=ab(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=En.makeFromBucketSpec(this._url,e):this._bucket=ab(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Ng("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Ng("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(rr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Eo(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new xF(AN());{const o=PF(e,this._appId,r,s,n,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const lb="@firebase/storage",cb="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UN="storage";function ub(t,e,n){return t=et(t),l4(t,e,n)}function db(t){return t=et(t),c4(t)}function hb(t){return t=et(t),d4(t)}function Fp(t){return t=et(t),h4(t)}function Pl(t,e){return t=et(t),g4(t,e)}function Hi(t=Zh(),e){t=et(t);const r=Ti(t,UN).getImmediate({identifier:e}),s=vT("storage");return s&&v4(r,...s),r}function v4(t,e,n,r={}){y4(t,e,n,r)}function _4(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new Qv(n,r,s,e,No)}function x4(){Cr(new hr(UN,_4,"PUBLIC").setMultipleInstances(!0)),Ln(lb,cb,""),Ln(lb,cb,"esm2020")}x4();const w4={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},Yv=Ly(w4),fb=hS(Yv),pb=fN(Yv);Hi(Yv);const E4="/odontocloud-react/assets/fondo.png",$N="/odontocloud-react/assets/logo.png",mb=(t,e)=>{const n={email:t,rol:e,timestamp:Date.now()};localStorage.setItem("odc_session",JSON.stringify(n))},Up=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},b4=()=>{const t=kr(),[e,n]=I.useState(""),[r,s]=I.useState(""),[i,o]=I.useState(""),[l,c]=I.useState(navigator.onLine);I.useEffect(()=>{const h=()=>c(!0),m=()=>c(!1);return window.addEventListener("online",h),window.addEventListener("offline",m),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",m)}},[]);const d=h=>{const m=(h||"").toLowerCase();m==="administrador"?t("/dashboard_admin",{replace:!0}):m==="doctor"?t("/dashboard_doctor",{replace:!0}):m==="recepcionista"?t("/dashboard_recepcion",{replace:!0}):o("Rol no reconocido. Contacte al administrador.")};I.useEffect(()=>{if(!navigator.onLine){const m=Up();m!=null&&m.rol?d(m.rol):o("Sin conexin y no hay sesin guardada.");return}const h=zy(fb,async m=>{if(m){const v=Up();if(v!=null&&v.rol){d(v.rol);return}try{const P=ut(be(pb,"users"),nt("correo","==",m.email||"")),A=await Je(P);if(!A.empty){const C=A.docs[0].data().rol||"sin_rol";mb(m.email||"",C),d(C)}}catch{d("administrador")}}});return()=>h()},[]);const f=async h=>{if(h.preventDefault(),o(""),!l){const m=Up();m!=null&&m.rol?d(m.rol):o("Sin conexin y no hay sesin guardada.");return}try{const v=(await r2(fb,e,r)).user,P=ut(be(pb,"users"),nt("correo","==",e)),A=await Je(P);if(A.empty){o("Usuario no encontrado en la base de datos.");return}const y=A.docs[0].data().rol||"sin_rol";mb(e,y),d(y)}catch(m){switch(console.error("Error login:",m),m.code){case"auth/user-not-found":o("Usuario no registrado.");break;case"auth/wrong-password":o("Contrasea incorrecta.");break;case"auth/invalid-email":o("Correo no vlido.");break;case"auth/network-request-failed":o("Sin conexin. Usa la sesin guardada o reconecta.");break;default:o("Error al iniciar sesin.")}}};return a.jsx("div",{className:"login-root",style:{backgroundImage:`url(${E4})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed",width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:a.jsxs("div",{className:"container",children:[a.jsxs("div",{className:"left-panel",children:[a.jsx("img",{src:$N,alt:"OdontoCloud Logo",className:"logo"}),a.jsxs("h2",{children:["Su clnica, ",a.jsx("br",{})," ms conectada."]}),a.jsx("p",{children:"OdontoCloud optimiza cada detalle de su gestin."})]}),a.jsxs("div",{className:"right-panel",children:[a.jsx("h3",{children:"Acceso a la plataforma"}),a.jsxs("form",{onSubmit:f,children:[a.jsx("input",{type:"email",placeholder:"usuario@ejemplo.com",value:e,onChange:h=>n(h.target.value),required:l}),a.jsx("input",{type:"password",placeholder:"Contrasea",value:r,onChange:h=>s(h.target.value),required:l}),a.jsx("button",{type:"submit",children:l?"Iniciar sesin":"Entrar (modo offline)"}),i&&a.jsx("p",{style:{color:"red",marginTop:10},children:i}),!l&&a.jsx("p",{style:{color:"orange",marginTop:10},children:" Modo offline activado"})]})]})]})})},BN="@firebase/installations",Xv="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zN=1e4,qN=`w:${Xv}`,HN="FIS_v2",I4="https://firebaseinstallations.googleapis.com/v1",T4=60*60*1e3,S4="installations",C4="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},bo=new Co(S4,C4,N4);function WN(t){return t instanceof fr&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GN({projectId:t}){return`${I4}/projects/${t}/installations`}function KN(t){return{token:t.token,requestStatus:2,expiresIn:R4(t.expiresIn),creationTime:Date.now()}}async function QN(t,e){const r=(await e.json()).error;return bo.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function YN({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function A4(t,{refreshToken:e}){const n=YN(t);return n.append("Authorization",P4(e)),n}async function XN(t){const e=await t();return e.status>=500&&e.status<600?t():e}function R4(t){return Number(t.replace("s","000"))}function P4(t){return`${HN} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k4({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=GN(t),s=YN(t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={fid:n,authVersion:HN,appId:t.appId,sdkVersion:qN},l={method:"POST",headers:s,body:JSON.stringify(o)},c=await XN(()=>fetch(r,l));if(c.ok){const d=await c.json();return{fid:d.fid||n,registrationStatus:2,refreshToken:d.refreshToken,authToken:KN(d.authToken)}}else throw await QN("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JN(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j4(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4=/^[cdef][\w-]{21}$/,Ag="";function O4(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=L4(t);return D4.test(n)?n:Ag}catch{return Ag}}function L4(t){return j4(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lf(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZN=new Map;function e1(t,e){const n=Lf(t);t1(n,e),V4(n,e)}function t1(t,e){const n=ZN.get(t);if(n)for(const r of n)r(e)}function V4(t,e){const n=M4();n&&n.postMessage({key:t,fid:e}),F4()}let Yi=null;function M4(){return!Yi&&"BroadcastChannel"in self&&(Yi=new BroadcastChannel("[Firebase] FID Change"),Yi.onmessage=t=>{t1(t.data.key,t.data.fid)}),Yi}function F4(){ZN.size===0&&Yi&&(Yi.close(),Yi=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U4="firebase-installations-database",$4=1,Io="firebase-installations-store";let $p=null;function Jv(){return $p||($p=AT(U4,$4,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Io)}}})),$p}async function Rh(t,e){const n=Lf(t),s=(await Jv()).transaction(Io,"readwrite"),i=s.objectStore(Io),o=await i.get(n);return await i.put(e,n),await s.done,(!o||o.fid!==e.fid)&&e1(t,e.fid),e}async function n1(t){const e=Lf(t),r=(await Jv()).transaction(Io,"readwrite");await r.objectStore(Io).delete(e),await r.done}async function Vf(t,e){const n=Lf(t),s=(await Jv()).transaction(Io,"readwrite"),i=s.objectStore(Io),o=await i.get(n),l=e(o);return l===void 0?await i.delete(n):await i.put(l,n),await s.done,l&&(!o||o.fid!==l.fid)&&e1(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zv(t){let e;const n=await Vf(t.appConfig,r=>{const s=B4(r),i=z4(t,s);return e=i.registrationPromise,i.installationEntry});return n.fid===Ag?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function B4(t){const e=t||{fid:O4(),registrationStatus:0};return r1(e)}function z4(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(bo.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=q4(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:H4(t)}:{installationEntry:e}}async function q4(t,e){try{const n=await k4(t,e);return Rh(t.appConfig,n)}catch(n){throw WN(n)&&n.customData.serverCode===409?await n1(t.appConfig):await Rh(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function H4(t){let e=await gb(t.appConfig);for(;e.registrationStatus===1;)await JN(100),e=await gb(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await Zv(t);return r||n}return e}function gb(t){return Vf(t,e=>{if(!e)throw bo.create("installation-not-found");return r1(e)})}function r1(t){return W4(t)?{fid:t.fid,registrationStatus:0}:t}function W4(t){return t.registrationStatus===1&&t.registrationTime+zN<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G4({appConfig:t,heartbeatServiceProvider:e},n){const r=K4(t,n),s=A4(t,n),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const o={installation:{sdkVersion:qN,appId:t.appId}},l={method:"POST",headers:s,body:JSON.stringify(o)},c=await XN(()=>fetch(r,l));if(c.ok){const d=await c.json();return KN(d)}else throw await QN("Generate Auth Token",c)}function K4(t,{fid:e}){return`${GN(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function e_(t,e=!1){let n;const r=await Vf(t.appConfig,i=>{if(!s1(i))throw bo.create("not-registered");const o=i.authToken;if(!e&&X4(o))return i;if(o.requestStatus===1)return n=Q4(t,e),i;{if(!navigator.onLine)throw bo.create("app-offline");const l=Z4(i);return n=Y4(t,l),l}});return n?await n:r.authToken}async function Q4(t,e){let n=await yb(t.appConfig);for(;n.authToken.requestStatus===1;)await JN(100),n=await yb(t.appConfig);const r=n.authToken;return r.requestStatus===0?e_(t,e):r}function yb(t){return Vf(t,e=>{if(!s1(e))throw bo.create("not-registered");const n=e.authToken;return e6(n)?{...e,authToken:{requestStatus:0}}:e})}async function Y4(t,e){try{const n=await G4(t,e),r={...e,authToken:n};return await Rh(t.appConfig,r),n}catch(n){if(WN(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await n1(t.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Rh(t.appConfig,r)}throw n}}function s1(t){return t!==void 0&&t.registrationStatus===2}function X4(t){return t.requestStatus===2&&!J4(t)}function J4(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+T4}function Z4(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}function e6(t){return t.requestStatus===1&&t.requestTime+zN<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t6(t){const e=t,{installationEntry:n,registrationPromise:r}=await Zv(e);return r?r.catch(console.error):e_(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n6(t,e=!1){const n=t;return await r6(n),(await e_(n,e)).token}async function r6(t){const{registrationPromise:e}=await Zv(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s6(t){if(!t||!t.options)throw Bp("App Configuration");if(!t.name)throw Bp("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Bp(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function Bp(t){return bo.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i1="installations",i6="installations-internal",o6=t=>{const e=t.getProvider("app").getImmediate(),n=s6(e),r=Ti(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},a6=t=>{const e=t.getProvider("app").getImmediate(),n=Ti(e,i1).getImmediate();return{getId:()=>t6(n),getToken:s=>n6(n,s)}};function l6(){Cr(new hr(i1,o6,"PUBLIC")),Cr(new hr(i6,a6,"PRIVATE"))}l6();Ln(BN,Xv);Ln(BN,Xv,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ph="analytics",c6="firebase_id",u6="origin",d6=60*1e3,h6="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",t_="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tn=new Jh("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f6={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Gn=new Co("analytics","Analytics",f6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p6(t){if(!t.startsWith(t_)){const e=Gn.create("invalid-gtag-resource",{gtagURL:t});return Tn.warn(e.message),""}return t}function o1(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function m6(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function g6(t,e){const n=m6("firebase-js-sdk-policy",{createScriptURL:p6}),r=document.createElement("script"),s=`${t_}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function y6(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function v6(t,e,n,r,s,i){const o=r[s];try{if(o)await e[o];else{const c=(await o1(n)).find(d=>d.measurementId===s);c&&await e[c.appId]}}catch(l){Tn.error(l)}t("config",s,i)}async function _6(t,e,n,r,s){try{let i=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const l=await o1(n);for(const c of o){const d=l.find(h=>h.measurementId===c),f=d&&e[d.appId];if(f)i.push(f);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),t("event",r,s||{})}catch(i){Tn.error(i)}}function x6(t,e,n,r){async function s(i,...o){try{if(i==="event"){const[l,c]=o;await _6(t,e,n,l,c)}else if(i==="config"){const[l,c]=o;await v6(t,e,n,r,l,c)}else if(i==="consent"){const[l,c]=o;t("consent",l,c)}else if(i==="get"){const[l,c,d]=o;t("get",l,c,d)}else if(i==="set"){const[l]=o;t("set",l)}else t(i,...o)}catch(l){Tn.error(l)}}return s}function w6(t,e,n,r,s){let i=function(...o){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=x6(i,t,e,n),{gtagCore:i,wrappedGtag:window[s]}}function E6(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(t_)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b6=30,I6=1e3;class T6{constructor(e={},n=I6){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const a1=new T6;function S6(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function C6(t){var o;const{appId:e,apiKey:n}=t,r={method:"GET",headers:S6(n)},s=h6.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let l="";try{const c=await i.json();(o=c.error)!=null&&o.message&&(l=c.error.message)}catch{}throw Gn.create("config-fetch-failed",{httpStatus:i.status,responseMessage:l})}return i.json()}async function N6(t,e=a1,n){const{appId:r,apiKey:s,measurementId:i}=t.options;if(!r)throw Gn.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw Gn.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new P6;return setTimeout(async()=>{l.abort()},d6),l1({appId:r,apiKey:s,measurementId:i},o,l,e)}async function l1(t,{throttleEndTimeMillis:e,backoffCount:n},r,s=a1){var l;const{appId:i,measurementId:o}=t;try{await A6(r,e)}catch(c){if(o)return Tn.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:o};throw c}try{const c=await C6(t);return s.deleteThrottleMetadata(i),c}catch(c){const d=c;if(!R6(d)){if(s.deleteThrottleMetadata(i),o)return Tn.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:i,measurementId:o};throw c}const f=Number((l=d==null?void 0:d.customData)==null?void 0:l.httpStatus)===503?rw(n,s.intervalMillis,b6):rw(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+f,backoffCount:n+1};return s.setThrottleMetadata(i,h),Tn.debug(`Calling attemptFetch again in ${f} millis`),l1(t,h,r,s)}}function A6(t,e){return new Promise((n,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(n,s);t.addEventListener(()=>{clearTimeout(i),r(Gn.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function R6(t){if(!(t instanceof fr)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class P6{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function k6(t,e,n,r,s){if(s&&s.global){t("event",n,r);return}else{const i=await e,o={...r,send_to:i};t("event",n,o)}}async function j6(t,e,n,r){if(r&&r.global){const s={};for(const i of Object.keys(n))s[`user_properties.${i}`]=n[i];return t("set",s),Promise.resolve()}else{const s=await e;t("config",s,{update:!0,user_properties:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function D6(){if(Dy())try{await ST()}catch(t){return Tn.warn(Gn.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return Tn.warn(Gn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function O6(t,e,n,r,s,i,o){const l=N6(t);l.then(m=>{n[m.measurementId]=m.appId,t.options.measurementId&&m.measurementId!==t.options.measurementId&&Tn.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>Tn.error(m)),e.push(l);const c=D6().then(m=>{if(m)return r.getId()}),[d,f]=await Promise.all([l,c]);E6(i)||g6(i,d.measurementId),s("js",new Date);const h=(o==null?void 0:o.config)??{};return h[u6]="firebase",h.update=!0,f!=null&&(h[c6]=f),s("config",d.measurementId,h),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L6{constructor(e){this.app=e}_delete(){return delete Ia[this.app.options.appId],Promise.resolve()}}let Ia={},vb=[];const _b={};let zp="dataLayer",V6="gtag",xb,n_,wb=!1;function M6(){const t=[];if(bT()&&t.push("This is a browser extension environment."),Fk()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,s)=>`(${s+1}) ${r}`).join(" "),n=Gn.create("invalid-analytics-context",{errorInfo:e});Tn.warn(n.message)}}function F6(t,e,n){M6();const r=t.options.appId;if(!r)throw Gn.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)Tn.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Gn.create("no-api-key");if(Ia[r]!=null)throw Gn.create("already-exists",{id:r});if(!wb){y6(zp);const{wrappedGtag:i,gtagCore:o}=w6(Ia,vb,_b,zp,V6);n_=i,xb=o,wb=!0}return Ia[r]=O6(t,vb,_b,e,xb,zp,n),new L6(t)}function U6(t=Zh()){t=et(t);const e=Ti(t,Ph);return e.isInitialized()?e.getImmediate():$6(t)}function $6(t,e={}){const n=Ti(t,Ph);if(n.isInitialized()){const s=n.getImmediate();if(xs(e,n.getOptions()))return s;throw Gn.create("already-initialized")}return n.initialize({options:e})}function B6(t,e,n){t=et(t),j6(n_,Ia[t.app.options.appId],e,n).catch(r=>Tn.error(r))}function z6(t,e,n,r){t=et(t),k6(n_,Ia[t.app.options.appId],e,n,r).catch(s=>Tn.error(s))}const Eb="@firebase/analytics",bb="0.10.19";function q6(){Cr(new hr(Ph,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return F6(r,s,n)},"PUBLIC")),Cr(new hr("analytics-internal",t,"PRIVATE")),Ln(Eb,bb),Ln(Eb,bb,"esm2020");function t(e){try{const n=e.getProvider(Ph).getImmediate();return{logEvent:(r,s,i)=>z6(n,r,s,i),setUserProperties:(r,s)=>B6(n,r,s)}}catch(n){throw Gn.create("interop-component-reg-failed",{reason:n})}}}q6();const H6={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},Mf=Ly(H6),kh=hS(Mf),ae=fN(Mf);Hi(Mf);U6(Mf);const r_=(t,e="")=>{try{return localStorage.getItem(t)??e}catch{return e}},Ib=()=>{var t;return((t=document.querySelector('meta[name="company-name"]'))==null?void 0:t.getAttribute("content"))||r_("empresa_nombre","OdontoCloud")},W6=()=>{var t;return((t=document.querySelector('meta[name="company-logo"]'))==null?void 0:t.getAttribute("content"))||r_("empresa_logo_url","")},Tb=()=>{var t;return((t=document.querySelector('meta[name="software-footer"]'))==null?void 0:t.getAttribute("content"))||r_("software_footer_text","Generado por OdontoCloud")},Zu=()=>{const t=new Date;return t.setHours(0,0,0,0),t},Fs=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e},qp=t=>{const e=new Date(t);return e.setHours(23,59,59,999),e},Fr=(t,e)=>{const n=new Date(t);return n.setDate(n.getDate()+e),n},Sb=t=>{const e=new Date(t),n=e.getDay(),r=(n===0?-6:1)-n;return e.setDate(e.getDate()+r),e.setHours(0,0,0,0),e},Cb=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();var Vb;const Fn=typeof navigator<"u"&&((Vb=navigator.language)!=null&&Vb.startsWith("es"))?"es-ES":"en-US",Hp=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`},Bo=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),G6=t=>{try{const e=new URLSearchParams(t||""),n=e.get("date")||e.get("day")||e.get("d")||e.get("fecha")||e.get("selectedDate")||(typeof sessionStorage<"u"?sessionStorage.getItem("agenda.targetDate"):""),r=String(n||"").slice(0,10);if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return null;const[s,i,o]=r.split("-").map(c=>parseInt(c,10));return new Date(s,(i||1)-1,o||1,0,0,0,0)}catch{return null}};function K6(){const t=gn(),[e,n]=I.useState("day"),[r,s]=I.useState(Zu()),[i,o]=I.useState(Zu()),[l,c]=I.useState(!0),[d,f]=I.useState([]),[h,m]=I.useState(""),[v,P]=I.useState(""),[A,C]=I.useState("");I.useEffect(()=>{const $=G6(t.search);if($){const re=Fs($);s(re),o(re),n("day");try{sessionStorage.removeItem("agenda.targetDate")}catch{}}},[t.search]),I.useEffect(()=>{c(!0);const $=be(ae,"citas"),re=ut($,xn("fecha","asc")),de=Bn(re,Ce=>{const Ne=Ce.docs.map(ke=>{const fe=ke.data(),De=fe.horaInicio||fe.hora||"00:00",[Fe="0",tt="0"]=De.split(":"),Q=parseInt(Fe,10)||0,oe=parseInt(tt,10)||0;let z;if(fe.fecha&&fe.fecha.toDate)z=fe.fecha.toDate(),z.setHours(Q,oe,0,0);else if(typeof fe.fecha=="string"){const[_e,xe,Me]=fe.fecha.split("-");z=new Date(parseInt(_e,10),parseInt(xe,10)-1,parseInt(Me,10),Q,oe,0,0)}else fe.fecha instanceof Date?(z=new Date(fe.fecha),z.setHours(Q,oe,0,0)):(z=new Date,z.setHours(Q,oe,0,0));const ie=fe.documentoPaciente||fe.docPaciente||fe.pacienteDocumento||fe.documento||"",le=fe.celularPaciente||fe.telefonoPaciente||fe.celular||fe.telefono||"";return{id:ke.id,raw:fe,fecha:z,horaInicio:De,paciente:fe.paciente||fe.pacienteNombre||"Sin nombre",doctor:fe.doctor||fe.doctorNombre||"",sucursal:fe.sucursal||"",espacio:fe.espacio||fe.consultorio||"",comentario:fe.comentario||"",estado:fe.estado||"En espera",recordatorio:fe.recordatorio||"",documento:ie,telefono:le}});let je,Ee;if(e==="day")je=Fs(r),Ee=qp(r);else if(e==="week"){const ke=Sb(r),fe=Fr(ke,6);je=Fs(ke),Ee=qp(fe)}else{const ke=Fs(r),fe=Fr(ke,-30),De=Fr(ke,60);je=Fs(fe),Ee=qp(De)}const ot=Ne.filter(ke=>ke.fecha>=je&&ke.fecha<=Ee);f(ot),c(!1)},Ce=>{console.error("Error leyendo citas:",Ce),f([]),c(!1)});return()=>de()},[e,r]);const y=I.useMemo(()=>{const $=new Set;return d.forEach(re=>re.sucursal&&$.add(re.sucursal)),Array.from($)},[d]),_=I.useMemo(()=>{const $=new Set;return d.forEach(re=>re.doctor&&$.add(re.doctor)),Array.from($)},[d]),w=I.useMemo(()=>{const $=A.trim().toLowerCase();return d.filter(re=>{if(h&&re.sucursal!==h||v&&re.doctor!==v)return!1;if(!$)return!0;const de=[re.paciente,re.doctor,re.comentario,re.documento,re.sucursal,re.espacio,re.estado],Ce=re.raw?JSON.stringify(re.raw):"";return[...de,Ce].filter(Boolean).some(je=>String(je).toLowerCase().includes($))})},[d,h,v,A]),T=I.useMemo(()=>l?"Ocupacin: cargando...":w.length===0?"Ocupacin: sin citas para el rango seleccionado.":`Ocupacin: ${w.length} cita${w.length!==1?"s":""} en el rango actual.`,[w,l]),V=I.useMemo(()=>{const $=new Date(i.getFullYear(),i.getMonth(),1),re=($.getDay()+6)%7,de=new Date($);de.setDate(de.getDate()-re);const Ce=[];for(let Ne=0;Ne<6;Ne++){const je=[];for(let Ee=0;Ee<7;Ee++){const ot=new Date(de),ke=ot.getMonth()===i.getMonth(),fe=Cb(ot,Zu()),De=Cb(ot,r);je.push({date:ot,isCurrentMonth:ke,isToday:fe,isSelected:De}),de.setDate(de.getDate()+1)}Ce.push(je)}return Ce},[i,r]),U=()=>{const $=new Date(i);$.setMonth($.getMonth()-1),o($)},b=()=>{const $=new Date(i);$.setMonth($.getMonth()+1),o($)},E=$=>{s(Fs($)),o(Fs($)),n("day")},x=I.useMemo(()=>i.toLocaleDateString(Fn,{month:"long",year:"numeric"}),[i]),S=I.useMemo(()=>{if(e==="day")return r.toLocaleDateString(Fn,{weekday:"long",day:"2-digit",month:"long",year:"numeric"});if(e==="week"){const $=Sb(r),re=Fr($,6);return $.toLocaleDateString(Fn,{day:"2-digit",month:"short"})+" - "+re.toLocaleDateString(Fn,{day:"2-digit",month:"short",year:"numeric"})}return"ltimas citas (detalle)"},[e,r]),j=()=>{s(e==="day"?Fr(r,-1):e==="week"?Fr(r,-7):Fr(r,-1))},L=()=>{s(e==="day"?Fr(r,1):e==="week"?Fr(r,7):Fr(r,1))},k=()=>{const $=Zu();s($),o($),n("day")},Y=()=>{var oe;const $=z=>String(z??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),re=Ib(),de=W6(),Ce=Tb(),Ne=h||"",je=v||"",Ee=new Date;Ee.setHours(0,0,0,0);const ot=w.length===0?'<tr class="empty"><td colspan="10">No hay citas registradas para este rango.</td></tr>':w.map((z,ie)=>{var O,G,D,H,K,pe;const le=z.fecha.toLocaleTimeString(Fn,{hour:"2-digit",minute:"2-digit",hour12:!0}),_e=z.documento||((O=z.raw)==null?void 0:O.documento)||((G=z.raw)==null?void 0:G.nroDocumento)||"",xe=((D=z.raw)==null?void 0:D.celularPaciente)||((H=z.raw)==null?void 0:H.celular)||"",Me=((K=z.raw)==null?void 0:K.telefonoPaciente)||((pe=z.raw)==null?void 0:pe.telefono)||"",Ae=new Date(z.fecha.getFullYear(),z.fecha.getMonth(),z.fecha.getDate());let Le="Futura";return Ae.getTime()===Ee.getTime()?Le="Hoy":Ae.getTime()<Ee.getTime()&&(Le="Pasada"),`<tr class="${ie%2?"zebra":""}">
              <td class="mono">${$(le)}</td>
              <td>${$(z.paciente)}</td>
              <td class="mono">${$(_e)}</td>
              <td class="mono">${$(xe)}</td>
              <td class="mono">${$(Me)}</td>
              <td>${$(z.doctor)}</td>
              <td>${$(z.espacio)}</td>
              <td>${$(z.comentario)}</td>
              <td class="status">${$(z.estado)}</td>
              <td class="actual">${$(Le)}</td>
            </tr>`}).join(""),fe=`<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Agenda  ${$(re)}</title>
  <style>
    @page { size: A4 portrait; margin: 14mm 16mm; }
    * { box-sizing: border-box; }
    html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    body { font-family: "Segoe UI", Roboto, Arial, sans-serif; color:#0f172a; line-height:1.35; }

    /* Cabecera */
    .hdr {
      display:flex; flex-direction:column; align-items:center; text-align:center;
      margin-bottom:14px;
    }
    .logo {
      max-height:120px; width:auto; max-width:100%; object-fit:contain;
      filter: drop-shadow(0 1px 0 rgba(0,0,0,.04));
    }
    .brand {
      margin-top:4px; font-weight:800; letter-spacing:.5px; text-transform:uppercase;
      font-size:26px; color:#0a86d8;
    }
    .sub { margin-top:2px; font-size:12px; color:#64748b; }

    /* Tarjeta info Sede/Doctor */
    .info-card {
      width:100%; display:flex; justify-content:center; margin:8px 0 16px;
    }
    .info {
      width:70%; border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; border-collapse:separate;
      font-size:12px;
    }
    .info-row { display:flex; border-top:1px solid #e5e7eb; }
    .info-row:first-child { border-top:0; }
    .label {
      width:22%; padding:8px 10px; background:#f8fafc; font-weight:600; color:#334155; border-right:1px solid #e5e7eb;
    }
    .value { flex:1; padding:8px 10px; }

    /* Tabla principal */
    table { width:100%; border-collapse:separate; border-spacing:0; font-size:12px; }
    thead th {
      background:#0f172a; color:#ffffff; text-align:center; font-weight:700;
      padding:9px 8px; position:relative;
    }
    thead th + th { box-shadow: inset 1px 0 0 rgba(255,255,255,.08); }
    tbody td {
      padding:8px 8px; vertical-align:top; border-bottom:1px solid #e5e7eb;
    }
    tbody tr.zebra td { background:#fafafa; }
    tbody tr.empty td {
      padding:16px; color:#6b7280; text-align:center; background:#fafafa;
      border:1px dashed #e5e7eb; border-radius:8px;
    }
    td.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    td.status { white-space:nowrap; }
    td.actual { font-weight:600; }
    /* Bordes exteriores suaves */
    .tbl-wrap { border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; }

    /* Notas pie */
    .note { margin-top:10px; font-size:10px; color:#6b7280; }

    /* Evitar cortes feos */
    tr, .hdr, .info-card { page-break-inside: avoid; }
  </style>
</head>
<body>
  <div class="hdr">
    ${de?`<img src="${de}" alt="Logo" class="logo">`:""}
    <div class="brand">${$(re)}</div>
    <div class="sub">Agenda de citas  ${$(S)}</div>
  </div>

  <div class="info-card">
    <div class="info">
      <div class="info-row"><div class="label">Sede</div><div class="value">${$(Ne)}</div></div>
      <div class="info-row"><div class="label">Doctor</div><div class="value">${$(je)}</div></div>
    </div>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th style="width:9%">Hora</th>
          <th style="width:17%">Nombre paciente</th>
          <th style="width:12%">Documento</th>
          <th style="width:12%">Celular</th>
          <th style="width:12%">Telfono</th>
          <th style="width:10%">Doctor</th>
          <th style="width:11%">Espacio</th>
          <th>Comentario</th>
          <th style="width:9%">Estado</th>
          <th style="width:9%">Actualidad</th>
        </tr>
      </thead>
      <tbody>${ot}</tbody>
    </table>
  </div>

  <div class="note">
    ${$(Ce)}  ${$(new Date().toLocaleString(Fn))}
  </div>

  <script>
    window.addEventListener('load', function() {
      try { window.focus(); window.print(); } catch (e) {}
    });
  <\/script>
</body>
</html>`,De=new Blob([fe],{type:"text/html;charset=utf-8"}),Fe=URL.createObjectURL(De),tt=window.open(Fe,"_blank","noopener,noreferrer,width=900,height=700");if(!tt){alert("El navegador bloque la ventana de impresin. Permite pop-ups para este sitio."),URL.revokeObjectURL(Fe);return}const Q=()=>{try{URL.revokeObjectURL(Fe)}catch{}};(oe=tt.addEventListener)==null||oe.call(tt,"load",Q),setTimeout(Q,15e3)},We=()=>alert("Funcin de confirmar citas se integrar con n8n / correo."),Dt=()=>k(),Lt=()=>{if(w.length===0){alert("No hay citas para exportar.");return}const $=Ib(),re=Tb(),de=[`Empresa: ${$}`],Ce=["Fecha","Hora","Paciente","Doctor","Espacio","Comentario"],Ne=w.map(Fe=>{const tt=Fe.fecha.toLocaleDateString(Fn),Q=Fe.fecha.toLocaleTimeString(Fn,{hour:"2-digit",minute:"2-digit",hour12:!0});return[tt,Q,Fe.paciente||"",Fe.doctor||"",Fe.espacio||"",(Fe.comentario||"").replace(/\r?\n/g," ")]}),je=[re],Ee=[de,[],Ce,...Ne,[],je].map(Fe=>(Fe||[]).map(tt=>`"${String(tt??"").replace(/"/g,'""')}"`).join(",")).join(`
`),ot=`citas_${$.toLowerCase().replace(/\s+/g,"_")}_${Hp(Fs(r))}`+(e==="week"?"_semana":e==="detail"?"_detalle":"")+".csv",ke=new Blob(["\uFEFF"+Ee],{type:"text/csv;charset=utf-8;"}),fe=URL.createObjectURL(ke),De=document.createElement("a");De.href=fe,De.download=ot,De.click(),URL.revokeObjectURL(fe)},te=async($,re)=>{try{const de=Ge(ae,"citas",$);await zn(de,{estado:re})}catch(de){console.error("Error actualizando estado:",de),alert("No se pudo actualizar el estado de la cita.")}},ue=($,re)=>{if(!$){alert("Este paciente no tiene celular registrado.");return}const de=String($).replace(/\D/g,""),Ce=re.fecha.toLocaleDateString(Fn),Ne=re.fecha.toLocaleTimeString(Fn,{hour:"numeric",minute:"2-digit",hour12:!0}),je=encodeURIComponent(`Hola ${re.paciente}, le recordamos su cita odontolgica el ${Ce} a las ${Ne}. Por favor confirme su asistencia.`),Ee=`https://wa.me/${de}?text=${je}`;window.open(Ee,"_blank")},ye=async $=>{if(window.confirm(`Seguro que deseas eliminar la cita de ${$.paciente} del ${$.fecha.toLocaleDateString(Fn)}?`))try{const de=Ge(ae,"citas",$.id);await ps(de)}catch(de){console.error("Error eliminando cita:",de),alert(" No se pudo eliminar la cita.")}},Pe=()=>{const $=document.createElement("div");Object.assign($.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const re=document.createElement("div");Object.assign(re.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"}),re.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Nueva Cita</h2>
      <form id="formNuevaCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label style="font-weight:600;">Paciente existente</label>
        <div style="position:relative;">
          <input type="text" id="buscarPaciente" placeholder="Buscar por nombre, apellido o documento..." autocomplete="off"/>
          <div id="acResultados" style="position:absolute;left:0;right:0;top:calc(100% + 6px);z-index:10000;display:none;background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 8px 22px rgba(0,0,0,.12);max-height:240px;overflow:auto;"></div>
        </div>
        <small style="color:gray;">Si el paciente no existe, marca Registrar nuevo paciente.</small>

        <label style="display:flex;align-items:center;gap:8px;margin-top:5px;">
          <input type="checkbox" id="esNuevoPaciente" />
          <span>Registrar nuevo paciente</span>
        </label>

        <div id="nuevoPacienteCampos" style="display:none;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border-radius:8px;background:#f9f9f9;border:1px solid #ddd;">
          <h4 style="margin:0;text-align:center;color:#0a86d8;">Datos del paciente</h4>
          <div style="display:flex;gap:8px;">
            <input type="text" id="npNombre" placeholder="Nombre" style="flex:1;" />
            <input type="text" id="npApellido" placeholder="Apellido" style="flex:1;" />
          </div>
          <select id="npTipoDocumento">
            <option value="">Tipo de documento</option>
            <option value="CC">Cdula de Ciudadana</option>
            <option value="CE">Cdula de Extranjera</option>
            <option value="TI">Tarjeta de Identidad</option>
            <option value="PA">Pasaporte</option>
            <option value="DI">Documento Internacional</option>
            <option value="OTRO">Otro</option>
          </select>
          <input type="text" id="npDocumento" placeholder="Nmero de documento" />
          <input type="email" id="npCorreo" placeholder="Correo electrnico" />
          <div style="display:flex;gap:5px;">
            <select id="npIndicativo" style="width:40%;">
              <option value="+57"> +57</option>
              <option value="+1"> +1</option>
              <option value="+34"> +34</option>
              <option value="+52"> +52</option>
              <option value="+54"> +54</option>
              <option value="+593"> +593</option>
              <option value="+56"> +56</option>
              <option value="+58"> +58</option>
            </select>
            <input type="tel" id="npCelular" placeholder="Celular (obligatorio)" style="flex:1;" />
          </div>
          <input type="tel" id="npTelefono" placeholder="Telfono fijo (opcional)" />
          <label style="font-weight:500;">Fecha de nacimiento:</label>
          <input type="date" id="npNacimiento" />
          <select id="npSexo">
            <option value="">Sexo</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
            <option value="Otro">Otro</option>
          </select>
          <textarea id="npComentario" placeholder="Comentario o antecedentes del paciente" rows="2"></textarea>
        </div>

        <hr style="margin:10px 0;border:none;border-top:1px solid #ddd;" />
        <h4 style="margin:0;text-align:center;color:#0a86d8;">Detalles de la cita</h4>
        <input type="text" id="ncDoctor" placeholder="Doctor asignado" required />
        <input type="date" id="ncFecha" required value="${Hp(r)}" />
        <input type="time" id="ncHora" required />
        <input type="text" id="ncEspacio" placeholder="Espacio fsico / Sala" />
        <textarea id="ncComentario" placeholder="Comentario sobre la cita" rows="3"></textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarModal" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    `;const de=document.createElement("style");de.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      input, select, textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      input:focus, select:focus, textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
      .ac-item { padding: 8px 10px; display:flex; gap:8px; align-items:baseline; cursor:pointer; }
      .ac-item:hover, .ac-item.active { background:#f5f7fb; }
      .ac-name { font-weight:600; } .ac-doc { color:#64748b; font-size:12px; } .ac-tel { margin-left:auto; font-size:12px; color:#0f172a; }
      .ac-empty { padding:10px; color:#9aa4b2; font-size:13px; }
    `,document.head.appendChild(de),$.appendChild(re),document.body.appendChild($);const Ce=re.querySelector("#esNuevoPaciente"),Ne=re.querySelector("#nuevoPacienteCampos"),je=re.querySelector("#buscarPaciente"),Ee=re.querySelector("#acResultados");Ce.addEventListener("change",()=>{Ne.style.display=Ce.checked?"flex":"none",Ce.checked&&(Ee.style.display="none")}),re.querySelector("#btnCancelarModal").addEventListener("click",()=>$.remove());let ot=null,ke=null,fe=-1,De=[];const Fe=le=>{if(De=le||[],fe=-1,!le||le.length===0){Ee.innerHTML='<div class="ac-empty">Sin resultados</div>',Ee.style.display="block";return}Ee.innerHTML=le.map((_e,xe)=>`
            <div class="ac-item" data-index="${xe}" data-id="${_e.id}">
              <span class="ac-name">${_e.nombre}</span>
              <span class="ac-doc"> ${_e.documento||"s/doc"}</span>
              <span class="ac-tel">${_e.celular||_e.telefono||""}</span>
            </div>`).join(""),Ee.style.display="block",[...Ee.querySelectorAll(".ac-item")].forEach(_e=>{_e.addEventListener("click",()=>{const xe=Number(_e.getAttribute("data-index"));tt(xe)})})},tt=le=>{const _e=De[le];_e&&(ke=_e,je.value=_e.nombre,Ee.style.display="none",Ce.checked=!1,Ne.style.display="none")},Q=le=>{De.length&&(fe=(fe+le+De.length)%De.length,[...Ee.querySelectorAll(".ac-item")].forEach((_e,xe)=>{xe===fe?_e.classList.add("active"):_e.classList.remove("active")}))},oe=(le,_e)=>le.nombreCompleto||le.paciente||[le.nombres,le.apellidos].filter(Boolean).join(" ")||_e,z=async le=>{const _e=(le||"").toString().trim(),xe=Bo(_e);if(!xe||xe.length<2)return[];if(/^\d{5,}$/.test(_e))try{const Me=ut(be(ae,"pacientes"),nt("documento","==",_e)),Ae=ut(be(ae,"pacientes"),nt("nroDocumento","==",_e)),[Le,O]=await Promise.all([Je(Me),Je(Ae)]),G=Le.empty?O:Le;if(!G.empty)return G.docs.slice(0,10).map(D=>{const H=D.data()||{};return{id:D.id,nombre:oe(H,D.id),documento:H.documento||H.nroDocumento||D.id,celular:H.celularPaciente||H.celular||"",telefono:H.telefonoPaciente||H.telefono||""}})}catch{}try{const Me=ut(be(ae,"pacientes"),xn("nombre_busqueda"),ZE(xe),eb(xe+""),ba(10)),Ae=await Je(Me);if(!Ae.empty)return Ae.docs.map(Le=>{const O=Le.data()||{};return{id:Le.id,nombre:oe(O,Le.id),documento:O.documento||O.nroDocumento||Le.id,celular:O.celularPaciente||O.celular||"",telefono:O.telefonoPaciente||O.telefono||""}})}catch{}try{const Me=ut(be(ae,"pacientes"),xn("creado","desc"),ba(50));return(await Je(Me)).docs.map(G=>({id:G.id,...G.data()||{}})).map(G=>({id:G.id,nombre:oe(G,G.id),documento:G.documento||G.nroDocumento||G.id,celular:G.celularPaciente||G.celular||"",telefono:G.telefonoPaciente||G.telefono||"",_norm:Bo(`${G.nombreCompleto||G.paciente||""} ${G.nombres||""} ${G.apellidos||""} ${G.documento||G.nroDocumento||""}`)})).filter(G=>G._norm.includes(xe)).slice(0,10).map(({_norm:G,...D})=>D)}catch{}return[]};je.addEventListener("input",()=>{ke=null;const le=je.value;if(clearTimeout(ot),!le||le.trim().length<2){Ee.style.display="none";return}ot=setTimeout(async()=>{const _e=await z(le.trim());Fe(_e)},220)}),je.addEventListener("keydown",le=>{Ee.style.display==="block"&&(le.key==="ArrowDown"?(le.preventDefault(),Q(1)):le.key==="ArrowUp"?(le.preventDefault(),Q(-1)):le.key==="Enter"?fe>=0&&(le.preventDefault(),tt(fe)):le.key==="Escape"&&(Ee.style.display="none"))}),document.addEventListener("click",le=>{re.contains(le.target)&&!Ee.contains(le.target)&&le.target!==je&&(Ee.style.display="none")},{capture:!0});const ie=re.querySelector("#formNuevaCita");ie.addEventListener("submit",async le=>{le.preventDefault();const _e=Ce.checked,xe=(ie.querySelector("#buscarPaciente").value||"").trim(),Me=ie.querySelector("#ncDoctor").value.trim(),Ae=ie.querySelector("#ncFecha").value,Le=ie.querySelector("#ncHora").value,O=ie.querySelector("#ncEspacio").value.trim(),G=ie.querySelector("#ncComentario").value.trim();if(!Ae||!Le){alert(" Debes seleccionar fecha y hora para la cita.");return}if(!Me){alert(" Indica el doctor asignado.");return}try{let D=null,H=null,K="",pe="",Te="";if(_e){const bt=(ie.querySelector("#npNombre").value||"").trim(),ze=(ie.querySelector("#npApellido").value||"").trim();if(K=`${bt} ${ze}`.trim(),!K){alert(" Debes indicar nombre y apellido para el nuevo paciente.");return}const yt=(ie.querySelector("#npDocumento").value||"").trim(),lt=(ie.querySelector("#npCelular").value||"").trim(),Kt=(ie.querySelector("#npTelefono").value||"").trim();if(!lt&&!Kt){alert(" Debes registrar al menos un telfono (celular o fijo) del paciente o de un acudiente.");return}if(D=yt||K.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"_"),H=Ge(ae,"pacientes",D),!(await qc(H)).exists()){const Vt=Bo(K);await Wa(H,{nombres:bt,apellidos:ze,nombreCompleto:K,paciente:K,nombre_busqueda:Vt,variantes_busqueda:[Vt,Bo(bt),Bo(ze)],tipoDocumento:ie.querySelector("#npTipoDocumento").value,documento:yt,correo:(ie.querySelector("#npCorreo").value||"").trim(),indicativo:ie.querySelector("#npIndicativo").value,celular:lt,telefono:Kt,celularPaciente:lt,telefonoPaciente:Kt,fechaNacimiento:ie.querySelector("#npNacimiento").value,sexo:ie.querySelector("#npSexo").value,notas:(ie.querySelector("#npComentario").value||"").trim(),creado:new Date().toISOString(),activo:!0,citas:[]},{merge:!0})}pe=lt,Te=Kt}else if(ke)D=ke.id,K=ke.nombre,H=Ge(ae,"pacientes",D),pe=ke.celular||"",Te=ke.telefono||"";else{if(!xe){alert(" Por favor, escribe o selecciona un paciente.");return}const bt=ut(be(ae,"pacientes"),nt("documento","==",xe)),ze=ut(be(ae,"pacientes"),nt("nroDocumento","==",xe)),[yt,lt]=await Promise.all([Je(bt),Je(ze)]),Kt=yt.empty?lt:yt;if(Kt.empty){let Ze=null;try{const Vt=Bo(xe),Dr=ut(be(ae,"pacientes"),xn("nombre_busqueda"),ZE(Vt),eb(Vt+""),ba(1)),pr=await Je(Dr);if(!pr.empty){const Ns=pr.docs[0],Vn=Ns.data()||{};Ze={id:Ns.id,ref:Ns.ref,nombre:Vn.nombreCompleto||Vn.paciente||[Vn.nombres,Vn.apellidos].filter(Boolean).join(" "),cel:Vn.celularPaciente||Vn.celular||"",tel:Vn.telefonoPaciente||Vn.telefono||""}}}catch{}Ze?(D=Ze.id,H=Ze.ref,K=Ze.nombre||xe,pe=Ze.cel||"",Te=Ze.tel||""):K=xe}else{const Ze=Kt.docs[0],Vt=Ze.data()||{};D=Ze.id,H=Ze.ref,K=Vt.nombreCompleto||Vt.paciente||[Vt.nombres,Vt.apellidos].filter(Boolean).join(" ")||xe,pe=Vt.celularPaciente||Vt.celular||"",Te=Vt.telefonoPaciente||Vt.telefono||""}}if(!(pe||Te||"").trim()){alert(" Este paciente no tiene ningn telfono registrado. Edita sus datos y agrega un nmero antes de guardar la cita.");return}const at={paciente:K||"Paciente",pacienteId:D||null,doctor:Me,fecha:Ae,horaInicio:Le,espacio:O,comentario:G,estado:"En espera",creado:new Date().toISOString(),celularPaciente:pe||"",telefonoPaciente:Te||""},ft=await wn(be(ae,"citas"),at);H&&await Wa(H,{citas:rF(ft.id)},{merge:!0}),alert(" Cita registrada correctamente y vinculada al paciente."),$.remove()}catch(D){console.error(" Error al guardar cita:",D),alert(" Error al guardar la cita. Revisa la consola para ms detalles.")}})},Qe=$=>{var ot,ke;const re=document.createElement("div");Object.assign(re.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const de=document.createElement("div");Object.assign(de.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"});const Ce=(ot=$.raw)!=null&&ot.fecha&&typeof $.raw.fecha=="string"?$.raw.fecha:Hp($.fecha),Ne=((ke=$.raw)==null?void 0:ke.horaInicio)||$.fecha.toTimeString().slice(0,5);de.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Editar Cita</h2>
      <form id="formEditarCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label>Paciente</label>
        <input type="text" id="editPaciente" value="${$.paciente||""}" />

        <label>Doctor asignado</label>
        <input type="text" id="editDoctor" value="${$.doctor||""}" />

        <div style="display:flex;gap:8px;">
          <div style="flex:1;">
            <label>Fecha</label>
            <input type="date" id="editFecha" value="${Ce}" />
          </div>
          <div style="flex:1;">
            <label>Hora</label>
            <input type="time" id="editHora" value="${Ne}" />
          </div>
        </div>

        <label>Espacio fsico / Sala</label>
        <input type="text" id="editEspacio" value="${$.espacio||""}" />

        <label>Estado</label>
        <select id="editEstado" class="estado-select">
          <option value="En espera" ${$.estado==="En espera"?"selected":""}>En espera</option>
          <option value="En sala" ${$.estado==="En sala"?"selected":""}>En sala</option>
          <option value="Atendiendo" ${$.estado==="Atendiendo"?"selected":""}>Atendiendo</option>
          <option value="Finalizada" ${$.estado==="Finalizada"?"selected":""}>Finalizada</option>
          <option value="pendiente" ${$.estado==="pendiente"?"selected":""}>Pendiente</option>
          <option value="No asisti" ${$.estado==="No asisti"?"selected":""}>No asisti</option>
        </select>

        <label>Comentario</label>
        <textarea id="editComentario" rows="3">${$.comentario||""}</textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarEdit" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar cambios</button>
        </div>
      </form>
    `;const je=document.createElement("style");je.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      #formEditarCita input, #formEditarCita select, #formEditarCita textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      #formEditarCita input:focus, #formEditarCita select:focus, #formEditarCita textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
    `,document.head.appendChild(je),re.appendChild(de),document.body.appendChild(re),de.querySelector("#btnCancelarEdit").addEventListener("click",()=>re.remove());const Ee=de.querySelector("#formEditarCita");Ee.addEventListener("submit",async fe=>{fe.preventDefault();const De=Ee.querySelector("#editPaciente").value.trim(),Fe=Ee.querySelector("#editDoctor").value.trim(),tt=Ee.querySelector("#editFecha").value,Q=Ee.querySelector("#editHora").value,oe=Ee.querySelector("#editEspacio").value.trim(),z=Ee.querySelector("#editEstado").value,ie=Ee.querySelector("#editComentario").value.trim();if(!De)return alert(" El nombre del paciente es obligatorio.");if(!tt||!Q)return alert(" Debes indicar fecha y hora.");try{const le=Ge(ae,"citas",$.id);await zn(le,{paciente:De,doctor:Fe,fecha:tt,horaInicio:Q,espacio:oe,estado:z,comentario:ie}),alert(" Cita actualizada correctamente."),re.remove()}catch(le){console.error(" Error al actualizar cita:",le),alert(" Error al actualizar la cita. Revisa la consola para ms detalles.")}})},Et=$=>{const re=$.fecha.toLocaleDateString(Fn),de=$.fecha.toLocaleTimeString(Fn,{hour:"numeric",minute:"2-digit",hour12:!0}),Ce=`${re}  ${de}`;return a.jsxs("tr",{className:"fade-in-row",onClick:()=>Qe($),style:{cursor:"pointer"},children:[a.jsx("td",{children:Ce}),a.jsx("td",{children:$.paciente}),a.jsx("td",{children:$.doctor}),a.jsx("td",{children:$.espacio}),a.jsx("td",{children:$.comentario}),a.jsx("td",{onClick:Ne=>{Ne.stopPropagation()},children:a.jsxs("select",{className:"estado-select",value:$.estado,onChange:Ne=>te($.id,Ne.target.value),children:[a.jsx("option",{value:"En espera",children:"En espera"}),a.jsx("option",{value:"En sala",children:"En sala"}),a.jsx("option",{value:"Atendiendo",children:"Atendiendo"}),a.jsx("option",{value:"Finalizada",children:"Finalizada"}),a.jsx("option",{value:"pendiente",children:"Pendiente"}),a.jsx("option",{value:"No asisti",children:"No asisti"})]})}),a.jsxs("td",{className:"acciones-cell",onClick:Ne=>{Ne.stopPropagation()},children:[$.telefono?a.jsx("button",{type:"button",className:"btn-whatsapp",onClick:Ne=>{Ne.stopPropagation(),ue($.telefono,$)},children:"WhatsApp"}):a.jsx("span",{className:"acciones-texto",children:"Sin celular"}),a.jsx("button",{type:"button",className:"btn-delete",onClick:Ne=>{Ne.stopPropagation(),ye($)},children:"Eliminar"}),$.recordatorio&&a.jsx("span",{className:"acciones-texto",children:$.recordatorio})]})]},$.id)};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"odc-topbar-green"}),a.jsx("div",{className:"odc-topbar-blue",children:"Agenda"}),a.jsx("section",{className:"odc-agenda-root",children:a.jsxs("div",{className:"odc-agenda-inner",children:[a.jsxs("aside",{className:"odc-left","aria-label":"Panel izquierdo - calendario y filtros",children:[a.jsxs("div",{className:"odc-mini-calendar-card",role:"region","aria-label":"Mini calendario",children:[a.jsxs("div",{className:"mini-cal-header",children:[a.jsx("button",{className:"cal-arrow",id:"miniCalPrev","aria-label":"Mes anterior",onClick:U,children:""}),a.jsx("div",{id:"miniCalMonthYear","aria-live":"polite",children:x}),a.jsx("button",{className:"cal-arrow",id:"miniCalNext","aria-label":"Mes siguiente",onClick:b,children:""})]}),a.jsxs("table",{className:"mini-month-table","aria-hidden":"false",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Lu"}),a.jsx("th",{children:"Ma"}),a.jsx("th",{children:"Mi"}),a.jsx("th",{children:"Ju"}),a.jsx("th",{children:"Vi"}),a.jsx("th",{children:"Sa"}),a.jsx("th",{children:"Do"})]})}),a.jsx("tbody",{id:"miniCalendar",children:V.map(($,re)=>a.jsx("tr",{children:$.map((de,Ce)=>a.jsx("td",{className:[de.isCurrentMonth?"":"empty",de.isToday?"today":"",de.isSelected?"selected":""].filter(Boolean).join(" "),onClick:()=>de.isCurrentMonth&&E(de.date),children:de.date.getDate()},Ce))},re))})]})]}),a.jsxs("div",{className:"odc-filters-card","aria-label":"Filtros de agenda",children:[a.jsx("label",{htmlFor:"filterSucursal",children:"Sucursal"}),a.jsxs("select",{id:"filterSucursal",value:h,onChange:$=>m($.target.value),children:[a.jsx("option",{value:"",children:" Todas "}),y.map($=>a.jsx("option",{value:$,children:$},$))]}),a.jsx("label",{htmlFor:"filterDoctor",children:"Doctores"}),a.jsxs("select",{id:"filterDoctor",value:v,onChange:$=>P($.target.value),children:[a.jsx("option",{value:"",children:" Todos "}),_.map($=>a.jsx("option",{value:$,children:$},$))]})]})]}),a.jsxs("main",{className:"odc-right","aria-label":"Panel principal - agenda",children:[a.jsxs("div",{className:"odc-header-bar",role:"region","aria-label":"Controles de la agenda",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[a.jsxs("div",{className:"odc-header-left",style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[a.jsx("h3",{className:"odc-title",style:{marginRight:8},children:"Agenda"}),a.jsxs("div",{className:"view-buttons",role:"tablist","aria-label":"Vistas",style:{display:"flex",gap:6},children:[a.jsx("button",{className:`btn view ${e==="day"?"active":""}`,"data-view":"day",role:"tab","aria-selected":e==="day",onClick:()=>n("day"),children:"Da"}),a.jsx("button",{className:`btn view ${e==="week"?"active":""}`,"data-view":"week",role:"tab","aria-selected":e==="week",onClick:()=>n("week"),children:"Semana"}),a.jsx("button",{className:`btn view ${e==="detail"?"active":""}`,"data-view":"detail",role:"tab","aria-selected":e==="detail",onClick:()=>n("detail"),children:"Detalle"})]}),a.jsxs("div",{className:"date-nav",style:{display:"flex",alignItems:"center",gap:6,flex:"0 0 auto"},children:[a.jsx("button",{className:"btn icon",id:"btnPrev","aria-label":"Anterior",onClick:j,children:""}),a.jsx("button",{className:"btn icon",id:"btnNext","aria-label":"Siguiente",onClick:L,children:""}),a.jsx("span",{id:"currentDateDisplay",className:"current-date","aria-live":"polite",style:{whiteSpace:"nowrap"},children:S}),a.jsx("button",{id:"btnHoy",className:"btn small",onClick:k,children:"Hoy"})]})]}),a.jsx("div",{className:"odc-header-right",style:{display:"flex",alignItems:"center",gap:8,flexShrink:0},children:a.jsxs("div",{className:"right-actions",style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("input",{id:"searchCitas",placeholder:"Buscar...",className:"search-input","aria-label":"Buscar citas",value:A,onChange:$=>C($.target.value)}),a.jsx("button",{id:"btnNuevaCita",className:"btn green","aria-label":"Nueva cita",onClick:Pe,children:"+ Nueva cita"})]})})]}),a.jsxs("div",{className:"odc-content-card",role:"region","aria-label":"Contenido agenda",children:[a.jsxs("div",{className:"tools-row",children:[a.jsx("div",{className:"tools-left",children:a.jsx("div",{id:"ocupacionInfo",className:"ocupacion-info",children:T})}),a.jsxs("div",{className:"tools-right",children:[a.jsx("button",{id:"btnPrint",className:"btn",title:"Imprimir agenda",onClick:Y,children:" Imprimir"}),a.jsx("button",{id:"btnConfirmar",className:"btn blue",title:"Confirmar citas",onClick:We,children:" Confirmar"}),a.jsx("button",{id:"btnHoyCitas",className:"btn",title:"Ver citas de hoy",onClick:Dt,children:" Hoy"}),a.jsx("button",{id:"btnExportar",className:"btn",title:"Exportar citas a CSV",onClick:Lt,children:" Exportar"})]})]}),a.jsx("div",{className:"table-wrap",role:"region","aria-label":"Lista de citas",children:a.jsxs("table",{className:"appointments-table","aria-live":"polite",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:{width:"180px"},children:"Fecha / Hora"}),a.jsx("th",{children:"Paciente"}),a.jsx("th",{children:"Doctor"}),a.jsx("th",{children:"Espacio fsico"}),a.jsx("th",{children:"Comentario"}),a.jsx("th",{style:{width:"120px"},children:"Estado"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{id:"citasTbody",children:l?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"no-data",children:"Cargando citas..."})}):w.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"no-data",children:"No hay citas registradas para este rango."})}):w.map(Et)})]})})]})]})]})})]})}function Q6(){return a.jsxs("div",{style:{padding:"20px"},children:[a.jsx("h2",{children:"Mdulo de Facturacin"}),a.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function Y6(){return a.jsxs("div",{style:{padding:"20px"},children:[a.jsx("h2",{children:"Mdulo de Facturacin"}),a.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function X6(){return a.jsxs("div",{style:{padding:"20px"},children:[a.jsx("h2",{children:"Mdulo de Facturacin"}),a.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}const ed={caja:"caja",pagos:"facturacion/pagos",facturas:"facturacion/facturas"};var Mb;const Hl=typeof navigator<"u"&&((Mb=navigator.language)!=null&&Mb.startsWith("es"))?"es-ES":"en-US",J6=["Colombia","Argentina","Bolivia","Chile","Costa Rica","Cuba","Ecuador","El Salvador","Espaa","Guatemala","Honduras","Mxico","Nicaragua","Panam","Paraguay","Per","Puerto Rico","Repblica Dominicana","Uruguay","Venezuela","Estados Unidos","Canad"],Wp={Colombia:["Bogot","Medelln","Cali","Barranquilla","Cartagena","Ccuta","Bucaramanga","Pereira","Santa Marta","Ibagu"],Mxico:["Ciudad de Mxico","Guadalajara","Monterrey","Puebla","Quertaro","Tijuana","Mrida","Len"],Per:["Lima","Arequipa","Trujillo","Chiclayo","Cusco","Piura"],Chile:["Santiago","Valparaso","Concepcin","La Serena","Antofagasta"],Argentina:["Buenos Aires","Crdoba","Rosario","Mendoza","La Plata"],Espaa:["Madrid","Barcelona","Valencia","Sevilla","Zaragoza","Bilbao"],"Estados Unidos":["Miami","New York","Los ngeles","Houston","Chicago"],Ecuador:["Quito","Guayaquil","Cuenca","Manta"],Venezuela:["Caracas","Maracaibo","Valencia","Barquisimeto","Maracay"]},Z6=t=>{if(!t)return"";const[e,n,r]=t.split("-").map(c=>parseInt(c,10)),s=new Date(e,(n||1)-1,r||1),i=new Date;let o=i.getFullYear()-s.getFullYear();const l=i.getMonth()-s.getMonth();return(l<0||l===0&&i.getDate()<s.getDate())&&o--,isNaN(o)?"":String(o)};async function Nb(t,{maxW:e=900,maxH:n=900,quality:r=.82}={}){var m;if(!t||!((m=t.type)!=null&&m.startsWith("image/")))return t;const s=await new Promise((v,P)=>{const A=new Image;A.onload=()=>v(A),A.onerror=P,A.src=URL.createObjectURL(t)});let{width:i,height:o}=s;const l=Math.min(e/i,n/o,1);i=Math.round(i*l),o=Math.round(o*l);const c=document.createElement("canvas");c.width=i,c.height=o,c.getContext("2d").drawImage(s,0,0,i,o);const f=await new Promise(v=>c.toBlob(v,"image/jpeg",r)),h=new File([f],(t.name||"foto.jpg").replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return URL.revokeObjectURL(s.src),h}const Wl=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),eU=t=>Wl([t.nombres,t.apellidos,t.nombreCompleto,t.nroDocumento,t.celular,t.email].filter(Boolean).join(" ")),tU=t=>{if(!t)return"";const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${n}-${r}-${s}T${i}:${o}`},nU=t=>{try{return new Date(t).toLocaleString(Hl,{dateStyle:"medium",timeStyle:"short"})}catch{return""}},zo={tipoDocumento:"",nroDocumento:"",nroHistoria:"",nombres:"",apellidos:"",nombreCompleto:"",sexo:"",estadoCivil:"",paisNacimiento:"",ciudadNacimiento:"",fechaIngreso:"",fechaNacimiento:"",edad:"",paisDomicilio:"",ciudadDomicilio:"",barrio:"",lugarResidencia:"",estrato:"",zonaResidencial:"",esExtranjero:!1,permitePublicidad:!1,celular:"",telDomicilio:"",telOficina:"",extension:"",email:"",ocupacion:"",nombreResponsable:"",parentesco:"",celularResponsable:"",telefonoResponsable:"",emailResponsable:"",nombreAcompanante:"",telefonoAcompanante:"",convenioBeneficio:"",comoConocio:"",campania:"",remitidoPor:"",asesorComercial:"",tipoVinculacion:"",nombreEps:"",polizaSalud:"",doctor:"",notas:"",rxImagenes:[],historiaClinica:{antecedentes:"",alergias:"",medicamentos:"",motivoConsulta:"",notas:""},odontograma:[],periodontograma:[],presupuestos:[],evoluciones:[],facturacion:{saldoFavor:0,saldoCredito:0},fotoUrl:"",activo:!0},Gp=20,qo=t=>Number(t||0);function rU(t){const[e,n]=I.useState(!1),[r,s]=I.useState([]),[i,o]=I.useState([]),[l,c]=I.useState("");I.useEffect(()=>{let C=!0;return(async()=>{if(!t){s([]),o([]);return}n(!0),c("");try{let _=ut(be(ae,"facturas"),nt("patientId","==",t),xn("fechaISO","desc"));const V=(await Je(_)).docs.map(S=>({id:S.id,...S.data()})).map(S=>({...S,total:qo(S.total??S.valor??S.montoTotal),estado:(S.estado||"pendiente").toLowerCase(),fechaISO:S.fechaISO||S.fecha||null}));let U=ut(be(ae,"pagos"),nt("patientId","==",t),xn("fechaISO","desc"));const x=(await Je(U)).docs.map(S=>({id:S.id,...S.data()})).map(S=>({...S,monto:qo(S.monto??S.valor??S.total),fechaISO:S.fechaISO||S.fecha||null,medio:S.medio||S.metodo||""}));if(!C)return;s(V),o(x)}catch(_){console.warn("Finanzas: no se pudo leer colecciones. Contino solo con saldos del paciente.",_),C&&c("No se pudieron leer facturas/pagos.")}finally{C&&n(!1)}})(),()=>{C=!1}},[t]);const d=r.reduce((C,y)=>C+qo(y.total),0),f=i.reduce((C,y)=>C+qo(y.monto),0),h=r.filter(C=>["pagada","pagado","paid"].includes((C.estado||"").toLowerCase())),m=r.filter(C=>["pendiente","abierta","open","deuda"].includes((C.estado||"").toLowerCase())),v=h.reduce((C,y)=>C+qo(y.total),0),P=m.reduce((C,y)=>C+qo(y.total),0);return{loading:e,error:l,facturas:r,pagos:i,totalFacturado:d,totalPagado:f,totalFacturasPendientes:P,totalFacturasPagadas:v}}function sU(t){const[e,n]=I.useState(!1),[r,s]=I.useState([]);return I.useEffect(()=>{if(!t){s([]);return}n(!0);const i=be(ae,"citas"),o=v=>{const P=v.data()||{},A=typeof P.fecha=="string"?P.fecha:"",C=(P.horaInicio||P.hora||"00:00").slice(0,5);let y=null;if(A){const[_,w,T]=A.split("-").map(E=>parseInt(E,10)),[V,U]=C.split(":").map(E=>parseInt(E,10)||0);y=new Date(_,(w||1)-1,T||1,V,U,0,0).toISOString()}return{id:v.id,...P,fechaISO:y,motivo:P.motivo||P.comentario||"",profesional:P.doctor||P.doctorNombre||"",fechaYYYYMMDD:A}};let l=new Map;const c=()=>{const v=Array.from(l.values());v.sort((P,A)=>{const C=P.fechaISO||"",y=A.fechaISO||"";if(C<y)return 1;if(C>y)return-1;const _=P.creado||"",w=A.creado||"";return _<w?1:_>w?-1:0}),s(v),n(!1)},d=ut(i,nt("pacienteId","==",t)),f=ut(i,nt("patientId","==",t)),h=Bn(d,v=>{v.docChanges().forEach(P=>{P.type==="removed"?l.delete(P.doc.id):l.set(P.doc.id,o(P.doc))}),c()},()=>n(!1)),m=Bn(f,v=>{v.docChanges().forEach(P=>{P.type==="removed"?l.delete(P.doc.id):l.set(P.doc.id,o(P.doc))}),c()},()=>n(!1));return()=>{try{h()}catch{}try{m()}catch{}}},[t]),{loading:e,citas:r}}function iU(){var Dr,pr,Ns,Vn,es,mu,gu,Ri,ol;const t=kr(),e=gn(),n=Dg.useMemo(()=>{const N=e.pathname.split("/").filter(Boolean),W=N.findIndex(we=>["pacientes","agenda","caja","facturacion","config","reportes","software"].includes(we)),me="/"+N.slice(0,W>=0?W:N.length).join("/");return me==="/"?"":me},[e.pathname]),r=N=>{const W=String(N||"").replace(/^\//,""),ee=n?`${n}/`:"/";t(`${ee}${W}`)},s=(N,W)=>{const ee=String(N).replace(/^\//,""),me=W?new URLSearchParams(W).toString():"";return`${n?`${n}/`:"/"}${ee}${me?`?${me}`:""}`},i=(N,W)=>{const ee=String(N||"").slice(0,10);if(!ee)return r("agenda");try{sessionStorage.setItem("agenda.targetDate",ee)}catch{}const me=new URLSearchParams({date:ee,day:ee,d:ee,fecha:ee,selectedDate:ee,ts:String(new Date(ee+"T00:00:00").getTime()),patientId:W||""}).toString();r(`agenda?${me}`)},[o,l]=I.useState(!0),[c,d]=I.useState([]),[f,h]=I.useState(""),[m,v]=I.useState(null),[P,A]=I.useState(!0),[C,y]=I.useState(!1),[_,w]=I.useState(null),[T,V]=I.useState(null),U=I.useRef(null),[b,E]=I.useState("datos"),[x,S]=I.useState(zo),[j,L]=I.useState(null),[k,Y]=I.useState(""),[We,Dt]=I.useState([]),[Lt,te]=I.useState(!1),ue=I.useRef(null),ye="comfy",[Pe,Qe]=I.useState(""),Et=I.useMemo(()=>{switch(ye){case"comfy":return{thumbW:220,thumbH:165,colMin:240};case"cozy":return{thumbW:160,thumbH:120,colMin:180};default:return{thumbW:120,thumbH:90,colMin:140}}},[ye]),$=N=>{var ee,me;if((me=(ee=N==null?void 0:N.type)==null?void 0:ee.startsWith)!=null&&me.call(ee,"image/"))return!0;const W=((N==null?void 0:N.name)||(N==null?void 0:N.title)||"").toLowerCase();return/\.(png|jpe?g|gif|bmp|webp|tiff?)$/.test(W)},re=I.useMemo(()=>{const N=Pe.trim().toLowerCase(),W=Array.isArray(T==null?void 0:T.rxImagenes)?T.rxImagenes:[];let ee=W;return N?ee=W.filter(me=>`${me.name||""} ${me.title||""} ${me.desc||""}`.toLowerCase().includes(N)):ee=W.slice(),ee.sort((me,we)=>{const Xe=me.uploadedAtMS??me.created??0;return(we.uploadedAtMS??we.created??0)-Xe}),ee},[T==null?void 0:T.rxImagenes,Pe]),de=async(N,W)=>{if(!(T!=null&&T.id))return;const ee=Array.isArray(T.rxImagenes)?[...T.rxImagenes]:[];ee[N]={...ee[N]||{},...W},await K({rxImagenes:ee})},Ce=()=>{const N=new Date,W=N.getFullYear(),ee=String(N.getMonth()+1).padStart(2,"0"),me=String(N.getDate()).padStart(2,"0");return`${W}-${ee}-${me}`},[Ne,je]=I.useState(Ce()),[Ee,ot]=I.useState(""),[ke,fe]=I.useState(""),[De,Fe]=I.useState(""),[tt,Q]=I.useState("");I.useEffect(()=>{fe((T==null?void 0:T.doctor)||"")},[T==null?void 0:T.doctor,T==null?void 0:T.id]);const oe=async()=>{if(!(T!=null&&T.id))return alert("Paciente no cargado.");if(!Ne)return alert("Selecciona la fecha.");if(!Ee)return alert("Selecciona la hora.");if(!ke.trim())return alert("Indica el doctor.");const N=T.nombreCompleto||T.paciente||"Paciente",W=T.celular||T.celularPaciente||"",ee=T.telDomicilio||T.telefonoPaciente||"";if(!W&&!ee)return alert("Este paciente no tiene telfono registrado (celular o fijo). Agrega uno antes de crear la cita.");try{const me={paciente:N,pacienteId:T.id,doctor:ke.trim(),fecha:Ne,horaInicio:Ee,espacio:De||"",comentario:tt||"",estado:"En espera",creado:new Date().toISOString(),celularPaciente:W,telefonoPaciente:ee};await wn(be(ae,"citas"),me),ot(""),Fe(""),Q(""),alert(" Cita creada. Ya aparece en la lista y en Agenda.")}catch(me){console.error("Error creando cita:",me),alert("No se pudo crear la cita.")}};I.useMemo(()=>Wp[x.paisNacimiento]||[],[x.paisNacimiento]),I.useEffect(()=>((async()=>{l(!0);try{const ee=(await Je(be(ae,"eps"))).docs.map(we=>{var Xe;return(Xe=we.data())==null?void 0:Xe.nombre}).filter(Boolean),me=Array.from(new Map(ee.map(we=>[String(we).toLowerCase(),we])).values()).sort((we,Xe)=>we.localeCompare(Xe,"es"));Dt(me),await _e(!0)}catch(W){console.error(W),alert("No se pudieron cargar pacientes/EPS.")}finally{l(!1)}})(),()=>{U.current&&(U.current(),U.current=null)}),[]),I.useEffect(()=>{S(N=>({...N,nombreCompleto:`${N.nombres} ${N.apellidos}`.trim()}))},[x.nombres,x.apellidos]),I.useEffect(()=>{S(N=>({...N,nroHistoria:N.nroDocumento}))},[x.nroDocumento]),I.useEffect(()=>{S(N=>({...N,edad:Z6(N.fechaNacimiento)}))},[x.fechaNacimiento]),I.useEffect(()=>{const N=new Date,W=N.toLocaleDateString(Hl)+" - "+N.toLocaleTimeString(Hl,{hour:"2-digit",minute:"2-digit",hour12:!0});S(ee=>({...ee,fechaIngreso:W}))},[]);const z=(N,W)=>S(ee=>({...ee,[N]:W})),ie=()=>{S(zo);const N=new Date,W=N.toLocaleDateString(Hl)+" - "+N.toLocaleTimeString(Hl,{hour:"2-digit",minute:"2-digit",hour12:!0});S(ee=>({...ee,fechaIngreso:W})),L(null),Y(""),w(null)},le=async N=>{if(!N){L(null),Y("");return}try{const W=await Nb(N,{maxW:900,maxH:900,quality:.82});L(W);const ee=new FileReader;ee.onload=me=>Y(me.target.result),ee.readAsDataURL(W)}catch{L(N);const W=new FileReader;W.onload=ee=>Y(ee.target.result),W.readAsDataURL(N)}},_e=async(N=!1)=>{l(!0);try{let W;N||!m?W=ut(be(ae,"pacientes"),xn("creado","desc"),ba(Gp)):W=ut(be(ae,"pacientes"),xn("creado","desc"),XM(m),ba(Gp));const ee=await Je(W),me=ee.docs.map(we=>({id:we.id,...we.data()}));d(N?me:we=>[...we,...me]),v(ee.docs[ee.docs.length-1]||null),A(ee.size===Gp)}catch(W){console.error(W),alert("No se pudo cargar pacientes.")}finally{l(!1)}},xe=async N=>{if(N.preventDefault(),!x.nroDocumento.trim())return alert("El nmero de documento es obligatorio.");if(!x.nombres.trim())return alert("Los nombres son obligatorios.");if(!x.apellidos.trim())return alert("Los apellidos son obligatorios.");if(!x.sexo.trim())return alert("El sexo es obligatorio.");if(!x.fechaNacimiento.trim())return alert("La fecha de nacimiento es obligatoria.");if(!x.celular.trim())return alert("El celular es obligatorio.");if(!x.email.trim())return alert("El correo electrnico es obligatorio.");if(!x.tipoVinculacion.trim())return alert("El tipo de vinculacin es obligatorio.");if(!x.nombreEps.trim())return alert("El nombre de la EPS es obligatorio.");try{const W=x.nroDocumento.trim();if(!_&&(await qc(Ge(ae,"pacientes",W))).exists())return alert("Ya existe un paciente con ese nmero de documento.");const ee=(x.nombreEps||"").trim(),me=We.map(Mt=>Mt.toLowerCase()).includes(ee.toLowerCase());if(ee&&!me&&window.confirm(`La EPS "${ee}" no existe. Deseas guardarla para futuras selecciones?`)){const Nn=ee.toLowerCase().replace(/\s+/g,"_");await Wa(Ge(ae,"eps",Nn),{nombre:ee,nombreLower:ee.toLowerCase(),creado:er()},{merge:!0})}let we=x.fotoUrl||"",Xe="";if(j)try{const Mt=Hi(),Nn=(j.name||"foto.jpg").replace(/\s+/g,"_");Xe=`pacientes/${W}/${Date.now()}_${Nn}`;const An=Pl(Mt,Xe),mr={contentType:j.type||"image/jpeg",cacheControl:"public, max-age=86400"};await ub(An,j,mr),we=await hb(An)}catch(Mt){console.error("Foto (warning):",Mt)}const Or=x.creado||null,Jn=_&&Or||er(),Zn={...x,fotoUrl:we,nombre_busqueda:eU({...x,fotoUrl:we}),nombresLower:Wl(x.nombres),apellidosLower:Wl(x.apellidos),documentoLower:Wl(x.nroDocumento),emailLower:Wl(x.email),creado:Jn,createdAt:Jn,actualizado:er(),updatedAt:er(),activo:x.activo??!0,celularPaciente:x.celular,telefonoPaciente:x.telDomicilio||"",documento:x.nroDocumento,paciente:x.nombreCompleto};if(await Wa(Ge(ae,"pacientes",W),Zn,{merge:!0}),Xe)try{const Mt=Hi(),Nn=Pl(Mt,`pacientes/${W}`),An=await db(Nn),mr=Xe,ts=An.items.filter(ns=>ns.fullPath!==mr).map(ns=>Fp(ns).catch(()=>null));await Promise.allSettled(ts)}catch(Mt){console.warn("No se pudo limpiar fotos antiguas:",Mt)}alert(_?" Paciente actualizado.":" Paciente guardado."),d(Mt=>{const Nn=Mt.filter(An=>An.id!==W);return[{id:W,...Zn},...Nn]}),y(!1),w(null),ie()}catch(W){console.error("Error guardando paciente:",W),alert(`No se pudo guardar el paciente.

`+((W==null?void 0:W.message)||W))}},Me=()=>{ie(),y(!0)},Ae=()=>{T&&(S({...zo,...T,fotoUrl:T.fotoUrl||""}),L(null),Y(T.fotoUrl||""),w(T.id),D(),y(!0))},Le=async N=>{if(window.confirm(`Eliminar al paciente "${N.nombreCompleto}"?`))try{await ps(Ge(ae,"pacientes",N.id)),d(W=>W.filter(ee=>ee.id!==N.id));try{const W=Hi(),ee=Pl(W,`pacientes/${N.id}`),we=(await db(ee)).items.map(Xe=>Fp(Xe).catch(()=>null));await Promise.allSettled(we)}catch(W){console.warn("No se pudo borrar la carpeta de fotos:",W)}}catch(W){console.error(W),alert("No se pudo eliminar.")}},O=I.useMemo(()=>{const N=f.trim().toLowerCase();return N?c.filter(W=>`${W.nombreCompleto||W.paciente||""} ${W.nroDocumento||""} ${W.celular||W.celularPaciente||""} ${W.email||""}`.toLowerCase().includes(N)):c},[c,f]),G=N=>{D();const W=Ge(ae,"pacientes",N.id),ee=Bn(W,me=>{me.exists()?V({id:me.id,...H(me.data())}):V(null)});U.current=ee,E("datos")},D=()=>{U.current&&(U.current(),U.current=null),V(null)},H=N=>({...zo,...N,historiaClinica:{...zo.historiaClinica,...N.historiaClinica||{}},facturacion:{...zo.facturacion,...N.facturacion||{}},rxImagenes:Array.isArray(N.rxImagenes)?N.rxImagenes:[],odontograma:Array.isArray(N.odontograma)?N.odontograma:[],periodontograma:Array.isArray(N.periodontograma)?N.periodontograma:[],presupuestos:Array.isArray(N.presupuestos)?N.presupuestos:[],evoluciones:Array.isArray(N.evoluciones)?N.evoluciones:[]}),K=async N=>{if(T!=null&&T.id)try{await zn(Ge(ae,"pacientes",T.id),{...N,actualizado:er(),updatedAt:er()})}catch(W){console.error(W),alert("No se pudo actualizar.")}},pe=async N=>{var ee;if(!(T!=null&&T.id)||!(N!=null&&N.length))return;const W=Hi();try{te(!0);const me=[];for(const we of N){let Xe=we;if((ee=we.type)!=null&&ee.startsWith("image/"))try{Xe=await Nb(we,{maxW:1600,maxH:1600,quality:.85})}catch{Xe=we}const Or=(Xe.name||"archivo").replace(/\s+/g,"_"),Jn=`pacientes/${T.id}/rx/${Date.now()}_${Or}`,Zn=Pl(W,Jn),Mt={contentType:Xe.type||"application/octet-stream",cacheControl:"public, max-age=31536000"};await ub(Zn,Xe,Mt);const Nn=await hb(Zn),An=new Date().toISOString(),mr=Date.now();me.push({url:Nn,name:we.name,title:we.name.replace(/\.[^.]+$/,""),desc:"",type:we.type,size:we.size||0,created:mr,uploadedAtMS:mr,uploadedAtISO:An,path:Jn})}await K({rxImagenes:[...T.rxImagenes||[],...me]})}catch(me){console.error("RX upload error:",me);const we=`No se pudo subir el/los archivo(s).
 Verifica que el usuario est autenticado.
 Revisa reglas de Storage para permitir escribir en 'pacientes/{id}/**'.
 Si usas Emulador, confirma que el bucket coincida.

`+((me==null?void 0:me.message)||"");alert(we)}finally{te(!1);try{ue.current&&(ue.current.value="")}catch{}}},Te=async N=>{if(!(T!=null&&T.id))return;const W=T.rxImagenes[N],ee=T.rxImagenes.filter((me,we)=>we!==N);await K({rxImagenes:ee});try{if(W!=null&&W.path){const me=Hi();await Fp(Pl(me,W.path))}}catch(me){console.warn("No se pudo borrar del Storage:",me)}},ht=(N,W)=>{const ee={...T.historiaClinica||{},[N]:W};K({historiaClinica:ee})},at=N=>{const W=[...T.presupuestos||[],{id:String(Date.now()),...N}];K({presupuestos:W})},ft=N=>{K({presupuestos:(T.presupuestos||[]).filter(W=>W.id!==N)})},bt=N=>{const W=[...T.evoluciones||[],{id:String(Date.now()),fechaISO:new Date().toISOString(),nota:N}];K({evoluciones:W})},ze=N=>{K({evoluciones:(T.evoluciones||[]).filter(W=>W.id!==N)})},yt=(N,W)=>{const ee=Array.isArray(T[N])?T[N]:[],me=ee.find(Xe=>Xe.pieza===W);let we;me?we=ee.filter(Xe=>Xe.pieza!==W):we=[...ee,{pieza:W,estado:"marcada"}],K({[N]:we})},lt=(T==null?void 0:T.id)||null,Kt=rU(lt),{loading:Ze,citas:Vt}=sU(lt);return a.jsxs("div",{className:"odc-container",children:[a.jsx("div",{className:"odc-topbar-green"}),a.jsx("div",{className:"odc-topbar-blue",children:a.jsx("div",{className:"odc-top-inner",children:a.jsx("div",{className:"odc-breadcrumbs",children:"Pacientes"})})}),a.jsxs("div",{className:"odc-card",children:[a.jsxs("div",{className:"odc-card-header",children:[a.jsx("h3",{className:"odc-title",children:"Pacientes"}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("input",{className:"search-input",style:{minWidth:280},placeholder:"Buscar por nombre, documento o telfono",value:f,onChange:N=>h(N.target.value)}),a.jsx("button",{type:"button",className:"btn green",onClick:Me,children:"+ Nuevo paciente"})]})]}),a.jsx("div",{className:"table-wrap",children:a.jsxs("table",{className:"appointments-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Foto"}),a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Documento"}),a.jsx("th",{children:"Celular"}),a.jsx("th",{children:"Correo"}),a.jsx("th",{children:"Estado"})]})}),a.jsx("tbody",{children:o&&c.length===0?a.jsx("tr",{children:a.jsx("td",{className:"no-data",colSpan:6,children:"Cargando"})}):O.length===0?a.jsx("tr",{children:a.jsx("td",{className:"no-data",colSpan:6,children:"No hay pacientes o no coinciden con la bsqueda."})}):O.map(N=>a.jsxs("tr",{className:"row-click",onClick:()=>G(N),children:[a.jsx("td",{onClick:W=>W.stopPropagation(),children:N.fotoUrl?a.jsx("img",{src:N.fotoUrl,alt:"Foto",style:{width:36,height:36,borderRadius:"50%",objectFit:"cover"}}):a.jsx("div",{className:"avatar-fallback",children:(N.nombreCompleto||"P")[0]})}),a.jsx("td",{children:N.nombreCompleto||N.paciente||""}),a.jsx("td",{children:N.nroDocumento||N.documento||""}),a.jsx("td",{children:N.celular||N.celularPaciente||""}),a.jsx("td",{children:N.email||""}),a.jsx("td",{children:a.jsx("span",{className:"pill pill-ok",children:N.activo?"Activo":"Inactivo"})})]},N.id))})]})}),a.jsxs("div",{className:"footer-actions",children:[a.jsx("button",{type:"button",className:"btn",disabled:o||!P,onClick:()=>_e(!1),children:P?"Cargar ms":"No hay ms"}),a.jsxs("div",{className:"hint",children:[c.length," registros cargados"]})]})]}),C&&a.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"odc-modal-backdrop",onClick:()=>y(!1)}),a.jsxs("div",{className:"odc-card",style:{width:1e3,maxWidth:"95%",maxHeight:"92vh",overflowY:"auto"},children:[a.jsxs("div",{className:"odc-card-header",children:[a.jsx("h3",{className:"odc-title",children:_?"Editar paciente":"Nuevo paciente"}),a.jsx("button",{type:"button",className:"btn",onClick:()=>y(!1),children:""})]}),a.jsxs("form",{onSubmit:xe,children:[a.jsx("div",{className:"form-section-title",children:"Foto del paciente"}),a.jsxs("div",{className:"foto-row",children:[a.jsxs("label",{className:"foto-drop",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:N=>{var W;return le(((W=N.target.files)==null?void 0:W[0])||null)},style:{display:"none"}}),k?a.jsx("img",{src:k,alt:"Preview",className:"foto-preview"}):a.jsx("div",{className:"foto-empty",children:"Arrastra o haz clic para cargar"})]}),k&&a.jsx("button",{type:"button",className:"btn",onClick:()=>le(null),children:"Quitar foto"})]}),a.jsx("div",{className:"form-section-title",children:"Datos de identificacin"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Tipo de documento *"}),a.jsxs("select",{className:"form-input",value:x.tipoDocumento,onChange:N=>z("tipoDocumento",N.target.value),children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{value:"CC",children:"Cdula"}),a.jsx("option",{value:"TI",children:"Tarjeta de identidad"}),a.jsx("option",{value:"PA",children:"Pasaporte"}),a.jsx("option",{value:"OTRO",children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nro. de documento *"}),a.jsx("input",{className:"form-input",value:x.nroDocumento,onChange:N=>z("nroDocumento",N.target.value),placeholder:"Nmero de documento",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nmero de Historia"}),a.jsx("input",{className:"form-input",value:x.nroHistoria,readOnly:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nombres *"}),a.jsx("input",{className:"form-input",value:x.nombres,onChange:N=>z("nombres",N.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Apellidos *"}),a.jsx("input",{className:"form-input",value:x.apellidos,onChange:N=>z("apellidos",N.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nombre completo"}),a.jsx("input",{className:"form-input",value:x.nombreCompleto,readOnly:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Sexo *"}),a.jsxs("select",{className:"form-input",value:x.sexo,onChange:N=>z("sexo",N.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Masculino"}),a.jsx("option",{children:"Femenino"}),a.jsx("option",{children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Estado civil *"}),a.jsxs("select",{className:"form-input",value:x.estadoCivil,onChange:N=>z("estadoCivil",N.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Soltero"}),a.jsx("option",{children:"Casado"}),a.jsx("option",{children:"Unin libre"}),a.jsx("option",{children:"Divorciado"}),a.jsx("option",{children:"Viudo"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Pas de nacimiento *"}),a.jsx("input",{className:"form-input",list:"listCountries",value:x.paisNacimiento,onChange:N=>z("paisNacimiento",N.target.value),placeholder:"Escribe y elige",required:!0}),a.jsx("datalist",{id:"listCountries",children:J6.map(N=>a.jsx("option",{value:N},N))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Ciudad de nacimiento"}),a.jsx("input",{className:"form-input",list:"listCitiesBirth",value:x.ciudadNacimiento,onChange:N=>z("ciudadNacimiento",N.target.value),placeholder:"Escribe y elige"}),a.jsx("datalist",{id:"listCitiesBirth",children:(Wp[x.paisNacimiento]||[]).map(N=>a.jsx("option",{value:N},N))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Fecha de ingreso"}),a.jsx("input",{className:"form-input",value:x.fechaIngreso,readOnly:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Fecha de nacimiento *"}),a.jsx("input",{type:"date",className:"form-input",value:x.fechaNacimiento,onChange:N=>z("fechaNacimiento",N.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Edad"}),a.jsx("input",{className:"form-input",value:x.edad,readOnly:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Pas de domicilio *"}),a.jsx("input",{className:"form-input",list:"listCountries",value:x.paisDomicilio,onChange:N=>z("paisDomicilio",N.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Ciudad de domicilio *"}),a.jsx("input",{className:"form-input",list:"listCitiesHome",value:x.ciudadDomicilio,onChange:N=>z("ciudadDomicilio",N.target.value),required:!0}),a.jsx("datalist",{id:"listCitiesHome",children:(Wp[x.paisDomicilio]||[]).map(N=>a.jsx("option",{value:N},N))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Barrio *"}),a.jsx("input",{className:"form-input",value:x.barrio,onChange:N=>z("barrio",N.target.value),required:!0,placeholder:"Barrio"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Lugar de residencia *"}),a.jsx("input",{className:"form-input",value:x.lugarResidencia,onChange:N=>z("lugarResidencia",N.target.value),required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Estrato"}),a.jsxs("select",{className:"form-input",value:x.estrato,onChange:N=>z("estrato",N.target.value),children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"1"}),a.jsx("option",{children:"2"}),a.jsx("option",{children:"3"}),a.jsx("option",{children:"4"}),a.jsx("option",{children:"5"}),a.jsx("option",{children:"6"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Zona residencial *"}),a.jsxs("select",{className:"form-input",value:x.zonaResidencial,onChange:N=>z("zonaResidencial",N.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Urbana"}),a.jsx("option",{children:"Rural"})]})]}),a.jsxs("div",{className:"checkbox-cell",children:[a.jsx("label",{className:"form-label",children:"Es extranjero?"}),a.jsx("input",{type:"checkbox",checked:x.esExtranjero,onChange:N=>z("esExtranjero",N.target.checked)})]}),a.jsxs("div",{className:"checkbox-cell",children:[a.jsx("label",{className:"form-label",children:"Permite publicidad?"}),a.jsx("input",{type:"checkbox",checked:x.permitePublicidad,onChange:N=>z("permitePublicidad",N.target.checked)})]})]}),a.jsx("div",{className:"form-section-title",children:"Contacto"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Celular *"}),a.jsx("input",{className:"form-input",value:x.celular,onChange:N=>z("celular",N.target.value),required:!0,placeholder:"Celular del paciente"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Telfono de domicilio"}),a.jsx("input",{className:"form-input",value:x.telDomicilio,onChange:N=>z("telDomicilio",N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Telfono de oficina"}),a.jsx("input",{className:"form-input",value:x.telOficina,onChange:N=>z("telOficina",N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Extensin"}),a.jsx("input",{className:"form-input",value:x.extension,onChange:N=>z("extension",N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Correo electrnico *"}),a.jsx("input",{type:"email",className:"form-input",value:x.email,onChange:N=>z("email",N.target.value),required:!0,placeholder:"correo@dominio.com"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Ocupacin *"}),a.jsx("input",{className:"form-input",value:x.ocupacion,onChange:N=>z("ocupacion",N.target.value),required:!0})]})]}),a.jsx("div",{className:"form-section-title",children:"Datos de facturacin"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Responsable"}),a.jsx("input",{className:"form-input",value:x.nombreResponsable,onChange:N=>z("nombreResponsable",N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Parentesco"}),a.jsxs("select",{className:"form-input",value:x.parentesco,onChange:N=>z("parentesco",N.target.value),children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Padre/Madre"}),a.jsx("option",{children:"Hermano"}),a.jsx("option",{children:"Esposo/a"}),a.jsx("option",{children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Celular"}),a.jsx("input",{className:"form-input",value:x.celularResponsable,onChange:N=>z("celularResponsable",N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Telfono"}),a.jsx("input",{className:"form-input",value:x.telefonoResponsable,onChange:N=>z("telefonoResponsable",N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Correo electrnico"}),a.jsx("input",{type:"email",className:"form-input",value:x.emailResponsable,onChange:N=>z("emailResponsable",N.target.value)})]})]}),a.jsx("div",{className:"form-section-title",children:"Acompaante"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nombre"}),a.jsx("input",{className:"form-input",value:x.nombreAcompanante,onChange:N=>z("nombreAcompanante",N.target.value),placeholder:"Nombre acompaante"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Telfono"}),a.jsx("input",{className:"form-input",value:x.telefonoAcompanante,onChange:N=>z("telefonoAcompanante",N.target.value),placeholder:"Telfono acompaante"})]})]}),a.jsx("div",{className:"form-section-title",children:"Mercadeo"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Convenio beneficio"}),a.jsx("input",{className:"form-input",value:x.convenioBeneficio,onChange:N=>z("convenioBeneficio",N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Cmo nos conoci?"}),a.jsxs("select",{className:"form-input",value:x.comoConocio,onChange:N=>z("comoConocio",N.target.value),children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Redes sociales"}),a.jsx("option",{children:"Publicidad"}),a.jsx("option",{children:"Recomendacin"}),a.jsx("option",{children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Campaa"}),a.jsx("input",{className:"form-input",value:x.campania,onChange:N=>z("campania",N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Remitido por"}),a.jsx("input",{className:"form-input",value:x.remitidoPor,onChange:N=>z("remitidoPor",N.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Asesor comercial"}),a.jsx("input",{className:"form-input",value:x.asesorComercial,onChange:N=>z("asesorComercial",N.target.value)})]})]}),a.jsx("div",{className:"form-section-title",children:"EPS"}),a.jsxs("div",{className:"form-grid",children:[a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Tipo de vinculacin *"}),a.jsxs("select",{className:"form-input",value:x.tipoVinculacion,onChange:N=>z("tipoVinculacion",N.target.value),required:!0,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Contributivo"}),a.jsx("option",{children:"Subsidiado"}),a.jsx("option",{children:"Particular"}),a.jsx("option",{children:"Otro"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Nombre de la EPS *"}),a.jsx("input",{className:"form-input",list:"listEps",value:x.nombreEps,onChange:N=>z("nombreEps",N.target.value),placeholder:"Escribe y selecciona",required:!0}),a.jsx("datalist",{id:"listEps",children:We.map(N=>a.jsx("option",{value:N},N))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Pliza de salud"}),a.jsx("input",{className:"form-input",value:x.polizaSalud,onChange:N=>z("polizaSalud",N.target.value)})]})]}),a.jsx("div",{className:"form-section-title",children:"Doctor"}),a.jsx("div",{className:"form-grid",children:a.jsxs("div",{children:[a.jsx("label",{className:"form-label",children:"Doctor"}),a.jsx("input",{className:"form-input",value:x.doctor,onChange:N=>z("doctor",N.target.value),placeholder:"Usuario / Libre"})]})}),a.jsx("div",{className:"form-section-title",children:"Alertas y Notas"}),a.jsx("div",{className:"form-grid",children:a.jsx("textarea",{className:"form-input",rows:3,value:x.notas,onChange:N=>z("notas",N.target.value),placeholder:"Notas del paciente"})}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,marginTop:12},children:[_?a.jsx("button",{type:"button",className:"btn",onClick:()=>Le({id:_,nombreCompleto:x.nombreCompleto}),children:"Eliminar"}):a.jsx("div",{}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("button",{type:"button",className:"btn",onClick:()=>y(!1),children:"Cancelar"}),a.jsx("button",{type:"submit",className:"btn blue",children:_?"Actualizar":"Guardar paciente"})]})]})]})]})]}),T&&a.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[a.jsx("div",{className:"odc-modal-backdrop",onClick:D}),a.jsxs("div",{className:"odc-card ficha-card",children:[a.jsxs("div",{className:"ficha-header",children:[a.jsxs("div",{className:"ficha-header-left",children:[T.fotoUrl?a.jsx("img",{src:T.fotoUrl,alt:"Foto",className:"ficha-avatar"}):a.jsx("div",{className:"avatar-fallback ficha-avatar-fallback",children:(T.nombreCompleto||"P")[0]}),a.jsxs("div",{children:[a.jsx("div",{className:"ficha-nombre",children:T.nombreCompleto||""}),a.jsxs("div",{className:"ficha-doc",children:[T.tipoDocumento||""," ",T.nroDocumento||""]}),a.jsxs("div",{className:"ficha-badges",children:[a.jsx("span",{className:"ficha-badge blue",children:"En valoracin"}),a.jsx("span",{className:"ficha-badge green",children:"Sin deuda"})]})]})]}),a.jsx("div",{className:"ficha-header-right",children:a.jsxs("div",{className:"ficha-actions",children:[a.jsx("button",{type:"button",className:"btn",onClick:D,children:"Cerrar"}),a.jsx("button",{type:"button",className:"btn blue",onClick:Ae,children:"Editar"}),a.jsx("button",{type:"button",className:"btn green",onClick:()=>t(s(ed.caja,{cobro:1,patientId:T.id})),title:"Ir a Caja para cobrar a este paciente",children:"Cobrar"})]})})]}),a.jsxs("div",{className:"ficha-body",children:[a.jsxs("aside",{className:"ficha-sidebar",children:[a.jsx("div",{className:"ficha-sidebar-title",children:"Informacin general"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="datos"?"active":""}`,onClick:()=>E("datos"),children:"Datos personales"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="marketing"?"active":""}`,onClick:()=>E("marketing"),children:"Marketing"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="eps"?"active":""}`,onClick:()=>E("eps"),children:"EPS"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="prof"?"active":""}`,onClick:()=>E("prof"),children:"Profesionales"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="rx"?"active":""}`,onClick:()=>E("rx"),children:"Rx/Imgenes/Doc"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="citas"?"active":""}`,onClick:()=>E("citas"),children:"Citas"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="crm"?"active":""}`,onClick:()=>E("crm"),children:"CRM"}),a.jsx("div",{className:"ficha-sidebar-title mt",children:"Historia clnica"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="doc"?"active":""}`,onClick:()=>E("doc"),children:"Doc. Clnicos"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="odonto"?"active":""}`,onClick:()=>E("odonto"),children:"Odontogramas"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="perio"?"active":""}`,onClick:()=>E("perio"),children:"Periodontogramas"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="presu"?"active":""}`,onClick:()=>E("presu"),children:"Presupuestos"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="evo"?"active":""}`,onClick:()=>E("evo"),children:"Evoluciones"}),a.jsx("div",{className:"ficha-sidebar-title mt",children:"Facturacin"}),a.jsx("button",{type:"button",className:`ficha-link ${b==="fact"?"active":""}`,onClick:()=>E("fact"),children:"Resumen"}),a.jsxs("div",{className:"ficha-sidebar-actions",style:{display:"grid",gap:8,marginTop:8},children:[a.jsx("button",{type:"button",className:"btn pay",onClick:()=>t(s(ed.caja,{cobro:1,patientId:T.id})),title:"Cobrar a este paciente",children:"Realizar pago"}),a.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${ed.pagos}?patientId=${encodeURIComponent(T.id)}`),title:"Ver histrico de pagos",children:"Histrico de pagos"}),a.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${ed.facturas}?patientId=${encodeURIComponent(T.id)}`),title:"Ver histrico de facturacin",children:"Histrico de facturacin"})]})]}),a.jsxs("main",{className:"ficha-content",children:[b==="datos"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Datos personales"}),a.jsx("div",{className:"ficha-grid",children:[["Tipo de documento",T.tipoDocumento],["Nro. de documento",T.nroDocumento],["Nmero de Historia",T.nroHistoria],["Fecha de ingreso",T.fechaIngreso],["Nombres",T.nombres],["Apellidos",T.apellidos],["Nombre completo",T.nombreCompleto],["Sexo",T.sexo],["Estado civil",T.estadoCivil],["Pas de nacimiento",T.paisNacimiento],["Ciudad de nacimiento",T.ciudadNacimiento],["Fecha de nacimiento",T.fechaNacimiento],["Edad",T.edad],["Pas de domicilio",T.paisDomicilio],["Ciudad de domicilio",T.ciudadDomicilio],["Barrio",T.barrio],["Lugar de residencia",T.lugarResidencia],["Estrato",T.estrato],["Zona residencial",T.zonaResidencial],["Extranjero",T.esExtranjero?"S":"No"],["Permite publicidad",T.permitePublicidad?"S":"No"],["Celular",T.celular||T.celularPaciente],["Telfono domicilio",T.telDomicilio||T.telefonoPaciente],["Telfono oficina",T.telOficina],["Extensin",T.extension],["Correo electrnico",T.email],["Ocupacin",T.ocupacion],["Responsable",T.nombreResponsable],["Parentesco",T.parentesco],["Cel. responsable",T.celularResponsable],["Tel. responsable",T.telefonoResponsable],["Email responsable",T.emailResponsable],["Acompaante",T.nombreAcompanante],["Tel. acompaante",T.telefonoAcompanante]].map(([N,W])=>a.jsxs("div",{className:"field",children:[a.jsx("label",{children:N}),a.jsx("input",{className:"form-input",value:W||"",readOnly:!0})]},N))})]}),b==="marketing"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Marketing"}),a.jsx("div",{className:"ficha-grid",children:[["Convenio beneficio",T.convenioBeneficio],["Cmo nos conoci?",T.comoConocio],["Campaa",T.campania],["Remitido por",T.remitidoPor],["Asesor comercial",T.asesorComercial]].map(([N,W])=>a.jsxs("div",{className:"field",children:[a.jsx("label",{children:N}),a.jsx("input",{className:"form-input",value:W||"",readOnly:!0})]},N))})]}),b==="eps"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"EPS"}),a.jsx("div",{className:"ficha-grid",children:[["Tipo de vinculacin",T.tipoVinculacion],["Nombre EPS",T.nombreEps],["Pliza de salud",T.polizaSalud]].map(([N,W])=>a.jsxs("div",{className:"field",children:[a.jsx("label",{children:N}),a.jsx("input",{className:"form-input",value:W||"",readOnly:!0})]},N))})]}),b==="prof"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Profesionales"}),a.jsx("div",{className:"ficha-grid",children:a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Doctor"}),a.jsx("input",{className:"form-input",value:T.doctor||"",readOnly:!0})]})})]}),b==="rx"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Rx / Imgenes / Documentos"}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[a.jsxs("label",{className:"btn blue",children:["Subir archivos",a.jsx("input",{ref:ue,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",style:{display:"none"},onChange:N=>pe([...N.target.files||[]])})]}),Lt&&a.jsx("span",{className:"hint",children:"Subiendo"}),a.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:a.jsx("input",{className:"form-input",style:{width:200},placeholder:"Buscar en Rx",value:Pe,onChange:N=>Qe(N.target.value),title:"Filtra por nombre, ttulo o descripcin"})})]}),a.jsxs("div",{className:"hint",style:{marginTop:6},children:[re.length," elemento(s)",Pe?"  filtrado(s)":"","."]}),a.jsxs("div",{className:"rx-grid",style:{display:"grid",gap:10,marginTop:12,gridTemplateColumns:`repeat(auto-fill, minmax(${Et.colMin}px, 1fr))`,alignItems:"start"},children:[re.length===0&&a.jsx("div",{className:"no-data",style:{gridColumn:"1 / -1"},children:Pe?"Sin coincidencias.":"Sin archivos an."}),re.map((N,W)=>{var Or,Jn;const ee=$(N),me=N.title||N.name||`archivo-${W}`,we=((Or=(N.name||"").split(".").pop())==null?void 0:Or.toUpperCase())||((Jn=(N.type||"").split("/").pop())==null?void 0:Jn.toUpperCase())||"",Xe=N.uploadedAtISO||(N.created?new Date(N.created).toISOString():null);return a.jsxs("div",{className:"rx-item mini-card",style:{padding:8,display:"grid",gap:8},title:me,children:[a.jsx("a",{href:N.url,target:"_blank",rel:"noreferrer",style:{width:"100%",height:Et.thumbH,borderRadius:8,overflow:"hidden",border:"1px solid #e5e7eb",display:"grid",placeItems:"center",background:"#fafafa"},children:ee?a.jsx("img",{src:N.url,alt:me,style:{width:Et.thumbW,height:Et.thumbH,objectFit:"contain",display:"block"},loading:"lazy"}):a.jsxs("div",{style:{textAlign:"center",padding:10},children:[a.jsx("div",{style:{fontSize:24,fontWeight:700},children:we||"DOC"}),a.jsx("div",{style:{fontSize:12,opacity:.7},children:"Ver / descargar"})]})}),a.jsx("div",{style:{fontWeight:600,fontSize:13,lineHeight:1.2},children:me.length>40?me.slice(0,37)+"":me}),a.jsxs("details",{children:[a.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#2563eb"},children:"Editar nombre y descripcin"}),a.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[a.jsx("label",{className:"form-label",style:{marginTop:4},children:"Nombre para mostrar"}),a.jsx("input",{id:`rx-title-${W}`,className:"form-input",defaultValue:N.title||N.name||"",placeholder:"Ej. Rx aleta derecha 2025-11-29"}),a.jsx("label",{className:"form-label",children:"Descripcin"}),a.jsx("textarea",{id:`rx-desc-${W}`,className:"form-input",rows:2,defaultValue:N.desc||"",placeholder:"Observaciones, regin, tcnica, etc."}),a.jsx("label",{className:"form-label",children:"Fecha de subida"}),a.jsx("input",{id:`rx-date-${W}`,type:"datetime-local",className:"form-input",defaultValue:tU(Xe)}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"space-between"},children:[a.jsx("button",{type:"button",className:"btn blue",onClick:()=>{var ts,ns,ko;const Zn=((ts=document.getElementById(`rx-title-${W}`))==null?void 0:ts.value)||"",Mt=((ns=document.getElementById(`rx-desc-${W}`))==null?void 0:ns.value)||"",Nn=((ko=document.getElementById(`rx-date-${W}`))==null?void 0:ko.value)||"";let An=Xe,mr=N.uploadedAtMS||N.created||null;if(Nn){const rs=new Date(Nn);isNaN(rs.getTime())||(An=rs.toISOString(),mr=rs.getTime())}de(W,{title:Zn,name:Zn||N.name,desc:Mt,uploadedAtISO:An,uploadedAtMS:mr})},children:"Guardar"}),a.jsx("button",{type:"button",className:"btn",onClick:()=>Te(W),children:"Eliminar"})]}),a.jsxs("div",{className:"hint",style:{fontSize:11},children:["Tipo: ",N.type||"","  Tamao: ",(N.size||0).toLocaleString()," bytes",Xe?`  Subido: ${nU(Xe)}`:""]})]})]})]},`${N.url}-${W}`)})]})]}),b==="doc"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Doc. Clnicos"}),a.jsxs("div",{className:"ficha-grid",children:[a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Motivo de consulta"}),a.jsx("textarea",{className:"form-input",rows:3,value:((Dr=T.historiaClinica)==null?void 0:Dr.motivoConsulta)||"",onChange:N=>ht("motivoConsulta",N.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Antecedentes"}),a.jsx("textarea",{className:"form-input",rows:3,value:((pr=T.historiaClinica)==null?void 0:pr.antecedentes)||"",onChange:N=>ht("antecedentes",N.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Alergias"}),a.jsx("textarea",{className:"form-input",rows:2,value:((Ns=T.historiaClinica)==null?void 0:Ns.alergias)||"",onChange:N=>ht("alergias",N.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Medicamentos"}),a.jsx("textarea",{className:"form-input",rows:2,value:((Vn=T.historiaClinica)==null?void 0:Vn.medicamentos)||"",onChange:N=>ht("medicamentos",N.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Notas"}),a.jsx("textarea",{className:"form-input",rows:3,value:((es=T.historiaClinica)==null?void 0:es.notas)||"",onChange:N=>ht("notas",N.target.value)})]})]})]}),b==="odonto"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Odontograma (placeholder)"}),a.jsx("div",{className:"odont-grid",children:Array.from({length:32},(N,W)=>W+1).map(N=>{const W=(T.odontograma||[]).some(ee=>ee.pieza===N);return a.jsx("button",{type:"button",className:`tooth ${W?"on":""}`,onClick:()=>yt("odontograma",N),title:`Pieza ${N}`,children:N},N)})})]}),b==="perio"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Periodontograma (placeholder)"}),a.jsx("div",{className:"odont-grid",children:Array.from({length:32},(N,W)=>W+1).map(N=>{const W=(T.periodontograma||[]).some(ee=>ee.pieza===N);return a.jsx("button",{type:"button",className:`tooth ${W?"on":""}`,onClick:()=>yt("periodontograma",N),title:`Pieza ${N}`,children:N},N)})})]}),b==="presu"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Presupuestos & planes"}),a.jsx(oU,{onAdd:at}),a.jsxs("div",{className:"presu-list",children:[(T.presupuestos||[]).map(N=>a.jsxs("div",{className:"presu-item",children:[a.jsxs("div",{children:[a.jsx("div",{className:"presu-title",children:N.titulo}),a.jsxs("div",{className:"presu-meta",children:["Costo: $",N.costo||0,"  Estado: ",N.estado||"Pendiente"]})]}),a.jsx("button",{type:"button",className:"btn small",onClick:()=>ft(N.id),children:"Eliminar"})]},N.id)),(!T.presupuestos||T.presupuestos.length===0)&&a.jsx("div",{className:"no-data",children:"Sin presupuestos an."})]})]}),b==="evo"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Evoluciones & Remisiones"}),a.jsx(aU,{onAdd:bt}),a.jsxs("div",{className:"evo-list",children:[(T.evoluciones||[]).map(N=>a.jsxs("div",{className:"evo-item",children:[a.jsx("div",{className:"evo-date",children:new Date(N.fechaISO).toLocaleString()}),a.jsx("div",{className:"evo-note",children:N.nota}),a.jsx("button",{type:"button",className:"btn small",onClick:()=>ze(N.id),children:"Eliminar"})]},N.id)),(!T.evoluciones||T.evoluciones.length===0)&&a.jsx("div",{className:"no-data",children:"Sin evoluciones an."})]})]}),b==="fact"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Facturacin"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px,1fr))",gap:12},children:[a.jsx(Ho,{title:"Total facturado",value:`$ ${Kt.totalFacturado.toLocaleString()}`}),a.jsx(Ho,{title:"Total pagado",value:`$ ${Kt.totalPagado.toLocaleString()}`}),a.jsx(Ho,{title:"Facturas pendientes",value:`$ ${Kt.totalFacturasPendientes.toLocaleString()}`}),a.jsx(Ho,{title:"Saldo pendiente (facturas - pagos)",value:`$ ${(Kt.totalFacturado-Kt.totalPagado).toLocaleString()}`}),a.jsx(Ho,{title:"Saldo a favor",value:`$ ${(((mu=T.facturacion)==null?void 0:mu.saldoFavor)??0).toLocaleString()}`}),a.jsx(Ho,{title:"Saldo crdito",value:`$ ${(((gu=T.facturacion)==null?void 0:gu.saldoCredito)??0).toLocaleString()}`})]}),Kt.error&&a.jsxs("div",{className:"hint",style:{marginTop:6},children:[" ",Kt.error]}),a.jsxs("div",{className:"ficha-grid",style:{marginTop:12},children:[a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Saldo a favor"}),a.jsx("input",{type:"number",className:"form-input",value:((Ri=T.facturacion)==null?void 0:Ri.saldoFavor)??0,onChange:N=>K({facturacion:{...T.facturacion||{},saldoFavor:Number(N.target.value||0)}})})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Saldo crdito"}),a.jsx("input",{type:"number",className:"form-input",value:((ol=T.facturacion)==null?void 0:ol.saldoCredito)??0,onChange:N=>K({facturacion:{...T.facturacion||{},saldoCredito:Number(N.target.value||0)}})})]})]})]}),b==="citas"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"Citas"}),a.jsxs("div",{className:"mini-card",style:{marginBottom:12},children:[a.jsx("div",{className:"mini-card-title",children:"Crear cita para este paciente"}),a.jsxs("div",{className:"ficha-grid",style:{marginTop:8},children:[a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Fecha"}),a.jsx("input",{type:"date",className:"form-input",value:Ne,onChange:N=>je(N.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Hora"}),a.jsx("input",{type:"time",className:"form-input",value:Ee,onChange:N=>ot(N.target.value)})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Doctor"}),a.jsx("input",{className:"form-input",value:ke,onChange:N=>fe(N.target.value),placeholder:"Doctor asignado"})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Espacio / Sala"}),a.jsx("input",{className:"form-input",value:De,onChange:N=>Fe(N.target.value),placeholder:"Consultorio / Silla"})]}),a.jsxs("div",{className:"field",style:{gridColumn:"1 / -1"},children:[a.jsx("label",{children:"Comentario"}),a.jsx("textarea",{className:"form-input",rows:2,value:tt,onChange:N=>Q(N.target.value),placeholder:"Motivo / notas de la cita"})]})]}),a.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[a.jsx("button",{type:"button",className:"btn blue",onClick:oe,children:"Guardar cita"}),Ne&&a.jsx("button",{type:"button",className:"btn",onClick:()=>i(Ne,T.id),children:"Ver ese da en Agenda"})]})]}),a.jsx("div",{className:"table-wrap",children:a.jsxs("table",{className:"appointments-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Fecha"}),a.jsx("th",{children:"Estado"}),a.jsx("th",{children:"Motivo"}),a.jsx("th",{children:"Profesional / Acciones"})]})}),a.jsx("tbody",{children:Ze?a.jsx("tr",{children:a.jsx("td",{className:"no-data",colSpan:4,children:"Cargando"})}):Vt.length===0?a.jsx("tr",{children:a.jsx("td",{className:"no-data",colSpan:4,children:"Sin citas registradas."})}):Vt.map(N=>a.jsxs("tr",{children:[a.jsx("td",{children:N.fechaISO?new Date(N.fechaISO).toLocaleString():N.fechaYYYYMMDD||""}),a.jsx("td",{children:N.estado||""}),a.jsx("td",{children:N.motivo||""}),a.jsx("td",{children:a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{children:N.profesional||""}),a.jsx("button",{type:"button",className:"btn small",onClick:()=>{const W=N.fechaYYYYMMDD||N.fecha||(N.fechaISO?new Date(N.fechaISO).toISOString().slice(0,10):"");i(W,T.id)},title:"Abrir en Agenda",children:"Ver en Agenda"})]})})]},N.id))})]})})]}),b==="crm"&&a.jsxs("section",{className:"ficha-section",children:[a.jsx("h4",{className:"ficha-section-title",children:"CRM"}),a.jsx("div",{className:"no-data",children:"Notas / recordatorios comerciales del paciente."})]}),a.jsx("div",{className:"ficha-footer"})]})]})]})]})]})}function Ho({title:t,value:e}){return a.jsxs("div",{className:"mini-card",children:[a.jsx("div",{className:"mini-card-title",children:t}),a.jsx("div",{style:{fontWeight:700,fontSize:20,marginTop:6},children:e})]})}function oU({onAdd:t}){const[e,n]=I.useState(""),[r,s]=I.useState(""),[i,o]=I.useState("Pendiente");return a.jsxs("div",{className:"presu-form",children:[a.jsx("input",{className:"form-input",placeholder:"Procedimiento / plan",value:e,onChange:l=>n(l.target.value)}),a.jsx("input",{type:"number",className:"form-input",placeholder:"Costo",value:r,onChange:l=>s(l.target.value)}),a.jsxs("select",{className:"form-input",value:i,onChange:l=>o(l.target.value),children:[a.jsx("option",{children:"Pendiente"}),a.jsx("option",{children:"Aprobado"}),a.jsx("option",{children:"Rechazado"})]}),a.jsx("button",{type:"button",className:"btn blue",onClick:()=>{if(!e)return alert("Ttulo requerido");t({titulo:e,costo:Number(r||0),estado:i}),n(""),s(""),o("Pendiente")},children:"Agregar"})]})}function aU({onAdd:t}){const[e,n]=I.useState("");return a.jsxs("div",{className:"evo-form",children:[a.jsx("textarea",{className:"form-input",rows:2,placeholder:"Escribe la evolucin / remisin",value:e,onChange:r=>n(r.target.value)}),a.jsx("button",{type:"button",className:"btn blue",onClick:()=>{e.trim()&&(t(e.trim()),n(""))},children:"Guardar evolucin"})]})}function lU(){return a.jsxs("div",{style:{padding:"20px"},children:[a.jsx("h2",{children:"Mdulo de Facturacin"}),a.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function cU({basePath:t="",className:e=""}){const n=kr(),r=()=>{const s=String(t||"").replace(/\/+$/g,"");n(`${s}/config/datos-basicos`,{replace:!1})};return a.jsx("button",{type:"button",className:`oc-icon-btn ${e}`,title:"Configuracin","aria-label":"Abrir configuracin",onClick:r,children:""})}function uU(t,e){let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}function dU(){const[t,e]=I.useState({nombre:"",marca:"",pais:"Colombia",ciudad:"",tipoDocumento:"NIT",numeroDocumento:"",tipoPersona:"",telefono:"",celular:"",direccion:"",sitioWeb:"",urlAgendamiento:"",regimen:"",responsabilidadTributaria:"",correo:"",moneda:"Pesos colombianos (COP)",zonaHoraria:"Hora de Colombia",cuentaContable:"",esIPS:!1,usuarioSispro:"",tipoDocSispro:"Cdula de Ciudadana",passwordSispro:"",codigoPrestador:""});I.useEffect(()=>{var s;try{const i=localStorage.getItem("empresa_datos_basicos");if(i){const o=JSON.parse(i);e(l=>({...l,...o}))}else{const o=(s=document.querySelector('meta[name="company-name"]'))==null?void 0:s.getAttribute("content");o&&e(l=>({...l,nombre:o}))}}catch{}},[]);const n=s=>{const{name:i,type:o,value:l,checked:c}=s.target;e(d=>({...d,[i]:o==="checkbox"?c:l}))},r=async s=>{s.preventDefault();try{localStorage.setItem("empresa_datos_basicos",JSON.stringify(t)),localStorage.setItem("empresa_nombre",t.nombre||"OdontoCloud"),uU("company-name",t.nombre||"OdontoCloud")}catch{}console.log("Guardar Empresa  Datos bsicos:",t),alert("Datos bsicos guardados.")};return a.jsxs("div",{className:"oc-main-content",children:[a.jsx("div",{className:"oc-section-title",children:a.jsx("h2",{children:"Configuracin  Datos bsicos"})}),a.jsxs("div",{className:"emp-card",children:[a.jsx("div",{className:"emp-title",children:"Datos bsicos"}),a.jsxs("form",{className:"emp-form",onSubmit:r,children:[a.jsxs("div",{className:"oc-form-grid",children:[a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Nombre *"}),a.jsx("input",{name:"nombre",className:"emp-input",autoComplete:"organization",required:!0,value:t.nombre,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Marca"}),a.jsx("input",{name:"marca",className:"emp-input",value:t.marca,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Pas"}),a.jsxs("select",{name:"pais",className:"emp-select",value:t.pais,onChange:n,children:[a.jsx("option",{children:"Colombia"}),a.jsx("option",{children:"Mxico"}),a.jsx("option",{children:"Per"}),a.jsx("option",{children:"Chile"}),a.jsx("option",{children:"Argentina"}),a.jsx("option",{children:"Espaa"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Ciudad"}),a.jsx("input",{name:"ciudad",className:"emp-input",value:t.ciudad,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Tipo documento *"}),a.jsxs("select",{name:"tipoDocumento",className:"emp-select",required:!0,value:t.tipoDocumento,onChange:n,children:[a.jsx("option",{children:"NIT"}),a.jsx("option",{children:"CC"}),a.jsx("option",{children:"CE"}),a.jsx("option",{children:"PA"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Nmero de documento *"}),a.jsx("input",{name:"numeroDocumento",className:"emp-input",required:!0,value:t.numeroDocumento,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Tipo de persona"}),a.jsxs("select",{name:"tipoPersona",className:"emp-select",value:t.tipoPersona,onChange:n,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Natural"}),a.jsx("option",{children:"Jurdica"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Telfono fijo"}),a.jsx("input",{name:"telefono",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.telefono,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Celular"}),a.jsx("input",{name:"celular",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.celular,onChange:n})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Direccin"}),a.jsx("input",{name:"direccion",className:"emp-input",autoComplete:"street-address",value:t.direccion,onChange:n})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Sitio web"}),a.jsx("input",{name:"sitioWeb",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.sitioWeb,onChange:n})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Agendamiento (URL)"}),a.jsx("input",{name:"urlAgendamiento",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.urlAgendamiento,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Rgimen legal"}),a.jsxs("select",{name:"regimen",className:"emp-select",value:t.regimen,onChange:n,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"Comn"}),a.jsx("option",{children:"Simplificado"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Responsabilidad tributaria"}),a.jsxs("select",{name:"responsabilidadTributaria",className:"emp-select",value:t.responsabilidadTributaria,onChange:n,children:[a.jsx("option",{value:"",children:"Seleccione"}),a.jsx("option",{children:"No aplica"}),a.jsx("option",{children:"Autorretenedor"})]})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Correo electrnico"}),a.jsx("input",{name:"correo",className:"emp-input",type:"email",autoComplete:"email",value:t.correo,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Moneda"}),a.jsxs("select",{name:"moneda",className:"emp-select",value:t.moneda,onChange:n,children:[a.jsx("option",{children:"Pesos colombianos (COP)"}),a.jsx("option",{children:"Dlares (USD)"}),a.jsx("option",{children:"Euros (EUR)"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Zona horaria"}),a.jsxs("select",{name:"zonaHoraria",className:"emp-select",value:t.zonaHoraria,onChange:n,children:[a.jsx("option",{children:"Hora de Colombia"}),a.jsx("option",{children:"America/Bogota"}),a.jsx("option",{children:"UTC-5"})]})]}),a.jsxs("div",{className:"oc-field oc-col-2",children:[a.jsx("label",{className:"emp-label",children:"Cuenta contable"}),a.jsx("input",{name:"cuentaContable",className:"emp-input",value:t.cuentaContable,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Es una institucin prestadora de salud (IPS)?"}),a.jsxs("div",{className:"emp-inline",children:[a.jsx("input",{id:"esIPS",type:"checkbox",name:"esIPS",checked:t.esIPS,onChange:n}),a.jsx("label",{htmlFor:"esIPS",children:"S"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Usuario SISPRO"}),a.jsx("input",{name:"usuarioSispro",className:"emp-input",value:t.usuarioSispro,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Tipo documento SISPRO"}),a.jsxs("select",{name:"tipoDocSispro",className:"emp-select",value:t.tipoDocSispro,onChange:n,children:[a.jsx("option",{children:"Cdula de Ciudadana"}),a.jsx("option",{children:"Cdula de Extranjera"}),a.jsx("option",{children:"NIT"})]})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Contrasea SISPRO"}),a.jsx("input",{name:"passwordSispro",className:"emp-input",type:"password",value:t.passwordSispro,onChange:n})]}),a.jsxs("div",{className:"oc-field",children:[a.jsx("label",{className:"emp-label",children:"Cdigo de prestador"}),a.jsx("input",{name:"codigoPrestador",className:"emp-input",value:t.codigoPrestador,onChange:n})]})]}),a.jsx("div",{className:"oc-form-actions",children:a.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})})]})]})]})}const Kp="empresa_logo_url";function Ab(t,e){let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}function hU(){const[t,e]=I.useState(()=>{try{return localStorage.getItem(Kp)||""}catch{return""}}),[n,r]=I.useState(null),[s,i]=I.useState(!1),o=I.useRef(null),l=I.useCallback(A=>{const C=A==null?void 0:A[0];if(!C)return;if(!C.type.startsWith("image/")){alert("Por favor selecciona una imagen (PNG/JPG/SVG/WebP).");return}r(C);const y=new FileReader;y.onload=_=>{var w;return e(String(((w=_.target)==null?void 0:w.result)||""))},y.readAsDataURL(C)},[]),c=A=>l(A.target.files),d=A=>{A.preventDefault(),A.stopPropagation(),i(!1),l(A.dataTransfer.files)},f=A=>{A.preventDefault(),i(!0)},h=()=>i(!1),m=()=>{var A;return(A=o.current)==null?void 0:A.click()},v=()=>{r(null),e("")},P=async()=>{try{t?(localStorage.setItem(Kp,t),Ab("company-logo",t)):(localStorage.removeItem(Kp),Ab("company-logo","")),alert("Logo guardado.")}catch(A){console.error(A),alert("No se pudo guardar localmente.")}};return a.jsxs("div",{className:"oc-main-content",children:[a.jsx("div",{className:"oc-section-title",children:a.jsx("h2",{children:"Configuracin  Logo empresa"})}),a.jsxs("div",{className:"emp-card",children:[a.jsx("div",{className:"emp-title",children:"Logo"}),a.jsxs("div",{className:"logo-wrap",children:[a.jsxs("div",{className:"logo-current",children:[a.jsx("div",{className:"emp-label",children:"Logo actual"}),a.jsx("div",{className:"logo-preview","aria-live":"polite",children:t?a.jsx("img",{src:t,alt:"Logo actual de la empresa"}):a.jsx("div",{className:"logo-empty",children:"Sin logo"})}),a.jsx("div",{className:"logo-actions",children:a.jsx("button",{type:"button",className:"oc-btn danger",onClick:v,disabled:!t,children:"Eliminar"})})]}),a.jsxs("div",{className:"logo-uploader",children:[a.jsx("div",{className:"emp-label",children:"Cargar foto"}),a.jsxs("div",{className:`logo-drop ${s?"over":""}`,onDragOver:f,onDragLeave:h,onDrop:d,onClick:m,role:"button",tabIndex:0,onKeyDown:A=>(A.key==="Enter"||A.key===" ")&&m(),"aria-label":"Arrastra o haz click para cargar la imagen del logo",children:[a.jsx("input",{ref:o,type:"file",accept:"image/*",onChange:c,style:{display:"none"}}),a.jsxs("div",{className:"logo-drop-hint",children:["Arrastra o click para cargar la foto.",a.jsx("div",{className:"logo-subhint",children:"Solo archivos de imagen"})]})]}),n&&a.jsxs("div",{className:"logo-file-name",children:["Archivo seleccionado: ",a.jsx("b",{children:n.name})]})]})]}),a.jsx("div",{className:"oc-form-actions",children:a.jsx("button",{type:"button",className:"oc-btn primary",onClick:P,children:"Guardar"})})]})]})}function c1(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function fU(){I.useEffect(()=>{var r,s;(r=document.getElementById("lp-acciones-unificadas-icons26"))==null||r.remove(),(s=document.getElementById("lp-acciones-unificadas-icons_v2"))==null||s.remove();const t="lp-acciones-unificadas-icons_v2",e=`
      .lp-wrap{padding:0;}
      .lp-h2{margin:0 0 12px;font-weight:800;font-size:20px;color:#0f172a;}

      .lp-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;}
      .lp-pill{padding:7px 16px;border-radius:999px;border:1px solid #d1d5db;background:#fff;
        font-weight:600;color:#374151;cursor:pointer;font-size:14px;transition:.2s;}
      .lp-pill:hover{background:#f3f4f6;}
      .lp-pill.active{background:#2b6cb0;color:#fff;border-color:#2b6cb0;}

      .lp-card{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:18px;box-shadow:0 1px 2px rgba(0,0,0,.04);}
      .lp-card-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:12px;}
      .lp-subtitle{font-size:16px;font-weight:800;color:#111827;margin:0 0 8px;border-bottom:1px solid #e5e7eb;padding-bottom:6px;}

      .chip{display:inline-flex;align-items:center;gap:8px;height:34px;padding:0 12px;border-radius:999px;border:1px solid #d1d5db;
        background:#fff;color:#374151;font-weight:600;cursor:pointer;transition:.2s;white-space:nowrap;}
      .chip:hover{background:#f3f4f6;}
      .btn-soft{display:inline-flex;align-items:center;gap:6px;height:32px;padding:0 12px;border-radius:999px;border:none;cursor:pointer;
        font-weight:700;font-size:13px;background:#22c55e;color:#fff;}
      .btn-soft.gray{background:#6b7280;}
      .btn-soft:hover{filter:brightness(.95);}

      .lp-table-wrap{overflow-x:hidden;width:100%;}
      .lp-card table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:14px;}
      thead tr{background:#f9fafb;}
      th,td{padding:8px 10px;white-space:normal;word-break:break-word;vertical-align:middle;}
      th{text-align:left;border-bottom:1px solid #e5e7eb;font-weight:700;color:#475569;}
      tbody tr{border-top:1px solid #f1f5f9;}
      .muted{color:#6b7280;}

      /* Acciones unificadas */
      th.actions, td.actions{width:140px;text-align:right;}
      .lp-actions{display:flex;gap:8px;justify-content:flex-end;align-items:center;flex-wrap:nowrap;}

      .iconbtn{
        display:inline-flex;align-items:center;justify-content:center;
        width:32px;height:32px;border-radius:10px;border:1px solid transparent;cursor:pointer;transition:.15s;
      }
      .iconbtn.green{background:#ecfdf5;color:#0f9d5b;border-color:#bbf7d0;}
      .iconbtn.blue {background:#eff6ff;color:#1e3a8a;border-color:#bfdbfe;}
      .iconbtn.red  {background:#fef2f2;color:#b91c1c;border-color:#fecaca;}
      .iconbtn:hover{filter:brightness(.97);}

      /* cono ms grande (no crece el botn) */
      .iconbtn > svg{
        width:38px !important;
        height:38px !important;
        display:block;
        stroke-width:2.4;
        vector-effect: non-scaling-stroke;
        pointer-events:none;
      }

      .badge{display:inline-block;padding:5px 10px;border-radius:999px;font-weight:700;font-size:12px;line-height:1;}
      .badge.green{background:#e8f7ee;color:#16a34a;border:1px solid #cbead7;}

      /* ---------- Form de Nuevo Producto ---------- */
      .np-grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:6px;}
      .np-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
      .np-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
      .np-field{display:flex;flex-direction:column;gap:6px;}
      .np-label{font-weight:700;color:#334155;font-size:13px;}
      .np-input, .np-select, .np-text{
        border:1px solid #d1d5db;border-radius:8px;padding:8px 10px;font-size:14px;background:#fff;
      }
      .np-text{min-height:72px;resize:vertical;}
      .np-toggle{display:flex;align-items:center;gap:10px;}
      .np-card-img{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:6px;}
      .np-avatar{width:140px;height:140px;border-radius:12px;background:#e5e7eb;display:flex;align-items:center;justify-content:center;color:#64748b;}
      .np-drop{border:2px dashed #d1d5db;border-radius:12px;padding:16px;text-align:center;color:#64748b;}
      .np-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;}

      @media (max-width:900px){
        .np-row, .np-row-3{grid-template-columns:1fr;}
      }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}const s_=()=>a.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("path",{d:"M12 20h9"}),a.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5z"})]}),i_=()=>a.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),a.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),o_=()=>a.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[a.jsx("polyline",{points:"3 6 5 6 21 6"}),a.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),a.jsx("path",{d:"M10 11v6M14 11v6"})]}),pU=()=>a.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:a.jsx("path",{d:"M20 6L9 17l-5-5"})});function mU(){const[t,e]=I.useState(!0),[n,r]=I.useState([]),[s,i]=I.useState("list"),[o,l]=I.useState(""),{pathname:c}=gn(),d=kr(),f=I.useMemo(()=>c1(c),[c]);I.useEffect(()=>{(async()=>{e(!0);try{const y=(await Je(be(ae,"listas_precios"))).docs.map(_=>({id:_.id,..._.data()}));y.sort((_,w)=>String(w.actualizado||w.creado||"").localeCompare(String(_.actualizado||_.creado||""))),r(y)}finally{e(!1)}})()},[]);const h=async()=>{if(!o.trim())return alert("Escribe el nombre de la lista.");const C=new Date().toLocaleString("es-CO"),y={nombre:o.trim(),creado:C,actualizado:C,en_uso:!1,tipo:"clinicos"},_=await wn(be(ae,"listas_precios"),y);r(w=>[{id:_.id,...y},...w]),l(""),i("list")},m=async C=>{const y=await Je(be(ae,"listas_precios"));await Promise.all(y.docs.map(_=>zn(Ge(ae,"listas_precios",_.id),{en_uso:_.id===C.id}))),r(_=>_.map(w=>({...w,en_uso:w.id===C.id})))},v=async C=>{window.confirm(`Eliminar "${C==null?void 0:C.nombre}"?`)&&(await ps(Ge(ae,"listas_precios",C.id)),r(y=>y.filter(_=>_.id!==C.id)))},P=async C=>{const y=new Date().toLocaleString("es-CO"),{id:_,...w}=C,T={...w,nombre:`${(C==null?void 0:C.nombre)||"Lista"} (copia)`,en_uso:!1,creado:y,actualizado:y},V=await wn(be(ae,"listas_precios"),T);r(U=>[{id:V.id,...T},...U])},A=C=>d(`${f}/config/lista-de-precios/editar/${C.id}`);return a.jsxs("div",{className:"lp-card",children:[a.jsx("h3",{className:"lp-subtitle",children:"Lista de precios clnicos"}),s==="list"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"lp-card-header",children:[a.jsx("div",{}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsxs("button",{className:"chip",onClick:()=>i("nuevo"),children:[a.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de precios"]}),a.jsx("button",{className:"chip",onClick:()=>alert("Exportar plantilla (prximamente)"),children:"Exportar plantilla"})]})]}),a.jsx("div",{className:"lp-table-wrap",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Fecha de creacin"}),a.jsx("th",{children:"Fecha de actualizacin"}),a.jsx("th",{children:"En uso"}),a.jsx("th",{className:"actions",children:"Acciones"})]})}),a.jsx("tbody",{children:t?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center"},children:"Cargando"})}):n.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center"},className:"muted",children:"Sin datos"})}):n.map(C=>a.jsxs("tr",{children:[a.jsx("td",{style:{fontWeight:600},children:(C==null?void 0:C.nombre)||""}),a.jsx("td",{children:(C==null?void 0:C.creado)||""}),a.jsx("td",{children:(C==null?void 0:C.actualizado)||""}),a.jsx("td",{children:C!=null&&C.en_uso?a.jsx("span",{className:"badge green",children:"En uso"}):a.jsxs("button",{className:"btn-soft",onClick:()=>m(C),title:"Usar esta lista",children:[a.jsx(pU,{})," Usar"]})}),a.jsx("td",{className:"actions",children:a.jsxs("div",{className:"lp-actions",children:[a.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>P(C),"aria-label":"Clonar",children:a.jsx(i_,{})}),a.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>A(C),"aria-label":"Editar",children:a.jsx(s_,{})}),a.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>v(C),"aria-label":"Eliminar",children:a.jsx(o_,{})})]})})]},C.id))})]})})]}):a.jsxs("div",{children:[a.jsxs("div",{className:"lp-card-header",children:[a.jsx("h4",{style:{margin:0,fontWeight:700},children:"Nueva lista de precios"}),a.jsx("button",{className:"chip",onClick:()=>i("list"),children:" Volver"})]}),a.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",maxWidth:560,marginTop:10},children:[a.jsx("input",{type:"text",placeholder:"Nombre de la lista",value:o,onChange:C=>l(C.target.value),style:{flex:1,border:"1px solid #d1d5db",borderRadius:8,padding:"8px 10px"}}),a.jsx("button",{type:"button",title:"Sugerir nombre automtico",className:"chip",onClick:()=>l("Lista de precios "+new Date().toLocaleDateString("es-CO")),children:""}),a.jsx("button",{className:"btn-soft",onClick:h,children:"Guardar"})]})]})]})}function gU(){const[t,e]=I.useState([]),[n,r]=I.useState("list"),[s,i]=I.useState(null),o=kr(),{pathname:l}=gn(),c=I.useMemo(()=>c1(l),[l]),d=y=>o(`${c}/config/lista-de-precios/productos/editar/${y.id}`),f={nombre:"",referencia:"",descripcion:"",cuentaContable:"",categoria:"",esServicio:!1,precioCompra:"",marca:"",principioActivo:"",registroInvima:"",formaFarmaceutica:"",concentracion:"",presentacionComercial:"",tempAlmacenamiento:"",unidadTemperatura:"",humedadAlmacenamiento:"",unidadHumedad:"",esInventariable:!1,clasificacionRiesgo:"",vidaUtil:"",periodicidadMantenimiento:"",periodicidadCalibracion:"",extTexto1:"",extTexto2:"",extNumero1:"",extNumero2:"",extFecha1:"",extFecha2:""},[h,m]=I.useState(f);I.useEffect(()=>{(async()=>{try{const _=(await Je(be(ae,"listas_precios_productos"))).docs.map(w=>({id:w.id,...w.data()}));e(_)}catch{e([])}})()},[]);const v=async y=>{const{id:_,...w}=y,T=await wn(be(ae,"listas_precios_productos"),{...w,nombre:`${(y==null?void 0:y.nombre)||"Producto"} (copia)`});e(V=>[{id:T.id,...w,nombre:`${(y==null?void 0:y.nombre)||"Producto"} (copia)`},...V])},P=async y=>{window.confirm(`Eliminar "${y==null?void 0:y.nombre}"?`)&&(await ps(Ge(ae,"listas_precios_productos",y.id)),e(_=>_.filter(w=>w.id!==y.id)))},A=y=>{var T;const _=(T=y.target.files)==null?void 0:T[0];if(!_)return;const w=new FileReader;w.onload=()=>i(w.result),w.readAsDataURL(_)},C=async()=>{if(!h.nombre.trim())return alert("El nombre es obligatorio.");const y={...h,precioCompra:h.precioCompra===""?0:Number(h.precioCompra),creado:new Date().toISOString(),imgPreview:s||null};await wn(be(ae,"productos"),y),m(f),i(null),r("list"),alert("Producto guardado.")};return a.jsxs("div",{className:"lp-card",children:[a.jsx("h3",{className:"lp-subtitle",children:"Lista de precios productos"}),n==="list"?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"lp-card-header",children:[a.jsx("div",{}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsxs("button",{className:"chip",onClick:()=>r("nuevo"),children:[a.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo producto"]}),a.jsx("button",{className:"chip",onClick:()=>alert("Exportar plantilla (prximamente)"),children:"Exportar plantilla"})]})]}),a.jsx("div",{className:"lp-table-wrap",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Marca"}),a.jsx("th",{children:"Descripcin"}),a.jsx("th",{className:"actions",children:"Acciones"})]})}),a.jsx("tbody",{children:t.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(y=>a.jsxs("tr",{children:[a.jsx("td",{style:{fontWeight:600},children:(y==null?void 0:y.nombre)||""}),a.jsx("td",{children:(y==null?void 0:y.marca)||""}),a.jsx("td",{children:(y==null?void 0:y.descripcion)||""}),a.jsx("td",{className:"actions",children:a.jsxs("div",{className:"lp-actions",children:[a.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>v(y),"aria-label":"Clonar",children:a.jsx(i_,{})}),a.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>d(y),"aria-label":"Editar",children:a.jsx(s_,{})}),a.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>P(y),"aria-label":"Eliminar",children:a.jsx(o_,{})})]})})]},y.id))})]})})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"lp-card-header",children:[a.jsx("h4",{style:{margin:0,fontWeight:700},children:"Nuevo producto"}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("button",{className:"btn-soft gray",onClick:()=>r("list"),children:" Volver"}),a.jsx("button",{className:"btn-soft",onClick:C,children:"Guardar"})]})]}),a.jsxs("div",{className:"np-card-img",children:[a.jsx("div",{className:"np-avatar",children:s?a.jsx("img",{src:s,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12}}):a.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[a.jsx("circle",{cx:"12",cy:"8",r:"4"}),a.jsx("path",{d:"M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6"})]})}),a.jsxs("div",{className:"np-drop",children:[a.jsxs("div",{style:{marginBottom:6},children:["Arrastra o haz click para cargar la foto.",a.jsx("br",{}),"Solo archivos de imgenes"]}),a.jsx("input",{type:"file",accept:"image/*",onChange:A})]})]}),a.jsxs("div",{className:"np-grid",children:[a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Nombre*"}),a.jsx("input",{className:"np-input",value:h.nombre,onChange:y=>m({...h,nombre:y.target.value}),placeholder:"Nombre del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Referencia"}),a.jsx("input",{className:"np-input",value:h.referencia,onChange:y=>m({...h,referencia:y.target.value}),placeholder:"Referencia del concepto"})]})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Descripcin"}),a.jsx("textarea",{className:"np-text",value:h.descripcion,onChange:y=>m({...h,descripcion:y.target.value}),placeholder:"Descripcin del concepto"})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Cuenta contable"}),a.jsx("input",{className:"np-input",value:h.cuentaContable,onChange:y=>m({...h,cuentaContable:y.target.value}),placeholder:"Buscar tem..."})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Categora*"}),a.jsxs("select",{className:"np-select",value:h.categoria,onChange:y=>m({...h,categoria:y.target.value}),children:[a.jsx("option",{value:"",children:"Seleccione..."}),a.jsx("option",{children:"Medicamentos"}),a.jsx("option",{children:"Insumos"}),a.jsx("option",{children:"Equipos"})]})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field np-toggle",children:[a.jsx("label",{className:"np-label",style:{margin:0},children:"Es servicio?"}),a.jsx("input",{type:"checkbox",checked:h.esServicio,onChange:y=>m({...h,esServicio:y.target.checked})})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Precio compra*"}),a.jsx("input",{className:"np-input",type:"number",value:h.precioCompra,onChange:y=>m({...h,precioCompra:y.target.value}),placeholder:"$0"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Marca"}),a.jsx("input",{className:"np-input",value:h.marca,onChange:y=>m({...h,marca:y.target.value}),placeholder:"Marca del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Principio activo"}),a.jsx("input",{className:"np-input",value:h.principioActivo,onChange:y=>m({...h,principioActivo:y.target.value}),placeholder:"Principio activo del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Registro Invima"}),a.jsx("input",{className:"np-input",value:h.registroInvima,onChange:y=>m({...h,registroInvima:y.target.value}),placeholder:"Informacin Invima del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Forma farmacutica"}),a.jsx("input",{className:"np-input",value:h.formaFarmaceutica,onChange:y=>m({...h,formaFarmaceutica:y.target.value}),placeholder:"Forma farmacutica del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Concentracin"}),a.jsx("input",{className:"np-input",value:h.concentracion,onChange:y=>m({...h,concentracion:y.target.value}),placeholder:"Concentracin del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Presentacin comercial"}),a.jsx("input",{className:"np-input",value:h.presentacionComercial,onChange:y=>m({...h,presentacionComercial:y.target.value}),placeholder:"Presentacin com. del concepto"})]})]}),a.jsxs("div",{className:"np-row-3",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Temperatura de almacenamiento"}),a.jsx("input",{className:"np-input",value:h.tempAlmacenamiento,onChange:y=>m({...h,tempAlmacenamiento:y.target.value}),placeholder:"Temperatura de almacenamiento"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Unidad de temperatura"}),a.jsx("input",{className:"np-input",value:h.unidadTemperatura,onChange:y=>m({...h,unidadTemperatura:y.target.value}),placeholder:"Unidad de temp. del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Humedad de almacenamiento"}),a.jsx("input",{className:"np-input",value:h.humedadAlmacenamiento,onChange:y=>m({...h,humedadAlmacenamiento:y.target.value}),placeholder:"Humedad de almacenamiento"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Unidad de humedad"}),a.jsx("input",{className:"np-input",value:h.unidadHumedad,onChange:y=>m({...h,unidadHumedad:y.target.value}),placeholder:"Unidad de hum. del concepto"})]}),a.jsxs("div",{className:"np-field np-toggle",children:[a.jsx("label",{className:"np-label",style:{margin:0},children:"Es inventariable?"}),a.jsx("input",{type:"checkbox",checked:h.esInventariable,onChange:y=>m({...h,esInventariable:y.target.checked})})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Clasificacin de riesgo"}),a.jsx("input",{className:"np-input",value:h.clasificacionRiesgo,onChange:y=>m({...h,clasificacionRiesgo:y.target.value}),placeholder:"Clasif. riesgo del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Vida til"}),a.jsx("input",{className:"np-input",value:h.vidaUtil,onChange:y=>m({...h,vidaUtil:y.target.value}),placeholder:"Vida til del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Periodicidad mantenimiento"}),a.jsx("input",{className:"np-input",value:h.periodicidadMantenimiento,onChange:y=>m({...h,periodicidadMantenimiento:y.target.value}),placeholder:"Periodicidad mant. del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Periodicidad calibracin"}),a.jsx("input",{className:"np-input",value:h.periodicidadCalibracion,onChange:y=>m({...h,periodicidadCalibracion:y.target.value}),placeholder:"Periodicidad cal. del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin texto 1"}),a.jsx("input",{className:"np-input",value:h.extTexto1,onChange:y=>m({...h,extTexto1:y.target.value}),placeholder:"Ext. texto 1 del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin texto 2"}),a.jsx("input",{className:"np-input",value:h.extTexto2,onChange:y=>m({...h,extTexto2:y.target.value}),placeholder:"Ext. texto 2 del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin nmero 1"}),a.jsx("input",{className:"np-input",type:"number",value:h.extNumero1,onChange:y=>m({...h,extNumero1:y.target.value}),placeholder:"Ext. nmero 1 del concepto"})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin nmero 2"}),a.jsx("input",{className:"np-input",type:"number",value:h.extNumero2,onChange:y=>m({...h,extNumero2:y.target.value}),placeholder:"Ext. nmero 2 del concepto"})]})]}),a.jsxs("div",{className:"np-row",children:[a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin fecha 1 (dd/mm/aaaa)"}),a.jsx("input",{className:"np-input",type:"date",value:h.extFecha1,onChange:y=>m({...h,extFecha1:y.target.value})})]}),a.jsxs("div",{className:"np-field",children:[a.jsx("label",{className:"np-label",children:"Extensin fecha 2 (dd/mm/aaaa)"}),a.jsx("input",{className:"np-input",type:"date",value:h.extFecha2,onChange:y=>m({...h,extFecha2:y.target.value})})]})]}),a.jsxs("div",{className:"np-actions",children:[a.jsx("button",{className:"btn-soft gray",onClick:()=>r("list"),children:"Cancelar"}),a.jsx("button",{className:"btn-soft",onClick:C,children:"Guardar"})]})]})]})]})}function yU(){const[t,e]=I.useState([]);I.useEffect(()=>{(async()=>{try{const i=(await Je(be(ae,"listas_precios_servicios"))).docs.map(o=>({id:o.id,...o.data()}));e(i)}catch{e([])}})()},[]);const n=async s=>{const{id:i,...o}=s,l=await wn(be(ae,"listas_precios_servicios"),{...o,nombre:`${(s==null?void 0:s.nombre)||"Servicio"} (copia)`});e(c=>[{id:l.id,...o,nombre:`${(s==null?void 0:s.nombre)||"Servicio"} (copia)`},...c])},r=async s=>{window.confirm(`Eliminar "${s==null?void 0:s.nombre}"?`)&&(await ps(Ge(ae,"listas_precios_servicios",s.id)),e(i=>i.filter(o=>o.id!==s.id)))};return a.jsxs("div",{className:"lp-card",children:[a.jsx("h3",{className:"lp-subtitle",children:"Lista de precios servicios"}),a.jsxs("div",{className:"lp-card-header",children:[a.jsx("div",{}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsxs("button",{className:"chip",onClick:()=>alert("Nuevo listado de servicios (prximamente)"),children:[a.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de servicios"]}),a.jsx("button",{className:"chip",onClick:()=>alert("Exportar plantilla (prximamente)"),children:"Exportar plantilla"})]})]}),a.jsx("div",{className:"lp-table-wrap",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Marca"}),a.jsx("th",{children:"Descripcin"}),a.jsx("th",{className:"actions",children:"Acciones"})]})}),a.jsx("tbody",{children:t.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(s=>a.jsxs("tr",{children:[a.jsx("td",{style:{fontWeight:600},children:(s==null?void 0:s.nombre)||""}),a.jsx("td",{children:(s==null?void 0:s.marca)||""}),a.jsx("td",{children:(s==null?void 0:s.descripcion)||""}),a.jsx("td",{className:"actions",children:a.jsxs("div",{className:"lp-actions",children:[a.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>n(s),"aria-label":"Clonar",children:a.jsx(i_,{})}),a.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>alert("Editar servicio (prx.)"),"aria-label":"Editar",children:a.jsx(s_,{})}),a.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>r(s),"aria-label":"Eliminar",children:a.jsx(o_,{})})]})})]},s.id))})]})})]})}function u1(){fU();const[t,e]=I.useState("clinicos");return a.jsxs("div",{className:"lp-wrap",children:[a.jsx("h2",{className:"lp-h2",children:"Configuracin  Lista de precios"}),a.jsxs("div",{className:"lp-tabs",children:[a.jsx("button",{className:`lp-pill ${t==="clinicos"?"active":""}`,onClick:()=>e("clinicos"),children:"Lista de precios clnicos"}),a.jsx("button",{className:`lp-pill ${t==="productos"?"active":""}`,onClick:()=>e("productos"),children:"Lista de precios productos"}),a.jsx("button",{className:`lp-pill ${t==="servicios"?"active":""}`,onClick:()=>e("servicios"),children:"Lista de precios servicios"})]}),t==="productos"?a.jsx(gU,{}):t==="servicios"?a.jsx(yU,{}):a.jsx(mU,{})]})}function vU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}const Qp=[{nombre:"Rehabilitacin Oral",comentario:""},{nombre:"Implantologa",comentario:""},{nombre:"Ciruga Oral",comentario:""},{nombre:"Periodoncia",comentario:""},{nombre:"Endodoncia",comentario:""},{nombre:"Ortodoncia",comentario:""},{nombre:"Odontologa General",comentario:""},{nombre:"Radiologa",comentario:""},{nombre:"Psicologa",comentario:""}],Rb=[{codigo:"1",nombre:"Activos"},{codigo:"2",nombre:"Pasivos"},{codigo:"3",nombre:"Patrimonio"},{codigo:"4",nombre:"Ingresos"},{codigo:"5",nombre:"Gastos"},{codigo:"6",nombre:"Costos de ventas"},{codigo:"7",nombre:"Costos de produccin"},{codigo:"8",nombre:"Cuentas de orden deudoras"},{codigo:"9",nombre:"Cuentas de orden acreedoras"}],Pb=t=>Ge(ae,"listas_precios",t),kl=t=>be(ae,"listas_precios",t,"categorias"),yr=(t,e)=>be(ae,"listas_precios",t,"categorias",e,"items");function _U(){I.useEffect(()=>{var r;const t="lp-edit-inline";(r=document.getElementById(t))==null||r.remove();const e=`
      .oc-main-content.lp { padding:16px 20px }
      .oc-section-title { margin-bottom:16px }
      .oc-section-title h2 { margin:0; font-weight:800; font-size:20px; color:#0f172a }
      .card { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.04) }
      .toolbar { display:flex; gap:8px; align-items:center; }

      .chip { height:34px; padding:0 12px; border-radius:999px; border:1px solid #e5e7eb; cursor:pointer; font-weight:600; background:#f9fafb; transition:.15s }
      .chip:hover { background:#e5e7eb }
      .chip.blue   { background:#3b82f6; color:#fff; border:none }
      .chip.green  { background:#22c55e; color:#fff; border:none }
      .chip.orange { background:#f59e0b; color:#fff; border:none }
      .chip.gray   { background:#64748b; color:#fff; border:none }

      .name-row { display:flex; align-items:center; gap:8px; }
      .text-inp { height:38px; padding:0 10px; border-radius:8px; border:1px solid #cbd5e1; outline:none; width:280px }

      .table-responsive { width:100%; overflow-x:auto }
      table { width:100%; border-collapse:collapse; font-size:.9rem }
      thead tr { background:#f1f5f9 }
      th, td { padding:10px 12px; white-space:nowrap; vertical-align:middle }
      th { text-align:left; border-bottom:1px solid #e2e8f0; color:#475569; font-weight:700 }
      tr + tr { border-top:1px solid #e2e8f0 }
      .muted { color:#64748b }
      .status-pill { padding:2px 8px; border-radius:999px; font-weight:600 }
      .status-on { background:#dcfce7; color:#166534 }
      .status-off{ background:#fee2e2; color:#991b1b }

      .btn { padding:4px 8px; border:none; border-radius:6px; color:#fff; cursor:pointer; margin-right:6px; font-weight:600; transition:.12s }
      .btn:hover { opacity:.9 }
      .btn.blue   { background:#3b82f6 }
      .btn.green  { background:#22c55e }
      .btn.orange { background:#f59e0b }
      .btn.red    { background:#ef4444 }
      .btn.sky    { background:#06b6d4 }
      .btn.sm { height:32px; padding:0 10px; border-radius:8px }

      .toggle-cell{width:34px}
      .arrow{font-weight:900;font-size:18px;opacity:.7;cursor:pointer;display:inline-block}
      .row-cat-actions{display:flex;gap:6px;justify-content:flex-end}

      .cat-details{background:#fafafa}
      .inner-table{width:100%; border-collapse:collapse; font-size:.88rem}
      .inner-table th, .inner-table td{padding:8px 10px}
      .inner-table thead tr{background:#f8fafc}
      .inner-actions{display:flex;gap:6px;justify-content:flex-end}
      .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

      /* Modal base */
      .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:999}
      .modal{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(880px,94vw);padding:0;border:1px solid #e5e7eb}
      .modal .hd{padding:12px 16px;border-bottom:1px solid #e5e7eb;font-weight:700}
      .modal .bd{padding:16px}
      .modal .ft{padding:12px 16px;border-top:1px solid #e5e7eb;display:flex;gap:8px;justify-content:flex-end}

      /*  Grilla de 3 columnas con field (label arriba, input abajo)  */
      .form-grid-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; align-items:start; }
      .field{ display:flex; flex-direction:column; gap:6px }
      .field label{ font-weight:700; color:#0f172a }

      .form-row-full{ margin-top:12px }

      .inp{height:36px;border:1px solid #cbd5e1;border-radius:8px;padding:0 10px;outline:none;width:100%}
      .ta{border:1px solid #cbd5e1;border-radius:8px;padding:8px;min-height:84px;outline:none;width:100%}

      /* Toggle simple / pill */
      .toggle{display:inline-flex;align-items:center;gap:10px}
      .toggle-pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #cbd5e1;border-radius:999px;padding:2px 8px;height:32px}
      .toggle-pill span{font-weight:700}

      /* Autocomplete */
      .ac-wrap{position:relative}
      .ac-list{
        position:absolute; z-index:1000; top:100%; left:0; right:0;
        background:#fff; border:1px solid #e5e7eb; border-radius:10px;
        box-shadow:0 8px 30px rgba(0,0,0,.12);
        max-height:240px; overflow:auto; margin-top:4px;
      }
      .ac-item{padding:8px 12px; cursor:pointer; display:flex; gap:8px; align-items:center}
      .ac-item:hover{background:#f1f5f9}
      .ac-code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-weight:700; color:#0f172a}
      .ac-name{color:#334155}
      .ac-empty{padding:10px 12px; color:#64748b}

      /*  Selector % | $ para Mximo descuento  */
      .seg-wrap{ display:flex; align-items:center; gap:8px; }
      .seg{ user-select:none; cursor:pointer; border:1px solid #cbd5e1; border-radius:8px; height:36px; min-width:44px; display:flex; align-items:center; justify-content:center; padding:0 10px; font-weight:700; color:#334155; background:#fff; }
      .seg.on{ background:#0ea5e9; color:#fff; border-color:#0ea5e9; }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}const ss=(t="")=>t==null?void 0:t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function td(t){let e=String(t||"").replace(/\D/g,"");return e===""?"":(e=e.replace(/^0+(?=\d)/,""),e.replace(/\B(?=(\d{3})+(?!\d))/g,"."))}function Yp({value:t,onChange:e,placeholder:n,suggestions:r=[],getLabel:s=c=>(c==null?void 0:c.nombre)||"",onPick:i,renderRow:o,minChars:l=1}){const[c,d]=I.useState(!1),f=I.useRef(null);I.useEffect(()=>{function m(v){f.current&&!f.current.contains(v.target)&&d(!1)}return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const h=c&&((t==null?void 0:t.length)||0)>=l;return a.jsxs("div",{className:"ac-wrap",ref:f,children:[a.jsx("input",{className:"inp",value:t,placeholder:n,onChange:m=>{e(m.target.value),d(!0)},onFocus:()=>d(!0)}),h&&a.jsx("div",{className:"ac-list",children:r.length===0?a.jsx("div",{className:"ac-empty",children:"Sin resultados"}):r.map((m,v)=>a.jsx("div",{className:"ac-item",onClick:()=>{i==null||i(m),d(!1)},children:o?o(m):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"ac-code",children:m.codigo}),a.jsx("span",{className:"ac-name",children:s(m)})]})},v))})]})}function xU(t){_U();const e=kP(),n=(t==null?void 0:t.listaId)??e.id??e.listaId??e.priceListId??e.listId??null,{pathname:r}=gn(),s=kr(),o=`${I.useMemo(()=>vU(r),[r])}/config/lista-de-precios`,[l,c]=I.useState(""),[d,f]=I.useState(!1),[h,m]=I.useState([]),[v,P]=I.useState(!0),[A,C]=I.useState(""),[y,_]=I.useState(!1),[w,T]=I.useState(!1),[V,U]=I.useState(!1),[b,E]=I.useState(null),x={codigo:"",nombre:"",precio:"",observaciones:"",usa_pago_fijo:!1,pago_valor_fijo:"0",permite_descuento:!1,genera_rips:!1,es_consulta:!1,ver_en_agenda:!1,cuenta_contable:"",max_descuento_tipo:"pct",max_descuento_value:""},[S,j]=I.useState(x),[L,k]=I.useState([]),[Y]=I.useState(Rb),[We,Dt]=I.useState(0),[Lt,te]=I.useState("none"),[ue,ye]=I.useState("existentes"),[Pe,Qe]=I.useState([]),[Et,$]=I.useState(""),[re,de]=I.useState("");I.useEffect(()=>{async function O(){if(!n){C("Ruta invlida: falta el id de la lista."),P(!1);return}P(!0);try{const G=await qc(Pb(n));c(G.exists()&&G.data().nombre||"")}catch{c(""),C("No se pudo cargar la lista. Revisa la ruta y permisos.")}try{const D=(await Je(kl(n))).docs.map(H=>({id:H.id,expanded:!1,itemsLoaded:!1,items:[],activa:H.data().activa??!0,...H.data()}));D.sort((H,K)=>(H.nombre||"").localeCompare(K.nombre||"")),m(D)}finally{P(!1)}}O()},[n]),I.useEffect(()=>{async function O(){try{const D=(await Je(be(ae,"catalogo_procedimientos"))).docs.map(H=>({id:H.id,...H.data()})).filter(H=>H.codigo&&H.nombre);k(D)}catch{k([])}}O()},[]);async function Ce(){try{if(!n)return;f(!0),await zn(Pb(n),{nombre:(l||"").trim(),actualizado:new Date().toLocaleString("es-CO")})}catch{alert("No se pudo actualizar el nombre.")}finally{f(!1)}}async function Ne(O){if(m(G=>G.map(D=>D.id===O.id?{...D,expanded:!D.expanded}:D)),!O.itemsLoaded&&n){const G=await Je(yr(n,O.id)).catch(()=>null),D=G?G.docs.map(H=>({id:H.id,...H.data()})):[];m(H=>H.map(K=>K.id===O.id?{...K,items:D,itemsLoaded:!0}:K))}}async function je(O){if(!n)return;const G=(prompt("Editar nombre de la categora:",O.nombre)||"").trim();if(!G)return;const D=(prompt("Comentario (opcional):",O.comentario||"")||"").trim();await zn(Ge(kl(n),O.id),{nombre:G,comentario:D}),m(H=>H.map(K=>K.id===O.id?{...K,nombre:G,comentario:D}:K))}async function Ee(O){if(!n||!confirm(`Eliminar categora "${O.nombre}" y TODOS sus tems?`))return;const G=await Je(yr(n,O.id)).catch(()=>null);G&&await Promise.all(G.docs.map(D=>ps(Ge(yr(n,O.id),D.id)))),await ps(Ge(kl(n),O.id)),m(D=>D.filter(H=>H.id!==O.id))}async function ot(O){if(!n)return;const G=prompt("Ajuste porcentual (ej.: 5 para +5%, -10 para -10%)","5");if(G==null)return;const D=Number(G);if(Number.isNaN(D))return alert("Valor invlido.");const H=await Je(yr(n,O.id)).catch(()=>null);H&&(await Promise.all(H.docs.map(async K=>{const pe=K.data()||{},Te=Math.round(Number(pe.precio||0)*(1+D/100));await zn(Ge(yr(n,O.id),K.id),{precio:Te,actualizado:new Date().toLocaleString("es-CO")})})),m(K=>K.map(pe=>pe.id===O.id?{...pe,items:pe.items.map(Te=>({...Te,precio:Math.round(Number(Te.precio||0)*(1+D/100))}))}:pe)),alert("Precios actualizados."))}function ke(O){E(O),j(x),U(!0)}async function fe(){if(!n||!b)return;if(!S.nombre.trim())return alert("El nombre es obligatorio.");const O=pe=>Number(String(pe).replace(/\D/g,""))||0;let G=0,D=0;S.permite_descuento&&(S.max_descuento_tipo==="pct"?G=Math.max(0,Number(String(S.max_descuento_value).replace(",",".")||0)):D=O(S.max_descuento_value));const H={codigo:S.codigo.trim(),nombre:S.nombre.trim(),permite_descuento:!!S.permite_descuento,max_descuento_pct:G,max_descuento_valor:D,genera_rips:!!S.genera_rips,es_consulta:!!S.es_consulta,ver_en_agenda:!!S.ver_en_agenda,cuenta_contable:S.cuenta_contable.trim(),comentario:S.observaciones.trim(),precio:O(S.precio),usa_pago_fijo:!!S.usa_pago_fijo,pago_valor_fijo:O(S.pago_valor_fijo),creado:new Date().toLocaleString("es-CO")},K=await wn(yr(n,b.id),H);m(pe=>pe.map(Te=>Te.id===b.id?{...Te,items:[...Te.items,{id:K.id,...H}],expanded:!0}:Te)),U(!1)}async function De(O,G){if(!n)return;const D=(prompt("Cdigo:",G.codigo||"")||"").trim(),H=(prompt("Nombre:",G.nombre||"")||"").trim(),K=window.confirm("Permite descuento? (Aceptar = S / Cancelar = No)"),pe=(prompt("Precio (COP):",String(G.precio||0))||"0").replace(/\D/g,""),Te=Number(pe||0);await zn(Ge(yr(n,O.id),G.id),{codigo:D,nombre:H,permite_descuento:!!K,precio:Te,actualizado:new Date().toLocaleString("es-CO")}),m(ht=>ht.map(at=>at.id===O.id?{...at,items:at.items.map(ft=>ft.id===G.id?{...ft,codigo:D,nombre:H,permite_descuento:!!K,precio:Te}:ft)}:at))}async function Fe(O,G){n&&confirm(`Eliminar "${G.nombre}"?`)&&(await ps(Ge(yr(n,O.id),G.id)),m(D=>D.map(H=>H.id===O.id?{...H,items:H.items.filter(K=>K.id!==G.id)}:H)))}async function tt(){try{const O=be(ae,"catalogo_categorias");for(const G of Qp){const D=`${G.nombre}`.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-");await Wa(Ge(O,D),{nombre:G.nombre,comentario:G.comentario||""},{merge:!0})}alert("Catlogo base creado/actualizado. Vuelve a abrir 'Categoras existentes'.")}catch{alert("No se pudo sembrar el catlogo base.")}}async function Q(){T(!0),ye("existentes"),$(""),de("");try{const G=(await Je(be(ae,"catalogo_categorias"))).docs.map(D=>({id:D.id,...D.data()}));Qe(G.length?G:Qp.map((D,H)=>({id:`def-${H}`,...D})))}catch{Qe(Qp.map((O,G)=>({id:`def-${G}`,...O})))}}async function oe(O){if(n)try{const G=kl(n);await wn(G,{nombre:O.nombre,comentario:O.comentario||"",activa:!0,creado:new Date().toLocaleString("es-CO")});const D=await Je(G);m(D.docs.map(H=>({id:H.id,...H.data(),activa:H.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),alert("Categora agregada.")}catch{alert("No se pudo agregar la categora.")}}async function z(){if(n){if(!Et.trim())return alert("Escribe el nombre de la categora.");try{const O=kl(n);await wn(O,{nombre:Et.trim(),comentario:re.trim(),activa:!0,creado:new Date().toLocaleString("es-CO")});const G=await Je(O);m(G.docs.map(D=>({id:D.id,...D.data(),activa:D.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),T(!1)}catch{alert("No se pudo crear la categora.")}}}function ie(){return new Promise(O=>{if(typeof window<"u"&&window.XLSX)return O(window.XLSX);const G=document.createElement("script");G.src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js",G.onload=()=>O(window.XLSX||null),G.onerror=()=>O(null),document.head.appendChild(G)})}function le(O,G){return G==="up"?Math.ceil(O):G==="down"?Math.floor(O):O}async function _e(){if(!n)return;const O=Number(We);if(!Number.isFinite(O))return alert("Ingresa un porcentaje vlido.");try{for(const G of h){const D=await Je(yr(n,G.id)).catch(()=>null);if(D)for(const H of D.docs){const K=H.data()||{},pe=le(Number(K.precio||0)*(1+O/100),Lt);await zn(Ge(yr(n,G.id),H.id),{precio:pe,actualizado:new Date().toLocaleString("es-CO")})}}alert("Precios actualizados."),_(!1)}catch{alert("No se pudo aplicar el incremento.")}}async function xe(){try{if(!n)return;const O=["Categora","Cdigo","Nombre","Permite desc","Precio","Genera RIPS","Es consulta","Ver en agenda","Nombre en la agenda","Tiempo","Identificador","Cuenta contable"],G=[],D=`OdontoCloud  Lista de precios  ${l||"Principal"}`,H=`Exportado: ${new Date().toLocaleString("es-CO")}`;G.push([D]),G.push([H]),G.push([]),G.push(O);const K=4,pe=at=>at?"si":"no";for(const at of h){const ft=await Je(yr(n,at.id)).catch(()=>null),bt=ft?ft.docs.map(ze=>({id:ze.id,...ze.data()})):[];for(const ze of bt)G.push([at.nombre||"",ze.codigo||"",ze.nombre||"",pe(!!ze.permite_descuento),Number(ze.precio||0),pe(!!ze.genera_rips),pe(!!ze.es_consulta),pe(!!ze.ver_en_agenda),ze.nombre_en_agenda||"",Number(ze.tiempo||0),ze.identificador||"",ze.cuenta_contable||""])}const Te=await ie(),ht=`OdontoCloud-ListaPrecios-${l||"Principal"}`;if(Te&&Te.utils&&G.length>K-1){const at=Te.utils.aoa_to_sheet(G);at["!cols"]=[{wch:22},{wch:14},{wch:36},{wch:12},{wch:14},{wch:12},{wch:12},{wch:14},{wch:28},{wch:10},{wch:16},{wch:18}],at["!merges"]=[{s:{r:0,c:0},e:{r:0,c:11}},{s:{r:1,c:0},e:{r:1,c:11}}];const ft=G.length;at["!autofilter"]={ref:`A${K}:L${ft}`};const bt=Te.utils.book_new();Te.utils.book_append_sheet(bt,at,"Lista de precios");const ze=Te.write(bt,{bookType:"xlsx",type:"array"}),yt=new Blob([ze],{type:"application/octet-stream"}),lt=document.createElement("a");lt.href=URL.createObjectURL(yt),lt.download=`${ht}.xlsx`,lt.click(),URL.revokeObjectURL(lt.href)}else{const at=G.map(ze=>ze.map(yt=>{const lt=String(yt??"").replace(/"/g,'""');return/[",\n]/.test(lt)?`"${lt}"`:lt}).join(",")).join(`
`),ft=new Blob([at],{type:"text/csv;charset=utf-8"}),bt=document.createElement("a");bt.href=URL.createObjectURL(ft),bt.download=`${ht}.csv`,bt.click(),URL.revokeObjectURL(bt.href)}}catch{alert("No se pudo exportar.")}}const Me=I.useMemo(()=>{const O=ss(S.nombre);return O?L.filter(G=>ss(G.nombre).includes(O)||ss(G.codigo).startsWith(O)).slice(0,12):[]},[S.nombre,L]),Ae=I.useMemo(()=>{const O=ss(S.codigo);return O?L.filter(G=>ss(G.codigo).startsWith(O)||ss(G.nombre).includes(O)).slice(0,12):[]},[S.codigo,L]),Le=I.useMemo(()=>{const O=ss(S.cuenta_contable);return O?Y.filter(G=>ss(G.codigo).startsWith(O)||ss(G.nombre).includes(O)).slice(0,20):Rb.slice(0,12)},[S.cuenta_contable,Y]);return a.jsxs("div",{className:"oc-main-content lp",children:[a.jsx("div",{className:"oc-section-title",children:a.jsx("h2",{children:"Configuracin  Edicin Lista de precios"})}),A&&a.jsx("div",{style:{marginBottom:12,padding:"8px 12px",border:"1px solid #fecaca",background:"#fef2f2",color:"#991b1b",borderRadius:8},children:A}),a.jsxs("div",{className:"card",children:[a.jsxs("div",{className:"toolbar",style:{justifyContent:"space-between",marginBottom:12},children:[a.jsxs("div",{className:"name-row",children:[a.jsx("label",{style:{fontWeight:700},children:"Nombre*"}),a.jsx("input",{className:"text-inp",value:l,placeholder:"Principal",onChange:O=>c(O.target.value)}),a.jsx("button",{className:"btn green",onClick:Ce,disabled:d,title:"Guardar nombre",children:d?"Guardando":"Guardar"})]}),a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("button",{className:"chip orange",title:"Incrementar %",onClick:()=>{Dt(0),te("none"),_(!0)},children:"%"}),a.jsx("button",{className:"chip green",onClick:Q,children:"+ Agregar categora"}),a.jsx("button",{className:"chip blue",title:"Exportar",onClick:xe,children:"Exportar"})]})]}),a.jsx("div",{className:"table-responsive",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:"toggle-cell"}),a.jsx("th",{children:"Categora"}),a.jsx("th",{children:"Comentario"}),a.jsx("th",{style:{width:140},children:"Estado"}),a.jsx("th",{style:{width:360,textAlign:"right"},children:"Acciones"})]})}),a.jsx("tbody",{children:v?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):h.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Sin categoras."})}):h.map(O=>a.jsxs(Dg.Fragment,{children:[a.jsxs("tr",{children:[a.jsx("td",{className:"toggle-cell",children:a.jsx("span",{className:"arrow",onClick:()=>Ne(O),children:O.expanded?"":""})}),a.jsx("td",{style:{fontWeight:700},children:O.nombre||"Categora"}),a.jsx("td",{className:"muted",children:O.comentario||""}),a.jsx("td",{children:a.jsx("span",{className:`status-pill ${O.activa?"status-on":"status-off"}`,children:O.activa?"Conectado":"Desconectado"})}),a.jsx("td",{style:{textAlign:"right"},children:a.jsxs("div",{className:"row-cat-actions",children:[a.jsx("button",{className:"btn green sm",title:"Nuevo tem",onClick:()=>ke(O),children:""}),a.jsx("button",{className:"btn orange sm",title:"Actualizar precios %",onClick:()=>ot(O),children:"%"}),a.jsx("button",{className:"btn sky sm",title:"Editar categora",onClick:()=>je(O),children:""}),a.jsx("button",{className:"btn red sm",title:"Eliminar categora",onClick:()=>Ee(O),children:""})]})})]}),O.expanded&&a.jsxs("tr",{className:"cat-details",children:[a.jsx("td",{}),a.jsx("td",{colSpan:4,children:a.jsx("div",{className:"table-responsive",children:a.jsxs("table",{className:"inner-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{style:{width:110},children:"Cdigo"}),a.jsx("th",{children:"Lista de precios"}),a.jsx("th",{style:{width:160},children:"Permite descuento"}),a.jsx("th",{style:{width:140},children:"Precio"}),a.jsx("th",{style:{width:140,textAlign:"right"},children:"Acciones"})]})}),a.jsx("tbody",{children:!O.items||O.items.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:5,className:"muted",style:{textAlign:"center",padding:12},children:"Sin tems en esta categora."})}):O.items.map(G=>a.jsxs("tr",{children:[a.jsx("td",{className:"mono",children:G.codigo||""}),a.jsx("td",{style:{fontWeight:600},children:G.nombre||""}),a.jsx("td",{children:G.permite_descuento?"S":"No"}),a.jsxs("td",{className:"mono",children:["$",Number(G.precio||0).toLocaleString("es-CO")]}),a.jsx("td",{style:{textAlign:"right"},children:a.jsxs("div",{className:"inner-actions",children:[a.jsx("button",{className:"btn sky sm",onClick:()=>De(O,G),children:""}),a.jsx("button",{className:"btn red sm",onClick:()=>Fe(O,G),children:""})]})})]},G.id))})]})})})]})]},O.id))})]})}),a.jsx("div",{style:{marginTop:16},children:a.jsx("button",{className:"chip gray",onClick:()=>s(o),children:" Volver"})})]}),w&&a.jsx("div",{className:"modal-mask",onClick:()=>T(!1),children:a.jsxs("div",{className:"modal",onClick:O=>O.stopPropagation(),children:[a.jsx("div",{className:"hd",children:"Categora"}),a.jsxs("div",{className:"bd",children:[a.jsxs("div",{className:"row",style:{gap:6,marginBottom:12},children:[a.jsx("button",{className:`chip ${ue==="existentes"?"blue":""}`,onClick:()=>ye("existentes"),children:"Categoras existentes"}),a.jsx("button",{className:`chip ${ue==="nueva"?"blue":""}`,onClick:()=>ye("nueva"),children:"Editar/Nueva categora"}),a.jsx("button",{className:"chip green",onClick:tt,children:"Sembrar catlogo base"})]}),ue==="existentes"?a.jsx("div",{children:Pe.length===0?a.jsx("p",{className:"muted",children:"No hay catlogo disponible. Puedes crear una nueva categora en la pestaa de la derecha."}):a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Comentario"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:Pe.map(O=>a.jsxs("tr",{children:[a.jsx("td",{children:O.nombre}),a.jsx("td",{className:"muted",children:O.comentario||""}),a.jsx("td",{children:a.jsx("button",{className:"btn green sm",onClick:()=>oe(O),children:"Agregar"})})]},O.id))})]})}):a.jsxs("div",{children:[a.jsxs("div",{className:"row",children:[a.jsx("label",{style:{minWidth:140},children:"Nombre *"}),a.jsx("input",{className:"inp",placeholder:"Ingrese el nombre de la categora",value:Et,onChange:O=>$(O.target.value)})]}),a.jsxs("div",{className:"row",style:{alignItems:"flex-start"},children:[a.jsx("label",{style:{minWidth:140,paddingTop:6},children:"Comentario"}),a.jsx("textarea",{className:"ta",placeholder:"",value:re,onChange:O=>de(O.target.value)})]})]})]}),a.jsxs("div",{className:"ft",children:[a.jsx("button",{className:"chip gray",onClick:()=>T(!1),children:"Cerrar"}),ue==="nueva"&&a.jsx("button",{className:"chip green",onClick:z,children:"Guardar"})]})]})}),y&&a.jsx("div",{className:"modal-mask",onClick:()=>_(!1),children:a.jsxs("div",{className:"modal",onClick:O=>O.stopPropagation(),children:[a.jsx("div",{className:"hd",children:"Incrementar todos los precios"}),a.jsx("div",{className:"bd",children:a.jsxs("div",{className:"col",children:[a.jsx("label",{className:"label-strong",children:"Porcentaje de incremento *"}),a.jsx("div",{className:"row",children:a.jsx("input",{className:"inp",style:{maxWidth:160},type:"number",min:"0",step:"0.01",placeholder:"0",value:We,onChange:O=>Dt(O.target.value)})}),a.jsxs("div",{className:"col",style:{gap:8},children:[a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"radio",name:"round",checked:Lt==="down",onChange:()=>te("down")})," Redondear hacia abajo"]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"radio",name:"round",checked:Lt==="up",onChange:()=>te("up")})," Redondear hacia arriba"]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"radio",name:"round",checked:Lt==="none",onChange:()=>te("none")})," No redondear"]})]})]})}),a.jsxs("div",{className:"ft",children:[a.jsx("button",{className:"chip gray",onClick:()=>_(!1),children:"Cerrar"}),a.jsx("button",{className:"chip green",onClick:_e,children:"Incrementar"})]})]})}),V&&a.jsx("div",{className:"modal-mask",onClick:()=>U(!1),children:a.jsxs("div",{className:"modal",onClick:O=>O.stopPropagation(),children:[a.jsxs("div",{className:"hd",children:["Agregar producto ",b?` ${b.nombre}`:""]}),a.jsxs("div",{className:"bd",children:[a.jsxs("div",{className:"form-grid-3",children:[a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Cdigo *"}),a.jsx(Yp,{value:S.codigo,onChange:O=>j({...S,codigo:O}),placeholder:"Cdigo (ej. 890203)",suggestions:Ae,onPick:O=>j({...S,codigo:O.codigo,nombre:O.nombre}),renderRow:O=>a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"ac-code",children:O.codigo}),a.jsx("span",{className:"ac-name",children:O.nombre})]}),minChars:1})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Nombre *"}),a.jsx(Yp,{value:S.nombre,onChange:O=>j({...S,nombre:O}),placeholder:"Nombre del procedimiento",suggestions:Me,onPick:O=>j({...S,codigo:O.codigo,nombre:O.nombre}),renderRow:O=>a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"ac-code",children:O.codigo}),a.jsx("span",{className:"ac-name",children:O.nombre})]}),minChars:1})]}),a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Precio *"}),a.jsx("input",{className:"inp",type:"text",inputMode:"numeric",pattern:"\\\\d*",placeholder:"$0",value:S.precio,onChange:O=>j({...S,precio:td(O.target.value)})})]})]}),a.jsx("div",{className:"form-row-full",children:a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Observaciones"}),a.jsx("textarea",{className:"ta",value:S.observaciones,onChange:O=>j({...S,observaciones:O.target.value})})]})}),a.jsxs("div",{className:"form-row-full",style:{display:"grid",gridTemplateColumns:"160px auto auto",gap:"12px",alignItems:"center"},children:[a.jsxs("div",{className:"field",style:{margin:0},children:[a.jsx("label",{children:"Pago valor fijo a doctores"}),a.jsx("input",{className:"inp",type:"number",min:"0",value:S.pago_valor_fijo,onChange:O=>j({...S,pago_valor_fijo:O.target.value})})]}),a.jsxs("label",{className:"toggle",style:{marginTop:18},children:[a.jsx("input",{type:"checkbox",checked:S.usa_pago_fijo,onChange:O=>j({...S,usa_pago_fijo:O.target.checked})}),"Usar valor fijo"]}),a.jsx("div",{className:"muted",children:"Use este campo para no liquidar a los doctores por su % configurado sino por un valor fijo en dinero $"})]}),a.jsxs("div",{className:"form-row-full",style:{display:"flex",gap:18,flexWrap:"wrap"},children:[a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:S.permite_descuento,onChange:O=>j({...S,permite_descuento:O.target.checked,...O.target.checked?{}:{max_descuento_value:""}})}),"Permite descuento"]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:S.genera_rips,onChange:O=>j({...S,genera_rips:O.target.checked})}),"Genera RIPS"]}),a.jsxs("label",{className:"toggle",children:[a.jsx("input",{type:"checkbox",checked:S.es_consulta,onChange:O=>j({...S,es_consulta:O.target.checked})}),"Es consulta"]}),a.jsxs("div",{className:"toggle",children:[a.jsx("span",{children:"Ver en agenda"}),a.jsxs("label",{className:"toggle-pill",children:[a.jsx("input",{type:"checkbox",checked:S.ver_en_agenda,onChange:O=>j({...S,ver_en_agenda:O.target.checked})}),a.jsx("span",{children:S.ver_en_agenda?"S":"No"})]})]})]}),S.permite_descuento&&a.jsx("div",{className:"form-row-full",children:a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Mximo descuento"}),a.jsxs("div",{className:"seg-wrap",children:[a.jsx("div",{className:`seg ${S.max_descuento_tipo==="pct"?"on":""}`,onClick:()=>j({...S,max_descuento_tipo:"pct",max_descuento_value:String(S.max_descuento_value).replace(/\D+/g,"")}),title:"Porcentaje",children:"%"}),a.jsx("div",{className:`seg ${S.max_descuento_tipo==="valor"?"on":""}`,onClick:()=>j({...S,max_descuento_tipo:"valor",max_descuento_value:td(S.max_descuento_value)}),title:"Valor en $",children:"$"}),S.max_descuento_tipo==="pct"?a.jsx("input",{className:"inp",type:"number",min:"0",step:"0.01",placeholder:"0",value:String(S.max_descuento_value).replace(/[^\d.,-]/g,""),onChange:O=>j({...S,max_descuento_value:O.target.value})}):a.jsx("input",{className:"inp",type:"text",inputMode:"numeric",placeholder:"$0",value:td(S.max_descuento_value),onChange:O=>j({...S,max_descuento_value:td(O.target.value)})})]})]})}),a.jsx("div",{className:"form-row-full",children:a.jsxs("div",{className:"field",children:[a.jsx("label",{children:"Cuenta contable"}),a.jsx(Yp,{value:S.cuenta_contable,onChange:O=>j({...S,cuenta_contable:O}),placeholder:"Buscar tem...",suggestions:Le,onPick:O=>j({...S,cuenta_contable:`${O.codigo}  ${O.nombre}`}),renderRow:O=>a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"ac-code",style:{minWidth:72},children:O.codigo}),a.jsx("span",{className:"ac-name",children:O.nombre})]}),minChars:0})]})})]}),a.jsxs("div",{className:"ft",children:[a.jsx("button",{className:"chip gray",onClick:()=>U(!1),children:"Cerrar"}),a.jsx("button",{className:"chip green",onClick:fe,children:"Guardar"})]})]})})]})}const jl="listas_precios_productos";function wU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function EU(){const[t,e]=I.useState(!0),[n,r]=I.useState([]),{pathname:s}=gn(),i=kr(),o=I.useMemo(()=>wU(s),[s]),l=h=>i(`${o}/config/lista-de-precios/productos/editar/${h.id}`);I.useEffect(()=>{async function h(){e(!0);try{const v=(await Je(be(ae,jl))).docs.map(P=>({id:P.id,...P.data()}));v.sort((P,A)=>{const C=P.actualizado||P.creado||"",y=A.actualizado||A.creado||"";return C&&y?String(y).localeCompare(String(C)):((P==null?void 0:P.nombre)||"").localeCompare((A==null?void 0:A.nombre)||"")}),r(v)}catch(m){console.error("[LP Productos] cargar:",m==null?void 0:m.code,m==null?void 0:m.message),r([])}finally{e(!1)}}h()},[]);async function c(){try{const m={nombre:`Lista de productos ${new Date().toLocaleDateString("es-CO")}`,creado:new Date().toLocaleString("es-CO"),actualizado:new Date().toLocaleString("es-CO"),en_uso:!1,tipo:"productos"},v=await wn(be(ae,jl),m);r(P=>[{id:v.id,...m},...P])}catch(h){console.error(h),alert("No se pudo crear el listado de productos.")}}async function d(h){try{const v=(await Je(be(ae,jl))).docs.map(P=>zn(Ge(ae,jl,P.id),{en_uso:P.id===h.id}));await Promise.all(v),r(P=>P.map(A=>({...A,en_uso:A.id===h.id})))}catch(m){console.error(m),alert("No se pudo cambiar el estado de uso.")}}async function f(h){if(window.confirm(`Eliminar "${h==null?void 0:h.nombre}"?`))try{await ps(Ge(ae,jl,h.id)),r(m=>m.filter(v=>v.id!==h.id))}catch(m){console.error(m),alert("No se pudo eliminar.")}}return a.jsxs("div",{className:"lp-card",children:[a.jsxs("div",{className:"lp-tabs",style:{justifyContent:"space-between"},children:[a.jsx("div",{style:{display:"flex",gap:8},children:a.jsx("span",{className:"lp-pill active",children:"Lista de precios productos"})}),a.jsx("button",{className:"btn blue",onClick:c,children:"+ Nuevo listado de productos"})]}),a.jsx("div",{className:"lp-table-wrap",children:a.jsxs("table",{children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nombre"}),a.jsx("th",{children:"Fecha de creacin"}),a.jsx("th",{children:"Fecha de actualizacin"}),a.jsx("th",{children:"En uso"}),a.jsx("th",{children:"Acciones"})]})}),a.jsx("tbody",{children:t?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):n.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:a.jsx("span",{className:"muted",children:"Sin datos"})})}):n.map(h=>a.jsxs("tr",{children:[a.jsx("td",{style:{fontWeight:700},children:(h==null?void 0:h.nombre)||""}),a.jsx("td",{children:(h==null?void 0:h.creado)||""}),a.jsx("td",{children:(h==null?void 0:h.actualizado)||""}),a.jsx("td",{style:{color:h!=null&&h.en_uso?"#16a34a":"#64748b"},children:h!=null&&h.en_uso?"En uso":""}),a.jsx("td",{children:a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("button",{className:"btn blue",onClick:()=>l(h),children:"Editar"}),a.jsx("button",{className:"btn green",onClick:()=>d(h),children:"Usar"}),a.jsx("button",{className:"btn red",onClick:()=>f(h),children:"Eliminar"})]})})]},h.id))})]})})]})}function bU(){const[t,e]=I.useState(null),[n,r]=I.useState([]),[s,i]=I.useState(!1),[o,l]=I.useState(0),[c,d]=I.useState(0),f=m=>r(v=>[...v,m]);async function h(){if(!t)return alert("Selecciona el CSV primero.");i(!0),l(0),d(0),r([]);try{const v=(await t.text()).split(/\r?\n/).filter(Boolean),P=v.shift();if(!/codigo\s*;\s*nombre/i.test(P||"")){f("Encabezado invlido. Debe ser: codigo;nombre (separado por punto y coma ;)"),i(!1);return}const A=250;for(let C=0;C<v.length;C+=A){const y=v.slice(C,C+A);await Promise.all(y.map(async _=>{const w=_.split(";"),T=(w[0]||"").trim().replace(/\./g,""),V=(w.slice(1).join(";")||"").trim().replace(/^"|"$/g,"");if(!T||!V){d(U=>U+1);return}try{await Wa(Ge(ae,"catalogo_procedimientos",T),{codigo:T,nombre:V,area:"Odontologa",activo:!0,fuente:"CUPS",version:"2024",updatedAt:new Date().toISOString()},{merge:!0}),l(U=>U+1)}catch(U){d(b=>b+1),f(`Error ${T}: ${(U==null?void 0:U.message)||U}`)}})),f(`Cargado ${Math.min(C+A,v.length)} / ${v.length}`)}f(" Importacin finalizada.")}catch(m){f(` Error: ${(m==null?void 0:m.message)||m}`)}finally{i(!1)}}return a.jsxs("div",{style:{maxWidth:760,margin:"24px auto",background:"#fff",padding:16,borderRadius:12,border:"1px solid #e5e7eb"},children:[a.jsx("h2",{style:{marginTop:0},children:"Importar procedimientos (Odontologa  CUPS 2024)"}),a.jsxs("p",{children:["Sube tu CSV con columnas ",a.jsx("b",{children:"codigo;nombre"})," (punto y coma)."]}),a.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[a.jsx("input",{type:"file",accept:".csv",onChange:m=>{var v;return e(((v=m.target.files)==null?void 0:v[0])||null)}}),a.jsx("button",{disabled:!t||s,onClick:h,style:{padding:"8px 12px",borderRadius:8,background:"#22c55e",color:"#fff",border:"none",fontWeight:700},children:s?"Cargando...":"Cargar"})]}),a.jsxs("div",{style:{marginTop:12,display:"flex",gap:12},children:[a.jsxs("span",{children:[" OK: ",o]}),a.jsxs("span",{children:[" Fallidos: ",c]}),s&&a.jsx("span",{children:" Procesando"})]}),a.jsx("pre",{style:{background:"#f8fafc",padding:12,borderRadius:8,marginTop:12,maxHeight:260,overflow:"auto",fontSize:12},children:n.join(`
`)})]})}const IU={"datos-basicos":dU,logo:hU,"lista-de-precios":u1,"importar-procedimientos":bU};function TU(t=""){const e=t.toLowerCase().indexOf("/config/");return e===-1?[]:t.slice(e+8).split("/").filter(Boolean)}function SU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function CU({current:t,onNav:e}){const n=[{slug:"datos-basicos",label:"Datos bsicos"},{slug:"logo",label:"Logo"},{slug:"lista-de-precios",label:"Lista de precios"},{slug:"consecutivos",label:"Consecutivos",soon:!0},{slug:"sucursales",label:"Sucursales",soon:!0},{slug:"metodos-de-pago",label:"Mtodos de pago",soon:!0},{slug:"especialidades",label:"Especialidades",soon:!0},{slug:"usuarios",label:"Usuarios",soon:!0},{slug:"condiciones-de-pago",label:"Condiciones de pago",soon:!0},{slug:"plantillas-doc-clinicos",label:"Plantillas Doc. Clnicos",soon:!0},{slug:"impuestos",label:"Impuestos",soon:!0}];return a.jsxs("aside",{style:{width:300,flex:"0 0 300px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,position:"sticky",top:12,alignSelf:"flex-start",maxHeight:"calc(100vh - 24px)",overflow:"auto"},"aria-label":"Informacin general",children:[a.jsx("h4",{style:{margin:"4px 0 10px",color:"#64748b"},children:"Informacin general"}),a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.map(r=>{const s=r.slug===t;return a.jsxs("button",{type:"button",onClick:()=>!r.soon&&e(r.slug),title:r.soon?"Prximamente":r.label,style:{textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid "+(s?"#60a5fa":"#e5e7eb"),background:s?"#eff6ff":"#f9fafb",fontWeight:600,cursor:r.soon?"not-allowed":"pointer",color:r.soon?"#94a3b8":"#0f172a"},children:[r.label," ",r.soon?"  prximamente":""]},r.slug)})})]})}function kb(){return a.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[a.jsx("h3",{style:{marginTop:0},children:"Configuracin"}),a.jsxs("p",{className:"oc-muted",style:{margin:0},children:["Selecciona una seccin del men de la izquierda para empezar (por ejemplo, ",a.jsx("b",{children:"Datos bsicos"}),")."]})]})}function NU(){const{pathname:t}=gn(),e=kr(),n=TU(t),r=n[0]||"",s=n[1]||"",i=SU(t),o=r==="lista-de-precios"&&!s,l=r==="lista-de-precios"&&s==="productos",c=r==="lista-de-precios"&&s==="editar";let d=IU[r]||kb,f={};if(c){const m=n[2]||null;d=xU,f={listaId:m,key:`lpedit-${m||"none"}`}}else l?d=EU:o&&(d=u1);const h=m=>e(`${i}/config/${m}`);return I.useEffect(()=>{r||e(`${i}/config/datos-basicos`,{replace:!0})},[r,i,e]),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",gap:16,background:"#f8fafc",padding:16,borderRadius:12},children:[a.jsx(CU,{current:r,onNav:h}),a.jsx("div",{style:{minWidth:0,background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:r?a.jsx(d,{...f}):a.jsx(kb,{})})]})}const Ur=t=>(Number(t)||0).toLocaleString("es-CO",{maximumFractionDigits:0}),Wo=()=>new Date().toISOString().slice(0,10),AU=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),RU=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0),jb=t=>He.fromDate(t),PU=()=>{const[t,e]=I.useState(null);return I.useEffect(()=>{const n=zy(kh,r=>e(r||null));return()=>n()},[]),t},Yt=({children:t,align:e})=>a.jsx("th",{className:"oc-th",style:{position:"sticky",top:0,zIndex:1,textAlign:e||"left",background:"var(--oc-surface, #fff)"},children:t}),kU=()=>Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);function jU(){var G;const t=PU(),e=[{key:"abrir",label:"Abrir caja",icon:""},{key:"abiertas",label:"Cajas abiertas",icon:""},{key:"cerradas",label:"Cajas cerradas",icon:""},{key:"mio",label:"Mi caja (hoy)",icon:""},{key:"simulados",label:"Cierres simulados",icon:""},{key:"bancos",label:"Bancos",icon:""}],[n,r]=I.useState("abiertas"),[s,i]=I.useState(""),[o,l]=I.useState(""),c=I.useRef(null),[d,f]=I.useState(!1),[h,m]=I.useState(""),[v,P]=I.useState([]),[A,C]=I.useState(!0),[y,_]=I.useState([]),[w,T]=I.useState(!0),[V,U]=I.useState(null),[b,E]=I.useState(!0),[x,S]=I.useState(""),[j,L]=I.useState([]),[k,Y]=I.useState(null),[We,Dt]=I.useState(""),[Lt,te]=I.useState("efectivo"),[ue,ye]=I.useState(!1),[Pe,Qe]=I.useState("ingreso"),[Et,$]=I.useState(""),[re,de]=I.useState(""),[Ce,Ne]=I.useState(!1),[je,Ee]=I.useState([]),[ot,ke]=I.useState([]);I.useEffect(()=>{const D=ut(be(ae,"cajas"),nt("estado","==","abierta"),xn("fechaApertura","desc")),H=Bn(D,K=>{P(K.docs.map(pe=>fe(pe.id,pe.data()))),C(!1),i("")},K=>{console.error(K),i((K==null?void 0:K.code)==="failed-precondition"?"Falta ndice (estado, fechaApertura) en Firestore.":(K==null?void 0:K.code)==="permission-denied"?"Permiso denegado en Firestore (revisa reglas).":"No se pudieron leer las cajas."),C(!1)});return()=>H()},[]),I.useEffect(()=>{const D=ut(be(ae,"cajas"),nt("estado","==","cerrada"),xn("fechaCierre","desc")),H=Bn(D,K=>{_(K.docs.map(pe=>fe(pe.id,pe.data()))),T(!1)},K=>{console.error(K),T(!1)});return()=>H()},[]),I.useEffect(()=>{if(!t){U(null),E(!1);return}E(!0);const D=ut(be(ae,"cajas"),nt("estado","==","abierta"),nt("usuarioId","==",t.uid),nt("fechaApertura",">=",jb(AU())),nt("fechaApertura","<",jb(RU()))),H=Bn(D,K=>{const pe=K.docs[0];U(pe?fe(pe.id,pe.data()):null),E(!1)},K=>{console.error(K),E(!1),(K==null?void 0:K.code)==="failed-precondition"&&i("Falta ndice (estado, usuarioId, fechaApertura) en Firestore.")});return()=>H()},[t]),I.useEffect(()=>{if(!(V!=null&&V.id)){Ee([]),ke([]);return}const D=ut(be(ae,"movimientos"),nt("cashId","==",V.id),nt("dia","==",Wo()),xn("fecha","desc")),H=Bn(D,Te=>Ee(Te.docs.map(ht=>({id:ht.id,...ht.data()}))),Te=>console.error(Te)),K=ut(be(ae,"payments"),nt("cashId","==",V.id),nt("dia","==",Wo()),xn("fecha","desc")),pe=Bn(K,Te=>ke(Te.docs.map(ht=>({id:ht.id,...ht.data()}))),Te=>console.error(Te));return()=>{H(),pe()}},[V==null?void 0:V.id]),I.useEffect(()=>{if(!(x!=null&&x.trim())){L([]);return}const D=ut(be(ae,"patients"),nt("q",">=",z(x)),nt("q","<=",z(x)+""),xn("q","asc")),H=Bn(D,K=>L(K.docs.map(pe=>({id:pe.id,...pe.data()}))),K=>console.error(K));return()=>H()},[x]);function fe(D,H={}){const K=yt=>{var lt;return((lt=yt==null?void 0:yt.toDate)==null?void 0:lt.call(yt))||(typeof yt=="string"?new Date(yt):yt||null)},pe=K(H.fechaApertura),Te=K(H.fechaCierre),ht=Number(H.baseInicial||0),at=Number(H.baseActual!==void 0?H.baseActual:ht),ft=Number(H.saldoInicial||0),bt=Number(H.saldoActual!==void 0?H.saldoActual:ft),ze=[];return bt<0&&ze.push("Saldo negativo"),at<0&&ze.push("Base negativa"),{id:D,estado:H.estado||"abierta",usuarioId:H.usuarioId||"",usuarioNombre:H.usuarioNombre||"Usuario",nombre:H.nombre||H.usuarioNombre||"Caja",fechaApertura:pe,fechaCierre:Te,baseInicial:ht,baseActual:at,saldoInicial:ft,saldoActual:bt,ia:ze}}const De=async D=>{var H;if((H=D==null?void 0:D.preventDefault)==null||H.call(D),!t){i("Debes iniciar sesin para abrir una caja.");return}f(!0);try{const K=Number(h||0);await wn(be(ae,"cajas"),{estado:"abierta",usuarioId:t.uid,usuarioNombre:t.displayName||t.email||"Usuario",fechaApertura:er(),baseInicial:K,baseActual:K,saldoInicial:0,saldoActual:0,dia:Wo()}),m(""),r("mio"),i("")}catch(K){console.error(K),i("No se pudo abrir la caja.")}finally{f(!1)}},Fe=async D=>{try{await zn(Ge(ae,"cajas",D),{estado:"cerrada",fechaCierre:er()}),r("cerradas")}catch(H){console.error(H),i("No se pudo cerrar la caja.")}},tt=async D=>{var K;if((K=D==null?void 0:D.preventDefault)==null||K.call(D),!(V!=null&&V.id)){i("Debes abrir tu caja para registrar movimientos.");return}const H=Number(re||0);if(!(!H||H<=0)){Ne(!0);try{await wn(be(ae,"movimientos"),{cashId:V.id,tipo:Pe,concepto:Et||(Pe==="ingreso"?"Ingreso":"Egreso"),valor:H,fecha:er(),dia:Wo(),usuarioId:(t==null?void 0:t.uid)||null});const pe=Pe==="ingreso"?H:-H;await zn(Ge(ae,"cajas",V.id),{saldoActual:rb(pe)}),$(""),de("")}catch(pe){console.error(pe),i("No se pudo registrar el movimiento.")}finally{Ne(!1)}}},Q=async D=>{var K;if((K=D==null?void 0:D.preventDefault)==null||K.call(D),!(V!=null&&V.id))return i("Abre tu caja para cobrar.");const H=Number(We||0);if(!(!H||H<=0)){if(!k)return i("Selecciona un paciente.");ye(!0);try{const pe=await wn(be(ae,"payments"),{cashId:V.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:H,medio:Lt,estado:"aprobado",fecha:er(),dia:Wo()});await zn(Ge(ae,"cajas",V.id),{saldoActual:rb(H)}),Dt(""),te("efectivo"),i(`Pago registrado (${pe.id}).`)}catch(pe){console.error(pe),i("No se pudo registrar el pago.")}finally{ye(!1)}}},oe=async D=>{var K;if((K=D==null?void 0:D.preventDefault)==null||K.call(D),!(V!=null&&V.id))return i("Abre tu caja para cobrar.");const H=Number(We||0);if(!(!H||H<=0)){if(!k)return i("Selecciona un paciente.");ye(!0);try{const Te=`https://pay.odontocloud/mock/${kU()}`,ht=await wn(be(ae,"payments"),{cashId:V.id,patientId:k.id,patientName:k.nombre||k.name||"Paciente",invoiceId:null,valor:H,medio:"link",estado:"pending",linkUrl:Te,fecha:er(),dia:Wo()});i(`Link de pago generado: ${Te}`),Dt("")}catch(pe){console.error(pe),i("No se pudo generar link de pago.")}finally{ye(!1)}}},z=D=>(D||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),ie=I.useMemo(()=>{const D=z(o);return D?v.filter(H=>[H.nombre,H.usuarioNombre,Ur(H.saldoActual),Ur(H.baseActual)].map(z).some(K=>K.includes(D))):v},[o,v]),le=()=>a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:a.jsx("h3",{children:"Abrir caja"})}),a.jsxs("form",{className:"oc-form",onSubmit:De,style:{display:"flex",gap:12,alignItems:"end",flexWrap:"wrap"},children:[a.jsxs("label",{style:{display:"inline-flex",flexDirection:"column",gap:6},children:[a.jsx("span",{children:"Base inicial (COP)"}),a.jsx("input",{type:"number",className:"oc-input",min:"0",step:"1000",value:h,onChange:D=>m(D.target.value),placeholder:"0"})]}),a.jsx("button",{className:"oc-btn",type:"submit",disabled:d,children:d?"Abriendo...":"Abrir caja"})]}),a.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Se asociar a tu usuario y quedar visible en ",a.jsx("b",{children:"Mi caja (hoy)"}),"."]})]}),_e=()=>a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"card",style:{marginBottom:10},children:a.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("h3",{style:{margin:0},children:"Cajas Abiertas"}),a.jsx("span",{className:"oc-tag",children:ie.length}),s&&a.jsx("span",{className:"oc-tag oc-tag-danger",children:s})]}),a.jsx("input",{ref:c,className:"oc-input",style:{maxWidth:280},placeholder:"Buscar...",value:o,onChange:D=>l(D.target.value)})]})}),a.jsx("div",{className:"card",children:a.jsx("div",{className:"oc-table-wrap",children:a.jsxs("table",{className:"oc-table",children:[a.jsx("thead",{className:"oc-thead",children:a.jsxs("tr",{className:"oc-tr",children:[a.jsx(Yt,{children:"Caja"}),a.jsx(Yt,{children:"Fecha apertura"}),a.jsx(Yt,{align:"right",children:"Base actual"}),a.jsx(Yt,{align:"right",children:"Saldo inicial"}),a.jsx(Yt,{align:"right",children:"Saldo actual"}),a.jsx(Yt,{children:"Usuario"}),a.jsx(Yt,{children:"Acciones"})]})}),a.jsx("tbody",{className:"oc-tbody",children:A?a.jsx(Db,{cols:7}):ie.length===0?a.jsx("tr",{className:"oc-tr",children:a.jsx("td",{className:"oc-td",colSpan:7,children:a.jsx("span",{className:"oc-muted",children:"Sin cajas abiertas."})})}):ie.map(D=>{var H;return a.jsxs("tr",{className:"oc-tr",children:[a.jsxs("td",{className:"oc-td",children:[a.jsx("b",{children:D.nombre})," ",(H=D.ia)!=null&&H.length?a.jsx("span",{className:"oc-tag oc-tag-danger",title:D.ia.join("  "),children:"IA"}):null]}),a.jsx("td",{className:"oc-td",children:D.fechaApertura?D.fechaApertura.toLocaleString("es-CO"):""}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(D.baseActual)]}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(D.saldoInicial)]}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right",color:D.saldoActual<0?"#b91c1c":void 0,fontWeight:600},children:["$",Ur(D.saldoActual)]}),a.jsx("td",{className:"oc-td",children:D.usuarioNombre}),a.jsxs("td",{className:"oc-td",style:{whiteSpace:"nowrap"},children:[a.jsx("button",{className:"oc-small-btn",onClick:()=>r("mio"),children:"Ver"})," ",a.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Fe(D.id),children:"Cerrar"})]})]},D.id)})})]})})})]}),xe=()=>a.jsxs("div",{className:"card",children:[a.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("h3",{children:"Mi caja (hoy)"}),(V==null?void 0:V.estado)==="abierta"&&a.jsxs("div",{style:{display:"flex",gap:8},children:[a.jsx("span",{className:"oc-tag oc-tag-success",children:"Abierta"}),a.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Fe(V.id),children:"Cerrar caja"})]})]}),b?a.jsx("div",{className:"oc-muted",children:"Cargando"}):V?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"oc-stats-row",style:{marginBottom:12},children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:"Base actual"}),a.jsxs("span",{className:"stat-value",children:["$",Ur(V.baseActual)]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:"Saldo actual"}),a.jsxs("span",{className:"stat-value",style:{color:V.saldoActual<0?"#b91c1c":void 0},children:["$",Ur(V.saldoActual)]})]})]}),a.jsxs("div",{className:"card",style:{marginBottom:12},children:[a.jsx("h4",{style:{marginBottom:8},children:"Cobro rpido"}),a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:8},children:[a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsx("label",{className:"oc-muted",children:"Paciente"}),a.jsx("input",{className:"oc-input",placeholder:"Buscar nombre o documento",value:x,onChange:D=>S(D.target.value)}),x&&j.length>0&&a.jsx("div",{className:"oc-dropdown",children:j.slice(0,6).map(D=>a.jsx("button",{className:`oc-menu-item ${(k==null?void 0:k.id)===D.id?"active":""}`,onClick:()=>{Y(D),S(D.nombre||D.name||D.doc||"")},type:"button",children:(D.nombre||D.name||"Paciente")+(D.doc?`  ${D.doc}`:"")},D.id))})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsx("label",{className:"oc-muted",children:"Monto (COP)"}),a.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:We,onChange:D=>Dt(D.target.value)})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[a.jsx("label",{className:"oc-muted",children:"Medio"}),a.jsxs("select",{className:"oc-input",value:Lt,onChange:D=>te(D.target.value),children:[a.jsx("option",{value:"efectivo",children:"Efectivo"}),a.jsx("option",{value:"tarjeta",children:"Tarjeta"}),a.jsx("option",{value:"transferencia",children:"Transferencia"}),a.jsx("option",{value:"link",children:"Link (en lnea)"})]})]}),a.jsx("div",{style:{display:"flex",alignItems:"end",gap:6},children:Lt==="link"?a.jsx("button",{className:"oc-btn",onClick:oe,disabled:ue,children:ue?"Creando":"Generar link"}):a.jsx("button",{className:"oc-btn",onClick:Q,disabled:ue,children:ue?"Guardando":"Registrar pago"})})]}),a.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Para link, el saldo se actualiza cuando el pago pase a ",a.jsx("b",{children:"aprobado"})," (webhook)."]})]}),a.jsxs("div",{className:"card",style:{marginBottom:12},children:[a.jsx("h4",{style:{marginBottom:8},children:"Movimiento manual"}),a.jsxs("form",{onSubmit:tt,style:{display:"grid",gridTemplateColumns:"120px 1fr 180px auto",gap:8},children:[a.jsxs("select",{className:"oc-input",value:Pe,onChange:D=>Qe(D.target.value),children:[a.jsx("option",{value:"ingreso",children:"Ingreso"}),a.jsx("option",{value:"egreso",children:"Egreso"})]}),a.jsx("input",{className:"oc-input",placeholder:"Concepto (ej. Caja chica, Arriendo, etc.)",value:Et,onChange:D=>$(D.target.value)}),a.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:re,onChange:D=>de(D.target.value)}),a.jsx("button",{className:"oc-btn",disabled:Ce,children:Ce?"Guardando":"Agregar"})]})]}),a.jsxs("div",{className:"card",children:[a.jsx("h4",{style:{marginBottom:8},children:"Movimientos y pagos (hoy)"}),a.jsx("div",{className:"oc-table-wrap",style:{marginBottom:12},children:a.jsxs("table",{className:"oc-table",children:[a.jsx("thead",{className:"oc-thead",children:a.jsxs("tr",{className:"oc-tr",children:[a.jsx(Yt,{children:"Tipo"}),a.jsx(Yt,{children:"Concepto / Paciente"}),a.jsx(Yt,{children:"Medio"}),a.jsx(Yt,{children:"Estado"}),a.jsx(Yt,{align:"right",children:"Valor"}),a.jsx(Yt,{children:"Hora"})]})}),a.jsx("tbody",{className:"oc-tbody",children:je.length===0&&ot.length===0?a.jsx("tr",{className:"oc-tr",children:a.jsx("td",{className:"oc-td",colSpan:6,children:a.jsx("span",{className:"oc-muted",children:"Sin movimientos ni pagos an."})})}):a.jsxs(a.Fragment,{children:[ot.map(D=>{var H,K;return a.jsxs("tr",{className:"oc-tr",children:[a.jsx("td",{className:"oc-td",children:"Pago"}),a.jsxs("td",{className:"oc-td",children:[D.patientName||"Paciente"," ",D.linkUrl?a.jsx("a",{href:D.linkUrl,target:"_blank",rel:"noreferrer",children:"(link)"}):null]}),a.jsx("td",{className:"oc-td",children:D.medio}),a.jsx("td",{className:"oc-td",children:a.jsx("span",{className:`oc-tag ${D.estado==="aprobado"?"oc-tag-success":D.estado==="pending"?"oc-tag-warning":"oc-tag-danger"}`,children:D.estado})}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(D.valor)]}),a.jsx("td",{className:"oc-td",children:(K=(H=D.fecha)==null?void 0:H.toDate)!=null&&K.call(H)?D.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`pay-${D.id}`)}),je.map(D=>{var H,K;return a.jsxs("tr",{className:"oc-tr",children:[a.jsx("td",{className:"oc-td",children:D.tipo}),a.jsx("td",{className:"oc-td",children:D.concepto}),a.jsx("td",{className:"oc-td",children:""}),a.jsx("td",{className:"oc-td",children:a.jsx("span",{className:"oc-tag",children:(D.tipo==="ingreso","ok")})}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(D.valor)]}),a.jsx("td",{className:"oc-td",children:(K=(H=D.fecha)==null?void 0:H.toDate)!=null&&K.call(H)?D.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`mov-${D.id}`)})]})})]})}),a.jsx("p",{className:"oc-muted",children:"Sugerencia: crea ndice compuesto para `movimientos(cashId, dia, fecha)` y `payments(cashId, dia, fecha)` para rendimiento."})]})]}):a.jsxs("div",{className:"oc-empty",children:[a.jsx("p",{className:"oc-muted",children:"No tienes una caja abierta hoy."}),a.jsx("button",{className:"oc-btn",onClick:()=>r("abrir"),children:"Abrir caja"})]})]}),Me=()=>a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:a.jsxs("h3",{children:["Cajas cerradas ",a.jsx("span",{className:"oc-tag",children:y.length})]})}),a.jsx("div",{className:"oc-table-wrap",children:a.jsxs("table",{className:"oc-table",children:[a.jsx("thead",{className:"oc-thead",children:a.jsxs("tr",{className:"oc-tr",children:[a.jsx(Yt,{children:"Caja"}),a.jsx(Yt,{children:"Usuario"}),a.jsx(Yt,{children:"Apertura"}),a.jsx(Yt,{children:"Cierre"}),a.jsx(Yt,{align:"right",children:"Saldo final"})]})}),a.jsx("tbody",{className:"oc-tbody",children:w?a.jsx(Db,{cols:5}):y.length===0?a.jsx("tr",{className:"oc-tr",children:a.jsx("td",{className:"oc-td",colSpan:5,children:a.jsx("span",{className:"oc-muted",children:"Sin cajas cerradas."})})}):y.map(D=>a.jsxs("tr",{className:"oc-tr",children:[a.jsx("td",{className:"oc-td",children:D.nombre}),a.jsx("td",{className:"oc-td",children:D.usuarioNombre}),a.jsx("td",{className:"oc-td",children:D.fechaApertura?D.fechaApertura.toLocaleString("es-CO"):""}),a.jsx("td",{className:"oc-td",children:D.fechaCierre?D.fechaCierre.toLocaleString("es-CO"):""}),a.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Ur(D.saldoActual)]})]},D.id))})]})})]}),Ae=()=>a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Cierres simulados"}),a.jsx("p",{className:"oc-muted",children:"El cierre hipottico compara ventas y movimientos detectando errores y descuadres con IA. (Conectar fuente de datos para activarlo)."})]}),Le=()=>a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Bancos"}),a.jsx("p",{className:"oc-muted",children:"Conciliacin de consignaciones/pagos electrnicos contra caja del da. (Conectar pasarela o extractos para habilitar)."})]}),O=({m:D})=>a.jsxs("button",{type:"button",onClick:()=>r(D.key),className:`oc-menu-item ${n===D.key?"active":""}`,style:{width:"100%",textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid transparent",background:n===D.key?"var(--oc-surface-2, #f3f6ff)":"transparent",fontWeight:600},title:D.label,children:[a.jsx("span",{style:{opacity:.8,marginRight:6},children:D.icon}),D.label]});return a.jsxs("div",{className:"oc-main-content",style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:16},children:[a.jsx("aside",{className:"card",role:"navigation","aria-label":"Men de caja",style:{height:"fit-content",padding:12},children:a.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:e.map(D=>a.jsx(O,{m:D},D.key))})}),a.jsxs("section",{children:[a.jsx("div",{className:"card",style:{marginBottom:12,padding:12},children:a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[a.jsxs("div",{className:"oc-breadcrumb",children:[a.jsx("span",{children:"Caja"}),a.jsx("span",{children:""}),a.jsx("b",{children:(G=e.find(D=>D.key===n))==null?void 0:G.label})]}),n==="abiertas"&&a.jsx("input",{ref:c,className:"oc-input",placeholder:"Buscar...",value:o,onChange:D=>l(D.target.value),style:{maxWidth:300}})]})}),n==="abrir"&&a.jsx(le,{}),n==="abiertas"&&a.jsx(_e,{}),n==="cerradas"&&a.jsx(Me,{}),n==="mio"&&a.jsx(xe,{}),n==="simulados"&&a.jsx(Ae,{}),n==="bancos"&&a.jsx(Le,{})]})]})}function Db({cols:t=6,n:e=3}){return a.jsx(a.Fragment,{children:Array.from({length:e}).map((n,r)=>a.jsx("tr",{className:"oc-tr",children:Array.from({length:t}).map((s,i)=>a.jsx("td",{className:"oc-td",children:a.jsx("div",{style:{height:12,width:i===0?160:100+i%3*40,background:"var(--oc-skeleton, #e5e7eb)",borderRadius:6}})},i))},r))})}function DU({items:t=[]}){return a.jsxs("div",{className:"card activity-card",children:[a.jsx("h4",{children:"Actividad reciente"}),a.jsx("ul",{className:"activity-list",children:t.map(e=>a.jsxs("li",{children:[a.jsx("strong",{children:e.title}),a.jsx("div",{className:"time",children:e.time})]},e.id))})]})}function OU({status:t}){return t?a.jsxs("div",{className:"card",children:[a.jsx("h4",{children:"Automatizaciones (N8N)"}),a.jsxs("div",{className:"n8n-line",children:[a.jsx("strong",{children:"Conectado:"})," ",t.connected?"S":"No"]}),a.jsxs("div",{className:"n8n-line",children:[a.jsx("strong",{children:"Flujos activos:"})," ",t.flowsRunning]}),t.lastError&&a.jsxs("div",{className:"n8n-error",children:["Error: ",t.lastError]})]}):null}const Xp={es:{nav_home:"Inicio",nav_agenda:"Agenda",nav_patients:"Pacientes",nav_billing:"Facturacin",nav_inventory:"Inventario",nav_odontogram:"Odontograma",nav_reports:"Reportes",nav_cash:"Caja",nav_admin:"Administracin",welcomeTitle:"Bienvenido a OdontoCloud",welcomeSubtitle:"Administra tus pacientes, agenda, inventario y facturacin de manera inteligente y moderna.",clinicLabel:"Clnica",userLabel:"Usuario",roleLabel:"Rol",searchPlaceholder:"Buscar acciones o ir a",stats_patientsToday:"Pacientes totales",stats_appointmentsToday:"Citas hoy",stats_revenueToday:"Facturacin hoy",stats_waiting:"En espera",stats_currency:"COP",n8n_title:"Automatizaciones (n8n)",recent_title:"Actividad reciente",recent_empty:"Sin actividad registrada.",loading:"Cargando...",logout:"Cerrar sesin",module_coming:"Mdulo prximamente.",todays_appts:"Citas de hoy",see_schedule:"Ir a Agenda",no_appts_today:"No hay citas programadas hoy.",at:"a las"},en:{nav_home:"Overview",nav_agenda:"Schedule",nav_patients:"Patients",nav_billing:"Billing",nav_inventory:"Inventory",nav_odontogram:"Odontogram",nav_reports:"Reports",nav_cash:"Cash",nav_admin:"Administration",welcomeTitle:"Welcome to OdontoCloud",welcomeSubtitle:"Manage your patients, schedule, inventory and billing in a smart and modern way.",clinicLabel:"Clinic",userLabel:"User",roleLabel:"Role",searchPlaceholder:"Search actions or go to",stats_patientsToday:"Total patients",stats_appointmentsToday:"Appointments today",stats_revenueToday:"Revenue today",stats_waiting:"In waiting room",stats_currency:"COP",n8n_title:"Automations (n8n)",recent_title:"Recent activity",recent_empty:"No activity yet.",loading:"Loading...",logout:"Log out",module_coming:"Module coming soon.",todays_appts:"Today's appointments",see_schedule:"Open Schedule",no_appts_today:"No appointments today.",at:"at"}},d1=()=>typeof navigator>"u"||(navigator.language||navigator.userLanguage||"es").toLowerCase().startsWith("es")?"es":"en",LU=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},VU=()=>I.useMemo(()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0);return{startToday:He.fromDate(e),endToday:He.fromDate(n),startTodayJS:e}},[]),MU=t=>`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,FU=(t,e)=>t.toLocaleTimeString(e==="es"?"es-CO":"en-US",{hour:"2-digit",minute:"2-digit"}),UU=(t,e)=>{try{const[n,r,s]=(t||"").split("-").map(l=>parseInt(l,10)),[i=0,o=0]=(e||"00:00").split(":").map(l=>parseInt(l,10));return new Date(n,(r||1)-1,s||1,i,o,0,0)}catch{return new Date}};function $U({data:t=[]}){const s=Math.max(1,...t.map(d=>Number(d.value)||0)),i=t.length||7,o=10,l=Math.max(16,Math.min(44,(640-o*(i+1))/i)),c=(l+o)*i+o;return a.jsx("div",{style:{width:"100%",overflowX:"auto"},children:a.jsxs("svg",{width:c,height:240,role:"img","aria-label":"Pacientes registrados por da en la ltima semana",children:[[.25,.5,.75,1].map((d,f)=>{const h=18+(1-d)*182;return a.jsx("line",{x1:0,x2:c,y1:h,y2:h,stroke:"#e5e7eb",strokeDasharray:"4 4"},f)}),t.map((d,f)=>{const h=Number(d.value)||0,m=Math.round(h/s*182),v=o+f*(l+o),P=200-m;return a.jsxs("g",{children:[a.jsx("rect",{x:v,y:P,width:l,height:m,rx:"6",ry:"6",fill:h>0?"#0ea5e9":"#cbd5e1",children:a.jsx("title",{children:`${d.label||d.shortLabel||""}  ${h} paciente${h!==1?"s":""}`})}),h>0&&m>14&&a.jsx("text",{x:v+l/2,y:P-6,textAnchor:"middle",fontSize:"11",fill:"#0f172a",children:h}),a.jsx("text",{x:v+l/2,y:214,textAnchor:"middle",fontSize:"11",fill:"#64748b",children:d.shortLabel||""})]},f)})]})})}function BU({onNavigate:t,onAction:e,placeholder:n}){const[r,s]=I.useState(""),[i,o]=I.useState(!1),[l,c]=I.useState(0),d=I.useRef(null),f=I.useMemo(()=>[{group:"Navegacin",label:"Ir a Inicio",keywords:"inicio home overview",run:()=>t==null?void 0:t("Inicio")},{group:"Navegacin",label:"Ir a Agenda",keywords:"agenda calendario schedule",run:()=>t==null?void 0:t("Agenda")},{group:"Navegacin",label:"Ir a Pacientes",keywords:"pacientes",run:()=>t==null?void 0:t("Pacientes")},{group:"Navegacin",label:"Ir a Facturacin",keywords:"facturacion facturas billing",run:()=>t==null?void 0:t("Facturacin")},{group:"Navegacin",label:"Ir a Inventario",keywords:"inventario stock",run:()=>t==null?void 0:t("Inventario")},{group:"Navegacin",label:"Ir a Odontograma",keywords:"odontograma",run:()=>t==null?void 0:t("Odontograma")},{group:"Navegacin",label:"Ir a Reportes",keywords:"reportes informes",run:()=>t==null?void 0:t("Reportes")},{group:"Acciones",label:"Nueva cita",keywords:"nueva cita agendar",run:()=>e==null?void 0:e("new_appointment")},{group:"Acciones",label:"Nuevo paciente",keywords:"nuevo paciente alta",run:()=>e==null?void 0:e("new_patient")},{group:"Acciones",label:"Nueva factura",keywords:"nueva factura",run:()=>e==null?void 0:e("new_invoice")},{group:"Acciones",label:"Exportar agenda",keywords:"exportar agenda",run:()=>e==null?void 0:e("export_agenda")},{group:"Acciones",label:"Ir a hoy (Agenda)",keywords:"hoy today",run:()=>e==null?void 0:e("agenda_today")},{group:"Acciones",label:"Cambiar modo oscuro",keywords:"oscuro dark mode",run:()=>e==null?void 0:e("toggle_dark")},{group:"Acciones",label:"Cerrar sesin",keywords:"logout salir cerrar",run:()=>e==null?void 0:e("logout")},{group:"Ayuda",label:"Ver atajos de teclado",keywords:"atajos ayuda",run:()=>e==null?void 0:e("show_shortcuts")},{group:"Ayuda",label:"Soporte / Contacto",keywords:"soporte ayuda contacto",run:()=>e==null?void 0:e("support")}],[t,e]),h=I.useMemo(()=>{const A=r.toLowerCase().trim();return A?f.filter(C=>C.label.toLowerCase().includes(A)||C.keywords.includes(A)):[]},[r,f]);I.useEffect(()=>{const A=C=>{d.current&&(d.current.contains(C.target)||o(!1))};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]);const m=A=>{var C;(C=A.run)==null||C.call(A),s(""),o(!1)},v=A=>{!i||h.length===0||(A.key==="ArrowDown"&&(A.preventDefault(),c(C=>(C+1)%h.length)),A.key==="ArrowUp"&&(A.preventDefault(),c(C=>(C-1+h.length)%h.length)),A.key==="Enter"&&(A.preventDefault(),h[l]&&m(h[l])),A.key==="Escape"&&o(!1))},P=I.useMemo(()=>{const A=new Map;return h.forEach(C=>{A.has(C.group)||A.set(C.group,[]),A.get(C.group).push(C)}),Array.from(A.entries())},[h]);return a.jsxs("div",{className:"oc-search-wrap",ref:d,children:[a.jsx("input",{className:"oc-search",type:"search",inputMode:"search",placeholder:n,"aria-label":n,value:r,onChange:A=>{s(A.target.value),o(!!A.target.value),c(0)},onFocus:()=>o(!!r),onKeyDown:v}),i&&a.jsx("div",{className:"oc-search-dropdown",role:"listbox","aria-label":"Resultados de comandos",children:P.length===0?a.jsx("div",{className:"oc-search-item empty",children:"Escribe para ver opciones"}):P.map(([A,C])=>a.jsxs("div",{children:[a.jsx("div",{className:"oc-search-group",children:A}),C.map(y=>{const _=h.indexOf(y);return a.jsx("button",{className:`oc-search-item ${_===l?"active":""}`,onMouseEnter:()=>c(_),onClick:()=>m(y),role:"option",children:a.jsx("span",{className:"oc-search-title",children:y.label})},y.label)})]},A))})]})}function zU({open:t,anchorRect:e,onClose:n,onSoon:r,onNavigatePath:s,onSetFactView:i,dark:o}){const[l,c]=I.useState(null),d=I.useRef(null);if(I.useEffect(()=>{if(!t)return;const Y=Dt=>Dt.key==="Escape"&&(n==null?void 0:n()),We=()=>n==null?void 0:n();return window.addEventListener("keydown",Y),window.addEventListener("scroll",We,!0),()=>{window.removeEventListener("keydown",Y),window.removeEventListener("scroll",We,!0)}},[t,n]),!t)return null;const f=((e==null?void 0:e.bottom)||60)+8,h=Math.max(12,Math.min(((e==null?void 0:e.left)||300)-160,window.innerWidth-920)),m=10,v=h+360+m,P=o?"#0b1220":"#ffffff",A=o?"#e5e7eb":"#0f172a",C=o?"#0f1a32":"#f3f6ff",y=o?"#1f2a44":"#e2e8f0",_=o?"#b6c1d1":"#475569",w={position:"fixed",top:f,left:h,width:880,maxWidth:"calc(100vw - 24px)",background:P,color:A,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${y}`,zIndex:400,padding:12},T={position:"fixed",top:f,left:v,width:420,maxWidth:"calc(100vw - 24px)",background:P,color:A,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${y}`,zIndex:410,padding:12},V={display:"flex",flexDirection:"column",gap:6,padding:"8px 10px"},U={height:38,borderRadius:10,padding:"0 12px",display:"flex",alignItems:"center",gap:8,fontSize:".92rem",cursor:"pointer",border:"1px solid transparent",background:"transparent",color:A,fontWeight:500,textAlign:"left"},b=(Y,We=!0)=>Object.assign(Y.currentTarget.style,We?{background:C,borderColor:y}:{background:"transparent",borderColor:"transparent"}),E=()=>{d.current&&clearTimeout(d.current)},x=()=>{E(),d.current=setTimeout(()=>n==null?void 0:n(),180)},S={position:"fixed",top:f,left:h+360,width:m,height:520,zIndex:405},j=[{label:"Recibo de caja",key:"recibo",path:"facturacion/recibo"},{label:"Saldo a favor",key:"saldo",path:"facturacion/saldo"},{label:"Nota crdito",key:"nc",path:"facturacion/nc"},{label:"Nota dbito",key:"nd",path:"facturacion/nd"},{label:"Liquidaciones",key:"liq",path:"facturacion/liq"},{label:"Traslados",key:"tras",path:"facturacion/tras"},{label:"Pagos",key:"pagos",path:"facturacion/pagos"},{label:"rdenes de compra",key:"oc",path:"facturacion/oc"},{label:"Factura de venta",key:"fv",path:"facturacion/facturas"},{label:"Facturas de compra",key:"fc",path:"facturacion/fc"}],L=[{label:"RIPS anteriores (RS-3374)",key:"rips3374"},{label:"RIPS nuevo (RS-2275)",key:"rips2275"}],k=Y=>{i==null||i(Y.key),s==null||s(Y.path),n==null||n()};return a.jsxs(a.Fragment,{children:[a.jsx("div",{onClick:n,style:{position:"fixed",inset:0,background:"transparent",zIndex:399}}),a.jsx("div",{style:w,onMouseEnter:E,onMouseLeave:x,children:a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"360px 1fr",gap:8,alignItems:"start"},children:[a.jsxs("div",{style:V,children:[a.jsx("button",{type:"button",style:U,onMouseEnter:()=>{E(),c("facturacion")},onFocus:()=>{E(),c("facturacion")},onClick:()=>c(Y=>Y==="facturacion"?null:"facturacion"),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Facturacin "}),a.jsx("button",{type:"button",style:U,onMouseEnter:()=>{E(),c("rips")},onFocus:()=>{E(),c("rips")},onClick:()=>c(Y=>Y==="rips"?null:"rips"),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" RIPS "}),a.jsx("button",{type:"button",style:U,onClick:()=>s==null?void 0:s("agenda"),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Gestin de agenda"}),a.jsx("button",{type:"button",style:U,onClick:()=>s==null?void 0:s("inventario"),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Inventario"}),a.jsx("button",{type:"button",style:U,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Convenios"}),a.jsx("button",{type:"button",style:U,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Terceros"}),a.jsx("button",{type:"button",style:U,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Campaas"}),a.jsx("button",{type:"button",style:U,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Temperatura y humedad"}),a.jsx("button",{type:"button",style:U,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Residuos"}),a.jsx("button",{type:"button",style:U,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Medicamentos y planes"}),a.jsx("button",{type:"button",style:U,onClick:()=>r==null?void 0:r(),onMouseOver:Y=>b(Y,!0),onMouseOut:Y=>b(Y,!1),children:" Esterilizacin"})]}),a.jsx("div",{style:V,children:a.jsxs("div",{style:{fontSize:".85rem",color:_},children:["Accesos rpidos a mdulos de administracin. Pasa el mouse por ",a.jsx("b",{children:"Facturacin"})," o ",a.jsx("b",{children:"RIPS"})," para ver sus acciones."]})})]})}),a.jsx("div",{style:S,onMouseEnter:E,onMouseLeave:x}),l&&a.jsx("div",{style:T,onMouseEnter:E,onMouseLeave:x,children:a.jsx("div",{style:{...V,display:"grid",gridTemplateColumns:"1fr"},children:(l==="facturacion"?j:L).map(Y=>a.jsx("button",{type:"button",style:U,onClick:()=>l==="facturacion"?k(Y):r==null?void 0:r(),onMouseOver:We=>b(We,!0),onMouseOut:We=>b(We,!1),children:Y.label},Y.label))})})]})}function qU({t,companyName:e,userName:n,role:r,darkMode:s,weeklySeries:i,weekRangeLabel:o,todaysAppointments:l,todaysLoading:c,metrics:d,metricsLoading:f,n8nState:h,n8nLoading:m,recent:v,recentLoading:P,onGoAgenda:A}){return a.jsxs("div",{className:"oc-main-content",children:[a.jsxs("section",{className:"oc-hero","aria-label":"Resumen general",children:[a.jsxs("div",{className:"oc-hero-text",children:[a.jsx("h1",{children:t("welcomeTitle")}),a.jsx("p",{children:t("welcomeSubtitle")}),a.jsxs("p",{className:"oc-hero-meta",children:[t("clinicLabel"),": ",e,"  ",t("userLabel"),": ",n,"  ",t("roleLabel"),": ",r||""]})]}),a.jsxs("div",{className:"oc-hero-badge","aria-live":"polite",children:[a.jsx("span",{className:"oc-hero-badge-title",children:t("stats_appointmentsToday")}),a.jsx("span",{className:"oc-hero-badge-value",children:f&&c?"":d.citasHoy}),a.jsxs("span",{className:"oc-hero-badge-sub",children:[t("stats_patientsToday"),": ",f?"":d.pacientesHoy]})]})]}),a.jsxs("section",{className:"oc-stats-row","aria-label":"Indicadores del da",children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:t("stats_patientsToday")}),a.jsx("span",{className:"stat-value",children:d.pacientesHoy})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:t("stats_appointmentsToday")}),a.jsx("span",{className:"stat-value",children:d.citasHoy})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:t("stats_revenueToday")}),a.jsxs("span",{className:"stat-value",children:[d.facturacionHoy.toLocaleString("es-CO")," ",a.jsx("span",{className:"stat-currency",children:t("stats_currency")})]})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-label",children:t("stats_waiting")}),a.jsx("span",{className:"stat-value",children:d.enEspera})]})]}),a.jsxs("section",{className:"oc-grid","aria-label":"Contenido principal del dashboard",children:[a.jsx("div",{className:"oc-grid-main",children:a.jsxs("div",{className:"card card-quickcharts",children:[a.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[a.jsx("h3",{children:"Pacientes registrados  ltimos 7 das"}),a.jsx("span",{className:"oc-muted",style:{marginLeft:8,fontSize:12},children:o})]}),i.length===0||i.every(C=>((C==null?void 0:C.value)||0)===0)?a.jsx("p",{className:"oc-weekly-empty",children:"Sin pacientes registrados en la ltima semana."}):a.jsx($U,{data:i})]})}),a.jsxs("aside",{className:"oc-grid-side","aria-label":"Panel lateral",children:[a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:t("n8n_title")}),m?a.jsx("span",{className:"oc-muted",children:t("loading")}):a.jsx(OU,{status:h})]}),a.jsxs("div",{className:"card",children:[a.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[a.jsx("h3",{children:t("todays_appts")}),a.jsx("button",{className:"oc-small-link",type:"button",onClick:A,children:t("see_schedule")})]}),c?a.jsx("span",{className:"oc-muted",children:t("loading")}):l.length===0?a.jsx("p",{className:"oc-muted",children:t("no_appts_today")}):a.jsx("ul",{className:"oc-list",children:l.slice(0,5).map(C=>a.jsxs("li",{className:"oc-list-item",children:[a.jsxs("div",{className:"oc-list-main",children:[a.jsx("b",{children:C.pacienteNombre||"Paciente"})," ",a.jsxs("span",{className:"oc-muted",children:[t("at")," ",FU(C.fecha,d1())]})]}),a.jsx("div",{className:`oc-tag oc-tag-${(C.estado||"programada").toLowerCase().replace(/\s+/g,"-")}`,children:C.estado||"programada"})]},C.id))})]}),a.jsxs("div",{className:"card",children:[a.jsx("h3",{children:"Actividad reciente"}),P?a.jsx("span",{className:"oc-muted",children:t("loading")}):v.length===0?a.jsx("p",{className:"oc-muted",children:t("recent_empty")}):a.jsx(DU,{items:v})]})]})]}),a.jsxs("footer",{className:"oc-footer",children:[" ",new Date().getFullYear()," OdontoCloud | Creado por Ingeniero Juan Madrid"]})]})}function Jp(){const t=kr(),e=gn(),[n]=I.useState(d1()),r=Q=>Xp[n][Q]||Q,[s,i]=I.useState("Inicio"),[o,l]=I.useState("recibo"),[c,d]=I.useState(()=>{try{return localStorage.getItem("odontocloud:dark")==="1"}catch{return!1}});I.useEffect(()=>{try{localStorage.setItem("odontocloud:dark",c?"1":"0")}catch{}document.documentElement.classList.toggle("dark",c)},[c]);const[f]=I.useState(()=>LU()),[h]=I.useState((f==null?void 0:f.rol)||""),[m]=I.useState((f==null?void 0:f.email)||""),[v,P]=I.useState("OdontoCloud"),[A,C]=I.useState(m||"Usuario"),[y,_]=I.useState(!0);I.useEffect(()=>{const Q=zy(kh,async oe=>{try{if(!oe){C(m||"Usuario"),P("OdontoCloud"),_(!1);return}C(oe.displayName||oe.email||m||"Usuario");const z=Ge(ae,"empresas",oe.uid),ie=await qc(z);P(ie.exists()&&ie.data().nombre||"OdontoCloud")}catch(z){console.error("Error cargando empresa/usuario:",z)}finally{_(!1)}});return()=>Q()},[m]);const[w,T]=I.useState({pacientesHoy:0,citasHoy:0,facturacionHoy:0,enEspera:0}),[V,U]=I.useState(!0),[b,E]=I.useState([]),[x,S]=I.useState([]),[j,L]=I.useState(!0),{startToday:k,endToday:Y,startTodayJS:We}=VU(),Dt=I.useMemo(()=>MU(We),[We]),Lt=I.useMemo(()=>{const Q=new Date,oe=new Date(Q.getFullYear(),Q.getMonth(),Q.getDate()-6),z=Q,ie=le=>le.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit",month:"short"}).replace(".","");return`${ie(oe)}  ${ie(z)}`},[n]),te=Q=>{var _e;const oe=Q.data()||{};let z;if((_e=oe.fecha)!=null&&_e.toDate){z=oe.fecha.toDate();const xe=oe.horaInicio||oe.hora;if(xe&&typeof xe=="string"){const[Me=0,Ae=0]=xe.split(":").map(Le=>parseInt(Le,10));z.setHours(Me||0,Ae||0,0,0)}}else if(typeof oe.fecha=="string"){const xe=oe.horaInicio||oe.hora||"00:00";z=UU(oe.fecha,xe)}else z=new Date;const ie=oe.pacienteNombre||oe.paciente||"Paciente",le=oe.estado&&String(oe.estado)||"programada";return{id:Q.id,fecha:z,pacienteId:oe.pacienteId||"",pacienteNombre:ie,estado:le,motivo:oe.motivo||""}};I.useEffect(()=>{const Q=ut(be(ae,"citas"),nt("fecha",">=",k),nt("fecha","<",Y),xn("fecha","asc")),oe=ut(be(ae,"citas"),nt("fecha","==",Dt));let z=new Map,ie=!1,le=!1;const _e=()=>{const Ae=Array.from(z.values()).sort((O,G)=>O.fecha.getTime()-G.fecha.getTime()),Le=Ae.filter(O=>String(O.estado).toLowerCase().trim()==="en espera").length;S(Ae),T(O=>({...O,citasHoy:Ae.length,enEspera:Le})),ie&&le&&L(!1)},xe=Bn(Q,Ae=>{ie=!0;const Le=new Map(z);Ae.docs.forEach(O=>Le.set(O.id,te(O))),z=Le,_e()},Ae=>{console.error("Realtime citas hoy (TS):",Ae),ie=!0,_e()}),Me=Bn(oe,Ae=>{le=!0;const Le=new Map(z);Ae.docs.forEach(O=>Le.set(O.id,te(O))),z=Le,_e()},Ae=>{console.error("Realtime citas hoy (STR):",Ae),le=!0,_e()});return()=>{try{xe(),Me()}catch{}}},[k,Y,Dt]),I.useEffect(()=>{(async()=>{try{const z=(await tF(be(ae,"pacientes"))).data().count||0;let ie=0;try{const le=ut(be(ae,"facturas"),nt("fecha",">=",k),nt("fecha","<",Y));(await Je(le)).forEach(xe=>{const Me=xe.data();typeof Me.monto=="number"&&(ie+=Me.monto)})}catch{ie=0}T(le=>({...le,pacientesHoy:z,facturacionHoy:ie}))}catch(oe){console.error("Error cargando mtricas:",oe),T(z=>({...z,pacientesHoy:0,facturacionHoy:0}))}finally{U(!1)}})()},[k,Y]),I.useEffect(()=>{const Q=new Date,oe=new Date(Q.getFullYear(),Q.getMonth(),Q.getDate()-6),z=new Date(Q.getFullYear(),Q.getMonth(),Q.getDate()+1),ie=new Map;for(let xe=0;xe<7;xe++){const Me=new Date(Q.getFullYear(),Q.getMonth(),Q.getDate()-(6-xe)),Ae=Me.toISOString().slice(0,10),Le=Me.toLocaleDateString(n==="es"?"es-ES":"en-US"),O=Me.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit"}).replace(".","");ie.set(Ae,{label:Le,shortLabel:O,value:0})}const le=ut(be(ae,"pacientes"),nt("createdAt",">=",He.fromDate(oe)),nt("createdAt","<",He.fromDate(z))),_e=Bn(le,xe=>{const Me=new Map(ie);xe.docs.forEach(Ae=>{var H;const Le=Ae.data()||{},O=(H=Ae.data().createdAt)!=null&&H.toDate?Ae.data().createdAt.toDate():Le.createdAt?new Date(Le.createdAt):null;if(!O||isNaN(O))return;const G=O.toISOString().slice(0,10);if(!Me.has(G))return;const D=Me.get(G);D.value+=1,Me.set(G,D)}),E(Array.from(Me.values()))},xe=>{console.error("Error realtime serie semanal (pacientes):",xe),E(Array.from(ie.values()))});return()=>{try{_e()}catch{}}},[n]);const[ue,ye]=I.useState([]),[Pe,Qe]=I.useState(!0);I.useEffect(()=>{(async()=>{try{const oe=ut(be(ae,"actividad"),xn("fecha","desc"),ba(5)),z=await Je(oe);ye(z.docs.map(ie=>({id:ie.id,title:ie.data().descripcion||ie.data().titulo||"Actividad",time:ie.data().resumenTiempo||""})))}catch(oe){console.error("Error cargando actividad:",oe),ye([])}finally{Qe(!1)}})()},[]);const[Et,$]=I.useState(null),[re,de]=I.useState(!0);I.useEffect(()=>{(async()=>{try{const oe=Ge(ae,"integraciones","n8n"),z=await qc(oe);$(z.exists()?{connected:!!z.data().connected,flowsRunning:z.data().flowsRunning||0,lastError:z.data().lastError||null}:{connected:!1,flowsRunning:0,lastError:null})}catch(oe){console.error("Error cargando estado n8n:",oe),$({connected:!1,flowsRunning:0,lastError:"No se pudo leer el estado desde Firebase."})}finally{de(!1)}})()},[]);const Ce=async()=>{try{localStorage.removeItem("odc_session")}catch{}try{await a2(kh)}catch(Q){console.error("Error al cerrar sesin:",Q)}window.location.href="/"},[Ne,je]=I.useState(!1),[Ee,ot]=I.useState(null),ke=I.useRef(null);I.useRef(null);const fe=()=>{var oe,z;const Q=(z=(oe=ke.current)==null?void 0:oe.getBoundingClientRect)==null?void 0:z.call(oe);ot(Q),je(!0)};I.useEffect(()=>{const Q=e.pathname.toLowerCase(),oe=Q.includes("/pacientes"),z=Q.includes("/caja"),ie=Q.includes("/agenda"),le=Q.includes("/facturacion"),_e=Q.includes("/inventario"),xe=Q.includes("/odontograma"),Me=Q.includes("/reportes"),Ae=Q.includes("/config");i(oe?"Pacientes":z?"Caja":ie?"Agenda":_e?"Inventario":xe?"Odontograma":Me?"Reportes":Ae?"Config":"Inicio"),le&&(i("Facturacin"),Q.includes("/pagos")?l("pagos"):Q.includes("/facturas")?l("fv"):Q.includes("/recibo")?l("recibo"):Q.includes("/saldo")?l("saldo"):Q.includes("/nc")?l("nc"):Q.includes("/nd")?l("nd"):Q.includes("/liq")?l("liq"):Q.includes("/tras")?l("tras"):Q.includes("/oc")?l("oc"):Q.includes("/fc")?l("fc"):l("recibo"))},[e.pathname]);const De=I.useMemo(()=>{const Q=e.pathname.split("/").filter(Boolean),oe=Q.findIndex(z=>z.startsWith("dashboard_"));return oe>=0?`/${Q.slice(0,oe+1).join("/")}`:""},[e.pathname]),Fe=(Q="")=>{const oe=String(Q).replace(/^\/+|\/+$/g,""),z=oe?`${De}/${oe}`:De||"/",ie=e.pathname.toLowerCase()===z.toLowerCase();t(z,{replace:ie})},tt=()=>{switch(s){case"Agenda":return a.jsx(K6,{});case"Pacientes":return a.jsx(I.Suspense,{fallback:a.jsx("div",{style:{padding:16},children:"Cargando"}),children:a.jsx(iU,{})});case"Facturacin":return a.jsx(Q6,{view:o});case"Inventario":return a.jsx(Y6,{});case"Odontograma":return a.jsx(X6,{});case"Reportes":return a.jsx(lU,{});case"Caja":return a.jsx(jU,{});case"Config":case"Configuracin":case"Configuracion":return a.jsx(NU,{});case"Inicio":default:return null}};return a.jsxs("div",{className:`oc-shell ${c?"oc-dark":""}`,children:[a.jsx("a",{href:"#oc-main",className:"oc-skip-link",children:"Saltar al contenido"}),a.jsxs("header",{className:"oc-header",role:"banner",children:[a.jsxs("div",{className:"oc-header-left",children:[a.jsx("img",{src:$N,alt:"OdontoCloud",className:"oc-logo"}),a.jsxs("div",{className:"oc-brand-text",children:[a.jsx("span",{className:"oc-brand-main",children:"OdontoCloud"}),a.jsx("span",{className:"oc-brand-sub",children:y?"...":v})]})]}),a.jsxs("nav",{className:"oc-nav",role:"navigation","aria-label":"Navegacin principal",children:[a.jsx(Ko,{to:De,end:!0,className:({isActive:Q})=>Q&&s==="Inicio"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_home"),children:r("nav_home")}),a.jsx(Ko,{to:`${De}/agenda`,className:({isActive:Q})=>Q||s==="Agenda"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_agenda"),children:r("nav_agenda")}),a.jsx(Ko,{to:`${De}/pacientes`,className:({isActive:Q})=>Q||s==="Pacientes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_patients"),children:r("nav_patients")}),a.jsx(Ko,{to:`${De}/caja`,className:({isActive:Q})=>Q||s==="Caja"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_cash"),children:r("nav_cash")}),a.jsx("button",{type:"button",ref:ke,className:"oc-nav-btn",title:r("nav_admin"),"aria-haspopup":"true","aria-expanded":Ne,onClick:()=>Ne?je(!1):fe(),children:r("nav_admin")}),a.jsx(Ko,{to:`${De}/reportes`,className:({isActive:Q})=>Q||s==="Reportes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_reports"),children:r("nav_reports")})]}),a.jsxs("div",{className:"oc-header-right",children:[a.jsx(BU,{placeholder:r("searchPlaceholder"),onNavigate:Q=>{Q==="Inicio"?Fe(""):Q==="Facturacin"?(l("recibo"),Fe("facturacion/recibo")):Fe(Q.toLowerCase())},onAction:Q=>{switch(Q){case"new_appointment":case"agenda_today":case"export_agenda":Fe("agenda");break;case"new_patient":Fe("pacientes");break;case"new_invoice":l("fv"),Fe("facturacion/facturas");break;case"toggle_dark":d(oe=>!oe);break;case"logout":Ce();break;case"show_shortcuts":alert("Atajos: Ctrl/Cmd + K para abrir bsqueda, / para moverse, Enter para ejecutar.");break;case"support":window.open("https://tu-soporte.odc","_blank");break}}}),a.jsx(cU,{basePath:De,className:"ml-2"}),a.jsx("button",{className:"oc-icon-btn",type:"button",onClick:()=>d(Q=>!Q),"aria-pressed":c,title:c?"Activar modo claro":"Activar modo oscuro",children:c?"":""}),a.jsx("button",{className:"oc-icon-btn",type:"button",onClick:Ce,title:Xp[n].logout,children:Xp[n].logout})]})]}),a.jsx(zU,{open:Ne,anchorRect:Ee,dark:c,onClose:()=>je(!1),onSoon:()=>{alert("Prximamente"),je(!1)},onNavigatePath:Q=>{Fe(Q),je(!1)},onSetFactView:Q=>l(Q)}),a.jsxs("main",{id:"oc-main",className:"oc-main-wrapper",role:"main",children:[s!=="Inicio"&&tt(),s==="Inicio"&&a.jsx(qU,{t:r,companyName:v,userName:A,role:h,darkMode:c,weeklySeries:b,weekRangeLabel:Lt,todaysAppointments:x,todaysLoading:j,metrics:w,metricsLoading:V,n8nState:Et,n8nLoading:re,recent:ue,recentLoading:Pe,onGoAgenda:()=>Fe("agenda")})]})]})}const h1=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},f1=t=>{const e=(t||"").toLowerCase();return e==="administrador"?"/dashboard_admin":e==="doctor"?"/dashboard_doctor":e==="recepcionista"?"/dashboard_recepcion":"/"};function Zp({allowedRoles:t,children:e}){var s;const n=h1();if(!n)return a.jsx(rh,{to:"/",replace:!0});const r=(s=n.rol)==null?void 0:s.toLowerCase();return t.map(i=>i.toLowerCase()).includes(r)?e:a.jsx(rh,{to:f1(n.rol),replace:!0})}function HU(){const t=h1();return a.jsxs(GP,{children:[a.jsx(Go,{path:"/",element:t?a.jsx(rh,{to:f1(t.rol),replace:!0}):a.jsx(b4,{})}),a.jsx(Go,{path:"/dashboard_admin/*",element:a.jsx(Zp,{allowedRoles:["administrador"],children:a.jsx(Jp,{})})}),a.jsx(Go,{path:"/dashboard_doctor/*",element:a.jsx(Zp,{allowedRoles:["doctor"],children:a.jsx(Jp,{})})}),a.jsx(Go,{path:"/dashboard_recepcion/*",element:a.jsx(Zp,{allowedRoles:["recepcionista"],children:a.jsx(Jp,{})})}),a.jsx(Go,{path:"*",element:a.jsx(rh,{to:"/",replace:!0})})]})}async function WU(){try{await s2(kh,rS),await FM(ae),console.log(" Firebase listo con sesin persistente y modo offline.")}catch(t){console.warn(" Firebase offline/persistencia fall:",t.message)}}const GU="modulepreload",KU=function(t){return"/odontocloud-react/"+t},Ob={},QU=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=KU(c),c in Ob)return;Ob[c]=!0;const d=c.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":GU,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((m,v)=>{h.addEventListener("load",m),h.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function YU(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:o}=t;let l,c;const d=async(h=!0)=>{await c};async function f(){if("serviceWorker"in navigator){if(l=await QU(async()=>{const{Workbox:h}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:h}},[]).then(({Workbox:h})=>new h("/odontocloud-react/sw.js",{scope:"/odontocloud-react/",type:"classic"})).catch(h=>{o==null||o(h)}),!l)return;l.addEventListener("activated",h=>{(h.isUpdate||h.isExternal)&&window.location.reload()}),l.addEventListener("installed",h=>{h.isUpdate||r==null||r()}),l.register({immediate:e}).then(h=>{i?i("/odontocloud-react/sw.js",h):s==null||s(h)}).catch(h=>{o==null||o(h)})}}return c=f(),d}const XU="empresa_logo_url",Lb="empresa_nombre",JU=I.createContext(null);function ZU({children:t}){const[e,n]=I.useState(""),[r,s]=I.useState("OdontoCloud"),[i,o]=I.useState(!0);I.useEffect(()=>{var h;let d="";try{d=localStorage.getItem(XU)||""}catch{}d||(d="/assets/logo.png"),n(d);let f="OdontoCloud";try{f=localStorage.getItem(Lb)||((h=document.querySelector('meta[name="company-name"]'))==null?void 0:h.getAttribute("content"))||"OdontoCloud"}catch{}s(f),o(!1)},[]);const c={logoUrl:e,clinicName:r,loading:i,setLogoUrl:n,setClinicName:d=>{const f=d||"OdontoCloud";try{localStorage.setItem(Lb,f)}catch{}let h=document.querySelector('meta[name="company-name"]');h||(h=document.createElement("meta"),h.setAttribute("name","company-name"),document.head.appendChild(h)),h.setAttribute("content",f),s(f)}};return a.jsx(JU.Provider,{value:c,children:t})}const e3="/odontocloud-react/";WU();YU({immediate:!0});X0(document.getElementById("root")).render(a.jsx(Dg.StrictMode,{children:a.jsx(ZU,{children:a.jsx(gk,{basename:e3,children:a.jsx(HU,{})})})}));
