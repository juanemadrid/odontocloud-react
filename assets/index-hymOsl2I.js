(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function $1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var J0={exports:{}},Fh={},Z0={exports:{}},Je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jc=Symbol.for("react.element"),B1=Symbol.for("react.portal"),z1=Symbol.for("react.fragment"),q1=Symbol.for("react.strict_mode"),H1=Symbol.for("react.profiler"),W1=Symbol.for("react.provider"),G1=Symbol.for("react.context"),K1=Symbol.for("react.forward_ref"),Q1=Symbol.for("react.suspense"),Y1=Symbol.for("react.memo"),X1=Symbol.for("react.lazy"),Y_=Symbol.iterator;function J1(t){return t===null||typeof t!="object"?null:(t=Y_&&t[Y_]||t["@@iterator"],typeof t=="function"?t:null)}var eE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},tE=Object.assign,nE={};function tl(t,e,n){this.props=t,this.context=e,this.refs=nE,this.updater=n||eE}tl.prototype.isReactComponent={};tl.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};tl.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function rE(){}rE.prototype=tl.prototype;function $g(t,e,n){this.props=t,this.context=e,this.refs=nE,this.updater=n||eE}var Bg=$g.prototype=new rE;Bg.constructor=$g;tE(Bg,tl.prototype);Bg.isPureReactComponent=!0;var X_=Array.isArray,sE=Object.prototype.hasOwnProperty,zg={current:null},iE={key:!0,ref:!0,__self:!0,__source:!0};function oE(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)sE.call(e,r)&&!iE.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Jc,type:t,key:i,ref:a,props:s,_owner:zg.current}}function Z1(t,e){return{$$typeof:Jc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function qg(t){return typeof t=="object"&&t!==null&&t.$$typeof===Jc}function ej(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var J_=/\/+/g;function np(t,e){return typeof t=="object"&&t!==null&&t.key!=null?ej(""+t.key):e.toString(36)}function ad(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Jc:case B1:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+np(a,0):r,X_(s)?(n="",t!=null&&(n=t.replace(J_,"$&/")+"/"),ad(s,e,n,"",function(d){return d})):s!=null&&(qg(s)&&(s=Z1(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(J_,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",X_(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+np(i,l);a+=ad(i,e,n,c,s)}else if(c=J1(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+np(i,l++),a+=ad(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Au(t,e,n){if(t==null)return t;var r=[],s=0;return ad(t,r,"","",function(i){return e.call(n,i,s++)}),r}function tj(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Vn={current:null},ld={transition:null},nj={ReactCurrentDispatcher:Vn,ReactCurrentBatchConfig:ld,ReactCurrentOwner:zg};function aE(){throw Error("act(...) is not supported in production builds of React.")}Je.Children={map:Au,forEach:function(t,e,n){Au(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Au(t,function(){e++}),e},toArray:function(t){return Au(t,function(e){return e})||[]},only:function(t){if(!qg(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Je.Component=tl;Je.Fragment=z1;Je.Profiler=H1;Je.PureComponent=$g;Je.StrictMode=q1;Je.Suspense=Q1;Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nj;Je.act=aE;Je.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=tE({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=zg.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)sE.call(e,c)&&!iE.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Jc,type:t.type,key:s,ref:i,props:r,_owner:a}};Je.createContext=function(t){return t={$$typeof:G1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:W1,_context:t},t.Consumer=t};Je.createElement=oE;Je.createFactory=function(t){var e=oE.bind(null,t);return e.type=t,e};Je.createRef=function(){return{current:null}};Je.forwardRef=function(t){return{$$typeof:K1,render:t}};Je.isValidElement=qg;Je.lazy=function(t){return{$$typeof:X1,_payload:{_status:-1,_result:t},_init:tj}};Je.memo=function(t,e){return{$$typeof:Y1,type:t,compare:e===void 0?null:e}};Je.startTransition=function(t){var e=ld.transition;ld.transition={};try{t()}finally{ld.transition=e}};Je.unstable_act=aE;Je.useCallback=function(t,e){return Vn.current.useCallback(t,e)};Je.useContext=function(t){return Vn.current.useContext(t)};Je.useDebugValue=function(){};Je.useDeferredValue=function(t){return Vn.current.useDeferredValue(t)};Je.useEffect=function(t,e){return Vn.current.useEffect(t,e)};Je.useId=function(){return Vn.current.useId()};Je.useImperativeHandle=function(t,e,n){return Vn.current.useImperativeHandle(t,e,n)};Je.useInsertionEffect=function(t,e){return Vn.current.useInsertionEffect(t,e)};Je.useLayoutEffect=function(t,e){return Vn.current.useLayoutEffect(t,e)};Je.useMemo=function(t,e){return Vn.current.useMemo(t,e)};Je.useReducer=function(t,e,n){return Vn.current.useReducer(t,e,n)};Je.useRef=function(t){return Vn.current.useRef(t)};Je.useState=function(t){return Vn.current.useState(t)};Je.useSyncExternalStore=function(t,e,n){return Vn.current.useSyncExternalStore(t,e,n)};Je.useTransition=function(){return Vn.current.useTransition()};Je.version="18.3.1";Z0.exports=Je;var x=Z0.exports;const Uh=$1(x);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rj=x,sj=Symbol.for("react.element"),ij=Symbol.for("react.fragment"),oj=Object.prototype.hasOwnProperty,aj=rj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lj={key:!0,ref:!0,__self:!0,__source:!0};function lE(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)oj.call(e,r)&&!lj.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:sj,type:t,key:i,ref:a,props:s,_owner:aj.current}}Fh.Fragment=ij;Fh.jsx=lE;Fh.jsxs=lE;J0.exports=Fh;var o=J0.exports,cE={exports:{}},ar={},uE={exports:{}},dE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(X,te){var de=X.length;X.push(te);e:for(;0<de;){var ne=de-1>>>1,he=X[ne];if(0<s(he,te))X[ne]=te,X[de]=he,de=ne;else break e}}function n(X){return X.length===0?null:X[0]}function r(X){if(X.length===0)return null;var te=X[0],de=X.pop();if(de!==te){X[0]=de;e:for(var ne=0,he=X.length,Ce=he>>>1;ne<Ce;){var Ue=2*(ne+1)-1,$e=X[Ue],Ke=Ue+1,mt=X[Ke];if(0>s($e,de))Ke<he&&0>s(mt,$e)?(X[ne]=mt,X[Ke]=de,ne=Ke):(X[ne]=$e,X[Ue]=de,ne=Ue);else if(Ke<he&&0>s(mt,de))X[ne]=mt,X[Ke]=de,ne=Ke;else break e}}return te}function s(X,te){var de=X.sortIndex-te.sortIndex;return de!==0?de:X.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],d=[],h=1,f=null,m=3,_=!1,C=!1,N=!1,A=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(X){for(var te=n(d);te!==null;){if(te.callback===null)r(d);else if(te.startTime<=X)r(d),te.sortIndex=te.expirationTime,e(c,te);else break;te=n(d)}}function w(X){if(N=!1,E(X),!C)if(n(c)!==null)C=!0,ye(S);else{var te=n(d);te!==null&&He(w,te.startTime-X)}}function S(X,te){C=!1,N&&(N=!1,T(v),v=-1),_=!0;var de=m;try{for(E(te),f=n(c);f!==null&&(!(f.expirationTime>te)||X&&!R());){var ne=f.callback;if(typeof ne=="function"){f.callback=null,m=f.priorityLevel;var he=ne(f.expirationTime<=te);te=t.unstable_now(),typeof he=="function"?f.callback=he:f===n(c)&&r(c),E(te)}else r(c);f=n(c)}if(f!==null)var Ce=!0;else{var Ue=n(d);Ue!==null&&He(w,Ue.startTime-te),Ce=!1}return Ce}finally{f=null,m=de,_=!1}}var M=!1,g=null,v=-1,b=5,k=-1;function R(){return!(t.unstable_now()-k<b)}function V(){if(g!==null){var X=t.unstable_now();k=X;var te=!0;try{te=g(!0,X)}finally{te?D():(M=!1,g=null)}}else M=!1}var D;if(typeof I=="function")D=function(){I(V)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,ee=O.port2;O.port1.onmessage=V,D=function(){ee.postMessage(null)}}else D=function(){A(V,0)};function ye(X){g=X,M||(M=!0,D())}function He(X,te){v=A(function(){X(t.unstable_now())},te)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(X){X.callback=null},t.unstable_continueExecution=function(){C||_||(C=!0,ye(S))},t.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<X?Math.floor(1e3/X):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(X){switch(m){case 1:case 2:case 3:var te=3;break;default:te=m}var de=m;m=te;try{return X()}finally{m=de}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(X,te){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var de=m;m=X;try{return te()}finally{m=de}},t.unstable_scheduleCallback=function(X,te,de){var ne=t.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?ne+de:ne):de=ne,X){case 1:var he=-1;break;case 2:he=250;break;case 5:he=1073741823;break;case 4:he=1e4;break;default:he=5e3}return he=de+he,X={id:h++,callback:te,priorityLevel:X,startTime:de,expirationTime:he,sortIndex:-1},de>ne?(X.sortIndex=de,e(d,X),n(c)===null&&X===n(d)&&(N?(T(v),v=-1):N=!0,He(w,de-ne))):(X.sortIndex=he,e(c,X),C||_||(C=!0,ye(S))),X},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(X){var te=m;return function(){var de=m;m=te;try{return X.apply(this,arguments)}finally{m=de}}}})(dE);uE.exports=dE;var cj=uE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uj=x,ir=cj;function oe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var hE=new Set,xc={};function ko(t,e){Da(t,e),Da(t+"Capture",e)}function Da(t,e){for(xc[t]=e,t=0;t<e.length;t++)hE.add(e[t])}var ws=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),um=Object.prototype.hasOwnProperty,dj=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Z_={},ex={};function hj(t){return um.call(ex,t)?!0:um.call(Z_,t)?!1:dj.test(t)?ex[t]=!0:(Z_[t]=!0,!1)}function fj(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function pj(t,e,n,r){if(e===null||typeof e>"u"||fj(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Mn(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var mn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){mn[t]=new Mn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];mn[e]=new Mn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){mn[t]=new Mn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){mn[t]=new Mn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){mn[t]=new Mn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){mn[t]=new Mn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){mn[t]=new Mn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){mn[t]=new Mn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){mn[t]=new Mn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Hg=/[\-:]([a-z])/g;function Wg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Hg,Wg);mn[e]=new Mn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Hg,Wg);mn[e]=new Mn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Hg,Wg);mn[e]=new Mn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){mn[t]=new Mn(t,1,!1,t.toLowerCase(),null,!1,!1)});mn.xlinkHref=new Mn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){mn[t]=new Mn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Gg(t,e,n,r){var s=mn.hasOwnProperty(e)?mn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(pj(e,n,s,r)&&(n=null),r||s===null?hj(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Rs=uj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Pu=Symbol.for("react.element"),la=Symbol.for("react.portal"),ca=Symbol.for("react.fragment"),Kg=Symbol.for("react.strict_mode"),dm=Symbol.for("react.profiler"),fE=Symbol.for("react.provider"),pE=Symbol.for("react.context"),Qg=Symbol.for("react.forward_ref"),hm=Symbol.for("react.suspense"),fm=Symbol.for("react.suspense_list"),Yg=Symbol.for("react.memo"),Ws=Symbol.for("react.lazy"),mE=Symbol.for("react.offscreen"),tx=Symbol.iterator;function Il(t){return t===null||typeof t!="object"?null:(t=tx&&t[tx]||t["@@iterator"],typeof t=="function"?t:null)}var Lt=Object.assign,rp;function Bl(t){if(rp===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);rp=e&&e[1]||""}return`
`+rp+t}var sp=!1;function ip(t,e){if(!t||sp)return"";sp=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var c=`
`+s[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=l);break}}}finally{sp=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Bl(t):""}function mj(t){switch(t.tag){case 5:return Bl(t.type);case 16:return Bl("Lazy");case 13:return Bl("Suspense");case 19:return Bl("SuspenseList");case 0:case 2:case 15:return t=ip(t.type,!1),t;case 11:return t=ip(t.type.render,!1),t;case 1:return t=ip(t.type,!0),t;default:return""}}function pm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ca:return"Fragment";case la:return"Portal";case dm:return"Profiler";case Kg:return"StrictMode";case hm:return"Suspense";case fm:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case pE:return(t.displayName||"Context")+".Consumer";case fE:return(t._context.displayName||"Context")+".Provider";case Qg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Yg:return e=t.displayName||null,e!==null?e:pm(t.type)||"Memo";case Ws:e=t._payload,t=t._init;try{return pm(t(e))}catch{}}return null}function gj(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pm(e);case 8:return e===Kg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function xi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function gE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function yj(t){var e=gE(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ru(t){t._valueTracker||(t._valueTracker=yj(t))}function yE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=gE(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Md(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function mm(t,e){var n=e.checked;return Lt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function nx(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=xi(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function vE(t,e){e=e.checked,e!=null&&Gg(t,"checked",e,!1)}function gm(t,e){vE(t,e);var n=xi(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ym(t,e.type,n):e.hasOwnProperty("defaultValue")&&ym(t,e.type,xi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function rx(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function ym(t,e,n){(e!=="number"||Md(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var zl=Array.isArray;function ba(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+xi(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function vm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(oe(91));return Lt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function sx(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(oe(92));if(zl(n)){if(1<n.length)throw Error(oe(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:xi(n)}}function _E(t,e){var n=xi(e.value),r=xi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function ix(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function xE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _m(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?xE(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ku,bE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ku=ku||document.createElement("div"),ku.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ku.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function bc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var tc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},vj=["Webkit","ms","Moz","O"];Object.keys(tc).forEach(function(t){vj.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),tc[e]=tc[t]})});function wE(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||tc.hasOwnProperty(t)&&tc[t]?(""+e).trim():e+"px"}function EE(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=wE(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var _j=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xm(t,e){if(e){if(_j[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(oe(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(oe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(oe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(oe(62))}}function bm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wm=null;function Xg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Em=null,wa=null,Ea=null;function ox(t){if(t=tu(t)){if(typeof Em!="function")throw Error(oe(280));var e=t.stateNode;e&&(e=Hh(e),Em(t.stateNode,t.type,e))}}function IE(t){wa?Ea?Ea.push(t):Ea=[t]:wa=t}function SE(){if(wa){var t=wa,e=Ea;if(Ea=wa=null,ox(t),e)for(t=0;t<e.length;t++)ox(e[t])}}function TE(t,e){return t(e)}function CE(){}var op=!1;function NE(t,e,n){if(op)return t(e,n);op=!0;try{return TE(t,e,n)}finally{op=!1,(wa!==null||Ea!==null)&&(CE(),SE())}}function wc(t,e){var n=t.stateNode;if(n===null)return null;var r=Hh(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(oe(231,e,typeof n));return n}var Im=!1;if(ws)try{var Sl={};Object.defineProperty(Sl,"passive",{get:function(){Im=!0}}),window.addEventListener("test",Sl,Sl),window.removeEventListener("test",Sl,Sl)}catch{Im=!1}function xj(t,e,n,r,s,i,a,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(h){this.onError(h)}}var nc=!1,Fd=null,Ud=!1,Sm=null,bj={onError:function(t){nc=!0,Fd=t}};function wj(t,e,n,r,s,i,a,l,c){nc=!1,Fd=null,xj.apply(bj,arguments)}function Ej(t,e,n,r,s,i,a,l,c){if(wj.apply(this,arguments),nc){if(nc){var d=Fd;nc=!1,Fd=null}else throw Error(oe(198));Ud||(Ud=!0,Sm=d)}}function Do(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function jE(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ax(t){if(Do(t)!==t)throw Error(oe(188))}function Ij(t){var e=t.alternate;if(!e){if(e=Do(t),e===null)throw Error(oe(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return ax(s),t;if(i===r)return ax(s),e;i=i.sibling}throw Error(oe(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a)throw Error(oe(189))}}if(n.alternate!==r)throw Error(oe(190))}if(n.tag!==3)throw Error(oe(188));return n.stateNode.current===n?t:e}function AE(t){return t=Ij(t),t!==null?PE(t):null}function PE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=PE(t);if(e!==null)return e;t=t.sibling}return null}var RE=ir.unstable_scheduleCallback,lx=ir.unstable_cancelCallback,Sj=ir.unstable_shouldYield,Tj=ir.unstable_requestPaint,Wt=ir.unstable_now,Cj=ir.unstable_getCurrentPriorityLevel,Jg=ir.unstable_ImmediatePriority,kE=ir.unstable_UserBlockingPriority,$d=ir.unstable_NormalPriority,Nj=ir.unstable_LowPriority,DE=ir.unstable_IdlePriority,$h=null,es=null;function jj(t){if(es&&typeof es.onCommitFiberRoot=="function")try{es.onCommitFiberRoot($h,t,void 0,(t.current.flags&128)===128)}catch{}}var kr=Math.clz32?Math.clz32:Rj,Aj=Math.log,Pj=Math.LN2;function Rj(t){return t>>>=0,t===0?32:31-(Aj(t)/Pj|0)|0}var Du=64,Lu=4194304;function ql(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Bd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~s;l!==0?r=ql(l):(i&=a,i!==0&&(r=ql(i)))}else a=n&~s,a!==0?r=ql(a):i!==0&&(r=ql(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-kr(e),s=1<<n,r|=t[n],e&=~s;return r}function kj(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dj(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-kr(i),l=1<<a,c=s[a];c===-1?(!(l&n)||l&r)&&(s[a]=kj(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Tm(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function LE(){var t=Du;return Du<<=1,!(Du&4194240)&&(Du=64),t}function ap(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Zc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-kr(e),t[e]=n}function Lj(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-kr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Zg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-kr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var ht=0;function OE(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var VE,ey,ME,FE,UE,Cm=!1,Ou=[],oi=null,ai=null,li=null,Ec=new Map,Ic=new Map,Ks=[],Oj="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function cx(t,e){switch(t){case"focusin":case"focusout":oi=null;break;case"dragenter":case"dragleave":ai=null;break;case"mouseover":case"mouseout":li=null;break;case"pointerover":case"pointerout":Ec.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ic.delete(e.pointerId)}}function Tl(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=tu(e),e!==null&&ey(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Vj(t,e,n,r,s){switch(e){case"focusin":return oi=Tl(oi,t,e,n,r,s),!0;case"dragenter":return ai=Tl(ai,t,e,n,r,s),!0;case"mouseover":return li=Tl(li,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Ec.set(i,Tl(Ec.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ic.set(i,Tl(Ic.get(i)||null,t,e,n,r,s)),!0}return!1}function $E(t){var e=Ji(t.target);if(e!==null){var n=Do(e);if(n!==null){if(e=n.tag,e===13){if(e=jE(n),e!==null){t.blockedOn=e,UE(t.priority,function(){ME(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function cd(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Nm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);wm=r,n.target.dispatchEvent(r),wm=null}else return e=tu(n),e!==null&&ey(e),t.blockedOn=n,!1;e.shift()}return!0}function ux(t,e,n){cd(t)&&n.delete(e)}function Mj(){Cm=!1,oi!==null&&cd(oi)&&(oi=null),ai!==null&&cd(ai)&&(ai=null),li!==null&&cd(li)&&(li=null),Ec.forEach(ux),Ic.forEach(ux)}function Cl(t,e){t.blockedOn===e&&(t.blockedOn=null,Cm||(Cm=!0,ir.unstable_scheduleCallback(ir.unstable_NormalPriority,Mj)))}function Sc(t){function e(s){return Cl(s,t)}if(0<Ou.length){Cl(Ou[0],t);for(var n=1;n<Ou.length;n++){var r=Ou[n];r.blockedOn===t&&(r.blockedOn=null)}}for(oi!==null&&Cl(oi,t),ai!==null&&Cl(ai,t),li!==null&&Cl(li,t),Ec.forEach(e),Ic.forEach(e),n=0;n<Ks.length;n++)r=Ks[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ks.length&&(n=Ks[0],n.blockedOn===null);)$E(n),n.blockedOn===null&&Ks.shift()}var Ia=Rs.ReactCurrentBatchConfig,zd=!0;function Fj(t,e,n,r){var s=ht,i=Ia.transition;Ia.transition=null;try{ht=1,ty(t,e,n,r)}finally{ht=s,Ia.transition=i}}function Uj(t,e,n,r){var s=ht,i=Ia.transition;Ia.transition=null;try{ht=4,ty(t,e,n,r)}finally{ht=s,Ia.transition=i}}function ty(t,e,n,r){if(zd){var s=Nm(t,e,n,r);if(s===null)yp(t,e,r,qd,n),cx(t,r);else if(Vj(s,t,e,n,r))r.stopPropagation();else if(cx(t,r),e&4&&-1<Oj.indexOf(t)){for(;s!==null;){var i=tu(s);if(i!==null&&VE(i),i=Nm(t,e,n,r),i===null&&yp(t,e,r,qd,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else yp(t,e,r,null,n)}}var qd=null;function Nm(t,e,n,r){if(qd=null,t=Xg(r),t=Ji(t),t!==null)if(e=Do(t),e===null)t=null;else if(n=e.tag,n===13){if(t=jE(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return qd=t,null}function BE(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Cj()){case Jg:return 1;case kE:return 4;case $d:case Nj:return 16;case DE:return 536870912;default:return 16}default:return 16}}var ri=null,ny=null,ud=null;function zE(){if(ud)return ud;var t,e=ny,n=e.length,r,s="value"in ri?ri.value:ri.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return ud=s.slice(t,1<r?1-r:void 0)}function dd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Vu(){return!0}function dx(){return!1}function lr(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Vu:dx,this.isPropagationStopped=dx,this}return Lt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Vu)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Vu)},persist:function(){},isPersistent:Vu}),e}var nl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ry=lr(nl),eu=Lt({},nl,{view:0,detail:0}),$j=lr(eu),lp,cp,Nl,Bh=Lt({},eu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sy,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Nl&&(Nl&&t.type==="mousemove"?(lp=t.screenX-Nl.screenX,cp=t.screenY-Nl.screenY):cp=lp=0,Nl=t),lp)},movementY:function(t){return"movementY"in t?t.movementY:cp}}),hx=lr(Bh),Bj=Lt({},Bh,{dataTransfer:0}),zj=lr(Bj),qj=Lt({},eu,{relatedTarget:0}),up=lr(qj),Hj=Lt({},nl,{animationName:0,elapsedTime:0,pseudoElement:0}),Wj=lr(Hj),Gj=Lt({},nl,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Kj=lr(Gj),Qj=Lt({},nl,{data:0}),fx=lr(Qj),Yj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Xj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Jj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Zj(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Jj[t])?!!e[t]:!1}function sy(){return Zj}var eA=Lt({},eu,{key:function(t){if(t.key){var e=Yj[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=dd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Xj[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sy,charCode:function(t){return t.type==="keypress"?dd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?dd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),tA=lr(eA),nA=Lt({},Bh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),px=lr(nA),rA=Lt({},eu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sy}),sA=lr(rA),iA=Lt({},nl,{propertyName:0,elapsedTime:0,pseudoElement:0}),oA=lr(iA),aA=Lt({},Bh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),lA=lr(aA),cA=[9,13,27,32],iy=ws&&"CompositionEvent"in window,rc=null;ws&&"documentMode"in document&&(rc=document.documentMode);var uA=ws&&"TextEvent"in window&&!rc,qE=ws&&(!iy||rc&&8<rc&&11>=rc),mx=" ",gx=!1;function HE(t,e){switch(t){case"keyup":return cA.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function WE(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ua=!1;function dA(t,e){switch(t){case"compositionend":return WE(e);case"keypress":return e.which!==32?null:(gx=!0,mx);case"textInput":return t=e.data,t===mx&&gx?null:t;default:return null}}function hA(t,e){if(ua)return t==="compositionend"||!iy&&HE(t,e)?(t=zE(),ud=ny=ri=null,ua=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return qE&&e.locale!=="ko"?null:e.data;default:return null}}var fA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!fA[t.type]:e==="textarea"}function GE(t,e,n,r){IE(r),e=Hd(e,"onChange"),0<e.length&&(n=new ry("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var sc=null,Tc=null;function pA(t){sI(t,0)}function zh(t){var e=fa(t);if(yE(e))return t}function mA(t,e){if(t==="change")return e}var KE=!1;if(ws){var dp;if(ws){var hp="oninput"in document;if(!hp){var vx=document.createElement("div");vx.setAttribute("oninput","return;"),hp=typeof vx.oninput=="function"}dp=hp}else dp=!1;KE=dp&&(!document.documentMode||9<document.documentMode)}function _x(){sc&&(sc.detachEvent("onpropertychange",QE),Tc=sc=null)}function QE(t){if(t.propertyName==="value"&&zh(Tc)){var e=[];GE(e,Tc,t,Xg(t)),NE(pA,e)}}function gA(t,e,n){t==="focusin"?(_x(),sc=e,Tc=n,sc.attachEvent("onpropertychange",QE)):t==="focusout"&&_x()}function yA(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return zh(Tc)}function vA(t,e){if(t==="click")return zh(e)}function _A(t,e){if(t==="input"||t==="change")return zh(e)}function xA(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Or=typeof Object.is=="function"?Object.is:xA;function Cc(t,e){if(Or(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!um.call(e,s)||!Or(t[s],e[s]))return!1}return!0}function xx(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function bx(t,e){var n=xx(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=xx(n)}}function YE(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?YE(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function XE(){for(var t=window,e=Md();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Md(t.document)}return e}function oy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function bA(t){var e=XE(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&YE(n.ownerDocument.documentElement,n)){if(r!==null&&oy(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=bx(n,i);var a=bx(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var wA=ws&&"documentMode"in document&&11>=document.documentMode,da=null,jm=null,ic=null,Am=!1;function wx(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Am||da==null||da!==Md(r)||(r=da,"selectionStart"in r&&oy(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ic&&Cc(ic,r)||(ic=r,r=Hd(jm,"onSelect"),0<r.length&&(e=new ry("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=da)))}function Mu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ha={animationend:Mu("Animation","AnimationEnd"),animationiteration:Mu("Animation","AnimationIteration"),animationstart:Mu("Animation","AnimationStart"),transitionend:Mu("Transition","TransitionEnd")},fp={},JE={};ws&&(JE=document.createElement("div").style,"AnimationEvent"in window||(delete ha.animationend.animation,delete ha.animationiteration.animation,delete ha.animationstart.animation),"TransitionEvent"in window||delete ha.transitionend.transition);function qh(t){if(fp[t])return fp[t];if(!ha[t])return t;var e=ha[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in JE)return fp[t]=e[n];return t}var ZE=qh("animationend"),eI=qh("animationiteration"),tI=qh("animationstart"),nI=qh("transitionend"),rI=new Map,Ex="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ci(t,e){rI.set(t,e),ko(e,[t])}for(var pp=0;pp<Ex.length;pp++){var mp=Ex[pp],EA=mp.toLowerCase(),IA=mp[0].toUpperCase()+mp.slice(1);Ci(EA,"on"+IA)}Ci(ZE,"onAnimationEnd");Ci(eI,"onAnimationIteration");Ci(tI,"onAnimationStart");Ci("dblclick","onDoubleClick");Ci("focusin","onFocus");Ci("focusout","onBlur");Ci(nI,"onTransitionEnd");Da("onMouseEnter",["mouseout","mouseover"]);Da("onMouseLeave",["mouseout","mouseover"]);Da("onPointerEnter",["pointerout","pointerover"]);Da("onPointerLeave",["pointerout","pointerover"]);ko("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ko("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ko("onBeforeInput",["compositionend","keypress","textInput","paste"]);ko("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ko("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ko("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),SA=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hl));function Ix(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Ej(r,e,void 0,t),t.currentTarget=null}function sI(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;Ix(s,l,d),i=c}else for(a=0;a<r.length;a++){if(l=r[a],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;Ix(s,l,d),i=c}}}if(Ud)throw t=Sm,Ud=!1,Sm=null,t}function Et(t,e){var n=e[Lm];n===void 0&&(n=e[Lm]=new Set);var r=t+"__bubble";n.has(r)||(iI(e,t,2,!1),n.add(r))}function gp(t,e,n){var r=0;e&&(r|=4),iI(n,t,r,e)}var Fu="_reactListening"+Math.random().toString(36).slice(2);function Nc(t){if(!t[Fu]){t[Fu]=!0,hE.forEach(function(n){n!=="selectionchange"&&(SA.has(n)||gp(n,!1,t),gp(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Fu]||(e[Fu]=!0,gp("selectionchange",!1,e))}}function iI(t,e,n,r){switch(BE(e)){case 1:var s=Fj;break;case 4:s=Uj;break;default:s=ty}n=s.bind(null,e,n,t),s=void 0,!Im||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function yp(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;a=a.return}for(;l!==null;){if(a=Ji(l),a===null)return;if(c=a.tag,c===5||c===6){r=i=a;continue e}l=l.parentNode}}r=r.return}NE(function(){var d=i,h=Xg(n),f=[];e:{var m=rI.get(t);if(m!==void 0){var _=ry,C=t;switch(t){case"keypress":if(dd(n)===0)break e;case"keydown":case"keyup":_=tA;break;case"focusin":C="focus",_=up;break;case"focusout":C="blur",_=up;break;case"beforeblur":case"afterblur":_=up;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=hx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=zj;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=sA;break;case ZE:case eI:case tI:_=Wj;break;case nI:_=oA;break;case"scroll":_=$j;break;case"wheel":_=lA;break;case"copy":case"cut":case"paste":_=Kj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=px}var N=(e&4)!==0,A=!N&&t==="scroll",T=N?m!==null?m+"Capture":null:m;N=[];for(var I=d,E;I!==null;){E=I;var w=E.stateNode;if(E.tag===5&&w!==null&&(E=w,T!==null&&(w=wc(I,T),w!=null&&N.push(jc(I,w,E)))),A)break;I=I.return}0<N.length&&(m=new _(m,C,null,n,h),f.push({event:m,listeners:N}))}}if(!(e&7)){e:{if(m=t==="mouseover"||t==="pointerover",_=t==="mouseout"||t==="pointerout",m&&n!==wm&&(C=n.relatedTarget||n.fromElement)&&(Ji(C)||C[Es]))break e;if((_||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,_?(C=n.relatedTarget||n.toElement,_=d,C=C?Ji(C):null,C!==null&&(A=Do(C),C!==A||C.tag!==5&&C.tag!==6)&&(C=null)):(_=null,C=d),_!==C)){if(N=hx,w="onMouseLeave",T="onMouseEnter",I="mouse",(t==="pointerout"||t==="pointerover")&&(N=px,w="onPointerLeave",T="onPointerEnter",I="pointer"),A=_==null?m:fa(_),E=C==null?m:fa(C),m=new N(w,I+"leave",_,n,h),m.target=A,m.relatedTarget=E,w=null,Ji(h)===d&&(N=new N(T,I+"enter",C,n,h),N.target=E,N.relatedTarget=A,w=N),A=w,_&&C)t:{for(N=_,T=C,I=0,E=N;E;E=zo(E))I++;for(E=0,w=T;w;w=zo(w))E++;for(;0<I-E;)N=zo(N),I--;for(;0<E-I;)T=zo(T),E--;for(;I--;){if(N===T||T!==null&&N===T.alternate)break t;N=zo(N),T=zo(T)}N=null}else N=null;_!==null&&Sx(f,m,_,N,!1),C!==null&&A!==null&&Sx(f,A,C,N,!0)}}e:{if(m=d?fa(d):window,_=m.nodeName&&m.nodeName.toLowerCase(),_==="select"||_==="input"&&m.type==="file")var S=mA;else if(yx(m))if(KE)S=_A;else{S=yA;var M=gA}else(_=m.nodeName)&&_.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(S=vA);if(S&&(S=S(t,d))){GE(f,S,n,h);break e}M&&M(t,m,d),t==="focusout"&&(M=m._wrapperState)&&M.controlled&&m.type==="number"&&ym(m,"number",m.value)}switch(M=d?fa(d):window,t){case"focusin":(yx(M)||M.contentEditable==="true")&&(da=M,jm=d,ic=null);break;case"focusout":ic=jm=da=null;break;case"mousedown":Am=!0;break;case"contextmenu":case"mouseup":case"dragend":Am=!1,wx(f,n,h);break;case"selectionchange":if(wA)break;case"keydown":case"keyup":wx(f,n,h)}var g;if(iy)e:{switch(t){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else ua?HE(t,n)&&(v="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(v="onCompositionStart");v&&(qE&&n.locale!=="ko"&&(ua||v!=="onCompositionStart"?v==="onCompositionEnd"&&ua&&(g=zE()):(ri=h,ny="value"in ri?ri.value:ri.textContent,ua=!0)),M=Hd(d,v),0<M.length&&(v=new fx(v,t,null,n,h),f.push({event:v,listeners:M}),g?v.data=g:(g=WE(n),g!==null&&(v.data=g)))),(g=uA?dA(t,n):hA(t,n))&&(d=Hd(d,"onBeforeInput"),0<d.length&&(h=new fx("onBeforeInput","beforeinput",null,n,h),f.push({event:h,listeners:d}),h.data=g))}sI(f,e)})}function jc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Hd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=wc(t,n),i!=null&&r.unshift(jc(t,i,s)),i=wc(t,e),i!=null&&r.push(jc(t,i,s))),t=t.return}return r}function zo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Sx(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=wc(n,i),c!=null&&a.unshift(jc(n,c,l))):s||(c=wc(n,i),c!=null&&a.push(jc(n,c,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var TA=/\r\n?/g,CA=/\u0000|\uFFFD/g;function Tx(t){return(typeof t=="string"?t:""+t).replace(TA,`
`).replace(CA,"")}function Uu(t,e,n){if(e=Tx(e),Tx(t)!==e&&n)throw Error(oe(425))}function Wd(){}var Pm=null,Rm=null;function km(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Dm=typeof setTimeout=="function"?setTimeout:void 0,NA=typeof clearTimeout=="function"?clearTimeout:void 0,Cx=typeof Promise=="function"?Promise:void 0,jA=typeof queueMicrotask=="function"?queueMicrotask:typeof Cx<"u"?function(t){return Cx.resolve(null).then(t).catch(AA)}:Dm;function AA(t){setTimeout(function(){throw t})}function vp(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Sc(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Sc(e)}function ci(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Nx(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var rl=Math.random().toString(36).slice(2),Yr="__reactFiber$"+rl,Ac="__reactProps$"+rl,Es="__reactContainer$"+rl,Lm="__reactEvents$"+rl,PA="__reactListeners$"+rl,RA="__reactHandles$"+rl;function Ji(t){var e=t[Yr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Es]||n[Yr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Nx(t);t!==null;){if(n=t[Yr])return n;t=Nx(t)}return e}t=n,n=t.parentNode}return null}function tu(t){return t=t[Yr]||t[Es],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function fa(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(oe(33))}function Hh(t){return t[Ac]||null}var Om=[],pa=-1;function Ni(t){return{current:t}}function It(t){0>pa||(t.current=Om[pa],Om[pa]=null,pa--)}function _t(t,e){pa++,Om[pa]=t.current,t.current=e}var bi={},Nn=Ni(bi),Hn=Ni(!1),ho=bi;function La(t,e){var n=t.type.contextTypes;if(!n)return bi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Wn(t){return t=t.childContextTypes,t!=null}function Gd(){It(Hn),It(Nn)}function jx(t,e,n){if(Nn.current!==bi)throw Error(oe(168));_t(Nn,e),_t(Hn,n)}function oI(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(oe(108,gj(t)||"Unknown",s));return Lt({},n,r)}function Kd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||bi,ho=Nn.current,_t(Nn,t),_t(Hn,Hn.current),!0}function Ax(t,e,n){var r=t.stateNode;if(!r)throw Error(oe(169));n?(t=oI(t,e,ho),r.__reactInternalMemoizedMergedChildContext=t,It(Hn),It(Nn),_t(Nn,t)):It(Hn),_t(Hn,n)}var ps=null,Wh=!1,_p=!1;function aI(t){ps===null?ps=[t]:ps.push(t)}function kA(t){Wh=!0,aI(t)}function ji(){if(!_p&&ps!==null){_p=!0;var t=0,e=ht;try{var n=ps;for(ht=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ps=null,Wh=!1}catch(s){throw ps!==null&&(ps=ps.slice(t+1)),RE(Jg,ji),s}finally{ht=e,_p=!1}}return null}var ma=[],ga=0,Qd=null,Yd=0,ur=[],dr=0,fo=null,ms=1,gs="";function Bi(t,e){ma[ga++]=Yd,ma[ga++]=Qd,Qd=t,Yd=e}function lI(t,e,n){ur[dr++]=ms,ur[dr++]=gs,ur[dr++]=fo,fo=t;var r=ms;t=gs;var s=32-kr(r)-1;r&=~(1<<s),n+=1;var i=32-kr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,ms=1<<32-kr(e)+s|n<<s|r,gs=i+t}else ms=1<<i|n<<s|r,gs=t}function ay(t){t.return!==null&&(Bi(t,1),lI(t,1,0))}function ly(t){for(;t===Qd;)Qd=ma[--ga],ma[ga]=null,Yd=ma[--ga],ma[ga]=null;for(;t===fo;)fo=ur[--dr],ur[dr]=null,gs=ur[--dr],ur[dr]=null,ms=ur[--dr],ur[dr]=null}var rr=null,tr=null,Ct=!1,Ar=null;function cI(t,e){var n=pr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Px(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,rr=t,tr=ci(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,rr=t,tr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=fo!==null?{id:ms,overflow:gs}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=pr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,rr=t,tr=null,!0):!1;default:return!1}}function Vm(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Mm(t){if(Ct){var e=tr;if(e){var n=e;if(!Px(t,e)){if(Vm(t))throw Error(oe(418));e=ci(n.nextSibling);var r=rr;e&&Px(t,e)?cI(r,n):(t.flags=t.flags&-4097|2,Ct=!1,rr=t)}}else{if(Vm(t))throw Error(oe(418));t.flags=t.flags&-4097|2,Ct=!1,rr=t}}}function Rx(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;rr=t}function $u(t){if(t!==rr)return!1;if(!Ct)return Rx(t),Ct=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!km(t.type,t.memoizedProps)),e&&(e=tr)){if(Vm(t))throw uI(),Error(oe(418));for(;e;)cI(t,e),e=ci(e.nextSibling)}if(Rx(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(oe(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){tr=ci(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}tr=null}}else tr=rr?ci(t.stateNode.nextSibling):null;return!0}function uI(){for(var t=tr;t;)t=ci(t.nextSibling)}function Oa(){tr=rr=null,Ct=!1}function cy(t){Ar===null?Ar=[t]:Ar.push(t)}var DA=Rs.ReactCurrentBatchConfig;function jl(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(oe(309));var r=n.stateNode}if(!r)throw Error(oe(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(oe(284));if(!n._owner)throw Error(oe(290,t))}return t}function Bu(t,e){throw t=Object.prototype.toString.call(e),Error(oe(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function kx(t){var e=t._init;return e(t._payload)}function dI(t){function e(T,I){if(t){var E=T.deletions;E===null?(T.deletions=[I],T.flags|=16):E.push(I)}}function n(T,I){if(!t)return null;for(;I!==null;)e(T,I),I=I.sibling;return null}function r(T,I){for(T=new Map;I!==null;)I.key!==null?T.set(I.key,I):T.set(I.index,I),I=I.sibling;return T}function s(T,I){return T=fi(T,I),T.index=0,T.sibling=null,T}function i(T,I,E){return T.index=E,t?(E=T.alternate,E!==null?(E=E.index,E<I?(T.flags|=2,I):E):(T.flags|=2,I)):(T.flags|=1048576,I)}function a(T){return t&&T.alternate===null&&(T.flags|=2),T}function l(T,I,E,w){return I===null||I.tag!==6?(I=Tp(E,T.mode,w),I.return=T,I):(I=s(I,E),I.return=T,I)}function c(T,I,E,w){var S=E.type;return S===ca?h(T,I,E.props.children,w,E.key):I!==null&&(I.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ws&&kx(S)===I.type)?(w=s(I,E.props),w.ref=jl(T,I,E),w.return=T,w):(w=vd(E.type,E.key,E.props,null,T.mode,w),w.ref=jl(T,I,E),w.return=T,w)}function d(T,I,E,w){return I===null||I.tag!==4||I.stateNode.containerInfo!==E.containerInfo||I.stateNode.implementation!==E.implementation?(I=Cp(E,T.mode,w),I.return=T,I):(I=s(I,E.children||[]),I.return=T,I)}function h(T,I,E,w,S){return I===null||I.tag!==7?(I=so(E,T.mode,w,S),I.return=T,I):(I=s(I,E),I.return=T,I)}function f(T,I,E){if(typeof I=="string"&&I!==""||typeof I=="number")return I=Tp(""+I,T.mode,E),I.return=T,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Pu:return E=vd(I.type,I.key,I.props,null,T.mode,E),E.ref=jl(T,null,I),E.return=T,E;case la:return I=Cp(I,T.mode,E),I.return=T,I;case Ws:var w=I._init;return f(T,w(I._payload),E)}if(zl(I)||Il(I))return I=so(I,T.mode,E,null),I.return=T,I;Bu(T,I)}return null}function m(T,I,E,w){var S=I!==null?I.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return S!==null?null:l(T,I,""+E,w);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Pu:return E.key===S?c(T,I,E,w):null;case la:return E.key===S?d(T,I,E,w):null;case Ws:return S=E._init,m(T,I,S(E._payload),w)}if(zl(E)||Il(E))return S!==null?null:h(T,I,E,w,null);Bu(T,E)}return null}function _(T,I,E,w,S){if(typeof w=="string"&&w!==""||typeof w=="number")return T=T.get(E)||null,l(I,T,""+w,S);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Pu:return T=T.get(w.key===null?E:w.key)||null,c(I,T,w,S);case la:return T=T.get(w.key===null?E:w.key)||null,d(I,T,w,S);case Ws:var M=w._init;return _(T,I,E,M(w._payload),S)}if(zl(w)||Il(w))return T=T.get(E)||null,h(I,T,w,S,null);Bu(I,w)}return null}function C(T,I,E,w){for(var S=null,M=null,g=I,v=I=0,b=null;g!==null&&v<E.length;v++){g.index>v?(b=g,g=null):b=g.sibling;var k=m(T,g,E[v],w);if(k===null){g===null&&(g=b);break}t&&g&&k.alternate===null&&e(T,g),I=i(k,I,v),M===null?S=k:M.sibling=k,M=k,g=b}if(v===E.length)return n(T,g),Ct&&Bi(T,v),S;if(g===null){for(;v<E.length;v++)g=f(T,E[v],w),g!==null&&(I=i(g,I,v),M===null?S=g:M.sibling=g,M=g);return Ct&&Bi(T,v),S}for(g=r(T,g);v<E.length;v++)b=_(g,T,v,E[v],w),b!==null&&(t&&b.alternate!==null&&g.delete(b.key===null?v:b.key),I=i(b,I,v),M===null?S=b:M.sibling=b,M=b);return t&&g.forEach(function(R){return e(T,R)}),Ct&&Bi(T,v),S}function N(T,I,E,w){var S=Il(E);if(typeof S!="function")throw Error(oe(150));if(E=S.call(E),E==null)throw Error(oe(151));for(var M=S=null,g=I,v=I=0,b=null,k=E.next();g!==null&&!k.done;v++,k=E.next()){g.index>v?(b=g,g=null):b=g.sibling;var R=m(T,g,k.value,w);if(R===null){g===null&&(g=b);break}t&&g&&R.alternate===null&&e(T,g),I=i(R,I,v),M===null?S=R:M.sibling=R,M=R,g=b}if(k.done)return n(T,g),Ct&&Bi(T,v),S;if(g===null){for(;!k.done;v++,k=E.next())k=f(T,k.value,w),k!==null&&(I=i(k,I,v),M===null?S=k:M.sibling=k,M=k);return Ct&&Bi(T,v),S}for(g=r(T,g);!k.done;v++,k=E.next())k=_(g,T,v,k.value,w),k!==null&&(t&&k.alternate!==null&&g.delete(k.key===null?v:k.key),I=i(k,I,v),M===null?S=k:M.sibling=k,M=k);return t&&g.forEach(function(V){return e(T,V)}),Ct&&Bi(T,v),S}function A(T,I,E,w){if(typeof E=="object"&&E!==null&&E.type===ca&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case Pu:e:{for(var S=E.key,M=I;M!==null;){if(M.key===S){if(S=E.type,S===ca){if(M.tag===7){n(T,M.sibling),I=s(M,E.props.children),I.return=T,T=I;break e}}else if(M.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ws&&kx(S)===M.type){n(T,M.sibling),I=s(M,E.props),I.ref=jl(T,M,E),I.return=T,T=I;break e}n(T,M);break}else e(T,M);M=M.sibling}E.type===ca?(I=so(E.props.children,T.mode,w,E.key),I.return=T,T=I):(w=vd(E.type,E.key,E.props,null,T.mode,w),w.ref=jl(T,I,E),w.return=T,T=w)}return a(T);case la:e:{for(M=E.key;I!==null;){if(I.key===M)if(I.tag===4&&I.stateNode.containerInfo===E.containerInfo&&I.stateNode.implementation===E.implementation){n(T,I.sibling),I=s(I,E.children||[]),I.return=T,T=I;break e}else{n(T,I);break}else e(T,I);I=I.sibling}I=Cp(E,T.mode,w),I.return=T,T=I}return a(T);case Ws:return M=E._init,A(T,I,M(E._payload),w)}if(zl(E))return C(T,I,E,w);if(Il(E))return N(T,I,E,w);Bu(T,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,I!==null&&I.tag===6?(n(T,I.sibling),I=s(I,E),I.return=T,T=I):(n(T,I),I=Tp(E,T.mode,w),I.return=T,T=I),a(T)):n(T,I)}return A}var Va=dI(!0),hI=dI(!1),Xd=Ni(null),Jd=null,ya=null,uy=null;function dy(){uy=ya=Jd=null}function hy(t){var e=Xd.current;It(Xd),t._currentValue=e}function Fm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Sa(t,e){Jd=t,uy=ya=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(zn=!0),t.firstContext=null)}function vr(t){var e=t._currentValue;if(uy!==t)if(t={context:t,memoizedValue:e,next:null},ya===null){if(Jd===null)throw Error(oe(308));ya=t,Jd.dependencies={lanes:0,firstContext:t}}else ya=ya.next=t;return e}var Zi=null;function fy(t){Zi===null?Zi=[t]:Zi.push(t)}function fI(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,fy(e)):(n.next=s.next,s.next=n),e.interleaved=n,Is(t,r)}function Is(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Gs=!1;function py(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function xs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ui(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ot&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Is(t,n)}return s=r.interleaved,s===null?(e.next=e,fy(r)):(e.next=s.next,s.next=e),r.interleaved=e,Is(t,n)}function hd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Zg(t,n)}}function Dx(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Zd(t,e,n,r){var s=t.updateQueue;Gs=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var h=t.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==a&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(i!==null){var f=s.baseState;a=0,h=d=c=null,l=i;do{var m=l.lane,_=l.eventTime;if((r&m)===m){h!==null&&(h=h.next={eventTime:_,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var C=t,N=l;switch(m=e,_=n,N.tag){case 1:if(C=N.payload,typeof C=="function"){f=C.call(_,f,m);break e}f=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=N.payload,m=typeof C=="function"?C.call(_,f,m):C,m==null)break e;f=Lt({},f,m);break e;case 2:Gs=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,m=s.effects,m===null?s.effects=[l]:m.push(l))}else _={eventTime:_,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=_,c=f):h=h.next=_,a|=m;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;m=l,l=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(!0);if(h===null&&(c=f),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);mo|=a,t.lanes=a,t.memoizedState=f}}function Lx(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(oe(191,s));s.call(r)}}}var nu={},ts=Ni(nu),Pc=Ni(nu),Rc=Ni(nu);function eo(t){if(t===nu)throw Error(oe(174));return t}function my(t,e){switch(_t(Rc,e),_t(Pc,t),_t(ts,nu),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:_m(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=_m(e,t)}It(ts),_t(ts,e)}function Ma(){It(ts),It(Pc),It(Rc)}function mI(t){eo(Rc.current);var e=eo(ts.current),n=_m(e,t.type);e!==n&&(_t(Pc,t),_t(ts,n))}function gy(t){Pc.current===t&&(It(ts),It(Pc))}var Pt=Ni(0);function eh(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xp=[];function yy(){for(var t=0;t<xp.length;t++)xp[t]._workInProgressVersionPrimary=null;xp.length=0}var fd=Rs.ReactCurrentDispatcher,bp=Rs.ReactCurrentBatchConfig,po=0,Dt=null,Zt=null,an=null,th=!1,oc=!1,kc=0,LA=0;function vn(){throw Error(oe(321))}function vy(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Or(t[n],e[n]))return!1;return!0}function _y(t,e,n,r,s,i){if(po=i,Dt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,fd.current=t===null||t.memoizedState===null?FA:UA,t=n(r,s),oc){i=0;do{if(oc=!1,kc=0,25<=i)throw Error(oe(301));i+=1,an=Zt=null,e.updateQueue=null,fd.current=$A,t=n(r,s)}while(oc)}if(fd.current=nh,e=Zt!==null&&Zt.next!==null,po=0,an=Zt=Dt=null,th=!1,e)throw Error(oe(300));return t}function xy(){var t=kc!==0;return kc=0,t}function Kr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return an===null?Dt.memoizedState=an=t:an=an.next=t,an}function _r(){if(Zt===null){var t=Dt.alternate;t=t!==null?t.memoizedState:null}else t=Zt.next;var e=an===null?Dt.memoizedState:an.next;if(e!==null)an=e,Zt=t;else{if(t===null)throw Error(oe(310));Zt=t,t={memoizedState:Zt.memoizedState,baseState:Zt.baseState,baseQueue:Zt.baseQueue,queue:Zt.queue,next:null},an===null?Dt.memoizedState=an=t:an=an.next=t}return an}function Dc(t,e){return typeof e=="function"?e(t):e}function wp(t){var e=_r(),n=e.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=t;var r=Zt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,c=null,d=i;do{var h=d.lane;if((po&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=f,a=r):c=c.next=f,Dt.lanes|=h,mo|=h}d=d.next}while(d!==null&&d!==i);c===null?a=r:c.next=l,Or(r,e.memoizedState)||(zn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Dt.lanes|=i,mo|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ep(t){var e=_r(),n=e.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);Or(i,e.memoizedState)||(zn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function gI(){}function yI(t,e){var n=Dt,r=_r(),s=e(),i=!Or(r.memoizedState,s);if(i&&(r.memoizedState=s,zn=!0),r=r.queue,by(xI.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||an!==null&&an.memoizedState.tag&1){if(n.flags|=2048,Lc(9,_I.bind(null,n,r,s,e),void 0,null),cn===null)throw Error(oe(349));po&30||vI(n,e,s)}return s}function vI(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Dt.updateQueue,e===null?(e={lastEffect:null,stores:null},Dt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function _I(t,e,n,r){e.value=n,e.getSnapshot=r,bI(e)&&wI(t)}function xI(t,e,n){return n(function(){bI(e)&&wI(t)})}function bI(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Or(t,n)}catch{return!0}}function wI(t){var e=Is(t,1);e!==null&&Dr(e,t,1,-1)}function Ox(t){var e=Kr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Dc,lastRenderedState:t},e.queue=t,t=t.dispatch=MA.bind(null,Dt,t),[e.memoizedState,t]}function Lc(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Dt.updateQueue,e===null?(e={lastEffect:null,stores:null},Dt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function EI(){return _r().memoizedState}function pd(t,e,n,r){var s=Kr();Dt.flags|=t,s.memoizedState=Lc(1|e,n,void 0,r===void 0?null:r)}function Gh(t,e,n,r){var s=_r();r=r===void 0?null:r;var i=void 0;if(Zt!==null){var a=Zt.memoizedState;if(i=a.destroy,r!==null&&vy(r,a.deps)){s.memoizedState=Lc(e,n,i,r);return}}Dt.flags|=t,s.memoizedState=Lc(1|e,n,i,r)}function Vx(t,e){return pd(8390656,8,t,e)}function by(t,e){return Gh(2048,8,t,e)}function II(t,e){return Gh(4,2,t,e)}function SI(t,e){return Gh(4,4,t,e)}function TI(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function CI(t,e,n){return n=n!=null?n.concat([t]):null,Gh(4,4,TI.bind(null,e,t),n)}function wy(){}function NI(t,e){var n=_r();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&vy(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function jI(t,e){var n=_r();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&vy(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function AI(t,e,n){return po&21?(Or(n,e)||(n=LE(),Dt.lanes|=n,mo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,zn=!0),t.memoizedState=n)}function OA(t,e){var n=ht;ht=n!==0&&4>n?n:4,t(!0);var r=bp.transition;bp.transition={};try{t(!1),e()}finally{ht=n,bp.transition=r}}function PI(){return _r().memoizedState}function VA(t,e,n){var r=hi(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},RI(t))kI(e,n);else if(n=fI(t,e,n,r),n!==null){var s=Dn();Dr(n,t,r,s),DI(n,e,r)}}function MA(t,e,n){var r=hi(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(RI(t))kI(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,n);if(s.hasEagerState=!0,s.eagerState=l,Or(l,a)){var c=e.interleaved;c===null?(s.next=s,fy(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=fI(t,e,s,r),n!==null&&(s=Dn(),Dr(n,t,r,s),DI(n,e,r))}}function RI(t){var e=t.alternate;return t===Dt||e!==null&&e===Dt}function kI(t,e){oc=th=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function DI(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Zg(t,n)}}var nh={readContext:vr,useCallback:vn,useContext:vn,useEffect:vn,useImperativeHandle:vn,useInsertionEffect:vn,useLayoutEffect:vn,useMemo:vn,useReducer:vn,useRef:vn,useState:vn,useDebugValue:vn,useDeferredValue:vn,useTransition:vn,useMutableSource:vn,useSyncExternalStore:vn,useId:vn,unstable_isNewReconciler:!1},FA={readContext:vr,useCallback:function(t,e){return Kr().memoizedState=[t,e===void 0?null:e],t},useContext:vr,useEffect:Vx,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,pd(4194308,4,TI.bind(null,e,t),n)},useLayoutEffect:function(t,e){return pd(4194308,4,t,e)},useInsertionEffect:function(t,e){return pd(4,2,t,e)},useMemo:function(t,e){var n=Kr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Kr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=VA.bind(null,Dt,t),[r.memoizedState,t]},useRef:function(t){var e=Kr();return t={current:t},e.memoizedState=t},useState:Ox,useDebugValue:wy,useDeferredValue:function(t){return Kr().memoizedState=t},useTransition:function(){var t=Ox(!1),e=t[0];return t=OA.bind(null,t[1]),Kr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Dt,s=Kr();if(Ct){if(n===void 0)throw Error(oe(407));n=n()}else{if(n=e(),cn===null)throw Error(oe(349));po&30||vI(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Vx(xI.bind(null,r,i,t),[t]),r.flags|=2048,Lc(9,_I.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Kr(),e=cn.identifierPrefix;if(Ct){var n=gs,r=ms;n=(r&~(1<<32-kr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=kc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=LA++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},UA={readContext:vr,useCallback:NI,useContext:vr,useEffect:by,useImperativeHandle:CI,useInsertionEffect:II,useLayoutEffect:SI,useMemo:jI,useReducer:wp,useRef:EI,useState:function(){return wp(Dc)},useDebugValue:wy,useDeferredValue:function(t){var e=_r();return AI(e,Zt.memoizedState,t)},useTransition:function(){var t=wp(Dc)[0],e=_r().memoizedState;return[t,e]},useMutableSource:gI,useSyncExternalStore:yI,useId:PI,unstable_isNewReconciler:!1},$A={readContext:vr,useCallback:NI,useContext:vr,useEffect:by,useImperativeHandle:CI,useInsertionEffect:II,useLayoutEffect:SI,useMemo:jI,useReducer:Ep,useRef:EI,useState:function(){return Ep(Dc)},useDebugValue:wy,useDeferredValue:function(t){var e=_r();return Zt===null?e.memoizedState=t:AI(e,Zt.memoizedState,t)},useTransition:function(){var t=Ep(Dc)[0],e=_r().memoizedState;return[t,e]},useMutableSource:gI,useSyncExternalStore:yI,useId:PI,unstable_isNewReconciler:!1};function Cr(t,e){if(t&&t.defaultProps){e=Lt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Um(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Lt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Kh={isMounted:function(t){return(t=t._reactInternals)?Do(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Dn(),s=hi(t),i=xs(r,s);i.payload=e,n!=null&&(i.callback=n),e=ui(t,i,s),e!==null&&(Dr(e,t,s,r),hd(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Dn(),s=hi(t),i=xs(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ui(t,i,s),e!==null&&(Dr(e,t,s,r),hd(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Dn(),r=hi(t),s=xs(n,r);s.tag=2,e!=null&&(s.callback=e),e=ui(t,s,r),e!==null&&(Dr(e,t,r,n),hd(e,t,r))}};function Mx(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Cc(n,r)||!Cc(s,i):!0}function LI(t,e,n){var r=!1,s=bi,i=e.contextType;return typeof i=="object"&&i!==null?i=vr(i):(s=Wn(e)?ho:Nn.current,r=e.contextTypes,i=(r=r!=null)?La(t,s):bi),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Kh,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Fx(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Kh.enqueueReplaceState(e,e.state,null)}function $m(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},py(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=vr(i):(i=Wn(e)?ho:Nn.current,s.context=La(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Um(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Kh.enqueueReplaceState(s,s.state,null),Zd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Fa(t,e){try{var n="",r=e;do n+=mj(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Ip(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Bm(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var BA=typeof WeakMap=="function"?WeakMap:Map;function OI(t,e,n){n=xs(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){sh||(sh=!0,Jm=r),Bm(t,e)},n}function VI(t,e,n){n=xs(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Bm(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Bm(t,e),typeof r!="function"&&(di===null?di=new Set([this]):di.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function Ux(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new BA;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=nP.bind(null,t,e,n),e.then(t,t))}function $x(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Bx(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=xs(-1,1),e.tag=2,ui(n,e,1))),n.lanes|=1),t)}var zA=Rs.ReactCurrentOwner,zn=!1;function Pn(t,e,n,r){e.child=t===null?hI(e,null,n,r):Va(e,t.child,n,r)}function zx(t,e,n,r,s){n=n.render;var i=e.ref;return Sa(e,s),r=_y(t,e,n,r,i,s),n=xy(),t!==null&&!zn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ss(t,e,s)):(Ct&&n&&ay(e),e.flags|=1,Pn(t,e,r,s),e.child)}function qx(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Ay(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,MI(t,e,i,r,s)):(t=vd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Cc,n(a,r)&&t.ref===e.ref)return Ss(t,e,s)}return e.flags|=1,t=fi(i,r),t.ref=e.ref,t.return=e,e.child=t}function MI(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Cc(i,r)&&t.ref===e.ref)if(zn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(zn=!0);else return e.lanes=t.lanes,Ss(t,e,s)}return zm(t,e,n,r,s)}function FI(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_t(_a,Zn),Zn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,_t(_a,Zn),Zn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,_t(_a,Zn),Zn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,_t(_a,Zn),Zn|=r;return Pn(t,e,s,n),e.child}function UI(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function zm(t,e,n,r,s){var i=Wn(n)?ho:Nn.current;return i=La(e,i),Sa(e,s),n=_y(t,e,n,r,i,s),r=xy(),t!==null&&!zn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ss(t,e,s)):(Ct&&r&&ay(e),e.flags|=1,Pn(t,e,n,s),e.child)}function Hx(t,e,n,r,s){if(Wn(n)){var i=!0;Kd(e)}else i=!1;if(Sa(e,s),e.stateNode===null)md(t,e),LI(e,n,r),$m(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=vr(d):(d=Wn(n)?ho:Nn.current,d=La(e,d));var h=n.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||c!==d)&&Fx(e,a,r,d),Gs=!1;var m=e.memoizedState;a.state=m,Zd(e,r,a,s),c=e.memoizedState,l!==r||m!==c||Hn.current||Gs?(typeof h=="function"&&(Um(e,n,h,r),c=e.memoizedState),(l=Gs||Mx(e,n,l,r,m,c,d))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),a.props=r,a.state=c,a.context=d,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,pI(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:Cr(e.type,l),a.props=d,f=e.pendingProps,m=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=vr(c):(c=Wn(n)?ho:Nn.current,c=La(e,c));var _=n.getDerivedStateFromProps;(h=typeof _=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==f||m!==c)&&Fx(e,a,r,c),Gs=!1,m=e.memoizedState,a.state=m,Zd(e,r,a,s);var C=e.memoizedState;l!==f||m!==C||Hn.current||Gs?(typeof _=="function"&&(Um(e,n,_,r),C=e.memoizedState),(d=Gs||Mx(e,n,d,r,m,C,c)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,C,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,C,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=C),a.props=r,a.state=C,a.context=c,r=d):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&m===t.memoizedState||(e.flags|=1024),r=!1)}return qm(t,e,n,r,i,s)}function qm(t,e,n,r,s,i){UI(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&Ax(e,n,!1),Ss(t,e,i);r=e.stateNode,zA.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Va(e,t.child,null,i),e.child=Va(e,null,l,i)):Pn(t,e,l,i),e.memoizedState=r.state,s&&Ax(e,n,!0),e.child}function $I(t){var e=t.stateNode;e.pendingContext?jx(t,e.pendingContext,e.pendingContext!==e.context):e.context&&jx(t,e.context,!1),my(t,e.containerInfo)}function Wx(t,e,n,r,s){return Oa(),cy(s),e.flags|=256,Pn(t,e,n,r),e.child}var Hm={dehydrated:null,treeContext:null,retryLane:0};function Wm(t){return{baseLanes:t,cachePool:null,transitions:null}}function BI(t,e,n){var r=e.pendingProps,s=Pt.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),_t(Pt,s&1),t===null)return Mm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Xh(a,r,0,null),t=so(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Wm(n),e.memoizedState=Hm,t):Ey(e,a));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return qA(t,e,a,r,l,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=fi(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=fi(l,i):(i=so(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?Wm(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=Hm,r}return i=t.child,t=i.sibling,r=fi(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Ey(t,e){return e=Xh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function zu(t,e,n,r){return r!==null&&cy(r),Va(e,t.child,null,n),t=Ey(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function qA(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=Ip(Error(oe(422))),zu(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Xh({mode:"visible",children:r.children},s,0,null),i=so(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Va(e,t.child,null,a),e.child.memoizedState=Wm(a),e.memoizedState=Hm,i);if(!(e.mode&1))return zu(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(oe(419)),r=Ip(i,r,void 0),zu(t,e,a,r)}if(l=(a&t.childLanes)!==0,zn||l){if(r=cn,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Is(t,s),Dr(r,t,s,-1))}return jy(),r=Ip(Error(oe(421))),zu(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=rP.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,tr=ci(s.nextSibling),rr=e,Ct=!0,Ar=null,t!==null&&(ur[dr++]=ms,ur[dr++]=gs,ur[dr++]=fo,ms=t.id,gs=t.overflow,fo=e),e=Ey(e,r.children),e.flags|=4096,e)}function Gx(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Fm(t.return,e,n)}function Sp(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function zI(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Pn(t,e,r.children,n),r=Pt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Gx(t,n,e);else if(t.tag===19)Gx(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(_t(Pt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&eh(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Sp(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&eh(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Sp(e,!0,n,null,i);break;case"together":Sp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function md(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ss(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),mo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(oe(153));if(e.child!==null){for(t=e.child,n=fi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=fi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function HA(t,e,n){switch(e.tag){case 3:$I(e),Oa();break;case 5:mI(e);break;case 1:Wn(e.type)&&Kd(e);break;case 4:my(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;_t(Xd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(_t(Pt,Pt.current&1),e.flags|=128,null):n&e.child.childLanes?BI(t,e,n):(_t(Pt,Pt.current&1),t=Ss(t,e,n),t!==null?t.sibling:null);_t(Pt,Pt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return zI(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),_t(Pt,Pt.current),r)break;return null;case 22:case 23:return e.lanes=0,FI(t,e,n)}return Ss(t,e,n)}var qI,Gm,HI,WI;qI=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Gm=function(){};HI=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,eo(ts.current);var i=null;switch(n){case"input":s=mm(t,s),r=mm(t,r),i=[];break;case"select":s=Lt({},s,{value:void 0}),r=Lt({},r,{value:void 0}),i=[];break;case"textarea":s=vm(t,s),r=vm(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Wd)}xm(n,r);var a;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(xc.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(xc.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Et("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};WI=function(t,e,n,r){n!==r&&(e.flags|=4)};function Al(t,e){if(!Ct)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function _n(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function WA(t,e,n){var r=e.pendingProps;switch(ly(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _n(e),null;case 1:return Wn(e.type)&&Gd(),_n(e),null;case 3:return r=e.stateNode,Ma(),It(Hn),It(Nn),yy(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&($u(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ar!==null&&(tg(Ar),Ar=null))),Gm(t,e),_n(e),null;case 5:gy(e);var s=eo(Rc.current);if(n=e.type,t!==null&&e.stateNode!=null)HI(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(oe(166));return _n(e),null}if(t=eo(ts.current),$u(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Yr]=e,r[Ac]=i,t=(e.mode&1)!==0,n){case"dialog":Et("cancel",r),Et("close",r);break;case"iframe":case"object":case"embed":Et("load",r);break;case"video":case"audio":for(s=0;s<Hl.length;s++)Et(Hl[s],r);break;case"source":Et("error",r);break;case"img":case"image":case"link":Et("error",r),Et("load",r);break;case"details":Et("toggle",r);break;case"input":nx(r,i),Et("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Et("invalid",r);break;case"textarea":sx(r,i),Et("invalid",r)}xm(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Uu(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Uu(r.textContent,l,t),s=["children",""+l]):xc.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&Et("scroll",r)}switch(n){case"input":Ru(r),rx(r,i,!0);break;case"textarea":Ru(r),ix(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Wd)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=xE(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Yr]=e,t[Ac]=r,qI(t,e,!1,!1),e.stateNode=t;e:{switch(a=bm(n,r),n){case"dialog":Et("cancel",t),Et("close",t),s=r;break;case"iframe":case"object":case"embed":Et("load",t),s=r;break;case"video":case"audio":for(s=0;s<Hl.length;s++)Et(Hl[s],t);s=r;break;case"source":Et("error",t),s=r;break;case"img":case"image":case"link":Et("error",t),Et("load",t),s=r;break;case"details":Et("toggle",t),s=r;break;case"input":nx(t,r),s=mm(t,r),Et("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Lt({},r,{value:void 0}),Et("invalid",t);break;case"textarea":sx(t,r),s=vm(t,r),Et("invalid",t);break;default:s=r}xm(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?EE(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&bE(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&bc(t,c):typeof c=="number"&&bc(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(xc.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Et("scroll",t):c!=null&&Gg(t,i,c,a))}switch(n){case"input":Ru(t),rx(t,r,!1);break;case"textarea":Ru(t),ix(t);break;case"option":r.value!=null&&t.setAttribute("value",""+xi(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ba(t,!!r.multiple,i,!1):r.defaultValue!=null&&ba(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Wd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return _n(e),null;case 6:if(t&&e.stateNode!=null)WI(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(oe(166));if(n=eo(Rc.current),eo(ts.current),$u(e)){if(r=e.stateNode,n=e.memoizedProps,r[Yr]=e,(i=r.nodeValue!==n)&&(t=rr,t!==null))switch(t.tag){case 3:Uu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Uu(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Yr]=e,e.stateNode=r}return _n(e),null;case 13:if(It(Pt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ct&&tr!==null&&e.mode&1&&!(e.flags&128))uI(),Oa(),e.flags|=98560,i=!1;else if(i=$u(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(oe(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(oe(317));i[Yr]=e}else Oa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;_n(e),i=!1}else Ar!==null&&(tg(Ar),Ar=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Pt.current&1?en===0&&(en=3):jy())),e.updateQueue!==null&&(e.flags|=4),_n(e),null);case 4:return Ma(),Gm(t,e),t===null&&Nc(e.stateNode.containerInfo),_n(e),null;case 10:return hy(e.type._context),_n(e),null;case 17:return Wn(e.type)&&Gd(),_n(e),null;case 19:if(It(Pt),i=e.memoizedState,i===null)return _n(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Al(i,!1);else{if(en!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=eh(t),a!==null){for(e.flags|=128,Al(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return _t(Pt,Pt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Wt()>Ua&&(e.flags|=128,r=!0,Al(i,!1),e.lanes=4194304)}else{if(!r)if(t=eh(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Al(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Ct)return _n(e),null}else 2*Wt()-i.renderingStartTime>Ua&&n!==1073741824&&(e.flags|=128,r=!0,Al(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Wt(),e.sibling=null,n=Pt.current,_t(Pt,r?n&1|2:n&1),e):(_n(e),null);case 22:case 23:return Ny(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Zn&1073741824&&(_n(e),e.subtreeFlags&6&&(e.flags|=8192)):_n(e),null;case 24:return null;case 25:return null}throw Error(oe(156,e.tag))}function GA(t,e){switch(ly(e),e.tag){case 1:return Wn(e.type)&&Gd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ma(),It(Hn),It(Nn),yy(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return gy(e),null;case 13:if(It(Pt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(oe(340));Oa()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return It(Pt),null;case 4:return Ma(),null;case 10:return hy(e.type._context),null;case 22:case 23:return Ny(),null;case 24:return null;default:return null}}var qu=!1,wn=!1,KA=typeof WeakSet=="function"?WeakSet:Set,we=null;function va(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Mt(t,e,r)}else n.current=null}function Km(t,e,n){try{n()}catch(r){Mt(t,e,r)}}var Kx=!1;function QA(t,e){if(Pm=zd,t=XE(),oy(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,d=0,h=0,f=t,m=null;t:for(;;){for(var _;f!==n||s!==0&&f.nodeType!==3||(l=a+s),f!==i||r!==0&&f.nodeType!==3||(c=a+r),f.nodeType===3&&(a+=f.nodeValue.length),(_=f.firstChild)!==null;)m=f,f=_;for(;;){if(f===t)break t;if(m===n&&++d===s&&(l=a),m===i&&++h===r&&(c=a),(_=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=_}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Rm={focusedElem:t,selectionRange:n},zd=!1,we=e;we!==null;)if(e=we,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,we=t;else for(;we!==null;){e=we;try{var C=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var N=C.memoizedProps,A=C.memoizedState,T=e.stateNode,I=T.getSnapshotBeforeUpdate(e.elementType===e.type?N:Cr(e.type,N),A);T.__reactInternalSnapshotBeforeUpdate=I}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(w){Mt(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,we=t;break}we=e.return}return C=Kx,Kx=!1,C}function ac(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Km(e,n,i)}s=s.next}while(s!==r)}}function Qh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Qm(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function GI(t){var e=t.alternate;e!==null&&(t.alternate=null,GI(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Yr],delete e[Ac],delete e[Lm],delete e[PA],delete e[RA])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function KI(t){return t.tag===5||t.tag===3||t.tag===4}function Qx(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||KI(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ym(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Wd));else if(r!==4&&(t=t.child,t!==null))for(Ym(t,e,n),t=t.sibling;t!==null;)Ym(t,e,n),t=t.sibling}function Xm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Xm(t,e,n),t=t.sibling;t!==null;)Xm(t,e,n),t=t.sibling}var dn=null,Nr=!1;function Us(t,e,n){for(n=n.child;n!==null;)QI(t,e,n),n=n.sibling}function QI(t,e,n){if(es&&typeof es.onCommitFiberUnmount=="function")try{es.onCommitFiberUnmount($h,n)}catch{}switch(n.tag){case 5:wn||va(n,e);case 6:var r=dn,s=Nr;dn=null,Us(t,e,n),dn=r,Nr=s,dn!==null&&(Nr?(t=dn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):dn.removeChild(n.stateNode));break;case 18:dn!==null&&(Nr?(t=dn,n=n.stateNode,t.nodeType===8?vp(t.parentNode,n):t.nodeType===1&&vp(t,n),Sc(t)):vp(dn,n.stateNode));break;case 4:r=dn,s=Nr,dn=n.stateNode.containerInfo,Nr=!0,Us(t,e,n),dn=r,Nr=s;break;case 0:case 11:case 14:case 15:if(!wn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Km(n,e,a),s=s.next}while(s!==r)}Us(t,e,n);break;case 1:if(!wn&&(va(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){Mt(n,e,l)}Us(t,e,n);break;case 21:Us(t,e,n);break;case 22:n.mode&1?(wn=(r=wn)||n.memoizedState!==null,Us(t,e,n),wn=r):Us(t,e,n);break;default:Us(t,e,n)}}function Yx(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new KA),e.forEach(function(r){var s=sP.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Sr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:dn=l.stateNode,Nr=!1;break e;case 3:dn=l.stateNode.containerInfo,Nr=!0;break e;case 4:dn=l.stateNode.containerInfo,Nr=!0;break e}l=l.return}if(dn===null)throw Error(oe(160));QI(i,a,s),dn=null,Nr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){Mt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)YI(e,t),e=e.sibling}function YI(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Sr(e,t),Hr(t),r&4){try{ac(3,t,t.return),Qh(3,t)}catch(N){Mt(t,t.return,N)}try{ac(5,t,t.return)}catch(N){Mt(t,t.return,N)}}break;case 1:Sr(e,t),Hr(t),r&512&&n!==null&&va(n,n.return);break;case 5:if(Sr(e,t),Hr(t),r&512&&n!==null&&va(n,n.return),t.flags&32){var s=t.stateNode;try{bc(s,"")}catch(N){Mt(t,t.return,N)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&vE(s,i),bm(l,a);var d=bm(l,i);for(a=0;a<c.length;a+=2){var h=c[a],f=c[a+1];h==="style"?EE(s,f):h==="dangerouslySetInnerHTML"?bE(s,f):h==="children"?bc(s,f):Gg(s,h,f,d)}switch(l){case"input":gm(s,i);break;case"textarea":_E(s,i);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var _=i.value;_!=null?ba(s,!!i.multiple,_,!1):m!==!!i.multiple&&(i.defaultValue!=null?ba(s,!!i.multiple,i.defaultValue,!0):ba(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ac]=i}catch(N){Mt(t,t.return,N)}}break;case 6:if(Sr(e,t),Hr(t),r&4){if(t.stateNode===null)throw Error(oe(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(N){Mt(t,t.return,N)}}break;case 3:if(Sr(e,t),Hr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Sc(e.containerInfo)}catch(N){Mt(t,t.return,N)}break;case 4:Sr(e,t),Hr(t);break;case 13:Sr(e,t),Hr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Ty=Wt())),r&4&&Yx(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(wn=(d=wn)||h,Sr(e,t),wn=d):Sr(e,t),Hr(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!h&&t.mode&1)for(we=t,h=t.child;h!==null;){for(f=we=h;we!==null;){switch(m=we,_=m.child,m.tag){case 0:case 11:case 14:case 15:ac(4,m,m.return);break;case 1:va(m,m.return);var C=m.stateNode;if(typeof C.componentWillUnmount=="function"){r=m,n=m.return;try{e=r,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(N){Mt(r,n,N)}}break;case 5:va(m,m.return);break;case 22:if(m.memoizedState!==null){Jx(f);continue}}_!==null?(_.return=m,we=_):Jx(f)}h=h.sibling}e:for(h=null,f=t;;){if(f.tag===5){if(h===null){h=f;try{s=f.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=f.stateNode,c=f.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=wE("display",a))}catch(N){Mt(t,t.return,N)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(N){Mt(t,t.return,N)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Sr(e,t),Hr(t),r&4&&Yx(t);break;case 21:break;default:Sr(e,t),Hr(t)}}function Hr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(KI(n)){var r=n;break e}n=n.return}throw Error(oe(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(bc(s,""),r.flags&=-33);var i=Qx(t);Xm(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=Qx(t);Ym(t,l,a);break;default:throw Error(oe(161))}}catch(c){Mt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function YA(t,e,n){we=t,XI(t)}function XI(t,e,n){for(var r=(t.mode&1)!==0;we!==null;){var s=we,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||qu;if(!a){var l=s.alternate,c=l!==null&&l.memoizedState!==null||wn;l=qu;var d=wn;if(qu=a,(wn=c)&&!d)for(we=s;we!==null;)a=we,c=a.child,a.tag===22&&a.memoizedState!==null?Zx(s):c!==null?(c.return=a,we=c):Zx(s);for(;i!==null;)we=i,XI(i),i=i.sibling;we=s,qu=l,wn=d}Xx(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,we=i):Xx(t)}}function Xx(t){for(;we!==null;){var e=we;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:wn||Qh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!wn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Cr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Lx(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Lx(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&Sc(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oe(163))}wn||e.flags&512&&Qm(e)}catch(m){Mt(e,e.return,m)}}if(e===t){we=null;break}if(n=e.sibling,n!==null){n.return=e.return,we=n;break}we=e.return}}function Jx(t){for(;we!==null;){var e=we;if(e===t){we=null;break}var n=e.sibling;if(n!==null){n.return=e.return,we=n;break}we=e.return}}function Zx(t){for(;we!==null;){var e=we;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Qh(4,e)}catch(c){Mt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){Mt(e,s,c)}}var i=e.return;try{Qm(e)}catch(c){Mt(e,i,c)}break;case 5:var a=e.return;try{Qm(e)}catch(c){Mt(e,a,c)}}}catch(c){Mt(e,e.return,c)}if(e===t){we=null;break}var l=e.sibling;if(l!==null){l.return=e.return,we=l;break}we=e.return}}var XA=Math.ceil,rh=Rs.ReactCurrentDispatcher,Iy=Rs.ReactCurrentOwner,gr=Rs.ReactCurrentBatchConfig,ot=0,cn=null,Qt=null,pn=0,Zn=0,_a=Ni(0),en=0,Oc=null,mo=0,Yh=0,Sy=0,lc=null,Bn=null,Ty=0,Ua=1/0,fs=null,sh=!1,Jm=null,di=null,Hu=!1,si=null,ih=0,cc=0,Zm=null,gd=-1,yd=0;function Dn(){return ot&6?Wt():gd!==-1?gd:gd=Wt()}function hi(t){return t.mode&1?ot&2&&pn!==0?pn&-pn:DA.transition!==null?(yd===0&&(yd=LE()),yd):(t=ht,t!==0||(t=window.event,t=t===void 0?16:BE(t.type)),t):1}function Dr(t,e,n,r){if(50<cc)throw cc=0,Zm=null,Error(oe(185));Zc(t,n,r),(!(ot&2)||t!==cn)&&(t===cn&&(!(ot&2)&&(Yh|=n),en===4&&Qs(t,pn)),Gn(t,r),n===1&&ot===0&&!(e.mode&1)&&(Ua=Wt()+500,Wh&&ji()))}function Gn(t,e){var n=t.callbackNode;Dj(t,e);var r=Bd(t,t===cn?pn:0);if(r===0)n!==null&&lx(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&lx(n),e===1)t.tag===0?kA(eb.bind(null,t)):aI(eb.bind(null,t)),jA(function(){!(ot&6)&&ji()}),n=null;else{switch(OE(r)){case 1:n=Jg;break;case 4:n=kE;break;case 16:n=$d;break;case 536870912:n=DE;break;default:n=$d}n=iS(n,JI.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function JI(t,e){if(gd=-1,yd=0,ot&6)throw Error(oe(327));var n=t.callbackNode;if(Ta()&&t.callbackNode!==n)return null;var r=Bd(t,t===cn?pn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=oh(t,r);else{e=r;var s=ot;ot|=2;var i=eS();(cn!==t||pn!==e)&&(fs=null,Ua=Wt()+500,ro(t,e));do try{eP();break}catch(l){ZI(t,l)}while(!0);dy(),rh.current=i,ot=s,Qt!==null?e=0:(cn=null,pn=0,e=en)}if(e!==0){if(e===2&&(s=Tm(t),s!==0&&(r=s,e=eg(t,s))),e===1)throw n=Oc,ro(t,0),Qs(t,r),Gn(t,Wt()),n;if(e===6)Qs(t,r);else{if(s=t.current.alternate,!(r&30)&&!JA(s)&&(e=oh(t,r),e===2&&(i=Tm(t),i!==0&&(r=i,e=eg(t,i))),e===1))throw n=Oc,ro(t,0),Qs(t,r),Gn(t,Wt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(oe(345));case 2:zi(t,Bn,fs);break;case 3:if(Qs(t,r),(r&130023424)===r&&(e=Ty+500-Wt(),10<e)){if(Bd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Dn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Dm(zi.bind(null,t,Bn,fs),e);break}zi(t,Bn,fs);break;case 4:if(Qs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-kr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Wt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*XA(r/1960))-r,10<r){t.timeoutHandle=Dm(zi.bind(null,t,Bn,fs),r);break}zi(t,Bn,fs);break;case 5:zi(t,Bn,fs);break;default:throw Error(oe(329))}}}return Gn(t,Wt()),t.callbackNode===n?JI.bind(null,t):null}function eg(t,e){var n=lc;return t.current.memoizedState.isDehydrated&&(ro(t,e).flags|=256),t=oh(t,e),t!==2&&(e=Bn,Bn=n,e!==null&&tg(e)),t}function tg(t){Bn===null?Bn=t:Bn.push.apply(Bn,t)}function JA(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Or(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Qs(t,e){for(e&=~Sy,e&=~Yh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-kr(e),r=1<<n;t[n]=-1,e&=~r}}function eb(t){if(ot&6)throw Error(oe(327));Ta();var e=Bd(t,0);if(!(e&1))return Gn(t,Wt()),null;var n=oh(t,e);if(t.tag!==0&&n===2){var r=Tm(t);r!==0&&(e=r,n=eg(t,r))}if(n===1)throw n=Oc,ro(t,0),Qs(t,e),Gn(t,Wt()),n;if(n===6)throw Error(oe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,zi(t,Bn,fs),Gn(t,Wt()),null}function Cy(t,e){var n=ot;ot|=1;try{return t(e)}finally{ot=n,ot===0&&(Ua=Wt()+500,Wh&&ji())}}function go(t){si!==null&&si.tag===0&&!(ot&6)&&Ta();var e=ot;ot|=1;var n=gr.transition,r=ht;try{if(gr.transition=null,ht=1,t)return t()}finally{ht=r,gr.transition=n,ot=e,!(ot&6)&&ji()}}function Ny(){Zn=_a.current,It(_a)}function ro(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,NA(n)),Qt!==null)for(n=Qt.return;n!==null;){var r=n;switch(ly(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Gd();break;case 3:Ma(),It(Hn),It(Nn),yy();break;case 5:gy(r);break;case 4:Ma();break;case 13:It(Pt);break;case 19:It(Pt);break;case 10:hy(r.type._context);break;case 22:case 23:Ny()}n=n.return}if(cn=t,Qt=t=fi(t.current,null),pn=Zn=e,en=0,Oc=null,Sy=Yh=mo=0,Bn=lc=null,Zi!==null){for(e=0;e<Zi.length;e++)if(n=Zi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}Zi=null}return t}function ZI(t,e){do{var n=Qt;try{if(dy(),fd.current=nh,th){for(var r=Dt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}th=!1}if(po=0,an=Zt=Dt=null,oc=!1,kc=0,Iy.current=null,n===null||n.return===null){en=1,Oc=e,Qt=null;break}e:{var i=t,a=n.return,l=n,c=e;if(e=pn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var _=$x(a);if(_!==null){_.flags&=-257,Bx(_,a,l,i,e),_.mode&1&&Ux(i,d,e),e=_,c=d;var C=e.updateQueue;if(C===null){var N=new Set;N.add(c),e.updateQueue=N}else C.add(c);break e}else{if(!(e&1)){Ux(i,d,e),jy();break e}c=Error(oe(426))}}else if(Ct&&l.mode&1){var A=$x(a);if(A!==null){!(A.flags&65536)&&(A.flags|=256),Bx(A,a,l,i,e),cy(Fa(c,l));break e}}i=c=Fa(c,l),en!==4&&(en=2),lc===null?lc=[i]:lc.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var T=OI(i,c,e);Dx(i,T);break e;case 1:l=c;var I=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof I.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(di===null||!di.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var w=VI(i,l,e);Dx(i,w);break e}}i=i.return}while(i!==null)}nS(n)}catch(S){e=S,Qt===n&&n!==null&&(Qt=n=n.return);continue}break}while(!0)}function eS(){var t=rh.current;return rh.current=nh,t===null?nh:t}function jy(){(en===0||en===3||en===2)&&(en=4),cn===null||!(mo&268435455)&&!(Yh&268435455)||Qs(cn,pn)}function oh(t,e){var n=ot;ot|=2;var r=eS();(cn!==t||pn!==e)&&(fs=null,ro(t,e));do try{ZA();break}catch(s){ZI(t,s)}while(!0);if(dy(),ot=n,rh.current=r,Qt!==null)throw Error(oe(261));return cn=null,pn=0,en}function ZA(){for(;Qt!==null;)tS(Qt)}function eP(){for(;Qt!==null&&!Sj();)tS(Qt)}function tS(t){var e=sS(t.alternate,t,Zn);t.memoizedProps=t.pendingProps,e===null?nS(t):Qt=e,Iy.current=null}function nS(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=GA(n,e),n!==null){n.flags&=32767,Qt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{en=6,Qt=null;return}}else if(n=WA(n,e,Zn),n!==null){Qt=n;return}if(e=e.sibling,e!==null){Qt=e;return}Qt=e=t}while(e!==null);en===0&&(en=5)}function zi(t,e,n){var r=ht,s=gr.transition;try{gr.transition=null,ht=1,tP(t,e,n,r)}finally{gr.transition=s,ht=r}return null}function tP(t,e,n,r){do Ta();while(si!==null);if(ot&6)throw Error(oe(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(oe(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(Lj(t,i),t===cn&&(Qt=cn=null,pn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Hu||(Hu=!0,iS($d,function(){return Ta(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=gr.transition,gr.transition=null;var a=ht;ht=1;var l=ot;ot|=4,Iy.current=null,QA(t,n),YI(n,t),bA(Rm),zd=!!Pm,Rm=Pm=null,t.current=n,YA(n),Tj(),ot=l,ht=a,gr.transition=i}else t.current=n;if(Hu&&(Hu=!1,si=t,ih=s),i=t.pendingLanes,i===0&&(di=null),jj(n.stateNode),Gn(t,Wt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(sh)throw sh=!1,t=Jm,Jm=null,t;return ih&1&&t.tag!==0&&Ta(),i=t.pendingLanes,i&1?t===Zm?cc++:(cc=0,Zm=t):cc=0,ji(),null}function Ta(){if(si!==null){var t=OE(ih),e=gr.transition,n=ht;try{if(gr.transition=null,ht=16>t?16:t,si===null)var r=!1;else{if(t=si,si=null,ih=0,ot&6)throw Error(oe(331));var s=ot;for(ot|=4,we=t.current;we!==null;){var i=we,a=i.child;if(we.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(we=d;we!==null;){var h=we;switch(h.tag){case 0:case 11:case 15:ac(8,h,i)}var f=h.child;if(f!==null)f.return=h,we=f;else for(;we!==null;){h=we;var m=h.sibling,_=h.return;if(GI(h),h===d){we=null;break}if(m!==null){m.return=_,we=m;break}we=_}}}var C=i.alternate;if(C!==null){var N=C.child;if(N!==null){C.child=null;do{var A=N.sibling;N.sibling=null,N=A}while(N!==null)}}we=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,we=a;else e:for(;we!==null;){if(i=we,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ac(9,i,i.return)}var T=i.sibling;if(T!==null){T.return=i.return,we=T;break e}we=i.return}}var I=t.current;for(we=I;we!==null;){a=we;var E=a.child;if(a.subtreeFlags&2064&&E!==null)E.return=a,we=E;else e:for(a=I;we!==null;){if(l=we,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Qh(9,l)}}catch(S){Mt(l,l.return,S)}if(l===a){we=null;break e}var w=l.sibling;if(w!==null){w.return=l.return,we=w;break e}we=l.return}}if(ot=s,ji(),es&&typeof es.onPostCommitFiberRoot=="function")try{es.onPostCommitFiberRoot($h,t)}catch{}r=!0}return r}finally{ht=n,gr.transition=e}}return!1}function tb(t,e,n){e=Fa(n,e),e=OI(t,e,1),t=ui(t,e,1),e=Dn(),t!==null&&(Zc(t,1,e),Gn(t,e))}function Mt(t,e,n){if(t.tag===3)tb(t,t,n);else for(;e!==null;){if(e.tag===3){tb(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(di===null||!di.has(r))){t=Fa(n,t),t=VI(e,t,1),e=ui(e,t,1),t=Dn(),e!==null&&(Zc(e,1,t),Gn(e,t));break}}e=e.return}}function nP(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Dn(),t.pingedLanes|=t.suspendedLanes&n,cn===t&&(pn&n)===n&&(en===4||en===3&&(pn&130023424)===pn&&500>Wt()-Ty?ro(t,0):Sy|=n),Gn(t,e)}function rS(t,e){e===0&&(t.mode&1?(e=Lu,Lu<<=1,!(Lu&130023424)&&(Lu=4194304)):e=1);var n=Dn();t=Is(t,e),t!==null&&(Zc(t,e,n),Gn(t,n))}function rP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),rS(t,n)}function sP(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(oe(314))}r!==null&&r.delete(e),rS(t,n)}var sS;sS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Hn.current)zn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return zn=!1,HA(t,e,n);zn=!!(t.flags&131072)}else zn=!1,Ct&&e.flags&1048576&&lI(e,Yd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;md(t,e),t=e.pendingProps;var s=La(e,Nn.current);Sa(e,n),s=_y(null,e,r,t,s,n);var i=xy();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Wn(r)?(i=!0,Kd(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,py(e),s.updater=Kh,e.stateNode=s,s._reactInternals=e,$m(e,r,t,n),e=qm(null,e,r,!0,i,n)):(e.tag=0,Ct&&i&&ay(e),Pn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(md(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=oP(r),t=Cr(r,t),s){case 0:e=zm(null,e,r,t,n);break e;case 1:e=Hx(null,e,r,t,n);break e;case 11:e=zx(null,e,r,t,n);break e;case 14:e=qx(null,e,r,Cr(r.type,t),n);break e}throw Error(oe(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cr(r,s),zm(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cr(r,s),Hx(t,e,r,s,n);case 3:e:{if($I(e),t===null)throw Error(oe(387));r=e.pendingProps,i=e.memoizedState,s=i.element,pI(t,e),Zd(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Fa(Error(oe(423)),e),e=Wx(t,e,r,n,s);break e}else if(r!==s){s=Fa(Error(oe(424)),e),e=Wx(t,e,r,n,s);break e}else for(tr=ci(e.stateNode.containerInfo.firstChild),rr=e,Ct=!0,Ar=null,n=hI(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Oa(),r===s){e=Ss(t,e,n);break e}Pn(t,e,r,n)}e=e.child}return e;case 5:return mI(e),t===null&&Mm(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,km(r,s)?a=null:i!==null&&km(r,i)&&(e.flags|=32),UI(t,e),Pn(t,e,a,n),e.child;case 6:return t===null&&Mm(e),null;case 13:return BI(t,e,n);case 4:return my(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Va(e,null,r,n):Pn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cr(r,s),zx(t,e,r,s,n);case 7:return Pn(t,e,e.pendingProps,n),e.child;case 8:return Pn(t,e,e.pendingProps.children,n),e.child;case 12:return Pn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,_t(Xd,r._currentValue),r._currentValue=a,i!==null)if(Or(i.value,a)){if(i.children===s.children&&!Hn.current){e=Ss(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=xs(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Fm(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(oe(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),Fm(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Pn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Sa(e,n),s=vr(s),r=r(s),e.flags|=1,Pn(t,e,r,n),e.child;case 14:return r=e.type,s=Cr(r,e.pendingProps),s=Cr(r.type,s),qx(t,e,r,s,n);case 15:return MI(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cr(r,s),md(t,e),e.tag=1,Wn(r)?(t=!0,Kd(e)):t=!1,Sa(e,n),LI(e,r,s),$m(e,r,s,n),qm(null,e,r,!0,t,n);case 19:return zI(t,e,n);case 22:return FI(t,e,n)}throw Error(oe(156,e.tag))};function iS(t,e){return RE(t,e)}function iP(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pr(t,e,n,r){return new iP(t,e,n,r)}function Ay(t){return t=t.prototype,!(!t||!t.isReactComponent)}function oP(t){if(typeof t=="function")return Ay(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Qg)return 11;if(t===Yg)return 14}return 2}function fi(t,e){var n=t.alternate;return n===null?(n=pr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function vd(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")Ay(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case ca:return so(n.children,s,i,e);case Kg:a=8,s|=8;break;case dm:return t=pr(12,n,e,s|2),t.elementType=dm,t.lanes=i,t;case hm:return t=pr(13,n,e,s),t.elementType=hm,t.lanes=i,t;case fm:return t=pr(19,n,e,s),t.elementType=fm,t.lanes=i,t;case mE:return Xh(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case fE:a=10;break e;case pE:a=9;break e;case Qg:a=11;break e;case Yg:a=14;break e;case Ws:a=16,r=null;break e}throw Error(oe(130,t==null?t:typeof t,""))}return e=pr(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function so(t,e,n,r){return t=pr(7,t,r,e),t.lanes=n,t}function Xh(t,e,n,r){return t=pr(22,t,r,e),t.elementType=mE,t.lanes=n,t.stateNode={isHidden:!1},t}function Tp(t,e,n){return t=pr(6,t,null,e),t.lanes=n,t}function Cp(t,e,n){return e=pr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function aP(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ap(0),this.expirationTimes=ap(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ap(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Py(t,e,n,r,s,i,a,l,c){return t=new aP(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=pr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},py(i),t}function lP(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:la,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function oS(t){if(!t)return bi;t=t._reactInternals;e:{if(Do(t)!==t||t.tag!==1)throw Error(oe(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Wn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(oe(171))}if(t.tag===1){var n=t.type;if(Wn(n))return oI(t,n,e)}return e}function aS(t,e,n,r,s,i,a,l,c){return t=Py(n,r,!0,t,s,i,a,l,c),t.context=oS(null),n=t.current,r=Dn(),s=hi(n),i=xs(r,s),i.callback=e??null,ui(n,i,s),t.current.lanes=s,Zc(t,s,r),Gn(t,r),t}function Jh(t,e,n,r){var s=e.current,i=Dn(),a=hi(s);return n=oS(n),e.context===null?e.context=n:e.pendingContext=n,e=xs(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ui(s,e,a),t!==null&&(Dr(t,s,a,i),hd(t,s,a)),a}function ah(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function nb(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ry(t,e){nb(t,e),(t=t.alternate)&&nb(t,e)}function cP(){return null}var lS=typeof reportError=="function"?reportError:function(t){console.error(t)};function ky(t){this._internalRoot=t}Zh.prototype.render=ky.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(oe(409));Jh(t,e,null,null)};Zh.prototype.unmount=ky.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;go(function(){Jh(null,t,null,null)}),e[Es]=null}};function Zh(t){this._internalRoot=t}Zh.prototype.unstable_scheduleHydration=function(t){if(t){var e=FE();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ks.length&&e!==0&&e<Ks[n].priority;n++);Ks.splice(n,0,t),n===0&&$E(t)}};function Dy(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ef(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function rb(){}function uP(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=ah(a);i.call(d)}}var a=aS(e,r,t,0,null,!1,!1,"",rb);return t._reactRootContainer=a,t[Es]=a.current,Nc(t.nodeType===8?t.parentNode:t),go(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=ah(c);l.call(d)}}var c=Py(t,0,!1,null,null,!1,!1,"",rb);return t._reactRootContainer=c,t[Es]=c.current,Nc(t.nodeType===8?t.parentNode:t),go(function(){Jh(e,c,n,r)}),c}function tf(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var c=ah(a);l.call(c)}}Jh(e,a,t,s)}else a=uP(n,e,t,s,r);return ah(a)}VE=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ql(e.pendingLanes);n!==0&&(Zg(e,n|1),Gn(e,Wt()),!(ot&6)&&(Ua=Wt()+500,ji()))}break;case 13:go(function(){var r=Is(t,1);if(r!==null){var s=Dn();Dr(r,t,1,s)}}),Ry(t,1)}};ey=function(t){if(t.tag===13){var e=Is(t,134217728);if(e!==null){var n=Dn();Dr(e,t,134217728,n)}Ry(t,134217728)}};ME=function(t){if(t.tag===13){var e=hi(t),n=Is(t,e);if(n!==null){var r=Dn();Dr(n,t,e,r)}Ry(t,e)}};FE=function(){return ht};UE=function(t,e){var n=ht;try{return ht=t,e()}finally{ht=n}};Em=function(t,e,n){switch(e){case"input":if(gm(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Hh(r);if(!s)throw Error(oe(90));yE(r),gm(r,s)}}}break;case"textarea":_E(t,n);break;case"select":e=n.value,e!=null&&ba(t,!!n.multiple,e,!1)}};TE=Cy;CE=go;var dP={usingClientEntryPoint:!1,Events:[tu,fa,Hh,IE,SE,Cy]},Pl={findFiberByHostInstance:Ji,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hP={bundleType:Pl.bundleType,version:Pl.version,rendererPackageName:Pl.rendererPackageName,rendererConfig:Pl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Rs.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=AE(t),t===null?null:t.stateNode},findFiberByHostInstance:Pl.findFiberByHostInstance||cP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wu.isDisabled&&Wu.supportsFiber)try{$h=Wu.inject(hP),es=Wu}catch{}}ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dP;ar.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Dy(e))throw Error(oe(200));return lP(t,e,null,n)};ar.createRoot=function(t,e){if(!Dy(t))throw Error(oe(299));var n=!1,r="",s=lS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Py(t,1,!1,null,null,n,!1,r,s),t[Es]=e.current,Nc(t.nodeType===8?t.parentNode:t),new ky(e)};ar.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(oe(188)):(t=Object.keys(t).join(","),Error(oe(268,t)));return t=AE(e),t=t===null?null:t.stateNode,t};ar.flushSync=function(t){return go(t)};ar.hydrate=function(t,e,n){if(!ef(e))throw Error(oe(200));return tf(null,t,e,!0,n)};ar.hydrateRoot=function(t,e,n){if(!Dy(t))throw Error(oe(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=lS;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=aS(e,null,t,1,n??null,s,!1,i,a),t[Es]=e.current,Nc(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Zh(e)};ar.render=function(t,e,n){if(!ef(e))throw Error(oe(200));return tf(null,t,e,!1,n)};ar.unmountComponentAtNode=function(t){if(!ef(t))throw Error(oe(40));return t._reactRootContainer?(go(function(){tf(null,null,t,!1,function(){t._reactRootContainer=null,t[Es]=null})}),!0):!1};ar.unstable_batchedUpdates=Cy;ar.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!ef(n))throw Error(oe(200));if(t==null||t._reactInternals===void 0)throw Error(oe(38));return tf(t,e,n,!1,r)};ar.version="18.3.1-next-f1338f8080-20240426";function cS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(cS)}catch(t){console.error(t)}}cS(),cE.exports=ar;var fP=cE.exports,uS,sb=fP;uS=sb.createRoot,sb.hydrateRoot;/**
 * react-router v7.9.6
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var ib="popstate";function pP(t={}){function e(r,s){let{pathname:i,search:a,hash:l}=r.location;return ng("",{pathname:i,search:a,hash:l},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:Vc(s)}return gP(e,n,null,t)}function Nt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function xr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function mP(){return Math.random().toString(36).substring(2,10)}function ob(t,e){return{usr:t.state,key:t.key,idx:e}}function ng(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?sl(e):e,state:n,key:e&&e.key||r||mP()}}function Vc({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function sl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function gP(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,l="POP",c=null,d=h();d==null&&(d=0,a.replaceState({...a.state,idx:d},""));function h(){return(a.state||{idx:null}).idx}function f(){l="POP";let A=h(),T=A==null?null:A-d;d=A,c&&c({action:l,location:N.location,delta:T})}function m(A,T){l="PUSH";let I=ng(N.location,A,T);d=h()+1;let E=ob(I,d),w=N.createHref(I);try{a.pushState(E,"",w)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;s.location.assign(w)}i&&c&&c({action:l,location:N.location,delta:1})}function _(A,T){l="REPLACE";let I=ng(N.location,A,T);d=h();let E=ob(I,d),w=N.createHref(I);a.replaceState(E,"",w),i&&c&&c({action:l,location:N.location,delta:0})}function C(A){return yP(A)}let N={get action(){return l},get location(){return t(s,a)},listen(A){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(ib,f),c=A,()=>{s.removeEventListener(ib,f),c=null}},createHref(A){return e(s,A)},createURL:C,encodeLocation(A){let T=C(A);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:m,replace:_,go(A){return a.go(A)}};return N}function yP(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Nt(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Vc(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function dS(t,e,n="/"){return vP(t,e,n,!1)}function vP(t,e,n,r){let s=typeof e=="string"?sl(e):e,i=Ts(s.pathname||"/",n);if(i==null)return null;let a=hS(t);_P(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let d=AP(i);l=NP(a[c],d,r)}return l}function hS(t,e=[],n=[],r="",s=!1){let i=(a,l,c=s,d)=>{let h={relativePath:d===void 0?a.path||"":d,caseSensitive:a.caseSensitive===!0,childrenIndex:l,route:a};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(r)&&c)return;Nt(h.relativePath.startsWith(r),`Absolute route path "${h.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(r.length)}let f=bs([r,h.relativePath]),m=n.concat(h);a.children&&a.children.length>0&&(Nt(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),hS(a.children,e,m,f,c)),!(a.path==null&&!a.index)&&e.push({path:f,score:TP(f,a.index),routesMeta:m})};return t.forEach((a,l)=>{var c;if(a.path===""||!((c=a.path)!=null&&c.includes("?")))i(a,l);else for(let d of fS(a.path))i(a,l,!0,d)}),e}function fS(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let a=fS(r.join("/")),l=[];return l.push(...a.map(c=>c===""?i:[i,c].join("/"))),s&&l.push(...a),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function _P(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:CP(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var xP=/^:[\w-]+$/,bP=3,wP=2,EP=1,IP=10,SP=-2,ab=t=>t==="*";function TP(t,e){let n=t.split("/"),r=n.length;return n.some(ab)&&(r+=SP),e&&(r+=wP),n.filter(s=>!ab(s)).reduce((s,i)=>s+(xP.test(i)?bP:i===""?EP:IP),r)}function CP(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function NP(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",a=[];for(let l=0;l<r.length;++l){let c=r[l],d=l===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",f=lh({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},h),m=c.route;if(!f&&d&&n&&!r[r.length-1].route.index&&(f=lh({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!f)return null;Object.assign(s,f.params),a.push({params:s,pathname:bs([i,f.pathname]),pathnameBase:LP(bs([i,f.pathnameBase])),route:m}),f.pathnameBase!=="/"&&(i=bs([i,f.pathnameBase]))}return a}function lh(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=jP(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((d,{paramName:h,isOptional:f},m)=>{if(h==="*"){let C=l[m]||"";a=i.slice(0,i.length-C.length).replace(/(.)\/+$/,"$1")}const _=l[m];return f&&!_?d[h]=void 0:d[h]=(_||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:a,pattern:t}}function jP(t,e=!1,n=!0){xr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(r.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function AP(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return xr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Ts(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var PP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,RP=t=>PP.test(t);function kP(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?sl(t):t,i;if(n)if(RP(n))i=n;else{if(n.includes("//")){let a=n;n=n.replace(/\/\/+/g,"/"),xr(!1,`Pathnames cannot have embedded double slashes - normalizing ${a} -> ${n}`)}n.startsWith("/")?i=lb(n.substring(1),"/"):i=lb(n,e)}else i=e;return{pathname:i,search:OP(r),hash:VP(s)}}function lb(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Np(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function DP(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Ly(t){let e=DP(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Oy(t,e,n,r=!1){let s;typeof t=="string"?s=sl(t):(s={...t},Nt(!s.pathname||!s.pathname.includes("?"),Np("?","pathname","search",s)),Nt(!s.pathname||!s.pathname.includes("#"),Np("#","pathname","hash",s)),Nt(!s.search||!s.search.includes("#"),Np("#","search","hash",s)));let i=t===""||s.pathname==="",a=i?"/":s.pathname,l;if(a==null)l=n;else{let f=e.length-1;if(!r&&a.startsWith("..")){let m=a.split("/");for(;m[0]==="..";)m.shift(),f-=1;s.pathname=m.join("/")}l=f>=0?e[f]:"/"}let c=kP(s,l),d=a&&a!=="/"&&a.endsWith("/"),h=(i||a===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||h)&&(c.pathname+="/"),c}var bs=t=>t.join("/").replace(/\/\/+/g,"/"),LP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),OP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,VP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function MP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var pS=["POST","PUT","PATCH","DELETE"];new Set(pS);var FP=["GET",...pS];new Set(FP);var il=x.createContext(null);il.displayName="DataRouter";var nf=x.createContext(null);nf.displayName="DataRouterState";x.createContext(!1);var mS=x.createContext({isTransitioning:!1});mS.displayName="ViewTransition";var UP=x.createContext(new Map);UP.displayName="Fetchers";var $P=x.createContext(null);$P.displayName="Await";var Ur=x.createContext(null);Ur.displayName="Navigation";var ru=x.createContext(null);ru.displayName="Location";var $r=x.createContext({outlet:null,matches:[],isDataRoute:!1});$r.displayName="Route";var Vy=x.createContext(null);Vy.displayName="RouteError";function BP(t,{relative:e}={}){Nt(ol(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=x.useContext(Ur),{hash:s,pathname:i,search:a}=su(t,{relative:e}),l=i;return n!=="/"&&(l=i==="/"?n:bs([n,i])),r.createHref({pathname:l,search:a,hash:s})}function ol(){return x.useContext(ru)!=null}function Fn(){return Nt(ol(),"useLocation() may be used only in the context of a <Router> component."),x.useContext(ru).location}var gS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function yS(t){x.useContext(Ur).static||x.useLayoutEffect(t)}function as(){let{isDataRoute:t}=x.useContext($r);return t?nR():zP()}function zP(){Nt(ol(),"useNavigate() may be used only in the context of a <Router> component.");let t=x.useContext(il),{basename:e,navigator:n}=x.useContext(Ur),{matches:r}=x.useContext($r),{pathname:s}=Fn(),i=JSON.stringify(Ly(r)),a=x.useRef(!1);return yS(()=>{a.current=!0}),x.useCallback((c,d={})=>{if(xr(a.current,gS),!a.current)return;if(typeof c=="number"){n.go(c);return}let h=Oy(c,JSON.parse(i),s,d.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:bs([e,h.pathname])),(d.replace?n.replace:n.push)(h,d.state,d)},[e,n,i,s,t])}x.createContext(null);function qP(){let{matches:t}=x.useContext($r),e=t[t.length-1];return e?e.params:{}}function su(t,{relative:e}={}){let{matches:n}=x.useContext($r),{pathname:r}=Fn(),s=JSON.stringify(Ly(n));return x.useMemo(()=>Oy(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function HP(t,e){return vS(t,e)}function vS(t,e,n,r,s){var I;Nt(ol(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=x.useContext(Ur),{matches:a}=x.useContext($r),l=a[a.length-1],c=l?l.params:{},d=l?l.pathname:"/",h=l?l.pathnameBase:"/",f=l&&l.route;{let E=f&&f.path||"";_S(d,!f||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let m=Fn(),_;if(e){let E=typeof e=="string"?sl(e):e;Nt(h==="/"||((I=E.pathname)==null?void 0:I.startsWith(h)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${E.pathname}" was given in the \`location\` prop.`),_=E}else _=m;let C=_.pathname||"/",N=C;if(h!=="/"){let E=h.replace(/^\//,"").split("/");N="/"+C.replace(/^\//,"").split("/").slice(E.length).join("/")}let A=dS(t,{pathname:N});xr(f||A!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),xr(A==null||A[A.length-1].route.element!==void 0||A[A.length-1].route.Component!==void 0||A[A.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let T=YP(A&&A.map(E=>Object.assign({},E,{params:Object.assign({},c,E.params),pathname:bs([h,i.encodeLocation?i.encodeLocation(E.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?h:bs([h,i.encodeLocation?i.encodeLocation(E.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathnameBase])})),a,n,r,s);return e&&T?x.createElement(ru.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._},navigationType:"POP"}},T):T}function WP(){let t=tR(),e=MP(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",t),a=x.createElement(x.Fragment,null,x.createElement("p",null," Hey developer "),x.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",x.createElement("code",{style:i},"ErrorBoundary")," or"," ",x.createElement("code",{style:i},"errorElement")," prop on your route.")),x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},e),n?x.createElement("pre",{style:s},n):null,a)}var GP=x.createElement(WP,null),KP=class extends x.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?x.createElement($r.Provider,{value:this.props.routeContext},x.createElement(Vy.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function QP({routeContext:t,match:e,children:n}){let r=x.useContext(il);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),x.createElement($r.Provider,{value:t},n)}function YP(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,a=n==null?void 0:n.errors;if(a!=null){let h=i.findIndex(f=>f.route.id&&(a==null?void 0:a[f.route.id])!==void 0);Nt(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),i=i.slice(0,Math.min(i.length,h+1))}let l=!1,c=-1;if(n)for(let h=0;h<i.length;h++){let f=i[h];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(c=h),f.route.id){let{loaderData:m,errors:_}=n,C=f.route.loader&&!m.hasOwnProperty(f.route.id)&&(!_||_[f.route.id]===void 0);if(f.route.lazy||C){l=!0,c>=0?i=i.slice(0,c+1):i=[i[0]];break}}}let d=n&&r?(h,f)=>{var m,_;r(h,{location:n.location,params:((_=(m=n.matches)==null?void 0:m[0])==null?void 0:_.params)??{},errorInfo:f})}:void 0;return i.reduceRight((h,f,m)=>{let _,C=!1,N=null,A=null;n&&(_=a&&f.route.id?a[f.route.id]:void 0,N=f.route.errorElement||GP,l&&(c<0&&m===0?(_S("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),C=!0,A=null):c===m&&(C=!0,A=f.route.hydrateFallbackElement||null)));let T=e.concat(i.slice(0,m+1)),I=()=>{let E;return _?E=N:C?E=A:f.route.Component?E=x.createElement(f.route.Component,null):f.route.element?E=f.route.element:E=h,x.createElement(QP,{match:f,routeContext:{outlet:h,matches:T,isDataRoute:n!=null},children:E})};return n&&(f.route.ErrorBoundary||f.route.errorElement||m===0)?x.createElement(KP,{location:n.location,revalidation:n.revalidation,component:N,error:_,children:I(),routeContext:{outlet:null,matches:T,isDataRoute:!0},onError:d}):I()},null)}function My(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function XP(t){let e=x.useContext(il);return Nt(e,My(t)),e}function JP(t){let e=x.useContext(nf);return Nt(e,My(t)),e}function ZP(t){let e=x.useContext($r);return Nt(e,My(t)),e}function Fy(t){let e=ZP(t),n=e.matches[e.matches.length-1];return Nt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function eR(){return Fy("useRouteId")}function tR(){var r;let t=x.useContext(Vy),e=JP("useRouteError"),n=Fy("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function nR(){let{router:t}=XP("useNavigate"),e=Fy("useNavigate"),n=x.useRef(!1);return yS(()=>{n.current=!0}),x.useCallback(async(s,i={})=>{xr(n.current,gS),n.current&&(typeof s=="number"?t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var cb={};function _S(t,e,n){!e&&!cb[t]&&(cb[t]=!0,xr(!1,n))}x.memo(rR);function rR({routes:t,future:e,state:n,unstable_onError:r}){return vS(t,void 0,n,r,e)}function ch({to:t,replace:e,state:n,relative:r}){Nt(ol(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=x.useContext(Ur);xr(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=x.useContext($r),{pathname:a}=Fn(),l=as(),c=Oy(t,Ly(i),a,r==="path"),d=JSON.stringify(c);return x.useEffect(()=>{l(JSON.parse(d),{replace:e,state:n,relative:r})},[l,d,r,e,n]),null}function na(t){Nt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function sR({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1}){Nt(!ol(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=x.useMemo(()=>({basename:a,navigator:s,static:i,future:{}}),[a,s,i]);typeof n=="string"&&(n=sl(n));let{pathname:c="/",search:d="",hash:h="",state:f=null,key:m="default"}=n,_=x.useMemo(()=>{let C=Ts(c,a);return C==null?null:{location:{pathname:C,search:d,hash:h,state:f,key:m},navigationType:r}},[a,c,d,h,f,m,r]);return xr(_!=null,`<Router basename="${a}"> is not able to match the URL "${c}${d}${h}" because it does not start with the basename, so the <Router> won't render anything.`),_==null?null:x.createElement(Ur.Provider,{value:l},x.createElement(ru.Provider,{children:e,value:_}))}function iR({children:t,location:e}){return HP(rg(t),e)}function rg(t,e=[]){let n=[];return x.Children.forEach(t,(r,s)=>{if(!x.isValidElement(r))return;let i=[...e,s];if(r.type===x.Fragment){n.push.apply(n,rg(r.props.children,i));return}Nt(r.type===na,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Nt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let a={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=rg(r.props.children,i)),n.push(a)}),n}var _d="get",xd="application/x-www-form-urlencoded";function rf(t){return t!=null&&typeof t.tagName=="string"}function oR(t){return rf(t)&&t.tagName.toLowerCase()==="button"}function aR(t){return rf(t)&&t.tagName.toLowerCase()==="form"}function lR(t){return rf(t)&&t.tagName.toLowerCase()==="input"}function cR(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function uR(t,e){return t.button===0&&(!e||e==="_self")&&!cR(t)}var Gu=null;function dR(){if(Gu===null)try{new FormData(document.createElement("form"),0),Gu=!1}catch{Gu=!0}return Gu}var hR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function jp(t){return t!=null&&!hR.has(t)?(xr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${xd}"`),null):t}function fR(t,e){let n,r,s,i,a;if(aR(t)){let l=t.getAttribute("action");r=l?Ts(l,e):null,n=t.getAttribute("method")||_d,s=jp(t.getAttribute("enctype"))||xd,i=new FormData(t)}else if(oR(t)||lR(t)&&(t.type==="submit"||t.type==="image")){let l=t.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||l.getAttribute("action");if(r=c?Ts(c,e):null,n=t.getAttribute("formmethod")||l.getAttribute("method")||_d,s=jp(t.getAttribute("formenctype"))||jp(l.getAttribute("enctype"))||xd,i=new FormData(l,t),!dR()){let{name:d,type:h,value:f}=t;if(h==="image"){let m=d?`${d}.`:"";i.append(`${m}x`,"0"),i.append(`${m}y`,"0")}else d&&i.append(d,f)}}else{if(rf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=_d,r=null,s=xd,a=t}return i&&s==="text/plain"&&(a=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Uy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function pR(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&Ts(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function mR(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function gR(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function yR(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let a=await mR(i,n);return a.links?a.links():[]}return[]}));return bR(r.flat(1).filter(gR).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function ub(t,e,n,r,s,i){let a=(c,d)=>n[d]?c.route.id!==n[d].route.id:!0,l=(c,d)=>{var h;return n[d].pathname!==c.pathname||((h=n[d].route.path)==null?void 0:h.endsWith("*"))&&n[d].params["*"]!==c.params["*"]};return i==="assets"?e.filter((c,d)=>a(c,d)||l(c,d)):i==="data"?e.filter((c,d)=>{var f;let h=r.routes[c.route.id];if(!h||!h.hasLoader)return!1;if(a(c,d)||l(c,d))return!0;if(c.route.shouldRevalidate){let m=c.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function vR(t,e,{includeHydrateFallback:n}={}){return _R(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function _R(t){return[...new Set(t)]}function xR(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function bR(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let i=JSON.stringify(xR(s));return n.has(i)||(n.add(i),r.push({key:i,link:s})),r},[])}function xS(){let t=x.useContext(il);return Uy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function wR(){let t=x.useContext(nf);return Uy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var $y=x.createContext(void 0);$y.displayName="FrameworkContext";function bS(){let t=x.useContext($y);return Uy(t,"You must render this element inside a <HydratedRouter> element"),t}function ER(t,e){let n=x.useContext($y),[r,s]=x.useState(!1),[i,a]=x.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:d,onMouseLeave:h,onTouchStart:f}=e,m=x.useRef(null);x.useEffect(()=>{if(t==="render"&&a(!0),t==="viewport"){let N=T=>{T.forEach(I=>{a(I.isIntersecting)})},A=new IntersectionObserver(N,{threshold:.5});return m.current&&A.observe(m.current),()=>{A.disconnect()}}},[t]),x.useEffect(()=>{if(r){let N=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(N)}}},[r]);let _=()=>{s(!0)},C=()=>{s(!1),a(!1)};return n?t!=="intent"?[i,m,{}]:[i,m,{onFocus:Rl(l,_),onBlur:Rl(c,C),onMouseEnter:Rl(d,_),onMouseLeave:Rl(h,C),onTouchStart:Rl(f,_)}]:[!1,m,{}]}function Rl(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function IR({page:t,...e}){let{router:n}=xS(),r=x.useMemo(()=>dS(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?x.createElement(TR,{page:t,matches:r,...e}):null}function SR(t){let{manifest:e,routeModules:n}=bS(),[r,s]=x.useState([]);return x.useEffect(()=>{let i=!1;return yR(t,e,n).then(a=>{i||s(a)}),()=>{i=!0}},[t,e,n]),r}function TR({page:t,matches:e,...n}){let r=Fn(),{manifest:s,routeModules:i}=bS(),{basename:a}=xS(),{loaderData:l,matches:c}=wR(),d=x.useMemo(()=>ub(t,e,c,s,r,"data"),[t,e,c,s,r]),h=x.useMemo(()=>ub(t,e,c,s,r,"assets"),[t,e,c,s,r]),f=x.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let C=new Set,N=!1;if(e.forEach(T=>{var E;let I=s.routes[T.route.id];!I||!I.hasLoader||(!d.some(w=>w.route.id===T.route.id)&&T.route.id in l&&((E=i[T.route.id])!=null&&E.shouldRevalidate)||I.hasClientLoader?N=!0:C.add(T.route.id))}),C.size===0)return[];let A=pR(t,a,"data");return N&&C.size>0&&A.searchParams.set("_routes",e.filter(T=>C.has(T.route.id)).map(T=>T.route.id).join(",")),[A.pathname+A.search]},[a,l,r,s,d,e,t,i]),m=x.useMemo(()=>vR(h,s),[h,s]),_=SR(h);return x.createElement(x.Fragment,null,f.map(C=>x.createElement("link",{key:C,rel:"prefetch",as:"fetch",href:C,...n})),m.map(C=>x.createElement("link",{key:C,rel:"modulepreload",href:C,...n})),_.map(({key:C,link:N})=>x.createElement("link",{key:C,nonce:n.nonce,...N})))}function CR(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var wS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{wS&&(window.__reactRouterVersion="7.9.6")}catch{}function NR({basename:t,children:e,window:n}){let r=x.useRef();r.current==null&&(r.current=pP({window:n,v5Compat:!0}));let s=r.current,[i,a]=x.useState({action:s.action,location:s.location}),l=x.useCallback(c=>{x.startTransition(()=>a(c))},[a]);return x.useLayoutEffect(()=>s.listen(l),[s,l]),x.createElement(sR,{basename:t,children:e,location:i.location,navigationType:i.action,navigator:s})}var ES=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,IS=x.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:a,state:l,target:c,to:d,preventScrollReset:h,viewTransition:f,...m},_){let{basename:C}=x.useContext(Ur),N=typeof d=="string"&&ES.test(d),A,T=!1;if(typeof d=="string"&&N&&(A=d,wS))try{let b=new URL(window.location.href),k=d.startsWith("//")?new URL(b.protocol+d):new URL(d),R=Ts(k.pathname,C);k.origin===b.origin&&R!=null?d=R+k.search+k.hash:T=!0}catch{xr(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let I=BP(d,{relative:s}),[E,w,S]=ER(r,m),M=PR(d,{replace:a,state:l,target:c,preventScrollReset:h,relative:s,viewTransition:f});function g(b){e&&e(b),b.defaultPrevented||M(b)}let v=x.createElement("a",{...m,...S,href:A||I,onClick:T||i?e:g,ref:CR(_,w),target:c,"data-discover":!N&&n==="render"?"true":void 0});return E&&!N?x.createElement(x.Fragment,null,v,x.createElement(IR,{page:I})):v});IS.displayName="Link";var ra=x.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:a,viewTransition:l,children:c,...d},h){let f=su(a,{relative:d.relative}),m=Fn(),_=x.useContext(nf),{navigator:C,basename:N}=x.useContext(Ur),A=_!=null&&OR(f)&&l===!0,T=C.encodeLocation?C.encodeLocation(f).pathname:f.pathname,I=m.pathname,E=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(I=I.toLowerCase(),E=E?E.toLowerCase():null,T=T.toLowerCase()),E&&N&&(E=Ts(E,N)||E);const w=T!=="/"&&T.endsWith("/")?T.length-1:T.length;let S=I===T||!s&&I.startsWith(T)&&I.charAt(w)==="/",M=E!=null&&(E===T||!s&&E.startsWith(T)&&E.charAt(T.length)==="/"),g={isActive:S,isPending:M,isTransitioning:A},v=S?e:void 0,b;typeof r=="function"?b=r(g):b=[r,S?"active":null,M?"pending":null,A?"transitioning":null].filter(Boolean).join(" ");let k=typeof i=="function"?i(g):i;return x.createElement(IS,{...d,"aria-current":v,className:b,ref:h,style:k,to:a,viewTransition:l},typeof c=="function"?c(g):c)});ra.displayName="NavLink";var jR=x.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:a=_d,action:l,onSubmit:c,relative:d,preventScrollReset:h,viewTransition:f,...m},_)=>{let C=DR(),N=LR(l,{relative:d}),A=a.toLowerCase()==="get"?"get":"post",T=typeof l=="string"&&ES.test(l),I=E=>{if(c&&c(E),E.defaultPrevented)return;E.preventDefault();let w=E.nativeEvent.submitter,S=(w==null?void 0:w.getAttribute("formmethod"))||a;C(w||E.currentTarget,{fetcherKey:e,method:S,navigate:n,replace:s,state:i,relative:d,preventScrollReset:h,viewTransition:f})};return x.createElement("form",{ref:_,method:A,action:N,onSubmit:r?c:I,...m,"data-discover":!T&&t==="render"?"true":void 0})});jR.displayName="Form";function AR(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function SS(t){let e=x.useContext(il);return Nt(e,AR(t)),e}function PR(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:a}={}){let l=as(),c=Fn(),d=su(t,{relative:i});return x.useCallback(h=>{if(uR(h,e)){h.preventDefault();let f=n!==void 0?n:Vc(c)===Vc(d);l(t,{replace:f,state:r,preventScrollReset:s,relative:i,viewTransition:a})}},[c,l,d,n,r,e,t,s,i,a])}var RR=0,kR=()=>`__${String(++RR)}__`;function DR(){let{router:t}=SS("useSubmit"),{basename:e}=x.useContext(Ur),n=eR();return x.useCallback(async(r,s={})=>{let{action:i,method:a,encType:l,formData:c,body:d}=fR(r,e);if(s.navigate===!1){let h=s.fetcherKey||kR();await t.fetch(h,n,s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||a,formEncType:s.encType||l,flushSync:s.flushSync})}else await t.navigate(s.action||i,{preventScrollReset:s.preventScrollReset,formData:c,body:d,formMethod:s.method||a,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:n,flushSync:s.flushSync,viewTransition:s.viewTransition})},[t,e,n])}function LR(t,{relative:e}={}){let{basename:n}=x.useContext(Ur),r=x.useContext($r);Nt(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...su(t||".",{relative:e})},a=Fn();if(t==null){i.search=a.search;let l=new URLSearchParams(i.search),c=l.getAll("index");if(c.some(h=>h==="")){l.delete("index"),c.filter(f=>f).forEach(f=>l.append("index",f));let h=l.toString();i.search=h?`?${h}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:bs([n,i.pathname])),Vc(i)}function OR(t,{relative:e}={}){let n=x.useContext(mS);Nt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=SS("useViewTransitionState"),s=su(t,{relative:e});if(!n.isTransitioning)return!1;let i=Ts(n.currentLocation.pathname,r)||n.currentLocation.pathname,a=Ts(n.nextLocation.pathname,r)||n.nextLocation.pathname;return lh(s.pathname,a)!=null||lh(s.pathname,i)!=null}const VR=()=>{};var db={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TS=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},MR=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],a=t[n++],l=t[n++],c=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=t[n++],a=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},CS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],a=s+1<t.length,l=a?t[s+1]:0,c=s+2<t.length,d=c?t[s+2]:0,h=i>>2,f=(i&3)<<4|l>>4;let m=(l&15)<<2|d>>6,_=d&63;c||(_=64,a||(m=64)),r.push(n[h],n[f],n[m],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(TS(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):MR(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],l=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const f=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||l==null||d==null||f==null)throw new FR;const m=i<<2|l>>4;if(r.push(m),d!==64){const _=l<<4&240|d>>2;if(r.push(_),f!==64){const C=d<<6&192|f;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class FR extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const UR=function(t){const e=TS(t);return CS.encodeByteArray(e,!0)},uh=function(t){return UR(t).replace(/\./g,"")},NS=function(t){try{return CS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jS(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $R=()=>jS().__FIREBASE_DEFAULTS__,BR=()=>{if(typeof process>"u"||typeof db>"u")return;const t=db.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},zR=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&NS(t[1]);return e&&JSON.parse(e)},sf=()=>{try{return VR()||$R()||BR()||zR()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},AS=t=>{var e,n;return(n=(e=sf())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},PS=t=>{const e=AS(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},RS=()=>{var t;return(t=sf())==null?void 0:t.config},kS=t=>{var e;return(e=sf())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ai(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function By(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DS(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[uh(JSON.stringify(n)),uh(JSON.stringify(a)),""].join(".")}const uc={};function HR(){const t={prod:[],emulator:[]};for(const e of Object.keys(uc))uc[e]?t.emulator.push(e):t.prod.push(e);return t}function WR(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let hb=!1;function zy(t,e){if(typeof window>"u"||typeof document>"u"||!Ai(window.location.host)||uc[t]===e||uc[t]||hb)return;uc[t]=e;function n(m){return`__firebase__banner__${m}`}const r="__firebase__banner",i=HR().prod.length>0;function a(){const m=document.getElementById(r);m&&m.remove()}function l(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function c(m,_){m.setAttribute("width","24"),m.setAttribute("id",_),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function d(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{hb=!0,a()},m}function h(m,_){m.setAttribute("id",_),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function f(){const m=WR(r),_=n("text"),C=document.getElementById(_)||document.createElement("span"),N=n("learnmore"),A=document.getElementById(N)||document.createElement("a"),T=n("preprendIcon"),I=document.getElementById(T)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const E=m.element;l(E),h(A,N);const w=d();c(I,T),E.append(I,C,A,w),document.body.appendChild(E)}i?(C.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,C.innerText="Preview backend running in this workspace."),C.setAttribute("id",_)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function GR(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(tn())}function LS(){var e;const t=(e=sf())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function KR(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function OS(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function QR(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function YR(){const t=tn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function VS(){return!LS()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function MS(){return!LS()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function qy(){try{return typeof indexedDB=="object"}catch{return!1}}function FS(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}function XR(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR="FirebaseError";class wr extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=JR,Object.setPrototypeOf(this,wr.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Lo.prototype.create)}}class Lo{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?ZR(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new wr(s,l,r)}}function ZR(t,e){return t.replace(ek,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const ek=/\{\$([^}]+)}/g;function tk(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Cs(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],a=e[s];if(fb(i)&&fb(a)){if(!Cs(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function fb(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iu(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Wl(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Gl(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function nk(t,e){const n=new rk(t,e);return n.subscribe.bind(n)}class rk{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");sk(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Ap),s.error===void 0&&(s.error=Ap),s.complete===void 0&&(s.complete=Ap);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function sk(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Ap(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ik=1e3,ok=2,ak=4*60*60*1e3,lk=.5;function pb(t,e=ik,n=ok){const r=e*Math.pow(n,t),s=Math.round(lk*r*(Math.random()-.5)*2);return Math.min(ak,r+s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ut(t){return t&&t._delegate?t._delegate:t}class br{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qi="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new qR;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(dk(e))try{this.getOrInitializeService({instanceIdentifier:qi})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=qi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=qi){return this.instances.has(e)}getOptions(e=qi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:uk(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=qi){return this.component?this.component.multipleInstances?e:qi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function uk(t){return t===qi?void 0:t}function dk(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new ck(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var et;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(et||(et={}));const fk={debug:et.DEBUG,verbose:et.VERBOSE,info:et.INFO,warn:et.WARN,error:et.ERROR,silent:et.SILENT},pk=et.INFO,mk={[et.DEBUG]:"log",[et.VERBOSE]:"log",[et.INFO]:"info",[et.WARN]:"warn",[et.ERROR]:"error"},gk=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=mk[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class of{constructor(e){this.name=e,this._logLevel=pk,this._logHandler=gk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in et))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?fk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,et.DEBUG,...e),this._logHandler(this,et.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,et.VERBOSE,...e),this._logHandler(this,et.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,et.INFO,...e),this._logHandler(this,et.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,et.WARN,...e),this._logHandler(this,et.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,et.ERROR,...e),this._logHandler(this,et.ERROR,...e)}}const yk=(t,e)=>e.some(n=>t instanceof n);let mb,gb;function vk(){return mb||(mb=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _k(){return gb||(gb=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const US=new WeakMap,sg=new WeakMap,$S=new WeakMap,Pp=new WeakMap,Hy=new WeakMap;function xk(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",a)},i=()=>{n(pi(t.result)),s()},a=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&US.set(n,t)}).catch(()=>{}),Hy.set(e,t),e}function bk(t){if(sg.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",a),t.removeEventListener("abort",a)},i=()=>{n(),s()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",a),t.addEventListener("abort",a)});sg.set(t,e)}let ig={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return sg.get(t);if(e==="objectStoreNames")return t.objectStoreNames||$S.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return pi(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function wk(t){ig=t(ig)}function Ek(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Rp(this),e,...n);return $S.set(r,e.sort?e.sort():[e]),pi(r)}:_k().includes(t)?function(...e){return t.apply(Rp(this),e),pi(US.get(this))}:function(...e){return pi(t.apply(Rp(this),e))}}function Ik(t){return typeof t=="function"?Ek(t):(t instanceof IDBTransaction&&bk(t),yk(t,vk())?new Proxy(t,ig):t)}function pi(t){if(t instanceof IDBRequest)return xk(t);if(Pp.has(t))return Pp.get(t);const e=Ik(t);return e!==t&&(Pp.set(t,e),Hy.set(e,t)),e}const Rp=t=>Hy.get(t);function BS(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(t,e),l=pi(a);return r&&a.addEventListener("upgradeneeded",c=>{r(pi(a.result),c.oldVersion,c.newVersion,pi(a.transaction),c)}),n&&a.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const Sk=["get","getKey","getAll","getAllKeys","count"],Tk=["put","add","delete","clear"],kp=new Map;function yb(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(kp.get(e))return kp.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=Tk.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Sk.includes(n)))return;const i=async function(a,...l){const c=this.transaction(a,s?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),s&&c.done]))[0]};return kp.set(e,i),i}wk(t=>({...t,get:(e,n,r)=>yb(e,n)||t.get(e,n,r),has:(e,n)=>!!yb(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Nk(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function Nk(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const og="@firebase/app",vb="0.14.5";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ns=new of("@firebase/app"),jk="@firebase/app-compat",Ak="@firebase/analytics-compat",Pk="@firebase/analytics",Rk="@firebase/app-check-compat",kk="@firebase/app-check",Dk="@firebase/auth",Lk="@firebase/auth-compat",Ok="@firebase/database",Vk="@firebase/data-connect",Mk="@firebase/database-compat",Fk="@firebase/functions",Uk="@firebase/functions-compat",$k="@firebase/installations",Bk="@firebase/installations-compat",zk="@firebase/messaging",qk="@firebase/messaging-compat",Hk="@firebase/performance",Wk="@firebase/performance-compat",Gk="@firebase/remote-config",Kk="@firebase/remote-config-compat",Qk="@firebase/storage",Yk="@firebase/storage-compat",Xk="@firebase/firestore",Jk="@firebase/ai",Zk="@firebase/firestore-compat",eD="firebase",tD="12.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ag="[DEFAULT]",nD={[og]:"fire-core",[jk]:"fire-core-compat",[Pk]:"fire-analytics",[Ak]:"fire-analytics-compat",[kk]:"fire-app-check",[Rk]:"fire-app-check-compat",[Dk]:"fire-auth",[Lk]:"fire-auth-compat",[Ok]:"fire-rtdb",[Vk]:"fire-data-connect",[Mk]:"fire-rtdb-compat",[Fk]:"fire-fn",[Uk]:"fire-fn-compat",[$k]:"fire-iid",[Bk]:"fire-iid-compat",[zk]:"fire-fcm",[qk]:"fire-fcm-compat",[Hk]:"fire-perf",[Wk]:"fire-perf-compat",[Gk]:"fire-rc",[Kk]:"fire-rc-compat",[Qk]:"fire-gcs",[Yk]:"fire-gcs-compat",[Xk]:"fire-fst",[Zk]:"fire-fst-compat",[Jk]:"fire-vertex","fire-js":"fire-js",[eD]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dh=new Map,rD=new Map,lg=new Map;function _b(t,e){try{t.container.addComponent(e)}catch(n){Ns.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Vr(t){const e=t.name;if(lg.has(e))return Ns.debug(`There were multiple attempts to register component ${e}.`),!1;lg.set(e,t);for(const n of dh.values())_b(n,t);for(const n of rD.values())_b(n,t);return!0}function Pi(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function hr(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},mi=new Lo("app","Firebase",sD);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new br("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw mi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oo=tD;function Wy(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:ag,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw mi.create("bad-app-name",{appName:String(s)});if(n||(n=RS()),!n)throw mi.create("no-options");const i=dh.get(s);if(i){if(Cs(n,i.options)&&Cs(r,i.config))return i;throw mi.create("duplicate-app",{appName:s})}const a=new hk(s);for(const c of lg.values())a.addComponent(c);const l=new iD(n,r,a);return dh.set(s,l),l}function af(t=ag){const e=dh.get(t);if(!e&&t===ag&&RS())return Wy();if(!e)throw mi.create("no-app",{appName:t});return e}function Kn(t,e,n){let r=nD[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ns.warn(a.join(" "));return}Vr(new br(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD="firebase-heartbeat-database",aD=1,Mc="firebase-heartbeat-store";let Dp=null;function zS(){return Dp||(Dp=BS(oD,aD,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Mc)}catch(n){console.warn(n)}}}}).catch(t=>{throw mi.create("idb-open",{originalErrorMessage:t.message})})),Dp}async function lD(t){try{const n=(await zS()).transaction(Mc),r=await n.objectStore(Mc).get(qS(t));return await n.done,r}catch(e){if(e instanceof wr)Ns.warn(e.message);else{const n=mi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ns.warn(n.message)}}}async function xb(t,e){try{const r=(await zS()).transaction(Mc,"readwrite");await r.objectStore(Mc).put(e,qS(t)),await r.done}catch(n){if(n instanceof wr)Ns.warn(n.message);else{const r=mi.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Ns.warn(r.message)}}}function qS(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cD=1024,uD=30;class dD{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new fD(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=bb();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>uD){const a=pD(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Ns.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=bb(),{heartbeatsToSend:r,unsentEntries:s}=hD(this._heartbeatsCache.heartbeats),i=uh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return Ns.warn(n),""}}}function bb(){return new Date().toISOString().substring(0,10)}function hD(t,e=cD){const n=[];let r=t.slice();for(const s of t){const i=n.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),wb(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),wb(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class fD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return qy()?FS().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await lD(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return xb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return xb(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function wb(t){return uh(JSON.stringify({version:2,heartbeats:t})).length}function pD(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mD(t){Vr(new br("platform-logger",e=>new Ck(e),"PRIVATE")),Vr(new br("heartbeat",e=>new dD(e),"PRIVATE")),Kn(og,vb,t),Kn(og,vb,"esm2020"),Kn("fire-js","")}mD("");var gD="firebase",yD="12.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Kn(gD,yD,"app");function HS(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const vD=HS,WS=new Lo("auth","Firebase",HS());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hh=new of("@firebase/auth");function _D(t,...e){hh.logLevel<=et.WARN&&hh.warn(`Auth (${Oo}): ${t}`,...e)}function bd(t,...e){hh.logLevel<=et.ERROR&&hh.error(`Auth (${Oo}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(t,...e){throw Gy(t,...e)}function ns(t,...e){return Gy(t,...e)}function GS(t,e,n){const r={...vD(),[e]:n};return new Lo("auth","Firebase",r).create(e,{appName:t.name})}function gi(t){return GS(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Gy(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return WS.create(t,...e)}function ke(t,e,...n){if(!t)throw Gy(e,...n)}function ys(t){const e="INTERNAL ASSERTION FAILED: "+t;throw bd(e),new Error(e)}function js(t,e){t||ys(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function xD(){return Eb()==="http:"||Eb()==="https:"}function Eb(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bD(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(xD()||OS()||"connection"in navigator)?navigator.onLine:!0}function wD(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou{constructor(e,n){this.shortDelay=e,this.longDelay=n,js(n>e,"Short delay should be less than long delay!"),this.isMobile=GR()||QR()}get(){return bD()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ky(t,e){js(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KS{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ys("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ys("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ys("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ED={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ID=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],SD=new ou(3e4,6e4);function Vo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ri(t,e,n,r,s={}){return QS(t,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=iu({key:t.config.apiKey,...a}).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d={method:e,headers:c,...i};return KR()||(d.referrerPolicy="no-referrer"),t.emulatorConfig&&Ai(t.emulatorConfig.host)&&(d.credentials="include"),KS.fetch()(await YS(t,t.config.apiHost,n,l),d)})}async function QS(t,e,n){t._canInitEmulator=!1;const r={...ED,...e};try{const s=new CD(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Ku(t,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ku(t,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw Ku(t,"email-already-in-use",a);if(c==="USER_DISABLED")throw Ku(t,"user-disabled",a);const h=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw GS(t,h,d);Mr(t,h)}}catch(s){if(s instanceof wr)throw s;Mr(t,"network-request-failed",{message:String(s)})}}async function lf(t,e,n,r,s={}){const i=await Ri(t,e,n,r,s);return"mfaPendingCredential"in i&&Mr(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function YS(t,e,n,r){const s=`${e}${n}?${r}`,i=t,a=i.config.emulator?Ky(t.config,s):`${t.config.apiScheme}://${s}`;return ID.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}function TD(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class CD{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(ns(this.auth,"network-request-failed")),SD.get())})}}function Ku(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=ns(t,e,r);return s.customData._tokenResponse=n,s}function Ib(t){return t!==void 0&&t.enterprise!==void 0}class ND{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return TD(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function jD(t,e){return Ri(t,"GET","/v2/recaptchaConfig",Vo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AD(t,e){return Ri(t,"POST","/v1/accounts:delete",e)}async function fh(t,e){return Ri(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dc(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function PD(t,e=!1){const n=ut(t),r=await n.getIdToken(e),s=Qy(r);ke(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:dc(Lp(s.auth_time)),issuedAtTime:dc(Lp(s.iat)),expirationTime:dc(Lp(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Lp(t){return Number(t)*1e3}function Qy(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return bd("JWT malformed, contained fewer than 3 sections"),null;try{const s=NS(n);return s?JSON.parse(s):(bd("Failed to decode base64 JWT payload"),null)}catch(s){return bd("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Sb(t){const e=Qy(t);return ke(e,"internal-error"),ke(typeof e.exp<"u","internal-error"),ke(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof wr&&RD(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function RD({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ug{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=dc(this.lastLoginAt),this.creationTime=dc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ph(t){var f;const e=t.auth,n=await t.getIdToken(),r=await Fc(t,fh(e,{idToken:n}));ke(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(f=s.providerUserInfo)!=null&&f.length?XS(s.providerUserInfo):[],a=LD(t.providerData,i),l=t.isAnonymous,c=!(t.email&&s.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new ug(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,h)}async function DD(t){const e=ut(t);await ph(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function LD(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function XS(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OD(t,e){const n=await QS(t,{},async()=>{const r=iu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,a=await YS(t,s,"/v1/token",`key=${i}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:r};return t.emulatorConfig&&Ai(t.emulatorConfig.host)&&(c.credentials="include"),KS.fetch()(a,c)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function VD(t,e){return Ri(t,"POST","/v2/accounts:revokeToken",Vo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ke(e.idToken,"internal-error"),ke(typeof e.idToken<"u","internal-error"),ke(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Sb(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){ke(e.length!==0,"internal-error");const n=Sb(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(ke(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await OD(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,a=new Ca;return r&&(ke(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(ke(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(ke(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ca,this.toJSON())}_performRefresh(){return ys("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $s(t,e){ke(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Rr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new kD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ug(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Fc(this,this.stsTokenManager.getToken(this.auth,e));return ke(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return PD(this,e)}reload(){return DD(this)}_assign(e){this!==e&&(ke(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Rr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){ke(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await ph(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hr(this.auth.app))return Promise.reject(gi(this.auth));const e=await this.getIdToken();return await Fc(this,AD(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,a=n.photoURL??void 0,l=n.tenantId??void 0,c=n._redirectEventId??void 0,d=n.createdAt??void 0,h=n.lastLoginAt??void 0,{uid:f,emailVerified:m,isAnonymous:_,providerData:C,stsTokenManager:N}=n;ke(f&&N,e,"internal-error");const A=Ca.fromJSON(this.name,N);ke(typeof f=="string",e,"internal-error"),$s(r,e.name),$s(s,e.name),ke(typeof m=="boolean",e,"internal-error"),ke(typeof _=="boolean",e,"internal-error"),$s(i,e.name),$s(a,e.name),$s(l,e.name),$s(c,e.name),$s(d,e.name),$s(h,e.name);const T=new Rr({uid:f,auth:e,email:s,emailVerified:m,displayName:r,isAnonymous:_,photoURL:a,phoneNumber:i,tenantId:l,stsTokenManager:A,createdAt:d,lastLoginAt:h});return C&&Array.isArray(C)&&(T.providerData=C.map(I=>({...I}))),c&&(T._redirectEventId=c),T}static async _fromIdTokenResponse(e,n,r=!1){const s=new Ca;s.updateFromServerResponse(n);const i=new Rr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await ph(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];ke(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?XS(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),l=new Ca;l.updateFromIdToken(r);const c=new Rr({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new ug(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tb=new Map;function vs(t){js(t instanceof Function,"Expected a class definition");let e=Tb.get(t);return e?(js(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Tb.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}JS.type="NONE";const Cb=JS;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wd(t,e,n){return`firebase:${t}:${e}:${n}`}class Na{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=wd(this.userKey,s.apiKey,i),this.fullPersistenceKey=wd("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await fh(this.auth,{idToken:e}).catch(()=>{});return n?Rr._fromGetAccountInfoResponse(this.auth,n,e):null}return Rr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Na(vs(Cb),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||vs(Cb);const a=wd(r,e.config.apiKey,e.name);let l=null;for(const d of n)try{const h=await d._get(a);if(h){let f;if(typeof h=="string"){const m=await fh(e,{idToken:h}).catch(()=>{});if(!m)break;f=await Rr._fromGetAccountInfoResponse(e,m,h)}else f=Rr._fromJSON(e,h);d!==i&&(l=f),i=d;break}}catch{}const c=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!c.length?new Na(i,e,r):(i=c[0],l&&await i._set(a,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new Na(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nb(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(nT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(ZS(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(sT(e))return"Blackberry";if(iT(e))return"Webos";if(eT(e))return"Safari";if((e.includes("chrome/")||tT(e))&&!e.includes("edge/"))return"Chrome";if(rT(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function ZS(t=tn()){return/firefox\//i.test(t)}function eT(t=tn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function tT(t=tn()){return/crios\//i.test(t)}function nT(t=tn()){return/iemobile/i.test(t)}function rT(t=tn()){return/android/i.test(t)}function sT(t=tn()){return/blackberry/i.test(t)}function iT(t=tn()){return/webos/i.test(t)}function Yy(t=tn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function MD(t=tn()){var e;return Yy(t)&&!!((e=window.navigator)!=null&&e.standalone)}function FD(){return YR()&&document.documentMode===10}function oT(t=tn()){return Yy(t)||rT(t)||iT(t)||sT(t)||/windows phone/i.test(t)||nT(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aT(t,e=[]){let n;switch(t){case"Browser":n=Nb(tn());break;case"Worker":n=`${Nb(tn())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Oo}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((a,l)=>{try{const c=e(i);a(c)}catch(c){l(c)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $D(t,e={}){return Ri(t,"GET","/v2/passwordPolicy",Vo(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BD=6;class zD{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??BD,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new jb(this),this.idTokenSubscription=new jb(this),this.beforeStateQueue=new UD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=WS,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=vs(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await Na.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await fh(this,{idToken:e}),r=await Rr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(hr(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(i=this.redirectUser)==null?void 0:i._redirectEventId,l=r==null?void 0:r._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===l)&&(c!=null&&c.user)&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(a){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ke(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await ph(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=wD()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(hr(this.app))return Promise.reject(gi(this));const n=e?ut(e):null;return n&&ke(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&ke(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return hr(this.app)?Promise.reject(gi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return hr(this.app)?Promise.reject(gi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(vs(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await $D(this),n=new zD(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Lo("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await VD(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&vs(e)||this._popupRedirectResolver;ke(n,this,"argument-error"),this.redirectPersistenceManager=await Na.create(this,[vs(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(ke(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,r,s);return()=>{a=!0,c()}}else{const c=e.addObserver(n);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ke(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=aT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(hr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&_D(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function al(t){return ut(t)}class jb{constructor(e){this.auth=e,this.observer=null,this.addObserver=nk(n=>this.observer=n)}get next(){return ke(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function HD(t){cf=t}function lT(t){return cf.loadJS(t)}function WD(){return cf.recaptchaEnterpriseScript}function GD(){return cf.gapiScript}function KD(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class QD{constructor(){this.enterprise=new YD}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class YD{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const XD="recaptcha-enterprise",cT="NO_RECAPTCHA";class JD{constructor(e){this.type=XD,this.auth=al(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,l)=>{jD(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new ND(c);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(c=>{l(c)})})}function s(i,a,l){const c=window.grecaptcha;Ib(c)?c.enterprise.ready(()=>{c.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(cT)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new QD().execute("siteKey",{action:"verify"}):new Promise((i,a)=>{r(this.auth).then(l=>{if(!n&&Ib(window.grecaptcha))s(l,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=WD();c.length!==0&&(c+=l),lT(c).then(()=>{s(l,i,a)}).catch(d=>{a(d)})}}).catch(l=>{a(l)})})}}async function Ab(t,e,n,r=!1,s=!1){const i=new JD(t);let a;if(s)a=cT;else try{a=await i.verify(n)}catch{a=await i.verify(n,!0)}const l={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,d=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:d,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return r?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function Pb(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Ab(t,e,n,n==="getOobCode");return r(t,a)}else return r(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Ab(t,e,n,n==="getOobCode");return r(t,l)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZD(t,e){const n=Pi(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Cs(i,e??{}))return s;Mr(s,"already-initialized")}return n.initialize({options:e})}function e2(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(vs);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function t2(t,e,n){const r=al(t);ke(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=uT(e),{host:a,port:l}=n2(e),c=l===null?"":`:${l}`,d={url:`${i}//${a}${c}/`},h=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){ke(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),ke(Cs(d,r.config.emulator)&&Cs(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,Ai(a)?(By(`${i}//${a}${c}`),zy("Auth",!0)):r2()}function uT(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function n2(t){const e=uT(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Rb(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Rb(a)}}}function Rb(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function r2(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return ys("not implemented")}_getIdTokenResponse(e){return ys("not implemented")}_linkToIdToken(e,n){return ys("not implemented")}_getReauthenticationResolver(e){return ys("not implemented")}}async function s2(t,e){return Ri(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i2(t,e){return lf(t,"POST","/v1/accounts:signInWithPassword",Vo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o2(t,e){return lf(t,"POST","/v1/accounts:signInWithEmailLink",Vo(t,e))}async function a2(t,e){return lf(t,"POST","/v1/accounts:signInWithEmailLink",Vo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc extends Xy{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Uc(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Uc(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Pb(e,n,"signInWithPassword",i2);case"emailLink":return o2(e,{email:this._email,oobCode:this._password});default:Mr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Pb(e,r,"signUpPassword",s2);case"emailLink":return a2(e,{idToken:n,email:this._email,oobCode:this._password});default:Mr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ja(t,e){return lf(t,"POST","/v1/accounts:signInWithIdp",Vo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l2="http://localhost";class yo extends Xy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new yo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Mr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const a=new yo(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const n=this.buildRequest();return ja(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,ja(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,ja(e,n)}buildRequest(){const e={requestUri:l2,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=iu(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c2(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function u2(t){const e=Wl(Gl(t)).link,n=e?Wl(Gl(e)).deep_link_id:null,r=Wl(Gl(t)).deep_link_id;return(r?Wl(Gl(r)).link:null)||r||n||e||t}class Jy{constructor(e){const n=Wl(Gl(e)),r=n.apiKey??null,s=n.oobCode??null,i=c2(n.mode??null);ke(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=u2(e);try{return new Jy(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(){this.providerId=ll.PROVIDER_ID}static credential(e,n){return Uc._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Jy.parseLink(n);return ke(r,"argument-error"),Uc._fromEmailAndCode(e,r.code,r.tenantId)}}ll.PROVIDER_ID="password";ll.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ll.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class au extends dT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys extends au{constructor(){super("facebook.com")}static credential(e){return yo._fromParams({providerId:Ys.PROVIDER_ID,signInMethod:Ys.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ys.credentialFromTaggedObject(e)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ys.credential(e.oauthAccessToken)}catch{return null}}}Ys.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ys.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs extends au{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return yo._fromParams({providerId:Xs.PROVIDER_ID,signInMethod:Xs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Xs.credentialFromTaggedObject(e)}static credentialFromError(e){return Xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Xs.credential(n,r)}catch{return null}}}Xs.GOOGLE_SIGN_IN_METHOD="google.com";Xs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js extends au{constructor(){super("github.com")}static credential(e){return yo._fromParams({providerId:Js.PROVIDER_ID,signInMethod:Js.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Js.credentialFromTaggedObject(e)}static credentialFromError(e){return Js.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Js.credential(e.oauthAccessToken)}catch{return null}}}Js.GITHUB_SIGN_IN_METHOD="github.com";Js.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs extends au{constructor(){super("twitter.com")}static credential(e,n){return yo._fromParams({providerId:Zs.PROVIDER_ID,signInMethod:Zs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Zs.credentialFromTaggedObject(e)}static credentialFromError(e){return Zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Zs.credential(n,r)}catch{return null}}}Zs.TWITTER_SIGN_IN_METHOD="twitter.com";Zs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Rr._fromIdTokenResponse(e,r,s),a=kb(r);return new $a({user:i,providerId:a,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=kb(r);return new $a({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function kb(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mh extends wr{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,mh.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new mh(e,n,r,s)}}function hT(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?mh._fromErrorAndOperation(t,i,e,r):i})}async function d2(t,e,n=!1){const r=await Fc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return $a._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h2(t,e,n=!1){const{auth:r}=t;if(hr(r.app))return Promise.reject(gi(r));const s="reauthenticate";try{const i=await Fc(t,hT(r,s,e,t),n);ke(i.idToken,r,"internal-error");const a=Qy(i.idToken);ke(a,r,"internal-error");const{sub:l}=a;return ke(t.uid===l,r,"user-mismatch"),$a._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Mr(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fT(t,e,n=!1){if(hr(t.app))return Promise.reject(gi(t));const r="signIn",s=await hT(t,r,e),i=await $a._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function f2(t,e){return fT(al(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p2(t){const e=al(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function m2(t,e,n){return hr(t.app)?Promise.reject(gi(t)):f2(ut(t),ll.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&p2(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g2(t,e){return ut(t).setPersistence(e)}function y2(t,e,n,r){return ut(t).onIdTokenChanged(e,n,r)}function v2(t,e,n){return ut(t).beforeAuthStateChanged(e,n)}function Zy(t,e,n,r){return ut(t).onAuthStateChanged(e,n,r)}function _2(t){return ut(t).signOut()}const gh="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pT{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(gh,"1"),this.storage.removeItem(gh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x2=1e3,b2=10;class mT extends pT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=oT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((a,l,c)=>{this.notifyListeners(a,c)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!n&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);FD()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,b2):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},x2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}mT.type="LOCAL";const gT=mT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yT extends pT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}yT.type="SESSION";const vT=yT;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w2(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new uf(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(n.origin,i)),c=await w2(l);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}uf.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ev(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E2{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,c)=>{const d=ev("",20);s.port1.start();const h=setTimeout(()=>{c(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(f){const m=f;if(m.data.eventId===d)switch(m.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(m.data.response);break;default:clearTimeout(h),clearTimeout(i),c(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rs(){return window}function I2(t){rs().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _T(){return typeof rs().WorkerGlobalScope<"u"&&typeof rs().importScripts=="function"}async function S2(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function T2(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function C2(){return _T()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xT="firebaseLocalStorageDb",N2=1,yh="firebaseLocalStorage",bT="fbase_key";class lu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function df(t,e){return t.transaction([yh],e?"readwrite":"readonly").objectStore(yh)}function j2(){const t=indexedDB.deleteDatabase(xT);return new lu(t).toPromise()}function dg(){const t=indexedDB.open(xT,N2);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(yh,{keyPath:bT})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(yh)?e(r):(r.close(),await j2(),e(await dg()))})})}async function Db(t,e,n){const r=df(t,!0).put({[bT]:e,value:n});return new lu(r).toPromise()}async function A2(t,e){const n=df(t,!1).get(e),r=await new lu(n).toPromise();return r===void 0?null:r.value}function Lb(t,e){const n=df(t,!0).delete(e);return new lu(n).toPromise()}const P2=800,R2=3;class wT{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await dg(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>R2)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return _T()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=uf._getInstance(C2()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await S2(),!this.activeServiceWorker)return;this.sender=new E2(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||T2()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await dg();return await Db(e,gh,"1"),await Lb(e,gh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Db(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>A2(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Lb(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=df(s,!1).getAll();return new lu(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),P2)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}wT.type="LOCAL";const k2=wT;new ou(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D2(t,e){return e?vs(e):(ke(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv extends Xy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ja(e,this._buildIdpRequest())}_linkToIdToken(e,n){return ja(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return ja(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function L2(t){return fT(t.auth,new tv(t),t.bypassAuthState)}function O2(t){const{auth:e,user:n}=t;return ke(n,e,"internal-error"),h2(n,new tv(t),t.bypassAuthState)}async function V2(t){const{auth:e,user:n}=t;return ke(n,e,"internal-error"),d2(n,new tv(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ET{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return L2;case"linkViaPopup":case"linkViaRedirect":return V2;case"reauthViaPopup":case"reauthViaRedirect":return O2;default:Mr(this.auth,"internal-error")}}resolve(e){js(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){js(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M2=new ou(2e3,1e4);class xa extends ET{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,xa.currentPopupAction&&xa.currentPopupAction.cancel(),xa.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ke(e,this.auth,"internal-error"),e}async onExecution(){js(this.filter.length===1,"Popup operations only handle one event");const e=ev();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(ns(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(ns(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xa.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ns(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,M2.get())};e()}}xa.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F2="pendingRedirect",Ed=new Map;class U2 extends ET{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Ed.get(this.auth._key());if(!e){try{const r=await $2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Ed.set(this.auth._key(),e)}return this.bypassAuthState||Ed.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function $2(t,e){const n=q2(e),r=z2(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function B2(t,e){Ed.set(t._key(),e)}function z2(t){return vs(t._redirectPersistence)}function q2(t){return wd(F2,t.config.apiKey,t.name)}async function H2(t,e,n=!1){if(hr(t.app))return Promise.reject(gi(t));const r=al(t),s=D2(r,e),a=await new U2(r,s,n).execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2=10*60*1e3;class G2{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!K2(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!IT(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(ns(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=W2&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ob(e))}saveEventToCache(e){this.cachedEventUids.add(Ob(e)),this.lastProcessedEventTime=Date.now()}}function Ob(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function IT({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function K2(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return IT(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q2(t,e={}){return Ri(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y2=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,X2=/^https?/;async function J2(t){if(t.config.emulator)return;const{authorizedDomains:e}=await Q2(t);for(const n of e)try{if(Z2(n))return}catch{}Mr(t,"unauthorized-domain")}function Z2(t){const e=cg(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&a.hostname===r}if(!X2.test(n))return!1;if(Y2.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL=new ou(3e4,6e4);function Vb(){const t=rs().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function tL(t){return new Promise((e,n)=>{var s,i,a;function r(){Vb(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Vb(),n(ns(t,"network-request-failed"))},timeout:eL.get()})}if((i=(s=rs().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((a=rs().gapi)!=null&&a.load)r();else{const l=KD("iframefcb");return rs()[l]=()=>{gapi.load?r():n(ns(t,"network-request-failed"))},lT(`${GD()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw Id=null,e})}let Id=null;function nL(t){return Id=Id||tL(t),Id}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rL=new ou(5e3,15e3),sL="__/auth/iframe",iL="emulator/auth/iframe",oL={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},aL=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function lL(t){const e=t.config;ke(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Ky(e,iL):`https://${t.config.authDomain}/${sL}`,r={apiKey:e.apiKey,appName:t.name,v:Oo},s=aL.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${iu(r).slice(1)}`}async function cL(t){const e=await nL(t),n=rs().gapi;return ke(n,t,"internal-error"),e.open({where:document.body,url:lL(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:oL,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=ns(t,"network-request-failed"),l=rs().setTimeout(()=>{i(a)},rL.get());function c(){rs().clearTimeout(l),s(r)}r.ping(c).then(c,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uL={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},dL=500,hL=600,fL="_blank",pL="http://localhost";class Mb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function mL(t,e,n,r=dL,s=hL){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c={...uL,width:r.toString(),height:s.toString(),top:i,left:a},d=tn().toLowerCase();n&&(l=tT(d)?fL:n),ZS(d)&&(e=e||pL,c.scrollbars="yes");const h=Object.entries(c).reduce((m,[_,C])=>`${m}${_}=${C},`,"");if(MD(d)&&l!=="_self")return gL(e||"",l),new Mb(null);const f=window.open(e||"",l,h);ke(f,t,"popup-blocked");try{f.focus()}catch{}return new Mb(f)}function gL(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yL="__/auth/handler",vL="emulator/auth/handler",_L=encodeURIComponent("fac");async function Fb(t,e,n,r,s,i){ke(t.config.authDomain,t,"auth-domain-config-required"),ke(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:Oo,eventId:s};if(e instanceof dT){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",tk(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[h,f]of Object.entries({}))a[h]=f}if(e instanceof au){const h=e.getScopes().filter(f=>f!=="");h.length>0&&(a.scopes=h.join(","))}t.tenantId&&(a.tid=t.tenantId);const l=a;for(const h of Object.keys(l))l[h]===void 0&&delete l[h];const c=await t._getAppCheckToken(),d=c?`#${_L}=${encodeURIComponent(c)}`:"";return`${xL(t)}?${iu(l).slice(1)}${d}`}function xL({config:t}){return t.emulator?Ky(t,vL):`https://${t.authDomain}/${yL}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Op="webStorageSupport";class bL{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=vT,this._completeRedirectFn=H2,this._overrideRedirectResult=B2}async _openPopup(e,n,r,s){var a;js((a=this.eventManagers[e._key()])==null?void 0:a.manager,"_initialize() not called before _openPopup()");const i=await Fb(e,n,r,cg(),s);return mL(e,i,ev())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await Fb(e,n,r,cg(),s);return I2(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(js(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await cL(e),r=new G2(e);return n.register("authEvent",s=>(ke(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Op,{type:Op},s=>{var a;const i=(a=s==null?void 0:s[0])==null?void 0:a[Op];i!==void 0&&n(!!i),Mr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=J2(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return oT()||eT()||Yy()}}const wL=bL;var Ub="@firebase/auth",$b="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EL{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){ke(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IL(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function SL(t){Vr(new br("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;ke(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:a,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:aT(t)},d=new qD(r,s,i,c);return e2(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Vr(new br("auth-internal",e=>{const n=al(e.getProvider("auth").getImmediate());return(r=>new EL(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Kn(Ub,$b,IL(t)),Kn(Ub,$b,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TL=5*60,CL=kS("authIdTokenMaxAge")||TL;let Bb=null;const NL=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>CL)return;const s=n==null?void 0:n.token;Bb!==s&&(Bb=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function ST(t=af()){const e=Pi(t,"auth");if(e.isInitialized())return e.getImmediate();const n=ZD(t,{popupRedirectResolver:wL,persistence:[k2,gT,vT]}),r=kS("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=NL(i.toString());v2(n,a,()=>a(n.currentUser)),y2(n,l=>a(l))}}const s=AS("auth");return s&&t2(n,`http://${s}`),n}function jL(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}HD({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=ns("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",jL().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});SL("Browser");var zb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var yi,TT;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(g,v){function b(){}b.prototype=v.prototype,g.F=v.prototype,g.prototype=new b,g.prototype.constructor=g,g.D=function(k,R,V){for(var D=Array(arguments.length-2),O=2;O<arguments.length;O++)D[O-2]=arguments[O];return v.prototype[R].apply(k,D)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(g,v,b){b||(b=0);const k=Array(16);if(typeof v=="string")for(var R=0;R<16;++R)k[R]=v.charCodeAt(b++)|v.charCodeAt(b++)<<8|v.charCodeAt(b++)<<16|v.charCodeAt(b++)<<24;else for(R=0;R<16;++R)k[R]=v[b++]|v[b++]<<8|v[b++]<<16|v[b++]<<24;v=g.g[0],b=g.g[1],R=g.g[2];let V=g.g[3],D;D=v+(V^b&(R^V))+k[0]+3614090360&4294967295,v=b+(D<<7&4294967295|D>>>25),D=V+(R^v&(b^R))+k[1]+3905402710&4294967295,V=v+(D<<12&4294967295|D>>>20),D=R+(b^V&(v^b))+k[2]+606105819&4294967295,R=V+(D<<17&4294967295|D>>>15),D=b+(v^R&(V^v))+k[3]+3250441966&4294967295,b=R+(D<<22&4294967295|D>>>10),D=v+(V^b&(R^V))+k[4]+4118548399&4294967295,v=b+(D<<7&4294967295|D>>>25),D=V+(R^v&(b^R))+k[5]+1200080426&4294967295,V=v+(D<<12&4294967295|D>>>20),D=R+(b^V&(v^b))+k[6]+2821735955&4294967295,R=V+(D<<17&4294967295|D>>>15),D=b+(v^R&(V^v))+k[7]+4249261313&4294967295,b=R+(D<<22&4294967295|D>>>10),D=v+(V^b&(R^V))+k[8]+1770035416&4294967295,v=b+(D<<7&4294967295|D>>>25),D=V+(R^v&(b^R))+k[9]+2336552879&4294967295,V=v+(D<<12&4294967295|D>>>20),D=R+(b^V&(v^b))+k[10]+4294925233&4294967295,R=V+(D<<17&4294967295|D>>>15),D=b+(v^R&(V^v))+k[11]+2304563134&4294967295,b=R+(D<<22&4294967295|D>>>10),D=v+(V^b&(R^V))+k[12]+1804603682&4294967295,v=b+(D<<7&4294967295|D>>>25),D=V+(R^v&(b^R))+k[13]+4254626195&4294967295,V=v+(D<<12&4294967295|D>>>20),D=R+(b^V&(v^b))+k[14]+2792965006&4294967295,R=V+(D<<17&4294967295|D>>>15),D=b+(v^R&(V^v))+k[15]+1236535329&4294967295,b=R+(D<<22&4294967295|D>>>10),D=v+(R^V&(b^R))+k[1]+4129170786&4294967295,v=b+(D<<5&4294967295|D>>>27),D=V+(b^R&(v^b))+k[6]+3225465664&4294967295,V=v+(D<<9&4294967295|D>>>23),D=R+(v^b&(V^v))+k[11]+643717713&4294967295,R=V+(D<<14&4294967295|D>>>18),D=b+(V^v&(R^V))+k[0]+3921069994&4294967295,b=R+(D<<20&4294967295|D>>>12),D=v+(R^V&(b^R))+k[5]+3593408605&4294967295,v=b+(D<<5&4294967295|D>>>27),D=V+(b^R&(v^b))+k[10]+38016083&4294967295,V=v+(D<<9&4294967295|D>>>23),D=R+(v^b&(V^v))+k[15]+3634488961&4294967295,R=V+(D<<14&4294967295|D>>>18),D=b+(V^v&(R^V))+k[4]+3889429448&4294967295,b=R+(D<<20&4294967295|D>>>12),D=v+(R^V&(b^R))+k[9]+568446438&4294967295,v=b+(D<<5&4294967295|D>>>27),D=V+(b^R&(v^b))+k[14]+3275163606&4294967295,V=v+(D<<9&4294967295|D>>>23),D=R+(v^b&(V^v))+k[3]+4107603335&4294967295,R=V+(D<<14&4294967295|D>>>18),D=b+(V^v&(R^V))+k[8]+1163531501&4294967295,b=R+(D<<20&4294967295|D>>>12),D=v+(R^V&(b^R))+k[13]+2850285829&4294967295,v=b+(D<<5&4294967295|D>>>27),D=V+(b^R&(v^b))+k[2]+4243563512&4294967295,V=v+(D<<9&4294967295|D>>>23),D=R+(v^b&(V^v))+k[7]+1735328473&4294967295,R=V+(D<<14&4294967295|D>>>18),D=b+(V^v&(R^V))+k[12]+2368359562&4294967295,b=R+(D<<20&4294967295|D>>>12),D=v+(b^R^V)+k[5]+4294588738&4294967295,v=b+(D<<4&4294967295|D>>>28),D=V+(v^b^R)+k[8]+2272392833&4294967295,V=v+(D<<11&4294967295|D>>>21),D=R+(V^v^b)+k[11]+1839030562&4294967295,R=V+(D<<16&4294967295|D>>>16),D=b+(R^V^v)+k[14]+4259657740&4294967295,b=R+(D<<23&4294967295|D>>>9),D=v+(b^R^V)+k[1]+2763975236&4294967295,v=b+(D<<4&4294967295|D>>>28),D=V+(v^b^R)+k[4]+1272893353&4294967295,V=v+(D<<11&4294967295|D>>>21),D=R+(V^v^b)+k[7]+4139469664&4294967295,R=V+(D<<16&4294967295|D>>>16),D=b+(R^V^v)+k[10]+3200236656&4294967295,b=R+(D<<23&4294967295|D>>>9),D=v+(b^R^V)+k[13]+681279174&4294967295,v=b+(D<<4&4294967295|D>>>28),D=V+(v^b^R)+k[0]+3936430074&4294967295,V=v+(D<<11&4294967295|D>>>21),D=R+(V^v^b)+k[3]+3572445317&4294967295,R=V+(D<<16&4294967295|D>>>16),D=b+(R^V^v)+k[6]+76029189&4294967295,b=R+(D<<23&4294967295|D>>>9),D=v+(b^R^V)+k[9]+3654602809&4294967295,v=b+(D<<4&4294967295|D>>>28),D=V+(v^b^R)+k[12]+3873151461&4294967295,V=v+(D<<11&4294967295|D>>>21),D=R+(V^v^b)+k[15]+530742520&4294967295,R=V+(D<<16&4294967295|D>>>16),D=b+(R^V^v)+k[2]+3299628645&4294967295,b=R+(D<<23&4294967295|D>>>9),D=v+(R^(b|~V))+k[0]+4096336452&4294967295,v=b+(D<<6&4294967295|D>>>26),D=V+(b^(v|~R))+k[7]+1126891415&4294967295,V=v+(D<<10&4294967295|D>>>22),D=R+(v^(V|~b))+k[14]+2878612391&4294967295,R=V+(D<<15&4294967295|D>>>17),D=b+(V^(R|~v))+k[5]+4237533241&4294967295,b=R+(D<<21&4294967295|D>>>11),D=v+(R^(b|~V))+k[12]+1700485571&4294967295,v=b+(D<<6&4294967295|D>>>26),D=V+(b^(v|~R))+k[3]+2399980690&4294967295,V=v+(D<<10&4294967295|D>>>22),D=R+(v^(V|~b))+k[10]+4293915773&4294967295,R=V+(D<<15&4294967295|D>>>17),D=b+(V^(R|~v))+k[1]+2240044497&4294967295,b=R+(D<<21&4294967295|D>>>11),D=v+(R^(b|~V))+k[8]+1873313359&4294967295,v=b+(D<<6&4294967295|D>>>26),D=V+(b^(v|~R))+k[15]+4264355552&4294967295,V=v+(D<<10&4294967295|D>>>22),D=R+(v^(V|~b))+k[6]+2734768916&4294967295,R=V+(D<<15&4294967295|D>>>17),D=b+(V^(R|~v))+k[13]+1309151649&4294967295,b=R+(D<<21&4294967295|D>>>11),D=v+(R^(b|~V))+k[4]+4149444226&4294967295,v=b+(D<<6&4294967295|D>>>26),D=V+(b^(v|~R))+k[11]+3174756917&4294967295,V=v+(D<<10&4294967295|D>>>22),D=R+(v^(V|~b))+k[2]+718787259&4294967295,R=V+(D<<15&4294967295|D>>>17),D=b+(V^(R|~v))+k[9]+3951481745&4294967295,g.g[0]=g.g[0]+v&4294967295,g.g[1]=g.g[1]+(R+(D<<21&4294967295|D>>>11))&4294967295,g.g[2]=g.g[2]+R&4294967295,g.g[3]=g.g[3]+V&4294967295}r.prototype.v=function(g,v){v===void 0&&(v=g.length);const b=v-this.blockSize,k=this.C;let R=this.h,V=0;for(;V<v;){if(R==0)for(;V<=b;)s(this,g,V),V+=this.blockSize;if(typeof g=="string"){for(;V<v;)if(k[R++]=g.charCodeAt(V++),R==this.blockSize){s(this,k),R=0;break}}else for(;V<v;)if(k[R++]=g[V++],R==this.blockSize){s(this,k),R=0;break}}this.h=R,this.o+=v},r.prototype.A=function(){var g=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);g[0]=128;for(var v=1;v<g.length-8;++v)g[v]=0;v=this.o*8;for(var b=g.length-8;b<g.length;++b)g[b]=v&255,v/=256;for(this.v(g),g=Array(16),v=0,b=0;b<4;++b)for(let k=0;k<32;k+=8)g[v++]=this.g[b]>>>k&255;return g};function i(g,v){var b=l;return Object.prototype.hasOwnProperty.call(b,g)?b[g]:b[g]=v(g)}function a(g,v){this.h=v;const b=[];let k=!0;for(let R=g.length-1;R>=0;R--){const V=g[R]|0;k&&V==v||(b[R]=V,k=!1)}this.g=b}var l={};function c(g){return-128<=g&&g<128?i(g,function(v){return new a([v|0],v<0?-1:0)}):new a([g|0],g<0?-1:0)}function d(g){if(isNaN(g)||!isFinite(g))return f;if(g<0)return A(d(-g));const v=[];let b=1;for(let k=0;g>=b;k++)v[k]=g/b|0,b*=4294967296;return new a(v,0)}function h(g,v){if(g.length==0)throw Error("number format error: empty string");if(v=v||10,v<2||36<v)throw Error("radix out of range: "+v);if(g.charAt(0)=="-")return A(h(g.substring(1),v));if(g.indexOf("-")>=0)throw Error('number format error: interior "-" character');const b=d(Math.pow(v,8));let k=f;for(let V=0;V<g.length;V+=8){var R=Math.min(8,g.length-V);const D=parseInt(g.substring(V,V+R),v);R<8?(R=d(Math.pow(v,R)),k=k.j(R).add(d(D))):(k=k.j(b),k=k.add(d(D)))}return k}var f=c(0),m=c(1),_=c(16777216);t=a.prototype,t.m=function(){if(N(this))return-A(this).m();let g=0,v=1;for(let b=0;b<this.g.length;b++){const k=this.i(b);g+=(k>=0?k:4294967296+k)*v,v*=4294967296}return g},t.toString=function(g){if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(C(this))return"0";if(N(this))return"-"+A(this).toString(g);const v=d(Math.pow(g,6));var b=this;let k="";for(;;){const R=w(b,v).g;b=T(b,R.j(v));let V=((b.g.length>0?b.g[0]:b.h)>>>0).toString(g);if(b=R,C(b))return V+k;for(;V.length<6;)V="0"+V;k=V+k}},t.i=function(g){return g<0?0:g<this.g.length?this.g[g]:this.h};function C(g){if(g.h!=0)return!1;for(let v=0;v<g.g.length;v++)if(g.g[v]!=0)return!1;return!0}function N(g){return g.h==-1}t.l=function(g){return g=T(this,g),N(g)?-1:C(g)?0:1};function A(g){const v=g.g.length,b=[];for(let k=0;k<v;k++)b[k]=~g.g[k];return new a(b,~g.h).add(m)}t.abs=function(){return N(this)?A(this):this},t.add=function(g){const v=Math.max(this.g.length,g.g.length),b=[];let k=0;for(let R=0;R<=v;R++){let V=k+(this.i(R)&65535)+(g.i(R)&65535),D=(V>>>16)+(this.i(R)>>>16)+(g.i(R)>>>16);k=D>>>16,V&=65535,D&=65535,b[R]=D<<16|V}return new a(b,b[b.length-1]&-2147483648?-1:0)};function T(g,v){return g.add(A(v))}t.j=function(g){if(C(this)||C(g))return f;if(N(this))return N(g)?A(this).j(A(g)):A(A(this).j(g));if(N(g))return A(this.j(A(g)));if(this.l(_)<0&&g.l(_)<0)return d(this.m()*g.m());const v=this.g.length+g.g.length,b=[];for(var k=0;k<2*v;k++)b[k]=0;for(k=0;k<this.g.length;k++)for(let R=0;R<g.g.length;R++){const V=this.i(k)>>>16,D=this.i(k)&65535,O=g.i(R)>>>16,ee=g.i(R)&65535;b[2*k+2*R]+=D*ee,I(b,2*k+2*R),b[2*k+2*R+1]+=V*ee,I(b,2*k+2*R+1),b[2*k+2*R+1]+=D*O,I(b,2*k+2*R+1),b[2*k+2*R+2]+=V*O,I(b,2*k+2*R+2)}for(g=0;g<v;g++)b[g]=b[2*g+1]<<16|b[2*g];for(g=v;g<2*v;g++)b[g]=0;return new a(b,0)};function I(g,v){for(;(g[v]&65535)!=g[v];)g[v+1]+=g[v]>>>16,g[v]&=65535,v++}function E(g,v){this.g=g,this.h=v}function w(g,v){if(C(v))throw Error("division by zero");if(C(g))return new E(f,f);if(N(g))return v=w(A(g),v),new E(A(v.g),A(v.h));if(N(v))return v=w(g,A(v)),new E(A(v.g),v.h);if(g.g.length>30){if(N(g)||N(v))throw Error("slowDivide_ only works with positive integers.");for(var b=m,k=v;k.l(g)<=0;)b=S(b),k=S(k);var R=M(b,1),V=M(k,1);for(k=M(k,2),b=M(b,2);!C(k);){var D=V.add(k);D.l(g)<=0&&(R=R.add(b),V=D),k=M(k,1),b=M(b,1)}return v=T(g,R.j(v)),new E(R,v)}for(R=f;g.l(v)>=0;){for(b=Math.max(1,Math.floor(g.m()/v.m())),k=Math.ceil(Math.log(b)/Math.LN2),k=k<=48?1:Math.pow(2,k-48),V=d(b),D=V.j(v);N(D)||D.l(g)>0;)b-=k,V=d(b),D=V.j(v);C(V)&&(V=m),R=R.add(V),g=T(g,D)}return new E(R,g)}t.B=function(g){return w(this,g).h},t.and=function(g){const v=Math.max(this.g.length,g.g.length),b=[];for(let k=0;k<v;k++)b[k]=this.i(k)&g.i(k);return new a(b,this.h&g.h)},t.or=function(g){const v=Math.max(this.g.length,g.g.length),b=[];for(let k=0;k<v;k++)b[k]=this.i(k)|g.i(k);return new a(b,this.h|g.h)},t.xor=function(g){const v=Math.max(this.g.length,g.g.length),b=[];for(let k=0;k<v;k++)b[k]=this.i(k)^g.i(k);return new a(b,this.h^g.h)};function S(g){const v=g.g.length+1,b=[];for(let k=0;k<v;k++)b[k]=g.i(k)<<1|g.i(k-1)>>>31;return new a(b,g.h)}function M(g,v){const b=v>>5;v%=32;const k=g.g.length-b,R=[];for(let V=0;V<k;V++)R[V]=v>0?g.i(V+b)>>>v|g.i(V+b+1)<<32-v:g.i(V+b);return new a(R,g.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,TT=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=h,yi=a}).apply(typeof zb<"u"?zb:typeof self<"u"?self:typeof window<"u"?window:{});var Qu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var CT,Kl,NT,Sd,hg,jT,AT,PT;(function(){var t,e=Object.defineProperty;function n(u){u=[typeof globalThis=="object"&&globalThis,u,typeof window=="object"&&window,typeof self=="object"&&self,typeof Qu=="object"&&Qu];for(var p=0;p<u.length;++p){var y=u[p];if(y&&y.Math==Math)return y}throw Error("Cannot find global object")}var r=n(this);function s(u,p){if(p)e:{var y=r;u=u.split(".");for(var P=0;P<u.length-1;P++){var $=u[P];if(!($ in y))break e;y=y[$]}u=u[u.length-1],P=y[u],p=p(P),p!=P&&p!=null&&e(y,u,{configurable:!0,writable:!0,value:p})}}s("Symbol.dispose",function(u){return u||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(u){return u||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(u){return u||function(p){var y=[],P;for(P in p)Object.prototype.hasOwnProperty.call(p,P)&&y.push([P,p[P]]);return y}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},a=this||self;function l(u){var p=typeof u;return p=="object"&&u!=null||p=="function"}function c(u,p,y){return u.call.apply(u.bind,arguments)}function d(u,p,y){return d=c,d.apply(null,arguments)}function h(u,p){var y=Array.prototype.slice.call(arguments,1);return function(){var P=y.slice();return P.push.apply(P,arguments),u.apply(this,P)}}function f(u,p){function y(){}y.prototype=p.prototype,u.Z=p.prototype,u.prototype=new y,u.prototype.constructor=u,u.Ob=function(P,$,q){for(var fe=Array(arguments.length-2),Qe=2;Qe<arguments.length;Qe++)fe[Qe-2]=arguments[Qe];return p.prototype[$].apply(P,fe)}}var m=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?u=>u&&AsyncContext.Snapshot.wrap(u):u=>u;function _(u){const p=u.length;if(p>0){const y=Array(p);for(let P=0;P<p;P++)y[P]=u[P];return y}return[]}function C(u,p){for(let P=1;P<arguments.length;P++){const $=arguments[P];var y=typeof $;if(y=y!="object"?y:$?Array.isArray($)?"array":y:"null",y=="array"||y=="object"&&typeof $.length=="number"){y=u.length||0;const q=$.length||0;u.length=y+q;for(let fe=0;fe<q;fe++)u[y+fe]=$[fe]}else u.push($)}}class N{constructor(p,y){this.i=p,this.j=y,this.h=0,this.g=null}get(){let p;return this.h>0?(this.h--,p=this.g,this.g=p.next,p.next=null):p=this.i(),p}}function A(u){a.setTimeout(()=>{throw u},0)}function T(){var u=g;let p=null;return u.g&&(p=u.g,u.g=u.g.next,u.g||(u.h=null),p.next=null),p}class I{constructor(){this.h=this.g=null}add(p,y){const P=E.get();P.set(p,y),this.h?this.h.next=P:this.g=P,this.h=P}}var E=new N(()=>new w,u=>u.reset());class w{constructor(){this.next=this.g=this.h=null}set(p,y){this.h=p,this.g=y,this.next=null}reset(){this.next=this.g=this.h=null}}let S,M=!1,g=new I,v=()=>{const u=Promise.resolve(void 0);S=()=>{u.then(b)}};function b(){for(var u;u=T();){try{u.h.call(u.g)}catch(y){A(y)}var p=E;p.j(u),p.h<100&&(p.h++,u.next=p.g,p.g=u)}M=!1}function k(){this.u=this.u,this.C=this.C}k.prototype.u=!1,k.prototype.dispose=function(){this.u||(this.u=!0,this.N())},k.prototype[Symbol.dispose]=function(){this.dispose()},k.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function R(u,p){this.type=u,this.g=this.target=p,this.defaultPrevented=!1}R.prototype.h=function(){this.defaultPrevented=!0};var V=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var u=!1,p=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const y=()=>{};a.addEventListener("test",y,p),a.removeEventListener("test",y,p)}catch{}return u}();function D(u){return/^[\s\xa0]*$/.test(u)}function O(u,p){R.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u&&this.init(u,p)}f(O,R),O.prototype.init=function(u,p){const y=this.type=u.type,P=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;this.target=u.target||u.srcElement,this.g=p,p=u.relatedTarget,p||(y=="mouseover"?p=u.fromElement:y=="mouseout"&&(p=u.toElement)),this.relatedTarget=p,P?(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0):(this.clientX=u.clientX!==void 0?u.clientX:u.pageX,this.clientY=u.clientY!==void 0?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType=u.pointerType,this.state=u.state,this.i=u,u.defaultPrevented&&O.Z.h.call(this)},O.prototype.h=function(){O.Z.h.call(this);const u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var ee="closure_listenable_"+(Math.random()*1e6|0),ye=0;function He(u,p,y,P,$){this.listener=u,this.proxy=null,this.src=p,this.type=y,this.capture=!!P,this.ha=$,this.key=++ye,this.da=this.fa=!1}function X(u){u.da=!0,u.listener=null,u.proxy=null,u.src=null,u.ha=null}function te(u,p,y){for(const P in u)p.call(y,u[P],P,u)}function de(u,p){for(const y in u)p.call(void 0,u[y],y,u)}function ne(u){const p={};for(const y in u)p[y]=u[y];return p}const he="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ce(u,p){let y,P;for(let $=1;$<arguments.length;$++){P=arguments[$];for(y in P)u[y]=P[y];for(let q=0;q<he.length;q++)y=he[q],Object.prototype.hasOwnProperty.call(P,y)&&(u[y]=P[y])}}function Ue(u){this.src=u,this.g={},this.h=0}Ue.prototype.add=function(u,p,y,P,$){const q=u.toString();u=this.g[q],u||(u=this.g[q]=[],this.h++);const fe=Ke(u,p,P,$);return fe>-1?(p=u[fe],y||(p.fa=!1)):(p=new He(p,this.src,q,!!P,$),p.fa=y,u.push(p)),p};function $e(u,p){const y=p.type;if(y in u.g){var P=u.g[y],$=Array.prototype.indexOf.call(P,p,void 0),q;(q=$>=0)&&Array.prototype.splice.call(P,$,1),q&&(X(p),u.g[y].length==0&&(delete u.g[y],u.h--))}}function Ke(u,p,y,P){for(let $=0;$<u.length;++$){const q=u[$];if(!q.da&&q.listener==p&&q.capture==!!y&&q.ha==P)return $}return-1}var mt="closure_lm_"+(Math.random()*1e6|0),gt={};function Gt(u,p,y,P,$){if(Array.isArray(p)){for(let q=0;q<p.length;q++)Gt(u,p[q],y,P,$);return null}return y=Y(y),u&&u[ee]?u.J(p,y,l(P)?!!P.capture:!1,$):H(u,p,y,!1,P,$)}function H(u,p,y,P,$,q){if(!p)throw Error("Invalid event type");const fe=l($)?!!$.capture:!!$;let Qe=ve(u);if(Qe||(u[mt]=Qe=new Ue(u)),y=Qe.add(p,y,P,fe,q),y.proxy)return y;if(P=me(),y.proxy=P,P.src=u,P.listener=y,u.addEventListener)V||($=fe),$===void 0&&($=!1),u.addEventListener(p.toString(),P,$);else if(u.attachEvent)u.attachEvent(Z(p.toString()),P);else if(u.addListener&&u.removeListener)u.addListener(P);else throw Error("addEventListener and attachEvent are unavailable.");return y}function me(){function u(y){return p.call(u.src,u.listener,y)}const p=Ie;return u}function _e(u,p,y,P,$){if(Array.isArray(p))for(var q=0;q<p.length;q++)_e(u,p[q],y,P,$);else P=l(P)?!!P.capture:!!P,y=Y(y),u&&u[ee]?(u=u.i,q=String(p).toString(),q in u.g&&(p=u.g[q],y=Ke(p,y,P,$),y>-1&&(X(p[y]),Array.prototype.splice.call(p,y,1),p.length==0&&(delete u.g[q],u.h--)))):u&&(u=ve(u))&&(p=u.g[p.toString()],u=-1,p&&(u=Ke(p,y,P,$)),(y=u>-1?p[u]:null)&&J(y))}function J(u){if(typeof u!="number"&&u&&!u.da){var p=u.src;if(p&&p[ee])$e(p.i,u);else{var y=u.type,P=u.proxy;p.removeEventListener?p.removeEventListener(y,P,u.capture):p.detachEvent?p.detachEvent(Z(y),P):p.addListener&&p.removeListener&&p.removeListener(P),(y=ve(p))?($e(y,u),y.h==0&&(y.src=null,p[mt]=null)):X(u)}}}function Z(u){return u in gt?gt[u]:gt[u]="on"+u}function Ie(u,p){if(u.da)u=!0;else{p=new O(p,this);const y=u.listener,P=u.ha||u.src;u.fa&&J(u),u=y.call(P,p)}return u}function ve(u){return u=u[mt],u instanceof Ue?u:null}var K="__closure_events_fn_"+(Math.random()*1e9>>>0);function Y(u){return typeof u=="function"?u:(u[K]||(u[K]=function(p){return u.handleEvent(p)}),u[K])}function B(){k.call(this),this.i=new Ue(this),this.M=this,this.G=null}f(B,k),B.prototype[ee]=!0,B.prototype.removeEventListener=function(u,p,y,P){_e(this,u,p,y,P)};function ge(u,p){var y,P=u.G;if(P)for(y=[];P;P=P.G)y.push(P);if(u=u.M,P=p.type||p,typeof p=="string")p=new R(p,u);else if(p instanceof R)p.target=p.target||u;else{var $=p;p=new R(P,u),Ce(p,$)}$=!0;let q,fe;if(y)for(fe=y.length-1;fe>=0;fe--)q=p.g=y[fe],$=De(q,P,!0,p)&&$;if(q=p.g=u,$=De(q,P,!0,p)&&$,$=De(q,P,!1,p)&&$,y)for(fe=0;fe<y.length;fe++)q=p.g=y[fe],$=De(q,P,!1,p)&&$}B.prototype.N=function(){if(B.Z.N.call(this),this.i){var u=this.i;for(const p in u.g){const y=u.g[p];for(let P=0;P<y.length;P++)X(y[P]);delete u.g[p],u.h--}}this.G=null},B.prototype.J=function(u,p,y,P){return this.i.add(String(u),p,!1,y,P)},B.prototype.K=function(u,p,y,P){return this.i.add(String(u),p,!0,y,P)};function De(u,p,y,P){if(p=u.i.g[String(p)],!p)return!0;p=p.concat();let $=!0;for(let q=0;q<p.length;++q){const fe=p[q];if(fe&&!fe.da&&fe.capture==y){const Qe=fe.listener,Jt=fe.ha||fe.src;fe.fa&&$e(u.i,fe),$=Qe.call(Jt,P)!==!1&&$}}return $&&!P.defaultPrevented}function Be(u,p){if(typeof u!="function")if(u&&typeof u.handleEvent=="function")u=d(u.handleEvent,u);else throw Error("Invalid listener argument");return Number(p)>2147483647?-1:a.setTimeout(u,p||0)}function Le(u){u.g=Be(()=>{u.g=null,u.i&&(u.i=!1,Le(u))},u.l);const p=u.h;u.h=null,u.m.apply(null,p)}class We extends k{constructor(p,y){super(),this.m=p,this.l=y,this.h=null,this.i=!1,this.g=null}j(p){this.h=arguments,this.g?this.i=!0:Le(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function be(u){k.call(this),this.h=u,this.g={}}f(be,k);var rt=[];function Xe(u){te(u.g,function(p,y){this.g.hasOwnProperty(y)&&J(p)},u),u.g={}}be.prototype.N=function(){be.Z.N.call(this),Xe(this)},be.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var xt=a.JSON.stringify,z=a.JSON.parse,le=class{stringify(u){return a.JSON.stringify(u,void 0)}parse(u){return a.JSON.parse(u,void 0)}};function L(){}function F(){}var re={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ue(){R.call(this,"d")}f(ue,R);function Ae(){R.call(this,"c")}f(Ae,R);var Pe={},Fe=null;function Oe(){return Fe=Fe||new B}Pe.Ia="serverreachability";function nt(u){R.call(this,Pe.Ia,u)}f(nt,R);function ct(u){const p=Oe();ge(p,new nt(p))}Pe.STAT_EVENT="statevent";function Ot(u,p){R.call(this,Pe.STAT_EVENT,u),this.stat=p}f(Ot,R);function Ge(u){const p=Oe();ge(p,new Ot(p,u))}Pe.Ja="timingevent";function Qn(u,p){R.call(this,Pe.Ja,u),this.size=p}f(Qn,R);function Ht(u,p){if(typeof u!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){u()},p)}function lt(){this.g=!0}lt.prototype.ua=function(){this.g=!1};function un(u,p,y,P,$,q){u.info(function(){if(u.g)if(q){var fe="",Qe=q.split("&");for(let yt=0;yt<Qe.length;yt++){var Jt=Qe[yt].split("=");if(Jt.length>1){const rn=Jt[0];Jt=Jt[1];const qr=rn.split("_");fe=qr.length>=2&&qr[1]=="type"?fe+(rn+"="+Jt+"&"):fe+(rn+"=redacted&")}}}else fe=null;else fe=q;return"XMLHTTP REQ ("+P+") [attempt "+$+"]: "+p+`
`+y+`
`+fe})}function gn(u,p,y,P,$,q,fe){u.info(function(){return"XMLHTTP RESP ("+P+") [ attempt "+$+"]: "+p+`
`+y+`
`+q+" "+fe})}function yn(u,p,y,P){u.info(function(){return"XMLHTTP TEXT ("+p+"): "+pl(u,y)+(P?" "+P:"")})}function Er(u,p){u.info(function(){return"TIMEOUT: "+p})}lt.prototype.info=function(){};function pl(u,p){if(!u.g)return p;if(!p)return null;try{const q=JSON.parse(p);if(q){for(u=0;u<q.length;u++)if(Array.isArray(q[u])){var y=q[u];if(!(y.length<2)){var P=y[1];if(Array.isArray(P)&&!(P.length<1)){var $=P[0];if($!="noop"&&$!="stop"&&$!="close")for(let fe=1;fe<P.length;fe++)P[fe]=""}}}}return xt(q)}catch{return p}}var ls={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Oi={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},j;function W(){}f(W,L),W.prototype.g=function(){return new XMLHttpRequest},j=new W;function ie(u){return encodeURIComponent(String(u))}function xe(u){var p=1;u=u.split(":");const y=[];for(;p>0&&u.length;)y.push(u.shift()),p--;return u.length&&y.push(u.join(":")),y}function Se(u,p,y,P){this.j=u,this.i=p,this.l=y,this.S=P||1,this.V=new be(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new qe}function qe(){this.i=null,this.g="",this.h=!1}var bt={},Un={};function jn(u,p,y){u.M=1,u.A=wu(zr(p)),u.u=y,u.R=!0,St(u,null)}function St(u,p){u.F=Date.now(),cs(u),u.B=zr(u.A);var y=u.B,P=u.S;Array.isArray(P)||(P=[String(P)]),N_(y.i,"t",P),u.C=0,y=u.j.L,u.h=new qe,u.g=W_(u.j,y?p:null,!u.u),u.P>0&&(u.O=new We(d(u.Y,u,u.g),u.P)),p=u.V,y=u.g,P=u.ba;var $="readystatechange";Array.isArray($)||($&&(rt[0]=$.toString()),$=rt);for(let q=0;q<$.length;q++){const fe=Gt(y,$[q],P||p.handleEvent,!1,p.h||p);if(!fe)break;p.g[fe.key]=fe}p=u.J?ne(u.J):{},u.u?(u.v||(u.v="POST"),p["Content-Type"]="application/x-www-form-urlencoded",u.g.ea(u.B,u.v,u.u,p)):(u.v="GET",u.g.ea(u.B,u.v,null,p)),ct(),un(u.i,u.v,u.B,u.l,u.S,u.u)}Se.prototype.ba=function(u){u=u.target;const p=this.O;p&&Vs(u)==3?p.j():this.Y(u)},Se.prototype.Y=function(u){try{if(u==this.g)e:{const Qe=Vs(this.g),Jt=this.g.ya(),yt=this.g.ca();if(!(Qe<3)&&(Qe!=3||this.g&&(this.h.h||this.g.la()||L_(this.g)))){this.K||Qe!=4||Jt==7||(Jt==8||yt<=0?ct(3):ct(2)),Uo(this);var p=this.g.ca();this.X=p;var y=At(this);if(this.o=p==200,gn(this.i,this.v,this.B,this.l,this.S,Qe,p),this.o){if(this.U&&!this.L){t:{if(this.g){var P,$=this.g;if((P=$.g?$.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(P)){var q=P;break t}}q=null}if(u=q)yn(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Wf(this,u);else{this.o=!1,this.m=3,Ge(12),Vi(this),ds(this);break e}}if(this.R){u=!0;let rn;for(;!this.K&&this.C<y.length;)if(rn=Ir(this,y),rn==Un){Qe==4&&(this.m=4,Ge(14),u=!1),yn(this.i,this.l,null,"[Incomplete Response]");break}else if(rn==bt){this.m=4,Ge(15),yn(this.i,this.l,y,"[Invalid Chunk]"),u=!1;break}else yn(this.i,this.l,rn,null),Wf(this,rn);if($n(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Qe!=4||y.length!=0||this.h.h||(this.m=1,Ge(16),u=!1),this.o=this.o&&u,!u)yn(this.i,this.l,y,"[Invalid Chunked Response]"),Vi(this),ds(this);else if(y.length>0&&!this.W){this.W=!0;var fe=this.j;fe.g==this&&fe.aa&&!fe.P&&(fe.j.info("Great, no buffering proxy detected. Bytes received: "+y.length),ep(fe),fe.P=!0,Ge(11))}}else yn(this.i,this.l,y,null),Wf(this,y);Qe==4&&Vi(this),this.o&&!this.K&&(Qe==4?B_(this.j,this):(this.o=!1,cs(this)))}else F1(this.g),p==400&&y.indexOf("Unknown SID")>0?(this.m=3,Ge(12)):(this.m=0,Ge(13)),Vi(this),ds(this)}}}catch{}finally{}};function At(u){if(!$n(u))return u.g.la();const p=L_(u.g);if(p==="")return"";let y="";const P=p.length,$=Vs(u.g)==4;if(!u.h.i){if(typeof TextDecoder>"u")return Vi(u),ds(u),"";u.h.i=new a.TextDecoder}for(let q=0;q<P;q++)u.h.h=!0,y+=u.h.i.decode(p[q],{stream:!($&&q==P-1)});return p.length=0,u.h.g+=y,u.C=0,u.h.g}function $n(u){return u.g?u.v=="GET"&&u.M!=2&&u.j.Aa:!1}function Ir(u,p){var y=u.C,P=p.indexOf(`
`,y);return P==-1?Un:(y=Number(p.substring(y,P)),isNaN(y)?bt:(P+=1,P+y>p.length?Un:(p=p.slice(P,P+y),u.C=P+y,p)))}Se.prototype.cancel=function(){this.K=!0,Vi(this)};function cs(u){u.T=Date.now()+u.H,us(u,u.H)}function us(u,p){if(u.D!=null)throw Error("WatchDog timer not null");u.D=Ht(d(u.aa,u),p)}function Uo(u){u.D&&(a.clearTimeout(u.D),u.D=null)}Se.prototype.aa=function(){this.D=null;const u=Date.now();u-this.T>=0?(Er(this.i,this.B),this.M!=2&&(ct(),Ge(17)),Vi(this),this.m=2,ds(this)):us(this,this.T-u)};function ds(u){u.j.I==0||u.K||B_(u.j,u)}function Vi(u){Uo(u);var p=u.O;p&&typeof p.dispose=="function"&&p.dispose(),u.O=null,Xe(u.V),u.g&&(p=u.g,u.g=null,p.abort(),p.dispose())}function Wf(u,p){try{var y=u.j;if(y.I!=0&&(y.g==u||Gf(y.h,u))){if(!u.L&&Gf(y.h,u)&&y.I==3){try{var P=y.Ba.g.parse(p)}catch{P=null}if(Array.isArray(P)&&P.length==3){var $=P;if($[0]==0){e:if(!y.v){if(y.g)if(y.g.F+3e3<u.F)Cu(y),Su(y);else break e;Zf(y),Ge(18)}}else y.xa=$[1],0<y.xa-y.K&&$[2]<37500&&y.F&&y.A==0&&!y.C&&(y.C=Ht(d(y.Va,y),6e3));x_(y.h)<=1&&y.ta&&(y.ta=void 0)}else Fi(y,11)}else if((u.L||y.g==u)&&Cu(y),!D(p))for($=y.Ba.g.parse(p),p=0;p<$.length;p++){let yt=$[p];const rn=yt[0];if(!(rn<=y.K))if(y.K=rn,yt=yt[1],y.I==2)if(yt[0]=="c"){y.M=yt[1],y.ba=yt[2];const qr=yt[3];qr!=null&&(y.ka=qr,y.j.info("VER="+y.ka));const Ui=yt[4];Ui!=null&&(y.za=Ui,y.j.info("SVER="+y.za));const Ms=yt[5];Ms!=null&&typeof Ms=="number"&&Ms>0&&(P=1.5*Ms,y.O=P,y.j.info("backChannelRequestTimeoutMs_="+P)),P=y;const Fs=u.g;if(Fs){const ju=Fs.g?Fs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ju){var q=P.h;q.g||ju.indexOf("spdy")==-1&&ju.indexOf("quic")==-1&&ju.indexOf("h2")==-1||(q.j=q.l,q.g=new Set,q.h&&(Kf(q,q.h),q.h=null))}if(P.G){const tp=Fs.g?Fs.g.getResponseHeader("X-HTTP-Session-Id"):null;tp&&(P.wa=tp,wt(P.J,P.G,tp))}}y.I=3,y.l&&y.l.ra(),y.aa&&(y.T=Date.now()-u.F,y.j.info("Handshake RTT: "+y.T+"ms")),P=y;var fe=u;if(P.na=H_(P,P.L?P.ba:null,P.W),fe.L){b_(P.h,fe);var Qe=fe,Jt=P.O;Jt&&(Qe.H=Jt),Qe.D&&(Uo(Qe),cs(Qe)),P.g=fe}else U_(P);y.i.length>0&&Tu(y)}else yt[0]!="stop"&&yt[0]!="close"||Fi(y,7);else y.I==3&&(yt[0]=="stop"||yt[0]=="close"?yt[0]=="stop"?Fi(y,7):Jf(y):yt[0]!="noop"&&y.l&&y.l.qa(yt),y.A=0)}}ct(4)}catch{}}var T1=class{constructor(u,p){this.g=u,this.map=p}};function v_(u){this.l=u||10,a.PerformanceNavigationTiming?(u=a.performance.getEntriesByType("navigation"),u=u.length>0&&(u[0].nextHopProtocol=="hq"||u[0].nextHopProtocol=="h2")):u=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=u?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function __(u){return u.h?!0:u.g?u.g.size>=u.j:!1}function x_(u){return u.h?1:u.g?u.g.size:0}function Gf(u,p){return u.h?u.h==p:u.g?u.g.has(p):!1}function Kf(u,p){u.g?u.g.add(p):u.h=p}function b_(u,p){u.h&&u.h==p?u.h=null:u.g&&u.g.has(p)&&u.g.delete(p)}v_.prototype.cancel=function(){if(this.i=w_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const u of this.g.values())u.cancel();this.g.clear()}};function w_(u){if(u.h!=null)return u.i.concat(u.h.G);if(u.g!=null&&u.g.size!==0){let p=u.i;for(const y of u.g.values())p=p.concat(y.G);return p}return _(u.i)}var E_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function C1(u,p){if(u){u=u.split("&");for(let y=0;y<u.length;y++){const P=u[y].indexOf("=");let $,q=null;P>=0?($=u[y].substring(0,P),q=u[y].substring(P+1)):$=u[y],p($,q?decodeURIComponent(q.replace(/\+/g," ")):"")}}}function Ls(u){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let p;u instanceof Ls?(this.l=u.l,ml(this,u.j),this.o=u.o,this.g=u.g,gl(this,u.u),this.h=u.h,Qf(this,j_(u.i)),this.m=u.m):u&&(p=String(u).match(E_))?(this.l=!1,ml(this,p[1]||"",!0),this.o=yl(p[2]||""),this.g=yl(p[3]||"",!0),gl(this,p[4]),this.h=yl(p[5]||"",!0),Qf(this,p[6]||"",!0),this.m=yl(p[7]||"")):(this.l=!1,this.i=new _l(null,this.l))}Ls.prototype.toString=function(){const u=[];var p=this.j;p&&u.push(vl(p,I_,!0),":");var y=this.g;return(y||p=="file")&&(u.push("//"),(p=this.o)&&u.push(vl(p,I_,!0),"@"),u.push(ie(y).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),y=this.u,y!=null&&u.push(":",String(y))),(y=this.h)&&(this.g&&y.charAt(0)!="/"&&u.push("/"),u.push(vl(y,y.charAt(0)=="/"?A1:j1,!0))),(y=this.i.toString())&&u.push("?",y),(y=this.m)&&u.push("#",vl(y,R1)),u.join("")},Ls.prototype.resolve=function(u){const p=zr(this);let y=!!u.j;y?ml(p,u.j):y=!!u.o,y?p.o=u.o:y=!!u.g,y?p.g=u.g:y=u.u!=null;var P=u.h;if(y)gl(p,u.u);else if(y=!!u.h){if(P.charAt(0)!="/")if(this.g&&!this.h)P="/"+P;else{var $=p.h.lastIndexOf("/");$!=-1&&(P=p.h.slice(0,$+1)+P)}if($=P,$==".."||$==".")P="";else if($.indexOf("./")!=-1||$.indexOf("/.")!=-1){P=$.lastIndexOf("/",0)==0,$=$.split("/");const q=[];for(let fe=0;fe<$.length;){const Qe=$[fe++];Qe=="."?P&&fe==$.length&&q.push(""):Qe==".."?((q.length>1||q.length==1&&q[0]!="")&&q.pop(),P&&fe==$.length&&q.push("")):(q.push(Qe),P=!0)}P=q.join("/")}else P=$}return y?p.h=P:y=u.i.toString()!=="",y?Qf(p,j_(u.i)):y=!!u.m,y&&(p.m=u.m),p};function zr(u){return new Ls(u)}function ml(u,p,y){u.j=y?yl(p,!0):p,u.j&&(u.j=u.j.replace(/:$/,""))}function gl(u,p){if(p){if(p=Number(p),isNaN(p)||p<0)throw Error("Bad port number "+p);u.u=p}else u.u=null}function Qf(u,p,y){p instanceof _l?(u.i=p,k1(u.i,u.l)):(y||(p=vl(p,P1)),u.i=new _l(p,u.l))}function wt(u,p,y){u.i.set(p,y)}function wu(u){return wt(u,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),u}function yl(u,p){return u?p?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function vl(u,p,y){return typeof u=="string"?(u=encodeURI(u).replace(p,N1),y&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function N1(u){return u=u.charCodeAt(0),"%"+(u>>4&15).toString(16)+(u&15).toString(16)}var I_=/[#\/\?@]/g,j1=/[#\?:]/g,A1=/[#\?]/g,P1=/[#\?@]/g,R1=/#/g;function _l(u,p){this.h=this.g=null,this.i=u||null,this.j=!!p}function Mi(u){u.g||(u.g=new Map,u.h=0,u.i&&C1(u.i,function(p,y){u.add(decodeURIComponent(p.replace(/\+/g," ")),y)}))}t=_l.prototype,t.add=function(u,p){Mi(this),this.i=null,u=$o(this,u);let y=this.g.get(u);return y||this.g.set(u,y=[]),y.push(p),this.h+=1,this};function S_(u,p){Mi(u),p=$o(u,p),u.g.has(p)&&(u.i=null,u.h-=u.g.get(p).length,u.g.delete(p))}function T_(u,p){return Mi(u),p=$o(u,p),u.g.has(p)}t.forEach=function(u,p){Mi(this),this.g.forEach(function(y,P){y.forEach(function($){u.call(p,$,P,this)},this)},this)};function C_(u,p){Mi(u);let y=[];if(typeof p=="string")T_(u,p)&&(y=y.concat(u.g.get($o(u,p))));else for(u=Array.from(u.g.values()),p=0;p<u.length;p++)y=y.concat(u[p]);return y}t.set=function(u,p){return Mi(this),this.i=null,u=$o(this,u),T_(this,u)&&(this.h-=this.g.get(u).length),this.g.set(u,[p]),this.h+=1,this},t.get=function(u,p){return u?(u=C_(this,u),u.length>0?String(u[0]):p):p};function N_(u,p,y){S_(u,p),y.length>0&&(u.i=null,u.g.set($o(u,p),_(y)),u.h+=y.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],p=Array.from(this.g.keys());for(let P=0;P<p.length;P++){var y=p[P];const $=ie(y);y=C_(this,y);for(let q=0;q<y.length;q++){let fe=$;y[q]!==""&&(fe+="="+ie(y[q])),u.push(fe)}}return this.i=u.join("&")};function j_(u){const p=new _l;return p.i=u.i,u.g&&(p.g=new Map(u.g),p.h=u.h),p}function $o(u,p){return p=String(p),u.j&&(p=p.toLowerCase()),p}function k1(u,p){p&&!u.j&&(Mi(u),u.i=null,u.g.forEach(function(y,P){const $=P.toLowerCase();P!=$&&(S_(this,P),N_(this,$,y))},u)),u.j=p}function D1(u,p){const y=new lt;if(a.Image){const P=new Image;P.onload=h(Os,y,"TestLoadImage: loaded",!0,p,P),P.onerror=h(Os,y,"TestLoadImage: error",!1,p,P),P.onabort=h(Os,y,"TestLoadImage: abort",!1,p,P),P.ontimeout=h(Os,y,"TestLoadImage: timeout",!1,p,P),a.setTimeout(function(){P.ontimeout&&P.ontimeout()},1e4),P.src=u}else p(!1)}function L1(u,p){const y=new lt,P=new AbortController,$=setTimeout(()=>{P.abort(),Os(y,"TestPingServer: timeout",!1,p)},1e4);fetch(u,{signal:P.signal}).then(q=>{clearTimeout($),q.ok?Os(y,"TestPingServer: ok",!0,p):Os(y,"TestPingServer: server error",!1,p)}).catch(()=>{clearTimeout($),Os(y,"TestPingServer: error",!1,p)})}function Os(u,p,y,P,$){try{$&&($.onload=null,$.onerror=null,$.onabort=null,$.ontimeout=null),P(y)}catch{}}function O1(){this.g=new le}function Yf(u){this.i=u.Sb||null,this.h=u.ab||!1}f(Yf,L),Yf.prototype.g=function(){return new Eu(this.i,this.h)};function Eu(u,p){B.call(this),this.H=u,this.o=p,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}f(Eu,B),t=Eu.prototype,t.open=function(u,p){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=u,this.D=p,this.readyState=1,bl(this)},t.send=function(u){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const p={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};u&&(p.body=u),(this.H||a).fetch(new Request(this.D,p)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,xl(this)),this.readyState=0},t.Pa=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,bl(this)),this.g&&(this.readyState=3,bl(this),this.g)))if(this.responseType==="arraybuffer")u.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;A_(this)}else u.text().then(this.Oa.bind(this),this.ga.bind(this))};function A_(u){u.j.read().then(u.Ma.bind(u)).catch(u.ga.bind(u))}t.Ma=function(u){if(this.g){if(this.o&&u.value)this.response.push(u.value);else if(!this.o){var p=u.value?u.value:new Uint8Array(0);(p=this.B.decode(p,{stream:!u.done}))&&(this.response=this.responseText+=p)}u.done?xl(this):bl(this),this.readyState==3&&A_(this)}},t.Oa=function(u){this.g&&(this.response=this.responseText=u,xl(this))},t.Na=function(u){this.g&&(this.response=u,xl(this))},t.ga=function(){this.g&&xl(this)};function xl(u){u.readyState=4,u.l=null,u.j=null,u.B=null,bl(u)}t.setRequestHeader=function(u,p){this.A.append(u,p)},t.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],p=this.h.entries();for(var y=p.next();!y.done;)y=y.value,u.push(y[0]+": "+y[1]),y=p.next();return u.join(`\r
`)};function bl(u){u.onreadystatechange&&u.onreadystatechange.call(u)}Object.defineProperty(Eu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(u){this.m=u?"include":"same-origin"}});function P_(u){let p="";return te(u,function(y,P){p+=P,p+=":",p+=y,p+=`\r
`}),p}function Xf(u,p,y){e:{for(P in y){var P=!1;break e}P=!0}P||(y=P_(y),typeof u=="string"?y!=null&&ie(y):wt(u,p,y))}function Vt(u){B.call(this),this.headers=new Map,this.L=u||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}f(Vt,B);var V1=/^https?$/i,M1=["POST","PUT"];t=Vt.prototype,t.Fa=function(u){this.H=u},t.ea=function(u,p,y,P){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+u);p=p?p.toUpperCase():"GET",this.D=u,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():j.g(),this.g.onreadystatechange=m(d(this.Ca,this));try{this.B=!0,this.g.open(p,String(u),!0),this.B=!1}catch(q){R_(this,q);return}if(u=y||"",y=new Map(this.headers),P)if(Object.getPrototypeOf(P)===Object.prototype)for(var $ in P)y.set($,P[$]);else if(typeof P.keys=="function"&&typeof P.get=="function")for(const q of P.keys())y.set(q,P.get(q));else throw Error("Unknown input type for opt_headers: "+String(P));P=Array.from(y.keys()).find(q=>q.toLowerCase()=="content-type"),$=a.FormData&&u instanceof a.FormData,!(Array.prototype.indexOf.call(M1,p,void 0)>=0)||P||$||y.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[q,fe]of y)this.g.setRequestHeader(q,fe);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(u),this.v=!1}catch(q){R_(this,q)}};function R_(u,p){u.h=!1,u.g&&(u.j=!0,u.g.abort(),u.j=!1),u.l=p,u.o=5,k_(u),Iu(u)}function k_(u){u.A||(u.A=!0,ge(u,"complete"),ge(u,"error"))}t.abort=function(u){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=u||7,ge(this,"complete"),ge(this,"abort"),Iu(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Iu(this,!0)),Vt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?D_(this):this.Xa())},t.Xa=function(){D_(this)};function D_(u){if(u.h&&typeof i<"u"){if(u.v&&Vs(u)==4)setTimeout(u.Ca.bind(u),0);else if(ge(u,"readystatechange"),Vs(u)==4){u.h=!1;try{const q=u.ca();e:switch(q){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var p=!0;break e;default:p=!1}var y;if(!(y=p)){var P;if(P=q===0){let fe=String(u.D).match(E_)[1]||null;!fe&&a.self&&a.self.location&&(fe=a.self.location.protocol.slice(0,-1)),P=!V1.test(fe?fe.toLowerCase():"")}y=P}if(y)ge(u,"complete"),ge(u,"success");else{u.o=6;try{var $=Vs(u)>2?u.g.statusText:""}catch{$=""}u.l=$+" ["+u.ca()+"]",k_(u)}}finally{Iu(u)}}}}function Iu(u,p){if(u.g){u.m&&(clearTimeout(u.m),u.m=null);const y=u.g;u.g=null,p||ge(u,"ready");try{y.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Vs(u){return u.g?u.g.readyState:0}t.ca=function(){try{return Vs(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(u){if(this.g){var p=this.g.responseText;return u&&p.indexOf(u)==0&&(p=p.substring(u.length)),z(p)}};function L_(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.F){case"":case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function F1(u){const p={};u=(u.g&&Vs(u)>=2&&u.g.getAllResponseHeaders()||"").split(`\r
`);for(let P=0;P<u.length;P++){if(D(u[P]))continue;var y=xe(u[P]);const $=y[0];if(y=y[1],typeof y!="string")continue;y=y.trim();const q=p[$]||[];p[$]=q,q.push(y)}de(p,function(P){return P.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function wl(u,p,y){return y&&y.internalChannelParams&&y.internalChannelParams[u]||p}function O_(u){this.za=0,this.i=[],this.j=new lt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=wl("failFast",!1,u),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=wl("baseRetryDelayMs",5e3,u),this.Za=wl("retryDelaySeedMs",1e4,u),this.Ta=wl("forwardChannelMaxRetries",2,u),this.va=wl("forwardChannelRequestTimeoutMs",2e4,u),this.ma=u&&u.xmlHttpFactory||void 0,this.Ua=u&&u.Rb||void 0,this.Aa=u&&u.useFetchStreams||!1,this.O=void 0,this.L=u&&u.supportsCrossDomainXhr||!1,this.M="",this.h=new v_(u&&u.concurrentRequestLimit),this.Ba=new O1,this.S=u&&u.fastHandshake||!1,this.R=u&&u.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=u&&u.Pb||!1,u&&u.ua&&this.j.ua(),u&&u.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&u&&u.detectBufferingProxy||!1,this.ia=void 0,u&&u.longPollingTimeout&&u.longPollingTimeout>0&&(this.ia=u.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=O_.prototype,t.ka=8,t.I=1,t.connect=function(u,p,y,P){Ge(0),this.W=u,this.H=p||{},y&&P!==void 0&&(this.H.OSID=y,this.H.OAID=P),this.F=this.X,this.J=H_(this,null,this.W),Tu(this)};function Jf(u){if(V_(u),u.I==3){var p=u.V++,y=zr(u.J);if(wt(y,"SID",u.M),wt(y,"RID",p),wt(y,"TYPE","terminate"),El(u,y),p=new Se(u,u.j,p),p.M=2,p.A=wu(zr(y)),y=!1,a.navigator&&a.navigator.sendBeacon)try{y=a.navigator.sendBeacon(p.A.toString(),"")}catch{}!y&&a.Image&&(new Image().src=p.A,y=!0),y||(p.g=W_(p.j,null),p.g.ea(p.A)),p.F=Date.now(),cs(p)}q_(u)}function Su(u){u.g&&(ep(u),u.g.cancel(),u.g=null)}function V_(u){Su(u),u.v&&(a.clearTimeout(u.v),u.v=null),Cu(u),u.h.cancel(),u.m&&(typeof u.m=="number"&&a.clearTimeout(u.m),u.m=null)}function Tu(u){if(!__(u.h)&&!u.m){u.m=!0;var p=u.Ea;S||v(),M||(S(),M=!0),g.add(p,u),u.D=0}}function U1(u,p){return x_(u.h)>=u.h.j-(u.m?1:0)?!1:u.m?(u.i=p.G.concat(u.i),!0):u.I==1||u.I==2||u.D>=(u.Sa?0:u.Ta)?!1:(u.m=Ht(d(u.Ea,u,p),z_(u,u.D)),u.D++,!0)}t.Ea=function(u){if(this.m)if(this.m=null,this.I==1){if(!u){this.V=Math.floor(Math.random()*1e5),u=this.V++;const $=new Se(this,this.j,u);let q=this.o;if(this.U&&(q?(q=ne(q),Ce(q,this.U)):q=this.U),this.u!==null||this.R||($.J=q,q=null),this.S)e:{for(var p=0,y=0;y<this.i.length;y++){t:{var P=this.i[y];if("__data__"in P.map&&(P=P.map.__data__,typeof P=="string")){P=P.length;break t}P=void 0}if(P===void 0)break;if(p+=P,p>4096){p=y;break e}if(p===4096||y===this.i.length-1){p=y+1;break e}}p=1e3}else p=1e3;p=F_(this,$,p),y=zr(this.J),wt(y,"RID",u),wt(y,"CVER",22),this.G&&wt(y,"X-HTTP-Session-Id",this.G),El(this,y),q&&(this.R?p="headers="+ie(P_(q))+"&"+p:this.u&&Xf(y,this.u,q)),Kf(this.h,$),this.Ra&&wt(y,"TYPE","init"),this.S?(wt(y,"$req",p),wt(y,"SID","null"),$.U=!0,jn($,y,null)):jn($,y,p),this.I=2}}else this.I==3&&(u?M_(this,u):this.i.length==0||__(this.h)||M_(this))};function M_(u,p){var y;p?y=p.l:y=u.V++;const P=zr(u.J);wt(P,"SID",u.M),wt(P,"RID",y),wt(P,"AID",u.K),El(u,P),u.u&&u.o&&Xf(P,u.u,u.o),y=new Se(u,u.j,y,u.D+1),u.u===null&&(y.J=u.o),p&&(u.i=p.G.concat(u.i)),p=F_(u,y,1e3),y.H=Math.round(u.va*.5)+Math.round(u.va*.5*Math.random()),Kf(u.h,y),jn(y,P,p)}function El(u,p){u.H&&te(u.H,function(y,P){wt(p,P,y)}),u.l&&te({},function(y,P){wt(p,P,y)})}function F_(u,p,y){y=Math.min(u.i.length,y);const P=u.l?d(u.l.Ka,u.l,u):null;e:{var $=u.i;let Qe=-1;for(;;){const Jt=["count="+y];Qe==-1?y>0?(Qe=$[0].g,Jt.push("ofs="+Qe)):Qe=0:Jt.push("ofs="+Qe);let yt=!0;for(let rn=0;rn<y;rn++){var q=$[rn].g;const qr=$[rn].map;if(q-=Qe,q<0)Qe=Math.max(0,$[rn].g-100),yt=!1;else try{q="req"+q+"_"||"";try{var fe=qr instanceof Map?qr:Object.entries(qr);for(const[Ui,Ms]of fe){let Fs=Ms;l(Ms)&&(Fs=xt(Ms)),Jt.push(q+Ui+"="+encodeURIComponent(Fs))}}catch(Ui){throw Jt.push(q+"type="+encodeURIComponent("_badmap")),Ui}}catch{P&&P(qr)}}if(yt){fe=Jt.join("&");break e}}fe=void 0}return u=u.i.splice(0,y),p.G=u,fe}function U_(u){if(!u.g&&!u.v){u.Y=1;var p=u.Da;S||v(),M||(S(),M=!0),g.add(p,u),u.A=0}}function Zf(u){return u.g||u.v||u.A>=3?!1:(u.Y++,u.v=Ht(d(u.Da,u),z_(u,u.A)),u.A++,!0)}t.Da=function(){if(this.v=null,$_(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var u=4*this.T;this.j.info("BP detection timer enabled: "+u),this.B=Ht(d(this.Wa,this),u)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ge(10),Su(this),$_(this))};function ep(u){u.B!=null&&(a.clearTimeout(u.B),u.B=null)}function $_(u){u.g=new Se(u,u.j,"rpc",u.Y),u.u===null&&(u.g.J=u.o),u.g.P=0;var p=zr(u.na);wt(p,"RID","rpc"),wt(p,"SID",u.M),wt(p,"AID",u.K),wt(p,"CI",u.F?"0":"1"),!u.F&&u.ia&&wt(p,"TO",u.ia),wt(p,"TYPE","xmlhttp"),El(u,p),u.u&&u.o&&Xf(p,u.u,u.o),u.O&&(u.g.H=u.O);var y=u.g;u=u.ba,y.M=1,y.A=wu(zr(p)),y.u=null,y.R=!0,St(y,u)}t.Va=function(){this.C!=null&&(this.C=null,Su(this),Zf(this),Ge(19))};function Cu(u){u.C!=null&&(a.clearTimeout(u.C),u.C=null)}function B_(u,p){var y=null;if(u.g==p){Cu(u),ep(u),u.g=null;var P=2}else if(Gf(u.h,p))y=p.G,b_(u.h,p),P=1;else return;if(u.I!=0){if(p.o)if(P==1){y=p.u?p.u.length:0,p=Date.now()-p.F;var $=u.D;P=Oe(),ge(P,new Qn(P,y)),Tu(u)}else U_(u);else if($=p.m,$==3||$==0&&p.X>0||!(P==1&&U1(u,p)||P==2&&Zf(u)))switch(y&&y.length>0&&(p=u.h,p.i=p.i.concat(y)),$){case 1:Fi(u,5);break;case 4:Fi(u,10);break;case 3:Fi(u,6);break;default:Fi(u,2)}}}function z_(u,p){let y=u.Qa+Math.floor(Math.random()*u.Za);return u.isActive()||(y*=2),y*p}function Fi(u,p){if(u.j.info("Error code "+p),p==2){var y=d(u.bb,u),P=u.Ua;const $=!P;P=new Ls(P||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ml(P,"https"),wu(P),$?D1(P.toString(),y):L1(P.toString(),y)}else Ge(2);u.I=0,u.l&&u.l.pa(p),q_(u),V_(u)}t.bb=function(u){u?(this.j.info("Successfully pinged google.com"),Ge(2)):(this.j.info("Failed to ping google.com"),Ge(1))};function q_(u){if(u.I=0,u.ja=[],u.l){const p=w_(u.h);(p.length!=0||u.i.length!=0)&&(C(u.ja,p),C(u.ja,u.i),u.h.i.length=0,_(u.i),u.i.length=0),u.l.oa()}}function H_(u,p,y){var P=y instanceof Ls?zr(y):new Ls(y);if(P.g!="")p&&(P.g=p+"."+P.g),gl(P,P.u);else{var $=a.location;P=$.protocol,p=p?p+"."+$.hostname:$.hostname,$=+$.port;const q=new Ls(null);P&&ml(q,P),p&&(q.g=p),$&&gl(q,$),y&&(q.h=y),P=q}return y=u.G,p=u.wa,y&&p&&wt(P,y,p),wt(P,"VER",u.ka),El(u,P),P}function W_(u,p,y){if(p&&!u.L)throw Error("Can't create secondary domain capable XhrIo object.");return p=u.Aa&&!u.ma?new Vt(new Yf({ab:y})):new Vt(u.ma),p.Fa(u.L),p}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function G_(){}t=G_.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Nu(){}Nu.prototype.g=function(u,p){return new Yn(u,p)};function Yn(u,p){B.call(this),this.g=new O_(p),this.l=u,this.h=p&&p.messageUrlParams||null,u=p&&p.messageHeaders||null,p&&p.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.o=u,u=p&&p.initMessageHeaders||null,p&&p.messageContentType&&(u?u["X-WebChannel-Content-Type"]=p.messageContentType:u={"X-WebChannel-Content-Type":p.messageContentType}),p&&p.sa&&(u?u["X-WebChannel-Client-Profile"]=p.sa:u={"X-WebChannel-Client-Profile":p.sa}),this.g.U=u,(u=p&&p.Qb)&&!D(u)&&(this.g.u=u),this.A=p&&p.supportsCrossDomainXhr||!1,this.v=p&&p.sendRawJson||!1,(p=p&&p.httpSessionIdParam)&&!D(p)&&(this.g.G=p,u=this.h,u!==null&&p in u&&(u=this.h,p in u&&delete u[p])),this.j=new Bo(this)}f(Yn,B),Yn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Yn.prototype.close=function(){Jf(this.g)},Yn.prototype.o=function(u){var p=this.g;if(typeof u=="string"){var y={};y.__data__=u,u=y}else this.v&&(y={},y.__data__=xt(u),u=y);p.i.push(new T1(p.Ya++,u)),p.I==3&&Tu(p)},Yn.prototype.N=function(){this.g.l=null,delete this.j,Jf(this.g),delete this.g,Yn.Z.N.call(this)};function K_(u){ue.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var p=u.__sm__;if(p){e:{for(const y in p){u=y;break e}u=void 0}(this.i=u)&&(u=this.i,p=p!==null&&u in p?p[u]:void 0),this.data=p}else this.data=u}f(K_,ue);function Q_(){Ae.call(this),this.status=1}f(Q_,Ae);function Bo(u){this.g=u}f(Bo,G_),Bo.prototype.ra=function(){ge(this.g,"a")},Bo.prototype.qa=function(u){ge(this.g,new K_(u))},Bo.prototype.pa=function(u){ge(this.g,new Q_)},Bo.prototype.oa=function(){ge(this.g,"b")},Nu.prototype.createWebChannel=Nu.prototype.g,Yn.prototype.send=Yn.prototype.o,Yn.prototype.open=Yn.prototype.m,Yn.prototype.close=Yn.prototype.close,PT=function(){return new Nu},AT=function(){return Oe()},jT=Pe,hg={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ls.NO_ERROR=0,ls.TIMEOUT=8,ls.HTTP_ERROR=6,Sd=ls,Oi.COMPLETE="complete",NT=Oi,F.EventType=re,re.OPEN="a",re.CLOSE="b",re.ERROR="c",re.MESSAGE="d",B.prototype.listen=B.prototype.J,Kl=F,Vt.prototype.listenOnce=Vt.prototype.K,Vt.prototype.getLastError=Vt.prototype.Ha,Vt.prototype.getLastErrorCode=Vt.prototype.ya,Vt.prototype.getStatus=Vt.prototype.ca,Vt.prototype.getResponseJson=Vt.prototype.La,Vt.prototype.getResponseText=Vt.prototype.la,Vt.prototype.send=Vt.prototype.ea,Vt.prototype.setWithCredentials=Vt.prototype.Fa,CT=Vt}).apply(typeof Qu<"u"?Qu:typeof self<"u"?self:typeof window<"u"?window:{});const qb="@firebase/firestore",Hb="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}hn.UNAUTHENTICATED=new hn(null),hn.GOOGLE_CREDENTIALS=new hn("google-credentials-uid"),hn.FIRST_PARTY=new hn("first-party-uid"),hn.MOCK_USER=new hn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cl="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vo=new of("@firebase/firestore");function sa(){return vo.logLevel}function se(t,...e){if(vo.logLevel<=et.DEBUG){const n=e.map(nv);vo.debug(`Firestore (${cl}): ${t}`,...n)}}function Rn(t,...e){if(vo.logLevel<=et.ERROR){const n=e.map(nv);vo.error(`Firestore (${cl}): ${t}`,...n)}}function _o(t,...e){if(vo.logLevel<=et.WARN){const n=e.map(nv);vo.warn(`Firestore (${cl}): ${t}`,...n)}}function nv(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ee(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,RT(t,r,n)}function RT(t,e,n){let r=`FIRESTORE (${cl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Rn(r),new Error(r)}function Te(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||RT(e,s,r)}function Me(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ae extends wr{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kT{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class AL{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(hn.UNAUTHENTICATED))}shutdown(){}}class PL{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class RL{constructor(e){this.t=e,this.currentUser=hn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Te(this.o===void 0,42304);let r=this.i;const s=c=>this.i!==r?(r=this.i,n(c)):Promise.resolve();let i=new Lr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Lr,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},l=c=>{se("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>l(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?l(c):(se("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Lr)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(se("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Te(typeof r.accessToken=="string",31837,{l:r}),new kT(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Te(e===null||typeof e=="string",2055,{h:e}),new hn(e)}}class kL{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=hn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class DL{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new kL(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(hn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Wb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class LL{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,hr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Te(this.o===void 0,3512);const r=i=>{i.error!=null&&se("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,se("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{se("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):se("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Wb(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Te(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Wb(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OL(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=OL(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%62))}return r}}function ze(t,e){return t<e?-1:t>e?1:0}function fg(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),i=e.charAt(r);if(s!==i)return Vp(s)===Vp(i)?ze(s,i):Vp(s)?1:-1}return ze(t.length,e.length)}const VL=55296,ML=57343;function Vp(t){const e=t.charCodeAt(0);return e>=VL&&e<=ML}function Ba(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function DT(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gb="__name__";class Qr{constructor(e,n,r){n===void 0?n=0:n>e.length&&Ee(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Ee(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Qr.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Qr?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=Qr.compareSegments(e.get(s),n.get(s));if(i!==0)return i}return ze(e.length,n.length)}static compareSegments(e,n){const r=Qr.isNumericId(e),s=Qr.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?Qr.extractNumericId(e).compare(Qr.extractNumericId(n)):fg(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return yi.fromString(e.substring(4,e.length-2))}}class at extends Qr{construct(e,n,r){return new at(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ae(G.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new at(n)}static emptyPath(){return new at([])}}const FL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class kt extends Qr{construct(e,n,r){return new kt(e,n,r)}static isValidIdentifier(e){return FL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),kt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Gb}static keyField(){return new kt([Gb])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ae(G.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new ae(G.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new ae(G.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new ae(G.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new kt(n)}static emptyPath(){return new kt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(e){this.path=e}static fromPath(e){return new pe(at.fromString(e))}static fromName(e){return new pe(at.fromString(e).popFirst(5))}static empty(){return new pe(at.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&at.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return at.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new pe(new at(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LT(t,e,n){if(!n)throw new ae(G.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function UL(t,e,n,r){if(e===!0&&r===!0)throw new ae(G.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Kb(t){if(!pe.isDocumentKey(t))throw new ae(G.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Qb(t){if(pe.isDocumentKey(t))throw new ae(G.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function OT(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function hf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ee(12329,{type:typeof t})}function Sn(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ae(G.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=hf(t);throw new ae(G.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function $L(t,e){if(e<=0)throw new ae(G.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yt(t,e){const n={typeString:t};return e&&(n.value=e),n}function cu(t,e){if(!OT(t))throw new ae(G.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const a=t[r];if(s&&typeof a!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new ae(G.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb=-62135596800,Xb=1e6;class it{static now(){return it.fromMillis(Date.now())}static fromDate(e){return it.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*Xb);return new it(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ae(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ae(G.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Yb)throw new ae(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ae(G.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Xb}_compareTo(e){return this.seconds===e.seconds?ze(this.nanoseconds,e.nanoseconds):ze(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:it._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(cu(e,it._jsonSchema))return new it(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Yb;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}it._jsonSchemaVersion="firestore/timestamp/1.0",it._jsonSchema={type:Yt("string",it._jsonSchemaVersion),seconds:Yt("number"),nanoseconds:Yt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je{static fromTimestamp(e){return new je(e)}static min(){return new je(new it(0,0))}static max(){return new je(new it(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $c=-1;class vh{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function pg(t){return t.fields.find(e=>e.kind===2)}function Hi(t){return t.fields.filter(e=>e.kind!==2)}vh.UNKNOWN_ID=-1;class Td{constructor(e,n){this.fieldPath=e,this.kind=n}}class Bc{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Bc(0,or.min())}}function BL(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=je.fromTimestamp(r===1e9?new it(n+1,0):new it(n,r));return new or(s,pe.empty(),e)}function VT(t){return new or(t.readTime,t.key,$c)}class or{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new or(je.min(),pe.empty(),$c)}static max(){return new or(je.max(),pe.empty(),$c)}}function sv(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=pe.comparator(t.documentKey,e.documentKey),n!==0?n:ze(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class FT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mo(t){if(t.code!==G.FAILED_PRECONDITION||t.message!==MT)throw t;se("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Ee(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new U((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof U?n:U.resolve(n)}catch(n){return U.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):U.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):U.reject(n)}static resolve(e){return new U((n,r)=>{n(e)})}static reject(e){return new U((n,r)=>{r(e)})}static waitFor(e){return new U((n,r)=>{let s=0,i=0,a=!1;e.forEach(l=>{++s,l.next(()=>{++i,a&&i===s&&n()},c=>r(c))}),a=!0,i===s&&n()})}static or(e){let n=U.resolve(!1);for(const r of e)n=n.next(s=>s?U.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new U((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let c=0;c<i;c++){const d=c;n(e[d]).next(h=>{a[d]=h,++l,l===i&&r(a)},h=>s(h))}})}static doWhile(e,n){return new U((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const er="SimpleDb";class ff{static open(e,n,r,s){try{return new ff(n,e.transaction(s,r))}catch(i){throw new hc(n,i)}}constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.S=new Lr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{n.error?this.S.reject(new hc(e,n.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=iv(r.target.error);this.S.reject(new hc(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(se(er,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new qL(n)}}class vi{static delete(e){return se(er,"Removing database:",e),Gi(jS().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!qy())return!1;if(vi.F())return!0;const e=tn(),n=vi.M(e),r=0<n&&n<10,s=UT(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,n){return e.store(n)}static M(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,n,r){this.name=e,this.version=n,this.N=r,this.B=null,vi.M(tn())===12.2&&Rn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(se(er,"Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;n(a)},s.onblocked=()=>{r(new hc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?r(new ae(G.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new ae(G.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new hc(e,a))},s.onupgradeneeded=i=>{se(er,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next(()=>{se(er,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=n=>this.q(n)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let a=0;for(;;){++a;try{this.db=await this.L(e);const l=ff.open(this.db,e,i?"readonly":"readwrite",r),c=s(l).next(d=>(l.C(),d)).catch(d=>(l.abort(d),U.reject(d))).toPromise();return c.catch(()=>{}),await l.D,c}catch(l){const c=l,d=c.name!=="FirebaseError"&&a<3;if(se(er,"Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}function UT(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class zL{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Gi(this.U.delete())}}class hc extends ae{constructor(e,n){super(G.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function ki(t){return t.name==="IndexedDbTransactionError"}class qL{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(se(er,"PUT",this.store.name,e,n),r=this.store.put(n,e)):(se(er,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Gi(r)}add(e){return se(er,"ADD",this.store.name,e,e),Gi(this.store.add(e))}get(e){return Gi(this.store.get(e)).next(n=>(n===void 0&&(n=null),se(er,"GET",this.store.name,e,n),n))}delete(e){return se(er,"DELETE",this.store.name,e),Gi(this.store.delete(e))}count(){return se(er,"COUNT",this.store.name),Gi(this.store.count())}J(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new U((a,l)=>{i.onerror=c=>{l(c.target.error)},i.onsuccess=c=>{a(c.target.result)}})}{const i=this.cursor(r),a=[];return this.H(i,(l,c)=>{a.push(c)}).next(()=>a)}}Y(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new U((s,i)=>{r.onerror=a=>{i(a.target.error)},r.onsuccess=a=>{s(a.target.result)}})}Z(e,n){se(er,"DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const s=this.cursor(r);return this.H(s,(i,a,l)=>l.delete())}ee(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.H(s,n)}te(e){const n=this.cursor({});return new U((r,s)=>{n.onerror=i=>{const a=iv(i.target.error);s(a)},n.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next(l=>{l?a.continue():r()}):r()}})}H(e,n){const r=[];return new U((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const l=a.target.result;if(!l)return void s();const c=new zL(l),d=n(l.primaryKey,l.value,c);if(d instanceof U){const h=d.catch(f=>(c.done(),U.reject(f)));r.push(h)}c.isDone?s():c.G===null?l.continue():l.continue(c.G)}}).next(()=>U.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function Gi(t){return new U((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=iv(r.target.error);n(s)}})}let Jb=!1;function iv(t){const e=vi.M(tn());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new ae("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Jb||(Jb=!0,setTimeout(()=>{throw r},0)),r}}return t}const fc="IndexBackfiller";class HL{constructor(e,n){this.asyncQueue=e,this.ne=n,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){se(fc,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const n=await this.ne.ie();se(fc,`Documents written: ${n}`)}catch(n){ki(n)?se(fc,"Ignoring IndexedDB error during index backfill: ",n):await Mo(n)}await this.re(6e4)})}}class WL{constructor(e,n){this.localStore=e,this.persistence=n}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.se(n,e))}se(e,n){const r=new Set;let s=n,i=!0;return U.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return se(fc,`Processing collection: ${a}`),this.oe(e,a,s).next(l=>{s-=l,r.add(a)});i=!1})).next(()=>n-s)}oe(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this._e(s,i)).next(l=>(se(fc,`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,n,l))).next(()=>a.size)}))}_e(e,n){let r=e;return n.changes.forEach((s,i)=>{const a=VT(i);sv(a,r)>0&&(r=a)}),new or(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}mr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const io=-1;function pf(t){return t==null}function zc(t){return t===0&&1/t==-1/0}function GL(t){return typeof t=="number"&&Number.isInteger(t)&&!zc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _h="";function Tn(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Zb(e)),e=KL(t.get(n),e);return Zb(e)}function KL(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case _h:n+="";break;default:n+=i}}return n}function Zb(t){return t+_h+""}function Xr(t){const e=t.length;if(Te(e>=2,64408,{path:t}),e===2)return Te(t.charAt(0)===_h&&t.charAt(1)==="",56145,{path:t}),at.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const a=t.indexOf(_h,i);switch((a<0||a>n)&&Ee(50515,{path:t}),t.charAt(a+1)){case"":const l=t.substring(i,a);let c;s.length===0?c=l:(s+=l,c=s,s=""),r.push(c);break;case"":s+=t.substring(i,a),s+="\0";break;case"":s+=t.substring(i,a+1);break;default:Ee(61167,{path:t})}i=a+2}return new at(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wi="remoteDocuments",uu="owner",qo="owner",qc="mutationQueues",QL="userId",jr="mutations",ew="batchId",to="userMutationsIndex",tw=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cd(t,e){return[t,Tn(e)]}function $T(t,e,n){return[t,Tn(e),n]}const YL={},za="documentMutations",xh="remoteDocumentsV14",XL=["prefixPath","collectionGroup","readTime","documentId"],Nd="documentKeyIndex",JL=["prefixPath","collectionGroup","documentId"],BT="collectionGroupIndex",ZL=["collectionGroup","readTime","prefixPath","documentId"],Hc="remoteDocumentGlobal",mg="remoteDocumentGlobalKey",qa="targets",zT="queryTargetsIndex",eO=["canonicalId","targetId"],Ha="targetDocuments",tO=["targetId","path"],ov="documentTargetsIndex",nO=["path","targetId"],bh="targetGlobalKey",oo="targetGlobal",Wc="collectionParents",rO=["collectionId","parent"],Wa="clientMetadata",sO="clientId",mf="bundles",iO="bundleId",gf="namedQueries",oO="name",av="indexConfiguration",aO="indexId",gg="collectionGroupIndex",lO="collectionGroup",pc="indexState",cO=["indexId","uid"],qT="sequenceNumberIndex",uO=["uid","sequenceNumber"],mc="indexEntries",dO=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],HT="documentKeyIndex",hO=["indexId","uid","orderedDocumentKey"],yf="documentOverlays",fO=["userId","collectionPath","documentId"],yg="collectionPathOverlayIndex",pO=["userId","collectionPath","largestBatchId"],WT="collectionGroupOverlayIndex",mO=["userId","collectionGroup","largestBatchId"],lv="globals",gO="name",GT=[qc,jr,za,Wi,qa,uu,oo,Ha,Wa,Hc,Wc,mf,gf],yO=[...GT,yf],KT=[qc,jr,za,xh,qa,uu,oo,Ha,Wa,Hc,Wc,mf,gf,yf],QT=KT,cv=[...QT,av,pc,mc],vO=cv,YT=[...cv,lv],_O=YT;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg extends FT{constructor(e,n){super(),this.le=e,this.currentSequenceNumber=n}}function nn(t,e){const n=Me(t);return vi.O(n.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nw(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Di(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function xO(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function XT(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jt{constructor(e,n){this.comparator=e,this.root=n||fn.EMPTY}insert(e,n){return new jt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,fn.BLACK,null,null))}remove(e){return new jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,fn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Yu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Yu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Yu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Yu(this.root,e,this.comparator,!0)}}class Yu{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class fn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??fn.RED,this.left=s??fn.EMPTY,this.right=i??fn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new fn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return fn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return fn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,fn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,fn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ee(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ee(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ee(27949);return e+(this.isRed()?0:1)}}fn.EMPTY=null,fn.RED=!0,fn.BLACK=!1;fn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ee(57766)}get value(){throw Ee(16141)}get color(){throw Ee(16727)}get left(){throw Ee(29726)}get right(){throw Ee(36894)}copy(e,n,r,s,i){return this}insert(e,n,r){return new fn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e){this.comparator=e,this.data=new jt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new rw(this.data.getIterator())}getIteratorFrom(e){return new rw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof ft)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ft(this.comparator);return n.data=e,n}}class rw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ho(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e){this.fields=e,e.sort(kt.comparator)}static empty(){return new qn([])}unionWith(e){let n=new ft(kt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new qn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ba(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new JT("Invalid base64 string: "+i):i}}(e);return new Xt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new Xt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ze(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xt.EMPTY_BYTE_STRING=new Xt("");const bO=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function As(t){if(Te(!!t,39018),typeof t=="string"){let e=0;const n=bO.exec(t);if(Te(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Tt(t.seconds),nanos:Tt(t.nanos)}}function Tt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Ps(t){return typeof t=="string"?Xt.fromBase64String(t):Xt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZT="server_timestamp",eC="__type__",tC="__previous_value__",nC="__local_write_time__";function vf(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[eC])==null?void 0:r.stringValue)===ZT}function _f(t){const e=t.mapValue.fields[tC];return vf(e)?_f(e):e}function Gc(t){const e=As(t.mapValue.fields[nC].timestampValue);return new it(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wO{constructor(e,n,r,s,i,a,l,c,d,h){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=c,this.useFetchStreams=d,this.isUsingEmulator=h}}const wh="(default)";class xo{constructor(e,n){this.projectId=e,this.database=n||wh}static empty(){return new xo("","")}get isDefaultDatabase(){return this.database===wh}isEqual(e){return e instanceof xo&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uv="__type__",rC="__max__",ii={mapValue:{fields:{__type__:{stringValue:rC}}}},dv="__vector__",Ga="value",jd={nullValue:"NULL_VALUE"};function wi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?vf(t)?4:sC(t)?9007199254740991:xf(t)?10:11:Ee(28295,{value:t})}function os(t,e){if(t===e)return!0;const n=wi(t);if(n!==wi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Gc(t).isEqual(Gc(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=As(s.timestampValue),l=As(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return Ps(s.bytesValue).isEqual(Ps(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return Tt(s.geoPointValue.latitude)===Tt(i.geoPointValue.latitude)&&Tt(s.geoPointValue.longitude)===Tt(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Tt(s.integerValue)===Tt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=Tt(s.doubleValue),l=Tt(i.doubleValue);return a===l?zc(a)===zc(l):isNaN(a)&&isNaN(l)}return!1}(t,e);case 9:return Ba(t.arrayValue.values||[],e.arrayValue.values||[],os);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(nw(a)!==nw(l))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(l[c]===void 0||!os(a[c],l[c])))return!1;return!0}(t,e);default:return Ee(52216,{left:t})}}function Kc(t,e){return(t.values||[]).find(n=>os(n,e))!==void 0}function Ei(t,e){if(t===e)return 0;const n=wi(t),r=wi(e);if(n!==r)return ze(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ze(t.booleanValue,e.booleanValue);case 2:return function(i,a){const l=Tt(i.integerValue||i.doubleValue),c=Tt(a.integerValue||a.doubleValue);return l<c?-1:l>c?1:l===c?0:isNaN(l)?isNaN(c)?0:-1:1}(t,e);case 3:return sw(t.timestampValue,e.timestampValue);case 4:return sw(Gc(t),Gc(e));case 5:return fg(t.stringValue,e.stringValue);case 6:return function(i,a){const l=Ps(i),c=Ps(a);return l.compareTo(c)}(t.bytesValue,e.bytesValue);case 7:return function(i,a){const l=i.split("/"),c=a.split("/");for(let d=0;d<l.length&&d<c.length;d++){const h=ze(l[d],c[d]);if(h!==0)return h}return ze(l.length,c.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,a){const l=ze(Tt(i.latitude),Tt(a.latitude));return l!==0?l:ze(Tt(i.longitude),Tt(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return iw(t.arrayValue,e.arrayValue);case 10:return function(i,a){var m,_,C,N;const l=i.fields||{},c=a.fields||{},d=(m=l[Ga])==null?void 0:m.arrayValue,h=(_=c[Ga])==null?void 0:_.arrayValue,f=ze(((C=d==null?void 0:d.values)==null?void 0:C.length)||0,((N=h==null?void 0:h.values)==null?void 0:N.length)||0);return f!==0?f:iw(d,h)}(t.mapValue,e.mapValue);case 11:return function(i,a){if(i===ii.mapValue&&a===ii.mapValue)return 0;if(i===ii.mapValue)return 1;if(a===ii.mapValue)return-1;const l=i.fields||{},c=Object.keys(l),d=a.fields||{},h=Object.keys(d);c.sort(),h.sort();for(let f=0;f<c.length&&f<h.length;++f){const m=fg(c[f],h[f]);if(m!==0)return m;const _=Ei(l[c[f]],d[h[f]]);if(_!==0)return _}return ze(c.length,h.length)}(t.mapValue,e.mapValue);default:throw Ee(23264,{he:n})}}function sw(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return ze(t,e);const n=As(t),r=As(e),s=ze(n.seconds,r.seconds);return s!==0?s:ze(n.nanos,r.nanos)}function iw(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=Ei(n[s],r[s]);if(i)return i}return ze(n.length,r.length)}function Ka(t){return _g(t)}function _g(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=As(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Ps(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return pe.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=_g(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${_g(n.fields[a])}`;return s+"}"}(t.mapValue):Ee(61005,{value:t})}function Ad(t){switch(wi(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=_f(t);return e?16+Ad(e):16;case 5:return 2*t.stringValue.length;case 6:return Ps(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Ad(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return Di(r.fields,(i,a)=>{s+=i.length+Ad(a)}),s}(t.mapValue);default:throw Ee(13486,{value:t})}}function bo(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function xg(t){return!!t&&"integerValue"in t}function Qc(t){return!!t&&"arrayValue"in t}function ow(t){return!!t&&"nullValue"in t}function aw(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Pd(t){return!!t&&"mapValue"in t}function xf(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[uv])==null?void 0:r.stringValue)===dv}function gc(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Di(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=gc(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=gc(t.arrayValue.values[n]);return e}return{...t}}function sC(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===rC}const iC={mapValue:{fields:{[uv]:{stringValue:dv},[Ga]:{arrayValue:{}}}}};function EO(t){return"nullValue"in t?jd:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?bo(xo.empty(),pe.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?xf(t)?iC:{mapValue:{}}:Ee(35942,{value:t})}function IO(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?bo(xo.empty(),pe.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?iC:"mapValue"in t?xf(t)?{mapValue:{}}:ii:Ee(61959,{value:t})}function lw(t,e){const n=Ei(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function cw(t,e){const n=Ei(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e){this.value=e}static empty(){return new En({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Pd(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=gc(n)}setAll(e){let n=kt.emptyPath(),r={},s=[];e.forEach((a,l)=>{if(!n.isImmediateParentOf(l)){const c=this.getFieldsMap(n);this.applyChanges(c,r,s),r={},s=[],n=l.popLast()}a?r[l.lastSegment()]=gc(a):s.push(l.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Pd(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return os(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Pd(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Di(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new En(gc(this.value))}}function oC(t){const e=[];return Di(t.fields,(n,r)=>{const s=new kt([n]);if(Pd(r)){const i=oC(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new qn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{constructor(e,n,r,s,i,a,l){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Ft(e,0,je.min(),je.min(),je.min(),En.empty(),0)}static newFoundDocument(e,n,r,s){return new Ft(e,1,n,je.min(),r,s,0)}static newNoDocument(e,n){return new Ft(e,2,n,je.min(),je.min(),En.empty(),0)}static newUnknownDocument(e,n){return new Ft(e,3,n,je.min(),je.min(),En.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(je.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=En.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=En.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=je.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ft&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ft(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(e,n){this.position=e,this.inclusive=n}}function uw(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],a=t.position[s];if(i.field.isKeyField()?r=pe.comparator(pe.fromName(a.referenceValue),n.key):r=Ei(a,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function dw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!os(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yc{constructor(e,n="asc"){this.field=e,this.dir=n}}function SO(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{}class tt extends aC{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new TO(e,n,r):n==="array-contains"?new jO(e,r):n==="in"?new fC(e,r):n==="not-in"?new AO(e,r):n==="array-contains-any"?new PO(e,r):new tt(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new CO(e,r):new NO(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Ei(n,this.value)):n!==null&&wi(this.value)===wi(n)&&this.matchesComparison(Ei(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ee(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class dt extends aC{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new dt(e,n)}matches(e){return Qa(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Qa(t){return t.op==="and"}function bg(t){return t.op==="or"}function hv(t){return lC(t)&&Qa(t)}function lC(t){for(const e of t.filters)if(e instanceof dt)return!1;return!0}function wg(t){if(t instanceof tt)return t.field.canonicalString()+t.op.toString()+Ka(t.value);if(hv(t))return t.filters.map(e=>wg(e)).join(",");{const e=t.filters.map(n=>wg(n)).join(",");return`${t.op}(${e})`}}function cC(t,e){return t instanceof tt?function(r,s){return s instanceof tt&&r.op===s.op&&r.field.isEqual(s.field)&&os(r.value,s.value)}(t,e):t instanceof dt?function(r,s){return s instanceof dt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,a,l)=>i&&cC(a,s.filters[l]),!0):!1}(t,e):void Ee(19439)}function uC(t,e){const n=t.filters.concat(e);return dt.create(n,t.op)}function dC(t){return t instanceof tt?function(n){return`${n.field.canonicalString()} ${n.op} ${Ka(n.value)}`}(t):t instanceof dt?function(n){return n.op.toString()+" {"+n.getFilters().map(dC).join(" ,")+"}"}(t):"Filter"}class TO extends tt{constructor(e,n,r){super(e,n,r),this.key=pe.fromName(r.referenceValue)}matches(e){const n=pe.comparator(e.key,this.key);return this.matchesComparison(n)}}class CO extends tt{constructor(e,n){super(e,"in",n),this.keys=hC("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class NO extends tt{constructor(e,n){super(e,"not-in",n),this.keys=hC("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function hC(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>pe.fromName(r.referenceValue))}class jO extends tt{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Qc(n)&&Kc(n.arrayValue,this.value)}}class fC extends tt{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&Kc(this.value.arrayValue,n)}}class AO extends tt{constructor(e,n){super(e,"not-in",n)}matches(e){if(Kc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!Kc(this.value.arrayValue,n)}}class PO extends tt{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Qc(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>Kc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RO{constructor(e,n=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Te=null}}function Eg(t,e=null,n=[],r=[],s=null,i=null,a=null){return new RO(t,e,n,r,s,i,a)}function wo(t){const e=Me(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>wg(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),pf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Ka(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Ka(r)).join(",")),e.Te=n}return e.Te}function du(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!SO(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!cC(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!dw(t.startAt,e.startAt)&&dw(t.endAt,e.endAt)}function Eh(t){return pe.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function Ih(t,e){return t.filters.filter(n=>n instanceof tt&&n.field.isEqual(e))}function hw(t,e,n){let r=jd,s=!0;for(const i of Ih(t,e)){let a=jd,l=!0;switch(i.op){case"<":case"<=":a=EO(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,l=!1;break;case"!=":case"not-in":a=jd}lw({value:r,inclusive:s},{value:a,inclusive:l})<0&&(r=a,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];lw({value:r,inclusive:s},{value:a,inclusive:n.inclusive})<0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}function fw(t,e,n){let r=ii,s=!0;for(const i of Ih(t,e)){let a=ii,l=!0;switch(i.op){case">=":case">":a=IO(i.value),l=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,l=!1;break;case"!=":case"not-in":a=ii}cw({value:r,inclusive:s},{value:a,inclusive:l})>0&&(r=a,s=l)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const a=n.position[i];cw({value:r,inclusive:s},{value:a,inclusive:n.inclusive})>0&&(r=a,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Li{constructor(e,n=null,r=[],s=[],i=null,a="F",l=null,c=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=c,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function kO(t,e,n,r,s,i,a,l){return new Li(t,e,n,r,s,i,a,l)}function hu(t){return new Li(t)}function pw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function fv(t){return t.collectionGroup!==null}function Aa(t){const e=Me(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new ft(kt.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(l=l.add(d.field))})}),l})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Yc(i,r))}),n.has(kt.keyField().canonicalString())||e.Ie.push(new Yc(kt.keyField(),r))}return e.Ie}function yr(t){const e=Me(t);return e.Ee||(e.Ee=pC(e,Aa(t))),e.Ee}function DO(t){const e=Me(t);return e.de||(e.de=pC(e,t.explicitOrderBy)),e.de}function pC(t,e){if(t.limitType==="F")return Eg(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Yc(s.field,i)});const n=t.endAt?new Ii(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ii(t.startAt.position,t.startAt.inclusive):null;return Eg(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Ig(t,e){const n=t.filters.concat([e]);return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Sh(t,e,n){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function bf(t,e){return du(yr(t),yr(e))&&t.limitType===e.limitType}function mC(t){return`${wo(yr(t))}|lt:${t.limitType}`}function ia(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>dC(s)).join(", ")}]`),pf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Ka(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Ka(s)).join(",")),`Target(${r})`}(yr(t))}; limitType=${t.limitType})`}function fu(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):pe.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of Aa(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(a,l,c){const d=uw(a,l,c);return a.inclusive?d<=0:d<0}(r.startAt,Aa(r),s)||r.endAt&&!function(a,l,c){const d=uw(a,l,c);return a.inclusive?d>=0:d>0}(r.endAt,Aa(r),s))}(t,e)}function LO(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function gC(t){return(e,n)=>{let r=!1;for(const s of Aa(t)){const i=OO(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function OO(t,e,n){const r=t.field.isKeyField()?pe.comparator(e.key,n.key):function(i,a,l){const c=a.data.field(i),d=l.data.field(i);return c!==null&&d!==null?Ei(c,d):Ee(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ee(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Di(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return XT(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VO=new jt(pe.comparator);function nr(){return VO}const yC=new jt(pe.comparator);function Ql(...t){let e=yC;for(const n of t)e=e.insert(n.key,n);return e}function vC(t){let e=yC;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Jr(){return yc()}function _C(){return yc()}function yc(){return new ks(t=>t.toString(),(t,e)=>t.isEqual(e))}const MO=new jt(pe.comparator),FO=new ft(pe.comparator);function Ye(...t){let e=FO;for(const n of t)e=e.add(n);return e}const UO=new ft(ze);function $O(){return UO}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pv(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zc(e)?"-0":e}}function xC(t){return{integerValue:""+t}}function bC(t,e){return GL(e)?xC(e):pv(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf{constructor(){this._=void 0}}function BO(t,e,n){return t instanceof Ya?function(s,i){const a={fields:{[eC]:{stringValue:ZT},[nC]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&vf(i)&&(i=_f(i)),i&&(a.fields[tC]=i),{mapValue:a}}(n,e):t instanceof Eo?EC(t,e):t instanceof Xa?IC(t,e):function(s,i){const a=wC(s,i),l=mw(a)+mw(s.Ae);return xg(a)&&xg(s.Ae)?xC(l):pv(s.serializer,l)}(t,e)}function zO(t,e,n){return t instanceof Eo?EC(t,e):t instanceof Xa?IC(t,e):n}function wC(t,e){return t instanceof Ja?function(r){return xg(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class Ya extends wf{}class Eo extends wf{constructor(e){super(),this.elements=e}}function EC(t,e){const n=SC(e);for(const r of t.elements)n.some(s=>os(s,r))||n.push(r);return{arrayValue:{values:n}}}class Xa extends wf{constructor(e){super(),this.elements=e}}function IC(t,e){let n=SC(e);for(const r of t.elements)n=n.filter(s=>!os(s,r));return{arrayValue:{values:n}}}class Ja extends wf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function mw(t){return Tt(t.integerValue||t.doubleValue)}function SC(t){return Qc(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef{constructor(e,n){this.field=e,this.transform=n}}function qO(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof Eo&&s instanceof Eo||r instanceof Xa&&s instanceof Xa?Ba(r.elements,s.elements,os):r instanceof Ja&&s instanceof Ja?os(r.Ae,s.Ae):r instanceof Ya&&s instanceof Ya}(t.transform,e.transform)}class HO{constructor(e,n){this.version=e,this.transformResults=n}}class In{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new In}static exists(e){return new In(void 0,e)}static updateTime(e){return new In(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Rd(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class If{}function TC(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Sf(t.key,In.none()):new ul(t.key,t.data,In.none());{const n=t.data,r=En.empty();let s=new ft(kt.comparator);for(let i of e.fields)if(!s.has(i)){let a=n.field(i);a===null&&i.length>1&&(i=i.popLast(),a=n.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new Ds(t.key,r,new qn(s.toArray()),In.none())}}function WO(t,e,n){t instanceof ul?function(s,i,a){const l=s.value.clone(),c=yw(s.fieldTransforms,i,a.transformResults);l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(t,e,n):t instanceof Ds?function(s,i,a){if(!Rd(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=yw(s.fieldTransforms,i,a.transformResults),c=i.data;c.setAll(CC(s)),c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(t,e,n):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function vc(t,e,n,r){return t instanceof ul?function(i,a,l,c){if(!Rd(i.precondition,a))return l;const d=i.value.clone(),h=vw(i.fieldTransforms,c,a);return d.setAll(h),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Ds?function(i,a,l,c){if(!Rd(i.precondition,a))return l;const d=vw(i.fieldTransforms,c,a),h=a.data;return h.setAll(CC(i)),h.setAll(d),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(i,a,l){return Rd(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(t,e,n)}function GO(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=wC(r.transform,s||null);i!=null&&(n===null&&(n=En.empty()),n.set(r.field,i))}return n||null}function gw(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ba(r,s,(i,a)=>qO(i,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ul extends If{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ds extends If{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function CC(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function yw(t,e,n){const r=new Map;Te(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,zO(a,l,n[s]))}return r}function vw(t,e,n){const r=new Map;for(const s of t){const i=s.transform,a=n.data.field(s.field);r.set(s.field,BO(i,a,e))}return r}class Sf extends If{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class NC extends If{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mv{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&WO(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=vc(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=vc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=_C();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=n.has(s.key)?null:l;const c=TC(a,l);c!==null&&r.set(s.key,c),a.isValidDocument()||a.convertToNoDocument(je.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ye())}isEqual(e){return this.batchId===e.batchId&&Ba(this.mutations,e.mutations,(n,r)=>gw(n,r))&&Ba(this.baseMutations,e.baseMutations,(n,r)=>gw(n,r))}}class gv{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){Te(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return MO}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new gv(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yv{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KO{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QO{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kt,st;function YO(t){switch(t){case G.OK:return Ee(64938);case G.CANCELLED:case G.UNKNOWN:case G.DEADLINE_EXCEEDED:case G.RESOURCE_EXHAUSTED:case G.INTERNAL:case G.UNAVAILABLE:case G.UNAUTHENTICATED:return!1;case G.INVALID_ARGUMENT:case G.NOT_FOUND:case G.ALREADY_EXISTS:case G.PERMISSION_DENIED:case G.FAILED_PRECONDITION:case G.ABORTED:case G.OUT_OF_RANGE:case G.UNIMPLEMENTED:case G.DATA_LOSS:return!0;default:return Ee(15467,{code:t})}}function jC(t){if(t===void 0)return Rn("GRPC error has no .code"),G.UNKNOWN;switch(t){case Kt.OK:return G.OK;case Kt.CANCELLED:return G.CANCELLED;case Kt.UNKNOWN:return G.UNKNOWN;case Kt.DEADLINE_EXCEEDED:return G.DEADLINE_EXCEEDED;case Kt.RESOURCE_EXHAUSTED:return G.RESOURCE_EXHAUSTED;case Kt.INTERNAL:return G.INTERNAL;case Kt.UNAVAILABLE:return G.UNAVAILABLE;case Kt.UNAUTHENTICATED:return G.UNAUTHENTICATED;case Kt.INVALID_ARGUMENT:return G.INVALID_ARGUMENT;case Kt.NOT_FOUND:return G.NOT_FOUND;case Kt.ALREADY_EXISTS:return G.ALREADY_EXISTS;case Kt.PERMISSION_DENIED:return G.PERMISSION_DENIED;case Kt.FAILED_PRECONDITION:return G.FAILED_PRECONDITION;case Kt.ABORTED:return G.ABORTED;case Kt.OUT_OF_RANGE:return G.OUT_OF_RANGE;case Kt.UNIMPLEMENTED:return G.UNIMPLEMENTED;case Kt.DATA_LOSS:return G.DATA_LOSS;default:return Ee(39323,{code:t})}}(st=Kt||(Kt={}))[st.OK=0]="OK",st[st.CANCELLED=1]="CANCELLED",st[st.UNKNOWN=2]="UNKNOWN",st[st.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",st[st.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",st[st.NOT_FOUND=5]="NOT_FOUND",st[st.ALREADY_EXISTS=6]="ALREADY_EXISTS",st[st.PERMISSION_DENIED=7]="PERMISSION_DENIED",st[st.UNAUTHENTICATED=16]="UNAUTHENTICATED",st[st.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",st[st.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",st[st.ABORTED=10]="ABORTED",st[st.OUT_OF_RANGE=11]="OUT_OF_RANGE",st[st.UNIMPLEMENTED=12]="UNIMPLEMENTED",st[st.INTERNAL=13]="INTERNAL",st[st.UNAVAILABLE=14]="UNAVAILABLE",st[st.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XO(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JO=new yi([4294967295,4294967295],0);function _w(t){const e=XO().encode(t),n=new TT;return n.update(e),new Uint8Array(n.digest())}function xw(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new yi([n,r],0),new yi([s,i],0)]}class vv{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Yl(`Invalid padding: ${n}`);if(r<0)throw new Yl(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Yl(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Yl(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=yi.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(yi.fromNumber(r)));return s.compare(JO)===1&&(s=new yi([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=_w(e),[r,s]=xw(n);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new vv(i,s,n);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.ge===0)return;const n=_w(e),[r,s]=xw(n);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Yl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,pu.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Tf(je.min(),s,new jt(ze),nr(),Ye())}}class pu{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new pu(r,n,Ye(),Ye(),Ye())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kd{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class AC{constructor(e,n){this.targetId=e,this.Ce=n}}class PC{constructor(e,n,r=Xt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class bw{constructor(){this.ve=0,this.Fe=ww(),this.Me=Xt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ye(),n=Ye(),r=Ye();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:Ee(38017,{changeType:i})}}),new pu(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=ww()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Te(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class ZO{constructor(e){this.Ge=e,this.ze=new Map,this.je=nr(),this.Je=Xu(),this.He=Xu(),this.Ye=new jt(ze)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:Ee(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,s)=>{this.rt(s)&&n(s)})}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const i=s.target;if(Eh(i))if(r===0){const a=new pe(i.path);this.et(n,a,Ft.newNoDocument(a,je.min()))}else Te(r===1,20013,{expectedCount:r});else{const a=this._t(n);if(a!==r){const l=this.ut(e),c=l?this.ct(l,e,a):1;if(c!==0){this.it(n);const d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,d)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let a,l;try{a=Ps(r).toUint8Array()}catch(c){if(c instanceof JT)return _o("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{l=new vv(a,s,i)}catch(c){return _o(c instanceof Yl?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return l.ge===0?null:l}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(n,i,null),s++)}),s}Tt(e){const n=new Map;this.ze.forEach((i,a)=>{const l=this.ot(a);if(l){if(i.current&&Eh(l.target)){const c=new pe(l.target.path);this.It(c).has(a)||this.Et(a,c)||this.et(a,c,Ft.newNoDocument(c,e))}i.Be&&(n.set(a,i.ke()),i.qe())}});let r=Ye();this.He.forEach((i,a)=>{let l=!0;a.forEachWhile(c=>{const d=this.ot(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(i))}),this.je.forEach((i,a)=>a.setReadTime(e));const s=new Tf(e,n,this.Ye,this.je,r);return this.je=nr(),this.Je=Xu(),this.He=Xu(),this.Ye=new jt(ze),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new bw,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new ft(ze),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new ft(ze),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||se("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new bw),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Xu(){return new jt(pe.comparator)}function ww(){return new jt(pe.comparator)}const eV={asc:"ASCENDING",desc:"DESCENDING"},tV={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},nV={and:"AND",or:"OR"};class rV{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Sg(t,e){return t.useProto3Json||pf(e)?e:{value:e}}function Za(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function RC(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function sV(t,e){return Za(t,e.toTimestamp())}function Ln(t){return Te(!!t,49232),je.fromTimestamp(function(n){const r=As(n);return new it(r.seconds,r.nanos)}(t))}function _v(t,e){return Tg(t,e).canonicalString()}function Tg(t,e){const n=function(s){return new at(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function kC(t){const e=at.fromString(t);return Te($C(e),10190,{key:e.toString()}),e}function Th(t,e){return _v(t.databaseId,e.path)}function ao(t,e){const n=kC(e);if(n.get(1)!==t.databaseId.projectId)throw new ae(G.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ae(G.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new pe(OC(n))}function DC(t,e){return _v(t.databaseId,e)}function LC(t){const e=kC(t);return e.length===4?at.emptyPath():OC(e)}function Cg(t){return new at(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function OC(t){return Te(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function Ew(t,e,n){return{name:Th(t,e),fields:n.value.mapValue.fields}}function iV(t,e,n){const r=ao(t,e.name),s=Ln(e.updateTime),i=e.createTime?Ln(e.createTime):je.min(),a=new En({mapValue:{fields:e.fields}}),l=Ft.newFoundDocument(r,s,i,a);return n&&l.setHasCommittedMutations(),n?l.setHasCommittedMutations():l}function oV(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:Ee(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,h){return d.useProto3Json?(Te(h===void 0||typeof h=="string",58123),Xt.fromBase64String(h||"")):(Te(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Xt.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(d){const h=d.code===void 0?G.UNKNOWN:jC(d.code);return new ae(h,d.message||"")}(a);n=new PC(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ao(t,r.document.name),i=Ln(r.document.updateTime),a=r.document.createTime?Ln(r.document.createTime):je.min(),l=new En({mapValue:{fields:r.document.fields}}),c=Ft.newFoundDocument(s,i,a,l),d=r.targetIds||[],h=r.removedTargetIds||[];n=new kd(d,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ao(t,r.document),i=r.readTime?Ln(r.readTime):je.min(),a=Ft.newNoDocument(s,i),l=r.removedTargetIds||[];n=new kd([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ao(t,r.document),i=r.removedTargetIds||[];n=new kd([],i,s,null)}else{if(!("filter"in e))return Ee(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new QO(s,i),l=r.targetId;n=new AC(l,a)}}return n}function Ch(t,e){let n;if(e instanceof ul)n={update:Ew(t,e.key,e.value)};else if(e instanceof Sf)n={delete:Th(t,e.key)};else if(e instanceof Ds)n={update:Ew(t,e.key,e.data),updateMask:fV(e.fieldMask)};else{if(!(e instanceof NC))return Ee(16599,{Vt:e.type});n={verify:Th(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,a){const l=a.transform;if(l instanceof Ya)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Eo)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Xa)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Ja)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw Ee(20930,{transform:a.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:sV(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:Ee(27497)}(t,e.precondition)),n}function Ng(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?In.updateTime(Ln(i.updateTime)):i.exists!==void 0?In.exists(i.exists):In.none()}(e.currentDocument):In.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(a,l){let c=null;if("setToServerValue"in l)Te(l.setToServerValue==="REQUEST_TIME",16630,{proto:l}),c=new Ya;else if("appendMissingElements"in l){const h=l.appendMissingElements.values||[];c=new Eo(h)}else if("removeAllFromArray"in l){const h=l.removeAllFromArray.values||[];c=new Xa(h)}else"increment"in l?c=new Ja(a,l.increment):Ee(16584,{proto:l});const d=kt.fromServerFormat(l.fieldPath);return new Ef(d,c)}(t,s)):[];if(e.update){e.update.name;const s=ao(t,e.update.name),i=new En({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(c){const d=c.fieldPaths||[];return new qn(d.map(h=>kt.fromServerFormat(h)))}(e.updateMask);return new Ds(s,i,a,n,r)}return new ul(s,i,n,r)}if(e.delete){const s=ao(t,e.delete);return new Sf(s,n)}if(e.verify){const s=ao(t,e.verify);return new NC(s,n)}return Ee(1463,{proto:e})}function aV(t,e){return t&&t.length>0?(Te(e!==void 0,14353),t.map(n=>function(s,i){let a=s.updateTime?Ln(s.updateTime):Ln(i);return a.isEqual(je.min())&&(a=Ln(i)),new HO(a,s.transformResults||[])}(n,e))):[]}function VC(t,e){return{documents:[DC(t,e.path)]}}function xv(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=DC(t,s);const i=function(d){if(d.length!==0)return UC(dt.create(d,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(h=>function(m){return{field:ei(m.field),direction:uV(m.dir)}}(h))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const l=Sg(t,e.limit);return l!==null&&(n.structuredQuery.limit=l),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{ft:n,parent:s}}function lV(t,e,n,r){const{ft:s,parent:i}=xv(t,e),a={},l=[];let c=0;return n.forEach(d=>{const h="aggregate_"+c++;a[h]=d.alias,d.aggregateType==="count"?l.push({alias:h,count:{}}):d.aggregateType==="avg"?l.push({alias:h,avg:{field:ei(d.fieldPath)}}):d.aggregateType==="sum"&&l.push({alias:h,sum:{field:ei(d.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:l,structuredQuery:s.structuredQuery},parent:s.parent},gt:a,parent:i}}function MC(t){let e=LC(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Te(r===1,65062);const h=n.from[0];h.allDescendants?s=h.collectionId:e=e.child(h.collectionId)}let i=[];n.where&&(i=function(f){const m=FC(f);return m instanceof dt&&hv(m)?m.getFilters():[m]}(n.where));let a=[];n.orderBy&&(a=function(f){return f.map(m=>function(C){return new Yc(oa(C.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(m))}(n.orderBy));let l=null;n.limit&&(l=function(f){let m;return m=typeof f=="object"?f.value:f,pf(m)?null:m}(n.limit));let c=null;n.startAt&&(c=function(f){const m=!!f.before,_=f.values||[];return new Ii(_,m)}(n.startAt));let d=null;return n.endAt&&(d=function(f){const m=!f.before,_=f.values||[];return new Ii(_,m)}(n.endAt)),kO(e,s,a,i,l,"F",c,d)}function cV(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ee(28987,{purpose:s})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function FC(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=oa(n.unaryFilter.field);return tt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=oa(n.unaryFilter.field);return tt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=oa(n.unaryFilter.field);return tt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=oa(n.unaryFilter.field);return tt.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ee(61313);default:return Ee(60726)}}(t):t.fieldFilter!==void 0?function(n){return tt.create(oa(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ee(58110);default:return Ee(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return dt.create(n.compositeFilter.filters.map(r=>FC(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Ee(1026)}}(n.compositeFilter.op))}(t):Ee(30097,{filter:t})}function uV(t){return eV[t]}function dV(t){return tV[t]}function hV(t){return nV[t]}function ei(t){return{fieldPath:t.canonicalString()}}function oa(t){return kt.fromServerFormat(t.fieldPath)}function UC(t){return t instanceof tt?function(n){if(n.op==="=="){if(aw(n.value))return{unaryFilter:{field:ei(n.field),op:"IS_NAN"}};if(ow(n.value))return{unaryFilter:{field:ei(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(aw(n.value))return{unaryFilter:{field:ei(n.field),op:"IS_NOT_NAN"}};if(ow(n.value))return{unaryFilter:{field:ei(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ei(n.field),op:dV(n.op),value:n.value}}}(t):t instanceof dt?function(n){const r=n.getFilters().map(s=>UC(s));return r.length===1?r[0]:{compositeFilter:{op:hV(n.op),filters:r}}}(t):Ee(54877,{filter:t})}function fV(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function $C(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(e,n,r,s,i=je.min(),a=je.min(),l=Xt.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=c}withSequenceNumber(e){return new _s(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new _s(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new _s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new _s(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BC{constructor(e){this.yt=e}}function pV(t,e){let n;if(e.document)n=iV(t.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=pe.fromSegments(e.noDocument.path),s=So(e.noDocument.readTime);n=Ft.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return Ee(56709);{const r=pe.fromSegments(e.unknownDocument.path),s=So(e.unknownDocument.version);n=Ft.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new it(s[0],s[1]);return je.fromTimestamp(i)}(e.readTime)),n}function Iw(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Nh(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,a){return{name:Th(i,a.key),fields:a.data.value.mapValue.fields,updateTime:Za(i,a.version.toTimestamp()),createTime:Za(i,a.createTime.toTimestamp())}}(t.yt,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Io(e.version)};else{if(!e.isUnknownDocument())return Ee(57904,{document:e});r.unknownDocument={path:n.path.toArray(),version:Io(e.version)}}return r}function Nh(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Io(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function So(t){const e=new it(t.seconds,t.nanoseconds);return je.fromTimestamp(e)}function Ki(t,e){const n=(e.baseMutations||[]).map(i=>Ng(t.yt,i));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const l=e.mutations[i+1];a.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>Ng(t.yt,i)),s=it.fromMillis(e.localWriteTimeMs);return new mv(e.batchId,s,n,r)}function Xl(t){const e=So(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?So(t.lastLimboFreeSnapshotVersion):je.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){const a=i.documents.length;return Te(a===1,1966,{count:a}),yr(hu(LC(i.documents[0])))}(t.query):function(i){return yr(MC(i))}(t.query),new _s(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,Xt.fromBase64String(t.resumeToken))}function zC(t,e){const n=Io(e.snapshotVersion),r=Io(e.lastLimboFreeSnapshotVersion);let s;s=Eh(e.target)?VC(t.yt,e.target):xv(t.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:wo(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function qC(t){const e=MC({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Sh(e,e.limit,"L"):e}function Mp(t,e){return new yv(e.largestBatchId,Ng(t.yt,e.overlayMutation))}function Sw(t,e){const n=e.path.lastSegment();return[t,Tn(e.path.popLast()),n]}function Tw(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:Io(r.readTime),documentKey:Tn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mV{getBundleMetadata(e,n){return Cw(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:So(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return Cw(e).put(function(s){return{bundleId:s.id,createTime:Io(Ln(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return Nw(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:qC(i.bundledQuery),readTime:So(i.readTime)}}(r)})}saveNamedQuery(e,n){return Nw(e).put(function(s){return{name:s.name,readTime:Io(Ln(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function Cw(t){return nn(t,mf)}function Nw(t){return nn(t,gf)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(e,n){this.serializer=e,this.userId=n}static wt(e,n){const r=n.uid||"";return new Cf(e,r)}getOverlay(e,n){return kl(e).get(Sw(this.userId,n)).next(r=>r?Mp(this.serializer,r):null)}getOverlays(e,n){const r=Jr();return U.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,a)=>{const l=new yv(n,a);s.push(this.St(e,l))}),U.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(a=>s.add(Tn(a.getCollectionPath())));const i=[];return s.forEach(a=>{const l=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);i.push(kl(e).Z(yg,l))}),U.waitFor(i)}getOverlaysForCollection(e,n,r){const s=Jr(),i=Tn(n),a=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return kl(e).J(yg,a).next(l=>{for(const c of l){const d=Mp(this.serializer,c);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=Jr();let a;const l=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return kl(e).ee({index:WT,range:l},(c,d,h)=>{const f=Mp(this.serializer,d);i.size()<s||f.largestBatchId===a?(i.set(f.getKey(),f),a=f.largestBatchId):h.done()}).next(()=>i)}St(e,n){return kl(e).put(function(s,i,a){const[l,c,d]=Sw(i,a.mutation.key);return{userId:i,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Ch(s.yt,a.mutation)}}(this.serializer,this.userId,n))}}function kl(t){return nn(t,yf)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gV{bt(e){return nn(e,lv)}getSessionToken(e){return this.bt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?Xt.fromUint8Array(r):Xt.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.bt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(Tt(e.integerValue));else if("doubleValue"in e){const r=Tt(e.doubleValue);isNaN(r)?this.Ft(n,13):(this.Ft(n,15),zc(r)?n.Mt(0):n.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(n,20),typeof r=="string"&&(r=As(r)),n.xt(`${r.seconds||""}`),n.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(Ps(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(n,45),n.Mt(r.latitude||0),n.Mt(r.longitude||0)}else"mapValue"in e?sC(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):xf(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):Ee(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){const r=e.fields||{};this.Ft(n,55);for(const s of Object.keys(r))this.Ot(s,n),this.Ct(r[s],n)}kt(e,n){var a,l;const r=e.fields||{};this.Ft(n,53);const s=Ga,i=((l=(a=r[s].arrayValue)==null?void 0:a.values)==null?void 0:l.length)||0;this.Ft(n,15),n.Mt(Tt(i)),this.Ot(s,n),this.Ct(r[s],n)}Qt(e,n){const r=e.values||[];this.Ft(n,50);for(const s of r)this.Ct(s,n)}Lt(e,n){this.Ft(n,37),pe.fromName(e).path.forEach(r=>{this.Ft(n,60),this.Ut(r,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}}Qi.Kt=new Qi;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wo=255;function yV(t){if(t===0)return 8;let e=0;return t>>4||(e+=4,t<<=4),t>>6||(e+=2,t<<=2),t>>7||(e+=1),e}function jw(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const a=yV(255&r[i]);if(s+=a,a!==8)break}return s}(t);return Math.ceil(e/8)}class vV{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Gt(r.value),r=n.next();this.zt()}jt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Jt(r.value),r=n.next();this.Ht()}Yt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=n.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=n.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const n=this.en(e),r=jw(n);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}nn(e){const n=this.en(e),r=jw(n);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}rn(){this.sn(Wo),this.sn(255)}_n(){this.an(Wo),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const n=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(e),r=!!(128&n[0]);n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Gt(e){const n=255&e;n===0?(this.sn(0),this.sn(255)):n===Wo?(this.sn(Wo),this.sn(0)):this.sn(n)}Jt(e){const n=255&e;n===0?(this.an(0),this.an(255)):n===Wo?(this.an(Wo),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class _V{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class xV{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Dl{constructor(){this.cn=new vV,this.ln=new _V(this.cn),this.hn=new xV(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yi{constructor(e,n,r,s){this.Tn=e,this.In=n,this.En=r,this.dn=s}An(){const e=this.dn.length,n=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.dn,0),n!==e?r.set([0],this.dn.length):++r[r.length-1],new Yi(this.Tn,this.In,this.En,r)}Rn(e,n,r){return{indexId:this.Tn,uid:e,arrayValue:Dd(this.En),directionalValue:Dd(this.dn),orderedDocumentKey:Dd(n),documentKey:r.path.toArray()}}Vn(e,n,r){const s=this.Rn(e,n,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Bs(t,e){let n=t.Tn-e.Tn;return n!==0?n:(n=Aw(t.En,e.En),n!==0?n:(n=Aw(t.dn,e.dn),n!==0?n:pe.comparator(t.In,e.In)))}function Aw(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}function Dd(t){return MS()?function(n){let r="";for(let s=0;s<n.length;s++)r+=String.fromCharCode(n[s]);return r}(t):t}function Pw(t){return typeof t!="string"?t:function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(t)}class Rw{constructor(e){this.mn=new ft((n,r)=>kt.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const n of e.filters){const r=n;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(Te(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const n=pg(e);if(n!==void 0&&!this.wn(n))return!1;const r=Hi(e);let s=new Set,i=0,a=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const l=this.mn.getIterator().getNext();if(!s.has(l.field.canonicalString())){const c=r[i];if(!this.Sn(l,c)||!this.bn(this.fn[a++],c))return!1}++i}for(;i<r.length;++i){const l=r[i];if(a>=this.fn.length||!this.bn(this.fn[a++],l))return!1}return!0}Dn(){if(this.pn)return null;let e=new ft(kt.comparator);const n=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new Td(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new Td(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new Td(r.field,r.dir==="asc"?0:1)));return new vh(vh.UNKNOWN_ID,this.collectionId,n,Bc.empty())}wn(e){for(const n of this.gn)if(this.Sn(n,e))return!0;return!1}Sn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}bn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HC(t){var n,r;if(Te(t instanceof tt||t instanceof dt,20012),t instanceof tt){if(t instanceof fC){const s=((r=(n=t.value.arrayValue)==null?void 0:n.values)==null?void 0:r.map(i=>tt.create(t.field,"==",i)))||[];return dt.create(s,"or")}return t}const e=t.filters.map(s=>HC(s));return dt.create(e,t.op)}function bV(t){if(t.getFilters().length===0)return[];const e=Pg(HC(t));return Te(WC(e),7391),jg(e)||Ag(e)?[e]:e.getFilters()}function jg(t){return t instanceof tt}function Ag(t){return t instanceof dt&&hv(t)}function WC(t){return jg(t)||Ag(t)||function(n){if(n instanceof dt&&bg(n)){for(const r of n.getFilters())if(!jg(r)&&!Ag(r))return!1;return!0}return!1}(t)}function Pg(t){if(Te(t instanceof tt||t instanceof dt,34018),t instanceof tt)return t;if(t.filters.length===1)return Pg(t.filters[0]);const e=t.filters.map(r=>Pg(r));let n=dt.create(e,t.op);return n=jh(n),WC(n)?n:(Te(n instanceof dt,64498),Te(Qa(n),40251),Te(n.filters.length>1,57927),n.filters.reduce((r,s)=>bv(r,s)))}function bv(t,e){let n;return Te(t instanceof tt||t instanceof dt,38388),Te(e instanceof tt||e instanceof dt,25473),n=t instanceof tt?e instanceof tt?function(s,i){return dt.create([s,i],"and")}(t,e):kw(t,e):e instanceof tt?kw(e,t):function(s,i){if(Te(s.filters.length>0&&i.filters.length>0,48005),Qa(s)&&Qa(i))return uC(s,i.getFilters());const a=bg(s)?s:i,l=bg(s)?i:s,c=a.filters.map(d=>bv(d,l));return dt.create(c,"or")}(t,e),jh(n)}function kw(t,e){if(Qa(e))return uC(e,t.getFilters());{const n=e.filters.map(r=>bv(t,r));return dt.create(n,"or")}}function jh(t){if(Te(t instanceof tt||t instanceof dt,11850),t instanceof tt)return t;const e=t.getFilters();if(e.length===1)return jh(e[0]);if(lC(t))return t;const n=e.map(s=>jh(s)),r=[];return n.forEach(s=>{s instanceof tt?r.push(s):s instanceof dt&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:dt.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wV{constructor(){this.Cn=new wv}addToCollectionParentIndex(e,n){return this.Cn.add(n),U.resolve()}getCollectionParents(e,n){return U.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return U.resolve()}deleteFieldIndex(e,n){return U.resolve()}deleteAllFieldIndexes(e){return U.resolve()}createTargetIndexes(e,n){return U.resolve()}getDocumentsMatchingTarget(e,n){return U.resolve(null)}getIndexType(e,n){return U.resolve(0)}getFieldIndexes(e,n){return U.resolve([])}getNextCollectionGroupToUpdate(e){return U.resolve(null)}getMinOffset(e,n){return U.resolve(or.min())}getMinOffsetFromCollectionGroup(e,n){return U.resolve(or.min())}updateCollectionGroup(e,n,r){return U.resolve()}updateIndexEntries(e,n){return U.resolve()}}class wv{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new ft(at.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ft(at.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dw="IndexedDbIndexManager",Ju=new Uint8Array(0);class EV{constructor(e,n){this.databaseId=n,this.vn=new wv,this.Fn=new ks(r=>wo(r),(r,s)=>du(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.vn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.vn.add(n)});const i={collectionId:r,parent:Tn(s)};return Lw(e).put(i)}return U.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[DT(n),""],!1,!0);return Lw(e).J(s).next(i=>{for(const a of i){if(a.collectionId!==n)break;r.push(Xr(a.parent))}return r})}addFieldIndex(e,n){const r=Ll(e),s=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const a=Ko(e);return i.next(l=>{a.put(Tw(l,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=Ll(e),s=Ko(e),i=Go(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=Ll(e),r=Go(e),s=Ko(e);return n.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,n){return U.forEach(this.Mn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Rw(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=Go(e);let s=!0;const i=new Map;return U.forEach(this.Mn(n),a=>this.xn(e,a).next(l=>{s&&(s=!!l),i.set(a,l)})).next(()=>{if(s){let a=Ye();const l=[];return U.forEach(i,(c,d)=>{se(Dw,`Using index ${function(E){return`id=${E.indexId}|cg=${E.collectionGroup}|f=${E.fields.map(w=>`${w.fieldPath}:${w.kind}`).join(",")}`}(c)} to execute ${wo(n)}`);const h=function(E,w){const S=pg(w);if(S===void 0)return null;for(const M of Ih(E,S.fieldPath))switch(M.op){case"array-contains-any":return M.value.arrayValue.values||[];case"array-contains":return[M.value]}return null}(d,c),f=function(E,w){const S=new Map;for(const M of Hi(w))for(const g of Ih(E,M.fieldPath))switch(g.op){case"==":case"in":S.set(M.fieldPath.canonicalString(),g.value);break;case"not-in":case"!=":return S.set(M.fieldPath.canonicalString(),g.value),Array.from(S.values())}return null}(d,c),m=function(E,w){const S=[];let M=!0;for(const g of Hi(w)){const v=g.kind===0?hw(E,g.fieldPath,E.startAt):fw(E,g.fieldPath,E.startAt);S.push(v.value),M&&(M=v.inclusive)}return new Ii(S,M)}(d,c),_=function(E,w){const S=[];let M=!0;for(const g of Hi(w)){const v=g.kind===0?fw(E,g.fieldPath,E.endAt):hw(E,g.fieldPath,E.endAt);S.push(v.value),M&&(M=v.inclusive)}return new Ii(S,M)}(d,c),C=this.On(c,d,m),N=this.On(c,d,_),A=this.Nn(c,d,f),T=this.Bn(c.indexId,h,C,m.inclusive,N,_.inclusive,A);return U.forEach(T,I=>r.Y(I,n.limit).next(E=>{E.forEach(w=>{const S=pe.fromSegments(w.documentKey);a.has(S)||(a=a.add(S),l.push(S))})}))}).next(()=>l)}return U.resolve(null)})}Mn(e){let n=this.Fn.get(e);return n||(e.filters.length===0?n=[e]:n=bV(dt.create(e.filters,"and")).map(r=>Eg(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,n),n)}Bn(e,n,r,s,i,a,l){const c=(n!=null?n.length:1)*Math.max(r.length,i.length),d=c/(n!=null?n.length:1),h=[];for(let f=0;f<c;++f){const m=n?this.Ln(n[f/d]):Ju,_=this.kn(e,m,r[f%d],s),C=this.qn(e,m,i[f%d],a),N=l.map(A=>this.kn(e,m,A,!0));h.push(...this.createRange(_,C,N))}return h}kn(e,n,r,s){const i=new Yi(e,pe.empty(),n,r);return s?i:i.An()}qn(e,n,r,s){const i=new Yi(e,pe.empty(),n,r);return s?i.An():i}xn(e,n){const r=new Rw(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let a=null;for(const l of i)r.yn(l)&&(!a||l.fields.length>a.fields.length)&&(a=l);return a})}getIndexType(e,n){let r=2;const s=this.Mn(n);return U.forEach(s,i=>this.xn(e,i).next(a=>{a?r!==0&&a.fields.length<function(c){let d=new ft(kt.comparator),h=!1;for(const f of c.filters)for(const m of f.getFlattenedFilters())m.field.isKeyField()||(m.op==="array-contains"||m.op==="array-contains-any"?h=!0:d=d.add(m.field));for(const f of c.orderBy)f.field.isKeyField()||(d=d.add(f.field));return d.size+(h?1:0)}(i)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(n)&&s.length>1&&r===2?1:r)}Qn(e,n){const r=new Dl;for(const s of Hi(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const a=r.Pn(s.kind);Qi.Kt.Dt(i,a)}return r.un()}Ln(e){const n=new Dl;return Qi.Kt.Dt(e,n.Pn(0)),n.un()}$n(e,n){const r=new Dl;return Qi.Kt.Dt(bo(this.databaseId,n),r.Pn(function(i){const a=Hi(i);return a.length===0?0:a[a.length-1].kind}(e))),r.un()}Nn(e,n,r){if(r===null)return[];let s=[];s.push(new Dl);let i=0;for(const a of Hi(e)){const l=r[i++];for(const c of s)if(this.Un(n,a.fieldPath)&&Qc(l))s=this.Kn(s,a,l);else{const d=c.Pn(a.kind);Qi.Kt.Dt(l,d)}}return this.Wn(s)}On(e,n,r){return this.Nn(e,n,r.position)}Wn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].un();return n}Kn(e,n,r){const s=[...e],i=[];for(const a of r.arrayValue.values||[])for(const l of s){const c=new Dl;c.seed(l.un()),Qi.Kt.Dt(a,c.Pn(n.kind)),i.push(c)}return i}Un(e,n){return!!e.filters.find(r=>r instanceof tt&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=Ll(e),s=Ko(e);return(n?r.J(gg,IDBKeyRange.bound(n,n)):r.J()).next(i=>{const a=[];return U.forEach(i,l=>s.get([l.indexId,this.uid]).next(c=>{a.push(function(h,f){const m=f?new Bc(f.sequenceNumber,new or(So(f.readTime),new pe(Xr(f.documentKey)),f.largestBatchId)):Bc.empty(),_=h.fields.map(([C,N])=>new Td(kt.fromServerFormat(C),N));return new vh(h.indexId,h.collectionGroup,_,m)}(l,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:ze(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Ll(e),i=Ko(e);return this.Gn(e).next(a=>s.J(gg,IDBKeyRange.bound(n,n)).next(l=>U.forEach(l,c=>i.put(Tw(c.indexId,this.uid,a,r)))))}updateIndexEntries(e,n){const r=new Map;return U.forEach(n,(s,i)=>{const a=r.get(s.collectionGroup);return(a?U.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next(l=>(r.set(s.collectionGroup,l),U.forEach(l,c=>this.zn(e,s,c).next(d=>{const h=this.jn(i,c);return d.isEqual(h)?U.resolve():this.Jn(e,i,c,d,h)}))))})}Hn(e,n,r,s){return Go(e).put(s.Rn(this.uid,this.$n(r,n.key),n.key))}Yn(e,n,r,s){return Go(e).delete(s.Vn(this.uid,this.$n(r,n.key),n.key))}zn(e,n,r){const s=Go(e);let i=new ft(Bs);return s.ee({index:HT,range:IDBKeyRange.only([r.indexId,this.uid,Dd(this.$n(r,n))])},(a,l)=>{i=i.add(new Yi(r.indexId,n,Pw(l.arrayValue),Pw(l.directionalValue)))}).next(()=>i)}jn(e,n){let r=new ft(Bs);const s=this.Qn(n,e);if(s==null)return r;const i=pg(n);if(i!=null){const a=e.data.field(i.fieldPath);if(Qc(a))for(const l of a.arrayValue.values||[])r=r.add(new Yi(n.indexId,e.key,this.Ln(l),s))}else r=r.add(new Yi(n.indexId,e.key,Ju,s));return r}Jn(e,n,r,s,i){se(Dw,"Updating index entries for document '%s'",n.key);const a=[];return function(c,d,h,f,m){const _=c.getIterator(),C=d.getIterator();let N=Ho(_),A=Ho(C);for(;N||A;){let T=!1,I=!1;if(N&&A){const E=h(N,A);E<0?I=!0:E>0&&(T=!0)}else N!=null?I=!0:T=!0;T?(f(A),A=Ho(C)):I?(m(N),N=Ho(_)):(N=Ho(_),A=Ho(C))}}(s,i,Bs,l=>{a.push(this.Hn(e,n,r,l))},l=>{a.push(this.Yn(e,n,r,l))}),U.waitFor(a)}Gn(e){let n=1;return Ko(e).ee({index:qT,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((a,l)=>Bs(a,l)).filter((a,l,c)=>!l||Bs(a,c[l-1])!==0);const s=[];s.push(e);for(const a of r){const l=Bs(a,e),c=Bs(a,n);if(l===0)s[0]=e.An();else if(l>0&&c<0)s.push(a),s.push(a.An());else if(c>0)break}s.push(n);const i=[];for(let a=0;a<s.length;a+=2){if(this.Zn(s[a],s[a+1]))return[];const l=s[a].Vn(this.uid,Ju,pe.empty()),c=s[a+1].Vn(this.uid,Ju,pe.empty());i.push(IDBKeyRange.bound(l,c))}return i}Zn(e,n){return Bs(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(Ow)}getMinOffset(e,n){return U.mapArray(this.Mn(n),r=>this.xn(e,r).next(s=>s||Ee(44426))).next(Ow)}}function Lw(t){return nn(t,Wc)}function Go(t){return nn(t,mc)}function Ll(t){return nn(t,av)}function Ko(t){return nn(t,pc)}function Ow(t){Te(t.length!==0,28825);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;sv(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new or(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},GC=41943040;class bn{static withCacheSize(e){return new bn(e,bn.DEFAULT_COLLECTION_PERCENTILE,bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KC(t,e,n){const r=t.store(jr),s=t.store(za),i=[],a=IDBKeyRange.only(n.batchId);let l=0;const c=r.ee({range:a},(h,f,m)=>(l++,m.delete()));i.push(c.next(()=>{Te(l===1,47070,{batchId:n.batchId})}));const d=[];for(const h of n.mutations){const f=$T(e,h.key.path,n.batchId);i.push(s.delete(f)),d.push(h.key)}return U.waitFor(i).next(()=>d)}function Ah(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ee(14731);e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */bn.DEFAULT_COLLECTION_PERCENTILE=10,bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bn.DEFAULT=new bn(GC,bn.DEFAULT_COLLECTION_PERCENTILE,bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bn.DISABLED=new bn(-1,0,0);class Nf{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,n,r,s){Te(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Nf(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return zs(e).ee({index:to,range:r},(s,i,a)=>{n=!1,a.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=aa(e),a=zs(e);return a.add({}).next(l=>{Te(typeof l=="number",49019);const c=new mv(l,n,r,s),d=function(_,C,N){const A=N.baseMutations.map(I=>Ch(_.yt,I)),T=N.mutations.map(I=>Ch(_.yt,I));return{userId:C,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:A,mutations:T}}(this.serializer,this.userId,c),h=[];let f=new ft((m,_)=>ze(m.canonicalString(),_.canonicalString()));for(const m of s){const _=$T(this.userId,m.key.path,l);f=f.add(m.key.path.popLast()),h.push(a.put(d)),h.push(i.put(_,YL))}return f.forEach(m=>{h.push(this.indexManager.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Xn[l]=c.keys()}),U.waitFor(h).next(()=>c)})}lookupMutationBatch(e,n){return zs(e).get(n).next(r=>r?(Te(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:n}),Ki(this.serializer,r)):null)}er(e,n){return this.Xn[n]?U.resolve(this.Xn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Xn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return zs(e).ee({index:to,range:s},(a,l,c)=>{l.userId===this.userId&&(Te(l.batchId>=r,47524,{tr:r}),i=Ki(this.serializer,l)),c.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=io;return zs(e).ee({index:to,range:n,reverse:!0},(s,i,a)=>{r=i.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,io],[this.userId,Number.POSITIVE_INFINITY]);return zs(e).J(to,n).next(r=>r.map(s=>Ki(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=Cd(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return aa(e).ee({range:s},(a,l,c)=>{const[d,h,f]=a,m=Xr(h);if(d===this.userId&&n.path.isEqual(m))return zs(e).get(f).next(_=>{if(!_)throw Ee(61480,{nr:a,batchId:f});Te(_.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:_.userId,batchId:f}),i.push(Ki(this.serializer,_))});c.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ft(ze);const s=[];return n.forEach(i=>{const a=Cd(this.userId,i.path),l=IDBKeyRange.lowerBound(a),c=aa(e).ee({range:l},(d,h,f)=>{const[m,_,C]=d,N=Xr(_);m===this.userId&&i.path.isEqual(N)?r=r.add(C):f.done()});s.push(c)}),U.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=Cd(this.userId,r),a=IDBKeyRange.lowerBound(i);let l=new ft(ze);return aa(e).ee({range:a},(c,d,h)=>{const[f,m,_]=c,C=Xr(m);f===this.userId&&r.isPrefixOf(C)?C.length===s&&(l=l.add(_)):h.done()}).next(()=>this.rr(e,l))}rr(e,n){const r=[],s=[];return n.forEach(i=>{s.push(zs(e).get(i).next(a=>{if(a===null)throw Ee(35274,{batchId:i});Te(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),r.push(Ki(this.serializer,a))}))}),U.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return KC(e.le,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.ir(n.batchId)}),U.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return U.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return aa(e).ee({range:r},(i,a,l)=>{if(i[0]===this.userId){const c=Xr(i[1]);s.push(c)}else l.done()}).next(()=>{Te(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,n){return QC(e,this.userId,n)}_r(e){return YC(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:io,lastStreamToken:""})}}function QC(t,e,n){const r=Cd(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return aa(t).ee({range:i,X:!0},(l,c,d)=>{const[h,f,m]=l;h===e&&f===s&&(a=!0),d.done()}).next(()=>a)}function zs(t){return nn(t,jr)}function aa(t){return nn(t,za)}function YC(t){return nn(t,qc)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new To(0)}static cr(){return new To(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IV{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.lr(e).next(n=>{const r=new To(n.highestTargetId);return n.highestTargetId=r.next(),this.hr(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(n=>je.fromTimestamp(new it(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.hr(e,s)))}addTargetData(e,n){return this.Pr(e,n).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(n,r),this.hr(e,r))))}updateTargetData(e,n){return this.Pr(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>Qo(e).delete(n.targetId)).next(()=>this.lr(e)).next(r=>(Te(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return Qo(e).ee((a,l)=>{const c=Xl(l);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(s++,i.push(this.removeTargetData(e,c)))}).next(()=>U.waitFor(i)).next(()=>s)}forEachTarget(e,n){return Qo(e).ee((r,s)=>{const i=Xl(s);n(i)})}lr(e){return Mw(e).get(bh).next(n=>(Te(n!==null,2888),n))}hr(e,n){return Mw(e).put(bh,n)}Pr(e,n){return Qo(e).put(zC(this.serializer,n))}Tr(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(n=>n.targetCount)}getTargetData(e,n){const r=wo(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Qo(e).ee({range:s,index:zT},(a,l,c)=>{const d=Xl(l);du(n,d.target)&&(i=d,c.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=ti(e);return n.forEach(a=>{const l=Tn(a.path);s.push(i.put({targetId:r,path:l})),s.push(this.referenceDelegate.addReference(e,r,a))}),U.waitFor(s)}removeMatchingKeys(e,n,r){const s=ti(e);return U.forEach(n,i=>{const a=Tn(i.path);return U.waitFor([s.delete([r,a]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=ti(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=ti(e);let i=Ye();return s.ee({range:r,X:!0},(a,l,c)=>{const d=Xr(a[1]),h=new pe(d);i=i.add(h)}).next(()=>i)}containsKey(e,n){const r=Tn(n.path),s=IDBKeyRange.bound([r],[DT(r)],!1,!0);let i=0;return ti(e).ee({index:ov,X:!0,range:s},([a,l],c,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}At(e,n){return Qo(e).get(n).next(r=>r?Xl(r):null)}}function Qo(t){return nn(t,qa)}function Mw(t){return nn(t,oo)}function ti(t){return nn(t,Ha)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fw="LruGarbageCollector",SV=1048576;function Uw([t,e],[n,r]){const s=ze(t,n);return s===0?ze(e,r):s}class TV{constructor(e){this.Ir=e,this.buffer=new ft(Uw),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();Uw(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class XC{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){se(Fw,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){ki(n)?se(Fw,"Ignoring IndexedDB error during garbage collection: ",n):await Mo(n)}await this.Vr(3e5)})}}class CV{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return U.resolve(mr.ce);const r=new TV(n);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(se("LruGarbageCollector","Garbage collection skipped; disabled"),U.resolve(Vw)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(se("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Vw):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,i,a,l,c,d;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(se("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),s=this.params.maximumSequenceNumbersToCollect):s=f,a=Date.now(),this.nthSequenceNumber(e,s))).next(f=>(r=f,l=Date.now(),this.removeTargets(e,r,n))).next(f=>(i=f,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(d=Date.now(),sa()<=et.DEBUG&&se("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(c-l)+`ms
	Removed ${f} documents in `+(d-c)+`ms
Total Duration: ${d-h}ms`),U.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:f})))}}function JC(t,e){return new CV(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NV{constructor(e,n){this.db=e,this.garbageCollector=JC(this,n)}gr(e){const n=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}pr(e,n){return this.Sr(e,(r,s)=>n(s))}addReference(e,n,r){return Zu(e,r)}removeReference(e,n,r){return Zu(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Zu(e,n)}br(e,n){return function(s,i){let a=!1;return YC(s).te(l=>QC(s,l,i).next(c=>(c&&(a=!0),U.resolve(!c)))).next(()=>a)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(a,l)=>{if(l<=n){const c=this.br(e,a).next(d=>{if(!d)return i++,r.getEntry(e,a).next(()=>(r.removeEntry(a,je.min()),ti(e).delete(function(f){return[0,Tn(f.path)]}(a))))});s.push(c)}}).next(()=>U.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Zu(e,n)}Sr(e,n){const r=ti(e);let s,i=mr.ce;return r.ee({index:ov},([a,l],{path:c,sequenceNumber:d})=>{a===0?(i!==mr.ce&&n(new pe(Xr(s)),i),i=d,s=c):i=mr.ce}).next(()=>{i!==mr.ce&&n(new pe(Xr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Zu(t,e){return ti(t).put(function(r,s){return{targetId:0,path:Tn(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC{constructor(){this.changes=new ks(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Ft.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?U.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jV{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return $i(e).put(r)}removeEntry(e,n,r){return $i(e).delete(function(i,a){const l=i.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],Nh(a),l[l.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Dr(e,r)))}getEntry(e,n){let r=Ft.newInvalidDocument(n);return $i(e).ee({index:Nd,range:IDBKeyRange.only(Ol(n))},(s,i)=>{r=this.Cr(n,i)}).next(()=>r)}vr(e,n){let r={size:0,document:Ft.newInvalidDocument(n)};return $i(e).ee({index:Nd,range:IDBKeyRange.only(Ol(n))},(s,i)=>{r={document:this.Cr(n,i),size:Ah(i)}}).next(()=>r)}getEntries(e,n){let r=nr();return this.Fr(e,n,(s,i)=>{const a=this.Cr(s,i);r=r.insert(s,a)}).next(()=>r)}Mr(e,n){let r=nr(),s=new jt(pe.comparator);return this.Fr(e,n,(i,a)=>{const l=this.Cr(i,a);r=r.insert(i,l),s=s.insert(i,Ah(a))}).next(()=>({documents:r,Or:s}))}Fr(e,n,r){if(n.isEmpty())return U.resolve();let s=new ft(zw);n.forEach(c=>s=s.add(c));const i=IDBKeyRange.bound(Ol(s.first()),Ol(s.last())),a=s.getIterator();let l=a.getNext();return $i(e).ee({index:Nd,range:i},(c,d,h)=>{const f=pe.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;l&&zw(l,f)<0;)r(l,null),l=a.getNext();l&&l.isEqual(f)&&(r(l,d),l=a.hasNext()?a.getNext():null),l?h.j(Ol(l)):h.done()}).next(()=>{for(;l;)r(l,null),l=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const a=n.path,l=[a.popLast().toArray(),a.lastSegment(),Nh(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return $i(e).J(IDBKeyRange.bound(l,c,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let h=nr();for(const f of d){const m=this.Cr(pe.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);m.isFoundDocument()&&(fu(n,m)||s.has(m.key))&&(h=h.insert(m.key,m))}return h})}getAllFromCollectionGroup(e,n,r,s){let i=nr();const a=Bw(n,r),l=Bw(n,or.max());return $i(e).ee({index:BT,range:IDBKeyRange.bound(a,l,!0)},(c,d,h)=>{const f=this.Cr(pe.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(f.key,f),i.size===s&&h.done()}).next(()=>i)}newChangeBuffer(e){return new AV(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return $w(e).get(mg).next(n=>(Te(!!n,20021),n))}Dr(e,n){return $w(e).put(mg,n)}Cr(e,n){if(n){const r=pV(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(je.min())))return r}return Ft.newInvalidDocument(e)}}function eN(t){return new jV(t)}class AV extends ZC{constructor(e,n){super(),this.Nr=e,this.trackRemovals=n,this.Br=new ks(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new ft((i,a)=>ze(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const l=this.Br.get(i);if(n.push(this.Nr.removeEntry(e,i,l.readTime)),a.isValidDocument()){const c=Iw(this.Nr.serializer,a);s=s.add(i.path.popLast());const d=Ah(c);r+=d-l.size,n.push(this.Nr.addEntry(e,i,c))}else if(r-=l.size,this.trackRemovals){const c=Iw(this.Nr.serializer,a.convertToNoDocument(je.min()));n.push(this.Nr.addEntry(e,i,c))}}),s.forEach(i=>{n.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.Nr.updateMetadata(e,r)),U.waitFor(n)}getFromCache(e,n){return this.Nr.vr(e,n).next(r=>(this.Br.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Nr.Mr(e,n).next(({documents:r,Or:s})=>(s.forEach((i,a)=>{this.Br.set(i,{size:a,readTime:r.get(i).readTime})}),r))}}function $w(t){return nn(t,Hc)}function $i(t){return nn(t,xh)}function Ol(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Bw(t,e){const n=e.documentKey.path.toArray();return[t,Nh(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function zw(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=ze(n[i],r[i]),s)return s;return s=ze(n.length,r.length),s||(s=ze(n[n.length-2],r[r.length-2]),s||ze(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tN{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&vc(r.mutation,s,qn.empty(),it.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ye()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ye()){const s=Jr();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let a=Ql();return i.forEach((l,c)=>{a=a.insert(l,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=Jr();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ye()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,l)=>{n.set(a,l)})})}computeViews(e,n,r,s){let i=nr();const a=yc(),l=function(){return yc()}();return n.forEach((c,d)=>{const h=r.get(d.key);s.has(d.key)&&(h===void 0||h.mutation instanceof Ds)?i=i.insert(d.key,d):h!==void 0?(a.set(d.key,h.mutation.getFieldMask()),vc(h.mutation,d,h.mutation.getFieldMask(),it.now())):a.set(d.key,qn.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((d,h)=>a.set(d,h)),n.forEach((d,h)=>l.set(d,new PV(h,a.get(d)??null))),l))}recalculateAndSaveOverlays(e,n){const r=yc();let s=new jt((a,l)=>a-l),i=Ye();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const l of a)l.keys().forEach(c=>{const d=n.get(c);if(d===null)return;let h=r.get(c)||qn.empty();h=l.applyToLocalView(d,h),r.set(c,h);const f=(s.get(l.batchId)||Ye()).add(c);s=s.insert(l.batchId,f)})}).next(()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const c=l.getNext(),d=c.key,h=c.value,f=_C();h.forEach(m=>{if(!i.has(m)){const _=TC(n.get(m),r.get(m));_!==null&&f.set(m,_),i=i.add(m)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,f))}return U.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(a){return pe.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):fv(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):U.resolve(Jr());let l=$c,c=i;return a.next(d=>U.forEach(d,(h,f)=>(l<f.largestBatchId&&(l=f.largestBatchId),i.get(h)?U.resolve():this.remoteDocumentCache.getEntry(e,h).next(m=>{c=c.insert(h,m)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,c,d,Ye())).next(h=>({batchId:l,changes:vC(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new pe(n)).next(r=>{let s=Ql();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let a=Ql();return this.indexManager.getCollectionParents(e,i).next(l=>U.forEach(l,c=>{const d=function(f,m){return new Li(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(h=>{h.forEach((f,m)=>{a=a.insert(f,m)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(a=>{i.forEach((c,d)=>{const h=d.getKey();a.get(h)===null&&(a=a.insert(h,Ft.newInvalidDocument(h)))});let l=Ql();return a.forEach((c,d)=>{const h=i.get(c);h!==void 0&&vc(h.mutation,d,qn.empty(),it.now()),fu(n,d)&&(l=l.insert(c,d))}),l})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RV{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return U.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:Ln(s.createTime)}}(n)),U.resolve()}getNamedQuery(e,n){return U.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(s){return{name:s.name,query:qC(s.bundledQuery),readTime:Ln(s.readTime)}}(n)),U.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kV{constructor(){this.overlays=new jt(pe.comparator),this.qr=new Map}getOverlay(e,n){return U.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Jr();return U.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.St(e,n,i)}),U.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),U.resolve()}getOverlaysForCollection(e,n,r){const s=Jr(),i=n.length+1,a=new pe(n.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const c=l.getNext().value,d=c.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return U.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new jt((d,h)=>d-h);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let h=i.get(d.largestBatchId);h===null&&(h=Jr(),i=i.insert(d.largestBatchId,h)),h.set(d.getKey(),d)}}const l=Jr(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,h)=>l.set(d,h)),!(l.size()>=s)););return U.resolve(l)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new yv(n,r));let i=this.qr.get(n);i===void 0&&(i=Ye(),this.qr.set(n,i)),this.qr.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DV{constructor(){this.sessionToken=Xt.EMPTY_BYTE_STRING}getSessionToken(e){return U.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,U.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ev{constructor(){this.Qr=new ft(on.$r),this.Ur=new ft(on.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new on(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new on(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new pe(new at([])),r=new on(n,e),s=new on(n,e+1),i=[];return this.Ur.forEachInRange([r,s],a=>{this.Gr(a),i.push(a.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new pe(new at([])),r=new on(n,e),s=new on(n,e+1);let i=Ye();return this.Ur.forEachInRange([r,s],a=>{i=i.add(a.key)}),i}containsKey(e){const n=new on(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class on{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return pe.comparator(e.key,n.key)||ze(e.Yr,n.Yr)}static Kr(e,n){return ze(e.Yr,n.Yr)||pe.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new ft(on.$r)}checkEmpty(e){return U.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new mv(i,n,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new on(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return U.resolve(a)}lookupMutationBatch(e,n){return U.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),i=s<0?0:s;return U.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return U.resolve(this.mutationQueue.length===0?io:this.tr-1)}getAllMutationBatches(e){return U.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new on(n,0),s=new on(n,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],a=>{const l=this.Xr(a.Yr);i.push(l)}),U.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ft(ze);return n.forEach(s=>{const i=new on(s,0),a=new on(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],l=>{r=r.add(l.Yr)})}),U.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;pe.isDocumentKey(i)||(i=i.child(""));const a=new on(new pe(i),0);let l=new ft(ze);return this.Zr.forEachWhile(c=>{const d=c.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(c.Yr)),!0)},a),U.resolve(this.ti(l))}ti(e){const n=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){Te(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return U.forEach(n.mutations,s=>{const i=new on(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new on(n,0),s=this.Zr.firstAfterOrEqual(r);return U.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,U.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OV{constructor(e){this.ri=e,this.docs=function(){return new jt(pe.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return U.resolve(r?r.document.mutableCopy():Ft.newInvalidDocument(n))}getEntries(e,n){let r=nr();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ft.newInvalidDocument(s))}),U.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=nr();const a=n.path,l=new pe(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(l);for(;c.hasNext();){const{key:d,value:{document:h}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||sv(VT(h),r)<=0||(s.has(h.key)||fu(n,h))&&(i=i.insert(h.key,h.mutableCopy()))}return U.resolve(i)}getAllFromCollectionGroup(e,n,r,s){Ee(9500)}ii(e,n){return U.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new VV(this)}getSize(e){return U.resolve(this.size)}}class VV extends ZC{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),U.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV{constructor(e){this.persistence=e,this.si=new ks(n=>wo(n),du),this.lastRemoteSnapshotVersion=je.min(),this.highestTargetId=0,this.oi=0,this._i=new Ev,this.targetCount=0,this.ai=To.ur()}forEachTarget(e,n){return this.si.forEach((r,s)=>n(s)),U.resolve()}getLastRemoteSnapshotVersion(e){return U.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return U.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),U.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),U.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new To(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,U.resolve()}updateTargetData(e,n){return this.Pr(n),U.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,U.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.si.forEach((a,l)=>{l.sequenceNumber<=n&&r.get(l.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)}),U.waitFor(i).next(()=>s)}getTargetCount(e){return U.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return U.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),U.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),U.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),U.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return U.resolve(r)}containsKey(e,n){return U.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{constructor(e,n){this.ui={},this.overlays={},this.ci=new mr(0),this.li=!1,this.li=!0,this.hi=new DV,this.referenceDelegate=e(this),this.Pi=new MV(this),this.indexManager=new wV,this.remoteDocumentCache=function(s){return new OV(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new BC(n),this.Ii=new RV(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new kV,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new LV(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){se("MemoryPersistence","Starting transaction:",e);const s=new FV(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,n){return U.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class FV extends FT{constructor(e){super(),this.currentSequenceNumber=e}}class jf{constructor(e){this.persistence=e,this.Ri=new Ev,this.Vi=null}static mi(e){return new jf(e)}get fi(){if(this.Vi)return this.Vi;throw Ee(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),U.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),U.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),U.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return U.forEach(this.fi,r=>{const s=pe.fromPath(r);return this.gi(e,s).next(i=>{i||n.removeEntry(s,je.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return U.or([()=>U.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Ph{constructor(e,n){this.persistence=e,this.pi=new ks(r=>Tn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=JC(this,n)}static mi(e,n){return new Ph(e,n)}Ei(){}di(e){return U.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return U.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?U.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,a=>this.br(e,a,n).next(l=>{l||(r++,i.removeEntry(a,je.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),U.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),U.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),U.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),U.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Ad(e.data.value)),n}br(e,n,r){return U.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return U.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UV{constructor(e){this.serializer=e}k(e,n,r,s){const i=new ff("createOrUpgrade",n);r<1&&s>=1&&(function(c){c.createObjectStore(uu)}(e),function(c){c.createObjectStore(qc,{keyPath:QL}),c.createObjectStore(jr,{keyPath:ew,autoIncrement:!0}).createIndex(to,tw,{unique:!0}),c.createObjectStore(za)}(e),qw(e),function(c){c.createObjectStore(Wi)}(e));let a=U.resolve();return r<3&&s>=3&&(r!==0&&(function(c){c.deleteObjectStore(Ha),c.deleteObjectStore(qa),c.deleteObjectStore(oo)}(e),qw(e)),a=a.next(()=>function(c){const d=c.store(oo),h={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:je.min().toTimestamp(),targetCount:0};return d.put(bh,h)}(i))),r<4&&s>=4&&(r!==0&&(a=a.next(()=>function(c,d){return d.store(jr).J().next(f=>{c.deleteObjectStore(jr),c.createObjectStore(jr,{keyPath:ew,autoIncrement:!0}).createIndex(to,tw,{unique:!0});const m=d.store(jr),_=f.map(C=>m.put(C));return U.waitFor(_)})}(e,i))),a=a.next(()=>{(function(c){c.createObjectStore(Wa,{keyPath:sO})})(e)})),r<5&&s>=5&&(a=a.next(()=>this.yi(i))),r<6&&s>=6&&(a=a.next(()=>(function(c){c.createObjectStore(Hc)}(e),this.wi(i)))),r<7&&s>=7&&(a=a.next(()=>this.Si(i))),r<8&&s>=8&&(a=a.next(()=>this.bi(e,i))),r<9&&s>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(a=a.next(()=>this.Di(i))),r<11&&s>=11&&(a=a.next(()=>{(function(c){c.createObjectStore(mf,{keyPath:iO})})(e),function(c){c.createObjectStore(gf,{keyPath:oO})}(e)})),r<12&&s>=12&&(a=a.next(()=>{(function(c){const d=c.createObjectStore(yf,{keyPath:fO});d.createIndex(yg,pO,{unique:!1}),d.createIndex(WT,mO,{unique:!1})})(e)})),r<13&&s>=13&&(a=a.next(()=>function(c){const d=c.createObjectStore(xh,{keyPath:XL});d.createIndex(Nd,JL),d.createIndex(BT,ZL)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Wi))),r<14&&s>=14&&(a=a.next(()=>this.Fi(e,i))),r<15&&s>=15&&(a=a.next(()=>function(c){c.createObjectStore(av,{keyPath:aO,autoIncrement:!0}).createIndex(gg,lO,{unique:!1}),c.createObjectStore(pc,{keyPath:cO}).createIndex(qT,uO,{unique:!1}),c.createObjectStore(mc,{keyPath:dO}).createIndex(HT,hO,{unique:!1})}(e))),r<16&&s>=16&&(a=a.next(()=>{n.objectStore(pc).clear()}).next(()=>{n.objectStore(mc).clear()})),r<17&&s>=17&&(a=a.next(()=>{(function(c){c.createObjectStore(lv,{keyPath:gO})})(e)})),r<18&&s>=18&&MS()&&(a=a.next(()=>{n.objectStore(pc).clear()}).next(()=>{n.objectStore(mc).clear()})),a}wi(e){let n=0;return e.store(Wi).ee((r,s)=>{n+=Ah(s)}).next(()=>{const r={byteSize:n};return e.store(Hc).put(mg,r)})}yi(e){const n=e.store(qc),r=e.store(jr);return n.J().next(s=>U.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,io],[i.userId,i.lastAcknowledgedBatchId]);return r.J(to,a).next(l=>U.forEach(l,c=>{Te(c.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});const d=Ki(this.serializer,c);return KC(e,i.userId,d).next(()=>{})}))}))}Si(e){const n=e.store(Ha),r=e.store(Wi);return e.store(oo).get(bh).next(s=>{const i=[];return r.ee((a,l)=>{const c=new at(a),d=function(f){return[0,Tn(f)]}(c);i.push(n.get(d).next(h=>h?U.resolve():(f=>n.put({targetId:0,path:Tn(f),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>U.waitFor(i))})}bi(e,n){e.createObjectStore(Wc,{keyPath:rO});const r=n.store(Wc),s=new wv,i=a=>{if(s.add(a)){const l=a.lastSegment(),c=a.popLast();return r.put({collectionId:l,parent:Tn(c)})}};return n.store(Wi).ee({X:!0},(a,l)=>{const c=new at(a);return i(c.popLast())}).next(()=>n.store(za).ee({X:!0},([a,l,c],d)=>{const h=Xr(l);return i(h.popLast())}))}Di(e){const n=e.store(qa);return n.ee((r,s)=>{const i=Xl(s),a=zC(this.serializer,i);return n.put(a)})}Ci(e,n){const r=n.store(Wi),s=[];return r.ee((i,a)=>{const l=n.store(xh),c=function(f){return f.document?new pe(at.fromString(f.document.name).popFirst(5)):f.noDocument?pe.fromSegments(f.noDocument.path):f.unknownDocument?pe.fromSegments(f.unknownDocument.path):Ee(36783)}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(l.put(d))}).next(()=>U.waitFor(s))}Fi(e,n){const r=n.store(jr),s=eN(this.serializer),i=new Iv(jf.mi,this.serializer.yt);return r.J().next(a=>{const l=new Map;return a.forEach(c=>{let d=l.get(c.userId)??Ye();Ki(this.serializer,c).keys().forEach(h=>d=d.add(h)),l.set(c.userId,d)}),U.forEach(l,(c,d)=>{const h=new hn(d),f=Cf.wt(this.serializer,h),m=i.getIndexManager(h),_=Nf.wt(h,this.serializer,m,i.referenceDelegate);return new tN(s,_,f,m).recalculateAndSaveOverlaysForDocumentKeys(new vg(n,mr.ce),c).next()})})}}function qw(t){t.createObjectStore(Ha,{keyPath:tO}).createIndex(ov,nO,{unique:!0}),t.createObjectStore(qa,{keyPath:"targetId"}).createIndex(zT,eO,{unique:!0}),t.createObjectStore(oo)}const qs="IndexedDbPersistence",Fp=18e5,Up=5e3,$p="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",$V="main";class Sv{constructor(e,n,r,s,i,a,l,c,d,h,f=18){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Mi=i,this.window=a,this.document=l,this.xi=d,this.Oi=h,this.Ni=f,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=m=>Promise.resolve(),!Sv.v())throw new ae(G.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new NV(this,s),this.$i=n+$V,this.serializer=new BC(c),this.Ui=new vi(this.$i,this.Ni,new UV(this.serializer)),this.hi=new gV,this.Pi=new IV(this.referenceDelegate,this.serializer),this.remoteDocumentCache=eN(this.serializer),this.Ii=new mV,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,h===!1&&Rn(qs,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ae(G.FAILED_PRECONDITION,$p);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new mr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ed(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(n=>{n||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(n=>this.isPrimary&&!n?this.Zi(e).next(()=>!1):!!n&&this.Xi(e).next(()=>!0))).catch(e=>{if(ki(e))return se(qs,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return se(qs,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Vl(e).get(qo).next(n=>U.resolve(this.es(n)))}ts(e){return ed(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Fp)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=nn(n,Wa);return r.J().next(s=>{const i=this.ss(s,Fp),a=s.filter(l=>i.indexOf(l)===-1);return U.forEach(a,l=>r.delete(l.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ki)for(const n of e)this.Ki.removeItem(this._s(n.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?U.resolve(!0):Vl(e).get(qo).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,Up)&&!this.us(n.ownerId)){if(this.es(n)&&this.networkEnabled)return!0;if(!this.es(n)){if(!n.allowTabSynchronization)throw new ae(G.FAILED_PRECONDITION,$p);return!1}}return!(!this.networkEnabled||!this.inForeground)||ed(e).J().next(r=>this.ss(r,Up).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,l=this.networkEnabled===s.networkEnabled;if(i||a&&l)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&se(qs,`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[uu,Wa],e=>{const n=new vg(e,mr.ce);return this.Zi(n).next(()=>this.ts(n))}),this.Ui.close(),this.Ps()}ss(e,n){return e.filter(r=>this.rs(r.updateTimeMs,n)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>ed(e).J().next(n=>this.ss(n,Fp).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,n){return Nf.wt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new EV(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Cf.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,n,r){se(qs,"Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(c){return c===18?_O:c===17?YT:c===16?vO:c===15?cv:c===14?QT:c===13?KT:c===12?yO:c===11?GT:void Ee(60245)}(this.Ni);let a;return this.Ui.runTransaction(e,s,i,l=>(a=new vg(l,this.ci?this.ci.next():mr.ce),n==="readwrite-primary"?this.Hi(a).next(c=>!!c||this.Yi(a)).next(c=>{if(!c)throw Rn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new ae(G.FAILED_PRECONDITION,MT);return r(a)}).next(c=>this.Xi(a).next(()=>c)):this.Is(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Is(e){return Vl(e).get(qo).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,Up)&&!this.us(n.ownerId)&&!this.es(n)&&!(this.Oi||this.allowTabSynchronization&&n.allowTabSynchronization))throw new ae(G.FAILED_PRECONDITION,$p)})}Xi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Vl(e).put(qo,n)}static v(){return vi.v()}Zi(e){const n=Vl(e);return n.get(qo).next(r=>this.es(r)?(se(qs,"Releasing primary lease."),n.delete(qo)):U.resolve())}rs(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(Rn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const n=/(?:Version|Mobile)\/1[456]/;VS()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var n;try{const r=((n=this.Ki)==null?void 0:n.getItem(this._s(e)))!==null;return se(qs,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Rn(qs,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Rn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Vl(t){return nn(t,uu)}function ed(t){return nn(t,Wa)}function BV(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=Ye(),s=Ye();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Tv(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zV{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nN{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return VS()?8:UT(tn())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.ys(e,n).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.ws(e,n,s,r).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new zV;return this.Ss(e,n,a).next(l=>{if(i.result=l,this.Vs)return this.bs(e,n,a,l.size)})}).next(()=>i.result)}bs(e,n,r,s){return r.documentReadCount<this.fs?(sa()<=et.DEBUG&&se("QueryEngine","SDK will not create cache indexes for query:",ia(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),U.resolve()):(sa()<=et.DEBUG&&se("QueryEngine","Query:",ia(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(sa()<=et.DEBUG&&se("QueryEngine","The SDK decides to create cache indexes for query:",ia(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,yr(n))):U.resolve())}ys(e,n){if(pw(n))return U.resolve(null);let r=yr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=Sh(n,null,"F"),r=yr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const a=Ye(...i);return this.ps.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(c=>{const d=this.Ds(n,l);return this.Cs(n,d,a,c.readTime)?this.ys(e,Sh(n,null,"F")):this.vs(e,d,n,c)}))})))}ws(e,n,r,s){return pw(n)||s.isEqual(je.min())?U.resolve(null):this.ps.getDocuments(e,r).next(i=>{const a=this.Ds(n,i);return this.Cs(n,a,r,s)?U.resolve(null):(sa()<=et.DEBUG&&se("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ia(n)),this.vs(e,a,n,BL(s,$c)).next(l=>l))})}Ds(e,n){let r=new ft(gC(e));return n.forEach((s,i)=>{fu(e,i)&&(r=r.add(i))}),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,n,r){return sa()<=et.DEBUG&&se("QueryEngine","Using full collection scan to execute query:",ia(n)),this.ps.getDocumentsMatchingQuery(e,n,or.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cv="LocalStore",qV=3e8;class HV{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new jt(ze),this.xs=new ks(i=>wo(i),du),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new tN(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function rN(t,e,n,r){return new HV(t,e,n,r)}async function sN(t,e){const n=Me(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const a=[],l=[];let c=Ye();for(const d of s){a.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}for(const d of i){l.push(d.batchId);for(const h of d.mutations)c=c.add(h.key)}return n.localDocuments.getDocuments(r,c).next(d=>({Ls:d,removedBatchIds:a,addedBatchIds:l}))})})}function WV(t,e){const n=Me(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(l,c,d,h){const f=d.batch,m=f.keys();let _=U.resolve();return m.forEach(C=>{_=_.next(()=>h.getEntry(c,C)).next(N=>{const A=d.docVersions.get(C);Te(A!==null,48541),N.version.compareTo(A)<0&&(f.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),h.addEntry(N)))})}),_.next(()=>l.mutationQueue.removeMutationBatch(c,f))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let c=Ye();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(c=c.add(l.batch.mutations[d].key));return c}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function iN(t){const e=Me(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function GV(t,e){const n=Me(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const l=[];e.targetChanges.forEach((h,f)=>{const m=s.get(f);if(!m)return;l.push(n.Pi.removeMatchingKeys(i,h.removedDocuments,f).next(()=>n.Pi.addMatchingKeys(i,h.addedDocuments,f)));let _=m.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(f)!==null?_=_.withResumeToken(Xt.EMPTY_BYTE_STRING,je.min()).withLastLimboFreeSnapshotVersion(je.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,r)),s=s.insert(f,_),function(N,A,T){return N.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=qV?!0:T.addedDocuments.size+T.modifiedDocuments.size+T.removedDocuments.size>0}(m,_,h)&&l.push(n.Pi.updateTargetData(i,_))});let c=nr(),d=Ye();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&l.push(n.persistence.referenceDelegate.updateLimboDocument(i,h))}),l.push(KV(i,a,e.documentUpdates).next(h=>{c=h.ks,d=h.qs})),!r.isEqual(je.min())){const h=n.Pi.getLastRemoteSnapshotVersion(i).next(f=>n.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));l.push(h)}return U.waitFor(l).next(()=>a.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,c,d)).next(()=>c)}).then(i=>(n.Ms=s,i))}function KV(t,e,n){let r=Ye(),s=Ye();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let a=nr();return n.forEach((l,c)=>{const d=i.get(l);c.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),c.isNoDocument()&&c.version.isEqual(je.min())?(e.removeEntry(l,c.readTime),a=a.insert(l,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(c),a=a.insert(l,c)):se(Cv,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",c.version)}),{ks:a,qs:s}})}function QV(t,e){const n=Me(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=io),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function YV(t,e){const n=Me(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Pi.getTargetData(r,e).next(i=>i?(s=i,U.resolve(s)):n.Pi.allocateTargetId(r).next(a=>(s=new _s(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r})}async function Rg(t,e,n){const r=Me(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,a=>r.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!ki(a))throw a;se(Cv,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Hw(t,e,n){const r=Me(t);let s=je.min(),i=Ye();return r.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,h){const f=Me(c),m=f.xs.get(h);return m!==void 0?U.resolve(f.Ms.get(m)):f.Pi.getTargetData(d,h)}(r,a,yr(e)).next(l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next(c=>{i=c})}).next(()=>r.Fs.getDocumentsMatchingQuery(a,e,n?s:je.min(),n?i:Ye())).next(l=>(XV(r,LO(e),l),{documents:l,Qs:i})))}function XV(t,e,n){let r=t.Os.get(e)||je.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.Os.set(e,r)}class Ww{constructor(){this.activeTargetIds=$O()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class oN{constructor(){this.Mo=new Ww,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Ww,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JV{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gw="ConnectivityMonitor";class Kw{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){se(Gw,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){se(Gw,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let td=null;function kg(){return td===null?td=function(){return 268435456+Math.round(2147483648*Math.random())}():td++,"0x"+td.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bp="RestConnection",ZV={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class eM{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===wh?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,i){const a=kg(),l=this.zo(e,n.toUriEncodedString());se(Bp,`Sending RPC '${e}' ${a}:`,l,r);const c={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(c,s,i);const{host:d}=new URL(l),h=Ai(d);return this.Jo(e,l,c,r,h).then(f=>(se(Bp,`Received RPC '${e}' ${a}: `,f),f),f=>{throw _o(Bp,`RPC '${e}' ${a} failed with error: `,f,"url: ",l,"request:",r),f})}Ho(e,n,r,s,i,a){return this.Go(e,n,r,s,i)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+cl}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,n){const r=ZV[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tM{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xn="WebChannelConnection";class nM extends eM{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,i){const a=kg();return new Promise((l,c)=>{const d=new CT;d.setWithCredentials(!0),d.listenOnce(NT.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Sd.NO_ERROR:const f=d.getResponseJson();se(xn,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(f)),l(f);break;case Sd.TIMEOUT:se(xn,`RPC '${e}' ${a} timed out`),c(new ae(G.DEADLINE_EXCEEDED,"Request time out"));break;case Sd.HTTP_ERROR:const m=d.getStatus();if(se(xn,`RPC '${e}' ${a} failed with status:`,m,"response text:",d.getResponseText()),m>0){let _=d.getResponseJson();Array.isArray(_)&&(_=_[0]);const C=_==null?void 0:_.error;if(C&&C.status&&C.message){const N=function(T){const I=T.toLowerCase().replace(/_/g,"-");return Object.values(G).indexOf(I)>=0?I:G.UNKNOWN}(C.status);c(new ae(N,C.message))}else c(new ae(G.UNKNOWN,"Server responded with status "+d.getStatus()))}else c(new ae(G.UNAVAILABLE,"Connection failed."));break;default:Ee(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{se(xn,`RPC '${e}' ${a} completed.`)}});const h=JSON.stringify(s);se(xn,`RPC '${e}' ${a} sending request:`,s),d.send(n,"POST",h,r,15)})}T_(e,n,r){const s=kg(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=PT(),l=AT(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.jo(c.initMessageHeaders,n,r),c.encodeInitMessageHeaders=!0;const h=i.join("");se(xn,`Creating RPC '${e}' stream ${s}: ${h}`,c);const f=a.createWebChannel(h,c);this.I_(f);let m=!1,_=!1;const C=new tM({Yo:A=>{_?se(xn,`Not sending because RPC '${e}' stream ${s} is closed:`,A):(m||(se(xn,`Opening RPC '${e}' stream ${s} transport.`),f.open(),m=!0),se(xn,`RPC '${e}' stream ${s} sending:`,A),f.send(A))},Zo:()=>f.close()}),N=(A,T,I)=>{A.listen(T,E=>{try{I(E)}catch(w){setTimeout(()=>{throw w},0)}})};return N(f,Kl.EventType.OPEN,()=>{_||(se(xn,`RPC '${e}' stream ${s} transport opened.`),C.o_())}),N(f,Kl.EventType.CLOSE,()=>{_||(_=!0,se(xn,`RPC '${e}' stream ${s} transport closed`),C.a_(),this.E_(f))}),N(f,Kl.EventType.ERROR,A=>{_||(_=!0,_o(xn,`RPC '${e}' stream ${s} transport errored. Name:`,A.name,"Message:",A.message),C.a_(new ae(G.UNAVAILABLE,"The operation could not be completed")))}),N(f,Kl.EventType.MESSAGE,A=>{var T;if(!_){const I=A.data[0];Te(!!I,16349);const E=I,w=(E==null?void 0:E.error)||((T=E[0])==null?void 0:T.error);if(w){se(xn,`RPC '${e}' stream ${s} received error:`,w);const S=w.status;let M=function(b){const k=Kt[b];if(k!==void 0)return jC(k)}(S),g=w.message;M===void 0&&(M=G.INTERNAL,g="Unknown error status: "+S+" with message "+w.message),_=!0,C.a_(new ae(M,g)),f.close()}else se(xn,`RPC '${e}' stream ${s} received:`,I),C.u_(I)}}),N(l,jT.STAT_EVENT,A=>{A.stat===hg.PROXY?se(xn,`RPC '${e}' stream ${s} detected buffering proxy`):A.stat===hg.NOPROXY&&se(xn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.__()},0),C}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rM(){return typeof window<"u"?window:null}function Ld(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Af(t){return new rV(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aN{constructor(e,n,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&se("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qw="PersistentStream";class lN{constructor(e,n,r,s,i,a,l,c){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=c,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new aN(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===G.RESOURCE_EXHAUSTED?(Rn(n.toString()),Rn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===G.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===n&&this.G_(r,s)},r=>{e(()=>{const s=new ae(G.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return se(Qw,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(se(Qw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sM extends lN{constructor(e,n,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=oV(this.serializer,e),r=function(i){if(!("targetChange"in i))return je.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?je.min():a.readTime?Ln(a.readTime):je.min()}(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=Cg(this.serializer),n.addTarget=function(i,a){let l;const c=a.target;if(l=Eh(c)?{documents:VC(i,c)}:{query:xv(i,c).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=RC(i,a.resumeToken);const d=Sg(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(je.min())>0){l.readTime=Za(i,a.snapshotVersion.toTimestamp());const d=Sg(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l}(this.serializer,e);const r=cV(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=Cg(this.serializer),n.removeTarget=e,this.q_(n)}}class iM extends lN{constructor(e,n,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Te(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Te(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Te(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=aV(e.writeResults,e.commitTime),r=Ln(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=Cg(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>Ch(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{}class aM extends oM{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new ae(G.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Go(e,Tg(n,r),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ae(G.UNKNOWN,i.toString())})}Ho(e,n,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,l])=>this.connection.Ho(e,Tg(n,r),s,a,l,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===G.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new ae(G.UNKNOWN,a.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class lM{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Rn(n),this.aa=!1):se("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Co="RemoteStore";class cM{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(a=>{r.enqueueAndForget(async()=>{Fo(this)&&(se(Co,"Restarting streams for network reachability change."),await async function(c){const d=Me(c);d.Ea.add(4),await mu(d),d.Ra.set("Unknown"),d.Ea.delete(4),await Pf(d)}(this))})}),this.Ra=new lM(r,s)}}async function Pf(t){if(Fo(t))for(const e of t.da)await e(!0)}async function mu(t){for(const e of t.da)await e(!1)}function cN(t,e){const n=Me(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Pv(n)?Av(n):dl(n).O_()&&jv(n,e))}function Nv(t,e){const n=Me(t),r=dl(n);n.Ia.delete(e),r.O_()&&uN(n,e),n.Ia.size===0&&(r.O_()?r.L_():Fo(n)&&n.Ra.set("Unknown"))}function jv(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(je.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}dl(t).Y_(e)}function uN(t,e){t.Va.Ue(e),dl(t).Z_(e)}function Av(t){t.Va=new ZO({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),dl(t).start(),t.Ra.ua()}function Pv(t){return Fo(t)&&!dl(t).x_()&&t.Ia.size>0}function Fo(t){return Me(t).Ea.size===0}function dN(t){t.Va=void 0}async function uM(t){t.Ra.set("Online")}async function dM(t){t.Ia.forEach((e,n)=>{jv(t,e)})}async function hM(t,e){dN(t),Pv(t)?(t.Ra.ha(e),Av(t)):t.Ra.set("Unknown")}async function fM(t,e,n){if(t.Ra.set("Online"),e instanceof PC&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))}(t,e)}catch(r){se(Co,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Rh(t,r)}else if(e instanceof kd?t.Va.Ze(e):e instanceof AC?t.Va.st(e):t.Va.tt(e),!n.isEqual(je.min()))try{const r=await iN(t.localStore);n.compareTo(r)>=0&&await function(i,a){const l=i.Va.Tt(a);return l.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){const h=i.Ia.get(d);h&&i.Ia.set(d,h.withResumeToken(c.resumeToken,a))}}),l.targetMismatches.forEach((c,d)=>{const h=i.Ia.get(c);if(!h)return;i.Ia.set(c,h.withResumeToken(Xt.EMPTY_BYTE_STRING,h.snapshotVersion)),uN(i,c);const f=new _s(h.target,c,d,h.sequenceNumber);jv(i,f)}),i.remoteSyncer.applyRemoteEvent(l)}(t,n)}catch(r){se(Co,"Failed to raise snapshot:",r),await Rh(t,r)}}async function Rh(t,e,n){if(!ki(e))throw e;t.Ea.add(1),await mu(t),t.Ra.set("Offline"),n||(n=()=>iN(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{se(Co,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await Pf(t)})}function hN(t,e){return e().catch(n=>Rh(t,n,e))}async function gu(t){const e=Me(t),n=Si(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:io;for(;pM(e);)try{const s=await QV(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,mM(e,s)}catch(s){await Rh(e,s)}fN(e)&&pN(e)}function pM(t){return Fo(t)&&t.Ta.length<10}function mM(t,e){t.Ta.push(e);const n=Si(t);n.O_()&&n.X_&&n.ea(e.mutations)}function fN(t){return Fo(t)&&!Si(t).x_()&&t.Ta.length>0}function pN(t){Si(t).start()}async function gM(t){Si(t).ra()}async function yM(t){const e=Si(t);for(const n of t.Ta)e.ea(n.mutations)}async function vM(t,e,n){const r=t.Ta.shift(),s=gv.from(r,e,n);await hN(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await gu(t)}async function _M(t,e){e&&Si(t).X_&&await async function(r,s){if(function(a){return YO(a)&&a!==G.ABORTED}(s.code)){const i=r.Ta.shift();Si(r).B_(),await hN(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await gu(r)}}(t,e),fN(t)&&pN(t)}async function Yw(t,e){const n=Me(t);n.asyncQueue.verifyOperationInProgress(),se(Co,"RemoteStore received new credentials");const r=Fo(n);n.Ea.add(3),await mu(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await Pf(n)}async function xM(t,e){const n=Me(t);e?(n.Ea.delete(2),await Pf(n)):e||(n.Ea.add(2),await mu(n),n.Ra.set("Unknown"))}function dl(t){return t.ma||(t.ma=function(n,r,s){const i=Me(n);return i.sa(),new sM(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:uM.bind(null,t),t_:dM.bind(null,t),r_:hM.bind(null,t),H_:fM.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),Pv(t)?Av(t):t.Ra.set("Unknown")):(await t.ma.stop(),dN(t))})),t.ma}function Si(t){return t.fa||(t.fa=function(n,r,s){const i=Me(n);return i.sa(),new iM(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:gM.bind(null,t),r_:_M.bind(null,t),ta:yM.bind(null,t),na:vM.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await gu(t)):(await t.fa.stop(),t.Ta.length>0&&(se(Co,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rv{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Lr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const a=Date.now()+r,l=new Rv(e,n,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ae(G.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function kv(t,e){if(Rn("AsyncQueue",`${e}: ${t}`),ki(t))return new ae(G.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{static emptySet(e){return new Pa(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||pe.comparator(n.key,r.key):(n,r)=>pe.comparator(n.key,r.key),this.keyedMap=Ql(),this.sortedSet=new jt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Pa)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Pa;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{constructor(){this.ga=new jt(pe.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Ee(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class el{constructor(e,n,r,s,i,a,l,c,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,i){const a=[];return n.forEach(l=>{a.push({type:0,doc:l})}),new el(e,n,Pa.emptySet(n),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&bf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bM{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class wM{constructor(){this.queries=Jw(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=Me(n),i=s.queries;s.queries=Jw(),i.forEach((a,l)=>{for(const c of l.Sa)c.onError(r)})})(this,new ae(G.ABORTED,"Firestore shutting down"))}}function Jw(){return new ks(t=>mC(t),bf)}async function Dv(t,e){const n=Me(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new bM,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(a){const l=kv(a,`Initialization of query '${ia(e.query)}' failed`);return void e.onError(l)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&Ov(n)}async function Lv(t,e){const n=Me(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function EM(t,e){const n=Me(t);let r=!1;for(const s of e){const i=s.query,a=n.queries.get(i);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&Ov(n)}function IM(t,e,n){const r=Me(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function Ov(t){t.Ca.forEach(e=>{e.next()})}var Dg,Zw;(Zw=Dg||(Dg={})).Ma="default",Zw.Cache="cache";class Vv{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new el(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=el.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Dg.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mN{constructor(e){this.key=e}}class gN{constructor(e){this.key=e}}class SM{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ye(),this.mutatedKeys=Ye(),this.eu=gC(e),this.tu=new Pa(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new Xw,s=n?n.tu:this.tu;let i=n?n.mutatedKeys:this.mutatedKeys,a=s,l=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((h,f)=>{const m=s.get(h),_=fu(this.query,f)?f:null,C=!!m&&this.mutatedKeys.has(m.key),N=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let A=!1;m&&_?m.data.isEqual(_.data)?C!==N&&(r.track({type:3,doc:_}),A=!0):this.su(m,_)||(r.track({type:2,doc:_}),A=!0,(c&&this.eu(_,c)>0||d&&this.eu(_,d)<0)&&(l=!0)):!m&&_?(r.track({type:0,doc:_}),A=!0):m&&!_&&(r.track({type:1,doc:m}),A=!0,(c||d)&&(l=!0)),A&&(_?(a=a.add(_),i=N?i.add(h):i.delete(h)):(a=a.delete(h),i=i.delete(h)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const h=this.query.limitType==="F"?a.last():a.first();a=a.delete(h.key),i=i.delete(h.key),r.track({type:1,doc:h})}return{tu:a,iu:r,Cs:l,mutatedKeys:i}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort((h,f)=>function(_,C){const N=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ee(20277,{Rt:A})}};return N(_)-N(C)}(h.type,f.type)||this.eu(h.doc,f.doc)),this.ou(r),s=s??!1;const l=n&&!s?this._u():[],c=this.Xa.size===0&&this.current&&!s?1:0,d=c!==this.Za;return this.Za=c,a.length!==0||d?{snapshot:new el(this.query,e.tu,i,a,e.mutatedKeys,c===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Xw,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ye(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const n=[];return e.forEach(r=>{this.Xa.has(r)||n.push(new gN(r))}),this.Xa.forEach(r=>{e.has(r)||n.push(new mN(r))}),n}cu(e){this.Ya=e.Qs,this.Xa=Ye();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return el.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Mv="SyncEngine";class TM{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class CM{constructor(e){this.key=e,this.hu=!1}}class NM{constructor(e,n,r,s,i,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new ks(l=>mC(l),bf),this.Iu=new Map,this.Eu=new Set,this.du=new jt(pe.comparator),this.Au=new Map,this.Ru=new Ev,this.Vu={},this.mu=new Map,this.fu=To.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function jM(t,e,n=!0){const r=wN(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await yN(r,e,n,!0),s}async function AM(t,e){const n=wN(t);await yN(n,e,!0,!1)}async function yN(t,e,n,r){const s=await YV(t.localStore,yr(e)),i=s.targetId,a=t.sharedClientState.addLocalQueryTarget(i,n);let l;return r&&(l=await PM(t,e,i,a==="current",s.resumeToken)),t.isPrimaryClient&&n&&cN(t.remoteStore,s),l}async function PM(t,e,n,r,s){t.pu=(f,m,_)=>async function(N,A,T,I){let E=A.view.ru(T);E.Cs&&(E=await Hw(N.localStore,A.query,!1).then(({documents:g})=>A.view.ru(g,E)));const w=I&&I.targetChanges.get(A.targetId),S=I&&I.targetMismatches.get(A.targetId)!=null,M=A.view.applyChanges(E,N.isPrimaryClient,w,S);return t0(N,A.targetId,M.au),M.snapshot}(t,f,m,_);const i=await Hw(t.localStore,e,!0),a=new SM(e,i.Qs),l=a.ru(i.documents),c=pu.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=a.applyChanges(l,t.isPrimaryClient,c);t0(t,n,d.au);const h=new TM(e,n,a);return t.Tu.set(e,h),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),d.snapshot}async function RM(t,e,n){const r=Me(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(a=>!bf(a,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Rg(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Nv(r.remoteStore,s.targetId),Lg(r,s.targetId)}).catch(Mo)):(Lg(r,s.targetId),await Rg(r.localStore,s.targetId,!0))}async function kM(t,e){const n=Me(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Nv(n.remoteStore,r.targetId))}async function DM(t,e,n){const r=EN(t);try{const s=await function(a,l){const c=Me(a),d=it.now(),h=l.reduce((_,C)=>_.add(C.key),Ye());let f,m;return c.persistence.runTransaction("Locally write mutations","readwrite",_=>{let C=nr(),N=Ye();return c.Ns.getEntries(_,h).next(A=>{C=A,C.forEach((T,I)=>{I.isValidDocument()||(N=N.add(T))})}).next(()=>c.localDocuments.getOverlayedDocuments(_,C)).next(A=>{f=A;const T=[];for(const I of l){const E=GO(I,f.get(I.key).overlayedDocument);E!=null&&T.push(new Ds(I.key,E,oC(E.value.mapValue),In.exists(!0)))}return c.mutationQueue.addMutationBatch(_,d,T,l)}).next(A=>{m=A;const T=A.applyToLocalDocumentSet(f,N);return c.documentOverlayCache.saveOverlays(_,A.batchId,T)})}).then(()=>({batchId:m.batchId,changes:vC(f)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(a,l,c){let d=a.Vu[a.currentUser.toKey()];d||(d=new jt(ze)),d=d.insert(l,c),a.Vu[a.currentUser.toKey()]=d}(r,s.batchId,n),await yu(r,s.changes),await gu(r.remoteStore)}catch(s){const i=kv(s,"Failed to persist write");n.reject(i)}}async function vN(t,e){const n=Me(t);try{const r=await GV(n.localStore,e);e.targetChanges.forEach((s,i)=>{const a=n.Au.get(i);a&&(Te(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Te(a.hu,14607):s.removedDocuments.size>0&&(Te(a.hu,42227),a.hu=!1))}),await yu(n,r,e)}catch(r){await Mo(r)}}function e0(t,e,n){const r=Me(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach((i,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)}),function(a,l){const c=Me(a);c.onlineState=l;let d=!1;c.queries.forEach((h,f)=>{for(const m of f.Sa)m.va(l)&&(d=!0)}),d&&Ov(c)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function LM(t,e,n){const r=Me(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new jt(pe.comparator);a=a.insert(i,Ft.newNoDocument(i,je.min()));const l=Ye().add(i),c=new Tf(je.min(),new Map,new jt(ze),a,l);await vN(r,c),r.du=r.du.remove(i),r.Au.delete(e),Fv(r)}else await Rg(r.localStore,e,!1).then(()=>Lg(r,e,n)).catch(Mo)}async function OM(t,e){const n=Me(t),r=e.batch.batchId;try{const s=await WV(n.localStore,e);xN(n,r,null),_N(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await yu(n,s)}catch(s){await Mo(s)}}async function VM(t,e,n){const r=Me(t);try{const s=await function(a,l){const c=Me(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let h;return c.mutationQueue.lookupMutationBatch(d,l).next(f=>(Te(f!==null,37113),h=f.keys(),c.mutationQueue.removeMutationBatch(d,f))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,h,l)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,h)).next(()=>c.localDocuments.getDocuments(d,h))})}(r.localStore,e);xN(r,e,n),_N(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await yu(r,s)}catch(s){await Mo(s)}}function _N(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function xN(t,e,n){const r=Me(t);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function Lg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(r=>{t.Ru.containsKey(r)||bN(t,r)})}function bN(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(Nv(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Fv(t))}function t0(t,e,n){for(const r of n)r instanceof mN?(t.Ru.addReference(r.key,e),MM(t,r)):r instanceof gN?(se(Mv,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||bN(t,r.key)):Ee(19791,{wu:r})}function MM(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(se(Mv,"New document in limbo: "+n),t.Eu.add(r),Fv(t))}function Fv(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new pe(at.fromString(e)),r=t.fu.next();t.Au.set(r,new CM(n)),t.du=t.du.insert(n,r),cN(t.remoteStore,new _s(yr(hu(n.path)),r,"TargetPurposeLimboResolution",mr.ce))}}async function yu(t,e,n){const r=Me(t),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((l,c)=>{a.push(r.pu(c,e,n).then(d=>{var h;if((d||n)&&r.isPrimaryClient){const f=d?!d.fromCache:(h=n==null?void 0:n.targetChanges.get(c.targetId))==null?void 0:h.current;r.sharedClientState.updateQueryState(c.targetId,f?"current":"not-current")}if(d){s.push(d);const f=Tv.As(c.targetId,d);i.push(f)}}))}),await Promise.all(a),r.Pu.H_(s),await async function(c,d){const h=Me(c);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>U.forEach(d,m=>U.forEach(m.Es,_=>h.persistence.referenceDelegate.addReference(f,m.targetId,_)).next(()=>U.forEach(m.ds,_=>h.persistence.referenceDelegate.removeReference(f,m.targetId,_)))))}catch(f){if(!ki(f))throw f;se(Cv,"Failed to update sequence numbers: "+f)}for(const f of d){const m=f.targetId;if(!f.fromCache){const _=h.Ms.get(m),C=_.snapshotVersion,N=_.withLastLimboFreeSnapshotVersion(C);h.Ms=h.Ms.insert(m,N)}}}(r.localStore,i))}async function FM(t,e){const n=Me(t);if(!n.currentUser.isEqual(e)){se(Mv,"User change. New user:",e.toKey());const r=await sN(n.localStore,e);n.currentUser=e,function(i,a){i.mu.forEach(l=>{l.forEach(c=>{c.reject(new ae(G.CANCELLED,a))})}),i.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await yu(n,r.Ls)}}function UM(t,e){const n=Me(t),r=n.Au.get(e);if(r&&r.hu)return Ye().add(r.key);{let s=Ye();const i=n.Iu.get(e);if(!i)return s;for(const a of i){const l=n.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function wN(t){const e=Me(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=vN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=UM.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=LM.bind(null,e),e.Pu.H_=EM.bind(null,e.eventManager),e.Pu.yu=IM.bind(null,e.eventManager),e}function EN(t){const e=Me(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=OM.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=VM.bind(null,e),e}class Xc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Af(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return rN(this.persistence,new nN,e.initialUser,this.serializer)}Cu(e){return new Iv(jf.mi,this.serializer)}Du(e){return new oN}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Xc.provider={build:()=>new Xc};class $M extends Xc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Te(this.persistence.referenceDelegate instanceof Ph,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new XC(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?bn.withCacheSize(this.cacheSizeBytes):bn.DEFAULT;return new Iv(r=>Ph.mi(r,n),this.serializer)}}class BM extends Xc{constructor(e,n,r){super(),this.xu=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await EN(this.xu.syncEngine),await gu(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return rN(this.persistence,new nN,e.initialUser,this.serializer)}Fu(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new XC(r,e.asyncQueue,n)}Mu(e,n){const r=new WL(n,this.persistence);return new HL(e.asyncQueue,r)}Cu(e){const n=BV(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?bn.withCacheSize(this.cacheSizeBytes):bn.DEFAULT;return new Sv(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,rM(),Ld(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new oN}}class kh{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>e0(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=FM.bind(null,this.syncEngine),await xM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new wM}()}createDatastore(e){const n=Af(e.databaseInfo.databaseId),r=function(i){return new nM(i)}(e.databaseInfo);return function(i,a,l,c){return new aM(i,a,l,c)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,a,l){return new cM(r,s,i,a,l)}(this.localStore,this.datastore,e.asyncQueue,n=>e0(this.syncEngine,n,0),function(){return Kw.v()?new Kw:new JV}())}createSyncEngine(e,n){return function(s,i,a,l,c,d,h){const f=new NM(s,i,a,l,c,d);return h&&(f.gu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=Me(s);se(Co,"RemoteStore shutting down."),i.Ea.add(5),await mu(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}kh.provider={build:()=>new kh};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uv{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Rn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ti="FirestoreClient";class zM{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=hn.UNAUTHENTICATED,this.clientId=rv.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async a=>{se(Ti,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(se(Ti,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Lr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=kv(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function zp(t,e){t.asyncQueue.verifyOperationInProgress(),se(Ti,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await sN(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function n0(t,e){t.asyncQueue.verifyOperationInProgress();const n=await qM(t);se(Ti,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Yw(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Yw(e.remoteStore,s)),t._onlineComponents=e}async function qM(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){se(Ti,"Using user provided OfflineComponentProvider");try{await zp(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===G.FAILED_PRECONDITION||s.code===G.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;_o("Error using user provided cache. Falling back to memory cache: "+n),await zp(t,new Xc)}}else se(Ti,"Using default OfflineComponentProvider"),await zp(t,new $M(void 0));return t._offlineComponents}async function $v(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(se(Ti,"Using user provided OnlineComponentProvider"),await n0(t,t._uninitializedComponentsProvider._online)):(se(Ti,"Using default OnlineComponentProvider"),await n0(t,new kh))),t._onlineComponents}function HM(t){return $v(t).then(e=>e.syncEngine)}function WM(t){return $v(t).then(e=>e.datastore)}async function Dh(t){const e=await $v(t),n=e.eventManager;return n.onListen=jM.bind(null,e.syncEngine),n.onUnlisten=RM.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=AM.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=kM.bind(null,e.syncEngine),n}function GM(t,e,n={}){const r=new Lr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const h=new Uv({next:m=>{h.Nu(),a.enqueueAndForget(()=>Lv(i,f));const _=m.docs.has(l);!_&&m.fromCache?d.reject(new ae(G.UNAVAILABLE,"Failed to get document because the client is offline.")):_&&m.fromCache&&c&&c.source==="server"?d.reject(new ae(G.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(m)},error:m=>d.reject(m)}),f=new Vv(hu(l.path),h,{includeMetadataChanges:!0,qa:!0});return Dv(i,f)}(await Dh(t),t.asyncQueue,e,n,r)),r.promise}function KM(t,e,n={}){const r=new Lr;return t.asyncQueue.enqueueAndForget(async()=>function(i,a,l,c,d){const h=new Uv({next:m=>{h.Nu(),a.enqueueAndForget(()=>Lv(i,f)),m.fromCache&&c.source==="server"?d.reject(new ae(G.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(m)},error:m=>d.reject(m)}),f=new Vv(l,h,{includeMetadataChanges:!0,qa:!0});return Dv(i,f)}(await Dh(t),t.asyncQueue,e,n,r)),r.promise}function QM(t,e,n){const r=new Lr;return t.asyncQueue.enqueueAndForget(async()=>{try{const s=await WM(t);r.resolve(async function(a,l,c){var N;const d=Me(a),{request:h,gt:f,parent:m}=lV(d.serializer,DO(l),c);d.connection.$o||delete h.parent;const _=(await d.Ho("RunAggregationQuery",d.serializer.databaseId,m,h,1)).filter(A=>!!A.result);Te(_.length===1,64727);const C=(N=_[0].result)==null?void 0:N.aggregateFields;return Object.keys(C).reduce((A,T)=>(A[f[T]]=C[T],A),{})}(s,e,n))}catch(s){r.reject(s)}}),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r0=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SN="firestore.googleapis.com",s0=!0;class i0{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ae(G.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=SN,this.ssl=s0}else this.host=e.host,this.ssl=e.ssl??s0;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=GC;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<SV)throw new ae(G.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}UL("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=IN(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new ae(G.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new ae(G.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new ae(G.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Rf{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new i0({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ae(G.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ae(G.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new i0(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new AL;switch(r.type){case"firstParty":return new DL(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ae(G.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=r0.get(n);r&&(se("ComponentProvider","Removing Datastore"),r0.delete(n),r.terminate())}(this),Promise.resolve()}}function YM(t,e,n,r={}){var d;t=Sn(t,Rf);const s=Ai(e),i=t._getSettings(),a={...i,emulatorOptions:t._getEmulatorOptions()},l=`${e}:${n}`;s&&(By(`https://${l}`),zy("Firestore",!0)),i.host!==SN&&i.host!==l&&_o("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:l,ssl:s,emulatorOptions:r};if(!Cs(c,a)&&(t._setSettings(c),r.mockUserToken)){let h,f;if(typeof r.mockUserToken=="string")h=r.mockUserToken,f=hn.MOCK_USER;else{h=DS(r.mockUserToken,(d=t._app)==null?void 0:d.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new ae(G.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new hn(m)}t._authCredentials=new PL(new kT(h,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Br(this.firestore,e,this._query)}}class $t{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _i(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $t(this.firestore,e,this._key)}toJSON(){return{type:$t._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(cu(n,$t._jsonSchema))return new $t(e,r||null,new pe(at.fromString(n.referencePath)))}}$t._jsonSchemaVersion="firestore/documentReference/1.0",$t._jsonSchema={type:Yt("string",$t._jsonSchemaVersion),referencePath:Yt("string")};class _i extends Br{constructor(e,n,r){super(e,n,hu(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $t(this.firestore,null,new pe(e))}withConverter(e){return new _i(this.firestore,e,this._path)}}function ce(t,e,...n){if(t=ut(t),LT("collection","path",e),t instanceof Rf){const r=at.fromString(e,...n);return Qb(r),new _i(t,null,r)}{if(!(t instanceof $t||t instanceof _i))throw new ae(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(at.fromString(e,...n));return Qb(r),new _i(t.firestore,null,r)}}function Re(t,e,...n){if(t=ut(t),arguments.length===1&&(e=rv.newId()),LT("doc","path",e),t instanceof Rf){const r=at.fromString(e,...n);return Kb(r),new $t(t,null,new pe(r))}{if(!(t instanceof $t||t instanceof _i))throw new ae(G.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(at.fromString(e,...n));return Kb(r),new $t(t.firestore,t instanceof _i?t.converter:null,new pe(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o0="AsyncQueue";class a0{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new aN(this,"async_queue_retry"),this._c=()=>{const r=Ld();r&&se(o0,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Ld();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Ld();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new Lr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ki(e))throw e;se(o0,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Rn("INTERNAL UNHANDLED ERROR: ",l0(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=Rv.createAndSchedule(this,e,n,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&Ee(47125,{Pc:l0(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function l0(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c0(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(t,["next","error","complete"])}class Fr extends Rf{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new a0,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new a0(e),this._firestoreClient=void 0,await e}}}function TN(t,e){const n=typeof t=="object"?t:af(),r=typeof t=="string"?t:wh,s=Pi(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=PS("firestore");i&&YM(s,...i)}return s}function vu(t){if(t._terminated)throw new ae(G.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||CN(t),t._firestoreClient}function CN(t){var r,s,i;const e=t._freezeSettings(),n=function(l,c,d,h){return new wO(l,c,d,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,IN(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new zM(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}function XM(t,e){_o("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return JM(t,kh.provider,{build:r=>new BM(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function JM(t,e,n){if((t=Sn(t,Fr))._firestoreClient||t._terminated)throw new ae(G.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new ae(G.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},CN(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZM{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class eF{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fr(Xt.fromBase64String(e))}catch(n){throw new ae(G.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new fr(Xt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:fr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(cu(e,fr._jsonSchema))return fr.fromBase64String(e.bytes)}}fr._jsonSchemaVersion="firestore/bytes/1.0",fr._jsonSchema={type:Yt("string",fr._jsonSchemaVersion),bytes:Yt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ae(G.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new kt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hl{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ss{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ae(G.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ae(G.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ze(this._lat,e._lat)||ze(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ss._jsonSchemaVersion}}static fromJSON(e){if(cu(e,ss._jsonSchema))return new ss(e.latitude,e.longitude)}}ss._jsonSchemaVersion="firestore/geoPoint/1.0",ss._jsonSchema={type:Yt("string",ss._jsonSchemaVersion),latitude:Yt("number"),longitude:Yt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class is{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:is._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(cu(e,is._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new is(e.vectorValues);throw new ae(G.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}is._jsonSchemaVersion="firestore/vectorValue/1.0",is._jsonSchema={type:Yt("string",is._jsonSchemaVersion),vectorValues:Yt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tF=/^__.*__$/;class nF{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Ds(e,this.data,this.fieldMask,n,this.fieldTransforms):new ul(e,this.data,n,this.fieldTransforms)}}class NN{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Ds(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function jN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ee(40011,{Ac:t})}}class Df{constructor(e,n,r,s,i,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Df({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Lh(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(jN(this.Ac)&&tF.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class rF{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Af(e)}Cc(e,n,r,s=!1){return new Df({Ac:e,methodName:n,Dc:r,path:kt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function _u(t){const e=t._freezeSettings(),n=Af(t._databaseId);return new rF(t._databaseId,!!e.ignoreUndefinedProperties,n)}function AN(t,e,n,r,s,i={}){const a=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);Hv("Data must be an object, but it was:",a,r);const l=RN(r,a);let c,d;if(i.merge)c=new qn(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const h=[];for(const f of i.mergeFields){const m=Og(e,f,n);if(!a.contains(m))throw new ae(G.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);DN(h,m)||h.push(m)}c=new qn(h),d=a.fieldTransforms.filter(f=>c.covers(f.field))}else c=null,d=a.fieldTransforms;return new nF(new En(l),c,d)}class Lf extends hl{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Lf}}function sF(t,e,n){return new Df({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Bv extends hl{_toFieldTransform(e){return new Ef(e.path,new Ya)}isEqual(e){return e instanceof Bv}}class zv extends hl{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=sF(this,e,!0),r=this.vc.map(i=>fl(i,n)),s=new Eo(r);return new Ef(e.path,s)}isEqual(e){return e instanceof zv&&Cs(this.vc,e.vc)}}class qv extends hl{constructor(e,n){super(e),this.Fc=n}_toFieldTransform(e){const n=new Ja(e.serializer,bC(e.serializer,this.Fc));return new Ef(e.path,n)}isEqual(e){return e instanceof qv&&this.Fc===e.Fc}}function iF(t,e,n,r){const s=t.Cc(1,e,n);Hv("Data must be an object, but it was:",s,r);const i=[],a=En.empty();Di(r,(c,d)=>{const h=Wv(e,c,n);d=ut(d);const f=s.yc(h);if(d instanceof Lf)i.push(h);else{const m=fl(d,f);m!=null&&(i.push(h),a.set(h,m))}});const l=new qn(i);return new NN(a,l,s.fieldTransforms)}function oF(t,e,n,r,s,i){const a=t.Cc(1,e,n),l=[Og(e,r,n)],c=[s];if(i.length%2!=0)throw new ae(G.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)l.push(Og(e,i[m])),c.push(i[m+1]);const d=[],h=En.empty();for(let m=l.length-1;m>=0;--m)if(!DN(d,l[m])){const _=l[m];let C=c[m];C=ut(C);const N=a.yc(_);if(C instanceof Lf)d.push(_);else{const A=fl(C,N);A!=null&&(d.push(_),h.set(_,A))}}const f=new qn(d);return new NN(h,f,a.fieldTransforms)}function PN(t,e,n,r=!1){return fl(n,t.Cc(r?4:3,e))}function fl(t,e){if(kN(t=ut(t)))return Hv("Unsupported field value:",e,t),RN(t,e);if(t instanceof hl)return function(r,s){if(!jN(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let a=0;for(const l of r){let c=fl(l,s.wc(a));c==null&&(c={nullValue:"NULL_VALUE"}),i.push(c),a++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=ut(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return bC(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=it.fromDate(r);return{timestampValue:Za(s.serializer,i)}}if(r instanceof it){const i=new it(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Za(s.serializer,i)}}if(r instanceof ss)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof fr)return{bytesValue:RC(s.serializer,r._byteString)};if(r instanceof $t){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:_v(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof is)return function(a,l){return{mapValue:{fields:{[uv]:{stringValue:dv},[Ga]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return pv(l.serializer,d)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${hf(r)}`)}(t,e)}function RN(t,e){const n={};return XT(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Di(t,(r,s)=>{const i=fl(s,e.mc(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function kN(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof it||t instanceof ss||t instanceof fr||t instanceof $t||t instanceof hl||t instanceof is)}function Hv(t,e,n){if(!kN(n)||!OT(n)){const r=hf(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function Og(t,e,n){if((e=ut(e))instanceof kf)return e._internalPath;if(typeof e=="string")return Wv(t,e);throw Lh("Field path arguments must be of type string or ",t,!1,void 0,n)}const aF=new RegExp("[~\\*/\\[\\]]");function Wv(t,e,n){if(e.search(aF)>=0)throw Lh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new kf(...e.split("."))._internalPath}catch{throw Lh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Lh(t,e,n,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;n&&(l+=" (via `toFirestore()`)"),l+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${r}`),a&&(c+=` in document ${s}`),c+=")"),new ae(G.INVALID_ARGUMENT,l+t+c)}function DN(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gv{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $t(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new lF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Of("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class lF extends Gv{data(){return super.data()}}function Of(t,e){return typeof e=="string"?Wv(t,e):e instanceof kf?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LN(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ae(G.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Kv{}class xu extends Kv{}function Ve(t,e,...n){let r=[];e instanceof Kv&&r.push(e),r=r.concat(n),function(i){const a=i.filter(c=>c instanceof Qv).length,l=i.filter(c=>c instanceof Vf).length;if(a>1||a>0&&l>0)throw new ae(G.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class Vf extends xu{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Vf(e,n,r)}_apply(e){const n=this._parse(e);return VN(e._query,n),new Br(e.firestore,e.converter,Ig(e._query,n))}_parse(e){const n=_u(e.firestore);return function(i,a,l,c,d,h,f){let m;if(d.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new ae(G.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){f0(f,h);const C=[];for(const N of f)C.push(h0(c,i,N));m={arrayValue:{values:C}}}else m=h0(c,i,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||f0(f,h),m=PN(l,a,f,h==="in"||h==="not-in");return tt.create(d,h,m)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Ze(t,e,n){const r=e,s=Of("where",t);return Vf._create(s,r,n)}class Qv extends Kv{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Qv(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:dt.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let a=s;const l=i.getFlattenedFilters();for(const c of l)VN(a,c),a=Ig(a,c)}(e._query,n),new Br(e.firestore,e.converter,Ig(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Yv extends xu{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Yv(e,n)}_apply(e){const n=function(s,i,a){if(s.startAt!==null)throw new ae(G.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ae(G.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Yc(i,a)}(e._query,this._field,this._direction);return new Br(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new Li(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function pt(t,e="asc"){const n=e,r=Of("orderBy",t);return Yv._create(r,n)}class Xv extends xu{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new Xv(e,n,r)}_apply(e){return new Br(e.firestore,e.converter,Sh(e._query,this._limit,this._limitType))}}function Ra(t){return $L("limit",t),Xv._create("limit",t,"F")}class Mf extends xu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Mf(e,n,r)}_apply(e){const n=ON(e,this.type,this._docOrFields,this._inclusive);return new Br(e.firestore,e.converter,function(s,i){return new Li(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,i,s.endAt)}(e._query,n))}}function u0(...t){return Mf._create("startAt",t,!0)}function cF(...t){return Mf._create("startAfter",t,!1)}class Jv extends xu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Jv(e,n,r)}_apply(e){const n=ON(e,this.type,this._docOrFields,this._inclusive);return new Br(e.firestore,e.converter,function(s,i){return new Li(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,i)}(e._query,n))}}function d0(...t){return Jv._create("endAt",t,!0)}function ON(t,e,n,r){if(n[0]=ut(n[0]),n[0]instanceof Gv)return function(i,a,l,c,d){if(!c)throw new ae(G.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const h=[];for(const f of Aa(i))if(f.field.isKeyField())h.push(bo(a,c.key));else{const m=c.data.field(f.field);if(vf(m))throw new ae(G.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+f.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(m===null){const _=f.field.canonicalString();throw new ae(G.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${_}' (used as the orderBy) does not exist.`)}h.push(m)}return new Ii(h,d)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const s=_u(t.firestore);return function(a,l,c,d,h,f){const m=a.explicitOrderBy;if(h.length>m.length)throw new ae(G.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const _=[];for(let C=0;C<h.length;C++){const N=h[C];if(m[C].field.isKeyField()){if(typeof N!="string")throw new ae(G.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof N}`);if(!fv(a)&&N.indexOf("/")!==-1)throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${N}' contains a slash.`);const A=a.path.child(at.fromString(N));if(!pe.isDocumentKey(A))throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${A}' is not because it contains an odd number of segments.`);const T=new pe(A);_.push(bo(l,T))}else{const A=PN(c,d,N);_.push(A)}}return new Ii(_,f)}(t._query,t.firestore._databaseId,s,e,n,r)}}function h0(t,e,n){if(typeof(n=ut(n))=="string"){if(n==="")throw new ae(G.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!fv(e)&&n.indexOf("/")!==-1)throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(at.fromString(n));if(!pe.isDocumentKey(r))throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return bo(t,new pe(r))}if(n instanceof $t)return bo(t,n._key);throw new ae(G.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hf(n)}.`)}function f0(t,e){if(!Array.isArray(t)||t.length===0)throw new ae(G.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function VN(t,e){const n=function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ae(G.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ae(G.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class uF{convertValue(e,n="none"){switch(wi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Tt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Ps(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Ee(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Di(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var r,s,i;const n=(i=(s=(r=e.fields)==null?void 0:r[Ga].arrayValue)==null?void 0:s.values)==null?void 0:i.map(a=>Tt(a.doubleValue));return new is(n)}convertGeoPoint(e){return new ss(Tt(e.latitude),Tt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=_f(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Gc(e));default:return null}}convertTimestamp(e){const n=As(e);return new it(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=at.fromString(e);Te($C(r),9688,{name:e});const s=new xo(r.get(1),r.get(3)),i=new pe(r.popFirst(5));return s.isEqual(n)||Rn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MN(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}function dF(){return new ZM("count")}class Jl{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class lo extends Gv{constructor(e,n,r,s,i,a){super(e,n,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Od(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Of("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ae(G.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=lo._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}lo._jsonSchemaVersion="firestore/documentSnapshot/1.0",lo._jsonSchema={type:Yt("string",lo._jsonSchemaVersion),bundleSource:Yt("string","DocumentSnapshot"),bundleName:Yt("string"),bundle:Yt("string")};class Od extends lo{data(e={}){return super.data(e)}}class co{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Jl(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Od(this._firestore,this._userDataWriter,r.key,r,new Jl(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ae(G.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(l=>{const c=new Od(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Jl(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(l=>i||l.type!==3).map(l=>{const c=new Od(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Jl(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,h=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),h=a.indexOf(l.doc.key)),{type:hF(l.type),doc:c,oldIndex:d,newIndex:h}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ae(G.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=co._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=rv.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(n.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function hF(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ee(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function No(t){t=Sn(t,$t);const e=Sn(t.firestore,Fr);return GM(vu(e),t._key).then(n=>FN(e,t,n))}co._jsonSchemaVersion="firestore/querySnapshot/1.0",co._jsonSchema={type:Yt("string",co._jsonSchemaVersion),bundleSource:Yt("string","QuerySnapshot"),bundleName:Yt("string"),bundle:Yt("string")};class Ff extends uF{constructor(e){super(),this.firestore=e}convertBytes(e){return new fr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new $t(this.firestore,null,n)}}function Ne(t){t=Sn(t,Br);const e=Sn(t.firestore,Fr),n=vu(e),r=new Ff(e);return LN(t._query),KM(n,t._query).then(s=>new co(e,r,t,s))}function jo(t,e,n){t=Sn(t,$t);const r=Sn(t.firestore,Fr),s=MN(t.converter,e,n);return Uf(r,[AN(_u(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,In.none())])}function Ut(t,e,n,...r){t=Sn(t,$t);const s=Sn(t.firestore,Fr),i=_u(s);let a;return a=typeof(e=ut(e))=="string"||e instanceof kf?oF(i,"updateDoc",t._key,e,n,r):iF(i,"updateDoc",t._key,e),Uf(s,[a.toMutation(t._key,In.exists(!0))])}function Cn(t){return Uf(Sn(t.firestore,Fr),[new Sf(t._key,In.none())])}function Bt(t,e){const n=Sn(t.firestore,Fr),r=Re(t),s=MN(t.converter,e);return Uf(n,[AN(_u(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,In.exists(!1))]).then(()=>r)}function ln(t,...e){var c,d,h;t=ut(t);let n={includeMetadataChanges:!1,source:"default"},r=0;typeof e[r]!="object"||c0(e[r])||(n=e[r++]);const s={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(c0(e[r])){const f=e[r];e[r]=(c=f.next)==null?void 0:c.bind(f),e[r+1]=(d=f.error)==null?void 0:d.bind(f),e[r+2]=(h=f.complete)==null?void 0:h.bind(f)}let i,a,l;if(t instanceof $t)a=Sn(t.firestore,Fr),l=hu(t._key.path),i={next:f=>{e[r]&&e[r](FN(a,t,f))},error:e[r+1],complete:e[r+2]};else{const f=Sn(t,Br);a=Sn(f.firestore,Fr),l=f._query;const m=new Ff(a);i={next:_=>{e[r]&&e[r](new co(a,m,f,_))},error:e[r+1],complete:e[r+2]},LN(t._query)}return function(m,_,C,N){const A=new Uv(N),T=new Vv(_,A,C);return m.asyncQueue.enqueueAndForget(async()=>Dv(await Dh(m),T)),()=>{A.Nu(),m.asyncQueue.enqueueAndForget(async()=>Lv(await Dh(m),T))}}(vu(a),l,s,i)}function Uf(t,e){return function(r,s){const i=new Lr;return r.asyncQueue.enqueueAndForget(async()=>DM(await HM(r),s,i)),i.promise}(vu(t),e)}function FN(t,e,n){const r=n.docs.get(e._key),s=new Ff(t);return new lo(t,s,e._key,r,new Jl(n.hasPendingWrites,n.fromCache),e.converter)}function fF(t){return pF(t,{count:dF()})}function pF(t,e){const n=Sn(t.firestore,Fr),r=vu(n),s=xO(e,(i,a)=>new KO(a,i.aggregateType,i._internalFieldPath));return QM(r,t._query,s).then(i=>function(l,c,d){const h=new Ff(l);return new eF(c,h,d)}(n,t,i))}function Rt(){return new Bv("serverTimestamp")}function mF(...t){return new zv("arrayUnion",t)}function p0(t){return new qv("increment",t)}(function(e,n=!0){(function(s){cl=s})(Oo),Vr(new br("firestore",(r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new Fr(new RL(r.getProvider("auth-internal")),new LL(a,r.getProvider("app-check-internal")),function(d,h){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new ae(G.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xo(d.options.projectId,h)}(a,s),a);return i={useFetchStreams:n,...i},l._setSettings(i),l},"PUBLIC").setMultipleInstances(!0)),Kn(qb,Hb,e),Kn(qb,Hb,"esm2020")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UN="firebasestorage.googleapis.com",$N="storageBucket",gF=2*60*1e3,yF=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt extends wr{constructor(e,n,r=0){super(qp(e),`Firebase Storage: ${n} (${qp(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,qt.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return qp(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var zt;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(zt||(zt={}));function qp(t){return"storage/"+t}function Zv(){const t="An unknown error occurred, please check the error payload for server response.";return new qt(zt.UNKNOWN,t)}function vF(t){return new qt(zt.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function _F(t){return new qt(zt.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function xF(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new qt(zt.UNAUTHENTICATED,t)}function bF(){return new qt(zt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function wF(t){return new qt(zt.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function EF(){return new qt(zt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function IF(){return new qt(zt.CANCELED,"User canceled the upload/download.")}function SF(t){return new qt(zt.INVALID_URL,"Invalid URL '"+t+"'.")}function TF(t){return new qt(zt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function CF(){return new qt(zt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+$N+"' property when initializing the app?")}function NF(){return new qt(zt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function jF(){return new qt(zt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function AF(t){return new qt(zt.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Vg(t){return new qt(zt.INVALID_ARGUMENT,t)}function BN(){return new qt(zt.APP_DELETED,"The Firebase app was deleted.")}function PF(t){return new qt(zt.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function _c(t,e){return new qt(zt.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Ml(t){throw new qt(zt.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=kn.makeFromUrl(e,n)}catch{return new kn(e,"")}if(r.path==="")return r;throw TF(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(w){w.path.charAt(w.path.length-1)==="/"&&(w.path_=w.path_.slice(0,-1))}const a="(/(.*))?$",l=new RegExp("^gs://"+s+a,"i"),c={bucket:1,path:3};function d(w){w.path_=decodeURIComponent(w.path)}const h="v[A-Za-z0-9_]+",f=n.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",_=new RegExp(`^https?://${f}/${h}/b/${s}/o${m}`,"i"),C={bucket:1,path:3},N=n===UN?"(?:storage.googleapis.com|storage.cloud.google.com)":n,A="([^?#]*)",T=new RegExp(`^https?://${N}/${s}/${A}`,"i"),E=[{regex:l,indices:c,postModify:i},{regex:_,indices:C,postModify:d},{regex:T,indices:{bucket:1,path:2},postModify:d}];for(let w=0;w<E.length;w++){const S=E[w],M=S.regex.exec(e);if(M){const g=M[S.indices.bucket];let v=M[S.indices.path];v||(v=""),r=new kn(g,v),S.postModify(r);break}}if(r==null)throw SF(e);return r}}class RF{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kF(t,e,n){let r=1,s=null,i=null,a=!1,l=0;function c(){return l===2}let d=!1;function h(...A){d||(d=!0,e.apply(null,A))}function f(A){s=setTimeout(()=>{s=null,t(_,c())},A)}function m(){i&&clearTimeout(i)}function _(A,...T){if(d){m();return}if(A){m(),h.call(null,A,...T);return}if(c()||a){m(),h.call(null,A,...T);return}r<64&&(r*=2);let E;l===1?(l=2,E=0):E=(r+Math.random())*1e3,f(E)}let C=!1;function N(A){C||(C=!0,m(),!d&&(s!==null?(A||(l=2),clearTimeout(s),f(0)):A||(l=1)))}return f(0),i=setTimeout(()=>{a=!0,N(!0)},n),N}function DF(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LF(t){return t!==void 0}function OF(t){return typeof t=="object"&&!Array.isArray(t)}function e_(t){return typeof t=="string"||t instanceof String}function m0(t){return t_()&&t instanceof Blob}function t_(){return typeof Blob<"u"}function Mg(t,e,n,r){if(r<e)throw Vg(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Vg(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bu(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function zN(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var uo;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(uo||(uo={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VF(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(e,n,r,s,i,a,l,c,d,h,f,m=!0,_=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=a,this.callback_=l,this.errorCallback_=c,this.timeout_=d,this.progressCallback_=h,this.connectionFactory_=f,this.retry=m,this.isUsingEmulator=_,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((C,N)=>{this.resolve_=C,this.reject_=N,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new nd(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const a=l=>{const c=l.loaded,d=l.lengthComputable?l.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,d)};this.progressCallback_!==null&&i.addUploadProgressListener(a),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(a),this.pendingConnection_=null;const l=i.getErrorCode()===uo.NO_ERROR,c=i.getStatus();if(!l||VF(c,this.additionalRetryCodes_)&&this.retry){const h=i.getErrorCode()===uo.ABORT;r(!1,new nd(!1,null,h));return}const d=this.successCodes_.indexOf(c)!==-1;r(!0,new nd(d,i))})},n=(r,s)=>{const i=this.resolve_,a=this.reject_,l=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(l,l.getResponse());LF(c)?i(c):i()}catch(c){a(c)}else if(l!==null){const c=Zv();c.serverResponse=l.getErrorText(),this.errorCallback_?a(this.errorCallback_(l,c)):a(c)}else if(s.canceled){const c=this.appDelete_?BN():IF();a(c)}else{const c=EF();a(c)}};this.canceled_?n(!1,new nd(!1,null,!0)):this.backoffId_=kF(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&DF(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class nd{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function FF(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function UF(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function $F(t,e){e&&(t["X-Firebase-GMPID"]=e)}function BF(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function zF(t,e,n,r,s,i,a=!0,l=!1){const c=zN(t.urlParams),d=t.url+c,h=Object.assign({},t.headers);return $F(h,e),FF(h,n),UF(h,i),BF(h,r),new MF(d,t.method,h,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,a,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qF(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function HF(...t){const e=qF();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(t_())return new Blob(t);throw new qt(zt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function WF(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GF(t){if(typeof atob>"u")throw AF("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zr={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Hp{constructor(e,n){this.data=e,this.contentType=n||null}}function KF(t,e){switch(t){case Zr.RAW:return new Hp(qN(e));case Zr.BASE64:case Zr.BASE64URL:return new Hp(HN(t,e));case Zr.DATA_URL:return new Hp(YF(e),XF(e))}throw Zv()}function qN(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,a=t.charCodeAt(++n);r=65536|(i&1023)<<10|a&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function QF(t){let e;try{e=decodeURIComponent(t)}catch{throw _c(Zr.DATA_URL,"Malformed data URL.")}return qN(e)}function HN(t,e){switch(t){case Zr.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw _c(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Zr.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw _c(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=GF(e)}catch(s){throw s.message.includes("polyfill")?s:_c(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class WN{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw _c(Zr.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=JF(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function YF(t){const e=new WN(t);return e.base64?HN(Zr.BASE64,e.rest):QF(e.rest)}function XF(t){return new WN(t).contentType}function JF(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e,n){let r=0,s="";m0(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(m0(this.data_)){const r=this.data_,s=WF(r,e,n);return s===null?null:new ni(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new ni(r,!0)}}static getBlob(...e){if(t_()){const n=e.map(r=>r instanceof ni?r.data_:r);return new ni(HF.apply(null,n))}else{const n=e.map(a=>e_(a)?KF(Zr.RAW,a).data:a.data_);let r=0;n.forEach(a=>{r+=a.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(a=>{for(let l=0;l<a.length;l++)s[i++]=a[l]}),new ni(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n_(t){let e;try{e=JSON.parse(t)}catch{return null}return OF(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZF(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function e4(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function GN(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t4(t,e){return e}class An{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||t4}}let rd=null;function n4(t){return!e_(t)||t.length<2?t:GN(t)}function KN(){if(rd)return rd;const t=[];t.push(new An("bucket")),t.push(new An("generation")),t.push(new An("metageneration")),t.push(new An("name","fullPath",!0));function e(i,a){return n4(a)}const n=new An("name");n.xform=e,t.push(n);function r(i,a){return a!==void 0?Number(a):a}const s=new An("size");return s.xform=r,t.push(s),t.push(new An("timeCreated")),t.push(new An("updated")),t.push(new An("md5Hash",null,!0)),t.push(new An("cacheControl",null,!0)),t.push(new An("contentDisposition",null,!0)),t.push(new An("contentEncoding",null,!0)),t.push(new An("contentLanguage",null,!0)),t.push(new An("contentType",null,!0)),t.push(new An("metadata","customMetadata",!0)),rd=t,rd}function r4(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new kn(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function s4(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const a=n[i];r[a.local]=a.xform(r,e[a.server])}return r4(r,t),r}function QN(t,e,n){const r=n_(e);return r===null?null:s4(t,r,n)}function i4(t,e,n,r){const s=n_(e);if(s===null||!e_(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const a=encodeURIComponent;return i.split(",").map(d=>{const h=t.bucket,f=t.fullPath,m="/b/"+a(h)+"/o/"+a(f),_=bu(m,n,r),C=zN({alt:"media",token:d});return _+C})[0]}function o4(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g0="prefixes",y0="items";function a4(t,e,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[g0])for(const s of n[g0]){const i=s.replace(/\/$/,""),a=t._makeStorageReference(new kn(e,i));r.prefixes.push(a)}if(n[y0])for(const s of n[y0]){const i=t._makeStorageReference(new kn(e,s.name));r.items.push(i)}return r}function l4(t,e,n){const r=n_(n);return r===null?null:a4(t,e,r)}class $f{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r_(t){if(!t)throw Zv()}function c4(t,e){function n(r,s){const i=QN(t,s,e);return r_(i!==null),i}return n}function u4(t,e){function n(r,s){const i=l4(t,e,s);return r_(i!==null),i}return n}function d4(t,e){function n(r,s){const i=QN(t,s,e);return r_(i!==null),i4(i,s,t.host,t._protocol)}return n}function s_(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=bF():s=xF():n.getStatus()===402?s=_F(t.bucket):n.getStatus()===403?s=wF(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function YN(t){const e=s_(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=vF(t.path)),i.serverResponse=s.serverResponse,i}return n}function h4(t,e,n,r,s){const i={};e.isRoot?i.prefix="":i.prefix=e.path+"/",n.length>0&&(i.delimiter=n),r&&(i.pageToken=r),s&&(i.maxResults=s);const a=e.bucketOnlyServerUrl(),l=bu(a,t.host,t._protocol),c="GET",d=t.maxOperationRetryTime,h=new $f(l,c,u4(t,e.bucket),d);return h.urlParams=i,h.errorHandler=s_(e),h}function f4(t,e,n){const r=e.fullServerUrl(),s=bu(r,t.host,t._protocol),i="GET",a=t.maxOperationRetryTime,l=new $f(s,i,d4(t,n),a);return l.errorHandler=YN(e),l}function p4(t,e){const n=e.fullServerUrl(),r=bu(n,t.host,t._protocol),s="DELETE",i=t.maxOperationRetryTime;function a(c,d){}const l=new $f(r,s,a,i);return l.successCodes=[200,204],l.errorHandler=YN(e),l}function m4(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function g4(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=m4(null,e)),r}function y4(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};function l(){let E="";for(let w=0;w<2;w++)E=E+Math.random().toString().slice(2);return E}const c=l();a["Content-Type"]="multipart/related; boundary="+c;const d=g4(e,r,s),h=o4(d,n),f="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+h+`\r
--`+c+`\r
Content-Type: `+d.contentType+`\r
\r
`,m=`\r
--`+c+"--",_=ni.getBlob(f,r,m);if(_===null)throw NF();const C={name:d.fullPath},N=bu(i,t.host,t._protocol),A="POST",T=t.maxUploadRetryTime,I=new $f(N,A,c4(t,n),T);return I.urlParams=C,I.headers=a,I.body=_.uploadData(),I.errorHandler=s_(e),I}class v4{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=uo.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=uo.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=uo.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s,i){if(this.sent_)throw Ml("cannot .send() more than once");if(Ai(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const a in i)i.hasOwnProperty(a)&&this.xhr_.setRequestHeader(a,i[a].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ml("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ml("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ml("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ml("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class _4 extends v4{initXhr(){this.xhr_.responseType="text"}}function Bf(){return new _4}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e,n){this._service=e,n instanceof kn?this._location=n:this._location=kn.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new Ao(e,n)}get root(){const e=new kn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return GN(this._location.path)}get storage(){return this._service}get parent(){const e=ZF(this._location.path);if(e===null)return null;const n=new kn(this._location.bucket,e);return new Ao(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw PF(e)}}function x4(t,e,n){t._throwIfRoot("uploadBytes");const r=y4(t.storage,t._location,KN(),new ni(e,!0),n);return t.storage.makeRequestWithTokens(r,Bf).then(s=>({metadata:s,ref:t}))}function b4(t){const e={prefixes:[],items:[]};return XN(t,e).then(()=>e)}async function XN(t,e,n){const s=await w4(t,{pageToken:n});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await XN(t,e,s.nextPageToken)}function w4(t,e){e!=null&&typeof e.maxResults=="number"&&Mg("options.maxResults",1,1e3,e.maxResults);const n=e||{},r=h4(t.storage,t._location,"/",n.pageToken,n.maxResults);return t.storage.makeRequestWithTokens(r,Bf)}function E4(t){t._throwIfRoot("getDownloadURL");const e=f4(t.storage,t._location,KN());return t.storage.makeRequestWithTokens(e,Bf).then(n=>{if(n===null)throw jF();return n})}function I4(t){t._throwIfRoot("deleteObject");const e=p4(t.storage,t._location);return t.storage.makeRequestWithTokens(e,Bf)}function S4(t,e){const n=e4(t._location.path,e),r=new kn(t._location.bucket,n);return new Ao(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T4(t){return/^[A-Za-z]+:\/\//.test(t)}function C4(t,e){return new Ao(t,e)}function JN(t,e){if(t instanceof i_){const n=t;if(n._bucket==null)throw CF();const r=new Ao(n,n._bucket);return e!=null?JN(r,e):r}else return e!==void 0?S4(t,e):t}function N4(t,e){if(e&&T4(e)){if(t instanceof i_)return C4(t,e);throw Vg("To use ref(service, url), the first argument must be a Storage instance.")}else return JN(t,e)}function v0(t,e){const n=e==null?void 0:e[$N];return n==null?null:kn.makeFromBucketSpec(n,t)}function j4(t,e,n,r={}){t.host=`${e}:${n}`;const s=Ai(e);s&&(By(`https://${t.host}/b`),zy("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:DS(i,t.app.options.projectId))}class i_{constructor(e,n,r,s,i,a=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=a,this._bucket=null,this._host=UN,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=gF,this._maxUploadRetryTime=yF,this._requests=new Set,s!=null?this._bucket=kn.makeFromBucketSpec(s,this._host):this._bucket=v0(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=kn.makeFromBucketSpec(this._url,e):this._bucket=v0(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Mg("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Mg("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(hr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Ao(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new RF(BN());{const a=zF(e,this._appId,r,s,n,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(a),a.getPromise().then(()=>this._requests.delete(a),()=>this._requests.delete(a)),a}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const _0="@firebase/storage",x0="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZN="storage";function b0(t,e,n){return t=ut(t),x4(t,e,n)}function w0(t){return t=ut(t),b4(t)}function E0(t){return t=ut(t),E4(t)}function Wp(t){return t=ut(t),I4(t)}function Fl(t,e){return t=ut(t),N4(t,e)}function Xi(t=af(),e){t=ut(t);const r=Pi(t,ZN).getImmediate({identifier:e}),s=PS("storage");return s&&A4(r,...s),r}function A4(t,e,n,r={}){j4(t,e,n,r)}function P4(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new i_(n,r,s,e,Oo)}function R4(){Vr(new br(ZN,P4,"PUBLIC").setMultipleInstances(!0)),Kn(_0,x0,""),Kn(_0,x0,"esm2020")}R4();const k4={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},o_=Wy(k4),I0=ST(o_),S0=TN(o_);Xi(o_);const D4="/odontocloud-react/assets/fondo.png",e1="/odontocloud-react/assets/logo.png",T0=(t,e)=>{const n={email:t,rol:e,timestamp:Date.now()};localStorage.setItem("odc_session",JSON.stringify(n))},Gp=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},L4=()=>{const t=as(),[e,n]=x.useState(""),[r,s]=x.useState(""),[i,a]=x.useState(""),[l,c]=x.useState(navigator.onLine);x.useEffect(()=>{const f=()=>c(!0),m=()=>c(!1);return window.addEventListener("online",f),window.addEventListener("offline",m),()=>{window.removeEventListener("online",f),window.removeEventListener("offline",m)}},[]);const d=f=>{const m=(f||"").toLowerCase();m==="administrador"?t("/dashboard_admin",{replace:!0}):m==="doctor"?t("/dashboard_doctor",{replace:!0}):m==="recepcionista"?t("/dashboard_recepcion",{replace:!0}):a("Rol no reconocido. Contacte al administrador.")};x.useEffect(()=>{if(!navigator.onLine){const m=Gp();m!=null&&m.rol?d(m.rol):a("Sin conexin y no hay sesin guardada.");return}const f=Zy(I0,async m=>{if(m){const _=Gp();if(_!=null&&_.rol){d(_.rol);return}try{const C=Ve(ce(S0,"users"),Ze("correo","==",m.email||"")),N=await Ne(C);if(!N.empty){const A=N.docs[0].data().rol||"sin_rol";T0(m.email||"",A),d(A)}}catch{d("administrador")}}});return()=>f()},[]);const h=async f=>{if(f.preventDefault(),a(""),!l){const m=Gp();m!=null&&m.rol?d(m.rol):a("Sin conexin y no hay sesin guardada.");return}try{const _=(await m2(I0,e,r)).user,C=Ve(ce(S0,"users"),Ze("correo","==",e)),N=await Ne(C);if(N.empty){a("Usuario no encontrado en la base de datos.");return}const T=N.docs[0].data().rol||"sin_rol";T0(e,T),d(T)}catch(m){switch(console.error("Error login:",m),m.code){case"auth/user-not-found":a("Usuario no registrado.");break;case"auth/wrong-password":a("Contrasea incorrecta.");break;case"auth/invalid-email":a("Correo no vlido.");break;case"auth/network-request-failed":a("Sin conexin. Usa la sesin guardada o reconecta.");break;default:a("Error al iniciar sesin.")}}};return o.jsx("div",{className:"login-root",style:{backgroundImage:`url(${D4})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundAttachment:"fixed",width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:o.jsxs("div",{className:"container",children:[o.jsxs("div",{className:"left-panel",children:[o.jsx("img",{src:e1,alt:"OdontoCloud Logo",className:"logo"}),o.jsxs("h2",{children:["Su clnica, ",o.jsx("br",{})," ms conectada."]}),o.jsx("p",{children:"OdontoCloud optimiza cada detalle de su gestin."})]}),o.jsxs("div",{className:"right-panel",children:[o.jsx("h3",{children:"Acceso a la plataforma"}),o.jsxs("form",{onSubmit:h,children:[o.jsx("input",{type:"email",placeholder:"usuario@ejemplo.com",value:e,onChange:f=>n(f.target.value),required:l}),o.jsx("input",{type:"password",placeholder:"Contrasea",value:r,onChange:f=>s(f.target.value),required:l}),o.jsx("button",{type:"submit",children:l?"Iniciar sesin":"Entrar (modo offline)"}),i&&o.jsx("p",{style:{color:"red",marginTop:10},children:i}),!l&&o.jsx("p",{style:{color:"orange",marginTop:10},children:" Modo offline activado"})]})]})]})})},t1="@firebase/installations",a_="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1=1e4,r1=`w:${a_}`,s1="FIS_v2",O4="https://firebaseinstallations.googleapis.com/v1",V4=60*60*1e3,M4="installations",F4="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U4={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Po=new Lo(M4,F4,U4);function i1(t){return t instanceof wr&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o1({projectId:t}){return`${O4}/projects/${t}/installations`}function a1(t){return{token:t.token,requestStatus:2,expiresIn:B4(t.expiresIn),creationTime:Date.now()}}async function l1(t,e){const r=(await e.json()).error;return Po.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function c1({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function $4(t,{refreshToken:e}){const n=c1(t);return n.append("Authorization",z4(e)),n}async function u1(t){const e=await t();return e.status>=500&&e.status<600?t():e}function B4(t){return Number(t.replace("s","000"))}function z4(t){return`${s1} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function q4({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=o1(t),s=c1(t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={fid:n,authVersion:s1,appId:t.appId,sdkVersion:r1},l={method:"POST",headers:s,body:JSON.stringify(a)},c=await u1(()=>fetch(r,l));if(c.ok){const d=await c.json();return{fid:d.fid||n,registrationStatus:2,refreshToken:d.refreshToken,authToken:a1(d.authToken)}}else throw await l1("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d1(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H4(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W4=/^[cdef][\w-]{21}$/,Fg="";function G4(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=K4(t);return W4.test(n)?n:Fg}catch{return Fg}}function K4(t){return H4(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zf(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h1=new Map;function f1(t,e){const n=zf(t);p1(n,e),Q4(n,e)}function p1(t,e){const n=h1.get(t);if(n)for(const r of n)r(e)}function Q4(t,e){const n=Y4();n&&n.postMessage({key:t,fid:e}),X4()}let no=null;function Y4(){return!no&&"BroadcastChannel"in self&&(no=new BroadcastChannel("[Firebase] FID Change"),no.onmessage=t=>{p1(t.data.key,t.data.fid)}),no}function X4(){h1.size===0&&no&&(no.close(),no=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J4="firebase-installations-database",Z4=1,Ro="firebase-installations-store";let Kp=null;function l_(){return Kp||(Kp=BS(J4,Z4,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Ro)}}})),Kp}async function Oh(t,e){const n=zf(t),s=(await l_()).transaction(Ro,"readwrite"),i=s.objectStore(Ro),a=await i.get(n);return await i.put(e,n),await s.done,(!a||a.fid!==e.fid)&&f1(t,e.fid),e}async function m1(t){const e=zf(t),r=(await l_()).transaction(Ro,"readwrite");await r.objectStore(Ro).delete(e),await r.done}async function qf(t,e){const n=zf(t),s=(await l_()).transaction(Ro,"readwrite"),i=s.objectStore(Ro),a=await i.get(n),l=e(a);return l===void 0?await i.delete(n):await i.put(l,n),await s.done,l&&(!a||a.fid!==l.fid)&&f1(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c_(t){let e;const n=await qf(t.appConfig,r=>{const s=e6(r),i=t6(t,s);return e=i.registrationPromise,i.installationEntry});return n.fid===Fg?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function e6(t){const e=t||{fid:G4(),registrationStatus:0};return g1(e)}function t6(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Po.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=n6(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:r6(t)}:{installationEntry:e}}async function n6(t,e){try{const n=await q4(t,e);return Oh(t.appConfig,n)}catch(n){throw i1(n)&&n.customData.serverCode===409?await m1(t.appConfig):await Oh(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function r6(t){let e=await C0(t.appConfig);for(;e.registrationStatus===1;)await d1(100),e=await C0(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await c_(t);return r||n}return e}function C0(t){return qf(t,e=>{if(!e)throw Po.create("installation-not-found");return g1(e)})}function g1(t){return s6(t)?{fid:t.fid,registrationStatus:0}:t}function s6(t){return t.registrationStatus===1&&t.registrationTime+n1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i6({appConfig:t,heartbeatServiceProvider:e},n){const r=o6(t,n),s=$4(t,n),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&s.append("x-firebase-client",d)}const a={installation:{sdkVersion:r1,appId:t.appId}},l={method:"POST",headers:s,body:JSON.stringify(a)},c=await u1(()=>fetch(r,l));if(c.ok){const d=await c.json();return a1(d)}else throw await l1("Generate Auth Token",c)}function o6(t,{fid:e}){return`${o1(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u_(t,e=!1){let n;const r=await qf(t.appConfig,i=>{if(!y1(i))throw Po.create("not-registered");const a=i.authToken;if(!e&&c6(a))return i;if(a.requestStatus===1)return n=a6(t,e),i;{if(!navigator.onLine)throw Po.create("app-offline");const l=d6(i);return n=l6(t,l),l}});return n?await n:r.authToken}async function a6(t,e){let n=await N0(t.appConfig);for(;n.authToken.requestStatus===1;)await d1(100),n=await N0(t.appConfig);const r=n.authToken;return r.requestStatus===0?u_(t,e):r}function N0(t){return qf(t,e=>{if(!y1(e))throw Po.create("not-registered");const n=e.authToken;return h6(n)?{...e,authToken:{requestStatus:0}}:e})}async function l6(t,e){try{const n=await i6(t,e),r={...e,authToken:n};return await Oh(t.appConfig,r),n}catch(n){if(i1(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await m1(t.appConfig);else{const r={...e,authToken:{requestStatus:0}};await Oh(t.appConfig,r)}throw n}}function y1(t){return t!==void 0&&t.registrationStatus===2}function c6(t){return t.requestStatus===2&&!u6(t)}function u6(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+V4}function d6(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}function h6(t){return t.requestStatus===1&&t.requestTime+n1<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f6(t){const e=t,{installationEntry:n,registrationPromise:r}=await c_(e);return r?r.catch(console.error):u_(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p6(t,e=!1){const n=t;return await m6(n),(await u_(n,e)).token}async function m6(t){const{registrationPromise:e}=await c_(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g6(t){if(!t||!t.options)throw Qp("App Configuration");if(!t.name)throw Qp("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Qp(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function Qp(t){return Po.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v1="installations",y6="installations-internal",v6=t=>{const e=t.getProvider("app").getImmediate(),n=g6(e),r=Pi(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},_6=t=>{const e=t.getProvider("app").getImmediate(),n=Pi(e,v1).getImmediate();return{getId:()=>f6(n),getToken:s=>p6(n,s)}};function x6(){Vr(new br(v1,v6,"PUBLIC")),Vr(new br(y6,_6,"PRIVATE"))}x6();Kn(t1,a_);Kn(t1,a_,"esm2020");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vh="analytics",b6="firebase_id",w6="origin",E6=60*1e3,I6="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",d_="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const On=new of("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S6={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},sr=new Lo("analytics","Analytics",S6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T6(t){if(!t.startsWith(d_)){const e=sr.create("invalid-gtag-resource",{gtagURL:t});return On.warn(e.message),""}return t}function _1(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function C6(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function N6(t,e){const n=C6("firebase-js-sdk-policy",{createScriptURL:T6}),r=document.createElement("script"),s=`${d_}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(s):s,r.async=!0,document.head.appendChild(r)}function j6(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function A6(t,e,n,r,s,i){const a=r[s];try{if(a)await e[a];else{const c=(await _1(n)).find(d=>d.measurementId===s);c&&await e[c.appId]}}catch(l){On.error(l)}t("config",s,i)}async function P6(t,e,n,r,s){try{let i=[];if(s&&s.send_to){let a=s.send_to;Array.isArray(a)||(a=[a]);const l=await _1(n);for(const c of a){const d=l.find(f=>f.measurementId===c),h=d&&e[d.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),t("event",r,s||{})}catch(i){On.error(i)}}function R6(t,e,n,r){async function s(i,...a){try{if(i==="event"){const[l,c]=a;await P6(t,e,n,l,c)}else if(i==="config"){const[l,c]=a;await A6(t,e,n,r,l,c)}else if(i==="consent"){const[l,c]=a;t("consent",l,c)}else if(i==="get"){const[l,c,d]=a;t("get",l,c,d)}else if(i==="set"){const[l]=a;t("set",l)}else t(i,...a)}catch(l){On.error(l)}}return s}function k6(t,e,n,r,s){let i=function(...a){window[r].push(arguments)};return window[s]&&typeof window[s]=="function"&&(i=window[s]),window[s]=R6(i,t,e,n),{gtagCore:i,wrappedGtag:window[s]}}function D6(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(d_)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L6=30,O6=1e3;class V6{constructor(e={},n=O6){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const x1=new V6;function M6(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function F6(t){var a;const{appId:e,apiKey:n}=t,r={method:"GET",headers:M6(n)},s=I6.replace("{app-id}",e),i=await fetch(s,r);if(i.status!==200&&i.status!==304){let l="";try{const c=await i.json();(a=c.error)!=null&&a.message&&(l=c.error.message)}catch{}throw sr.create("config-fetch-failed",{httpStatus:i.status,responseMessage:l})}return i.json()}async function U6(t,e=x1,n){const{appId:r,apiKey:s,measurementId:i}=t.options;if(!r)throw sr.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:r};throw sr.create("no-api-key")}const a=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new z6;return setTimeout(async()=>{l.abort()},E6),b1({appId:r,apiKey:s,measurementId:i},a,l,e)}async function b1(t,{throttleEndTimeMillis:e,backoffCount:n},r,s=x1){var l;const{appId:i,measurementId:a}=t;try{await $6(r,e)}catch(c){if(a)return On.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:i,measurementId:a};throw c}try{const c=await F6(t);return s.deleteThrottleMetadata(i),c}catch(c){const d=c;if(!B6(d)){if(s.deleteThrottleMetadata(i),a)return On.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:i,measurementId:a};throw c}const h=Number((l=d==null?void 0:d.customData)==null?void 0:l.httpStatus)===503?pb(n,s.intervalMillis,L6):pb(n,s.intervalMillis),f={throttleEndTimeMillis:Date.now()+h,backoffCount:n+1};return s.setThrottleMetadata(i,f),On.debug(`Calling attemptFetch again in ${h} millis`),b1(t,f,r,s)}}function $6(t,e){return new Promise((n,r)=>{const s=Math.max(e-Date.now(),0),i=setTimeout(n,s);t.addEventListener(()=>{clearTimeout(i),r(sr.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function B6(t){if(!(t instanceof wr)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class z6{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function q6(t,e,n,r,s){if(s&&s.global){t("event",n,r);return}else{const i=await e,a={...r,send_to:i};t("event",n,a)}}async function H6(t,e,n,r){if(r&&r.global){const s={};for(const i of Object.keys(n))s[`user_properties.${i}`]=n[i];return t("set",s),Promise.resolve()}else{const s=await e;t("config",s,{update:!0,user_properties:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W6(){if(qy())try{await FS()}catch(t){return On.warn(sr.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return On.warn(sr.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function G6(t,e,n,r,s,i,a){const l=U6(t);l.then(m=>{n[m.measurementId]=m.appId,t.options.measurementId&&m.measurementId!==t.options.measurementId&&On.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${m.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(m=>On.error(m)),e.push(l);const c=W6().then(m=>{if(m)return r.getId()}),[d,h]=await Promise.all([l,c]);D6(i)||N6(i,d.measurementId),s("js",new Date);const f=(a==null?void 0:a.config)??{};return f[w6]="firebase",f.update=!0,h!=null&&(f[b6]=h),s("config",d.measurementId,f),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K6{constructor(e){this.app=e}_delete(){return delete ka[this.app.options.appId],Promise.resolve()}}let ka={},j0=[];const A0={};let Yp="dataLayer",Q6="gtag",P0,h_,R0=!1;function Y6(){const t=[];if(OS()&&t.push("This is a browser extension environment."),XR()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,s)=>`(${s+1}) ${r}`).join(" "),n=sr.create("invalid-analytics-context",{errorInfo:e});On.warn(n.message)}}function X6(t,e,n){Y6();const r=t.options.appId;if(!r)throw sr.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)On.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw sr.create("no-api-key");if(ka[r]!=null)throw sr.create("already-exists",{id:r});if(!R0){j6(Yp);const{wrappedGtag:i,gtagCore:a}=k6(ka,j0,A0,Yp,Q6);h_=i,P0=a,R0=!0}return ka[r]=G6(t,j0,A0,e,P0,Yp,n),new K6(t)}function J6(t=af()){t=ut(t);const e=Pi(t,Vh);return e.isInitialized()?e.getImmediate():Z6(t)}function Z6(t,e={}){const n=Pi(t,Vh);if(n.isInitialized()){const s=n.getImmediate();if(Cs(e,n.getOptions()))return s;throw sr.create("already-initialized")}return n.initialize({options:e})}function eU(t,e,n){t=ut(t),H6(h_,ka[t.app.options.appId],e,n).catch(r=>On.error(r))}function tU(t,e,n,r){t=ut(t),q6(h_,ka[t.app.options.appId],e,n,r).catch(s=>On.error(s))}const k0="@firebase/analytics",D0="0.10.19";function nU(){Vr(new br(Vh,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return X6(r,s,n)},"PUBLIC")),Vr(new br("analytics-internal",t,"PRIVATE")),Kn(k0,D0),Kn(k0,D0,"esm2020");function t(e){try{const n=e.getProvider(Vh).getImmediate();return{logEvent:(r,s,i)=>tU(n,r,s,i),setUserProperties:(r,s)=>eU(n,r,s)}}catch(n){throw sr.create("interop-component-reg-failed",{reason:n})}}}nU();const rU={apiKey:"AIzaSyC70mGCRrjE8iOap8iTHuid8HEuyadue8Y",authDomain:"odontocloud-d92ac.firebaseapp.com",projectId:"odontocloud-d92ac",storageBucket:"odontocloud-d92ac.firebasestorage.app",messagingSenderId:"267020714981",appId:"1:267020714981:web:a44416ea83aa1d1172650c",measurementId:"G-ZMCC5CFY0C"},Hf=Wy(rU),Mh=ST(Hf),Q=TN(Hf);Xi(Hf);J6(Hf);const f_=(t,e="")=>{try{return localStorage.getItem(t)??e}catch{return e}},L0=()=>{var t;return((t=document.querySelector('meta[name="company-name"]'))==null?void 0:t.getAttribute("content"))||f_("empresa_nombre","OdontoCloud")},sU=()=>{var t;return((t=document.querySelector('meta[name="company-logo"]'))==null?void 0:t.getAttribute("content"))||f_("empresa_logo_url","")},O0=()=>{var t;return((t=document.querySelector('meta[name="software-footer"]'))==null?void 0:t.getAttribute("content"))||f_("software_footer_text","Generado por OdontoCloud")},sd=()=>{const t=new Date;return t.setHours(0,0,0,0),t},Hs=t=>{const e=new Date(t);return e.setHours(0,0,0,0),e},Xp=t=>{const e=new Date(t);return e.setHours(23,59,59,999),e},Wr=(t,e)=>{const n=new Date(t);return n.setDate(n.getDate()+e),n},V0=t=>{const e=new Date(t),n=e.getDay(),r=(n===0?-6:1)-n;return e.setDate(e.getDate()+r),e.setHours(0,0,0,0),e},M0=(t,e)=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();var Y0;const Xn=typeof navigator<"u"&&((Y0=navigator.language)!=null&&Y0.startsWith("es"))?"es-ES":"en-US",Jp=t=>{const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${r}`},Yo=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),iU=t=>{try{const e=new URLSearchParams(t||""),n=e.get("date")||e.get("day")||e.get("d")||e.get("fecha")||e.get("selectedDate")||(typeof sessionStorage<"u"?sessionStorage.getItem("agenda.targetDate"):""),r=String(n||"").slice(0,10);if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return null;const[s,i,a]=r.split("-").map(c=>parseInt(c,10));return new Date(s,(i||1)-1,a||1,0,0,0,0)}catch{return null}};function oU(){const t=Fn(),[e,n]=x.useState("day"),[r,s]=x.useState(sd()),[i,a]=x.useState(sd()),[l,c]=x.useState(!0),[d,h]=x.useState([]),[f,m]=x.useState(""),[_,C]=x.useState(""),[N,A]=x.useState(""),[T,I]=x.useState([]),[E,w]=x.useState([]),[S,M]=x.useState([]);x.useEffect(()=>{const H=Ve(ce(Q,"profesionales"),Ze("activo","==",!0)),me=ln(H,ve=>{I(ve.docs.map(K=>{const Y=K.data()||{};return{id:K.id,nombre:Y.nombre||Y.nombres||Y.nombreCompleto||K.id,especialidad:Y.especialidad||Y.especialidadNombre||"",activo:Y.activo!==!1}}))},()=>I([])),_e=Ve(ce(Q,"consultorios"),Ze("activo","==",!0)),J=ln(_e,ve=>{w(ve.docs.map(K=>{const Y=K.data()||{};return{id:K.id,nombre:Y.nombre||Y.descripcion||K.id,sucursalId:Y.sucursalId||Y.sedeId||"",sucursalNombre:Y.sucursalNombre||Y.sede||"",activo:Y.activo!==!1}}))},()=>w([])),Z=Ve(ce(Q,"sucursales"),Ze("activo","==",!0)),Ie=ln(Z,ve=>{M(ve.docs.map(K=>{const Y=K.data()||{};return{id:K.id,nombre:Y.nombre||Y.alias||K.id,activo:Y.activo!==!1}}))},()=>M([]));return()=>{try{me(),J(),Ie()}catch{}}},[]),x.useEffect(()=>{const H=iU(t.search);if(H){const me=Hs(H);s(me),a(me),n("day");try{sessionStorage.removeItem("agenda.targetDate")}catch{}}},[t.search]),x.useEffect(()=>{c(!0);const H=ce(Q,"citas"),me=Ve(H,pt("fecha","asc")),_e=ln(me,J=>{const Z=J.docs.map(Y=>{const B=Y.data(),ge=B.horaInicio||B.hora||"00:00",[De="0",Be="0"]=ge.split(":"),Le=parseInt(De,10)||0,We=parseInt(Be,10)||0;let be;if(B.fecha&&B.fecha.toDate)be=B.fecha.toDate(),be.setHours(Le,We,0,0);else if(typeof B.fecha=="string"){const[xt,z,le]=B.fecha.split("-");be=new Date(parseInt(xt,10),parseInt(z,10)-1,parseInt(le,10),Le,We,0,0)}else B.fecha instanceof Date?(be=new Date(B.fecha),be.setHours(Le,We,0,0)):(be=new Date,be.setHours(Le,We,0,0));const rt=B.documentoPaciente||B.docPaciente||B.pacienteDocumento||B.documento||"",Xe=B.celularPaciente||B.telefonoPaciente||B.celular||B.telefono||"";return{id:Y.id,raw:B,fecha:be,horaInicio:ge,paciente:B.paciente||B.pacienteNombre||"Sin nombre",doctor:B.doctor||B.doctorNombre||"",doctorId:B.doctorId||"",sucursal:B.sucursal||B.sucursalNombre||"",sucursalId:B.sucursalId||"",espacio:B.espacio||B.consultorio||B.consultorioNombre||"",consultorioId:B.consultorioId||"",comentario:B.comentario||"",estado:B.estado||"En espera",recordatorio:B.recordatorio||"",documento:rt,telefono:Xe}});let Ie,ve;if(e==="day")Ie=Hs(r),ve=Xp(r);else if(e==="week"){const Y=V0(r),B=Wr(Y,6);Ie=Hs(Y),ve=Xp(B)}else{const Y=Hs(r),B=Wr(Y,-30),ge=Wr(Y,60);Ie=Hs(B),ve=Xp(ge)}const K=Z.filter(Y=>Y.fecha>=Ie&&Y.fecha<=ve);h(K),c(!1)},J=>{console.error("Error leyendo citas:",J),h([]),c(!1)});return()=>_e()},[e,r]);const g=x.useMemo(()=>{const H=S.map(_e=>_e.nombre).filter(Boolean);if(H.length)return H;const me=new Set;return d.forEach(_e=>_e.sucursal&&me.add(_e.sucursal)),Array.from(me)},[d,S]),v=x.useMemo(()=>{const H=T.map(_e=>_e.nombre).filter(Boolean);if(H.length)return H;const me=new Set;return d.forEach(_e=>_e.doctor&&me.add(_e.doctor)),Array.from(me)},[d,T]),b=x.useMemo(()=>{const H=N.trim().toLowerCase();return d.filter(me=>{if(f&&me.sucursal!==f||_&&me.doctor!==_)return!1;if(!H)return!0;const _e=[me.paciente,me.doctor,me.comentario,me.documento,me.sucursal,me.espacio,me.estado],J=me.raw?JSON.stringify(me.raw):"";return[..._e,J].filter(Boolean).some(Ie=>String(Ie).toLowerCase().includes(H))})},[d,f,_,N]),k=x.useMemo(()=>l?"Ocupacin: cargando...":b.length===0?"Ocupacin: sin citas para el rango seleccionado.":`Ocupacin: ${b.length} cita${b.length!==1?"s":""} en el rango actual.`,[b,l]),R=x.useMemo(()=>{const H=new Date(i.getFullYear(),i.getMonth(),1),me=(H.getDay()+6)%7,_e=new Date(H);_e.setDate(_e.getDate()-me);const J=[];for(let Z=0;Z<6;Z++){const Ie=[];for(let ve=0;ve<7;ve++){const K=new Date(_e),Y=K.getMonth()===i.getMonth(),B=M0(K,sd()),ge=M0(K,r);Ie.push({date:K,isCurrentMonth:Y,isToday:B,isSelected:ge}),_e.setDate(_e.getDate()+1)}J.push(Ie)}return J},[i,r]),V=()=>{const H=new Date(i);H.setMonth(H.getMonth()-1),a(H)},D=()=>{const H=new Date(i);H.setMonth(H.getMonth()+1),a(H)},O=H=>{s(Hs(H)),a(Hs(H)),n("day")},ee=x.useMemo(()=>i.toLocaleDateString(Xn,{month:"long",year:"numeric"}),[i]),ye=x.useMemo(()=>{if(e==="day")return r.toLocaleDateString(Xn,{weekday:"long",day:"2-digit",month:"long",year:"numeric"});if(e==="week"){const H=V0(r),me=Wr(H,6);return H.toLocaleDateString(Xn,{day:"2-digit",month:"short"})+" - "+me.toLocaleDateString(Xn,{day:"2-digit",month:"short",year:"numeric"})}return"ltimas citas (detalle)"},[e,r]),He=()=>{s(e==="day"?Wr(r,-1):e==="week"?Wr(r,-7):Wr(r,-1))},X=()=>{s(e==="day"?Wr(r,1):e==="week"?Wr(r,7):Wr(r,1))},te=()=>{const H=sd();s(H),a(H),n("day")},de=()=>{var We;const H=be=>String(be??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),me=L0(),_e=sU(),J=O0(),Z=f||"",Ie=_||"",ve=new Date;ve.setHours(0,0,0,0);const K=b.length===0?'<tr class="empty"><td colspan="10">No hay citas registradas para este rango.</td></tr>':b.map((be,rt)=>{var re,ue,Ae,Pe,Fe,Oe;const Xe=be.fecha.toLocaleTimeString(Xn,{hour:"2-digit",minute:"2-digit",hour12:!0}),xt=be.documento||((re=be.raw)==null?void 0:re.documento)||((ue=be.raw)==null?void 0:ue.nroDocumento)||"",z=((Ae=be.raw)==null?void 0:Ae.celularPaciente)||((Pe=be.raw)==null?void 0:Pe.celular)||"",le=((Fe=be.raw)==null?void 0:Fe.telefonoPaciente)||((Oe=be.raw)==null?void 0:Oe.telefono)||"",L=new Date(be.fecha.getFullYear(),be.fecha.getMonth(),be.fecha.getDate());let F="Futura";return L.getTime()===ve.getTime()?F="Hoy":L.getTime()<ve.getTime()&&(F="Pasada"),`<tr class="${rt%2?"zebra":""}">
                <td class="mono">${H(Xe)}</td>
                <td>${H(be.paciente)}</td>
                <td class="mono">${H(xt)}</td>
                <td class="mono">${H(z)}</td>
                <td class="mono">${H(le)}</td>
                <td>${H(be.doctor)}</td>
                <td>${H(be.espacio)}</td>
                <td>${H(be.comentario)}</td>
                <td class="status">${H(be.estado)}</td>
                <td class="actual">${H(F)}</td>
              </tr>`}).join(""),B=`<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Agenda  ${H(me)}</title>
  <style>
      @page { size: A4 portrait; margin: 14mm 16mm; }
      * { box-sizing: border-box; }
      html, body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      body { font-family: "Segoe UI", Roboto, Arial, sans-serif; color:#0f172a; line-height:1.35; }

      /* Cabecera */
      .hdr {
        display:flex; flex-direction:column; align-items:center; text-align:center;
        margin-bottom:14px;
      }
      .logo {
        max-height:120px; width:auto; max-width:100%; object-fit:contain;
        filter: drop-shadow(0 1px 0 rgba(0,0,0,.04));
      }
      .brand {
        margin-top:4px; font-weight:800; letter-spacing:.5px; text-transform:uppercase;
        font-size:26px; color:#0a86d8;
      }
      .sub { margin-top:2px; font-size:12px; color:#64748b; }

      /* Tarjeta info Sede/Doctor */
      .info-card {
        width:100%; display:flex; justify-content:center; margin:8px 0 16px;
      }
      .info {
        width:70%; border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; border-collapse:separate;
        font-size:12px;
      }
      .info-row { display:flex; border-top:1px solid #e5e7eb; }
      .info-row:first-child { border-top:0; }
      .label {
        width:22%; padding:8px 10px; background:#f8fafc; font-weight:600; color:#334155; border-right:1px solid #e5e7eb;
      }
      .value { flex:1; padding:8px 10px; }

      /* Tabla principal */
      table { width:100%; border-collapse:separate; border-spacing:0; font-size:12px; }
      thead th {
        background:#0f172a; color:#ffffff; text-align:center; font-weight:700;
        padding:9px 8px; position:relative;
      }
      thead th + th { box-shadow: inset 1px 0 0 rgba(255,255,255,.08); }
      tbody td {
        padding:8px 8px; vertical-align:top; border-bottom:1px solid #e5e7eb;
      }
      tbody tr.zebra td { background:#fafafa; }
      tbody tr.empty td {
        padding:16px; color:#6b7280; text-align:center; background:#fafafa;
        border:1px dashed #e5e7eb; border-radius:8px;
      }
      td.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
      td.status { white-space:nowrap; }
      td.actual { font-weight:600; }
      /* Bordes exteriores suaves */
      .tbl-wrap { border:1px solid #e5e7eb; border-radius:10px; overflow:hidden; }

      /* Notas pie */
      .note { margin-top:10px; font-size:10px; color:#6b7280; }

      /* Evitar cortes feos */
      tr, .hdr, .info-card { page-break-inside: avoid; }
    </style>
</head>
<body>
  <div class="hdr">
    ${_e?`<img src="${_e}" alt="Logo" class="logo">`:""}
    <div class="brand">${H(me)}</div>
    <div class="sub">Agenda de citas  ${H(ye)}</div>
  </div>

  <div class="info-card">
    <div class="info">
      <div class="info-row"><div class="label">Sede</div><div class="value">${H(Z)}</div></div>
      <div class="info-row"><div class="label">Doctor</div><div class="value">${H(Ie)}</div></div>
    </div>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th style="width:9%">Hora</th>
          <th style="width:17%">Nombre paciente</th>
          <th style="width:12%">Documento</th>
          <th style="width:12%">Celular</th>
          <th style="width:12%">Telfono</th>
          <th style="width:10%">Doctor</th>
          <th style="width:11%">Espacio</th>
          <th>Comentario</th>
          <th style="width:9%">Estado</th>
          <th style="width:9%">Actualidad</th>
        </tr>
      </thead>
      <tbody>${K}</tbody>
    </table>
  </div>

  <div class="note">
    ${H(J)}  ${H(new Date().toLocaleString(Xn))}
  </div>

  <script>
    window.addEventListener('load', function() {
      try { window.focus(); window.print(); } catch (e) {}
    });
  <\/script>
</body>
</html>`,ge=new Blob([B],{type:"text/html;charset=utf-8"}),De=URL.createObjectURL(ge),Be=window.open(De,"_blank","noopener,noreferrer,width=900,height=700");if(!Be){alert("El navegador bloque la ventana de impresin. Permite pop-ups para este sitio."),URL.revokeObjectURL(De);return}const Le=()=>{try{URL.revokeObjectURL(De)}catch{}};(We=Be.addEventListener)==null||We.call(Be,"load",Le),setTimeout(Le,15e3)},ne=()=>alert("Funcin de confirmar citas se integrar con n8n / correo."),he=()=>te(),Ce=()=>{if(b.length===0){alert("No hay citas para exportar.");return}const H=L0(),me=O0(),_e=[`Empresa: ${H}`],J=["Fecha","Hora","Paciente","Doctor","Espacio","Comentario"],Z=b.map(De=>{const Be=De.fecha.toLocaleDateString(Xn),Le=De.fecha.toLocaleTimeString(Xn,{hour:"2-digit",minute:"2-digit",hour12:!0});return[Be,Le,De.paciente||"",De.doctor||"",De.espacio||"",(De.comentario||"").replace(/\r?\n/g," ")]}),Ie=[me],ve=[_e,[],J,...Z,[],Ie].map(De=>(De||[]).map(Be=>`"${String(Be??"").replace(/"/g,'""')}"`).join(",")).join(`
`),K=`citas_${H.toLowerCase().replace(/\s+/g,"_")}_${Jp(Hs(r))}`+(e==="week"?"_semana":e==="detail"?"_detalle":"")+".csv",Y=new Blob(["\uFEFF"+ve],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL(Y),ge=document.createElement("a");ge.href=B,ge.download=K,ge.click(),URL.revokeObjectURL(B)},Ue=async(H,me)=>{try{const _e=Re(Q,"citas",H);await Ut(_e,{estado:me})}catch(_e){console.error("Error actualizando estado:",_e),alert("No se pudo actualizar el estado de la cita.")}},$e=(H,me)=>{if(!H){alert("Este paciente no tiene celular registrado.");return}const _e=String(H).replace(/\D/g,""),J=me.fecha.toLocaleDateString(Xn),Z=me.fecha.toLocaleTimeString(Xn,{hour:"numeric",minute:"2-digit",hour12:!0}),Ie=encodeURIComponent(`Hola ${me.paciente}, le recordamos su cita odontolgica el ${J} a las ${Z}. Por favor confirme su asistencia.`),ve=`https://wa.me/${_e}?text=${Ie}`;window.open(ve,"_blank")},Ke=async H=>{if(window.confirm(`Seguro que deseas eliminar la cita de ${H.paciente} del ${H.fecha.toLocaleDateString(Xn)}?`))try{const _e=Re(Q,"citas",H.id);await Cn(_e)}catch(_e){console.error("Error eliminando cita:",_e),alert(" No se pudo eliminar la cita.")}},mt=()=>{const H=document.createElement("div");Object.assign(H.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const me=document.createElement("div");Object.assign(me.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"}),me.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Nueva Cita</h2>
      <form id="formNuevaCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label style="font-weight:600;">Paciente existente</label>
        <div style="position:relative;">
          <input type="text" id="buscarPaciente" placeholder="Buscar por nombre, apellido o documento..." autocomplete="off"/>
          <div id="acResultados" style="position:absolute;left:0;right:0;top:calc(100% + 6px);z-index:10000;display:none;background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 8px 22px rgba(0,0,0,.12);max-height:240px;overflow:auto;"></div>
        </div>
        <small style="color:gray;">Si el paciente no existe, marca Registrar nuevo paciente.</small>

        <label style="display:flex;align-items:center;gap:8px;margin-top:5px;">
          <input type="checkbox" id="esNuevoPaciente" />
          <span>Registrar nuevo paciente</span>
        </label>

        <div id="nuevoPacienteCampos" style="display:none;flex-direction:column;gap:8px;margin-top:10px;padding:10px;border-radius:8px;background:#f9f9f9;border:1px solid #ddd;">
          <h4 style="margin:0;text-align:center;color:#0a86d8;">Datos del paciente</h4>
          <div style="display:flex;gap:8px;">
            <input type="text" id="npNombre" placeholder="Nombre" style="flex:1;" />
            <input type="text" id="npApellido" placeholder="Apellido" style="flex:1;" />
          </div>
          <select id="npTipoDocumento">
            <option value="">Tipo de documento</option>
            <option value="CC">Cdula de Ciudadana</option>
            <option value="CE">Cdula de Extranjera</option>
            <option value="TI">Tarjeta de Identidad</option>
            <option value="PA">Pasaporte</option>
            <option value="DI">Documento Internacional</option>
            <option value="OTRO">Otro</option>
          </select>
          <input type="text" id="npDocumento" placeholder="Nmero de documento" />
          <input type="email" id="npCorreo" placeholder="Correo electrnico" />
          <div style="display:flex;gap:5px;">
            <select id="npIndicativo" style="width:40%;">
              <option value="+57"> +57</option>
              <option value="+1"> +1</option>
              <option value="+34"> +34</option>
              <option value="+52"> +52</option>
              <option value="+54"> +54</option>
              <option value="+593"> +593</option>
              <option value="+56"> +56</option>
              <option value="+58"> +58</option>
            </select>
            <input type="tel" id="npCelular" placeholder="Celular (obligatorio)" style="flex:1;" />
          </div>
          <input type="tel" id="npTelefono" placeholder="Telfono fijo (opcional)" />
          <label style="font-weight:500;">Fecha de nacimiento:</label>
          <input type="date" id="npNacimiento" />
          <select id="npSexo">
            <option value="">Sexo</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
            <option value="Otro">Otro</option>
          </select>
          <textarea id="npComentario" placeholder="Comentario o antecedentes del paciente" rows="2"></textarea>
        </div>

        <hr style="margin:10px 0;border:none;border-top:1px solid #ddd;" />
        <h4 style="margin:0;text-align:center;color:#0a86d8;">Detalles de la cita</h4>

        <!--  Catlogos -->
        <label>Doctor asignado</label>
        <select id="ncDoctorSel" required>
          <option value="">Seleccione doctor</option>
        </select>

        <label>Fecha</label>
        <input type="date" id="ncFecha" required value="${Jp(r)}" />

        <label>Hora</label>
        <input type="time" id="ncHora" required />

        <label>Espacio fsico / Consultorio</label>
        <select id="ncConsultorioSel">
          <option value="">Seleccione consultorio</option>
        </select>

        <label>Sucursal</label>
        <select id="ncSucursalSel">
          <option value="">Seleccione sucursal</option>
        </select>

        <label>Comentario</label>
        <textarea id="ncComentario" placeholder="Comentario sobre la cita" rows="3"></textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarModal" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar</button>
        </div>
      </form>
    `;const _e=document.createElement("style");_e.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      input, select, textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      input:focus, select:focus, textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
      .ac-item { padding: 8px 10px; display:flex; gap:8px; align-items:baseline; cursor:pointer; }
      .ac-item:hover, .ac-item.active { background:#f5f7fb; }
      .ac-name { font-weight:600; } .ac-doc { color:#64748b; font-size:12px; } .ac-tel { margin-left:auto; font-size:12px; color:#0f172a; }
      .ac-empty { padding:10px; color:#9aa4b2; font-size:13px; }
    `,document.head.appendChild(_e),H.appendChild(me),document.body.appendChild(H);const J=me.querySelector("#esNuevoPaciente"),Z=me.querySelector("#nuevoPacienteCampos"),Ie=me.querySelector("#buscarPaciente"),ve=me.querySelector("#acResultados"),K=me.querySelector("#ncDoctorSel"),Y=me.querySelector("#ncConsultorioSel"),B=me.querySelector("#ncSucursalSel"),ge=(L,F,re)=>{const ue=document.createElement("option");ue.value=F,ue.textContent=re,L.appendChild(ue)};(T||[]).forEach(L=>{const F=L.especialidad?`${L.nombre}  ${L.especialidad}`:L.nombre;ge(K,L.id,F)}),(E||[]).forEach(L=>{const F=L.sucursalNombre?`${L.nombre}  ${L.sucursalNombre}`:L.nombre;ge(Y,L.id,F)}),(S||[]).forEach(L=>ge(B,L.id,L.nombre)),J.addEventListener("change",()=>{Z.style.display=J.checked?"flex":"none",J.checked&&(ve.style.display="none")}),me.querySelector("#btnCancelarModal").addEventListener("click",()=>H.remove());let De=null,Be=null,Le=-1,We=[];const be=L=>{if(We=L||[],Le=-1,!L||L.length===0){ve.innerHTML='<div class="ac-empty">Sin resultados</div>',ve.style.display="block";return}ve.innerHTML=L.map((F,re)=>`
            <div class="ac-item" data-index="${re}" data-id="${F.id}">
              <span class="ac-name">${F.nombre}</span>
              <span class="ac-doc"> ${F.documento||"s/doc"}</span>
              <span class="ac-tel">${F.celular||F.telefono||""}</span>
            </div>`).join(""),ve.style.display="block",[...ve.querySelectorAll(".ac-item")].forEach(F=>{F.addEventListener("click",()=>{const re=Number(F.getAttribute("data-index"));rt(re)})})},rt=L=>{const F=We[L];F&&(Be=F,Ie.value=F.nombre,ve.style.display="none",J.checked=!1,Z.style.display="none")},Xe=L=>{We.length&&(Le=(Le+L+We.length)%We.length,[...ve.querySelectorAll(".ac-item")].forEach((F,re)=>{re===Le?F.classList.add("active"):F.classList.remove("active")}))},xt=(L,F)=>L.nombreCompleto||L.paciente||[L.nombres,L.apellidos].filter(Boolean).join(" ")||F,z=async L=>{const F=(L||"").toString().trim(),re=Yo(F);if(!re||re.length<2)return[];if(/^\d{5,}$/.test(F))try{const ue=Ve(ce(Q,"pacientes"),Ze("documento","==",F)),Ae=Ve(ce(Q,"pacientes"),Ze("nroDocumento","==",F)),[Pe,Fe]=await Promise.all([Ne(ue),Ne(Ae)]),Oe=Pe.empty?Fe:Pe;if(!Oe.empty)return Oe.docs.slice(0,10).map(nt=>{const ct=nt.data()||{};return{id:nt.id,nombre:xt(ct,nt.id),documento:ct.documento||ct.nroDocumento||nt.id,celular:ct.celularPaciente||ct.celular||"",telefono:ct.telefonoPaciente||ct.telefono||""}})}catch{}try{const ue=Ve(ce(Q,"pacientes"),pt("nombre_busqueda"),u0(re),d0(re+""),Ra(10)),Ae=await Ne(ue);if(!Ae.empty)return Ae.docs.map(Pe=>{const Fe=Pe.data()||{};return{id:Pe.id,nombre:xt(Fe,Pe.id),documento:Fe.documento||Fe.nroDocumento||Pe.id,celular:Fe.celularPaciente||Fe.celular||"",telefono:Fe.telefonoPaciente||Fe.telefono||""}})}catch{}try{const ue=Ve(ce(Q,"pacientes"),pt("creado","desc"),Ra(50));return(await Ne(ue)).docs.map(Oe=>({id:Oe.id,...Oe.data()||{}})).map(Oe=>({id:Oe.id,nombre:xt(Oe,Oe.id),documento:Oe.documento||Oe.nroDocumento||Oe.id,celular:Oe.celularPaciente||Oe.celular||"",telefono:Oe.telefonoPaciente||Oe.telefono||"",_norm:Yo(`${Oe.nombreCompleto||Oe.paciente||""} ${Oe.nombres||""} ${Oe.apellidos||""} ${Oe.documento||Oe.nroDocumento||""}`)})).filter(Oe=>Oe._norm.includes(re)).slice(0,10).map(({_norm:Oe,...nt})=>nt)}catch{}return[]};Ie.addEventListener("input",()=>{Be=null;const L=Ie.value;if(clearTimeout(De),!L||L.trim().length<2){ve.style.display="none";return}De=setTimeout(async()=>{const F=await z(L.trim());be(F)},220)}),Ie.addEventListener("keydown",L=>{ve.style.display==="block"&&(L.key==="ArrowDown"?(L.preventDefault(),Xe(1)):L.key==="ArrowUp"?(L.preventDefault(),Xe(-1)):L.key==="Enter"?Le>=0&&(L.preventDefault(),rt(Le)):L.key==="Escape"&&(ve.style.display="none"))}),document.addEventListener("click",L=>{me.contains(L.target)&&!ve.contains(L.target)&&L.target!==Ie&&(ve.style.display="none")},{capture:!0});const le=me.querySelector("#formNuevaCita");le.addEventListener("submit",async L=>{L.preventDefault();const F=J.checked,re=(le.querySelector("#buscarPaciente").value||"").trim(),ue=K.value,Ae=le.querySelector("#ncFecha").value,Pe=le.querySelector("#ncHora").value,Fe=Y.value,Oe=B.value,nt=(le.querySelector("#ncComentario").value||"").trim();if(!Ae||!Pe){alert(" Debes seleccionar fecha y hora para la cita.");return}if(!ue){alert(" Indica el doctor asignado.");return}const ct=(T||[]).find(lt=>lt.id===ue),Ot=(ct==null?void 0:ct.nombre)||"";let Ge="",Qn="";if(Fe){const lt=(E||[]).find(un=>un.id===Fe);Ge=(lt==null?void 0:lt.nombre)||"",Qn=(lt==null?void 0:lt.sucursalNombre)||""}let Ht="";if(Oe){const lt=(S||[]).find(un=>un.id===Oe);Ht=(lt==null?void 0:lt.nombre)||""}!Oe&&Qn&&(Ht=Qn);try{let lt=null,un=null,gn="",yn="",Er="";if(F){const j=(le.querySelector("#npNombre").value||"").trim(),W=(le.querySelector("#npApellido").value||"").trim();if(gn=`${j} ${W}`.trim(),!gn){alert(" Debes indicar nombre y apellido para el nuevo paciente.");return}const ie=(le.querySelector("#npDocumento").value||"").trim(),xe=(le.querySelector("#npCelular").value||"").trim(),Se=(le.querySelector("#npTelefono").value||"").trim();if(!xe&&!Se){alert(" Debes registrar al menos un telfono (celular o fijo) del paciente o de un acudiente.");return}if(lt=ie||gn.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"_"),un=Re(Q,"pacientes",lt),!(await No(un)).exists()){const bt=Yo(gn);await jo(un,{nombres:j,apellidos:W,nombreCompleto:gn,paciente:gn,nombre_busqueda:bt,variantes_busqueda:[bt,Yo(j),Yo(W)],tipoDocumento:le.querySelector("#npTipoDocumento").value,documento:ie,correo:(le.querySelector("#npCorreo").value||"").trim(),indicativo:le.querySelector("#npIndicativo").value,celular:xe,telefono:Se,celularPaciente:xe,telefonoPaciente:Se,fechaNacimiento:le.querySelector("#npNacimiento").value,sexo:le.querySelector("#npSexo").value,notas:(le.querySelector("#npComentario").value||"").trim(),creado:new Date().toISOString(),activo:!0,citas:[]},{merge:!0})}yn=xe,Er=Se}else if(Be)lt=Be.id,gn=Be.nombre,un=Re(Q,"pacientes",lt),yn=Be.celular||"",Er=Be.telefono||"";else{if(!re){alert(" Por favor, escribe o selecciona un paciente.");return}const j=Ve(ce(Q,"pacientes"),Ze("documento","==",re)),W=Ve(ce(Q,"pacientes"),Ze("nroDocumento","==",re)),[ie,xe]=await Promise.all([Ne(j),Ne(W)]),Se=ie.empty?xe:ie;if(Se.empty){let qe=null;try{const bt=Yo(re),Un=Ve(ce(Q,"pacientes"),pt("nombre_busqueda"),u0(bt),d0(bt+""),Ra(1)),jn=await Ne(Un);if(!jn.empty){const St=jn.docs[0],At=St.data()||{};qe={id:St.id,ref:St.ref,nombre:At.nombreCompleto||At.paciente||[At.nombres,At.apellidos].filter(Boolean).join(" "),cel:At.celularPaciente||At.celular||"",tel:At.telefonoPaciente||At.telefono||""}}}catch{}qe?(lt=qe.id,un=qe.ref,gn=qe.nombre||re,yn=qe.cel||"",Er=qe.tel||""):gn=re}else{const qe=Se.docs[0],bt=qe.data()||{};lt=qe.id,un=qe.ref,gn=bt.nombreCompleto||bt.paciente||[bt.nombres,bt.apellidos].filter(Boolean).join(" ")||re,yn=bt.celularPaciente||bt.celular||"",Er=bt.telefonoPaciente||bt.telefono||""}}if(!(yn||Er||"").trim()){alert(" Este paciente no tiene ningn telfono registrado. Edita sus datos y agrega un nmero antes de guardar la cita.");return}const ls={paciente:gn||"Paciente",pacienteId:lt||null,doctorId:ue,doctor:Ot||"Doctor",consultorioId:Fe||"",consultorioNombre:Ge||"",sucursalId:Oe||"",sucursal:Ht||"",espacio:Ge||"",fecha:Ae,horaInicio:Pe,comentario:nt,estado:"En espera",creado:new Date().toISOString(),celularPaciente:yn||"",telefonoPaciente:Er||""},Oi=await Bt(ce(Q,"citas"),ls);un&&await jo(un,{citas:mF(Oi.id)},{merge:!0}),alert(" Cita registrada correctamente y vinculada al paciente."),H.remove()}catch(lt){console.error(" Error al guardar cita:",lt),alert(" Error al guardar la cita. Revisa la consola para ms detalles.")}})},gt=H=>{var K,Y;const me=document.createElement("div");Object.assign(me.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0,0,0,0.55)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"9999"});const _e=document.createElement("div");Object.assign(_e.style,{background:"#fff",padding:"25px 30px",borderRadius:"14px",width:"520px",maxWidth:"95%",maxHeight:"95%",overflowY:"auto",boxShadow:"0 8px 30px rgba(0,0,0,0.3)",fontFamily:"Segoe UI, Roboto, sans-serif"});const J=(K=H.raw)!=null&&K.fecha&&typeof H.raw.fecha=="string"?H.raw.fecha:Jp(H.fecha),Z=((Y=H.raw)==null?void 0:Y.horaInicio)||H.fecha.toTimeString().slice(0,5);_e.innerHTML=`
      <h2 style="margin-top:0;text-align:center;color:#0a86d8;font-weight:600;"> Editar Cita</h2>
      <form id="formEditarCita" style="display:flex;flex-direction:column;gap:12px;margin-top:10px;">
        <label>Paciente</label>
        <input type="text" id="editPaciente" value="${H.paciente||""}" />

        <label>Doctor asignado</label>
        <input type="text" id="editDoctor" value="${H.doctor||""}" />

        <div style="display:flex;gap:8px;">
          <div style="flex:1;">
            <label>Fecha</label>
            <input type="date" id="editFecha" value="${J}" />
          </div>
          <div style="flex:1;">
            <label>Hora</label>
            <input type="time" id="editHora" value="${Z}" />
          </div>
        </div>

        <label>Espacio fsico / Sala</label>
        <input type="text" id="editEspacio" value="${H.espacio||""}" />

        <label>Estado</label>
        <select id="editEstado" class="estado-select">
          <option value="En espera" ${H.estado==="En espera"?"selected":""}>En espera</option>
          <option value="En sala" ${H.estado==="En sala"?"selected":""}>En sala</option>
          <option value="Atendiendo" ${H.estado==="Atendiendo"?"selected":""}>Atendiendo</option>
          <option value="Finalizada" ${H.estado==="Finalizada"?"selected":""}>Finalizada</option>
          <option value="pendiente" ${H.estado==="pendiente"?"selected":""}>Pendiente</option>
          <option value="No asisti" ${H.estado==="No asisti"?"selected":""}>No asisti</option>
        </select>

        <label>Comentario</label>
        <textarea id="editComentario" rows="3">${H.comentario||""}</textarea>

        <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:10px;">
          <button type="button" id="btnCancelarEdit" class="btn-cancelar">Cancelar</button>
          <button type="submit" class="btn-guardar">Guardar cambios</button>
        </div>
      </form>
    `;const Ie=document.createElement("style");Ie.textContent=`
      .btn-cancelar, .btn-guardar { padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: .2s; }
      .btn-cancelar { background: #e0e0e0; color: #333; } .btn-cancelar:hover { background: #d5d5d5; }
      .btn-guardar { background: #0a86d8; color: white; } .btn-guardar:hover { background: #0669ac; }
      #formEditarCita input, #formEditarCita select, #formEditarCita textarea { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; outline: none; }
      #formEditarCita input:focus, #formEditarCita select:focus, #formEditarCita textarea:focus { border-color: #0a86d8; box-shadow: 0 0 0 2px rgba(10,134,216,.2); }
    `,document.head.appendChild(Ie),me.appendChild(_e),document.body.appendChild(me),_e.querySelector("#btnCancelarEdit").addEventListener("click",()=>me.remove());const ve=_e.querySelector("#formEditarCita");ve.addEventListener("submit",async B=>{B.preventDefault();const ge=ve.querySelector("#editPaciente").value.trim(),De=ve.querySelector("#editDoctor").value.trim(),Be=ve.querySelector("#editFecha").value,Le=ve.querySelector("#editHora").value,We=ve.querySelector("#editEspacio").value.trim(),be=ve.querySelector("#editEstado").value,rt=ve.querySelector("#editComentario").value.trim();if(!ge)return alert(" El nombre del paciente es obligatorio.");if(!Be||!Le)return alert(" Debes indicar fecha y hora.");try{const Xe=Re(Q,"citas",H.id);await Ut(Xe,{paciente:ge,doctor:De,fecha:Be,horaInicio:Le,espacio:We,estado:be,comentario:rt}),alert(" Cita actualizada correctamente."),me.remove()}catch(Xe){console.error(" Error al actualizar cita:",Xe),alert(" Error al actualizar la cita. Revisa la consola para ms detalles.")}})},Gt=H=>{const me=H.fecha.toLocaleDateString(Xn),_e=H.fecha.toLocaleTimeString(Xn,{hour:"numeric",minute:"2-digit",hour12:!0}),J=`${me}  ${_e}`;return o.jsxs("tr",{className:"fade-in-row",onClick:()=>gt(H),style:{cursor:"pointer"},children:[o.jsx("td",{children:J}),o.jsx("td",{children:H.paciente}),o.jsx("td",{children:H.doctor}),o.jsx("td",{children:H.espacio}),o.jsx("td",{children:H.comentario}),o.jsx("td",{onClick:Z=>{Z.stopPropagation()},children:o.jsxs("select",{className:"estado-select",value:H.estado,onChange:Z=>Ue(H.id,Z.target.value),children:[o.jsx("option",{value:"En espera",children:"En espera"}),o.jsx("option",{value:"En sala",children:"En sala"}),o.jsx("option",{value:"Atendiendo",children:"Atendiendo"}),o.jsx("option",{value:"Finalizada",children:"Finalizada"}),o.jsx("option",{value:"pendiente",children:"Pendiente"}),o.jsx("option",{value:"No asisti",children:"No asisti"})]})}),o.jsxs("td",{className:"acciones-cell",onClick:Z=>{Z.stopPropagation()},children:[H.telefono?o.jsx("button",{type:"button",className:"btn-whatsapp",onClick:Z=>{Z.stopPropagation(),$e(H.telefono,H)},children:"WhatsApp"}):o.jsx("span",{className:"acciones-texto",children:"Sin celular"}),o.jsx("button",{type:"button",className:"btn-delete",onClick:Z=>{Z.stopPropagation(),Ke(H)},children:"Eliminar"}),H.recordatorio&&o.jsx("span",{className:"acciones-texto",children:H.recordatorio})]})]},H.id)};return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"odc-topbar-green"}),o.jsx("div",{className:"odc-topbar-blue",children:"Agenda"}),o.jsx("section",{className:"odc-agenda-root",children:o.jsxs("div",{className:"odc-agenda-inner",children:[o.jsxs("aside",{className:"odc-left","aria-label":"Panel izquierdo - calendario y filtros",children:[o.jsxs("div",{className:"odc-mini-calendar-card",role:"region","aria-label":"Mini calendario",children:[o.jsxs("div",{className:"mini-cal-header",children:[o.jsx("button",{className:"cal-arrow",id:"miniCalPrev","aria-label":"Mes anterior",onClick:V,children:""}),o.jsx("div",{id:"miniCalMonthYear","aria-live":"polite",children:ee}),o.jsx("button",{className:"cal-arrow",id:"miniCalNext","aria-label":"Mes siguiente",onClick:D,children:""})]}),o.jsxs("table",{className:"mini-month-table","aria-hidden":"false",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Lu"}),o.jsx("th",{children:"Ma"}),o.jsx("th",{children:"Mi"}),o.jsx("th",{children:"Ju"}),o.jsx("th",{children:"Vi"}),o.jsx("th",{children:"Sa"}),o.jsx("th",{children:"Do"})]})}),o.jsx("tbody",{id:"miniCalendar",children:R.map((H,me)=>o.jsx("tr",{children:H.map((_e,J)=>o.jsx("td",{className:[_e.isCurrentMonth?"":"empty",_e.isToday?"today":"",_e.isSelected?"selected":""].filter(Boolean).join(" "),onClick:()=>_e.isCurrentMonth&&O(_e.date),children:_e.date.getDate()},J))},me))})]})]}),o.jsxs("div",{className:"odc-filters-card","aria-label":"Filtros de agenda",children:[o.jsx("label",{htmlFor:"filterSucursal",children:"Sucursal"}),o.jsxs("select",{id:"filterSucursal",value:f,onChange:H=>m(H.target.value),children:[o.jsx("option",{value:"",children:" Todas "}),g.map(H=>o.jsx("option",{value:H,children:H},H))]}),o.jsx("label",{htmlFor:"filterDoctor",children:"Doctores"}),o.jsxs("select",{id:"filterDoctor",value:_,onChange:H=>C(H.target.value),children:[o.jsx("option",{value:"",children:" Todos "}),v.map(H=>o.jsx("option",{value:H,children:H},H))]})]})]}),o.jsxs("main",{className:"odc-right","aria-label":"Panel principal - agenda",children:[o.jsxs("div",{className:"odc-header-bar",role:"region","aria-label":"Controles de la agenda",style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[o.jsxs("div",{className:"odc-header-left",style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[o.jsx("h3",{className:"odc-title",style:{marginRight:8},children:"Agenda"}),o.jsxs("div",{className:"view-buttons",role:"tablist","aria-label":"Vistas",style:{display:"flex",gap:6},children:[o.jsx("button",{className:`btn view ${e==="day"?"active":""}`,"data-view":"day",role:"tab","aria-selected":e==="day",onClick:()=>n("day"),children:"Da"}),o.jsx("button",{className:`btn view ${e==="week"?"active":""}`,"data-view":"week",role:"tab","aria-selected":e==="week",onClick:()=>n("week"),children:"Semana"}),o.jsx("button",{className:`btn view ${e==="detail"?"active":""}`,"data-view":"detail",role:"tab","aria-selected":e==="detail",onClick:()=>n("detail"),children:"Detalle"})]}),o.jsxs("div",{className:"date-nav",style:{display:"flex",alignItems:"center",gap:6,flex:"0 0 auto"},children:[o.jsx("button",{className:"btn icon",id:"btnPrev","aria-label":"Anterior",onClick:He,children:""}),o.jsx("button",{className:"btn icon",id:"btnNext","aria-label":"Siguiente",onClick:X,children:""}),o.jsx("span",{id:"currentDateDisplay",className:"current-date","aria-live":"polite",style:{whiteSpace:"nowrap"},children:ye}),o.jsx("button",{id:"btnHoy",className:"btn small",onClick:te,children:"Hoy"})]})]}),o.jsx("div",{className:"odc-header-right",style:{display:"flex",alignItems:"center",gap:8,flexShrink:0},children:o.jsxs("div",{className:"right-actions",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{id:"searchCitas",placeholder:"Buscar...",className:"search-input","aria-label":"Buscar citas",value:N,onChange:H=>A(H.target.value)}),o.jsx("button",{id:"btnNuevaCita",className:"btn green","aria-label":"Nueva cita",onClick:mt,children:"+ Nueva cita"})]})})]}),o.jsxs("div",{className:"odc-content-card",role:"region","aria-label":"Contenido agenda",children:[o.jsxs("div",{className:"tools-row",children:[o.jsx("div",{className:"tools-left",children:o.jsx("div",{id:"ocupacionInfo",className:"ocupacion-info",children:k})}),o.jsxs("div",{className:"tools-right",children:[o.jsx("button",{id:"btnPrint",className:"btn",title:"Imprimir agenda",onClick:de,children:" Imprimir"}),o.jsx("button",{id:"btnConfirmar",className:"btn blue",title:"Confirmar citas",onClick:ne,children:" Confirmar"}),o.jsx("button",{id:"btnHoyCitas",className:"btn",title:"Ver citas de hoy",onClick:he,children:" Hoy"}),o.jsx("button",{id:"btnExportar",className:"btn",title:"Exportar citas a CSV",onClick:Ce,children:" Exportar"})]})]}),o.jsx("div",{className:"table-wrap",role:"region","aria-label":"Lista de citas",children:o.jsxs("table",{className:"appointments-table","aria-live":"polite",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:"180px"},children:"Fecha / Hora"}),o.jsx("th",{children:"Paciente"}),o.jsx("th",{children:"Doctor"}),o.jsx("th",{children:"Espacio fsico"}),o.jsx("th",{children:"Comentario"}),o.jsx("th",{style:{width:"120px"},children:"Estado"}),o.jsx("th",{children:"Acciones"})]})}),o.jsx("tbody",{id:"citasTbody",children:l?o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"no-data",children:"Cargando citas..."})}):b.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"no-data",children:"No hay citas registradas para este rango."})}):b.map(Gt)})]})})]})]})]})})]})}function aU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function lU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function cU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}const id={caja:"caja",pagos:"facturacion/pagos",facturas:"facturacion/facturas"};var X0;const Zl=typeof navigator<"u"&&((X0=navigator.language)!=null&&X0.startsWith("es"))?"es-ES":"en-US",uU=["Colombia","Argentina","Bolivia","Chile","Costa Rica","Cuba","Ecuador","El Salvador","Espaa","Guatemala","Honduras","Mxico","Nicaragua","Panam","Paraguay","Per","Puerto Rico","Repblica Dominicana","Uruguay","Venezuela","Estados Unidos","Canad"],Zp={Colombia:["Bogot","Medelln","Cali","Barranquilla","Cartagena","Ccuta","Bucaramanga","Pereira","Santa Marta","Ibagu"],Mxico:["Ciudad de Mxico","Guadalajara","Monterrey","Puebla","Quertaro","Tijuana","Mrida","Len"],Per:["Lima","Arequipa","Trujillo","Chiclayo","Cusco","Piura"],Chile:["Santiago","Valparaso","Concepcin","La Serena","Antofagasta"],Argentina:["Buenos Aires","Crdoba","Rosario","Mendoza","La Plata"],Espaa:["Madrid","Barcelona","Valencia","Sevilla","Zaragoza","Bilbao"],"Estados Unidos":["Miami","New York","Los ngeles","Houston","Chicago"],Ecuador:["Quito","Guayaquil","Cuenca","Manta"],Venezuela:["Caracas","Maracaibo","Valencia","Barquisimeto","Maracay"]},dU=t=>{if(!t)return"";const[e,n,r]=t.split("-").map(c=>parseInt(c,10)),s=new Date(e,(n||1)-1,r||1),i=new Date;let a=i.getFullYear()-s.getFullYear();const l=i.getMonth()-s.getMonth();return(l<0||l===0&&i.getDate()<s.getDate())&&a--,isNaN(a)?"":String(a)};async function F0(t,{maxW:e=900,maxH:n=900,quality:r=.82}={}){var m;if(!t||!((m=t.type)!=null&&m.startsWith("image/")))return t;const s=await new Promise((_,C)=>{const N=new Image;N.onload=()=>_(N),N.onerror=C,N.src=URL.createObjectURL(t)});let{width:i,height:a}=s;const l=Math.min(e/i,n/a,1);i=Math.round(i*l),a=Math.round(a*l);const c=document.createElement("canvas");c.width=i,c.height=a,c.getContext("2d").drawImage(s,0,0,i,a);const h=await new Promise(_=>c.toBlob(_,"image/jpeg",r)),f=new File([h],(t.name||"foto.jpg").replace(/\.[^.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});return URL.revokeObjectURL(s.src),f}const ec=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),hU=t=>ec([t.nombres,t.apellidos,t.nombreCompleto,t.nroDocumento,t.celular,t.email].filter(Boolean).join(" ")),fU=t=>{if(!t)return"";const e=new Date(t),n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${n}-${r}-${s}T${i}:${a}`},pU=t=>{try{return new Date(t).toLocaleString(Zl,{dateStyle:"medium",timeStyle:"short"})}catch{return""}},Xo={tipoDocumento:"",nroDocumento:"",nroHistoria:"",nombres:"",apellidos:"",nombreCompleto:"",sexo:"",estadoCivil:"",paisNacimiento:"",ciudadNacimiento:"",fechaIngreso:"",fechaNacimiento:"",edad:"",paisDomicilio:"",ciudadDomicilio:"",barrio:"",lugarResidencia:"",estrato:"",zonaResidencial:"",esExtranjero:!1,permitePublicidad:!1,celular:"",telDomicilio:"",telOficina:"",extension:"",email:"",ocupacion:"",nombreResponsable:"",parentesco:"",celularResponsable:"",telefonoResponsable:"",emailResponsable:"",nombreAcompanante:"",telefonoAcompanante:"",convenioBeneficio:"",comoConocio:"",campania:"",remitidoPor:"",asesorComercial:"",tipoVinculacion:"",nombreEps:"",polizaSalud:"",doctor:"",notas:"",rxImagenes:[],historiaClinica:{antecedentes:"",alergias:"",medicamentos:"",motivoConsulta:"",notas:""},odontograma:[],periodontograma:[],presupuestos:[],evoluciones:[],facturacion:{saldoFavor:0,saldoCredito:0},fotoUrl:"",activo:!0},em=20,Jo=t=>Number(t||0);function mU(t){const[e,n]=x.useState(!1),[r,s]=x.useState([]),[i,a]=x.useState([]),[l,c]=x.useState("");x.useEffect(()=>{let A=!0;return(async()=>{if(!t){s([]),a([]);return}n(!0),c("");try{let I=Ve(ce(Q,"facturas"),Ze("patientId","==",t),pt("fechaISO","desc"));const S=(await Ne(I)).docs.map(k=>({id:k.id,...k.data()})).map(k=>({...k,total:Jo(k.total??k.valor??k.montoTotal),estado:(k.estado||"pendiente").toLowerCase(),fechaISO:k.fechaISO||k.fecha||null}));let M=Ve(ce(Q,"pagos"),Ze("patientId","==",t),pt("fechaISO","desc"));const b=(await Ne(M)).docs.map(k=>({id:k.id,...k.data()})).map(k=>({...k,monto:Jo(k.monto??k.valor??k.total),fechaISO:k.fechaISO||k.fecha||null,medio:k.medio||k.metodo||""}));if(!A)return;s(S),a(b)}catch(I){console.warn("Finanzas: no se pudo leer colecciones. Contino solo con saldos del paciente.",I),A&&c("No se pudieron leer facturas/pagos.")}finally{A&&n(!1)}})(),()=>{A=!1}},[t]);const d=r.reduce((A,T)=>A+Jo(T.total),0),h=i.reduce((A,T)=>A+Jo(T.monto),0),f=r.filter(A=>["pagada","pagado","paid"].includes((A.estado||"").toLowerCase())),m=r.filter(A=>["pendiente","abierta","open","deuda"].includes((A.estado||"").toLowerCase())),_=f.reduce((A,T)=>A+Jo(T.total),0),C=m.reduce((A,T)=>A+Jo(T.total),0);return{loading:e,error:l,facturas:r,pagos:i,totalFacturado:d,totalPagado:h,totalFacturasPendientes:C,totalFacturasPagadas:_}}function gU(t){const[e,n]=x.useState(!1),[r,s]=x.useState([]);return x.useEffect(()=>{if(!t){s([]);return}n(!0);const i=ce(Q,"citas"),a=_=>{const C=_.data()||{},N=typeof C.fecha=="string"?C.fecha:"",A=(C.horaInicio||C.hora||"00:00").slice(0,5);let T=null;if(N){const[I,E,w]=N.split("-").map(v=>parseInt(v,10)),[S,M]=A.split(":").map(v=>parseInt(v,10)||0);T=new Date(I,(E||1)-1,w||1,S,M,0,0).toISOString()}return{id:_.id,...C,fechaISO:T,motivo:C.motivo||C.comentario||"",profesional:C.doctor||C.doctorNombre||"",fechaYYYYMMDD:N}};let l=new Map;const c=()=>{const _=Array.from(l.values());_.sort((C,N)=>{const A=C.fechaISO||"",T=N.fechaISO||"";if(A<T)return 1;if(A>T)return-1;const I=C.creado||"",E=N.creado||"";return I<E?1:I>E?-1:0}),s(_),n(!1)},d=Ve(i,Ze("pacienteId","==",t)),h=Ve(i,Ze("patientId","==",t)),f=ln(d,_=>{_.docChanges().forEach(C=>{C.type==="removed"?l.delete(C.doc.id):l.set(C.doc.id,a(C.doc))}),c()},()=>n(!1)),m=ln(h,_=>{_.docChanges().forEach(C=>{C.type==="removed"?l.delete(C.doc.id):l.set(C.doc.id,a(C.doc))}),c()},()=>n(!1));return()=>{try{f()}catch{}try{m()}catch{}}},[t]),{loading:e,citas:r}}function yU(){var Ht,lt,un,gn,yn,Er,pl,ls,Oi;const t=as(),e=Fn(),n=Uh.useMemo(()=>{const j=e.pathname.split("/").filter(Boolean),W=j.findIndex(Se=>["pacientes","agenda","caja","facturacion","config","reportes","software"].includes(Se)),xe="/"+j.slice(0,W>=0?W:j.length).join("/");return xe==="/"?"":xe},[e.pathname]),r=j=>{const W=String(j||"").replace(/^\//,""),ie=n?`${n}/`:"/";t(`${ie}${W}`)},s=(j,W)=>{const ie=String(j).replace(/^\//,""),xe=W?new URLSearchParams(W).toString():"";return`${n?`${n}/`:"/"}${ie}${xe?`?${xe}`:""}`},i=(j,W)=>{const ie=String(j||"").slice(0,10);if(!ie)return r("agenda");try{sessionStorage.setItem("agenda.targetDate",ie)}catch{}const xe=new URLSearchParams({date:ie,day:ie,d:ie,fecha:ie,selectedDate:ie,ts:String(new Date(ie+"T00:00:00").getTime()),patientId:W||""}).toString();r(`agenda?${xe}`)},[a,l]=x.useState(!0),[c,d]=x.useState([]),[h,f]=x.useState(""),[m,_]=x.useState(null),[C,N]=x.useState(!0),[A,T]=x.useState(!1),[I,E]=x.useState(null),[w,S]=x.useState(null),M=x.useRef(null),[g,v]=x.useState("datos"),[b,k]=x.useState(Xo),[R,V]=x.useState(null),[D,O]=x.useState(""),[ee,ye]=x.useState([]),[He,X]=x.useState(!1),te=x.useRef(null),de="comfy",[ne,he]=x.useState(""),Ce=x.useMemo(()=>{switch(de){case"comfy":return{thumbW:220,thumbH:165,colMin:240};case"cozy":return{thumbW:160,thumbH:120,colMin:180};default:return{thumbW:120,thumbH:90,colMin:140}}},[de]),Ue=j=>{var ie,xe;if((xe=(ie=j==null?void 0:j.type)==null?void 0:ie.startsWith)!=null&&xe.call(ie,"image/"))return!0;const W=((j==null?void 0:j.name)||(j==null?void 0:j.title)||"").toLowerCase();return/\.(png|jpe?g|gif|bmp|webp|tiff?)$/.test(W)},$e=x.useMemo(()=>{const j=ne.trim().toLowerCase(),W=Array.isArray(w==null?void 0:w.rxImagenes)?w.rxImagenes:[];let ie=W;return j?ie=W.filter(xe=>`${xe.name||""} ${xe.title||""} ${xe.desc||""}`.toLowerCase().includes(j)):ie=W.slice(),ie.sort((xe,Se)=>{const qe=xe.uploadedAtMS??xe.created??0;return(Se.uploadedAtMS??Se.created??0)-qe}),ie},[w==null?void 0:w.rxImagenes,ne]),Ke=async(j,W)=>{if(!(w!=null&&w.id))return;const ie=Array.isArray(w.rxImagenes)?[...w.rxImagenes]:[];ie[j]={...ie[j]||{},...W},await L({rxImagenes:ie})},mt=()=>{const j=new Date,W=j.getFullYear(),ie=String(j.getMonth()+1).padStart(2,"0"),xe=String(j.getDate()).padStart(2,"0");return`${W}-${ie}-${xe}`},[gt,Gt]=x.useState(mt()),[H,me]=x.useState(""),[_e,J]=x.useState(""),[Z,Ie]=x.useState(""),[ve,K]=x.useState("");x.useEffect(()=>{J((w==null?void 0:w.doctor)||"")},[w==null?void 0:w.doctor,w==null?void 0:w.id]);const Y=async()=>{if(!(w!=null&&w.id))return alert("Paciente no cargado.");if(!gt)return alert("Selecciona la fecha.");if(!H)return alert("Selecciona la hora.");if(!_e.trim())return alert("Indica el doctor.");const j=w.nombreCompleto||w.paciente||"Paciente",W=w.celular||w.celularPaciente||"",ie=w.telDomicilio||w.telefonoPaciente||"";if(!W&&!ie)return alert("Este paciente no tiene telfono registrado (celular o fijo). Agrega uno antes de crear la cita.");try{const xe={paciente:j,pacienteId:w.id,doctor:_e.trim(),fecha:gt,horaInicio:H,espacio:Z||"",comentario:ve||"",estado:"En espera",creado:new Date().toISOString(),celularPaciente:W,telefonoPaciente:ie};await Bt(ce(Q,"citas"),xe),me(""),Ie(""),K(""),alert(" Cita creada. Ya aparece en la lista y en Agenda.")}catch(xe){console.error("Error creando cita:",xe),alert("No se pudo crear la cita.")}};x.useMemo(()=>Zp[b.paisNacimiento]||[],[b.paisNacimiento]),x.useEffect(()=>((async()=>{l(!0);try{const ie=(await Ne(ce(Q,"eps"))).docs.map(Se=>{var qe;return(qe=Se.data())==null?void 0:qe.nombre}).filter(Boolean),xe=Array.from(new Map(ie.map(Se=>[String(Se).toLowerCase(),Se])).values()).sort((Se,qe)=>Se.localeCompare(qe,"es"));ye(xe),await Be(!0)}catch(W){console.error(W),alert("No se pudieron cargar pacientes/EPS.")}finally{l(!1)}})(),()=>{M.current&&(M.current(),M.current=null)}),[]),x.useEffect(()=>{k(j=>({...j,nombreCompleto:`${j.nombres} ${j.apellidos}`.trim()}))},[b.nombres,b.apellidos]),x.useEffect(()=>{k(j=>({...j,nroHistoria:j.nroDocumento}))},[b.nroDocumento]),x.useEffect(()=>{k(j=>({...j,edad:dU(j.fechaNacimiento)}))},[b.fechaNacimiento]),x.useEffect(()=>{const j=new Date,W=j.toLocaleDateString(Zl)+" - "+j.toLocaleTimeString(Zl,{hour:"2-digit",minute:"2-digit",hour12:!0});k(ie=>({...ie,fechaIngreso:W}))},[]);const B=(j,W)=>k(ie=>({...ie,[j]:W})),ge=()=>{k(Xo);const j=new Date,W=j.toLocaleDateString(Zl)+" - "+j.toLocaleTimeString(Zl,{hour:"2-digit",minute:"2-digit",hour12:!0});k(ie=>({...ie,fechaIngreso:W})),V(null),O(""),E(null)},De=async j=>{if(!j){V(null),O("");return}try{const W=await F0(j,{maxW:900,maxH:900,quality:.82});V(W);const ie=new FileReader;ie.onload=xe=>O(xe.target.result),ie.readAsDataURL(W)}catch{V(j);const W=new FileReader;W.onload=ie=>O(ie.target.result),W.readAsDataURL(j)}},Be=async(j=!1)=>{l(!0);try{let W;j||!m?W=Ve(ce(Q,"pacientes"),pt("creado","desc"),Ra(em)):W=Ve(ce(Q,"pacientes"),pt("creado","desc"),cF(m),Ra(em));const ie=await Ne(W),xe=ie.docs.map(Se=>({id:Se.id,...Se.data()}));d(j?xe:Se=>[...Se,...xe]),_(ie.docs[ie.docs.length-1]||null),N(ie.size===em)}catch(W){console.error(W),alert("No se pudo cargar pacientes.")}finally{l(!1)}},Le=async j=>{if(j.preventDefault(),!b.nroDocumento.trim())return alert("El nmero de documento es obligatorio.");if(!b.nombres.trim())return alert("Los nombres son obligatorios.");if(!b.apellidos.trim())return alert("Los apellidos son obligatorios.");if(!b.sexo.trim())return alert("El sexo es obligatorio.");if(!b.fechaNacimiento.trim())return alert("La fecha de nacimiento es obligatoria.");if(!b.celular.trim())return alert("El celular es obligatorio.");if(!b.email.trim())return alert("El correo electrnico es obligatorio.");if(!b.tipoVinculacion.trim())return alert("El tipo de vinculacin es obligatorio.");if(!b.nombreEps.trim())return alert("El nombre de la EPS es obligatorio.");try{const W=b.nroDocumento.trim();if(!I&&(await No(Re(Q,"pacientes",W))).exists())return alert("Ya existe un paciente con ese nmero de documento.");const ie=(b.nombreEps||"").trim(),xe=ee.map(St=>St.toLowerCase()).includes(ie.toLowerCase());if(ie&&!xe&&window.confirm(`La EPS "${ie}" no existe. Deseas guardarla para futuras selecciones?`)){const At=ie.toLowerCase().replace(/\s+/g,"_");await jo(Re(Q,"eps",At),{nombre:ie,nombreLower:ie.toLowerCase(),creado:Rt()},{merge:!0})}let Se=b.fotoUrl||"",qe="";if(R)try{const St=Xi(),At=(R.name||"foto.jpg").replace(/\s+/g,"_");qe=`pacientes/${W}/${Date.now()}_${At}`;const $n=Fl(St,qe),Ir={contentType:R.type||"image/jpeg",cacheControl:"public, max-age=86400"};await b0($n,R,Ir),Se=await E0($n)}catch(St){console.error("Foto (warning):",St)}const bt=b.creado||null,Un=I&&bt||Rt(),jn={...b,fotoUrl:Se,nombre_busqueda:hU({...b,fotoUrl:Se}),nombresLower:ec(b.nombres),apellidosLower:ec(b.apellidos),documentoLower:ec(b.nroDocumento),emailLower:ec(b.email),creado:Un,createdAt:Un,actualizado:Rt(),updatedAt:Rt(),activo:b.activo??!0,celularPaciente:b.celular,telefonoPaciente:b.telDomicilio||"",documento:b.nroDocumento,paciente:b.nombreCompleto};if(await jo(Re(Q,"pacientes",W),jn,{merge:!0}),qe)try{const St=Xi(),At=Fl(St,`pacientes/${W}`),$n=await w0(At),Ir=qe,cs=$n.items.filter(us=>us.fullPath!==Ir).map(us=>Wp(us).catch(()=>null));await Promise.allSettled(cs)}catch(St){console.warn("No se pudo limpiar fotos antiguas:",St)}alert(I?" Paciente actualizado.":" Paciente guardado."),d(St=>{const At=St.filter($n=>$n.id!==W);return[{id:W,...jn},...At]}),T(!1),E(null),ge()}catch(W){console.error("Error guardando paciente:",W),alert(`No se pudo guardar el paciente.

`+((W==null?void 0:W.message)||W))}},We=()=>{ge(),T(!0)},be=()=>{w&&(k({...Xo,...w,fotoUrl:w.fotoUrl||""}),V(null),O(w.fotoUrl||""),E(w.id),z(),T(!0))},rt=async j=>{if(window.confirm(`Eliminar al paciente "${j.nombreCompleto}"?`))try{await Cn(Re(Q,"pacientes",j.id)),d(W=>W.filter(ie=>ie.id!==j.id));try{const W=Xi(),ie=Fl(W,`pacientes/${j.id}`),Se=(await w0(ie)).items.map(qe=>Wp(qe).catch(()=>null));await Promise.allSettled(Se)}catch(W){console.warn("No se pudo borrar la carpeta de fotos:",W)}}catch(W){console.error(W),alert("No se pudo eliminar.")}},Xe=x.useMemo(()=>{const j=h.trim().toLowerCase();return j?c.filter(W=>`${W.nombreCompleto||W.paciente||""} ${W.nroDocumento||""} ${W.celular||W.celularPaciente||""} ${W.email||""}`.toLowerCase().includes(j)):c},[c,h]),xt=j=>{z();const W=Re(Q,"pacientes",j.id),ie=ln(W,xe=>{xe.exists()?S({id:xe.id,...le(xe.data())}):S(null)});M.current=ie,v("datos")},z=()=>{M.current&&(M.current(),M.current=null),S(null)},le=j=>({...Xo,...j,historiaClinica:{...Xo.historiaClinica,...j.historiaClinica||{}},facturacion:{...Xo.facturacion,...j.facturacion||{}},rxImagenes:Array.isArray(j.rxImagenes)?j.rxImagenes:[],odontograma:Array.isArray(j.odontograma)?j.odontograma:[],periodontograma:Array.isArray(j.periodontograma)?j.periodontograma:[],presupuestos:Array.isArray(j.presupuestos)?j.presupuestos:[],evoluciones:Array.isArray(j.evoluciones)?j.evoluciones:[]}),L=async j=>{if(w!=null&&w.id)try{await Ut(Re(Q,"pacientes",w.id),{...j,actualizado:Rt(),updatedAt:Rt()})}catch(W){console.error(W),alert("No se pudo actualizar.")}},F=async j=>{var ie;if(!(w!=null&&w.id)||!(j!=null&&j.length))return;const W=Xi();try{X(!0);const xe=[];for(const Se of j){let qe=Se;if((ie=Se.type)!=null&&ie.startsWith("image/"))try{qe=await F0(Se,{maxW:1600,maxH:1600,quality:.85})}catch{qe=Se}const bt=(qe.name||"archivo").replace(/\s+/g,"_"),Un=`pacientes/${w.id}/rx/${Date.now()}_${bt}`,jn=Fl(W,Un),St={contentType:qe.type||"application/octet-stream",cacheControl:"public, max-age=31536000"};await b0(jn,qe,St);const At=await E0(jn),$n=new Date().toISOString(),Ir=Date.now();xe.push({url:At,name:Se.name,title:Se.name.replace(/\.[^.]+$/,""),desc:"",type:Se.type,size:Se.size||0,created:Ir,uploadedAtMS:Ir,uploadedAtISO:$n,path:Un})}await L({rxImagenes:[...w.rxImagenes||[],...xe]})}catch(xe){console.error("RX upload error:",xe);const Se=`No se pudo subir el/los archivo(s).
 Verifica que el usuario est autenticado.
 Revisa reglas de Storage para permitir escribir en 'pacientes/{id}/**'.
 Si usas Emulador, confirma que el bucket coincida.

`+((xe==null?void 0:xe.message)||"");alert(Se)}finally{X(!1);try{te.current&&(te.current.value="")}catch{}}},re=async j=>{if(!(w!=null&&w.id))return;const W=w.rxImagenes[j],ie=w.rxImagenes.filter((xe,Se)=>Se!==j);await L({rxImagenes:ie});try{if(W!=null&&W.path){const xe=Xi();await Wp(Fl(xe,W.path))}}catch(xe){console.warn("No se pudo borrar del Storage:",xe)}},ue=(j,W)=>{const ie={...w.historiaClinica||{},[j]:W};L({historiaClinica:ie})},Ae=j=>{const W=[...w.presupuestos||[],{id:String(Date.now()),...j}];L({presupuestos:W})},Pe=j=>{L({presupuestos:(w.presupuestos||[]).filter(W=>W.id!==j)})},Fe=j=>{const W=[...w.evoluciones||[],{id:String(Date.now()),fechaISO:new Date().toISOString(),nota:j}];L({evoluciones:W})},Oe=j=>{L({evoluciones:(w.evoluciones||[]).filter(W=>W.id!==j)})},nt=(j,W)=>{const ie=Array.isArray(w[j])?w[j]:[],xe=ie.find(qe=>qe.pieza===W);let Se;xe?Se=ie.filter(qe=>qe.pieza!==W):Se=[...ie,{pieza:W,estado:"marcada"}],L({[j]:Se})},ct=(w==null?void 0:w.id)||null,Ot=mU(ct),{loading:Ge,citas:Qn}=gU(ct);return o.jsxs("div",{className:"odc-container",children:[o.jsx("div",{className:"odc-topbar-green"}),o.jsx("div",{className:"odc-topbar-blue",children:o.jsx("div",{className:"odc-top-inner",children:o.jsx("div",{className:"odc-breadcrumbs",children:"Pacientes"})})}),o.jsxs("div",{className:"odc-card",children:[o.jsxs("div",{className:"odc-card-header",children:[o.jsx("h3",{className:"odc-title",children:"Pacientes"}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[o.jsx("input",{className:"search-input",style:{minWidth:280},placeholder:"Buscar por nombre, documento o telfono",value:h,onChange:j=>f(j.target.value)}),o.jsx("button",{type:"button",className:"btn green",onClick:We,children:"+ Nuevo paciente"})]})]}),o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Foto"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Documento"}),o.jsx("th",{children:"Celular"}),o.jsx("th",{children:"Correo"}),o.jsx("th",{children:"Estado"})]})}),o.jsx("tbody",{children:a&&c.length===0?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:6,children:"Cargando"})}):Xe.length===0?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:6,children:"No hay pacientes o no coinciden con la bsqueda."})}):Xe.map(j=>o.jsxs("tr",{className:"row-click",onClick:()=>xt(j),children:[o.jsx("td",{onClick:W=>W.stopPropagation(),children:j.fotoUrl?o.jsx("img",{src:j.fotoUrl,alt:"Foto",style:{width:36,height:36,borderRadius:"50%",objectFit:"cover"}}):o.jsx("div",{className:"avatar-fallback",children:(j.nombreCompleto||"P")[0]})}),o.jsx("td",{children:j.nombreCompleto||j.paciente||""}),o.jsx("td",{children:j.nroDocumento||j.documento||""}),o.jsx("td",{children:j.celular||j.celularPaciente||""}),o.jsx("td",{children:j.email||""}),o.jsx("td",{children:o.jsx("span",{className:"pill pill-ok",children:j.activo?"Activo":"Inactivo"})})]},j.id))})]})}),o.jsxs("div",{className:"footer-actions",children:[o.jsx("button",{type:"button",className:"btn",disabled:a||!C,onClick:()=>Be(!1),children:C?"Cargar ms":"No hay ms"}),o.jsxs("div",{className:"hint",children:[c.length," registros cargados"]})]})]}),A&&o.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[o.jsx("div",{className:"odc-modal-backdrop",onClick:()=>T(!1)}),o.jsxs("div",{className:"odc-card",style:{width:1e3,maxWidth:"95%",maxHeight:"92vh",overflowY:"auto"},children:[o.jsxs("div",{className:"odc-card-header",children:[o.jsx("h3",{className:"odc-title",children:I?"Editar paciente":"Nuevo paciente"}),o.jsx("button",{type:"button",className:"btn",onClick:()=>T(!1),children:""})]}),o.jsxs("form",{onSubmit:Le,children:[o.jsx("div",{className:"form-section-title",children:"Foto del paciente"}),o.jsxs("div",{className:"foto-row",children:[o.jsxs("label",{className:"foto-drop",children:[o.jsx("input",{type:"file",accept:"image/*",onChange:j=>{var W;return De(((W=j.target.files)==null?void 0:W[0])||null)},style:{display:"none"}}),D?o.jsx("img",{src:D,alt:"Preview",className:"foto-preview"}):o.jsx("div",{className:"foto-empty",children:"Arrastra o haz clic para cargar"})]}),D&&o.jsx("button",{type:"button",className:"btn",onClick:()=>De(null),children:"Quitar foto"})]}),o.jsx("div",{className:"form-section-title",children:"Datos de identificacin"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Tipo de documento *"}),o.jsxs("select",{className:"form-input",value:b.tipoDocumento,onChange:j=>B("tipoDocumento",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{value:"CC",children:"Cdula"}),o.jsx("option",{value:"TI",children:"Tarjeta de identidad"}),o.jsx("option",{value:"PA",children:"Pasaporte"}),o.jsx("option",{value:"OTRO",children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nro. de documento *"}),o.jsx("input",{className:"form-input",value:b.nroDocumento,onChange:j=>B("nroDocumento",j.target.value),placeholder:"Nmero de documento",required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nmero de Historia"}),o.jsx("input",{className:"form-input",value:b.nroHistoria,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombres *"}),o.jsx("input",{className:"form-input",value:b.nombres,onChange:j=>B("nombres",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Apellidos *"}),o.jsx("input",{className:"form-input",value:b.apellidos,onChange:j=>B("apellidos",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombre completo"}),o.jsx("input",{className:"form-input",value:b.nombreCompleto,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Sexo *"}),o.jsxs("select",{className:"form-input",value:b.sexo,onChange:j=>B("sexo",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Masculino"}),o.jsx("option",{children:"Femenino"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Estado civil *"}),o.jsxs("select",{className:"form-input",value:b.estadoCivil,onChange:j=>B("estadoCivil",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Soltero"}),o.jsx("option",{children:"Casado"}),o.jsx("option",{children:"Unin libre"}),o.jsx("option",{children:"Divorciado"}),o.jsx("option",{children:"Viudo"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Pas de nacimiento *"}),o.jsx("input",{className:"form-input",list:"listCountries",value:b.paisNacimiento,onChange:j=>B("paisNacimiento",j.target.value),placeholder:"Escribe y elige",required:!0}),o.jsx("datalist",{id:"listCountries",children:uU.map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Ciudad de nacimiento"}),o.jsx("input",{className:"form-input",list:"listCitiesBirth",value:b.ciudadNacimiento,onChange:j=>B("ciudadNacimiento",j.target.value),placeholder:"Escribe y elige"}),o.jsx("datalist",{id:"listCitiesBirth",children:(Zp[b.paisNacimiento]||[]).map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Fecha de ingreso"}),o.jsx("input",{className:"form-input",value:b.fechaIngreso,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Fecha de nacimiento *"}),o.jsx("input",{type:"date",className:"form-input",value:b.fechaNacimiento,onChange:j=>B("fechaNacimiento",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Edad"}),o.jsx("input",{className:"form-input",value:b.edad,readOnly:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Pas de domicilio *"}),o.jsx("input",{className:"form-input",list:"listCountries",value:b.paisDomicilio,onChange:j=>B("paisDomicilio",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Ciudad de domicilio *"}),o.jsx("input",{className:"form-input",list:"listCitiesHome",value:b.ciudadDomicilio,onChange:j=>B("ciudadDomicilio",j.target.value),required:!0}),o.jsx("datalist",{id:"listCitiesHome",children:(Zp[b.paisDomicilio]||[]).map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Barrio *"}),o.jsx("input",{className:"form-input",value:b.barrio,onChange:j=>B("barrio",j.target.value),required:!0,placeholder:"Barrio"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Lugar de residencia *"}),o.jsx("input",{className:"form-input",value:b.lugarResidencia,onChange:j=>B("lugarResidencia",j.target.value),required:!0})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Estrato"}),o.jsxs("select",{className:"form-input",value:b.estrato,onChange:j=>B("estrato",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"1"}),o.jsx("option",{children:"2"}),o.jsx("option",{children:"3"}),o.jsx("option",{children:"4"}),o.jsx("option",{children:"5"}),o.jsx("option",{children:"6"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Zona residencial *"}),o.jsxs("select",{className:"form-input",value:b.zonaResidencial,onChange:j=>B("zonaResidencial",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Urbana"}),o.jsx("option",{children:"Rural"})]})]}),o.jsxs("div",{className:"checkbox-cell",children:[o.jsx("label",{className:"form-label",children:"Es extranjero?"}),o.jsx("input",{type:"checkbox",checked:b.esExtranjero,onChange:j=>B("esExtranjero",j.target.checked)})]}),o.jsxs("div",{className:"checkbox-cell",children:[o.jsx("label",{className:"form-label",children:"Permite publicidad?"}),o.jsx("input",{type:"checkbox",checked:b.permitePublicidad,onChange:j=>B("permitePublicidad",j.target.checked)})]})]}),o.jsx("div",{className:"form-section-title",children:"Contacto"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Celular *"}),o.jsx("input",{className:"form-input",value:b.celular,onChange:j=>B("celular",j.target.value),required:!0,placeholder:"Celular del paciente"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono de domicilio"}),o.jsx("input",{className:"form-input",value:b.telDomicilio,onChange:j=>B("telDomicilio",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono de oficina"}),o.jsx("input",{className:"form-input",value:b.telOficina,onChange:j=>B("telOficina",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Extensin"}),o.jsx("input",{className:"form-input",value:b.extension,onChange:j=>B("extension",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Correo electrnico *"}),o.jsx("input",{type:"email",className:"form-input",value:b.email,onChange:j=>B("email",j.target.value),required:!0,placeholder:"correo@dominio.com"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Ocupacin *"}),o.jsx("input",{className:"form-input",value:b.ocupacion,onChange:j=>B("ocupacion",j.target.value),required:!0})]})]}),o.jsx("div",{className:"form-section-title",children:"Datos de facturacin"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Responsable"}),o.jsx("input",{className:"form-input",value:b.nombreResponsable,onChange:j=>B("nombreResponsable",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Parentesco"}),o.jsxs("select",{className:"form-input",value:b.parentesco,onChange:j=>B("parentesco",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Padre/Madre"}),o.jsx("option",{children:"Hermano"}),o.jsx("option",{children:"Esposo/a"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Celular"}),o.jsx("input",{className:"form-input",value:b.celularResponsable,onChange:j=>B("celularResponsable",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono"}),o.jsx("input",{className:"form-input",value:b.telefonoResponsable,onChange:j=>B("telefonoResponsable",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Correo electrnico"}),o.jsx("input",{type:"email",className:"form-input",value:b.emailResponsable,onChange:j=>B("emailResponsable",j.target.value)})]})]}),o.jsx("div",{className:"form-section-title",children:"Acompaante"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombre"}),o.jsx("input",{className:"form-input",value:b.nombreAcompanante,onChange:j=>B("nombreAcompanante",j.target.value),placeholder:"Nombre acompaante"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Telfono"}),o.jsx("input",{className:"form-input",value:b.telefonoAcompanante,onChange:j=>B("telefonoAcompanante",j.target.value),placeholder:"Telfono acompaante"})]})]}),o.jsx("div",{className:"form-section-title",children:"Mercadeo"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Convenio beneficio"}),o.jsx("input",{className:"form-input",value:b.convenioBeneficio,onChange:j=>B("convenioBeneficio",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Cmo nos conoci?"}),o.jsxs("select",{className:"form-input",value:b.comoConocio,onChange:j=>B("comoConocio",j.target.value),children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Redes sociales"}),o.jsx("option",{children:"Publicidad"}),o.jsx("option",{children:"Recomendacin"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Campaa"}),o.jsx("input",{className:"form-input",value:b.campania,onChange:j=>B("campania",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Remitido por"}),o.jsx("input",{className:"form-input",value:b.remitidoPor,onChange:j=>B("remitidoPor",j.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Asesor comercial"}),o.jsx("input",{className:"form-input",value:b.asesorComercial,onChange:j=>B("asesorComercial",j.target.value)})]})]}),o.jsx("div",{className:"form-section-title",children:"EPS"}),o.jsxs("div",{className:"form-grid",children:[o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Tipo de vinculacin *"}),o.jsxs("select",{className:"form-input",value:b.tipoVinculacion,onChange:j=>B("tipoVinculacion",j.target.value),required:!0,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Contributivo"}),o.jsx("option",{children:"Subsidiado"}),o.jsx("option",{children:"Particular"}),o.jsx("option",{children:"Otro"})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Nombre de la EPS *"}),o.jsx("input",{className:"form-input",list:"listEps",value:b.nombreEps,onChange:j=>B("nombreEps",j.target.value),placeholder:"Escribe y selecciona",required:!0}),o.jsx("datalist",{id:"listEps",children:ee.map(j=>o.jsx("option",{value:j},j))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Pliza de salud"}),o.jsx("input",{className:"form-input",value:b.polizaSalud,onChange:j=>B("polizaSalud",j.target.value)})]})]}),o.jsx("div",{className:"form-section-title",children:"Doctor"}),o.jsx("div",{className:"form-grid",children:o.jsxs("div",{children:[o.jsx("label",{className:"form-label",children:"Doctor"}),o.jsx("input",{className:"form-input",value:b.doctor,onChange:j=>B("doctor",j.target.value),placeholder:"Usuario / Libre"})]})}),o.jsx("div",{className:"form-section-title",children:"Alertas y Notas"}),o.jsx("div",{className:"form-grid",children:o.jsx("textarea",{className:"form-input",rows:3,value:b.notas,onChange:j=>B("notas",j.target.value),placeholder:"Notas del paciente"})}),o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,marginTop:12},children:[I?o.jsx("button",{type:"button",className:"btn",onClick:()=>rt({id:I,nombreCompleto:b.nombreCompleto}),children:"Eliminar"}):o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{type:"button",className:"btn",onClick:()=>T(!1),children:"Cancelar"}),o.jsx("button",{type:"submit",className:"btn blue",children:I?"Actualizar":"Guardar paciente"})]})]})]})]})]}),w&&o.jsxs("div",{className:"odc-modal",role:"dialog","aria-modal":"true",children:[o.jsx("div",{className:"odc-modal-backdrop",onClick:z}),o.jsxs("div",{className:"odc-card ficha-card",children:[o.jsxs("div",{className:"ficha-header",children:[o.jsxs("div",{className:"ficha-header-left",children:[w.fotoUrl?o.jsx("img",{src:w.fotoUrl,alt:"Foto",className:"ficha-avatar"}):o.jsx("div",{className:"avatar-fallback ficha-avatar-fallback",children:(w.nombreCompleto||"P")[0]}),o.jsxs("div",{children:[o.jsx("div",{className:"ficha-nombre",children:w.nombreCompleto||""}),o.jsxs("div",{className:"ficha-doc",children:[w.tipoDocumento||""," ",w.nroDocumento||""]}),o.jsxs("div",{className:"ficha-badges",children:[o.jsx("span",{className:"ficha-badge blue",children:"En valoracin"}),o.jsx("span",{className:"ficha-badge green",children:"Sin deuda"})]})]})]}),o.jsx("div",{className:"ficha-header-right",children:o.jsxs("div",{className:"ficha-actions",children:[o.jsx("button",{type:"button",className:"btn",onClick:z,children:"Cerrar"}),o.jsx("button",{type:"button",className:"btn blue",onClick:be,children:"Editar"}),o.jsx("button",{type:"button",className:"btn green",onClick:()=>t(s(id.caja,{cobro:1,patientId:w.id})),title:"Ir a Caja para cobrar a este paciente",children:"Cobrar"})]})})]}),o.jsxs("div",{className:"ficha-body",children:[o.jsxs("aside",{className:"ficha-sidebar",children:[o.jsx("div",{className:"ficha-sidebar-title",children:"Informacin general"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="datos"?"active":""}`,onClick:()=>v("datos"),children:"Datos personales"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="marketing"?"active":""}`,onClick:()=>v("marketing"),children:"Marketing"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="eps"?"active":""}`,onClick:()=>v("eps"),children:"EPS"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="prof"?"active":""}`,onClick:()=>v("prof"),children:"Profesionales"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="rx"?"active":""}`,onClick:()=>v("rx"),children:"Rx/Imgenes/Doc"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="citas"?"active":""}`,onClick:()=>v("citas"),children:"Citas"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="crm"?"active":""}`,onClick:()=>v("crm"),children:"CRM"}),o.jsx("div",{className:"ficha-sidebar-title mt",children:"Historia clnica"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="doc"?"active":""}`,onClick:()=>v("doc"),children:"Doc. Clnicos"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="odonto"?"active":""}`,onClick:()=>v("odonto"),children:"Odontogramas"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="perio"?"active":""}`,onClick:()=>v("perio"),children:"Periodontogramas"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="presu"?"active":""}`,onClick:()=>v("presu"),children:"Presupuestos"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="evo"?"active":""}`,onClick:()=>v("evo"),children:"Evoluciones"}),o.jsx("div",{className:"ficha-sidebar-title mt",children:"Facturacin"}),o.jsx("button",{type:"button",className:`ficha-link ${g==="fact"?"active":""}`,onClick:()=>v("fact"),children:"Resumen"}),o.jsxs("div",{className:"ficha-sidebar-actions",style:{display:"grid",gap:8,marginTop:8},children:[o.jsx("button",{type:"button",className:"btn pay",onClick:()=>t(s(id.caja,{cobro:1,patientId:w.id})),title:"Cobrar a este paciente",children:"Realizar pago"}),o.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${id.pagos}?patientId=${encodeURIComponent(w.id)}`),title:"Ver histrico de pagos",children:"Histrico de pagos"}),o.jsx("button",{type:"button",className:"btn history",onClick:()=>r(`${id.facturas}?patientId=${encodeURIComponent(w.id)}`),title:"Ver histrico de facturacin",children:"Histrico de facturacin"})]})]}),o.jsxs("main",{className:"ficha-content",children:[g==="datos"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Datos personales"}),o.jsx("div",{className:"ficha-grid",children:[["Tipo de documento",w.tipoDocumento],["Nro. de documento",w.nroDocumento],["Nmero de Historia",w.nroHistoria],["Fecha de ingreso",w.fechaIngreso],["Nombres",w.nombres],["Apellidos",w.apellidos],["Nombre completo",w.nombreCompleto],["Sexo",w.sexo],["Estado civil",w.estadoCivil],["Pas de nacimiento",w.paisNacimiento],["Ciudad de nacimiento",w.ciudadNacimiento],["Fecha de nacimiento",w.fechaNacimiento],["Edad",w.edad],["Pas de domicilio",w.paisDomicilio],["Ciudad de domicilio",w.ciudadDomicilio],["Barrio",w.barrio],["Lugar de residencia",w.lugarResidencia],["Estrato",w.estrato],["Zona residencial",w.zonaResidencial],["Extranjero",w.esExtranjero?"S":"No"],["Permite publicidad",w.permitePublicidad?"S":"No"],["Celular",w.celular||w.celularPaciente],["Telfono domicilio",w.telDomicilio||w.telefonoPaciente],["Telfono oficina",w.telOficina],["Extensin",w.extension],["Correo electrnico",w.email],["Ocupacin",w.ocupacion],["Responsable",w.nombreResponsable],["Parentesco",w.parentesco],["Cel. responsable",w.celularResponsable],["Tel. responsable",w.telefonoResponsable],["Email responsable",w.emailResponsable],["Acompaante",w.nombreAcompanante],["Tel. acompaante",w.telefonoAcompanante]].map(([j,W])=>o.jsxs("div",{className:"field",children:[o.jsx("label",{children:j}),o.jsx("input",{className:"form-input",value:W||"",readOnly:!0})]},j))})]}),g==="marketing"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Marketing"}),o.jsx("div",{className:"ficha-grid",children:[["Convenio beneficio",w.convenioBeneficio],["Cmo nos conoci?",w.comoConocio],["Campaa",w.campania],["Remitido por",w.remitidoPor],["Asesor comercial",w.asesorComercial]].map(([j,W])=>o.jsxs("div",{className:"field",children:[o.jsx("label",{children:j}),o.jsx("input",{className:"form-input",value:W||"",readOnly:!0})]},j))})]}),g==="eps"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"EPS"}),o.jsx("div",{className:"ficha-grid",children:[["Tipo de vinculacin",w.tipoVinculacion],["Nombre EPS",w.nombreEps],["Pliza de salud",w.polizaSalud]].map(([j,W])=>o.jsxs("div",{className:"field",children:[o.jsx("label",{children:j}),o.jsx("input",{className:"form-input",value:W||"",readOnly:!0})]},j))})]}),g==="prof"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Profesionales"}),o.jsx("div",{className:"ficha-grid",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Doctor"}),o.jsx("input",{className:"form-input",value:w.doctor||"",readOnly:!0})]})})]}),g==="rx"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Rx / Imgenes / Documentos"}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[o.jsxs("label",{className:"btn blue",children:["Subir archivos",o.jsx("input",{ref:te,type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",style:{display:"none"},onChange:j=>F([...j.target.files||[]])})]}),He&&o.jsx("span",{className:"hint",children:"Subiendo"}),o.jsx("div",{style:{marginLeft:"auto",display:"flex",gap:8,alignItems:"center"},children:o.jsx("input",{className:"form-input",style:{width:200},placeholder:"Buscar en Rx",value:ne,onChange:j=>he(j.target.value),title:"Filtra por nombre, ttulo o descripcin"})})]}),o.jsxs("div",{className:"hint",style:{marginTop:6},children:[$e.length," elemento(s)",ne?"  filtrado(s)":"","."]}),o.jsxs("div",{className:"rx-grid",style:{display:"grid",gap:10,marginTop:12,gridTemplateColumns:`repeat(auto-fill, minmax(${Ce.colMin}px, 1fr))`,alignItems:"start"},children:[$e.length===0&&o.jsx("div",{className:"no-data",style:{gridColumn:"1 / -1"},children:ne?"Sin coincidencias.":"Sin archivos an."}),$e.map((j,W)=>{var bt,Un;const ie=Ue(j),xe=j.title||j.name||`archivo-${W}`,Se=((bt=(j.name||"").split(".").pop())==null?void 0:bt.toUpperCase())||((Un=(j.type||"").split("/").pop())==null?void 0:Un.toUpperCase())||"",qe=j.uploadedAtISO||(j.created?new Date(j.created).toISOString():null);return o.jsxs("div",{className:"rx-item mini-card",style:{padding:8,display:"grid",gap:8},title:xe,children:[o.jsx("a",{href:j.url,target:"_blank",rel:"noreferrer",style:{width:"100%",height:Ce.thumbH,borderRadius:8,overflow:"hidden",border:"1px solid #e5e7eb",display:"grid",placeItems:"center",background:"#fafafa"},children:ie?o.jsx("img",{src:j.url,alt:xe,style:{width:Ce.thumbW,height:Ce.thumbH,objectFit:"contain",display:"block"},loading:"lazy"}):o.jsxs("div",{style:{textAlign:"center",padding:10},children:[o.jsx("div",{style:{fontSize:24,fontWeight:700},children:Se||"DOC"}),o.jsx("div",{style:{fontSize:12,opacity:.7},children:"Ver / descargar"})]})}),o.jsx("div",{style:{fontWeight:600,fontSize:13,lineHeight:1.2},children:xe.length>40?xe.slice(0,37)+"":xe}),o.jsxs("details",{children:[o.jsx("summary",{style:{cursor:"pointer",fontSize:12,color:"#2563eb"},children:"Editar nombre y descripcin"}),o.jsxs("div",{style:{display:"grid",gap:6,marginTop:6},children:[o.jsx("label",{className:"form-label",style:{marginTop:4},children:"Nombre para mostrar"}),o.jsx("input",{id:`rx-title-${W}`,className:"form-input",defaultValue:j.title||j.name||"",placeholder:"Ej. Rx aleta derecha 2025-11-29"}),o.jsx("label",{className:"form-label",children:"Descripcin"}),o.jsx("textarea",{id:`rx-desc-${W}`,className:"form-input",rows:2,defaultValue:j.desc||"",placeholder:"Observaciones, regin, tcnica, etc."}),o.jsx("label",{className:"form-label",children:"Fecha de subida"}),o.jsx("input",{id:`rx-date-${W}`,type:"datetime-local",className:"form-input",defaultValue:fU(qe)}),o.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",justifyContent:"space-between"},children:[o.jsx("button",{type:"button",className:"btn blue",onClick:()=>{var cs,us,Uo;const jn=((cs=document.getElementById(`rx-title-${W}`))==null?void 0:cs.value)||"",St=((us=document.getElementById(`rx-desc-${W}`))==null?void 0:us.value)||"",At=((Uo=document.getElementById(`rx-date-${W}`))==null?void 0:Uo.value)||"";let $n=qe,Ir=j.uploadedAtMS||j.created||null;if(At){const ds=new Date(At);isNaN(ds.getTime())||($n=ds.toISOString(),Ir=ds.getTime())}Ke(W,{title:jn,name:jn||j.name,desc:St,uploadedAtISO:$n,uploadedAtMS:Ir})},children:"Guardar"}),o.jsx("button",{type:"button",className:"btn",onClick:()=>re(W),children:"Eliminar"})]}),o.jsxs("div",{className:"hint",style:{fontSize:11},children:["Tipo: ",j.type||"","  Tamao: ",(j.size||0).toLocaleString()," bytes",qe?`  Subido: ${pU(qe)}`:""]})]})]})]},`${j.url}-${W}`)})]})]}),g==="doc"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Doc. Clnicos"}),o.jsxs("div",{className:"ficha-grid",children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Motivo de consulta"}),o.jsx("textarea",{className:"form-input",rows:3,value:((Ht=w.historiaClinica)==null?void 0:Ht.motivoConsulta)||"",onChange:j=>ue("motivoConsulta",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Antecedentes"}),o.jsx("textarea",{className:"form-input",rows:3,value:((lt=w.historiaClinica)==null?void 0:lt.antecedentes)||"",onChange:j=>ue("antecedentes",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Alergias"}),o.jsx("textarea",{className:"form-input",rows:2,value:((un=w.historiaClinica)==null?void 0:un.alergias)||"",onChange:j=>ue("alergias",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Medicamentos"}),o.jsx("textarea",{className:"form-input",rows:2,value:((gn=w.historiaClinica)==null?void 0:gn.medicamentos)||"",onChange:j=>ue("medicamentos",j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Notas"}),o.jsx("textarea",{className:"form-input",rows:3,value:((yn=w.historiaClinica)==null?void 0:yn.notas)||"",onChange:j=>ue("notas",j.target.value)})]})]})]}),g==="odonto"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Odontograma (placeholder)"}),o.jsx("div",{className:"odont-grid",children:Array.from({length:32},(j,W)=>W+1).map(j=>{const W=(w.odontograma||[]).some(ie=>ie.pieza===j);return o.jsx("button",{type:"button",className:`tooth ${W?"on":""}`,onClick:()=>nt("odontograma",j),title:`Pieza ${j}`,children:j},j)})})]}),g==="perio"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Periodontograma (placeholder)"}),o.jsx("div",{className:"odont-grid",children:Array.from({length:32},(j,W)=>W+1).map(j=>{const W=(w.periodontograma||[]).some(ie=>ie.pieza===j);return o.jsx("button",{type:"button",className:`tooth ${W?"on":""}`,onClick:()=>nt("periodontograma",j),title:`Pieza ${j}`,children:j},j)})})]}),g==="presu"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Presupuestos & planes"}),o.jsx(vU,{onAdd:Ae}),o.jsxs("div",{className:"presu-list",children:[(w.presupuestos||[]).map(j=>o.jsxs("div",{className:"presu-item",children:[o.jsxs("div",{children:[o.jsx("div",{className:"presu-title",children:j.titulo}),o.jsxs("div",{className:"presu-meta",children:["Costo: $",j.costo||0,"  Estado: ",j.estado||"Pendiente"]})]}),o.jsx("button",{type:"button",className:"btn small",onClick:()=>Pe(j.id),children:"Eliminar"})]},j.id)),(!w.presupuestos||w.presupuestos.length===0)&&o.jsx("div",{className:"no-data",children:"Sin presupuestos an."})]})]}),g==="evo"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Evoluciones & Remisiones"}),o.jsx(_U,{onAdd:Fe}),o.jsxs("div",{className:"evo-list",children:[(w.evoluciones||[]).map(j=>o.jsxs("div",{className:"evo-item",children:[o.jsx("div",{className:"evo-date",children:new Date(j.fechaISO).toLocaleString()}),o.jsx("div",{className:"evo-note",children:j.nota}),o.jsx("button",{type:"button",className:"btn small",onClick:()=>Oe(j.id),children:"Eliminar"})]},j.id)),(!w.evoluciones||w.evoluciones.length===0)&&o.jsx("div",{className:"no-data",children:"Sin evoluciones an."})]})]}),g==="fact"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Facturacin"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px,1fr))",gap:12},children:[o.jsx(Zo,{title:"Total facturado",value:`$ ${Ot.totalFacturado.toLocaleString()}`}),o.jsx(Zo,{title:"Total pagado",value:`$ ${Ot.totalPagado.toLocaleString()}`}),o.jsx(Zo,{title:"Facturas pendientes",value:`$ ${Ot.totalFacturasPendientes.toLocaleString()}`}),o.jsx(Zo,{title:"Saldo pendiente (facturas - pagos)",value:`$ ${(Ot.totalFacturado-Ot.totalPagado).toLocaleString()}`}),o.jsx(Zo,{title:"Saldo a favor",value:`$ ${(((Er=w.facturacion)==null?void 0:Er.saldoFavor)??0).toLocaleString()}`}),o.jsx(Zo,{title:"Saldo crdito",value:`$ ${(((pl=w.facturacion)==null?void 0:pl.saldoCredito)??0).toLocaleString()}`})]}),Ot.error&&o.jsxs("div",{className:"hint",style:{marginTop:6},children:[" ",Ot.error]}),o.jsxs("div",{className:"ficha-grid",style:{marginTop:12},children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Saldo a favor"}),o.jsx("input",{type:"number",className:"form-input",value:((ls=w.facturacion)==null?void 0:ls.saldoFavor)??0,onChange:j=>L({facturacion:{...w.facturacion||{},saldoFavor:Number(j.target.value||0)}})})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Saldo crdito"}),o.jsx("input",{type:"number",className:"form-input",value:((Oi=w.facturacion)==null?void 0:Oi.saldoCredito)??0,onChange:j=>L({facturacion:{...w.facturacion||{},saldoCredito:Number(j.target.value||0)}})})]})]})]}),g==="citas"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"Citas"}),o.jsxs("div",{className:"mini-card",style:{marginBottom:12},children:[o.jsx("div",{className:"mini-card-title",children:"Crear cita para este paciente"}),o.jsxs("div",{className:"ficha-grid",style:{marginTop:8},children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Fecha"}),o.jsx("input",{type:"date",className:"form-input",value:gt,onChange:j=>Gt(j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Hora"}),o.jsx("input",{type:"time",className:"form-input",value:H,onChange:j=>me(j.target.value)})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Doctor"}),o.jsx("input",{className:"form-input",value:_e,onChange:j=>J(j.target.value),placeholder:"Doctor asignado"})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Espacio / Sala"}),o.jsx("input",{className:"form-input",value:Z,onChange:j=>Ie(j.target.value),placeholder:"Consultorio / Silla"})]}),o.jsxs("div",{className:"field",style:{gridColumn:"1 / -1"},children:[o.jsx("label",{children:"Comentario"}),o.jsx("textarea",{className:"form-input",rows:2,value:ve,onChange:j=>K(j.target.value),placeholder:"Motivo / notas de la cita"})]})]}),o.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[o.jsx("button",{type:"button",className:"btn blue",onClick:Y,children:"Guardar cita"}),gt&&o.jsx("button",{type:"button",className:"btn",onClick:()=>i(gt,w.id),children:"Ver ese da en Agenda"})]})]}),o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Fecha"}),o.jsx("th",{children:"Estado"}),o.jsx("th",{children:"Motivo"}),o.jsx("th",{children:"Profesional / Acciones"})]})}),o.jsx("tbody",{children:Ge?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:4,children:"Cargando"})}):Qn.length===0?o.jsx("tr",{children:o.jsx("td",{className:"no-data",colSpan:4,children:"Sin citas registradas."})}):Qn.map(j=>o.jsxs("tr",{children:[o.jsx("td",{children:j.fechaISO?new Date(j.fechaISO).toLocaleString():j.fechaYYYYMMDD||""}),o.jsx("td",{children:j.estado||""}),o.jsx("td",{children:j.motivo||""}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("span",{children:j.profesional||""}),o.jsx("button",{type:"button",className:"btn small",onClick:()=>{const W=j.fechaYYYYMMDD||j.fecha||(j.fechaISO?new Date(j.fechaISO).toISOString().slice(0,10):"");i(W,w.id)},title:"Abrir en Agenda",children:"Ver en Agenda"})]})})]},j.id))})]})})]}),g==="crm"&&o.jsxs("section",{className:"ficha-section",children:[o.jsx("h4",{className:"ficha-section-title",children:"CRM"}),o.jsx("div",{className:"no-data",children:"Notas / recordatorios comerciales del paciente."})]}),o.jsx("div",{className:"ficha-footer"})]})]})]})]})]})}function Zo({title:t,value:e}){return o.jsxs("div",{className:"mini-card",children:[o.jsx("div",{className:"mini-card-title",children:t}),o.jsx("div",{style:{fontWeight:700,fontSize:20,marginTop:6},children:e})]})}function vU({onAdd:t}){const[e,n]=x.useState(""),[r,s]=x.useState(""),[i,a]=x.useState("Pendiente");return o.jsxs("div",{className:"presu-form",children:[o.jsx("input",{className:"form-input",placeholder:"Procedimiento / plan",value:e,onChange:l=>n(l.target.value)}),o.jsx("input",{type:"number",className:"form-input",placeholder:"Costo",value:r,onChange:l=>s(l.target.value)}),o.jsxs("select",{className:"form-input",value:i,onChange:l=>a(l.target.value),children:[o.jsx("option",{children:"Pendiente"}),o.jsx("option",{children:"Aprobado"}),o.jsx("option",{children:"Rechazado"})]}),o.jsx("button",{type:"button",className:"btn blue",onClick:()=>{if(!e)return alert("Ttulo requerido");t({titulo:e,costo:Number(r||0),estado:i}),n(""),s(""),a("Pendiente")},children:"Agregar"})]})}function _U({onAdd:t}){const[e,n]=x.useState("");return o.jsxs("div",{className:"evo-form",children:[o.jsx("textarea",{className:"form-input",rows:2,placeholder:"Escribe la evolucin / remisin",value:e,onChange:r=>n(r.target.value)}),o.jsx("button",{type:"button",className:"btn blue",onClick:()=>{e.trim()&&(t(e.trim()),n(""))},children:"Guardar evolucin"})]})}function xU(){return o.jsxs("div",{style:{padding:"20px"},children:[o.jsx("h2",{children:"Mdulo de Facturacin"}),o.jsx("p",{children:"Aqu se registrarn los pagos, facturas y cobros."})]})}function bU({basePath:t="",className:e=""}){const n=as(),r=()=>{const s=String(t||"").replace(/\/+$/g,"");n(`${s}/config/datos-basicos`,{replace:!1})};return o.jsx("button",{type:"button",className:`oc-icon-btn ${e}`,title:"Configuracin","aria-label":"Abrir configuracin",onClick:r,children:""})}function wU(t,e){try{let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}catch{}}const U0="empresa_datos_basicos",EU="oc_company_name",IU="empresa_nombre";function SU(){const[t,e]=x.useState({nombre:"",marca:"",pais:"Colombia",ciudad:"",tipoDocumento:"NIT",numeroDocumento:"",tipoPersona:"",telefono:"",celular:"",direccion:"",sitioWeb:"",urlAgendamiento:"",regimen:"",responsabilidadTributaria:"",correo:"",moneda:"Pesos colombianos (COP)",zonaHoraria:"Hora de Colombia",cuentaContable:"",esIPS:!1,usuarioSispro:"",tipoDocSispro:"Cdula de Ciudadana",passwordSispro:"",codigoPrestador:""});x.useEffect(()=>{var s;try{const i=localStorage.getItem(U0);if(i){const l=JSON.parse(i);e(c=>({...c,...l}));return}const a=(s=document.querySelector('meta[name="company-name"]'))==null?void 0:s.getAttribute("content");a&&e(l=>({...l,nombre:a}))}catch{}},[]);const n=s=>{const{name:i,type:a,value:l,checked:c}=s.target;e(d=>({...d,[i]:a==="checkbox"?c:l}))},r=s=>{s.preventDefault();try{localStorage.setItem(U0,JSON.stringify(t))}catch{}const i=(t.nombre||"OdontoCloud").trim();try{localStorage.setItem(EU,i),localStorage.setItem(IU,i)}catch{}wU("company-name",i);try{window.dispatchEvent(new CustomEvent("oc-company-name-updated",{detail:{nombre:i}}));const a=document.querySelector(".oc-topbar-title");a&&(a.textContent=i)}catch{}console.log(" Datos bsicos guardados:",t),alert("Datos bsicos guardados.")};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Datos bsicos"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:"Datos bsicos"}),o.jsxs("form",{className:"emp-form",onSubmit:r,children:[o.jsxs("div",{className:"oc-form-grid",children:[o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Nombre *"}),o.jsx("input",{name:"nombre",className:"emp-input",autoComplete:"organization",required:!0,value:t.nombre,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Marca"}),o.jsx("input",{name:"marca",className:"emp-input",value:t.marca,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Pas"}),o.jsxs("select",{name:"pais",className:"emp-select",value:t.pais,onChange:n,children:[o.jsx("option",{children:"Colombia"}),o.jsx("option",{children:"Mxico"}),o.jsx("option",{children:"Per"}),o.jsx("option",{children:"Chile"}),o.jsx("option",{children:"Argentina"}),o.jsx("option",{children:"Espaa"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Ciudad"}),o.jsx("input",{name:"ciudad",className:"emp-input",value:t.ciudad,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo documento *"}),o.jsxs("select",{name:"tipoDocumento",className:"emp-select",required:!0,value:t.tipoDocumento,onChange:n,children:[o.jsx("option",{children:"NIT"}),o.jsx("option",{children:"CC"}),o.jsx("option",{children:"CE"}),o.jsx("option",{children:"PA"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Nmero de documento *"}),o.jsx("input",{name:"numeroDocumento",className:"emp-input",required:!0,value:t.numeroDocumento,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo de persona"}),o.jsxs("select",{name:"tipoPersona",className:"emp-select",value:t.tipoPersona,onChange:n,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Natural"}),o.jsx("option",{children:"Jurdica"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Telfono fijo"}),o.jsx("input",{name:"telefono",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.telefono,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Celular"}),o.jsx("input",{name:"celular",className:"emp-input",inputMode:"tel",autoComplete:"tel",value:t.celular,onChange:n})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Direccin"}),o.jsx("input",{name:"direccion",className:"emp-input",autoComplete:"street-address",value:t.direccion,onChange:n})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Sitio web"}),o.jsx("input",{name:"sitioWeb",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.sitioWeb,onChange:n})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Agendamiento (URL)"}),o.jsx("input",{name:"urlAgendamiento",className:"emp-input",inputMode:"url",placeholder:"https://",value:t.urlAgendamiento,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Rgimen legal"}),o.jsxs("select",{name:"regimen",className:"emp-select",value:t.regimen,onChange:n,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"Comn"}),o.jsx("option",{children:"Simplificado"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Responsabilidad tributaria"}),o.jsxs("select",{name:"responsabilidadTributaria",className:"emp-select",value:t.responsabilidadTributaria,onChange:n,children:[o.jsx("option",{value:"",children:"Seleccione"}),o.jsx("option",{children:"No aplica"}),o.jsx("option",{children:"Autorretenedor"})]})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Correo electrnico"}),o.jsx("input",{name:"correo",className:"emp-input",type:"email",autoComplete:"email",value:t.correo,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Moneda"}),o.jsxs("select",{name:"moneda",className:"emp-select",value:t.moneda,onChange:n,children:[o.jsx("option",{children:"Pesos colombianos (COP)"}),o.jsx("option",{children:"Dlares (USD)"}),o.jsx("option",{children:"Euros (EUR)"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Zona horaria"}),o.jsxs("select",{name:"zonaHoraria",className:"emp-select",value:t.zonaHoraria,onChange:n,children:[o.jsx("option",{children:"Hora de Colombia"}),o.jsx("option",{children:"America/Bogota"}),o.jsx("option",{children:"UTC-5"})]})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Cuenta contable"}),o.jsx("input",{name:"cuentaContable",className:"emp-input",value:t.cuentaContable,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Es una institucin prestadora de salud (IPS)?"}),o.jsxs("div",{className:"emp-inline",children:[o.jsx("input",{id:"esIPS",type:"checkbox",name:"esIPS",checked:t.esIPS,onChange:n}),o.jsx("label",{htmlFor:"esIPS",children:"S"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Usuario SISPRO"}),o.jsx("input",{name:"usuarioSispro",className:"emp-input",value:t.usuarioSispro,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo documento SISPRO"}),o.jsxs("select",{name:"tipoDocSispro",className:"emp-select",value:t.tipoDocSispro,onChange:n,children:[o.jsx("option",{children:"Cdula de Ciudadana"}),o.jsx("option",{children:"Cdula de Extranjera"}),o.jsx("option",{children:"NIT"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Contrasea SISPRO"}),o.jsx("input",{name:"passwordSispro",className:"emp-input",type:"password",value:t.passwordSispro,onChange:n})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Cdigo de prestador"}),o.jsx("input",{name:"codigoPrestador",className:"emp-input",value:t.codigoPrestador,onChange:n})]})]}),o.jsx("div",{className:"oc-form-actions",children:o.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})})]})]})]})}const tm="empresa_logo_url";function $0(t,e){let n=document.querySelector(`meta[name="${t}"]`);n||(n=document.createElement("meta"),n.setAttribute("name",t),document.head.appendChild(n)),n.setAttribute("content",e)}function TU(){const[t,e]=x.useState(()=>{try{return localStorage.getItem(tm)||""}catch{return""}}),[n,r]=x.useState(null),[s,i]=x.useState(!1),a=x.useRef(null),l=x.useCallback(N=>{const A=N==null?void 0:N[0];if(!A)return;if(!A.type.startsWith("image/")){alert("Por favor selecciona una imagen (PNG/JPG/SVG/WebP).");return}r(A);const T=new FileReader;T.onload=I=>{var E;return e(String(((E=I.target)==null?void 0:E.result)||""))},T.readAsDataURL(A)},[]),c=N=>l(N.target.files),d=N=>{N.preventDefault(),N.stopPropagation(),i(!1),l(N.dataTransfer.files)},h=N=>{N.preventDefault(),i(!0)},f=()=>i(!1),m=()=>{var N;return(N=a.current)==null?void 0:N.click()},_=()=>{r(null),e("")},C=async()=>{try{t?(localStorage.setItem(tm,t),$0("company-logo",t)):(localStorage.removeItem(tm),$0("company-logo","")),alert("Logo guardado.")}catch(N){console.error(N),alert("No se pudo guardar localmente.")}};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Logo empresa"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:"Logo"}),o.jsxs("div",{className:"logo-wrap",children:[o.jsxs("div",{className:"logo-current",children:[o.jsx("div",{className:"emp-label",children:"Logo actual"}),o.jsx("div",{className:"logo-preview","aria-live":"polite",children:t?o.jsx("img",{src:t,alt:"Logo actual de la empresa"}):o.jsx("div",{className:"logo-empty",children:"Sin logo"})}),o.jsx("div",{className:"logo-actions",children:o.jsx("button",{type:"button",className:"oc-btn danger",onClick:_,disabled:!t,children:"Eliminar"})})]}),o.jsxs("div",{className:"logo-uploader",children:[o.jsx("div",{className:"emp-label",children:"Cargar foto"}),o.jsxs("div",{className:`logo-drop ${s?"over":""}`,onDragOver:h,onDragLeave:f,onDrop:d,onClick:m,role:"button",tabIndex:0,onKeyDown:N=>(N.key==="Enter"||N.key===" ")&&m(),"aria-label":"Arrastra o haz click para cargar la imagen del logo",children:[o.jsx("input",{ref:a,type:"file",accept:"image/*",onChange:c,style:{display:"none"}}),o.jsxs("div",{className:"logo-drop-hint",children:["Arrastra o click para cargar la foto.",o.jsx("div",{className:"logo-subhint",children:"Solo archivos de imagen"})]})]}),n&&o.jsxs("div",{className:"logo-file-name",children:["Archivo seleccionado: ",o.jsx("b",{children:n.name})]})]})]}),o.jsx("div",{className:"oc-form-actions",children:o.jsx("button",{type:"button",className:"oc-btn primary",onClick:C,children:"Guardar"})})]})]})}function CU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}const od=t=>{let e=String(t??"").replace(/\D/g,"");return e===""?"":(e=e.replace(/^0+(?=\d)/,""),e.replace(/\B(?=(\d{3})+(?!\d))/g,"."))},B0=t=>Number(String(t??"").replace(/\D/g,""))||0;function p_(t,e){const n=e.map(i=>i.map(a=>{const l=String(a??"").replace(/"/g,'""');return/[",\n]/.test(l)?`"${l}"`:l}).join(",")).join(`
`),r=new Blob([n],{type:"text/csv;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(r),s.download=t,s.click(),URL.revokeObjectURL(s.href)}function NU(){x.useEffect(()=>{var r,s;(r=document.getElementById("lp-acciones-unificadas-icons26"))==null||r.remove(),(s=document.getElementById("lp-acciones-unificadas-icons_v2"))==null||s.remove();const t="lp-acciones-unificadas-icons_v2",e=`
      .lp-wrap{padding:0;}
      .lp-h2{margin:0 0 12px;font-weight:800;font-size:20px;color:#0f172a;}

      .lp-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;}
      .lp-pill{padding:7px 16px;border-radius:999px;border:1px solid #d1d5db;background:#fff;
        font-weight:600;color:#374151;cursor:pointer;font-size:14px;transition:.2s;}
      .lp-pill:hover{background:#f3f4f6;}
      .lp-pill.active{background:#2b6cb0;color:#fff;border-color:#2b6cb0;}

      .lp-card{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:18px;box-shadow:0 1px 2px rgba(0,0,0,.04);}
      .lp-card-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:12px;}
      .lp-subtitle{font-size:16px;font-weight:800;color:#111827;margin:0 0 8px;border-bottom:1px solid #e5e7eb;padding-bottom:6px;}

      .chip{display:inline-flex;align-items:center;gap:8px;height:34px;padding:0 12px;border-radius:999px;border:1px solid #d1d5db;
        background:#fff;color:#374151;font-weight:600;cursor:pointer;transition:.2s;white-space:nowrap;}
      .chip:hover{background:#f3f4f6;}
      .btn-soft{display:inline-flex;align-items:center;gap:6px;height:32px;padding:0 12px;border-radius:999px;border:none;cursor:pointer;
        font-weight:700;font-size:13px;background:#22c55e;color:#fff;}
      .btn-soft.gray{background:#6b7280;}
      .btn-soft:hover{filter:brightness(.95);}

      .lp-table-wrap{overflow-x:hidden;width:100%;}
      .lp-card table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:14px;}
      thead tr{background:#f9fafb;}
      th,td{padding:8px 10px;white-space:normal;word-break:break-word;vertical-align:middle;}
      th{text-align:left;border-bottom:1px solid #e5e7eb;font-weight:700;color:#475569;}
      tbody tr{border-top:1px solid #f1f5f9;}
      .muted{color:#6b7280;}

      /* Acciones unificadas */
      th.actions, td.actions{width:140px;text-align:right;}
      .lp-actions{display:flex;gap:8px;justify-content:flex-end;align-items:center;flex-wrap:nowrap;}

      .iconbtn{
        display:inline-flex;align-items:center;justify-content:center;
        width:32px;height:32px;border-radius:10px;border:1px solid transparent;cursor:pointer;transition:.15s;
      }
      .iconbtn.green{background:#ecfdf5;color:#0f9d5b;border-color:#bbf7d0;}
      .iconbtn.blue {background:#eff6ff;color:#1e3a8a;border-color:#bfdbfe;}
      .iconbtn.red  {background:#fef2f2;color:#b91c1c;border-color:#fecaca;}
      .iconbtn:hover{filter:brightness(.97);}

      .iconbtn > svg{
        width:38px !important;
        height:38px !important;
        display:block;
        stroke-width:2.4;
        vector-effect: non-scaling-stroke;
        pointer-events:none;
      }

      .badge{display:inline-block;padding:5px 10px;border-radius:999px;font-weight:700;font-size:12px;line-height:1;}
      .badge.green{background:#e8f7ee;color:#16a34a;border:1px solid #cbead7;}

      /* ---------- Form (nuevo/editar) ---------- */
      .np-grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:6px;}
      .np-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
      .np-row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
      .np-field{display:flex;flex-direction:column;gap:6px;}
      .np-label{font-weight:700;color:#334155;font-size:13px;}
      .np-input, .np-select, .np-text{
        border:1px solid #d1d5db;border-radius:8px;padding:8px 10px;font-size:14px;background:#fff;
      }
      .np-text{min-height:72px;resize:vertical;}
      .np-toggle{display:flex;align-items:center;gap:10px;}
      .np-card-img{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:6px;}
      .np-avatar{width:140px;height:140px;border-radius:12px;background:#e5e7eb;display:flex;align-items:center;justify-content:center;color:#64748b;}
      .np-drop{border:2px dashed #d1d5db;border-radius:12px;padding:16px;text-align:center;color:#64748b;}
      .np-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px;}

      @media (max-width:900px){
        .np-row, .np-row-3{grid-template-columns:1fr;}
      }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}const m_=()=>o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("path",{d:"M12 20h9"}),o.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5z"})]}),g_=()=>o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),o.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),y_=()=>o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[o.jsx("polyline",{points:"3 6 5 6 21 6"}),o.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),o.jsx("path",{d:"M10 11v6M14 11v6"})]}),jU=()=>o.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.4",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:o.jsx("path",{d:"M20 6L9 17l-5-5"})});function AU(){const[t,e]=x.useState(!0),[n,r]=x.useState([]),[s,i]=x.useState("list"),[a,l]=x.useState(""),{pathname:c}=Fn(),d=as(),h=x.useMemo(()=>CU(c),[c]),f=async()=>{e(!0);try{const T=Ve(ce(Q,"listas_precios"),Ze("tipo","==","clinicos")),E=(await Ne(T)).docs.map(w=>({id:w.id,...w.data()}));E.sort((w,S)=>String(S.actualizado||S.creado||"").localeCompare(String(w.actualizado||w.creado||""))),r(E)}catch{r([])}finally{e(!1)}};x.useEffect(()=>{f()},[]);const m=async()=>{if(!a.trim())return alert("Escribe el nombre de la lista.");const T=new Date().toLocaleString("es-CO"),I={nombre:a.trim(),creado:T,actualizado:T,en_uso:!1,tipo:"clinicos"},E=await Bt(ce(Q,"listas_precios"),I);r(w=>[{id:E.id,...I},...w]),l(""),i("list")},_=async T=>{const I=Ve(ce(Q,"listas_precios"),Ze("tipo","==","clinicos")),E=await Ne(I);await Promise.all(E.docs.map(w=>Ut(Re(Q,"listas_precios",w.id),{en_uso:w.id===T.id}))),r(w=>w.map(S=>({...S,en_uso:S.id===T.id})))},C=async T=>{window.confirm(`Eliminar "${T==null?void 0:T.nombre}"?`)&&(await Cn(Re(Q,"listas_precios",T.id)),r(I=>I.filter(E=>E.id!==T.id)))},N=async T=>{const I=new Date().toLocaleString("es-CO"),{id:E,...w}=T,S={...w,nombre:`${(T==null?void 0:T.nombre)||"Lista"} (copia)`,en_uso:!1,creado:I,actualizado:I},M=await Bt(ce(Q,"listas_precios"),S);r(g=>[{id:M.id,...S},...g])},A=T=>d(`${h}/config/lista-de-precios/editar/${T.id}`);return o.jsxs("div",{className:"lp-card",children:[o.jsx("h3",{className:"lp-subtitle",children:"Lista de precios clnicos"}),s==="list"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsxs("button",{className:"chip",onClick:()=>i("nuevo"),children:[o.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de precios"]}),o.jsx("button",{className:"chip",onClick:()=>p_("Plantilla_Clinicos.csv",[["Categora","Cdigo","Nombre","Permite desc","Precio","Genera RIPS","Es consulta","Ver en agenda","Cuenta contable"],["Odontologa General","890201","Consulta inicial","si","0","no","si","no","4  Ingresos"]]),children:"Exportar plantilla"})]})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Fecha de creacin"}),o.jsx("th",{children:"Fecha de actualizacin"}),o.jsx("th",{children:"En uso"}),o.jsx("th",{className:"actions",children:"Acciones"})]})}),o.jsx("tbody",{children:t?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center"},children:"Cargando"})}):n.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center"},className:"muted",children:"Sin datos"})}):n.map(T=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:600},children:(T==null?void 0:T.nombre)||""}),o.jsx("td",{children:(T==null?void 0:T.creado)||""}),o.jsx("td",{children:(T==null?void 0:T.actualizado)||""}),o.jsx("td",{children:T!=null&&T.en_uso?o.jsx("span",{className:"badge green",children:"En uso"}):o.jsxs("button",{className:"btn-soft",onClick:()=>_(T),title:"Usar esta lista","aria-label":"Usar esta lista",children:[o.jsx(jU,{})," Usar"]})}),o.jsx("td",{className:"actions",children:o.jsxs("div",{className:"lp-actions",children:[o.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>N(T),"aria-label":"Clonar",children:o.jsx(g_,{})}),o.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>A(T),"aria-label":"Editar",children:o.jsx(m_,{})}),o.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>C(T),"aria-label":"Eliminar",children:o.jsx(y_,{})})]})})]},T.id))})]})})]}):o.jsxs("div",{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("h4",{style:{margin:0,fontWeight:700},children:"Nueva lista de precios"}),o.jsx("button",{className:"chip",onClick:()=>i("list"),children:" Volver"})]}),o.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center",maxWidth:560,marginTop:10},children:[o.jsx("input",{type:"text",placeholder:"Nombre de la lista",value:a,onChange:T=>l(T.target.value),style:{flex:1,border:"1px solid #d1d5db",borderRadius:8,padding:"8px 10px"}}),o.jsx("button",{type:"button",title:"Sugerir nombre automtico",className:"chip",onClick:()=>l("Lista de precios "+new Date().toLocaleDateString("es-CO")),children:""}),o.jsx("button",{className:"btn-soft",onClick:m,children:"Guardar"})]})]})]})}function PU(){const[t,e]=x.useState([]),[n,r]=x.useState("list"),[s,i]=x.useState(null),[a,l]=x.useState(null),c={nombre:"",referencia:"",descripcion:"",cuentaContable:"",categoria:"",esServicio:!1,precioCompra:"",marca:"",principioActivo:"",registroInvima:"",formaFarmaceutica:"",concentracion:"",presentacionComercial:"",tempAlmacenamiento:"",unidadTemperatura:"",humedadAlmacenamiento:"",unidadHumedad:"",esInventariable:!1,clasificacionRiesgo:"",vidaUtil:"",periodicidadMantenimiento:"",periodicidadCalibracion:"",extTexto1:"",extTexto2:"",extNumero1:"",extNumero2:"",extFecha1:"",extFecha2:""},[d,h]=x.useState(c),f=async()=>{try{const M=(await Ne(ce(Q,"listas_precios_productos"))).docs.map(g=>({id:g.id,...g.data()}));e(M)}catch{e([])}};x.useEffect(()=>{f()},[]);const m=async S=>{const{id:M,...g}=S,v=await Bt(ce(Q,"listas_precios_productos"),{...g,nombre:`${(S==null?void 0:S.nombre)||"Producto"} (copia)`,creado:new Date().toISOString()});e(b=>[{id:v.id,...g,nombre:`${(S==null?void 0:S.nombre)||"Producto"} (copia)`},...b])},_=async S=>{window.confirm(`Eliminar "${S==null?void 0:S.nombre}"?`)&&(await Cn(Re(Q,"listas_precios_productos",S.id)),e(M=>M.filter(g=>g.id!==S.id)))},C=S=>{var v;const M=(v=S.target.files)==null?void 0:v[0];if(!M)return;const g=new FileReader;g.onload=()=>i(g.result),g.readAsDataURL(M)},N=()=>{p_("Plantilla_Productos.csv",[["Nombre","Referencia","Descripcin","Cuenta contable","Categora","Es servicio","Precio compra","Marca","Principio activo","Registro Invima","Forma farmacutica","Concentracin","Presentacin comercial","Temp. almacenamiento","Unidad temp.","Humedad almac.","Unidad humedad","Es inventariable","Clasif. riesgo","Vida til","Periodicidad mant.","Periodicidad calib.","Ext. texto 1","Ext. texto 2","Ext. nmero 1","Ext. nmero 2","Ext. fecha 1","Ext. fecha 2"],["Hilo reabsorbible 3/0","","","4  Ingresos","Insumos","no","0","Marca X","","","Sutura","","","25","C","60","%","si","","","12 meses","12 meses","","","","","",""]])},A=async()=>{if(!d.nombre.trim())return alert("El nombre es obligatorio.");const S={...d,precioCompra:B0(d.precioCompra),creado:new Date().toISOString(),imgPreview:s||null},M=await Bt(ce(Q,"listas_precios_productos"),S);e(g=>[{id:M.id,...S},...g]),h(c),i(null),r("list"),alert("Producto guardado.")},T=S=>{l(S.id),h({nombre:S.nombre||"",referencia:S.referencia||"",descripcion:S.descripcion||"",cuentaContable:S.cuentaContable||"",categoria:S.categoria||"",esServicio:!!S.esServicio,precioCompra:S.precioCompra?od(S.precioCompra):"",marca:S.marca||"",principioActivo:S.principioActivo||"",registroInvima:S.registroInvima||"",formaFarmaceutica:S.formaFarmaceutica||"",concentracion:S.concentracion||"",presentacionComercial:S.presentacionComercial||"",tempAlmacenamiento:S.tempAlmacenamiento||"",unidadTemperatura:S.unidadTemperatura||"",humedadAlmacenamiento:S.humedadAlmacenamiento||"",unidadHumedad:S.unidadHumedad||"",esInventariable:!!S.esInventariable,clasificacionRiesgo:S.clasificacionRiesgo||"",vidaUtil:S.vidaUtil||"",periodicidadMantenimiento:S.periodicidadMantenimiento||"",periodicidadCalibracion:S.periodicidadCalibracion||"",extTexto1:S.extTexto1||"",extTexto2:S.extTexto2||"",extNumero1:S.extNumero1??"",extNumero2:S.extNumero2??"",extFecha1:S.extFecha1||"",extFecha2:S.extFecha2||""}),i(S.imgPreview||null),r("editar")},I=async()=>{if(!a)return;if(!d.nombre.trim())return alert("El nombre es obligatorio.");const S={...d,precioCompra:B0(d.precioCompra),actualizado:new Date().toISOString(),imgPreview:s||null};await Ut(Re(Q,"listas_precios_productos",a),S),e(M=>M.map(g=>g.id===a?{id:a,...S}:g)),l(null),h(c),i(null),r("list"),alert("Producto actualizado.")},E=n==="editar"?"Editar producto":"Nuevo producto",w=n==="editar"?I:A;return o.jsxs("div",{className:"lp-card",children:[o.jsx("h3",{className:"lp-subtitle",children:"Lista de precios productos"}),n==="list"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsxs("button",{className:"chip",onClick:()=>{h(c),i(null),r("nuevo")},children:[o.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo producto"]}),o.jsx("button",{className:"chip",onClick:N,children:"Exportar plantilla"})]})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Marca"}),o.jsx("th",{children:"Descripcin"}),o.jsx("th",{className:"actions",children:"Acciones"})]})}),o.jsx("tbody",{children:t.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(S=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:600},children:(S==null?void 0:S.nombre)||""}),o.jsx("td",{children:(S==null?void 0:S.marca)||""}),o.jsx("td",{children:(S==null?void 0:S.descripcion)||""}),o.jsx("td",{className:"actions",children:o.jsxs("div",{className:"lp-actions",children:[o.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>m(S),"aria-label":"Clonar",children:o.jsx(g_,{})}),o.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>T(S),"aria-label":"Editar",children:o.jsx(m_,{})}),o.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>_(S),"aria-label":"Eliminar",children:o.jsx(y_,{})})]})})]},S.id))})]})})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"lp-card-header",children:[o.jsx("h4",{style:{margin:0,fontWeight:700},children:E}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"btn-soft gray",onClick:()=>{r("list"),l(null),h(c),i(null)},children:" Volver"}),o.jsx("button",{className:"btn-soft",onClick:w,children:n==="editar"?"Actualizar":"Guardar"})]})]}),o.jsxs("div",{className:"np-card-img",children:[o.jsx("div",{className:"np-avatar",children:s?o.jsx("img",{src:s,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:12}}):o.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",children:[o.jsx("circle",{cx:"12",cy:"8",r:"4"}),o.jsx("path",{d:"M6 20c0-3.314 2.686-6 6-6s6 2.686 6 6"})]})}),o.jsxs("div",{className:"np-drop",children:[o.jsxs("div",{style:{marginBottom:6},children:["Arrastra o haz click para cargar la foto.",o.jsx("br",{}),"Solo archivos de imgenes"]}),o.jsx("input",{type:"file",accept:"image/*",onChange:C})]})]}),o.jsxs("div",{className:"np-grid",children:[o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Nombre*"}),o.jsx("input",{className:"np-input",value:d.nombre,onChange:S=>h({...d,nombre:S.target.value}),placeholder:"Nombre del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Referencia"}),o.jsx("input",{className:"np-input",value:d.referencia,onChange:S=>h({...d,referencia:S.target.value}),placeholder:"Referencia del concepto"})]})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Descripcin"}),o.jsx("textarea",{className:"np-text",value:d.descripcion,onChange:S=>h({...d,descripcion:S.target.value}),placeholder:"Descripcin del concepto"})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Cuenta contable"}),o.jsx("input",{className:"np-input",value:d.cuentaContable,onChange:S=>h({...d,cuentaContable:S.target.value}),placeholder:"Buscar tem..."})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Categora*"}),o.jsxs("select",{className:"np-select",value:d.categoria,onChange:S=>h({...d,categoria:S.target.value}),children:[o.jsx("option",{value:"",children:"Seleccione..."}),o.jsx("option",{children:"Medicamentos"}),o.jsx("option",{children:"Insumos"}),o.jsx("option",{children:"Equipos"})]})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field np-toggle",children:[o.jsx("label",{className:"np-label",style:{margin:0},children:"Es servicio?"}),o.jsx("input",{type:"checkbox",checked:d.esServicio,onChange:S=>h({...d,esServicio:S.target.checked})})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Precio compra*"}),o.jsx("input",{className:"np-input",inputMode:"numeric",value:d.precioCompra,onChange:S=>h({...d,precioCompra:od(S.target.value)}),placeholder:"$0"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Marca"}),o.jsx("input",{className:"np-input",value:d.marca,onChange:S=>h({...d,marca:S.target.value}),placeholder:"Marca del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Principio activo"}),o.jsx("input",{className:"np-input",value:d.principioActivo,onChange:S=>h({...d,principioActivo:S.target.value}),placeholder:"Principio activo del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Registro Invima"}),o.jsx("input",{className:"np-input",value:d.registroInvima,onChange:S=>h({...d,registroInvima:S.target.value}),placeholder:"Informacin Invima del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Forma farmacutica"}),o.jsx("input",{className:"np-input",value:d.formaFarmaceutica,onChange:S=>h({...d,formaFarmaceutica:S.target.value}),placeholder:"Forma farmacutica del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Concentracin"}),o.jsx("input",{className:"np-input",value:d.concentracion,onChange:S=>h({...d,concentracion:S.target.value}),placeholder:"Concentracin del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Presentacin comercial"}),o.jsx("input",{className:"np-input",value:d.presentacionComercial,onChange:S=>h({...d,presentacionComercial:S.target.value}),placeholder:"Presentacin com. del concepto"})]})]}),o.jsxs("div",{className:"np-row-3",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Temperatura de almacenamiento"}),o.jsx("input",{className:"np-input",value:d.tempAlmacenamiento,onChange:S=>h({...d,tempAlmacenamiento:S.target.value}),placeholder:"Temperatura de almacenamiento"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Unidad de temperatura"}),o.jsx("input",{className:"np-input",value:d.unidadTemperatura,onChange:S=>h({...d,unidadTemperatura:S.target.value}),placeholder:"Unidad de temp. del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Humedad de almacenamiento"}),o.jsx("input",{className:"np-input",value:d.humedadAlmacenamiento,onChange:S=>h({...d,humedadAlmacenamiento:S.target.value}),placeholder:"Humedad de almacenamiento"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Unidad de humedad"}),o.jsx("input",{className:"np-input",value:d.unidadHumedad,onChange:S=>h({...d,unidadHumedad:S.target.value}),placeholder:"Unidad de hum. del concepto"})]}),o.jsxs("div",{className:"np-field np-toggle",children:[o.jsx("label",{className:"np-label",style:{margin:0},children:"Es inventariable?"}),o.jsx("input",{type:"checkbox",checked:d.esInventariable,onChange:S=>h({...d,esInventariable:S.target.checked})})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Clasificacin de riesgo"}),o.jsx("input",{className:"np-input",value:d.clasificacionRiesgo,onChange:S=>h({...d,clasificacionRiesgo:S.target.value}),placeholder:"Clasif. riesgo del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Vida til"}),o.jsx("input",{className:"np-input",value:d.vidaUtil,onChange:S=>h({...d,vidaUtil:S.target.value}),placeholder:"Vida til del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Periodicidad mantenimiento"}),o.jsx("input",{className:"np-input",value:d.periodicidadMantenimiento,onChange:S=>h({...d,periodicidadMantenimiento:S.target.value}),placeholder:"Periodicidad mant. del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Periodicidad calibracin"}),o.jsx("input",{className:"np-input",value:d.periodicidadCalibracion,onChange:S=>h({...d,periodicidadCalibracion:S.target.value}),placeholder:"Periodicidad cal. del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin texto 1"}),o.jsx("input",{className:"np-input",value:d.extTexto1,onChange:S=>h({...d,extTexto1:S.target.value}),placeholder:"Ext. texto 1 del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin texto 2"}),o.jsx("input",{className:"np-input",value:d.extTexto2,onChange:S=>h({...d,extTexto2:S.target.value}),placeholder:"Ext. texto 2 del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin nmero 1"}),o.jsx("input",{className:"np-input",inputMode:"numeric",value:d.extNumero1,onChange:S=>h({...d,extNumero1:od(S.target.value)}),placeholder:"Ext. nmero 1 del concepto"})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin nmero 2"}),o.jsx("input",{className:"np-input",inputMode:"numeric",value:d.extNumero2,onChange:S=>h({...d,extNumero2:od(S.target.value)}),placeholder:"Ext. nmero 2 del concepto"})]})]}),o.jsxs("div",{className:"np-row",children:[o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin fecha 1 (dd/mm/aaaa)"}),o.jsx("input",{className:"np-input",type:"date",value:d.extFecha1,onChange:S=>h({...d,extFecha1:S.target.value})})]}),o.jsxs("div",{className:"np-field",children:[o.jsx("label",{className:"np-label",children:"Extensin fecha 2 (dd/mm/aaaa)"}),o.jsx("input",{className:"np-input",type:"date",value:d.extFecha2,onChange:S=>h({...d,extFecha2:S.target.value})})]})]}),o.jsxs("div",{className:"np-actions",children:[o.jsx("button",{className:"btn-soft gray",onClick:()=>{r("list"),l(null),h(c),i(null)},children:"Cancelar"}),o.jsx("button",{className:"btn-soft",onClick:w,children:n==="editar"?"Actualizar":"Guardar"})]})]})]})]})}function RU(){const[t,e]=x.useState([]);x.useEffect(()=>{(async()=>{try{const a=(await Ne(ce(Q,"listas_precios_servicios"))).docs.map(l=>({id:l.id,...l.data()}));e(a)}catch{e([])}})()},[]);const n=async i=>{const{id:a,...l}=i,c=await Bt(ce(Q,"listas_precios_servicios"),{...l,nombre:`${(i==null?void 0:i.nombre)||"Servicio"} (copia)`});e(d=>[{id:c.id,...l,nombre:`${(i==null?void 0:i.nombre)||"Servicio"} (copia)`},...d])},r=async i=>{window.confirm(`Eliminar "${i==null?void 0:i.nombre}"?`)&&(await Cn(Re(Q,"listas_precios_servicios",i.id)),e(a=>a.filter(l=>l.id!==i.id)))},s=()=>{p_("Plantilla_Servicios.csv",[["Nombre","Descripcin","Cuenta contable","Categora","Precio base","Genera RIPS"],["Toma de Rx periapical","","4  Ingresos","Radiologa","0","si"]])};return o.jsxs("div",{className:"lp-card",children:[o.jsx("h3",{className:"lp-subtitle",children:"Lista de precios servicios"}),o.jsxs("div",{className:"lp-card-header",children:[o.jsx("div",{}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsxs("button",{className:"chip",onClick:()=>alert("Nuevo listado de servicios (prximamente)"),children:[o.jsx("span",{style:{fontWeight:800,fontSize:16},children:""})," Nuevo listado de servicios"]}),o.jsx("button",{className:"chip",onClick:s,children:"Exportar plantilla"})]})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Marca"}),o.jsx("th",{children:"Descripcin"}),o.jsx("th",{className:"actions",children:"Acciones"})]})}),o.jsx("tbody",{children:t.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"muted",style:{textAlign:"center",padding:18},children:"Sin datos"})}):t.map(i=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:600},children:(i==null?void 0:i.nombre)||""}),o.jsx("td",{children:(i==null?void 0:i.marca)||""}),o.jsx("td",{children:(i==null?void 0:i.descripcion)||""}),o.jsx("td",{className:"actions",children:o.jsxs("div",{className:"lp-actions",children:[o.jsx("button",{className:"iconbtn green",title:"Clonar",onClick:()=>n(i),"aria-label":"Clonar",children:o.jsx(g_,{})}),o.jsx("button",{className:"iconbtn blue",title:"Editar",onClick:()=>alert("Editar servicio (prx.)"),"aria-label":"Editar",children:o.jsx(m_,{})}),o.jsx("button",{className:"iconbtn red",title:"Eliminar",onClick:()=>r(i),"aria-label":"Eliminar",children:o.jsx(y_,{})})]})})]},i.id))})]})})]})}function w1(){NU();const[t,e]=x.useState("clinicos");return o.jsxs("div",{className:"lp-wrap",children:[o.jsx("h2",{className:"lp-h2",children:"Configuracin  Lista de precios"}),o.jsxs("div",{className:"lp-tabs",children:[o.jsx("button",{className:`lp-pill ${t==="clinicos"?"active":""}`,onClick:()=>e("clinicos"),children:"Lista de precios clnicos"}),o.jsx("button",{className:`lp-pill ${t==="productos"?"active":""}`,onClick:()=>e("productos"),children:"Lista de precios productos"}),o.jsx("button",{className:`lp-pill ${t==="servicios"?"active":""}`,onClick:()=>e("servicios"),children:"Lista de precios servicios"})]}),t==="productos"?o.jsx(PU,{}):t==="servicios"?o.jsx(RU,{}):o.jsx(AU,{})]})}function kU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}const nm=[{nombre:"Rehabilitacin Oral",comentario:""},{nombre:"Implantologa",comentario:""},{nombre:"Ciruga Oral",comentario:""},{nombre:"Periodoncia",comentario:""},{nombre:"Endodoncia",comentario:""},{nombre:"Ortodoncia",comentario:""},{nombre:"Odontologa General",comentario:""},{nombre:"Radiologa",comentario:""},{nombre:"Psicologa",comentario:""}],z0=[{codigo:"1",nombre:"Activos"},{codigo:"2",nombre:"Pasivos"},{codigo:"3",nombre:"Patrimonio"},{codigo:"4",nombre:"Ingresos"},{codigo:"5",nombre:"Gastos"},{codigo:"6",nombre:"Costos de ventas"},{codigo:"7",nombre:"Costos de produccin"},{codigo:"8",nombre:"Cuentas de orden deudoras"},{codigo:"9",nombre:"Cuentas de orden acreedoras"}],q0=t=>Re(Q,"listas_precios",t),Ul=t=>ce(Q,"listas_precios",t,"categorias"),Tr=(t,e)=>ce(Q,"listas_precios",t,"categorias",e,"items");function DU(){x.useEffect(()=>{var r;const t="lp-edit-inline";(r=document.getElementById(t))==null||r.remove();const e=`
      .oc-main-content.lp { padding:16px 20px }
      .oc-section-title { margin-bottom:16px }
      .oc-section-title h2 { margin:0; font-weight:800; font-size:20px; color:#0f172a }
      .card { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.04) }
      .toolbar { display:flex; gap:8px; align-items:center; }

      .chip { height:34px; padding:0 12px; border-radius:999px; border:1px solid #e5e7eb; cursor:pointer; font-weight:600; background:#f9fafb; transition:.15s }
      .chip:hover { background:#e5e7eb }
      .chip.blue   { background:#3b82f6; color:#fff; border:none }
      .chip.green  { background:#22c55e; color:#fff; border:none }
      .chip.orange { background:#f59e0b; color:#fff; border:none }
      .chip.gray   { background:#64748b; color:#fff; border:none }

      .name-row { display:flex; align-items:center; gap:8px; }
      .text-inp { height:38px; padding:0 10px; border-radius:8px; border:1px solid #cbd5e1; outline:none; width:280px }

      .table-responsive { width:100%; overflow-x:auto }
      table { width:100%; border-collapse:collapse; font-size:.9rem }
      thead tr { background:#f1f5f9 }
      th, td { padding:10px 12px; white-space:nowrap; vertical-align:middle }
      th { text-align:left; border-bottom:1px solid #e2e8f0; color:#475569; font-weight:700 }
      tr + tr { border-top:1px solid #e2e8f0 }
      .muted { color:#64748b }
      .status-pill { padding:2px 8px; border-radius:999px; font-weight:600 }
      .status-on { background:#dcfce7; color:#166534 }
      .status-off{ background:#fee2e2; color:#991b1b }

      .btn { padding:4px 8px; border:none; border-radius:6px; color:#fff; cursor:pointer; margin-right:6px; font-weight:600; transition:.12s }
      .btn:hover { opacity:.9 }
      .btn.blue   { background:#3b82f6 }
      .btn.green  { background:#22c55e }
      .btn.orange { background:#f59e0b }
      .btn.red    { background:#ef4444 }
      .btn.sky    { background:#06b6d4 }
      .btn.sm { height:32px; padding:0 10px; border-radius:8px }

      .toggle-cell{width:34px}
      .arrow{font-weight:900;font-size:18px;opacity:.7;cursor:pointer;display:inline-block}
      .row-cat-actions{display:flex;gap:6px;justify-content:flex-end}

      .cat-details{background:#fafafa}
      .inner-table{width:100%; border-collapse:collapse; font-size:.88rem}
      .inner-table th, .inner-table td{padding:8px 10px}
      .inner-table thead tr{background:#f8fafc}
      .inner-actions{display:flex;gap:6px;justify-content:flex-end}
      .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

      /* Modal base */
      .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;z-index:999}
      .modal{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:min(880px,94vw);padding:0;border:1px solid #e5e7eb}
      .modal .hd{padding:12px 16px;border-bottom:1px solid #e5e7eb;font-weight:700}
      .modal .bd{padding:16px}
      .modal .ft{padding:12px 16px;border-top:1px solid #e5e7eb;display:flex;gap:8px;justify-content:flex-end}

      /*  Grilla de 3 columnas con field (label arriba, input abajo)  */
      .form-grid-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; align-items:start; }
      .field{ display:flex; flex-direction:column; gap:6px }
      .field label{ font-weight:700; color:#0f172a }

      .form-row-full{ margin-top:12px }

      .inp{height:36px;border:1px solid #cbd5e1;border-radius:8px;padding:0 10px;outline:none;width:100%}
      .ta{border:1px solid #cbd5e1;border-radius:8px;padding:8px;min-height:84px;outline:none;width:100%}

      /* Toggle simple / pill */
      .toggle{display:inline-flex;align-items:center;gap:10px}
      .toggle-pill{display:inline-flex;align-items:center;gap:6px;border:1px solid #cbd5e1;border-radius:999px;padding:2px 8px;height:32px}
      .toggle-pill span{font-weight:700}

      /* Autocomplete */
      .ac-wrap{position:relative}
      .ac-list{
        position:absolute; z-index:1000; top:100%; left:0; right:0;
        background:#fff; border:1px solid #e5e7eb; border-radius:10px;
        box-shadow:0 8px 30px rgba(0,0,0,.12);
        max-height:240px; overflow:auto; margin-top:4px;
      }
      .ac-item{padding:8px 12px; cursor:pointer; display:flex; gap:8px; align-items:center}
      .ac-item:hover{background:#f1f5f9}
      .ac-code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-weight:700; color:#0f172a}
      .ac-name{color:#334155}
      .ac-empty{padding:10px 12px; color:#64748b}

      /*  Selector % | $ para Mximo descuento  */
      .seg-wrap{ display:flex; align-items:center; gap:8px; }
      .seg{ user-select:none; cursor:pointer; border:1px solid #cbd5e1; border-radius:8px; height:36px; min-width:44px; display:flex; align-items:center; justify-content:center; padding:0 10px; font-weight:700; color:#334155; background:#fff; }
      .seg.on{ background:#0ea5e9; color:#fff; border-color:#0ea5e9; }
    `,n=document.createElement("style");n.id=t,n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},[])}const hs=(t="")=>t==null?void 0:t.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function ea(t){let e=String(t||"").replace(/\D/g,"");return e===""?"":(e=e.replace(/^0+(?=\d)/,""),e.replace(/\B(?=(\d{3})+(?!\d))/g,"."))}function rm({value:t,onChange:e,placeholder:n,suggestions:r=[],getLabel:s=c=>(c==null?void 0:c.nombre)||"",onPick:i,renderRow:a,minChars:l=1}){const[c,d]=x.useState(!1),h=x.useRef(null);x.useEffect(()=>{function m(_){h.current&&!h.current.contains(_.target)&&d(!1)}return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const f=c&&((t==null?void 0:t.length)||0)>=l;return o.jsxs("div",{className:"ac-wrap",ref:h,children:[o.jsx("input",{className:"inp",value:t,placeholder:n,onChange:m=>{e(m.target.value),d(!0)},onFocus:()=>d(!0)}),f&&o.jsx("div",{className:"ac-list",children:r.length===0?o.jsx("div",{className:"ac-empty",children:"Sin resultados"}):r.map((m,_)=>o.jsx("div",{className:"ac-item",onClick:()=>{i==null||i(m),d(!1)},children:a?a(m):o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",children:m.codigo}),o.jsx("span",{className:"ac-name",children:s(m)})]})},_))})]})}function LU(t){DU();const e=qP(),n=(t==null?void 0:t.listaId)??e.id??e.listaId??e.priceListId??e.listId??null,{pathname:r}=Fn(),s=as(),a=`${x.useMemo(()=>kU(r),[r])}/config/lista-de-precios`,[l,c]=x.useState(""),[d,h]=x.useState(!1),[f,m]=x.useState([]),[_,C]=x.useState(!0),[N,A]=x.useState(""),[T,I]=x.useState(!1),[E,w]=x.useState(!1),[S,M]=x.useState(!1),[g,v]=x.useState(null),[b,k]=x.useState("create"),[R,V]=x.useState(null),D={codigo:"",nombre:"",precio:"",observaciones:"",usa_pago_fijo:!1,pago_valor_fijo:"0",permite_descuento:!1,genera_rips:!1,es_consulta:!1,ver_en_agenda:!1,cuenta_contable:"",max_descuento_tipo:"pct",max_descuento_value:""},[O,ee]=x.useState(D),[ye,He]=x.useState([]),[X]=x.useState(z0),[te,de]=x.useState(0),[ne,he]=x.useState("none"),[Ce,Ue]=x.useState("existentes"),[$e,Ke]=x.useState([]),[mt,gt]=x.useState(""),[Gt,H]=x.useState("");x.useEffect(()=>{async function L(){if(!n){A("Ruta invlida: falta el id de la lista."),C(!1);return}C(!0);try{const F=await No(q0(n));c(F.exists()&&F.data().nombre||"")}catch{c(""),A("No se pudo cargar la lista. Revisa la ruta y permisos.")}try{const re=(await Ne(Ul(n))).docs.map(ue=>({id:ue.id,expanded:!1,itemsLoaded:!1,items:[],activa:ue.data().activa??!0,...ue.data()}));re.sort((ue,Ae)=>(ue.nombre||"").localeCompare(Ae.nombre||"")),m(re)}finally{C(!1)}}L()},[n]),x.useEffect(()=>{async function L(){try{const re=(await Ne(ce(Q,"catalogo_procedimientos"))).docs.map(ue=>({id:ue.id,...ue.data()})).filter(ue=>ue.codigo&&ue.nombre);He(re)}catch{He([])}}L()},[]);async function me(){try{if(!n)return;h(!0),await Ut(q0(n),{nombre:(l||"").trim(),actualizado:new Date().toLocaleString("es-CO")})}catch{alert("No se pudo actualizar el nombre.")}finally{h(!1)}}async function _e(L){if(m(F=>F.map(re=>re.id===L.id?{...re,expanded:!re.expanded}:re)),!L.itemsLoaded&&n){const F=await Ne(Tr(n,L.id)).catch(()=>null),re=F?F.docs.map(ue=>({id:ue.id,...ue.data()})):[];m(ue=>ue.map(Ae=>Ae.id===L.id?{...Ae,items:re,itemsLoaded:!0}:Ae))}}async function J(L){if(!n)return;const F=(prompt("Editar nombre de la categora:",L.nombre)||"").trim();if(!F)return;const re=(prompt("Comentario (opcional):",L.comentario||"")||"").trim();await Ut(Re(Ul(n),L.id),{nombre:F,comentario:re}),m(ue=>ue.map(Ae=>Ae.id===L.id?{...Ae,nombre:F,comentario:re}:Ae))}async function Z(L){if(!n||!confirm(`Eliminar categora "${L.nombre}" y TODOS sus tems?`))return;const F=await Ne(Tr(n,L.id)).catch(()=>null);F&&await Promise.all(F.docs.map(re=>Cn(Re(Tr(n,L.id),re.id)))),await Cn(Re(Ul(n),L.id)),m(re=>re.filter(ue=>ue.id!==L.id))}async function Ie(L){if(!n)return;const F=prompt("Ajuste porcentual (ej.: 5 para +5%, -10 para -10%)","5");if(F==null)return;const re=Number(F);if(Number.isNaN(re))return alert("Valor invlido.");const ue=await Ne(Tr(n,L.id)).catch(()=>null);ue&&(await Promise.all(ue.docs.map(async Ae=>{const Pe=Ae.data()||{},Fe=Math.round(Number(Pe.precio||0)*(1+re/100));await Ut(Re(Tr(n,L.id),Ae.id),{precio:Fe,actualizado:new Date().toLocaleString("es-CO")})})),m(Ae=>Ae.map(Pe=>Pe.id===L.id?{...Pe,items:Pe.items.map(Fe=>({...Fe,precio:Math.round(Number(Fe.precio||0)*(1+re/100))}))}:Pe)),alert("Precios actualizados."))}function ve(L){v(L),k("create"),V(null),ee(D),M(!0)}function K(L,F){v(L),k("edit"),V(F.id);const re=Number(F.max_descuento_pct??F.max_desc_pct??0),ue=Number(F.max_descuento_valor??F.max_desc_valor??0);let Ae="pct",Pe="";ue>0?(Ae="valor",Pe=String(ue)):re>0&&(Ae="pct",Pe=String(re)),ee({codigo:F.codigo||"",nombre:F.nombre||"",precio:ea(F.precio||0),observaciones:F.comentario||"",usa_pago_fijo:!!F.usa_pago_fijo,pago_valor_fijo:String(F.pago_valor_fijo??"0"),permite_descuento:!!(F.permite_descuento??F.permite_desc??!1),genera_rips:!!F.genera_rips,es_consulta:!!F.es_consulta,ver_en_agenda:!!F.ver_en_agenda,cuenta_contable:F.cuenta_contable||"",max_descuento_tipo:Ae,max_descuento_value:Ae==="valor"?ea(Pe):Pe}),M(!0)}async function Y(){if(!n||!g)return;if(!O.nombre.trim())return alert("El nombre es obligatorio.");const L=Ae=>Number(String(Ae).replace(/\D/g,""))||0;let F=0,re=0;O.permite_descuento&&(O.max_descuento_tipo==="pct"?F=Math.max(0,Number(String(O.max_descuento_value).replace(",",".")||0)):re=L(O.max_descuento_value));const ue={codigo:O.codigo.trim(),nombre:O.nombre.trim(),permite_descuento:!!O.permite_descuento,max_descuento_pct:F,max_descuento_valor:re,permite_desc:!!O.permite_descuento,max_desc_pct:F,max_desc_valor:re,genera_rips:!!O.genera_rips,es_consulta:!!O.es_consulta,ver_en_agenda:!!O.ver_en_agenda,cuenta_contable:O.cuenta_contable.trim(),comentario:O.observaciones.trim(),precio:L(O.precio),usa_pago_fijo:!!O.usa_pago_fijo,pago_valor_fijo:L(O.pago_valor_fijo),actualizado:new Date().toLocaleString("es-CO")};if(b==="create"){const Ae=await Bt(Tr(n,g.id),{...ue,creado:new Date().toLocaleString("es-CO")});m(Pe=>Pe.map(Fe=>Fe.id===g.id?{...Fe,items:[...Fe.items,{id:Ae.id,...ue}],expanded:!0}:Fe))}else await Ut(Re(Tr(n,g.id),R),ue),m(Ae=>Ae.map(Pe=>Pe.id===g.id?{...Pe,items:Pe.items.map(Fe=>Fe.id===R?{...Fe,...ue,id:R}:Fe)}:Pe));M(!1)}async function B(L,F){n&&confirm(`Eliminar "${F.nombre}"?`)&&(await Cn(Re(Tr(n,L.id),F.id)),m(re=>re.map(ue=>ue.id===L.id?{...ue,items:ue.items.filter(Ae=>Ae.id!==F.id)}:ue)))}async function ge(){try{const L=ce(Q,"catalogo_categorias");for(const F of nm){const re=`${F.nombre}`.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-");await jo(Re(L,re),{nombre:F.nombre,comentario:F.comentario||""},{merge:!0})}alert("Catlogo base creado/actualizado. Vuelve a abrir 'Categoras existentes'.")}catch{alert("No se pudo sembrar el catlogo base.")}}async function De(){w(!0),Ue("existentes"),gt(""),H("");try{const F=(await Ne(ce(Q,"catalogo_categorias"))).docs.map(re=>({id:re.id,...re.data()}));Ke(F.length?F:nm.map((re,ue)=>({id:`def-${ue}`,...re})))}catch{Ke(nm.map((L,F)=>({id:`def-${F}`,...L})))}}async function Be(L){if(n)try{const F=Ul(n);await Bt(F,{nombre:L.nombre,comentario:L.comentario||"",activa:!0,creado:new Date().toLocaleString("es-CO")});const re=await Ne(F);m(re.docs.map(ue=>({id:ue.id,...ue.data(),activa:ue.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),alert("Categora agregada.")}catch{alert("No se pudo agregar la categora.")}}async function Le(){if(n){if(!mt.trim())return alert("Escribe el nombre de la categora.");try{const L=Ul(n);await Bt(L,{nombre:mt.trim(),comentario:Gt.trim(),activa:!0,creado:new Date().toLocaleString("es-CO")});const F=await Ne(L);m(F.docs.map(re=>({id:re.id,...re.data(),activa:re.data().activa??!0,expanded:!1,itemsLoaded:!1,items:[]}))),w(!1)}catch{alert("No se pudo crear la categora.")}}}function We(){return new Promise(L=>{if(typeof window<"u"&&window.XLSX)return L(window.XLSX);const F=document.createElement("script");F.src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js",F.onload=()=>L(window.XLSX||null),F.onerror=()=>L(null),document.head.appendChild(F)})}function be(L,F){return F==="up"?Math.ceil(L):F==="down"?Math.floor(L):L}async function rt(){if(!n)return;const L=Number(te);if(!Number.isFinite(L))return alert("Ingresa un porcentaje vlido.");try{for(const F of f){const re=await Ne(Tr(n,F.id)).catch(()=>null);if(re)for(const ue of re.docs){const Ae=ue.data()||{},Pe=be(Number(Ae.precio||0)*(1+L/100),ne);await Ut(Re(Tr(n,F.id),ue.id),{precio:Pe,actualizado:new Date().toLocaleString("es-CO")})}}alert("Precios actualizados."),I(!1)}catch{alert("No se pudo aplicar el incremento.")}}async function Xe(){try{if(!n)return;const L=["Categora","Cdigo","Nombre","Permite desc","Precio","Genera RIPS","Es consulta","Ver en agenda","Nombre en la agenda","Tiempo","Identificador","Cuenta contable"],F=[],re=`OdontoCloud  Lista de precios  ${l||"Principal"}`,ue=`Exportado: ${new Date().toLocaleString("es-CO")}`;F.push([re]),F.push([ue]),F.push([]),F.push(L);const Ae=4,Pe=nt=>nt?"si":"no";for(const nt of f){const ct=await Ne(Tr(n,nt.id)).catch(()=>null),Ot=ct?ct.docs.map(Ge=>({id:Ge.id,...Ge.data()})):[];for(const Ge of Ot)F.push([nt.nombre||"",Ge.codigo||"",Ge.nombre||"",Pe(!!(Ge.permite_descuento??Ge.permite_desc)),Number(Ge.precio||0),Pe(!!Ge.genera_rips),Pe(!!Ge.es_consulta),Pe(!!Ge.ver_en_agenda),Ge.nombre_en_agenda||"",Number(Ge.tiempo||0),Ge.identificador||"",Ge.cuenta_contable||""])}const Fe=await We(),Oe=`OdontoCloud-ListaPrecios-${l||"Principal"}`;if(Fe&&Fe.utils&&F.length>Ae-1){const nt=Fe.utils.aoa_to_sheet(F);nt["!cols"]=[{wch:22},{wch:14},{wch:36},{wch:12},{wch:14},{wch:12},{wch:12},{wch:14},{wch:28},{wch:10},{wch:16},{wch:18}],nt["!merges"]=[{s:{r:0,c:0},e:{r:0,c:11}},{s:{r:1,c:0},e:{r:1,c:11}}];const ct=F.length;nt["!autofilter"]={ref:`A${Ae}:L${ct}`};const Ot=Fe.utils.book_new();Fe.utils.book_append_sheet(Ot,nt,"Lista de precios");const Ge=Fe.write(Ot,{bookType:"xlsx",type:"array"}),Qn=new Blob([Ge],{type:"application/octet-stream"}),Ht=document.createElement("a");Ht.href=URL.createObjectURL(Qn),Ht.download=`${Oe}.xlsx`,Ht.click(),URL.revokeObjectURL(Ht.href)}else{const nt=F.map(Ge=>Ge.map(Qn=>{const Ht=String(Qn??"").replace(/"/g,'""');return/[",\n]/.test(Ht)?`"${Ht}"`:Ht}).join(",")).join(`
`),ct=new Blob([nt],{type:"text/csv;charset=utf-8"}),Ot=document.createElement("a");Ot.href=URL.createObjectURL(ct),Ot.download=`${Oe}.csv`,Ot.click(),URL.revokeObjectURL(Ot.href)}}catch{alert("No se pudo exportar.")}}const xt=x.useMemo(()=>{const L=hs(O.nombre);return L?ye.filter(F=>hs(F.nombre).includes(L)||hs(F.codigo).startsWith(L)).slice(0,12):[]},[O.nombre,ye]),z=x.useMemo(()=>{const L=hs(O.codigo);return L?ye.filter(F=>hs(F.codigo).startsWith(L)||hs(F.nombre).includes(L)).slice(0,12):[]},[O.codigo,ye]),le=x.useMemo(()=>{const L=hs(O.cuenta_contable);return L?X.filter(F=>hs(F.codigo).startsWith(L)||hs(F.nombre).includes(L)).slice(0,20):z0.slice(0,12)},[O.cuenta_contable,X]);return o.jsxs("div",{className:"oc-main-content lp",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Edicin Lista de precios"})}),N&&o.jsx("div",{style:{marginBottom:12,padding:"8px 12px",border:"1px solid #fecaca",background:"#fef2f2",color:"#991b1b",borderRadius:8},children:N}),o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"toolbar",style:{justifyContent:"space-between",marginBottom:12},children:[o.jsxs("div",{className:"name-row",children:[o.jsx("label",{style:{fontWeight:700},children:"Nombre*"}),o.jsx("input",{className:"text-inp",value:l,placeholder:"Principal",onChange:L=>c(L.target.value)}),o.jsx("button",{className:"btn green",onClick:me,disabled:d,title:"Guardar nombre",children:d?"Guardando":"Guardar"})]}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"chip orange",title:"Incrementar %",onClick:()=>{de(0),he("none"),I(!0)},children:"%"}),o.jsx("button",{className:"chip green",onClick:De,children:"+ Agregar categora"}),o.jsx("button",{className:"chip blue",title:"Exportar",onClick:Xe,children:"Exportar"})]})]}),o.jsx("div",{className:"table-responsive",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{className:"toggle-cell"}),o.jsx("th",{children:"Categora"}),o.jsx("th",{children:"Comentario"}),o.jsx("th",{style:{width:140},children:"Estado"}),o.jsx("th",{style:{width:360,textAlign:"right"},children:"Acciones"})]})}),o.jsx("tbody",{children:_?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):f.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Sin categoras."})}):f.map(L=>o.jsxs(Uh.Fragment,{children:[o.jsxs("tr",{children:[o.jsx("td",{className:"toggle-cell",children:o.jsx("span",{className:"arrow",onClick:()=>_e(L),children:L.expanded?"":""})}),o.jsx("td",{style:{fontWeight:700},children:L.nombre||"Categora"}),o.jsx("td",{className:"muted",children:L.comentario||""}),o.jsx("td",{children:o.jsx("span",{className:`status-pill ${L.activa?"status-on":"status-off"}`,children:L.activa?"Conectado":"Desconectado"})}),o.jsx("td",{style:{textAlign:"right"},children:o.jsxs("div",{className:"row-cat-actions",children:[o.jsx("button",{className:"btn green sm",title:"Nuevo tem",onClick:()=>ve(L),children:""}),o.jsx("button",{className:"btn orange sm",title:"Actualizar precios %",onClick:()=>Ie(L),children:"%"}),o.jsx("button",{className:"btn sky sm",title:"Editar categora",onClick:()=>J(L),children:""}),o.jsx("button",{className:"btn red sm",title:"Eliminar categora",onClick:()=>Z(L),children:""})]})})]}),L.expanded&&o.jsxs("tr",{className:"cat-details",children:[o.jsx("td",{}),o.jsx("td",{colSpan:4,children:o.jsx("div",{className:"table-responsive",children:o.jsxs("table",{className:"inner-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Lista de precios"}),o.jsx("th",{style:{width:160},children:"Permite descuento"}),o.jsx("th",{style:{width:140},children:"Precio"}),o.jsx("th",{style:{width:140,textAlign:"right"},children:"Acciones"})]})}),o.jsx("tbody",{children:!L.items||L.items.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,className:"muted",style:{textAlign:"center",padding:12},children:"Sin tems en esta categora."})}):L.items.map(F=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:F.codigo||""}),o.jsx("td",{style:{fontWeight:600},children:F.nombre||""}),o.jsx("td",{children:F.permite_descuento??F.permite_desc?"S":"No"}),o.jsxs("td",{className:"mono",children:["$",Number(F.precio||0).toLocaleString("es-CO")]}),o.jsx("td",{style:{textAlign:"right"},children:o.jsxs("div",{className:"inner-actions",children:[o.jsx("button",{className:"btn sky sm",onClick:()=>K(L,F),children:""}),o.jsx("button",{className:"btn red sm",onClick:()=>B(L,F),children:""})]})})]},F.id))})]})})})]})]},L.id))})]})}),o.jsx("div",{style:{marginTop:16},children:o.jsx("button",{className:"chip gray",onClick:()=>s(a),children:" Volver"})})]}),E&&o.jsx("div",{className:"modal-mask",onClick:()=>w(!1),children:o.jsxs("div",{className:"modal",onClick:L=>L.stopPropagation(),children:[o.jsx("div",{className:"hd",children:"Categora"}),o.jsxs("div",{className:"bd",children:[o.jsxs("div",{className:"row",style:{gap:6,marginBottom:12},children:[o.jsx("button",{className:`chip ${Ce==="existentes"?"blue":""}`,onClick:()=>Ue("existentes"),children:"Categoras existentes"}),o.jsx("button",{className:`chip ${Ce==="nueva"?"blue":""}`,onClick:()=>Ue("nueva"),children:"Editar/Nueva categora"}),o.jsx("button",{className:"chip green",onClick:ge,children:"Sembrar catlogo base"})]}),Ce==="existentes"?o.jsx("div",{children:$e.length===0?o.jsx("p",{className:"muted",children:"No hay catlogo disponible. Puedes crear una nueva categora en la pestaa de la derecha."}):o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Comentario"}),o.jsx("th",{children:"Acciones"})]})}),o.jsx("tbody",{children:$e.map(L=>o.jsxs("tr",{children:[o.jsx("td",{children:L.nombre}),o.jsx("td",{className:"muted",children:L.comentario||""}),o.jsx("td",{children:o.jsx("button",{className:"btn green sm",onClick:()=>Be(L),children:"Agregar"})})]},L.id))})]})}):o.jsxs("div",{children:[o.jsxs("div",{className:"row",children:[o.jsx("label",{style:{minWidth:140},children:"Nombre *"}),o.jsx("input",{className:"inp",placeholder:"Ingrese el nombre de la categora",value:mt,onChange:L=>gt(L.target.value)})]}),o.jsxs("div",{className:"row",style:{alignItems:"flex-start"},children:[o.jsx("label",{style:{minWidth:140,paddingTop:6},children:"Comentario"}),o.jsx("textarea",{className:"ta",placeholder:"",value:Gt,onChange:L=>H(L.target.value)})]})]})]}),o.jsxs("div",{className:"ft",children:[o.jsx("button",{className:"chip gray",onClick:()=>w(!1),children:"Cerrar"}),Ce==="nueva"&&o.jsx("button",{className:"chip green",onClick:Le,children:"Guardar"})]})]})}),T&&o.jsx("div",{className:"modal-mask",onClick:()=>I(!1),children:o.jsxs("div",{className:"modal",onClick:L=>L.stopPropagation(),children:[o.jsx("div",{className:"hd",children:"Incrementar todos los precios"}),o.jsx("div",{className:"bd",children:o.jsxs("div",{className:"col",children:[o.jsx("label",{className:"label-strong",children:"Porcentaje de incremento *"}),o.jsx("div",{className:"row",children:o.jsx("input",{className:"inp",style:{maxWidth:160},type:"number",min:"0",step:"0.01",placeholder:"0",value:te,onChange:L=>de(L.target.value)})}),o.jsxs("div",{className:"col",style:{gap:8},children:[o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"radio",name:"round",checked:ne==="down",onChange:()=>he("down")})," Redondear hacia abajo"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"radio",name:"round",checked:ne==="up",onChange:()=>he("up")})," Redondear hacia arriba"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"radio",name:"round",checked:ne==="none",onChange:()=>he("none")})," No redondear"]})]})]})}),o.jsxs("div",{className:"ft",children:[o.jsx("button",{className:"chip gray",onClick:()=>I(!1),children:"Cerrar"}),o.jsx("button",{className:"chip green",onClick:rt,children:"Incrementar"})]})]})}),S&&o.jsx("div",{className:"modal-mask",onClick:()=>M(!1),children:o.jsxs("div",{className:"modal",onClick:L=>L.stopPropagation(),children:[o.jsx("div",{className:"hd",children:b==="edit"?o.jsxs(o.Fragment,{children:["Editar producto",g?`  ${g.nombre}`:""]}):o.jsxs(o.Fragment,{children:["Agregar producto",g?`  ${g.nombre}`:""]})}),o.jsxs("div",{className:"bd",children:[o.jsxs("div",{className:"form-grid-3",children:[o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Cdigo *"}),o.jsx(rm,{value:O.codigo,onChange:L=>ee({...O,codigo:L}),placeholder:"Cdigo (ej. 890203)",suggestions:z,onPick:L=>ee({...O,codigo:L.codigo,nombre:L.nombre}),renderRow:L=>o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",children:L.codigo}),o.jsx("span",{className:"ac-name",children:L.nombre})]}),minChars:1})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Nombre *"}),o.jsx(rm,{value:O.nombre,onChange:L=>ee({...O,nombre:L}),placeholder:"Nombre del procedimiento",suggestions:xt,onPick:L=>ee({...O,codigo:L.codigo,nombre:L.nombre}),renderRow:L=>o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",children:L.codigo}),o.jsx("span",{className:"ac-name",children:L.nombre})]}),minChars:1})]}),o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Precio *"}),o.jsx("input",{className:"inp",type:"text",inputMode:"numeric",pattern:"\\\\d*",placeholder:"$0",value:O.precio,onChange:L=>ee({...O,precio:ea(L.target.value)})})]})]}),o.jsx("div",{className:"form-row-full",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Observaciones"}),o.jsx("textarea",{className:"ta",value:O.observaciones,onChange:L=>ee({...O,observaciones:L.target.value})})]})}),o.jsxs("div",{className:"form-row-full",style:{display:"grid",gridTemplateColumns:"160px auto auto",gap:"12px",alignItems:"center"},children:[o.jsxs("div",{className:"field",style:{margin:0},children:[o.jsx("label",{children:"Pago valor fijo a doctores"}),o.jsx("input",{className:"inp",type:"number",min:"0",value:O.pago_valor_fijo,onChange:L=>ee({...O,pago_valor_fijo:L.target.value})})]}),o.jsxs("label",{className:"toggle",style:{marginTop:18},children:[o.jsx("input",{type:"checkbox",checked:O.usa_pago_fijo,onChange:L=>ee({...O,usa_pago_fijo:L.target.checked})}),"Usar valor fijo"]}),o.jsx("div",{className:"muted",children:"Use este campo para no liquidar a los doctores por su % configurado sino por un valor fijo en dinero $"})]}),o.jsxs("div",{className:"form-row-full",style:{display:"flex",gap:18,flexWrap:"wrap"},children:[o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"checkbox",checked:O.permite_descuento,onChange:L=>ee({...O,permite_descuento:L.target.checked,...L.target.checked?{}:{max_descuento_value:""}})}),"Permite descuento"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"checkbox",checked:O.genera_rips,onChange:L=>ee({...O,genera_rips:L.target.checked})}),"Genera RIPS"]}),o.jsxs("label",{className:"toggle",children:[o.jsx("input",{type:"checkbox",checked:O.es_consulta,onChange:L=>ee({...O,es_consulta:L.target.checked})}),"Es consulta"]}),o.jsxs("div",{className:"toggle",children:[o.jsx("span",{children:"Ver en agenda"}),o.jsxs("label",{className:"toggle-pill",children:[o.jsx("input",{type:"checkbox",checked:O.ver_en_agenda,onChange:L=>ee({...O,ver_en_agenda:L.target.checked})}),o.jsx("span",{children:O.ver_en_agenda?"S":"No"})]})]})]}),O.permite_descuento&&o.jsx("div",{className:"form-row-full",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Mximo descuento"}),o.jsxs("div",{className:"seg-wrap",children:[o.jsx("div",{className:`seg ${O.max_descuento_tipo==="pct"?"on":""}`,onClick:()=>ee({...O,max_descuento_tipo:"pct",max_descuento_value:String(O.max_descuento_value).replace(/\D+/g,"")}),title:"Porcentaje",children:"%"}),o.jsx("div",{className:`seg ${O.max_descuento_tipo==="valor"?"on":""}`,onClick:()=>ee({...O,max_descuento_tipo:"valor",max_descuento_value:ea(O.max_descuento_value)}),title:"Valor en $",children:"$"}),O.max_descuento_tipo==="pct"?o.jsx("input",{className:"inp",type:"number",min:"0",step:"0.01",placeholder:"0",value:String(O.max_descuento_value).replace(/[^\d.,-]/g,""),onChange:L=>ee({...O,max_descuento_value:L.target.value})}):o.jsx("input",{className:"inp",type:"text",inputMode:"numeric",placeholder:"$0",value:ea(O.max_descuento_value),onChange:L=>ee({...O,max_descuento_value:ea(L.target.value)})})]})]})}),o.jsx("div",{className:"form-row-full",children:o.jsxs("div",{className:"field",children:[o.jsx("label",{children:"Cuenta contable"}),o.jsx(rm,{value:O.cuenta_contable,onChange:L=>ee({...O,cuenta_contable:L}),placeholder:"Buscar tem...",suggestions:le,onPick:L=>ee({...O,cuenta_contable:`${L.codigo}  ${L.nombre}`}),renderRow:L=>o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"ac-code",style:{minWidth:72},children:L.codigo}),o.jsx("span",{className:"ac-name",children:L.nombre})]}),minChars:0})]})})]}),o.jsxs("div",{className:"ft",children:[o.jsx("button",{className:"chip gray",onClick:()=>M(!1),children:"Cerrar"}),o.jsx("button",{className:"chip green",onClick:Y,children:b==="edit"?"Actualizar":"Guardar"})]})]})})]})}const $l="listas_precios_productos";function OU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function VU(){const[t,e]=x.useState(!0),[n,r]=x.useState([]),{pathname:s}=Fn(),i=as(),a=x.useMemo(()=>OU(s),[s]),l=f=>i(`${a}/config/lista-de-precios/productos/editar/${f.id}`);x.useEffect(()=>{async function f(){e(!0);try{const _=(await Ne(ce(Q,$l))).docs.map(C=>({id:C.id,...C.data()}));_.sort((C,N)=>{const A=C.actualizado||C.creado||"",T=N.actualizado||N.creado||"";return A&&T?String(T).localeCompare(String(A)):((C==null?void 0:C.nombre)||"").localeCompare((N==null?void 0:N.nombre)||"")}),r(_)}catch(m){console.error("[LP Productos] cargar:",m==null?void 0:m.code,m==null?void 0:m.message),r([])}finally{e(!1)}}f()},[]);async function c(){try{const m={nombre:`Lista de productos ${new Date().toLocaleDateString("es-CO")}`,creado:new Date().toLocaleString("es-CO"),actualizado:new Date().toLocaleString("es-CO"),en_uso:!1,tipo:"productos"},_=await Bt(ce(Q,$l),m);r(C=>[{id:_.id,...m},...C])}catch(f){console.error(f),alert("No se pudo crear el listado de productos.")}}async function d(f){try{const _=(await Ne(ce(Q,$l))).docs.map(C=>Ut(Re(Q,$l,C.id),{en_uso:C.id===f.id}));await Promise.all(_),r(C=>C.map(N=>({...N,en_uso:N.id===f.id})))}catch(m){console.error(m),alert("No se pudo cambiar el estado de uso.")}}async function h(f){if(window.confirm(`Eliminar "${f==null?void 0:f.nombre}"?`))try{await Cn(Re(Q,$l,f.id)),r(m=>m.filter(_=>_.id!==f.id))}catch(m){console.error(m),alert("No se pudo eliminar.")}}return o.jsxs("div",{className:"lp-card",children:[o.jsxs("div",{className:"lp-tabs",style:{justifyContent:"space-between"},children:[o.jsx("div",{style:{display:"flex",gap:8},children:o.jsx("span",{className:"lp-pill active",children:"Lista de precios productos"})}),o.jsx("button",{className:"btn blue",onClick:c,children:"+ Nuevo listado de productos"})]}),o.jsx("div",{className:"lp-table-wrap",children:o.jsxs("table",{children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Fecha de creacin"}),o.jsx("th",{children:"Fecha de actualizacin"}),o.jsx("th",{children:"En uso"}),o.jsx("th",{children:"Acciones"})]})}),o.jsx("tbody",{children:t?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:"Cargando"})}):n.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:5,style:{textAlign:"center",padding:20},children:o.jsx("span",{className:"muted",children:"Sin datos"})})}):n.map(f=>o.jsxs("tr",{children:[o.jsx("td",{style:{fontWeight:700},children:(f==null?void 0:f.nombre)||""}),o.jsx("td",{children:(f==null?void 0:f.creado)||""}),o.jsx("td",{children:(f==null?void 0:f.actualizado)||""}),o.jsx("td",{style:{color:f!=null&&f.en_uso?"#16a34a":"#64748b"},children:f!=null&&f.en_uso?"En uso":""}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"btn blue",onClick:()=>l(f),children:"Editar"}),o.jsx("button",{className:"btn green",onClick:()=>d(f),children:"Usar"}),o.jsx("button",{className:"btn red",onClick:()=>h(f),children:"Eliminar"})]})})]},f.id))})]})})]})}function MU(){const[t,e]=x.useState(null),[n,r]=x.useState([]),[s,i]=x.useState(!1),[a,l]=x.useState(0),[c,d]=x.useState(0),h=m=>r(_=>[..._,m]);async function f(){if(!t)return alert("Selecciona el CSV primero.");i(!0),l(0),d(0),r([]);try{const _=(await t.text()).split(/\r?\n/).filter(Boolean),C=_.shift()||"";if(!/codigo\s*;\s*nombre/i.test(C)){h('Encabezado invlido. Usa: "codigo;nombre" o "codigo;nombre;categoria" (separado por ;)'),i(!1);return}const N=250;for(let A=0;A<_.length;A+=N){const T=_.slice(A,A+N);await Promise.all(T.map(async I=>{const E=I.split(";"),w=(E[0]||"").trim().replace(/\./g,""),S=(E[1]||"").trim().replace(/^"|"$/g,""),M=(E[2]||"").trim();if(!w||!S){d(g=>g+1);return}try{await jo(Re(Q,"catalogo_procedimientos",w),{codigo:w,nombre:S,...M?{categoria:M}:{},area:"Odontologa",activo:!0,fuente:"CUPS",version:"2024",updatedAt:new Date().toISOString()},{merge:!0}),l(g=>g+1)}catch(g){d(v=>v+1),h(`Error ${w}: ${(g==null?void 0:g.message)||g}`)}})),h(`Cargado ${Math.min(A+N,_.length)} / ${_.length}`)}h(" Importacin finalizada.")}catch(m){h(` Error: ${(m==null?void 0:m.message)||m}`)}finally{i(!1)}}return o.jsxs("div",{style:{maxWidth:760,margin:"24px auto",background:"#fff",padding:16,borderRadius:12,border:"1px solid #e5e7eb"},children:[o.jsx("h2",{style:{marginTop:0},children:"Importar procedimientos (Odontologa  CUPS 2024)"}),o.jsxs("p",{children:["Sube tu CSV con columnas ",o.jsx("b",{children:"codigo;nombre"})," o ",o.jsx("b",{children:"codigo;nombre;categoria"})," (punto y coma)."]}),o.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[o.jsx("input",{type:"file",accept:".csv",onChange:m=>{var _;return e(((_=m.target.files)==null?void 0:_[0])||null)}}),o.jsx("button",{disabled:!t||s,onClick:f,style:{padding:"8px 12px",borderRadius:8,background:"#22c55e",color:"#fff",border:"none",fontWeight:700},children:s?"Cargando...":"Cargar"})]}),o.jsxs("div",{style:{marginTop:12,display:"flex",gap:12},children:[o.jsxs("span",{children:[" OK: ",a]}),o.jsxs("span",{children:[" Fallidos: ",c]}),s&&o.jsx("span",{children:" Procesando"})]}),o.jsx("pre",{style:{background:"#f8fafc",padding:12,borderRadius:8,marginTop:12,maxHeight:260,overflow:"auto",fontSize:12},children:n.join(`
`)})]})}const Ug=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}),Pr=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),cr=(t,e,n)=>Math.min(n,Math.max(e,Number.isFinite(+t)?+t:e)),FU=(t,e)=>{const n=Pr(t),r=Pr(e);return!n||!r?!1:n===r||n.includes(r)||r.includes(n)},vt=(t,e=0)=>Number.isFinite(+t)?+t:e;function UU(){x.useEffect(()=>{const t="oc-planes-styles-v3";if(document.getElementById(t))return;const e=`
      :root{
        --oc-primary:#3b82f6; --oc-primary-600:#2563eb;
        --oc-green:#22c55e; --oc-green-600:#16a34a;
        --oc-red:#ef4444; --oc-red-600:#dc2626;
        --oc-gray:#e5e7eb; --oc-muted:#64748b;
      }
      .oc-muted{color:var(--oc-muted)} .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
      .oc-input,.oc-select{height:34px;border:1px solid #d6dbe6;border-radius:8px;background:#fff;padding:0 10px;font-size:14px}
      .oc-input:focus,.oc-select:focus{outline:none;border-color:#60a5fa;box-shadow:0 0 0 2px rgba(96,165,250,.15)}
      .oc-btn{display:inline-flex;align-items:center;justify-content:center;height:30px;padding:0 10px;border-radius:8px;border:1px solid var(--oc-gray);background:#fff;color:#0f172a;font-weight:700;font-size:12px;cursor:pointer;transition:.15s}
      .oc-btn:hover{background:#f8fafc} .oc-btn.small{height:26px;padding:0 8px}
      .oc-btn.primary{background:var(--oc-primary);border-color:var(--oc-primary-600);color:#fff}
      .oc-btn.primary:hover{background:var(--oc-primary-600)}
      .oc-btn.success{background:var(--oc-green);border-color:var(--oc-green-600);color:#fff}
      .oc-btn.success:hover{background:var(--oc-green-600)}
      .oc-btn.danger{background:var(--oc-red);border-color:var(--oc-red-600);color:#fff}
      .oc-btn.danger:hover{background:var(--oc-red-600)}
      .oc-btn.outline{background:#fff;color:var(--oc-primary);border-color:var(--oc-primary)}
      .oc-btn.outline:hover{background:#eff6ff}
      .oc-tbl{width:100%;border-collapse:separate;border-spacing:0;border:1px solid #e6e9ef;border-radius:10px;overflow:hidden}
      .oc-tbl thead th{background:#f8fafc;text-align:left;padding:8px 10px;border-bottom:1px solid #e6e9ef;font-weight:700}
      .oc-tbl tbody td{padding:8px 10px;border-bottom:1px solid #f0f3f8}
      .oc-tbl tbody tr:last-child td{border-bottom:0}
      .oc-mask{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:999999;display:flex;align-items:center;justify-content:center}
      .oc-modal{width:min(1200px,96vw);max-height:92vh;background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 22px 60px rgba(0,0,0,.28);display:flex;flex-direction:column}
      .oc-modal-h,.oc-modal-f{padding:10px 12px;border-bottom:1px solid #eef2f7;display:flex;align-items:center;justify-content:space-between}
      .oc-modal-f{border-top:1px solid #eef2f7;border-bottom:0;gap:8;justify-content:flex-end}
      .oc-modal-t{padding:10px 12px;border-bottom:1px solid #eef2f7;display:grid;grid-template-columns:minmax(180px,260px) 1fr minmax(120px,160px) auto;gap:8px;align-items:center}
      .oc-modal-b{padding:12px;overflow:auto}
      .oc-sug{position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #e5e7eb;border-radius:10px;margin-top:4px;max-height:260px;overflow:auto;box-shadow:0 12px 28px rgba(0,0,0,.15);z-index:99}
      .oc-sug-item{padding:8px 10px;display:flex;justify-content:space-between;gap:10px;cursor:pointer}
      .oc-sug-item:hover,.oc-sug-item.is-active{background:#eff6ff}
    `,n=document.createElement("style");n.id=t,n.textContent=e,document.head.appendChild(n)},[])}async function $U(t){var e;try{const n=await Ne(ce(Q,"listas_precios",t,"categorias")).catch(()=>null);if(!n||n.empty)return[];const r=[];for(const s of n.docs){const i=(((e=s.data())==null?void 0:e.nombre)||"").toString().trim(),a=await Ne(ce(Q,"listas_precios",t,"categorias",s.id,"items")).catch(()=>null);!a||a.empty||a.forEach(l=>{const c=l.data()||{},d=(c.codigo||"").toString().trim()||l.id,h=(c.nombre||c.descripcion||d).toString().trim(),f=Number(c.precio??c.valor??0)||0,m=(c.categoria||c.categoriaNombre||c.grupo||i||"").toString().trim()||"Sin categora";r.push({id:l.id,codigo:d,nombre:h,precio:f,categoria:m,max_desc_pct:Number(c.max_desc_pct||c.max_descuento_pct||0),max_desc_valor:Number(c.max_desc_valor||c.max_descuento_valor||0),permite_desc:!!(c.permite_desc??c.permite_descuento??!0),genera_rips:!!c.genera_rips,es_consulta:!!c.es_consulta,ver_en_agenda:!!c.ver_en_agenda,_norm:Pr(`${d} ${h} ${m}`)})})}return r}catch{return[]}}function BU({listaId:t,onClose:e,onLoadLines:n}){const[r,s]=x.useState(["*"]),[i,a]=x.useState("*"),[l,c]=x.useState(""),[d,h]=x.useState(1),[f,m]=x.useState([]),[_,C]=x.useState(!1),[N,A]=x.useState(!1),T=x.useRef(null),[I,E]=x.useState([]),[w,S]=x.useState([]),M=["*","Ciruga Oral","Endodoncia","Implantologa","Odontologa General","Ortodoncia","Periodoncia","Psicologa","Radiologa","Rehabilitacin Oral"];x.useEffect(()=>{let O=!0;return(async()=>{const ee=new Set;let ye=[];try{const He=await Ne(ce(Q,"catalogo_categorias")).catch(()=>null);if(He&&!He.empty&&(ee.add("*"),He.forEach(X=>{const te=X.data()||{},de=(te.nombre||"").toString().trim(),ne=Array.isArray(te.prefijos)?te.prefijos.map(he=>(he||"").toString()):[];de&&(ee.add(de),ye.push({nombre:de,prefijos:ne}))})),t){const X=await Ne(ce(Q,"listas_precios",t,"categorias")).catch(()=>null);X==null||X.forEach(he=>{var Ue;const Ce=(((Ue=he.data())==null?void 0:Ue.nombre)||"").toString().trim();Ce&&ee.add(Ce)});const te=await Ne(ce(Q,"listas_precios",t,"items")).catch(()=>null);te==null||te.forEach(he=>{var Ue,$e,Ke;const Ce=(((Ue=he.data())==null?void 0:Ue.categoria)||(($e=he.data())==null?void 0:$e.categoriaNombre)||((Ke=he.data())==null?void 0:Ke.grupo)||"").toString().trim();Ce&&ee.add(Ce)});const de=Ve(ce(Q,"listas_precios_productos"),Ze("listaId","==",t)),ne=await Ne(de).catch(()=>null);ne==null||ne.forEach(he=>{var Ue,$e,Ke;const Ce=(((Ue=he.data())==null?void 0:Ue.categoria)||(($e=he.data())==null?void 0:$e.categoriaNombre)||((Ke=he.data())==null?void 0:Ke.grupo)||"").toString().trim();Ce&&ee.add(Ce)})}}finally{ee.size===0&&M.forEach(He=>ee.add(He)),ee.has("*")||ee.add("*"),O&&(s(Array.from(ee)),S(ye))}})(),()=>{O=!1}},[t]),x.useEffect(()=>{A(i!=="*")},[i]),x.useEffect(()=>{let O=!0;if(!(Pr(l).length>=2||i!=="*")){m([]);return}return(async()=>{C(!0);try{let ye=[];if(t){const te=await $U(t);te.length&&(ye=te)}if(!ye.length&&t){const te=await Ne(ce(Q,"listas_precios",t,"items")).catch(()=>null);te&&!te.empty&&(ye=te.docs.map(de=>{const ne=de.data()||{},he=(ne.codigo||"").toString().trim()||de.id,Ce=(ne.nombre||ne.descripcion||he).toString().trim(),Ue=Number(ne.precio??ne.valor??0)||0;let $e=(ne.categoria||ne.categoriaNombre||ne.grupo||"").toString().trim();return $e||($e="Sin categora"),{id:de.id,codigo:he,nombre:Ce,precio:Ue,categoria:$e,max_desc_pct:Number(ne.max_desc_pct||ne.max_descuento_pct||0),max_desc_valor:Number(ne.max_desc_valor||ne.max_descuento_valor||0),permite_desc:!!(ne.permite_desc??ne.permite_descuento??!0),genera_rips:!!ne.genera_rips,es_consulta:!!ne.es_consulta,ver_en_agenda:!!ne.ver_en_agenda,_norm:Pr(`${he} ${Ce} ${$e}`)}}))}if(!ye.length&&t){const te=Ve(ce(Q,"listas_precios_productos"),Ze("listaId","==",t)),de=await Ne(te).catch(()=>null);ye=((de==null?void 0:de.docs)||[]).map(ne=>{const he=ne.data()||{},Ce=(he.codigo||"").toString().trim()||ne.id,Ue=(he.nombre||he.descripcion||Ce).toString().trim(),$e=Number(he.precio??he.valor??0)||0;let Ke=(he.categoria||he.categoriaNombre||he.grupo||"").toString().trim();return Ke||(Ke="Sin categora"),{id:ne.id,codigo:Ce,nombre:Ue,precio:$e,categoria:Ke,max_desc_pct:Number(he.max_desc_pct||he.max_descuento_pct||0),max_desc_valor:Number(he.max_desc_valor||he.max_descuento_valor||0),permite_desc:!!(he.permite_desc??he.permite_descuento??!0),genera_rips:!!he.genera_rips,es_consulta:!!he.es_consulta,ver_en_agenda:!!he.ver_en_agenda,_norm:Pr(`${Ce} ${Ue} ${Ke}`)}})}if(!ye.length){const te=await Ne(ce(Q,"catalogo_procedimientos")).catch(()=>null);te==null||te.forEach(de=>{const ne=de.data()||{},he=(ne.codigo||"").toString().trim()||de.id,Ce=(ne.nombre||ne.descripcion||he).toString().trim(),Ue=Number(ne.precio??ne.valor??0)||0;let $e=(ne.categoria||ne.grupo||"").toString().trim()||"Sin categora";ye.push({id:de.id,codigo:he,nombre:Ce,precio:Ue,categoria:$e,max_desc_pct:Number(ne.max_desc_pct||ne.max_descuento_pct||0),max_desc_valor:Number(ne.max_desc_valor||ne.max_descuento_valor||0),permite_desc:!!(ne.permite_desc??ne.permite_descuento??!0),genera_rips:!!ne.genera_rips,es_consulta:!!ne.es_consulta,ver_en_agenda:!!ne.ver_en_agenda,_norm:Pr(`${he} ${Ce} ${$e}`)})})}const He=Pr(l);let X=ye.filter(te=>!(i!=="*"&&!FU(te.categoria||"",i)||He&&!te._norm.includes(He)));X.sort((te,de)=>(te.codigo||"").localeCompare(de.codigo||"")||(te.nombre||"").localeCompare(de.nombre||"")),i!=="*"&&!He&&(X=X.slice(0,70)),O&&m(X)}finally{O&&C(!1)}})(),()=>{O=!1}},[t,i,l]);const g=O=>{const ee=Math.max(1,Number(d)||1);E(ye=>{const He=ye.findIndex(he=>he.codigo===O.codigo),X={codigo:O.codigo,nombre:O.nombre,precio:Number(O.precio||0),cantidad:ee,descuentoPct:0,descuentoValor:0,observaciones:"",_max_desc_pct:Number(O.max_desc_pct||0),_max_desc_valor:Number(O.max_desc_valor||0),_permite_desc:!!(O.permite_desc??!0),_flags:{genera_rips:!!O.genera_rips,es_consulta:!!O.es_consulta,ver_en_agenda:!!O.ver_en_agenda}};if(He>=0){const he=[...ye],Ce={...he[He]};Ce.cantidad=cr((Ce.cantidad||1)+ee,1,999999);const $e=(Ce.precio||X.precio||0)*Ce.cantidad,Ke=$e*cr(Ce.descuentoPct||0,0,X._max_desc_pct||100)/100,mt=cr(Ce.descuentoValor||0,0,X._max_desc_valor||$e),gt=Ce._permite_desc?Math.min(Math.max(Ke,mt),$e):0;return Ce.total=Math.max(0,$e-gt),he[He]=Ce,he}const te=X.precio*ee,ne=Math.max(0,te-0);return[...ye,{...X,total:ne}]})},v=(O,ee)=>{E(ye=>{const He=[...ye],X={...He[O],...ee};X.cantidad=cr(vt(X.cantidad,1),1,999999),X.precio=vt(X.precio,0),X.descuentoPct=cr(vt(X.descuentoPct,0),0,vt(X._max_desc_pct,100)),X.descuentoValor=cr(vt(X.descuentoValor,0),0,Number.isFinite(X._max_desc_valor)?X._max_desc_valor:999999999);const te=X.precio*X.cantidad,de=te*X.descuentoPct/100,ne=cr(X.descuentoValor,0,Number.isFinite(X._max_desc_valor)?X._max_desc_valor:te),he=X._permite_desc?Math.min(Math.max(de,ne),te):0;return X.total=Math.max(0,te-he),He[O]=X,He})},b=O=>E(ee=>ee.filter((ye,He)=>He!==O)),k=()=>{if(!I.length&&f.length){const O=Math.max(1,Number(d)||1),ee=f.map(ye=>({codigo:ye.codigo,nombre:ye.nombre,precio:Number(ye.precio||0),cantidad:O,descuentoPct:0,descuentoValor:0,observaciones:"",_max_desc_pct:Number(ye.max_desc_pct||0),_max_desc_valor:Number(ye.max_desc_valor||0),_permite_desc:!!(ye.permite_desc??!0),_flags:{genera_rips:!!ye.genera_rips,es_consulta:!!ye.es_consulta,ver_en_agenda:!!ye.ver_en_agenda},total:Number(ye.precio||0)*O}));n(ee),e();return}I.length&&n(I),e()},R=N&&(_||f.length>0),V=f.length===0&&Pr(l).length<2&&i==="*",D=!R&&i==="*";return o.jsx("div",{className:"oc-mask",role:"dialog","aria-modal":"true",children:o.jsxs("div",{className:"oc-modal",children:[o.jsxs("div",{className:"oc-modal-h",children:[o.jsx("b",{children:"Agregar productos"}),o.jsx("button",{className:"oc-btn",onClick:e,children:"Cerrar"})]}),o.jsxs("div",{className:"oc-modal-t",children:[o.jsx("select",{className:"oc-select",value:i,onChange:O=>a(O.target.value),children:r.map(O=>o.jsx("option",{value:O,children:O==="*"?"Todas las categoras":O},O))}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("input",{ref:T,className:"oc-input",placeholder:"Buscar tem por cdigo o nombre",value:l,onChange:O=>{c(O.target.value),A(!0)},onFocus:()=>{i!=="*"&&A(!0)}}),R&&o.jsx("div",{className:"oc-sug",children:_?o.jsx("div",{className:"oc-muted",style:{padding:10},children:"Cargando"}):f.length===0?o.jsx("div",{className:"oc-muted",style:{padding:10},children:"Sin resultados."}):f.map(O=>o.jsxs("div",{className:"oc-sug-item",onMouseDown:ee=>{ee.preventDefault(),g(O)},children:[o.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:O.nombre}),o.jsx("div",{className:"mono",style:{opacity:.85},children:O.codigo})]},`${O.id}-${O.codigo}`))})]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:6,justifySelf:"start"},children:[o.jsx("span",{className:"oc-muted",style:{fontSize:12,fontWeight:700},children:"Cantidad"}),o.jsx("input",{type:"number",min:1,value:d,onChange:O=>h(O.target.value),className:"oc-input",style:{width:90}})]}),o.jsx("button",{className:"oc-btn success",onClick:k,children:"Agregar"})]}),o.jsxs("div",{className:"oc-modal-b",children:[V?o.jsx("div",{className:"oc-muted",children:"Escribe al menos 2 caracteres o elige una categora para ver resultados."}):_?o.jsx("div",{className:"oc-muted",children:"Cargando"}):f.length===0?o.jsx("div",{className:"oc-muted",children:"Sin resultados."}):D&&o.jsxs("table",{className:"oc-tbl",style:{marginBottom:10},children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:140},children:"Valor unit."}),o.jsx("th",{style:{width:160},children:"Categora"}),o.jsx("th",{style:{width:120},children:"Acciones"})]})}),o.jsx("tbody",{children:f.map(O=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:O.codigo}),o.jsx("td",{children:O.nombre}),o.jsx("td",{className:"mono",children:Ug.format(O.precio||0)}),o.jsx("td",{children:O.categoria||""}),o.jsx("td",{children:o.jsx("button",{className:"oc-btn success small",onClick:()=>g(O),children:"Agregar"})})]},`${O.id}-${O.codigo}`))})]}),!!I.length&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{margin:"6px 0 8px",fontWeight:700},className:"oc-muted",children:"tems a cargar"}),o.jsxs("table",{className:"oc-tbl",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:120},children:"Valor unit."}),o.jsx("th",{style:{width:80},children:"Cant."}),o.jsx("th",{style:{width:90},children:"Desc. %"}),o.jsx("th",{style:{width:110},children:"Desc. $"}),o.jsx("th",{children:"Observaciones"}),o.jsx("th",{style:{width:120},children:"Total"}),o.jsx("th",{style:{width:140},children:"Acciones"})]})}),o.jsx("tbody",{children:I.map((O,ee)=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:O.codigo}),o.jsx("td",{children:O.nombre}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:Number.isFinite(O.precio)?O.precio:0,onChange:ye=>v(ee,{precio:ye.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:1,value:O.cantidad,onChange:ye=>v(ee,{cantidad:ye.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,max:100,value:O.descuentoPct,onChange:ye=>v(ee,{descuentoPct:ye.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:O.descuentoValor||0,onChange:ye=>v(ee,{descuentoValor:ye.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{value:O.observaciones||"",onChange:ye=>v(ee,{observaciones:ye.target.value}),className:"oc-input"})}),o.jsx("td",{className:"mono",children:Ug.format(O.total||0)}),o.jsx("td",{children:o.jsx("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:o.jsx("button",{className:"oc-btn success small",onClick:()=>b(ee),children:"Quitar"})})})]},ee))})]})]})]}),o.jsxs("div",{className:"oc-modal-f",children:[o.jsx("button",{className:"oc-btn",onClick:e,children:"Cerrar"}),o.jsx("button",{className:"oc-btn success",onClick:k,disabled:!I.length&&!f.length,children:"Cargar"})]})]})})}function zU({planId:t,onBack:e}){const[n,r]=x.useState(null),[s,i]=x.useState([]),[a,l]=x.useState([]),[c,d]=x.useState(!1),[h,f]=x.useState(!1);x.useEffect(()=>{let S=!0;return(async()=>{const M=await Ne(Ve(ce(Q,"listas_precios"),pt("nombre","asc"))).catch(()=>null);S&&i(M?M.docs.map(R=>({id:R.id,...R.data()||{}})):[]);const g=await No(Re(Q,"planes",t));if(!g.exists())return;const v={id:g.id,...g.data()||{}};S&&r(v);const k=(await Ne(ce(Q,"planes",t,"planes_items"))).docs.map(R=>({id:R.id,...R.data()||{}}));S&&l(k)})(),()=>{S=!1}},[t]);const m=(n==null?void 0:n.listaId)||"",_=S=>r(M=>({...M||{},...S})),C=S=>{const M=cr(vt(S.cantidad,1),1,999999),g=vt(S.precio,0),v=!!(S._permite_desc??!0),b=Number.isFinite(S._max_desc_pct)?S._max_desc_pct:100,k=Number.isFinite(S._max_desc_valor)?S._max_desc_valor:1/0,R=cr(vt(S.descuentoPct,0),0,b),V=cr(vt(S.descuentoValor,0),0,k),D=g*M,O=D*(v?R:0)/100,ee=v?cr(V,0,k):0,ye=v?Math.min(Math.max(O,ee),D):0,He=Math.max(0,D-ye);return{...S,cantidad:M,precio:g,descuentoPct:R,descuentoValor:V,total:He}},N=S=>{l(M=>{const g=new Map(M.map(v=>[v.codigo,{...v}]));for(const v of S)if(g.has(v.codigo)){const b={...g.get(v.codigo)};b.cantidad=cr(vt(b.cantidad,1)+vt(v.cantidad,1),1,999999),b.precio=vt(v.precio,b.precio||0),b.descuentoPct=vt(b.descuentoPct,0),b.descuentoValor=vt(b.descuentoValor,0),b.observaciones=b.observaciones||"",b._max_desc_pct=vt(b._max_desc_pct??v._max_desc_pct??0),b._max_desc_valor=vt(b._max_desc_valor??v._max_desc_valor??0),b._permite_desc=b._permite_desc??v._permite_desc??!0,b._flags=b._flags||v._flags||{},g.set(v.codigo,C(b))}else g.set(v.codigo,C({...v,descuentoValor:vt(v.descuentoValor,0)}));return Array.from(g.values())})},A=(S,M)=>{l(g=>{const v=[...g];return v[S]=C({...v[S],...M}),v})},T=async(S,M)=>{if(!(n!=null&&n.id)){l(g=>g.filter((v,b)=>b!==M));return}S&&await Cn(Re(Q,"planes",n.id,"planes_items",S)),l(g=>S?g.filter(v=>v.id!==S):g.filter((v,b)=>b!==M))},I=S=>{alert(`(Demo) Agendar: ${S.codigo}  ${S.nombre}`)},E=S=>{alert(`(Demo) Facturar: ${S.codigo}  ${S.nombre}`)},w=async()=>{var S;if(!((S=n==null?void 0:n.nombre)!=null&&S.trim()))return alert("El nombre del plan es obligatorio.");if(!(n!=null&&n.listaId))return alert("Selecciona la lista de precios.");d(!0);try{await Ut(Re(Q,"planes",n.id),{nombre:n.nombre.trim(),listaId:n.listaId,actualizado:Rt()});const M=ce(Q,"planes",n.id,"planes_items");await Promise.all(a.map(async g=>{const v=C(g),b={codigo:v.codigo||"",nombre:v.nombre||"",precio:vt(v.precio,0),cantidad:vt(v.cantidad,1),descuentoPct:vt(v.descuentoPct,0),descuentoValor:vt(v.descuentoValor,0),observaciones:v.observaciones||"",total:vt(v.total,0),_max_desc_pct:vt(v._max_desc_pct,0),_max_desc_valor:vt(v._max_desc_valor,0),_permite_desc:!!(v._permite_desc??!0),_flags:v._flags||{},actualizado:Rt()};g.id?await Ut(Re(M,g.id),b):await Bt(M,{...b,creado:Rt()})})),alert(" Plan guardado.")}catch(M){console.error(M),alert(" No se pudo guardar el plan.")}finally{d(!1)}};return n?o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("h3",{style:{margin:0},children:"Edicin de plan"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:e,children:"Volver"}),o.jsx("button",{className:"oc-btn primary",onClick:w,disabled:c,children:c?"Guardando":"Guardar cambios"})]})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr",gap:10,alignItems:"center",marginBottom:8},children:[o.jsx("label",{children:"Nombre"}),o.jsx("input",{className:"oc-input",value:n.nombre||"",onChange:S=>_({nombre:S.target.value})})]}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"120px 1fr auto",gap:10,alignItems:"center",marginBottom:16},children:[o.jsx("label",{children:"Lista de precios"}),o.jsxs("select",{className:"oc-select",value:n.listaId||"",onChange:S=>_({listaId:S.target.value}),children:[o.jsx("option",{value:"",children:"Seleccione"}),s.map(S=>o.jsx("option",{value:S.id,children:S.nombre||S.id},S.id))]}),o.jsx("button",{className:"oc-btn outline small",onClick:()=>f(!0),children:"+ Productos"})]}),o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"oc-tbl",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:110},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:120},children:"Valor unit."}),o.jsx("th",{style:{width:80},children:"Cant."}),o.jsx("th",{style:{width:90},children:"Desc. %"}),o.jsx("th",{style:{width:110},children:"Desc. $"}),o.jsx("th",{children:"Observaciones"}),o.jsx("th",{style:{width:120},children:"Total"}),o.jsx("th",{style:{width:220},children:"Acciones"})]})}),o.jsx("tbody",{children:a.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:9,className:"oc-muted",children:"Sin productos en el plan."})}):a.map((S,M)=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:S.codigo}),o.jsx("td",{children:S.nombre}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:Number.isFinite(S.precio)?S.precio:0,onChange:g=>A(M,{precio:g.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:1,value:S.cantidad||1,onChange:g=>A(M,{cantidad:g.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,max:100,value:S.descuentoPct||0,onChange:g=>A(M,{descuentoPct:g.target.value}),className:"oc-input",style:{width:80}})}),o.jsx("td",{children:o.jsx("input",{type:"number",min:0,value:S.descuentoValor||0,onChange:g=>A(M,{descuentoValor:g.target.value}),className:"oc-input",style:{width:110}})}),o.jsx("td",{children:o.jsx("input",{className:"oc-input",value:S.observaciones||"",onChange:g=>A(M,{observaciones:g.target.value})})}),o.jsx("td",{className:"mono",children:Ug.format(vt(S.total,vt(S.precio,0)*vt(S.cantidad,1)))}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[o.jsx("button",{className:"oc-btn outline small",onClick:()=>I(S),children:"Agendar"}),o.jsx("button",{className:"oc-btn outline small",onClick:()=>E(S),children:"Facturar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>T(S.id,M),children:"Eliminar"})]})})]},S.id||`new-${M}`))})]})}),h&&o.jsx(BU,{listaId:m,onClose:()=>f(!1),onLoadLines:N})]}):o.jsx("div",{className:"oc-muted",children:"Cargando plan"})}function Vd({mode:t,planId:e}){UU();const[n,r]=x.useState(t||"list"),[s,i]=x.useState(e||null),[a,l]=x.useState(""),[c,d]=x.useState([]),[h,f]=x.useState(!0),[m,_]=x.useState([]),[C,N]=x.useState({nombre:"",listaId:""});x.useEffect(()=>{let E=!0;return(async()=>{f(!0);try{const w=await Ne(Ve(ce(Q,"listas_precios"),pt("nombre","asc"))).catch(()=>null);E&&_(w?w.docs.map(M=>({id:M.id,...M.data()||{}})):[]);const S=await Ne(Ve(ce(Q,"planes"),pt("nombre","asc")));E&&d(S.docs.map(M=>({id:M.id,...M.data()||{}})))}finally{E&&f(!1)}})(),()=>{E=!1}},[]),x.useEffect(()=>{t&&r(t)},[t]),x.useEffect(()=>{e&&i(e)},[e]);const A=x.useMemo(()=>{const E=Pr(a);return E?c.filter(w=>Pr(`${w.nombre} ${w.listaNombre||""}`).includes(E)):c},[c,a]),T=async()=>{var S;if(!((S=C.nombre)!=null&&S.trim()))return alert("El nombre es obligatorio.");if(!C.listaId)return alert("Selecciona una lista de precios.");const E=m.find(M=>M.id===C.listaId),w=await Bt(ce(Q,"planes"),{nombre:C.nombre.trim(),listaId:C.listaId,listaNombre:(E==null?void 0:E.nombre)||"",creado:Rt(),actualizado:Rt()});d(M=>[...M,{id:w.id,nombre:C.nombre.trim(),listaId:C.listaId,listaNombre:(E==null?void 0:E.nombre)||""}]),N({nombre:"",listaId:""}),i(w.id),r("edit")},I=async E=>{window.confirm(`Eliminar el plan "${E.nombre}"?`)&&(await Cn(Re(Q,"planes",E.id)),d(w=>w.filter(S=>S.id!==E.id)))};return n==="edit"&&s?o.jsx(zU,{planId:s,onBack:()=>{r("list"),i(null)}}):n==="new"?o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Nuevo plan"}),o.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,marginBottom:12},children:o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(220px, 1fr) minmax(240px, 1fr) auto",gap:8,alignItems:"center"},children:[o.jsx("input",{className:"oc-input",placeholder:"Nombre del plan",value:C.nombre,onChange:E=>N(w=>({...w,nombre:E.target.value}))}),o.jsxs("select",{className:"oc-select",value:C.listaId,onChange:E=>N(w=>({...w,listaId:E.target.value})),children:[o.jsx("option",{value:"",children:"Seleccione lista de precios"}),m.map(E=>o.jsx("option",{value:E.id,children:E.nombre||E.id},E.id))]}),o.jsx("button",{className:"oc-btn primary",onClick:T,children:"Crear"})]})}),o.jsx("button",{className:"oc-btn",onClick:()=>r("list"),children:"Volver"})]}):o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Planes"}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,marginBottom:12},children:[o.jsx("h3",{style:{marginTop:0},children:"Nuevo plan"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(220px, 1fr) minmax(240px, 1fr) auto",gap:8,alignItems:"center"},children:[o.jsx("input",{className:"oc-input",placeholder:"Nombre del plan",value:C.nombre,onChange:E=>N(w=>({...w,nombre:E.target.value}))}),o.jsxs("select",{className:"oc-select",value:C.listaId,onChange:E=>N(w=>({...w,listaId:E.target.value})),children:[o.jsx("option",{value:"",children:"Seleccione lista de precios"}),m.map(E=>o.jsx("option",{value:E.id,children:E.nombre||E.id},E.id))]}),o.jsx("button",{className:"oc-btn primary",onClick:T,children:"Crear"})]})]}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[o.jsx("h3",{style:{margin:0},children:"Listado"}),o.jsx("input",{className:"oc-input",placeholder:"Buscar",value:a,onChange:E=>l(E.target.value),style:{minWidth:240}})]}),h?o.jsx("div",{className:"oc-muted",children:"Cargando"}):A.length===0?o.jsx("div",{className:"oc-muted",children:"Sin planes."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"oc-tbl",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Lista de precios"}),o.jsx("th",{style:{width:220},children:"Acciones"})]})}),o.jsx("tbody",{children:A.map(E=>o.jsxs("tr",{children:[o.jsx("td",{children:E.nombre}),o.jsx("td",{children:E.listaNombre||E.listaId||""}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[o.jsx("button",{className:"oc-btn outline small",onClick:()=>{i(E.id),r("edit")},children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>I(E),children:"Eliminar"})]})})]},E.id))})]})})]})]})}const sm=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),Jn=t=>{const e=parseInt(String(t||"0").replace(/\D/g,""),10);return isNaN(e)||e<0?0:e};function qU(){const[t,e]=x.useState([]),[n,r]=x.useState(!0),[s,i]=x.useState(""),[a,l]=x.useState("list"),[c,d]=x.useState(null),[h,f]=x.useState({nombre:"",contReciboCaja:0,contNotaCredito:0,contNotaDebito:0,contEgresos:0,contPresupuestos:0,contPlanTratamiento:0,contOrdenesCompra:0,contCuentasPorCobrar:0,contUsoSaldoAFavor:0,contUsoNotasCredito:0,contRipsAutomatizados:0,numRipsRes2275:0,datosManuales:!1,facturaCompra:!1,facturaVenta:!1,facturacionElectronica:!1,enUso:!1}),m=()=>f({nombre:"",contReciboCaja:0,contNotaCredito:0,contNotaDebito:0,contEgresos:0,contPresupuestos:0,contPlanTratamiento:0,contOrdenesCompra:0,contCuentasPorCobrar:0,contUsoSaldoAFavor:0,contUsoNotasCredito:0,contRipsAutomatizados:0,numRipsRes2275:0,datosManuales:!1,facturaCompra:!1,facturaVenta:!1,facturacionElectronica:!1,enUso:!1}),_=async()=>{r(!0);try{const R=Ve(ce(Q,"consecutivos"),pt("nombre","asc")),D=(await Ne(R)).docs.map(O=>({id:O.id,...O.data()||{}}));e(D)}catch(R){console.error("Error leyendo consecutivos:",R),e([])}finally{r(!1)}};x.useEffect(()=>{_()},[]);const C=x.useMemo(()=>{const R=sm(s);return R?t.filter(V=>sm(`${V.nombre}`).includes(R)):t},[t,s]),N=R=>V=>f(D=>({...D,[R]:!!V.target.checked})),A=R=>V=>f(D=>({...D,[R]:Jn(V.target.value)})),T=R=>{const{name:V,value:D}=R.target;f(O=>({...O,[V]:D}))},I=()=>{d(null),m(),l("form"),window.scrollTo({top:0,behavior:"smooth"})},E=R=>{d(R.id),f({nombre:R.nombre||"",contReciboCaja:R.contReciboCaja??0,contNotaCredito:R.contNotaCredito??0,contNotaDebito:R.contNotaDebito??0,contEgresos:R.contEgresos??0,contPresupuestos:R.contPresupuestos??0,contPlanTratamiento:R.contPlanTratamiento??0,contOrdenesCompra:R.contOrdenesCompra??0,contCuentasPorCobrar:R.contCuentasPorCobrar??0,contUsoSaldoAFavor:R.contUsoSaldoAFavor??0,contUsoNotasCredito:R.contUsoNotasCredito??0,contRipsAutomatizados:R.contRipsAutomatizados??0,numRipsRes2275:R.numRipsRes2275??0,datosManuales:!!R.datosManuales,facturaCompra:!!R.facturaCompra,facturaVenta:!!R.facturaVenta,facturacionElectronica:!!R.facturacionElectronica,enUso:!!R.enUso}),l("form"),window.scrollTo({top:0,behavior:"smooth"})},w=()=>{d(null),m(),l("list")},S=async R=>{var D,O;(D=R==null?void 0:R.preventDefault)==null||D.call(R);const V={...h,contReciboCaja:Jn(h.contReciboCaja),contNotaCredito:Jn(h.contNotaCredito),contNotaDebito:Jn(h.contNotaDebito),contEgresos:Jn(h.contEgresos),contPresupuestos:Jn(h.contPresupuestos),contPlanTratamiento:Jn(h.contPlanTratamiento),contOrdenesCompra:Jn(h.contOrdenesCompra),contCuentasPorCobrar:Jn(h.contCuentasPorCobrar),contUsoSaldoAFavor:Jn(h.contUsoSaldoAFavor),contUsoNotasCredito:Jn(h.contUsoNotasCredito),contRipsAutomatizados:Jn(h.contRipsAutomatizados),numRipsRes2275:Jn(h.numRipsRes2275),nombre_busqueda:sm(h.nombre),actualizado:Rt()};if(!((O=V.nombre)!=null&&O.trim()))return alert("El nombre del consecutivo es obligatorio.");try{if(c?await Ut(Re(Q,"consecutivos",c),V):await Bt(ce(Q,"consecutivos"),{...V,creado:Rt()}),V.enUso)try{const ee=await Ne(ce(Q,"consecutivos"));await Promise.all(ee.docs.filter(ye=>ye.id!==(c||"")).map(ye=>Ut(ye.ref,{enUso:!1})))}catch{}await _(),w(),alert(" Consecutivo guardado.")}catch(ee){console.error("Error guardando consecutivo:",ee),alert(" No se pudo guardar el consecutivo.")}},M=async R=>{if(window.confirm(`Eliminar el consecutivo "${R.nombre}"?`))try{await Cn(Re(Q,"consecutivos",R.id)),await _(),alert(" Consecutivo eliminado.")}catch(V){console.error("Error eliminando consecutivo:",V),alert(" No se pudo eliminar.")}},g=({label:R,name:V,value:D,onChange:O})=>o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:R}),o.jsx("input",{name:V,value:String(D??0),onChange:O,inputMode:"numeric",pattern:"[0-9]*",placeholder:"0"})]}),v=({label:R,name:V,checked:D,onChange:O})=>o.jsxs("label",{className:"oc-switch",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{type:"checkbox",checked:!!D,onChange:O}),o.jsx("span",{children:R})]}),b=()=>o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsx("h3",{style:{marginTop:0},children:c?"Editar consecutivo":"Nuevo consecutivo"}),o.jsxs("form",{onSubmit:S,className:"oc-form-grid",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:12},children:[o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Nombre *"}),o.jsx("input",{name:"nombre",value:h.nombre,onChange:T,required:!0,placeholder:"Nombre del consecutivo"})]}),o.jsx(g,{label:"Cont. Recibo de caja",name:"contReciboCaja",value:h.contReciboCaja,onChange:A("contReciboCaja")}),o.jsx(g,{label:"Cont. Nota crdito",name:"contNotaCredito",value:h.contNotaCredito,onChange:A("contNotaCredito")}),o.jsx(g,{label:"Cont. Nota dbito",name:"contNotaDebito",value:h.contNotaDebito,onChange:A("contNotaDebito")}),o.jsx(g,{label:"Cont. Egresos",name:"contEgresos",value:h.contEgresos,onChange:A("contEgresos")}),o.jsx(g,{label:"Cont. Presupuestos",name:"contPresupuestos",value:h.contPresupuestos,onChange:A("contPresupuestos")}),o.jsx(g,{label:"Cont. Plan de tratamiento",name:"contPlanTratamiento",value:h.contPlanTratamiento,onChange:A("contPlanTratamiento")}),o.jsx(g,{label:"Cont. rdenes de compra",name:"contOrdenesCompra",value:h.contOrdenesCompra,onChange:A("contOrdenesCompra")}),o.jsx(g,{label:"Cont. Cuentas por cobrar",name:"contCuentasPorCobrar",value:h.contCuentasPorCobrar,onChange:A("contCuentasPorCobrar")}),o.jsx(g,{label:"Cont. uso saldo a favor",name:"contUsoSaldoAFavor",value:h.contUsoSaldoAFavor,onChange:A("contUsoSaldoAFavor")}),o.jsx(g,{label:"Cont. uso notas crdito",name:"contUsoNotasCredito",value:h.contUsoNotasCredito,onChange:A("contUsoNotasCredito")}),o.jsx(g,{label:"Cont. RIPS automatizados",name:"contRipsAutomatizados",value:h.contRipsAutomatizados,onChange:A("contRipsAutomatizados")}),o.jsx(g,{label:"Num. RIPS (Res. 2275)",name:"numRipsRes2275",value:h.numRipsRes2275,onChange:A("numRipsRes2275")}),o.jsx("div",{className:"oc-col-2"}),o.jsxs("div",{className:"oc-col-2",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:12},children:[o.jsx(v,{label:"Datos manuales consecutivo?",name:"datosManuales",checked:h.datosManuales,onChange:N("datosManuales")}),o.jsx(v,{label:"Factura de compra",name:"facturaCompra",checked:h.facturaCompra,onChange:N("facturaCompra")}),o.jsx(v,{label:"Factura de venta",name:"facturaVenta",checked:h.facturaVenta,onChange:N("facturaVenta")}),o.jsx(v,{label:"Facturacin electrnica",name:"facturacionElectronica",checked:h.facturacionElectronica,onChange:N("facturacionElectronica")}),o.jsx(v,{label:"Marcar como 'En uso' (por defecto)",name:"enUso",checked:h.enUso,onChange:N("enUso")})]}),o.jsxs("div",{className:"oc-form-actions oc-col-2",style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8},children:[o.jsx("button",{type:"button",className:"oc-btn",onClick:w,children:"Cancelar"}),o.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})]})]})]}),k=()=>o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:10},children:[o.jsx("h3",{style:{margin:0},children:"Consecutivos"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("input",{placeholder:"Buscar por nombre",value:s,onChange:R=>i(R.target.value),className:"search-input",style:{minWidth:240}}),o.jsx("button",{className:"oc-btn primary",onClick:I,children:"+ Nuevo consecutivo"})]})]}),n?o.jsx("div",{className:"oc-muted",children:"Cargando"}):C.length===0?o.jsx("div",{className:"oc-muted",children:"Sin consecutivos."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{className:"mono",style:{width:110},children:"RIPS 2275"}),o.jsx("th",{style:{width:90},children:"En uso"}),o.jsx("th",{style:{width:180},children:"Acciones"})]})}),o.jsx("tbody",{children:C.map(R=>o.jsxs("tr",{children:[o.jsx("td",{children:R.nombre}),o.jsx("td",{className:"mono",children:R.numRipsRes2275??0}),o.jsx("td",{children:R.enUso?"S":"No"}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn small",onClick:()=>E(R),children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>M(R),children:"Eliminar"})]})})]},R.id))})]})})]});return o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Consecutivos"}),a==="form"?b():k()]})}const im=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function HU(){const[t,e]=x.useState("list"),[n,r]=x.useState([]),[s,i]=x.useState(!0),[a,l]=x.useState(""),[c,d]=x.useState([]),[h,f]=x.useState([]),[m,_]=x.useState([]),[C,N]=x.useState([]),[A,T]=x.useState(null),[I,E]=x.useState(!1),[w,S]=x.useState(V()),[M,g]=x.useState(!1),[v,b]=x.useState(null),[k,R]=x.useState(!1);function V(){return{nombre:"",telefonoFijo:"",celular:"",ciudad:"",direccion:"",codigoPostal:"",email:"",consecutivoId:"",listaPreciosId:"",almacenIds:[],pieHabilitado:!1,piePersonalizado:"",codigoPrestador:"",entidadExtranj:"000000",entidadNacional:"000000",centroCostos:"",usuarioSoporteId:"",codigoPrestadorPropio:"",activo:!0}}x.useEffect(()=>{(async()=>{i(!0);try{const[J,Z,Ie,ve,K]=await Promise.all([Ne(Ve(ce(Q,"sucursales"),pt("nombre","asc"))),Ne(Ve(ce(Q,"almacenes"),pt("nombre","asc"))),Ne(Ve(ce(Q,"listas_precios"),pt("nombre","asc"))),Ne(Ve(ce(Q,"consecutivos"),pt("nombre","asc"))),Ne(Ve(ce(Q,"usuarios"),pt("displayName","asc"))).catch(()=>({empty:!0,docs:[]}))]);r(J.docs.map(Y=>({id:Y.id,...Y.data()||{}}))),d(Z.docs.map(Y=>({id:Y.id,...Y.data()||{}}))),f(Ie.docs.map(Y=>({id:Y.id,...Y.data()||{}}))),_(ve.docs.map(Y=>({id:Y.id,...Y.data()||{}}))),N(K.empty?[]:K.docs.map(Y=>({id:Y.id,...Y.data()||{}})))}catch(J){console.error("Error cargando datos:",J),r([]),d([]),f([]),_([]),N([])}finally{i(!1)}})()},[]);const D=async()=>{const J=await Ne(Ve(ce(Q,"sucursales"),pt("nombre","asc")));r(J.docs.map(Z=>({id:Z.id,...Z.data()||{}})))},O=x.useMemo(()=>{const J=im(a);return J?n.filter(Z=>im(`${Z.nombre} ${Z.telefonoFijo} ${Z.celular} ${Z.direccion} ${Z.ciudad} ${Z.email}`).includes(J)):n},[n,a]),ee=J=>{const{name:Z,type:Ie,checked:ve,value:K}=J.target;S(Y=>({...Y,[Z]:Ie==="checkbox"?ve:K}))},ye=()=>{T(null),S(V()),e("new"),window.scrollTo({top:0,behavior:"smooth"})},He=async J=>{T(J.id),S({nombre:J.nombre||"",telefonoFijo:J.telefonoFijo||"",celular:J.celular||"",ciudad:J.ciudad||"",direccion:J.direccion||"",codigoPostal:J.codigoPostal||"",email:J.email||"",consecutivoId:J.consecutivoId||"",listaPreciosId:J.listaPreciosId||"",almacenIds:Array.isArray(J.almacenIds)?J.almacenIds:[],pieHabilitado:!!J.pieHabilitado,piePersonalizado:J.piePersonalizado||"",codigoPrestador:J.codigoPrestador||"",entidadExtranj:J.entidadExtranj||"000000",entidadNacional:J.entidadNacional||"000000",centroCostos:J.centroCostos||"",usuarioSoporteId:J.usuarioSoporteId||"",codigoPrestadorPropio:J.codigoPrestadorPropio||"",activo:typeof J.activo=="boolean"?J.activo:!0}),e("edit"),window.scrollTo({top:0,behavior:"smooth"})},X=()=>{T(null),S(V()),e("list")},te=()=>w.nombre.trim()?w.telefonoFijo.trim()?w.celular.trim()?w.ciudad.trim()?w.direccion.trim()?w.email.trim()?w.consecutivoId?w.listaPreciosId?null:"Selecciona una lista de precios.":"Selecciona un consecutivo.":"El correo electrnico es obligatorio.":"La direccin es obligatoria.":"La ciudad es obligatoria.":"El celular es obligatorio.":"El telfono fijo es obligatorio.":"El nombre es obligatorio.",de=async J=>{J.preventDefault();const Z=te();if(Z)return alert(" "+Z);E(!0);const Ie={...w,nombre_busqueda:im(w.nombre),actualizado:Rt()};try{A?await Ut(Re(Q,"sucursales",A),Ie):await Bt(ce(Q,"sucursales"),{...Ie,creado:Rt()}),await D(),X(),alert(" Sucursal guardada.")}catch(ve){console.error("Error guardando sucursal:",ve),alert(" No se pudo guardar la sucursal.")}finally{E(!1)}},ne=async J=>{if(window.confirm(`Eliminar la sucursal "${J.nombre}"?`))try{await Cn(Re(Q,"sucursales",J.id)),await D(),alert(" Sucursal eliminada.")}catch(Z){console.error("Error eliminando sucursal:",Z),alert(" No se pudo eliminar.")}},he=async J=>{b(J),g(!0)},Ce=async(J,Z)=>{N(Ie=>Ie.map(ve=>ve.id===J?{...ve,sucursalIds:Z?Array.from(new Set([...ve.sucursalIds||[],v])):(ve.sucursalIds||[]).filter(K=>K!==v)}:ve))},Ue=async()=>{if(v){R(!0);try{const J=C.map(async Z=>{const Ie=Array.isArray(Z.sucursalIds)?Z.sucursalIds:[],ve=Re(Q,"usuarios",Z.id),K=await No(ve).catch(()=>null),Y=K!=null&&K.exists()?K.data():{},B=Array.isArray(Y==null?void 0:Y.sucursalIds)?Y.sucursalIds:[],ge=Array.isArray(Z.sucursalIds)?Z.sucursalIds:[];(B.length!==ge.length||B.some(Be=>!ge.includes(Be)))&&await jo(ve,{sucursalIds:ge},{merge:!0})});await Promise.all(J),alert(" Usuarios asociados actualizados."),g(!1)}catch(J){console.error("Error guardando usuarios por oficina:",J),alert(" No se pudo actualizar la asociacin de usuarios.")}finally{R(!1)}}},[$e,Ke]=x.useState([]),[mt,gt]=x.useState([]);x.useEffect(()=>{Ke([]),gt([])},[t,w.almacenIds]);const Gt=x.useMemo(()=>c.filter(J=>!(w.almacenIds||[]).includes(J.id)),[c,w.almacenIds]),H=x.useMemo(()=>(w.almacenIds||[]).map(J=>c.find(Z=>Z.id===J)).filter(Boolean),[c,w.almacenIds]),me=()=>{S(J=>({...J,almacenIds:Array.from(new Set([...J.almacenIds||[],...$e]))})),Ke([])},_e=()=>{S(J=>({...J,almacenIds:(J.almacenIds||[]).filter(Z=>!mt.includes(Z))})),gt([])};if(t==="new"||t==="edit"){const J=t==="new"?"Nueva sucursal":"Editar sucursal";return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("h2",{style:{margin:0},children:J}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:X,children:"Volver"}),o.jsx("button",{className:"oc-btn primary",form:"frmSucursal",disabled:I,children:I?"Guardando...":"Guardar"})]})]}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsx("h3",{style:{marginTop:0},children:"Informacin bsica"}),o.jsxs("form",{id:"frmSucursal",onSubmit:de,className:"oc-form-grid",style:{display:"grid",gridTemplateColumns:"repeat(2,minmax(0,1fr))",gap:12},children:[o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Nombre *"}),o.jsx("input",{name:"nombre",value:w.nombre,onChange:ee,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Telfono fijo *"}),o.jsx("input",{name:"telefonoFijo",value:w.telefonoFijo,onChange:ee,required:!0,inputMode:"tel"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Celular *"}),o.jsx("input",{name:"celular",value:w.celular,onChange:ee,required:!0,inputMode:"tel"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Ciudad *"}),o.jsx("input",{name:"ciudad",value:w.ciudad,onChange:ee,required:!0})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Direccin *"}),o.jsx("input",{name:"direccion",value:w.direccion,onChange:ee,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo postal"}),o.jsx("input",{name:"codigoPostal",value:w.codigoPostal,onChange:ee})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Correo electrnico *"}),o.jsx("input",{type:"email",name:"email",value:w.email,onChange:ee,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Consecutivo *"}),o.jsxs("select",{name:"consecutivoId",value:w.consecutivoId,onChange:ee,required:!0,children:[o.jsx("option",{value:"",children:"Seleccione..."}),m.length===0&&o.jsx("option",{value:"",disabled:!0,children:"(Sin consecutivos)"}),m.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Lista de precios *"}),o.jsxs("select",{name:"listaPreciosId",value:w.listaPreciosId,onChange:ee,required:!0,children:[o.jsx("option",{value:"",children:"Seleccione..."}),h.length===0&&o.jsx("option",{value:"",disabled:!0,children:"(Sin listas de precios)"}),h.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))]})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Almacenes *"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto 1fr",gap:8},children:[o.jsx("select",{multiple:!0,size:8,value:$e,onChange:Z=>Ke([...Z.target.selectedOptions].map(Ie=>Ie.value)),children:Gt.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6,alignItems:"center",justifyContent:"center"},children:[o.jsx("button",{type:"button",className:"oc-btn",onClick:me,title:"Agregar ",children:">"}),o.jsx("button",{type:"button",className:"oc-btn",onClick:_e,title:" Quitar",children:"<"})]}),o.jsx("select",{multiple:!0,size:8,value:mt,onChange:Z=>gt([...Z.target.selectedOptions].map(Ie=>Ie.value)),children:H.map(Z=>o.jsx("option",{value:Z.id,children:Z.nombre||Z.id},Z.id))})]}),o.jsx("small",{className:"oc-muted",children:"Usa los botones para mover almacenes entre disponibles y seleccionados."})]}),o.jsx("div",{className:"oc-col-2",children:o.jsx("hr",{style:{border:"none",borderTop:"1px solid #e5e7eb",margin:"6px 0 2px"}})}),o.jsx("h4",{className:"oc-col-2",style:{margin:"6px 0"},children:"Pie de pgina en documentos clnicos"}),o.jsxs("div",{className:"oc-field",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{id:"pieHabilitado",type:"checkbox",name:"pieHabilitado",checked:w.pieHabilitado,onChange:ee}),o.jsx("label",{htmlFor:"pieHabilitado",children:"Datos de sucursal en pie de pg. doc. clnicos"})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Pie de pgina personalizado doc. clnicos"}),o.jsx("input",{name:"piePersonalizado",value:w.piePersonalizado,onChange:ee,placeholder:"Texto opcional que se mostrar en el pie de pgina"})]}),o.jsx("div",{className:"oc-col-2",children:o.jsx("hr",{style:{border:"none",borderTop:"1px solid #e5e7eb",margin:"6px 0 2px"}})}),o.jsx("h4",{className:"oc-col-2",style:{margin:"6px 0"},children:"Informacin administrativa"}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo del prestador de servicio"}),o.jsx("input",{name:"codigoPrestador",value:w.codigoPrestador,onChange:ee})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo de prestador propio"}),o.jsx("input",{name:"codigoPrestadorPropio",value:w.codigoPrestadorPropio,onChange:ee})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Entidad Administradora Extranjeros"}),o.jsx("input",{name:"entidadExtranj",value:w.entidadExtranj,onChange:ee})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Entidad Administradora Nacionales"}),o.jsx("input",{name:"entidadNacional",value:w.entidadNacional,onChange:ee})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Centro de costos"}),o.jsx("input",{name:"centroCostos",value:w.centroCostos,onChange:ee})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Usuario para soporte"}),o.jsxs("select",{name:"usuarioSoporteId",value:w.usuarioSoporteId,onChange:ee,children:[o.jsx("option",{value:"",children:"Ninguno"}),C.map(Z=>o.jsx("option",{value:Z.id,children:Z.displayName||Z.nombre||Z.email||Z.id},Z.id))]})]})]})]})]})}return o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[o.jsx("h2",{style:{margin:0},children:"Sucursales"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("input",{placeholder:"Buscar por nombre, telfono, direccin, ciudad, correo",value:a,onChange:J=>l(J.target.value),className:"search-input",style:{minWidth:260}}),o.jsx("button",{className:"oc-btn primary",onClick:ye,children:"+ Nueva sucursal"})]})]}),o.jsx("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:s?o.jsx("div",{className:"oc-muted",children:"Cargando"}):O.length===0?o.jsx("div",{className:"oc-muted",children:"Sin sucursales."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{style:{width:120},children:"Telfono"}),o.jsx("th",{children:"Direccin"}),o.jsx("th",{children:"Correo"}),o.jsx("th",{style:{width:140},children:"Usuarios por oficina"}),o.jsx("th",{style:{width:180},children:"Acciones"})]})}),o.jsx("tbody",{children:O.map(J=>{const Z=(C||[]).filter(Ie=>(Ie.sucursalIds||[]).includes(J.id)).length;return o.jsxs("tr",{children:[o.jsx("td",{children:J.nombre}),o.jsx("td",{className:"mono",children:J.telefonoFijo||J.celular||""}),o.jsx("td",{children:J.direccion}),o.jsx("td",{className:"mono",children:J.email}),o.jsx("td",{children:o.jsxs("button",{className:"oc-btn small",onClick:()=>he(J.id),children:[" Ver (",Z,")"]})}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn small",onClick:()=>He(J),children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>ne(J),children:"Eliminar"})]})})]},J.id)})})]})})}),M&&o.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:o.jsxs("div",{style:{background:"#fff",borderRadius:12,width:560,maxWidth:"95%",maxHeight:"90vh",overflow:"auto",padding:16,border:"1px solid #e5e7eb"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[o.jsx("h3",{style:{margin:0},children:"Usuarios asociados"}),o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn",onClick:()=>g(!1),children:"Cerrar"}),o.jsx("button",{className:"oc-btn primary",onClick:Ue,disabled:k,children:k?"Guardando...":"Guardar"})]})]}),C.length===0?o.jsx("div",{className:"oc-muted",children:"No hay usuarios para asociar."}):o.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 120px",gap:8},children:C.map(J=>{const Z=(J.sucursalIds||[]).includes(v);return o.jsxs(Uh.Fragment,{children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{type:"checkbox",checked:Z,onChange:Ie=>Ce(J.id,Ie.target.checked)}),o.jsx("span",{children:J.displayName||J.nombre||J.email||J.id})]}),o.jsx("span",{className:"oc-muted mono",style:{alignSelf:"center"},children:J.email||""})]},J.id)})})]})})]})}const om=t=>(t||"").toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function WU(){const[t,e]=x.useState([]),[n,r]=x.useState(!0),[s,i]=x.useState(""),[a,l]=x.useState(null),[c,d]=x.useState({codigo:"",nombre:"",color:"#38a169",orden:1,activo:!0,descripcion:""}),h=()=>d({codigo:"",nombre:"",color:"#38a169",orden:((t==null?void 0:t.length)||0)+1,activo:!0,descripcion:""}),f=async()=>{r(!0);try{const I=Ve(ce(Q,"especialidades"),pt("orden","asc")),E=await Ne(I);e(E.docs.map(w=>({id:w.id,...w.data()||{}})))}catch(I){console.error("Error leyendo especialidades:",I),e([])}finally{r(!1)}};x.useEffect(()=>{f()},[]);const m=x.useMemo(()=>{const I=om(s);return I?t.filter(E=>om(`${E.codigo} ${E.nombre} ${E.descripcion}`).includes(I)):t},[t,s]),_=I=>{const{name:E,type:w,value:S,checked:M}=I.target;d(g=>({...g,[E]:w==="checkbox"?M:S}))},C=I=>{l(I.id),d({codigo:I.codigo||"",nombre:I.nombre||"",color:I.color||"#38a169",orden:I.orden??1,activo:!!I.activo,descripcion:I.descripcion||""}),window.scrollTo({top:0,behavior:"smooth"})},N=()=>{l(null),h()},A=async I=>{var w,S;I.preventDefault();const E={...c,nombre_busqueda:om(`${c.nombre} ${c.codigo}`),actualizado:Rt()};if(!((w=E.nombre)!=null&&w.trim()))return alert("El nombre es obligatorio.");if(!((S=E.codigo)!=null&&S.trim()))return alert("El cdigo es obligatorio.");try{a?await Ut(Re(Q,"especialidades",a),E):await Bt(ce(Q,"especialidades"),{...E,creado:Rt()}),await f(),N(),alert(" Especialidad guardada.")}catch(M){console.error("Error guardando especialidad:",M),alert(" No se pudo guardar la especialidad.")}},T=async I=>{if(window.confirm(`Eliminar la especialidad "${I.nombre}"?`))try{await Cn(Re(Q,"especialidades",I.id)),await f(),alert(" Especialidad eliminada.")}catch(E){console.error("Error eliminando especialidad:",E),alert(" No se pudo eliminar.")}};return o.jsxs("div",{children:[o.jsx("h2",{style:{marginTop:0},children:"Especialidades"}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16,marginBottom:16},children:[o.jsx("h3",{style:{marginTop:0},children:a?"Editar especialidad":"Nueva especialidad"}),o.jsxs("form",{onSubmit:A,className:"oc-form-grid",style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0,1fr))",gap:12},children:[o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Cdigo *"}),o.jsx("input",{name:"codigo",value:c.codigo,onChange:_,required:!0})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Nombre *"}),o.jsx("input",{name:"nombre",value:c.nombre,onChange:_,required:!0})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{children:"Descripcin"}),o.jsx("textarea",{name:"descripcion",value:c.descripcion,onChange:_,rows:2})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Color"}),o.jsx("input",{name:"color",value:c.color,onChange:_,type:"color"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{children:"Orden"}),o.jsx("input",{name:"orden",value:c.orden,onChange:_,type:"number"})]}),o.jsxs("div",{className:"oc-field",style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("input",{id:"activoEsp",name:"activo",checked:c.activo,onChange:_,type:"checkbox"}),o.jsx("label",{htmlFor:"activoEsp",children:"Activo"})]}),o.jsxs("div",{className:"oc-form-actions oc-col-2",style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8},children:[a&&o.jsx("button",{type:"button",className:"oc-btn",onClick:N,children:"Cancelar"}),o.jsx("button",{type:"submit",className:"oc-btn primary",children:"Guardar"})]})]})]}),o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,marginBottom:10},children:[o.jsx("h3",{style:{margin:0},children:"Listado"}),o.jsx("input",{placeholder:"Buscar por nombre o cdigo",value:s,onChange:I=>i(I.target.value),className:"search-input",style:{minWidth:240}})]}),n?o.jsx("div",{className:"oc-muted",children:"Cargando"}):m.length===0?o.jsx("div",{className:"oc-muted",children:"Sin especialidades."}):o.jsx("div",{className:"table-wrap",children:o.jsxs("table",{className:"appointments-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:90},children:"Cdigo"}),o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Descripcin"}),o.jsx("th",{style:{width:70},children:"Color"}),o.jsx("th",{style:{width:70},children:"Orden"}),o.jsx("th",{style:{width:90},children:"Activo"}),o.jsx("th",{style:{width:160},children:"Acciones"})]})}),o.jsx("tbody",{children:m.map(I=>o.jsxs("tr",{children:[o.jsx("td",{className:"mono",children:I.codigo}),o.jsx("td",{children:I.nombre}),o.jsx("td",{children:I.descripcion}),o.jsx("td",{children:o.jsx("div",{style:{width:18,height:18,borderRadius:4,background:I.color||"#999",border:"1px solid #e5e7eb"}})}),o.jsx("td",{className:"mono",children:I.orden??""}),o.jsx("td",{children:I.activo?"S":"No"}),o.jsx("td",{children:o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("button",{className:"oc-btn small",onClick:()=>C(I),children:"Editar"}),o.jsx("button",{className:"oc-btn danger small",onClick:()=>T(I),children:"Eliminar"})]})})]},I.id))})]})})]})]})}function GU(){const[t,e]=x.useState([]),[n,r]=x.useState({nombre:"",tipo:"Consultorio",sucursal:"",capacidad:1,profesionalesPermitidos:"",activo:!0}),[s,i]=x.useState(null),[a,l]=x.useState(!1);x.useEffect(()=>{const _=Ve(ce(Q,"recursos"),pt("nombre","asc")),C=ln(_,N=>{e(N.docs.map(A=>({id:A.id,...A.data()})))});return()=>C()},[]);const c=_=>{const{name:C,value:N,type:A,checked:T}=_.target;r(I=>({...I,[C]:A==="checkbox"?T:N}))},d=()=>{r({nombre:"",tipo:"Consultorio",sucursal:"",capacidad:1,profesionalesPermitidos:"",activo:!0}),i(null)},h=async _=>{if(_.preventDefault(),!n.nombre.trim()){alert("El nombre es obligatorio.");return}l(!0);try{const C={nombre:n.nombre.trim(),tipo:n.tipo,sucursal:n.sucursal.trim(),capacidad:Number(n.capacidad)||1,profesionalesPermitidos:n.profesionalesPermitidos.split(",").map(N=>N.trim()).filter(Boolean),activo:n.activo};s?await Ut(Re(Q,"recursos",s),C):await Bt(ce(Q,"recursos"),C),d()}catch(C){console.error("Error al guardar consultorio:",C),alert("Error al guardar.")}l(!1)},f=_=>{i(_.id),r({nombre:_.nombre||"",tipo:_.tipo||"Consultorio",sucursal:_.sucursal||"",capacidad:_.capacidad||1,profesionalesPermitidos:(_.profesionalesPermitidos||[]).join(", "),activo:_.activo??!0}),window.scrollTo({top:0,behavior:"smooth"})},m=async _=>{if(window.confirm("Eliminar este consultorio?"))try{await Cn(Re(Q,"recursos",_))}catch(C){console.error("Error al eliminar:",C),alert("No se pudo eliminar.")}};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Consultorios"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:s?"Editar consultorio":"Nuevo consultorio"}),o.jsxs("form",{className:"emp-form",onSubmit:h,children:[o.jsxs("div",{className:"oc-form-grid",children:[o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Nombre *"}),o.jsx("input",{name:"nombre",className:"emp-input",required:!0,value:n.nombre,onChange:c})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Tipo"}),o.jsxs("select",{name:"tipo",className:"emp-select",value:n.tipo,onChange:c,children:[o.jsx("option",{children:"Consultorio"}),o.jsx("option",{children:"Sala"}),o.jsx("option",{children:"Silla"}),o.jsx("option",{children:"Equipo"})]})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Sucursal"}),o.jsx("input",{name:"sucursal",className:"emp-input",value:n.sucursal,onChange:c})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Capacidad"}),o.jsx("input",{name:"capacidad",className:"emp-input",inputMode:"numeric",value:n.capacidad,onChange:c})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Profesionales permitidos"}),o.jsx("input",{name:"profesionalesPermitidos",className:"emp-input",placeholder:"IDs o nombres separados por coma",value:n.profesionalesPermitidos,onChange:c}),o.jsx("small",{style:{color:"#666"},children:"(solo informativo por ahora, se enlaza con doctores ms adelante)"})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Activo"}),o.jsx("input",{name:"activo",type:"checkbox",checked:n.activo,onChange:c})]})]}),o.jsxs("div",{className:"oc-form-actions",children:[o.jsx("button",{type:"submit",className:"oc-btn primary",disabled:a,children:a?"Guardando...":s?"Actualizar":"Guardar"}),s&&o.jsx("button",{type:"button",className:"oc-btn secondary",onClick:d,children:"Cancelar"})]})]})]}),o.jsxs("div",{className:"emp-card",style:{marginTop:"1.5rem"},children:[o.jsx("div",{className:"emp-title",children:"Listado de consultorios"}),t.length===0?o.jsx("p",{style:{padding:"0.5rem 1rem"},children:"No hay consultorios registrados."}):o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Tipo"}),o.jsx("th",{children:"Sucursal"}),o.jsx("th",{children:"Capacidad"}),o.jsx("th",{children:"Activo"}),o.jsx("th",{style:{width:120},children:"Acciones"})]})}),o.jsx("tbody",{children:t.map(_=>o.jsxs("tr",{children:[o.jsx("td",{children:_.nombre}),o.jsx("td",{children:_.tipo}),o.jsx("td",{children:_.sucursal}),o.jsx("td",{children:_.capacidad}),o.jsx("td",{children:_.activo?"S":"No"}),o.jsxs("td",{children:[o.jsx("button",{className:"oc-btn small",onClick:()=>f(_),title:"Editar",children:""}),o.jsx("button",{className:"oc-btn small danger",onClick:()=>m(_.id),title:"Eliminar",children:""})]})]},_.id))})]})]})]})}function KU(){const[t,e]=x.useState([]),[n,r]=x.useState([]),[s,i]=x.useState([]),[a,l]=x.useState({nombreCompleto:"",identificacion:"",registroProfesional:"",entidadRegistro:"",correo:"",telefono:"",especialidades:[],sucursal:"",consultoriosPermitidos:[],disponibilidad:[],activo:!0}),[c,d]=x.useState(null),[h,f]=x.useState(!1),[m,_]=x.useState({dia:"Lunes",desde:"08:00",hasta:"12:00"});x.useEffect(()=>{const g=ln(Ve(ce(Q,"profesionales"),pt("nombreCompleto")),v=>e(v.docs.map(b=>({id:b.id,...b.data()}))));return Ne(ce(Q,"especialidades")).then(v=>r(v.docs.map(b=>({id:b.id,...b.data()})))),Ne(ce(Q,"recursos")).then(v=>i(v.docs.map(b=>({id:b.id,...b.data()})))),()=>g()},[]);const C=g=>{const{name:v,value:b,type:k,checked:R}=g.target;l(V=>({...V,[v]:k==="checkbox"?R:b}))},N=g=>{l(v=>{const b=v.especialidades.includes(g)?v.especialidades.filter(k=>k!==g):[...v.especialidades,g];return{...v,especialidades:b}})},A=g=>{l(v=>{const b=v.consultoriosPermitidos.includes(g)?v.consultoriosPermitidos.filter(k=>k!==g):[...v.consultoriosPermitidos,g];return{...v,consultoriosPermitidos:b}})},T=()=>{l(g=>({...g,disponibilidad:[...g.disponibilidad,{...m}]})),_({dia:"Lunes",desde:"08:00",hasta:"12:00"})},I=g=>{l(v=>({...v,disponibilidad:v.disponibilidad.filter((b,k)=>k!==g)}))},E=()=>{l({nombreCompleto:"",identificacion:"",registroProfesional:"",entidadRegistro:"",correo:"",telefono:"",especialidades:[],sucursal:"",consultoriosPermitidos:[],disponibilidad:[],activo:!0}),d(null)},w=async g=>{if(g.preventDefault(),!a.nombreCompleto.trim())return alert("El nombre es obligatorio.");f(!0);try{const v={...a,nombreCompleto:a.nombreCompleto.trim()};c?await Ut(Re(Q,"profesionales",c),v):await Bt(ce(Q,"profesionales"),v),E()}catch(v){console.error(v),alert("Error al guardar profesional.")}f(!1)},S=g=>{d(g.id),l({...g}),window.scrollTo({top:0,behavior:"smooth"})},M=async g=>{if(window.confirm("Eliminar este profesional?"))try{await Cn(Re(Q,"profesionales",g))}catch(v){console.error(v),alert("Error al eliminar.")}};return o.jsxs("div",{className:"oc-main-content",children:[o.jsx("div",{className:"oc-section-title",children:o.jsx("h2",{children:"Configuracin  Profesionales"})}),o.jsxs("div",{className:"emp-card",children:[o.jsx("div",{className:"emp-title",children:c?"Editar profesional":"Nuevo profesional"}),o.jsxs("form",{className:"emp-form",onSubmit:w,children:[o.jsxs("div",{className:"oc-form-grid",children:[o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Nombre completo *"}),o.jsx("input",{name:"nombreCompleto",className:"emp-input",required:!0,value:a.nombreCompleto,onChange:C})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Identificacin"}),o.jsx("input",{name:"identificacion",className:"emp-input",value:a.identificacion,onChange:C})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Registro profesional"}),o.jsx("input",{name:"registroProfesional",className:"emp-input",value:a.registroProfesional,onChange:C})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Entidad de registro"}),o.jsx("input",{name:"entidadRegistro",className:"emp-input",value:a.entidadRegistro,onChange:C})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Correo"}),o.jsx("input",{name:"correo",type:"email",className:"emp-input",value:a.correo,onChange:C})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Telfono"}),o.jsx("input",{name:"telefono",className:"emp-input",value:a.telefono,onChange:C})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Sucursal"}),o.jsx("input",{name:"sucursal",className:"emp-input",value:a.sucursal,onChange:C})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Especialidades"}),o.jsx("div",{className:"emp-checkbox-list",children:n.map(g=>o.jsxs("label",{style:{marginRight:"1rem"},children:[o.jsx("input",{type:"checkbox",checked:a.especialidades.includes(g.id),onChange:()=>N(g.id)})," ",g.nombre]},g.id))})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Consultorios permitidos"}),o.jsx("div",{className:"emp-checkbox-list",children:s.map(g=>o.jsxs("label",{style:{marginRight:"1rem"},children:[o.jsx("input",{type:"checkbox",checked:a.consultoriosPermitidos.includes(g.id),onChange:()=>A(g.id)})," ",g.nombre]},g.id))})]}),o.jsxs("div",{className:"oc-field oc-col-2",children:[o.jsx("label",{className:"emp-label",children:"Disponibilidad semanal"}),o.jsxs("div",{style:{marginBottom:"0.5rem"},children:[o.jsx("select",{name:"dia",value:m.dia,onChange:g=>_(v=>({...v,dia:g.target.value})),children:["Lunes","Martes","Mircoles","Jueves","Viernes","Sbado"].map(g=>o.jsx("option",{children:g},g))})," ",o.jsx("input",{type:"time",value:m.desde,onChange:g=>_(v=>({...v,desde:g.target.value}))})," ","a"," ",o.jsx("input",{type:"time",value:m.hasta,onChange:g=>_(v=>({...v,hasta:g.target.value}))})," ",o.jsx("button",{type:"button",className:"oc-btn small",onClick:T,children:""})]}),a.disponibilidad.length>0&&o.jsx("ul",{style:{marginLeft:"1rem"},children:a.disponibilidad.map((g,v)=>o.jsxs("li",{children:[g.dia,": ",g.desde," - ",g.hasta," ",o.jsx("button",{type:"button",className:"oc-btn small danger",onClick:()=>I(v),children:""})]},v))})]}),o.jsxs("div",{className:"oc-field",children:[o.jsx("label",{className:"emp-label",children:"Activo"}),o.jsx("input",{name:"activo",type:"checkbox",checked:a.activo,onChange:C})]})]}),o.jsxs("div",{className:"oc-form-actions",children:[o.jsx("button",{type:"submit",className:"oc-btn primary",disabled:h,children:h?"Guardando...":c?"Actualizar":"Guardar"}),c&&o.jsx("button",{type:"button",className:"oc-btn secondary",onClick:E,children:"Cancelar"})]})]})]}),o.jsxs("div",{className:"emp-card",style:{marginTop:"1.5rem"},children:[o.jsx("div",{className:"emp-title",children:"Listado de profesionales"}),t.length===0?o.jsx("p",{style:{padding:"0.5rem 1rem"},children:"No hay profesionales registrados."}):o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Nombre"}),o.jsx("th",{children:"Registro"}),o.jsx("th",{children:"Especialidades"}),o.jsx("th",{children:"Sucursal"}),o.jsx("th",{children:"Activo"}),o.jsx("th",{style:{width:120},children:"Acciones"})]})}),o.jsx("tbody",{children:t.map(g=>{var v;return o.jsxs("tr",{children:[o.jsx("td",{children:g.nombreCompleto}),o.jsx("td",{children:g.registroProfesional}),o.jsx("td",{children:(v=g.especialidades)==null?void 0:v.map(b=>{var k;return((k=n.find(R=>R.id===b))==null?void 0:k.nombre)||""}).join(", ")}),o.jsx("td",{children:g.sucursal||""}),o.jsx("td",{children:g.activo?"S":"No"}),o.jsxs("td",{children:[o.jsx("button",{className:"oc-btn small",onClick:()=>S(g),title:"Editar",children:""}),o.jsx("button",{className:"oc-btn small danger",onClick:()=>M(g.id),title:"Eliminar",children:""})]})]},g.id)})})]})]})]})}const QU={"datos-basicos":SU,logo:TU,"lista-de-precios":w1,planes:Vd,consecutivos:qU,almacenes:void 0,"categorias-inventario":void 0,sucursales:HU,"metodos-de-pago":void 0,bancos:void 0,"formulario-de-pacientes":void 0,especialidades:WU,perfiles:void 0,usuarios:void 0,"condiciones-de-pago":void 0,parametros:void 0,"recursos-fisicos":void 0,"plantillas-doc-clinicos":void 0,"pestanas-consulta-med":void 0,cargos:void 0,impuestos:void 0,"catalogo-de-cuentas":void 0,suscripcion:void 0,consultorios:GU,profesionales:KU,"importar-procedimientos":MU};function YU(t=""){const e=t.toLowerCase().indexOf("/config/");return e===-1?[]:t.slice(e+8).split("/").filter(Boolean)}function XU(t=""){const e=t.split("/").filter(Boolean),n=e.findIndex(r=>r.startsWith("dashboard_"));return n>=0?`/${e.slice(0,n+1).join("/")}`:""}function JU({current:t,onNav:e}){const n=[{slug:"datos-basicos",label:"Datos bsicos"},{slug:"logo",label:"Logo"},{slug:"lista-de-precios",label:"Lista de precios"},{slug:"planes",label:"Planes"},{slug:"consecutivos",label:"Consecutivos"},{slug:"almacenes",label:"Almacenes",soon:!0},{slug:"categorias-inventario",label:"Categoras inventario",soon:!0},{slug:"sucursales",label:"Sucursales"},{slug:"metodos-de-pago",label:"Mtodos de pago",soon:!0},{slug:"bancos",label:"Bancos",soon:!0},{slug:"formulario-de-pacientes",label:"Formulario de pacientes",soon:!0},{slug:"especialidades",label:"Especialidades"},{slug:"perfiles",label:"Perfiles",soon:!0},{slug:"usuarios",label:"Usuarios",soon:!0},{slug:"condiciones-de-pago",label:"Condiciones de pago",soon:!0},{slug:"parametros",label:"Parmetros",soon:!0},{slug:"recursos-fisicos",label:"Recursos fsicos",soon:!0},{slug:"plantillas-doc-clinicos",label:"Plantillas Doc. Clnicos",soon:!0},{slug:"pestanas-consulta-med",label:"Pestaas Consulta Med.",soon:!0},{slug:"cargos",label:"Cargos",soon:!0},{slug:"impuestos",label:"Impuestos",soon:!0},{slug:"catalogo-de-cuentas",label:"Catlogo de cuentas",soon:!0},{slug:"suscripcion",label:"Suscripcin",soon:!0},{slug:"consultorios",label:"Consultorios"},{slug:"profesionales",label:"Profesionales"}];return o.jsxs("aside",{style:{width:300,flex:"0 0 300px",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:12,position:"sticky",top:12,alignSelf:"flex-start",maxHeight:"calc(100vh - 24px)",overflow:"auto"},"aria-label":"Informacin general",children:[o.jsx("h4",{style:{margin:"4px 0 10px",color:"#64748b"},children:"Informacin general"}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:n.map(r=>{const s=r.slug===t;return o.jsxs("button",{type:"button",onClick:()=>!r.soon&&e(r.slug),title:r.soon?"Prximamente":r.label,style:{textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid "+(s?"#60a5fa":"#e5e7eb"),background:s?"#eff6ff":"#f9fafb",fontWeight:600,cursor:r.soon?"not-allowed":"pointer",color:r.soon?"#94a3b8":"#0f172a"},disabled:!!r.soon,children:[r.label," ",r.soon?"  prximamente":""]},r.slug)})})]})}function H0(){return o.jsxs("div",{className:"card",style:{background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:[o.jsx("h3",{style:{marginTop:0},children:"Configuracin"}),o.jsxs("p",{className:"oc-muted",style:{margin:0},children:["Selecciona una seccin del men de la izquierda para empezar (por ejemplo, ",o.jsx("b",{children:"Datos bsicos"}),")."]})]})}function ZU(){const{pathname:t}=Fn(),e=as(),n=YU(t),r=n[0]||"",s=n[1]||"",i=XU(t),a=r==="lista-de-precios"&&!s,l=r==="lista-de-precios"&&s==="productos",c=r==="lista-de-precios"&&s==="editar",d=r==="planes"&&!s,h=r==="planes"&&s==="nuevo",f=r==="planes"&&s==="editar";let m=QU[r]||H0,_={};if(c){const N=n[2]||null;m=LU,_={listaId:N,key:`lpedit-${N||"none"}`}}else l?m=VU:a&&(m=w1);if(r==="planes")if(h)m=Vd,_={mode:"new"};else if(f){const N=n[2]||null;m=Vd,_={mode:"edit",planId:N,key:`pl-edit-${N||"none"}`}}else d&&(m=Vd,_={mode:"list"});const C=N=>e(`${i}/config/${N}`);return x.useEffect(()=>{const N=t.toLowerCase();(N.endsWith("/config")||N.endsWith("/config/"))&&!r&&e(`${i}/config/datos-basicos`,{replace:!0})},[t,r,i,e]),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"300px 1fr",gap:16,background:"#f8fafc",padding:16,borderRadius:12},children:[o.jsx(JU,{current:r,onNav:C}),o.jsx("div",{style:{minWidth:0,background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,padding:16},children:r?o.jsx(m,{..._}):o.jsx(H0,{})})]})}const Gr=t=>(Number(t)||0).toLocaleString("es-CO",{maximumFractionDigits:0}),ta=()=>new Date().toISOString().slice(0,10),e3=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),t3=(t=new Date)=>new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0),W0=t=>it.fromDate(t),n3=()=>{const[t,e]=x.useState(null);return x.useEffect(()=>{const n=Zy(Mh,r=>e(r||null));return()=>n()},[]),t},sn=({children:t,align:e})=>o.jsx("th",{className:"oc-th",style:{position:"sticky",top:0,zIndex:1,textAlign:e||"left",background:"var(--oc-surface, #fff)"},children:t}),r3=()=>Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2);function s3(){var xt;const t=n3(),e=[{key:"abrir",label:"Abrir caja",icon:""},{key:"abiertas",label:"Cajas abiertas",icon:""},{key:"cerradas",label:"Cajas cerradas",icon:""},{key:"mio",label:"Mi caja (hoy)",icon:""},{key:"simulados",label:"Cierres simulados",icon:""},{key:"bancos",label:"Bancos",icon:""}],[n,r]=x.useState("abiertas"),[s,i]=x.useState(""),[a,l]=x.useState(""),c=x.useRef(null),[d,h]=x.useState(!1),[f,m]=x.useState(""),[_,C]=x.useState([]),[N,A]=x.useState(!0),[T,I]=x.useState([]),[E,w]=x.useState(!0),[S,M]=x.useState(null),[g,v]=x.useState(!0),[b,k]=x.useState(""),[R,V]=x.useState([]),[D,O]=x.useState(null),[ee,ye]=x.useState(""),[He,X]=x.useState("efectivo"),[te,de]=x.useState(!1),[ne,he]=x.useState("ingreso"),[Ce,Ue]=x.useState(""),[$e,Ke]=x.useState(""),[mt,gt]=x.useState(!1),[Gt,H]=x.useState([]),[me,_e]=x.useState([]);x.useEffect(()=>{const z=Ve(ce(Q,"cajas"),Ze("estado","==","abierta"),pt("fechaApertura","desc")),le=ln(z,L=>{C(L.docs.map(F=>J(F.id,F.data()))),A(!1),i("")},L=>{console.error(L),i((L==null?void 0:L.code)==="failed-precondition"?"Falta ndice (estado, fechaApertura) en Firestore.":(L==null?void 0:L.code)==="permission-denied"?"Permiso denegado en Firestore (revisa reglas).":"No se pudieron leer las cajas."),A(!1)});return()=>le()},[]),x.useEffect(()=>{const z=Ve(ce(Q,"cajas"),Ze("estado","==","cerrada"),pt("fechaCierre","desc")),le=ln(z,L=>{I(L.docs.map(F=>J(F.id,F.data()))),w(!1)},L=>{console.error(L),w(!1)});return()=>le()},[]),x.useEffect(()=>{if(!t){M(null),v(!1);return}v(!0);const z=Ve(ce(Q,"cajas"),Ze("estado","==","abierta"),Ze("usuarioId","==",t.uid),Ze("fechaApertura",">=",W0(e3())),Ze("fechaApertura","<",W0(t3()))),le=ln(z,L=>{const F=L.docs[0];M(F?J(F.id,F.data()):null),v(!1)},L=>{console.error(L),v(!1),(L==null?void 0:L.code)==="failed-precondition"&&i("Falta ndice (estado, usuarioId, fechaApertura) en Firestore.")});return()=>le()},[t]),x.useEffect(()=>{if(!(S!=null&&S.id)){H([]),_e([]);return}const z=Ve(ce(Q,"movimientos"),Ze("cashId","==",S.id),Ze("dia","==",ta()),pt("fecha","desc")),le=ln(z,re=>H(re.docs.map(ue=>({id:ue.id,...ue.data()}))),re=>console.error(re)),L=Ve(ce(Q,"payments"),Ze("cashId","==",S.id),Ze("dia","==",ta()),pt("fecha","desc")),F=ln(L,re=>_e(re.docs.map(ue=>({id:ue.id,...ue.data()}))),re=>console.error(re));return()=>{le(),F()}},[S==null?void 0:S.id]),x.useEffect(()=>{if(!(b!=null&&b.trim())){V([]);return}const z=Ve(ce(Q,"patients"),Ze("q",">=",B(b)),Ze("q","<=",B(b)+""),pt("q","asc")),le=ln(z,L=>V(L.docs.map(F=>({id:F.id,...F.data()}))),L=>console.error(L));return()=>le()},[b]);function J(z,le={}){const L=nt=>{var ct;return((ct=nt==null?void 0:nt.toDate)==null?void 0:ct.call(nt))||(typeof nt=="string"?new Date(nt):nt||null)},F=L(le.fechaApertura),re=L(le.fechaCierre),ue=Number(le.baseInicial||0),Ae=Number(le.baseActual!==void 0?le.baseActual:ue),Pe=Number(le.saldoInicial||0),Fe=Number(le.saldoActual!==void 0?le.saldoActual:Pe),Oe=[];return Fe<0&&Oe.push("Saldo negativo"),Ae<0&&Oe.push("Base negativa"),{id:z,estado:le.estado||"abierta",usuarioId:le.usuarioId||"",usuarioNombre:le.usuarioNombre||"Usuario",nombre:le.nombre||le.usuarioNombre||"Caja",fechaApertura:F,fechaCierre:re,baseInicial:ue,baseActual:Ae,saldoInicial:Pe,saldoActual:Fe,ia:Oe}}const Z=async z=>{var le;if((le=z==null?void 0:z.preventDefault)==null||le.call(z),!t){i("Debes iniciar sesin para abrir una caja.");return}h(!0);try{const L=Number(f||0);await Bt(ce(Q,"cajas"),{estado:"abierta",usuarioId:t.uid,usuarioNombre:t.displayName||t.email||"Usuario",fechaApertura:Rt(),baseInicial:L,baseActual:L,saldoInicial:0,saldoActual:0,dia:ta()}),m(""),r("mio"),i("")}catch(L){console.error(L),i("No se pudo abrir la caja.")}finally{h(!1)}},Ie=async z=>{try{await Ut(Re(Q,"cajas",z),{estado:"cerrada",fechaCierre:Rt()}),r("cerradas")}catch(le){console.error(le),i("No se pudo cerrar la caja.")}},ve=async z=>{var L;if((L=z==null?void 0:z.preventDefault)==null||L.call(z),!(S!=null&&S.id)){i("Debes abrir tu caja para registrar movimientos.");return}const le=Number($e||0);if(!(!le||le<=0)){gt(!0);try{await Bt(ce(Q,"movimientos"),{cashId:S.id,tipo:ne,concepto:Ce||(ne==="ingreso"?"Ingreso":"Egreso"),valor:le,fecha:Rt(),dia:ta(),usuarioId:(t==null?void 0:t.uid)||null});const F=ne==="ingreso"?le:-le;await Ut(Re(Q,"cajas",S.id),{saldoActual:p0(F)}),Ue(""),Ke("")}catch(F){console.error(F),i("No se pudo registrar el movimiento.")}finally{gt(!1)}}},K=async z=>{var L;if((L=z==null?void 0:z.preventDefault)==null||L.call(z),!(S!=null&&S.id))return i("Abre tu caja para cobrar.");const le=Number(ee||0);if(!(!le||le<=0)){if(!D)return i("Selecciona un paciente.");de(!0);try{const F=await Bt(ce(Q,"payments"),{cashId:S.id,patientId:D.id,patientName:D.nombre||D.name||"Paciente",invoiceId:null,valor:le,medio:He,estado:"aprobado",fecha:Rt(),dia:ta()});await Ut(Re(Q,"cajas",S.id),{saldoActual:p0(le)}),ye(""),X("efectivo"),i(`Pago registrado (${F.id}).`)}catch(F){console.error(F),i("No se pudo registrar el pago.")}finally{de(!1)}}},Y=async z=>{var L;if((L=z==null?void 0:z.preventDefault)==null||L.call(z),!(S!=null&&S.id))return i("Abre tu caja para cobrar.");const le=Number(ee||0);if(!(!le||le<=0)){if(!D)return i("Selecciona un paciente.");de(!0);try{const re=`https://pay.odontocloud/mock/${r3()}`,ue=await Bt(ce(Q,"payments"),{cashId:S.id,patientId:D.id,patientName:D.nombre||D.name||"Paciente",invoiceId:null,valor:le,medio:"link",estado:"pending",linkUrl:re,fecha:Rt(),dia:ta()});i(`Link de pago generado: ${re}`),ye("")}catch(F){console.error(F),i("No se pudo generar link de pago.")}finally{de(!1)}}},B=z=>(z||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),ge=x.useMemo(()=>{const z=B(a);return z?_.filter(le=>[le.nombre,le.usuarioNombre,Gr(le.saldoActual),Gr(le.baseActual)].map(B).some(L=>L.includes(z))):_},[a,_]),De=()=>o.jsxs("div",{className:"card",children:[o.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:o.jsx("h3",{children:"Abrir caja"})}),o.jsxs("form",{className:"oc-form",onSubmit:Z,style:{display:"flex",gap:12,alignItems:"end",flexWrap:"wrap"},children:[o.jsxs("label",{style:{display:"inline-flex",flexDirection:"column",gap:6},children:[o.jsx("span",{children:"Base inicial (COP)"}),o.jsx("input",{type:"number",className:"oc-input",min:"0",step:"1000",value:f,onChange:z=>m(z.target.value),placeholder:"0"})]}),o.jsx("button",{className:"oc-btn",type:"submit",disabled:d,children:d?"Abriendo...":"Abrir caja"})]}),o.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Se asociar a tu usuario y quedar visible en ",o.jsx("b",{children:"Mi caja (hoy)"}),"."]})]}),Be=()=>o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"card",style:{marginBottom:10},children:o.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[o.jsx("h3",{style:{margin:0},children:"Cajas Abiertas"}),o.jsx("span",{className:"oc-tag",children:ge.length}),s&&o.jsx("span",{className:"oc-tag oc-tag-danger",children:s})]}),o.jsx("input",{ref:c,className:"oc-input",style:{maxWidth:280},placeholder:"Buscar...",value:a,onChange:z=>l(z.target.value)})]})}),o.jsx("div",{className:"card",children:o.jsx("div",{className:"oc-table-wrap",children:o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{className:"oc-thead",children:o.jsxs("tr",{className:"oc-tr",children:[o.jsx(sn,{children:"Caja"}),o.jsx(sn,{children:"Fecha apertura"}),o.jsx(sn,{align:"right",children:"Base actual"}),o.jsx(sn,{align:"right",children:"Saldo inicial"}),o.jsx(sn,{align:"right",children:"Saldo actual"}),o.jsx(sn,{children:"Usuario"}),o.jsx(sn,{children:"Acciones"})]})}),o.jsx("tbody",{className:"oc-tbody",children:N?o.jsx(G0,{cols:7}):ge.length===0?o.jsx("tr",{className:"oc-tr",children:o.jsx("td",{className:"oc-td",colSpan:7,children:o.jsx("span",{className:"oc-muted",children:"Sin cajas abiertas."})})}):ge.map(z=>{var le;return o.jsxs("tr",{className:"oc-tr",children:[o.jsxs("td",{className:"oc-td",children:[o.jsx("b",{children:z.nombre})," ",(le=z.ia)!=null&&le.length?o.jsx("span",{className:"oc-tag oc-tag-danger",title:z.ia.join("  "),children:"IA"}):null]}),o.jsx("td",{className:"oc-td",children:z.fechaApertura?z.fechaApertura.toLocaleString("es-CO"):""}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Gr(z.baseActual)]}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Gr(z.saldoInicial)]}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right",color:z.saldoActual<0?"#b91c1c":void 0,fontWeight:600},children:["$",Gr(z.saldoActual)]}),o.jsx("td",{className:"oc-td",children:z.usuarioNombre}),o.jsxs("td",{className:"oc-td",style:{whiteSpace:"nowrap"},children:[o.jsx("button",{className:"oc-small-btn",onClick:()=>r("mio"),children:"Ver"})," ",o.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Ie(z.id),children:"Cerrar"})]})]},z.id)})})]})})})]}),Le=()=>o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"oc-card-head",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[o.jsx("h3",{children:"Mi caja (hoy)"}),(S==null?void 0:S.estado)==="abierta"&&o.jsxs("div",{style:{display:"flex",gap:8},children:[o.jsx("span",{className:"oc-tag oc-tag-success",children:"Abierta"}),o.jsx("button",{className:"oc-small-btn oc-danger",onClick:()=>Ie(S.id),children:"Cerrar caja"})]})]}),g?o.jsx("div",{className:"oc-muted",children:"Cargando"}):S?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"oc-stats-row",style:{marginBottom:12},children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:"Base actual"}),o.jsxs("span",{className:"stat-value",children:["$",Gr(S.baseActual)]})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:"Saldo actual"}),o.jsxs("span",{className:"stat-value",style:{color:S.saldoActual<0?"#b91c1c":void 0},children:["$",Gr(S.saldoActual)]})]})]}),o.jsxs("div",{className:"card",style:{marginBottom:12},children:[o.jsx("h4",{style:{marginBottom:8},children:"Cobro rpido"}),o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:8},children:[o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("label",{className:"oc-muted",children:"Paciente"}),o.jsx("input",{className:"oc-input",placeholder:"Buscar nombre o documento",value:b,onChange:z=>k(z.target.value)}),b&&R.length>0&&o.jsx("div",{className:"oc-dropdown",children:R.slice(0,6).map(z=>o.jsx("button",{className:`oc-menu-item ${(D==null?void 0:D.id)===z.id?"active":""}`,onClick:()=>{O(z),k(z.nombre||z.name||z.doc||"")},type:"button",children:(z.nombre||z.name||"Paciente")+(z.doc?`  ${z.doc}`:"")},z.id))})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("label",{className:"oc-muted",children:"Monto (COP)"}),o.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:ee,onChange:z=>ye(z.target.value)})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[o.jsx("label",{className:"oc-muted",children:"Medio"}),o.jsxs("select",{className:"oc-input",value:He,onChange:z=>X(z.target.value),children:[o.jsx("option",{value:"efectivo",children:"Efectivo"}),o.jsx("option",{value:"tarjeta",children:"Tarjeta"}),o.jsx("option",{value:"transferencia",children:"Transferencia"}),o.jsx("option",{value:"link",children:"Link (en lnea)"})]})]}),o.jsx("div",{style:{display:"flex",alignItems:"end",gap:6},children:He==="link"?o.jsx("button",{className:"oc-btn",onClick:Y,disabled:te,children:te?"Creando":"Generar link"}):o.jsx("button",{className:"oc-btn",onClick:K,disabled:te,children:te?"Guardando":"Registrar pago"})})]}),o.jsxs("p",{className:"oc-muted",style:{marginTop:8},children:["Para link, el saldo se actualiza cuando el pago pase a ",o.jsx("b",{children:"aprobado"})," (webhook)."]})]}),o.jsxs("div",{className:"card",style:{marginBottom:12},children:[o.jsx("h4",{style:{marginBottom:8},children:"Movimiento manual"}),o.jsxs("form",{onSubmit:ve,style:{display:"grid",gridTemplateColumns:"120px 1fr 180px auto",gap:8},children:[o.jsxs("select",{className:"oc-input",value:ne,onChange:z=>he(z.target.value),children:[o.jsx("option",{value:"ingreso",children:"Ingreso"}),o.jsx("option",{value:"egreso",children:"Egreso"})]}),o.jsx("input",{className:"oc-input",placeholder:"Concepto (ej. Caja chica, Arriendo, etc.)",value:Ce,onChange:z=>Ue(z.target.value)}),o.jsx("input",{className:"oc-input",type:"number",min:"0",step:"1000",placeholder:"0",value:$e,onChange:z=>Ke(z.target.value)}),o.jsx("button",{className:"oc-btn",disabled:mt,children:mt?"Guardando":"Agregar"})]})]}),o.jsxs("div",{className:"card",children:[o.jsx("h4",{style:{marginBottom:8},children:"Movimientos y pagos (hoy)"}),o.jsx("div",{className:"oc-table-wrap",style:{marginBottom:12},children:o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{className:"oc-thead",children:o.jsxs("tr",{className:"oc-tr",children:[o.jsx(sn,{children:"Tipo"}),o.jsx(sn,{children:"Concepto / Paciente"}),o.jsx(sn,{children:"Medio"}),o.jsx(sn,{children:"Estado"}),o.jsx(sn,{align:"right",children:"Valor"}),o.jsx(sn,{children:"Hora"})]})}),o.jsx("tbody",{className:"oc-tbody",children:Gt.length===0&&me.length===0?o.jsx("tr",{className:"oc-tr",children:o.jsx("td",{className:"oc-td",colSpan:6,children:o.jsx("span",{className:"oc-muted",children:"Sin movimientos ni pagos an."})})}):o.jsxs(o.Fragment,{children:[me.map(z=>{var le,L;return o.jsxs("tr",{className:"oc-tr",children:[o.jsx("td",{className:"oc-td",children:"Pago"}),o.jsxs("td",{className:"oc-td",children:[z.patientName||"Paciente"," ",z.linkUrl?o.jsx("a",{href:z.linkUrl,target:"_blank",rel:"noreferrer",children:"(link)"}):null]}),o.jsx("td",{className:"oc-td",children:z.medio}),o.jsx("td",{className:"oc-td",children:o.jsx("span",{className:`oc-tag ${z.estado==="aprobado"?"oc-tag-success":z.estado==="pending"?"oc-tag-warning":"oc-tag-danger"}`,children:z.estado})}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Gr(z.valor)]}),o.jsx("td",{className:"oc-td",children:(L=(le=z.fecha)==null?void 0:le.toDate)!=null&&L.call(le)?z.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`pay-${z.id}`)}),Gt.map(z=>{var le,L;return o.jsxs("tr",{className:"oc-tr",children:[o.jsx("td",{className:"oc-td",children:z.tipo}),o.jsx("td",{className:"oc-td",children:z.concepto}),o.jsx("td",{className:"oc-td",children:""}),o.jsx("td",{className:"oc-td",children:o.jsx("span",{className:"oc-tag",children:(z.tipo==="ingreso","ok")})}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Gr(z.valor)]}),o.jsx("td",{className:"oc-td",children:(L=(le=z.fecha)==null?void 0:le.toDate)!=null&&L.call(le)?z.fecha.toDate().toLocaleTimeString("es-CO"):""})]},`mov-${z.id}`)})]})})]})}),o.jsx("p",{className:"oc-muted",children:"Sugerencia: crea ndice compuesto para `movimientos(cashId, dia, fecha)` y `payments(cashId, dia, fecha)` para rendimiento."})]})]}):o.jsxs("div",{className:"oc-empty",children:[o.jsx("p",{className:"oc-muted",children:"No tienes una caja abierta hoy."}),o.jsx("button",{className:"oc-btn",onClick:()=>r("abrir"),children:"Abrir caja"})]})]}),We=()=>o.jsxs("div",{className:"card",children:[o.jsx("div",{className:"oc-card-head",style:{marginBottom:8},children:o.jsxs("h3",{children:["Cajas cerradas ",o.jsx("span",{className:"oc-tag",children:T.length})]})}),o.jsx("div",{className:"oc-table-wrap",children:o.jsxs("table",{className:"oc-table",children:[o.jsx("thead",{className:"oc-thead",children:o.jsxs("tr",{className:"oc-tr",children:[o.jsx(sn,{children:"Caja"}),o.jsx(sn,{children:"Usuario"}),o.jsx(sn,{children:"Apertura"}),o.jsx(sn,{children:"Cierre"}),o.jsx(sn,{align:"right",children:"Saldo final"})]})}),o.jsx("tbody",{className:"oc-tbody",children:E?o.jsx(G0,{cols:5}):T.length===0?o.jsx("tr",{className:"oc-tr",children:o.jsx("td",{className:"oc-td",colSpan:5,children:o.jsx("span",{className:"oc-muted",children:"Sin cajas cerradas."})})}):T.map(z=>o.jsxs("tr",{className:"oc-tr",children:[o.jsx("td",{className:"oc-td",children:z.nombre}),o.jsx("td",{className:"oc-td",children:z.usuarioNombre}),o.jsx("td",{className:"oc-td",children:z.fechaApertura?z.fechaApertura.toLocaleString("es-CO"):""}),o.jsx("td",{className:"oc-td",children:z.fechaCierre?z.fechaCierre.toLocaleString("es-CO"):""}),o.jsxs("td",{className:"oc-td",style:{textAlign:"right"},children:["$",Gr(z.saldoActual)]})]},z.id))})]})})]}),be=()=>o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Cierres simulados"}),o.jsx("p",{className:"oc-muted",children:"El cierre hipottico compara ventas y movimientos detectando errores y descuadres con IA. (Conectar fuente de datos para activarlo)."})]}),rt=()=>o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Bancos"}),o.jsx("p",{className:"oc-muted",children:"Conciliacin de consignaciones/pagos electrnicos contra caja del da. (Conectar pasarela o extractos para habilitar)."})]}),Xe=({m:z})=>o.jsxs("button",{type:"button",onClick:()=>r(z.key),className:`oc-menu-item ${n===z.key?"active":""}`,style:{width:"100%",textAlign:"left",padding:"10px 12px",borderRadius:10,border:"1px solid transparent",background:n===z.key?"var(--oc-surface-2, #f3f6ff)":"transparent",fontWeight:600},title:z.label,children:[o.jsx("span",{style:{opacity:.8,marginRight:6},children:z.icon}),z.label]});return o.jsxs("div",{className:"oc-main-content",style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:16},children:[o.jsx("aside",{className:"card",role:"navigation","aria-label":"Men de caja",style:{height:"fit-content",padding:12},children:o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:e.map(z=>o.jsx(Xe,{m:z},z.key))})}),o.jsxs("section",{children:[o.jsx("div",{className:"card",style:{marginBottom:12,padding:12},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[o.jsxs("div",{className:"oc-breadcrumb",children:[o.jsx("span",{children:"Caja"}),o.jsx("span",{children:""}),o.jsx("b",{children:(xt=e.find(z=>z.key===n))==null?void 0:xt.label})]}),n==="abiertas"&&o.jsx("input",{ref:c,className:"oc-input",placeholder:"Buscar...",value:a,onChange:z=>l(z.target.value),style:{maxWidth:300}})]})}),n==="abrir"&&o.jsx(De,{}),n==="abiertas"&&o.jsx(Be,{}),n==="cerradas"&&o.jsx(We,{}),n==="mio"&&o.jsx(Le,{}),n==="simulados"&&o.jsx(be,{}),n==="bancos"&&o.jsx(rt,{})]})]})}function G0({cols:t=6,n:e=3}){return o.jsx(o.Fragment,{children:Array.from({length:e}).map((n,r)=>o.jsx("tr",{className:"oc-tr",children:Array.from({length:t}).map((s,i)=>o.jsx("td",{className:"oc-td",children:o.jsx("div",{style:{height:12,width:i===0?160:100+i%3*40,background:"var(--oc-skeleton, #e5e7eb)",borderRadius:6}})},i))},r))})}function i3({items:t=[]}){return o.jsxs("div",{className:"card activity-card",children:[o.jsx("h4",{children:"Actividad reciente"}),o.jsx("ul",{className:"activity-list",children:t.map(e=>o.jsxs("li",{children:[o.jsx("strong",{children:e.title}),o.jsx("div",{className:"time",children:e.time})]},e.id))})]})}function o3({status:t}){return t?o.jsxs("div",{className:"card",children:[o.jsx("h4",{children:"Automatizaciones (N8N)"}),o.jsxs("div",{className:"n8n-line",children:[o.jsx("strong",{children:"Conectado:"})," ",t.connected?"S":"No"]}),o.jsxs("div",{className:"n8n-line",children:[o.jsx("strong",{children:"Flujos activos:"})," ",t.flowsRunning]}),t.lastError&&o.jsxs("div",{className:"n8n-error",children:["Error: ",t.lastError]})]}):null}const am={es:{nav_home:"Inicio",nav_agenda:"Agenda",nav_patients:"Pacientes",nav_billing:"Facturacin",nav_inventory:"Inventario",nav_odontogram:"Odontograma",nav_reports:"Reportes",nav_cash:"Caja",nav_admin:"Administracin",welcomeTitle:"Bienvenido a OdontoCloud",welcomeSubtitle:"Administra tus pacientes, agenda, inventario y facturacin de manera inteligente y moderna.",clinicLabel:"Clnica",userLabel:"Usuario",roleLabel:"Rol",searchPlaceholder:"Buscar acciones o ir a",stats_patientsToday:"Pacientes totales",stats_appointmentsToday:"Citas hoy",stats_revenueToday:"Facturacin hoy",stats_waiting:"En espera",stats_currency:"COP",n8n_title:"Automatizaciones (n8n)",recent_title:"Actividad reciente",recent_empty:"Sin actividad registrada.",loading:"Cargando...",logout:"Cerrar sesin",module_coming:"Mdulo prximamente.",todays_appts:"Citas de hoy",see_schedule:"Ir a Agenda",no_appts_today:"No hay citas programadas hoy.",at:"a las"},en:{nav_home:"Overview",nav_agenda:"Schedule",nav_patients:"Patients",nav_billing:"Billing",nav_inventory:"Inventory",nav_odontogram:"Odontogram",nav_reports:"Reports",nav_cash:"Cash",nav_admin:"Administration",welcomeTitle:"Welcome to OdontoCloud",welcomeSubtitle:"Manage your patients, schedule, inventory and billing in a smart and modern way.",clinicLabel:"Clinic",userLabel:"User",roleLabel:"Role",searchPlaceholder:"Search actions or go to",stats_patientsToday:"Total patients",stats_appointmentsToday:"Appointments today",stats_revenueToday:"Revenue today",stats_waiting:"In waiting room",stats_currency:"COP",n8n_title:"Automations (n8n)",recent_title:"Recent activity",recent_empty:"No activity yet.",loading:"Loading...",logout:"Log out",module_coming:"Module coming soon.",todays_appts:"Today's appointments",see_schedule:"Open Schedule",no_appts_today:"No appointments today.",at:"at"}},E1=()=>typeof navigator>"u"||(navigator.language||navigator.userLanguage||"es").toLowerCase().startsWith("es")?"es":"en",a3=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},l3=()=>x.useMemo(()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1,0,0,0,0);return{startToday:it.fromDate(e),endToday:it.fromDate(n),startTodayJS:e}},[]),c3=t=>`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`,u3=(t,e)=>t.toLocaleTimeString(e==="es"?"es-CO":"en-US",{hour:"2-digit",minute:"2-digit"}),d3=(t,e)=>{try{const[n,r,s]=(t||"").split("-").map(l=>parseInt(l,10)),[i=0,a=0]=(e||"00:00").split(":").map(l=>parseInt(l,10));return new Date(n,(r||1)-1,s||1,i,a,0,0)}catch{return new Date}};function h3({data:t=[]}){const s=Math.max(1,...t.map(d=>Number(d.value)||0)),i=t.length||7,a=10,l=Math.max(16,Math.min(44,(640-a*(i+1))/i)),c=(l+a)*i+a;return o.jsx("div",{style:{width:"100%",overflowX:"auto"},children:o.jsxs("svg",{width:c,height:240,role:"img","aria-label":"Pacientes registrados por da en la ltima semana",children:[[.25,.5,.75,1].map((d,h)=>{const f=18+(1-d)*182;return o.jsx("line",{x1:0,x2:c,y1:f,y2:f,stroke:"#e5e7eb",strokeDasharray:"4 4"},h)}),t.map((d,h)=>{const f=Number(d.value)||0,m=Math.round(f/s*182),_=a+h*(l+a),C=200-m;return o.jsxs("g",{children:[o.jsx("rect",{x:_,y:C,width:l,height:m,rx:"6",ry:"6",fill:f>0?"#0ea5e9":"#cbd5e1",children:o.jsx("title",{children:`${d.label||d.shortLabel||""}  ${f} paciente${f!==1?"s":""}`})}),f>0&&m>14&&o.jsx("text",{x:_+l/2,y:C-6,textAnchor:"middle",fontSize:"11",fill:"#0f172a",children:f}),o.jsx("text",{x:_+l/2,y:214,textAnchor:"middle",fontSize:"11",fill:"#64748b",children:d.shortLabel||""})]},h)})]})})}function f3({onNavigate:t,onAction:e,placeholder:n}){const[r,s]=x.useState(""),[i,a]=x.useState(!1),[l,c]=x.useState(0),d=x.useRef(null),h=x.useMemo(()=>[{group:"Navegacin",label:"Ir a Inicio",keywords:"inicio home overview",run:()=>t==null?void 0:t("Inicio")},{group:"Navegacin",label:"Ir a Agenda",keywords:"agenda calendario schedule",run:()=>t==null?void 0:t("Agenda")},{group:"Navegacin",label:"Ir a Pacientes",keywords:"pacientes",run:()=>t==null?void 0:t("Pacientes")},{group:"Navegacin",label:"Ir a Facturacin",keywords:"facturacion facturas billing",run:()=>t==null?void 0:t("Facturacin")},{group:"Navegacin",label:"Ir a Inventario",keywords:"inventario stock",run:()=>t==null?void 0:t("Inventario")},{group:"Navegacin",label:"Ir a Odontograma",keywords:"odontograma",run:()=>t==null?void 0:t("Odontograma")},{group:"Navegacin",label:"Ir a Reportes",keywords:"reportes informes",run:()=>t==null?void 0:t("Reportes")},{group:"Acciones",label:"Nueva cita",keywords:"nueva cita agendar",run:()=>e==null?void 0:e("new_appointment")},{group:"Acciones",label:"Nuevo paciente",keywords:"nuevo paciente alta",run:()=>e==null?void 0:e("new_patient")},{group:"Acciones",label:"Nueva factura",keywords:"nueva factura",run:()=>e==null?void 0:e("new_invoice")},{group:"Acciones",label:"Exportar agenda",keywords:"exportar agenda",run:()=>e==null?void 0:e("export_agenda")},{group:"Acciones",label:"Ir a hoy (Agenda)",keywords:"hoy today",run:()=>e==null?void 0:e("agenda_today")},{group:"Acciones",label:"Cambiar modo oscuro",keywords:"oscuro dark mode",run:()=>e==null?void 0:e("toggle_dark")},{group:"Acciones",label:"Cerrar sesin",keywords:"logout salir cerrar",run:()=>e==null?void 0:e("logout")},{group:"Ayuda",label:"Ver atajos de teclado",keywords:"atajos ayuda",run:()=>e==null?void 0:e("show_shortcuts")},{group:"Ayuda",label:"Soporte / Contacto",keywords:"soporte ayuda contacto",run:()=>e==null?void 0:e("support")}],[t,e]),f=x.useMemo(()=>{const N=r.toLowerCase().trim();return N?h.filter(A=>A.label.toLowerCase().includes(N)||A.keywords.includes(N)):[]},[r,h]);x.useEffect(()=>{const N=A=>{d.current&&(d.current.contains(A.target)||a(!1))};return document.addEventListener("mousedown",N),()=>document.removeEventListener("mousedown",N)},[]);const m=N=>{var A;(A=N.run)==null||A.call(N),s(""),a(!1)},_=N=>{!i||f.length===0||(N.key==="ArrowDown"&&(N.preventDefault(),c(A=>(A+1)%f.length)),N.key==="ArrowUp"&&(N.preventDefault(),c(A=>(A-1+f.length)%f.length)),N.key==="Enter"&&(N.preventDefault(),f[l]&&m(f[l])),N.key==="Escape"&&a(!1))},C=x.useMemo(()=>{const N=new Map;return f.forEach(A=>{N.has(A.group)||N.set(A.group,[]),N.get(A.group).push(A)}),Array.from(N.entries())},[f]);return o.jsxs("div",{className:"oc-search-wrap",ref:d,children:[o.jsx("input",{className:"oc-search",type:"search",inputMode:"search",placeholder:n,"aria-label":n,value:r,onChange:N=>{s(N.target.value),a(!!N.target.value),c(0)},onFocus:()=>a(!!r),onKeyDown:_}),i&&o.jsx("div",{className:"oc-search-dropdown",role:"listbox","aria-label":"Resultados de comandos",children:C.length===0?o.jsx("div",{className:"oc-search-item empty",children:"Escribe para ver opciones"}):C.map(([N,A])=>o.jsxs("div",{children:[o.jsx("div",{className:"oc-search-group",children:N}),A.map(T=>{const I=f.indexOf(T);return o.jsx("button",{className:`oc-search-item ${I===l?"active":""}`,onMouseEnter:()=>c(I),onClick:()=>m(T),role:"option",children:o.jsx("span",{className:"oc-search-title",children:T.label})},T.label)})]},N))})]})}function p3({open:t,anchorRect:e,onClose:n,onSoon:r,onNavigatePath:s,onSetFactView:i,dark:a}){const[l,c]=x.useState(null),d=x.useRef(null);if(x.useEffect(()=>{if(!t)return;const O=ye=>ye.key==="Escape"&&(n==null?void 0:n()),ee=()=>n==null?void 0:n();return window.addEventListener("keydown",O),window.addEventListener("scroll",ee,!0),()=>{window.removeEventListener("keydown",O),window.removeEventListener("scroll",!0)}},[t,n]),!t)return null;const h=((e==null?void 0:e.bottom)||60)+8,f=Math.max(12,Math.min(((e==null?void 0:e.left)||300)-160,window.innerWidth-920)),m=10,_=f+360+m,C=a?"#0b1220":"#ffffff",N=a?"#e5e7eb":"#0f172a",A=a?"#0f1a32":"#f3f6ff",T=a?"#1f2a44":"#e2e8f0",I=a?"#b6c1d1":"#475569",E={position:"fixed",top:h,left:f,width:880,maxWidth:"calc(100vw - 24px)",background:C,color:N,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${T}`,zIndex:400,padding:12},w={position:"fixed",top:h,left:_,width:420,maxWidth:"calc(100vw - 24px)",background:C,color:N,borderRadius:14,boxShadow:"0 18px 40px rgba(2,6,23,.18)",border:`1px solid ${T}`,zIndex:410,padding:12},S={display:"flex",flexDirection:"column",gap:6,padding:"8px 10px"},M={height:38,borderRadius:10,padding:"0 12px",display:"flex",alignItems:"center",gap:8,fontSize:".92rem",cursor:"pointer",border:"1px solid transparent",background:"transparent",color:N,fontWeight:500,textAlign:"left"},g=(O,ee=!0)=>Object.assign(O.currentTarget.style,ee?{background:A,borderColor:T}:{background:"transparent",borderColor:"transparent"}),v=()=>{d.current&&clearTimeout(d.current)},b=()=>{v(),d.current=setTimeout(()=>n==null?void 0:n(),180)},k={position:"fixed",top:h,left:f+360,width:m,height:520,zIndex:405},R=[{label:"Recibo de caja",key:"recibo",path:"facturacion/recibo"},{label:"Saldo a favor",key:"saldo",path:"facturacion/saldo"},{label:"Nota crdito",key:"nc",path:"facturacion/nc"},{label:"Nota dbito",key:"nd",path:"facturacion/nd"},{label:"Liquidaciones",key:"liq",path:"facturacion/liq"},{label:"Traslados",key:"tras",path:"facturacion/tras"},{label:"Pagos",key:"pagos",path:"facturacion/pagos"},{label:"rdenes de compra",key:"oc",path:"facturacion/oc"},{label:"Factura de venta",key:"fv",path:"facturacion/facturas"},{label:"Facturas de compra",key:"fc",path:"facturacion/fc"}],V=[{label:"RIPS anteriores (RS-3374)",key:"rips3374"},{label:"RIPS nuevo (RS-2275)",key:"rips2275"}],D=O=>{i==null||i(O.key),s==null||s(O.path),n==null||n()};return o.jsxs(o.Fragment,{children:[o.jsx("div",{onClick:n,style:{position:"fixed",inset:0,background:"transparent",zIndex:399}}),o.jsx("div",{style:E,onMouseEnter:v,onMouseLeave:b,children:o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"360px 1fr",gap:8,alignItems:"start"},children:[o.jsxs("div",{style:S,children:[o.jsx("button",{type:"button",style:M,onMouseEnter:()=>{v(),c("facturacion")},onFocus:()=>{v(),c("facturacion")},onClick:()=>c(O=>O==="facturacion"?null:"facturacion"),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Facturacin "}),o.jsx("button",{type:"button",style:M,onMouseEnter:()=>{v(),c("rips")},onFocus:()=>{v(),c("rips")},onClick:()=>c(O=>O==="rips"?null:"rips"),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" RIPS "}),o.jsx("button",{type:"button",style:M,onClick:()=>s==null?void 0:s("agenda"),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Gestin de agenda"}),o.jsx("button",{type:"button",style:M,onClick:()=>s==null?void 0:s("inventario"),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Inventario"}),o.jsx("button",{type:"button",style:M,onClick:()=>r==null?void 0:r(),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Convenios"}),o.jsx("button",{type:"button",style:M,onClick:()=>r==null?void 0:r(),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Terceros"}),o.jsx("button",{type:"button",style:M,onClick:()=>r==null?void 0:r(),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Campaas"}),o.jsx("button",{type:"button",style:M,onClick:()=>r==null?void 0:r(),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Temperatura y humedad"}),o.jsx("button",{type:"button",style:M,onClick:()=>r==null?void 0:r(),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Residuos"}),o.jsx("button",{type:"button",style:M,onClick:()=>r==null?void 0:r(),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Medicamentos y planes"}),o.jsx("button",{type:"button",style:M,onClick:()=>r==null?void 0:r(),onMouseOver:O=>g(O,!0),onMouseOut:O=>g(O,!1),children:" Esterilizacin"})]}),o.jsx("div",{style:S,children:o.jsxs("div",{style:{fontSize:".85rem",color:I},children:["Accesos rpidos a mdulos de administracin. Pasa el mouse por ",o.jsx("b",{children:"Facturacin"})," o ",o.jsx("b",{children:"RIPS"})," para ver sus acciones."]})})]})}),o.jsx("div",{style:k,onMouseEnter:v,onMouseLeave:b}),l&&o.jsx("div",{style:w,onMouseEnter:v,onMouseLeave:b,children:o.jsx("div",{style:{...S,display:"grid",gridTemplateColumns:"1fr"},children:(l==="facturacion"?R:V).map(O=>o.jsx("button",{type:"button",style:M,onClick:()=>l==="facturacion"?D(O):r==null?void 0:r(),onMouseOver:ee=>g(ee,!0),onMouseOut:ee=>g(ee,!1),children:O.label},O.label))})})]})}function m3(){return o.jsx("div",{className:"oc-main-content",children:o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Planes"}),o.jsxs("p",{className:"oc-muted",children:["Vista de Planes integrada. En el siguiente paso reemplazamos este placeholder por el mdulo real (",o.jsx("code",{children:"modules/planes/Planes.jsx"}),") con creacin/edicin, estados y vnculo a facturacin."]})]})})}function g3({t,companyName:e,userName:n,role:r,darkMode:s,weeklySeries:i,weekRangeLabel:a,todaysAppointments:l,todaysLoading:c,metrics:d,metricsLoading:h,n8nState:f,n8nLoading:m,recent:_,recentLoading:C,onGoAgenda:N}){return o.jsxs("div",{className:"oc-main-content",children:[o.jsxs("section",{className:"oc-hero","aria-label":"Resumen general",children:[o.jsxs("div",{className:"oc-hero-text",children:[o.jsx("h1",{children:t("welcomeTitle")}),o.jsx("p",{children:t("welcomeSubtitle")}),o.jsxs("p",{className:"oc-hero-meta",children:[t("clinicLabel"),": ",e,"  ",t("userLabel"),": ",n,"  ",t("roleLabel"),": ",r||""]})]}),o.jsxs("div",{className:"oc-hero-badge","aria-live":"polite",children:[o.jsx("span",{className:"oc-hero-badge-title",children:t("stats_appointmentsToday")}),o.jsx("span",{className:"oc-hero-badge-value",children:h&&c?"":d.citasHoy}),o.jsxs("span",{className:"oc-hero-badge-sub",children:[t("stats_patientsToday"),": ",h?"":d.pacientesHoy]})]})]}),o.jsxs("section",{className:"oc-stats-row","aria-label":"Indicadores del da",children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_patientsToday")}),o.jsx("span",{className:"stat-value",children:d.pacientesHoy})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_appointmentsToday")}),o.jsx("span",{className:"stat-value",children:d.citasHoy})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_revenueToday")}),o.jsxs("span",{className:"stat-value",children:[d.facturacionHoy.toLocaleString("es-CO")," ",o.jsx("span",{className:"stat-currency",children:t("stats_currency")})]})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("span",{className:"stat-label",children:t("stats_waiting")}),o.jsx("span",{className:"stat-value",children:d.enEspera})]})]}),o.jsxs("section",{className:"oc-grid","aria-label":"Contenido principal del dashboard",children:[o.jsx("div",{className:"oc-grid-main",children:o.jsxs("div",{className:"card card-quickcharts",children:[o.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[o.jsx("h3",{children:"Pacientes registrados  ltimos 7 das"}),o.jsx("span",{className:"oc-muted",style:{marginLeft:8,fontSize:12},children:a})]}),i.length===0||i.every(A=>((A==null?void 0:A.value)||0)===0)?o.jsx("p",{className:"oc-weekly-empty",children:"Sin pacientes registrados en la ltima semana."}):o.jsx(h3,{data:i})]})}),o.jsxs("aside",{className:"oc-grid-side","aria-label":"Panel lateral",children:[o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:t("n8n_title")}),m?o.jsx("span",{className:"oc-muted",children:t("loading")}):o.jsx(o3,{status:f})]}),o.jsxs("div",{className:"card",children:[o.jsxs("div",{className:"oc-card-head",style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[o.jsx("h3",{children:t("todays_appts")}),o.jsx("button",{className:"oc-small-link",type:"button",onClick:N,children:t("see_schedule")})]}),c?o.jsx("span",{className:"oc-muted",children:t("loading")}):l.length===0?o.jsx("p",{className:"oc-muted",children:t("no_appts_today")}):o.jsx("ul",{className:"oc-list",children:l.slice(0,5).map(A=>o.jsxs("li",{className:"oc-list-item",children:[o.jsxs("div",{className:"oc-list-main",children:[o.jsx("b",{children:A.pacienteNombre||"Paciente"})," ",o.jsxs("span",{className:"oc-muted",children:[t("at")," ",u3(A.fecha,E1())]})]}),o.jsx("div",{className:`oc-tag oc-tag-${(A.estado||"programada").toLowerCase().replace(/\s+/g,"-")}`,children:A.estado||"programada"})]},A.id))})]}),o.jsxs("div",{className:"card",children:[o.jsx("h3",{children:"Actividad reciente"}),C?o.jsx("span",{className:"oc-muted",children:t("loading")}):_.length===0?o.jsx("p",{className:"oc-muted",children:t("recent_empty")}):o.jsx(i3,{items:_})]})]})]}),o.jsxs("footer",{className:"oc-footer",children:[" ",new Date().getFullYear()," OdontoCloud | Creado por Ingeniero Juan Madrid"]})]})}function lm(){const t=as(),e=Fn(),[n]=x.useState(E1()),r=K=>am[n][K]||K,[s,i]=x.useState("Inicio"),[a,l]=x.useState("recibo"),[c,d]=x.useState(()=>{try{return localStorage.getItem("odontocloud:dark")==="1"}catch{return!1}});x.useEffect(()=>{try{localStorage.setItem("odontocloud:dark",c?"1":"0")}catch{}document.documentElement.classList.toggle("dark",c)},[c]);const[h]=x.useState(()=>a3()),[f]=x.useState((h==null?void 0:h.rol)||""),[m]=x.useState((h==null?void 0:h.email)||""),[_,C]=x.useState("OdontoCloud"),[N,A]=x.useState(m||"Usuario"),[T,I]=x.useState(!0);x.useEffect(()=>{const K=Zy(Mh,async Y=>{try{if(!Y){A(m||"Usuario"),C("OdontoCloud"),I(!1);return}A(Y.displayName||Y.email||m||"Usuario");const B=Re(Q,"empresas",Y.uid),ge=await No(B);C(ge.exists()&&ge.data().nombre||"OdontoCloud")}catch(B){console.error("Error cargando empresa/usuario:",B)}finally{I(!1)}});return()=>K()},[m]);const[E,w]=x.useState({pacientesHoy:0,citasHoy:0,facturacionHoy:0,enEspera:0}),[S,M]=x.useState(!0),[g,v]=x.useState([]),[b,k]=x.useState([]),[R,V]=x.useState(!0),{startToday:D,endToday:O,startTodayJS:ee}=l3(),ye=x.useMemo(()=>c3(ee),[ee]),He=x.useMemo(()=>{const K=new Date,Y=new Date(K.getFullYear(),K.getMonth(),K.getDate()-6),B=K,ge=De=>De.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit",month:"short"}).replace(".","");return`${ge(Y)}  ${ge(B)}`},[n]),X=K=>{var Be;const Y=K.data()||{};let B;if((Be=Y.fecha)!=null&&Be.toDate){B=Y.fecha.toDate();const Le=Y.horaInicio||Y.hora;if(Le&&typeof Le=="string"){const[We=0,be=0]=Le.split(":").map(rt=>parseInt(rt,10));B.setHours(We||0,be||0,0,0)}}else if(typeof Y.fecha=="string"){const Le=Y.horaInicio||Y.hora||"00:00";B=d3(Y.fecha,Le)}else B=new Date;const ge=Y.pacienteNombre||Y.paciente||"Paciente",De=Y.estado&&String(Y.estado)||"programada";return{id:K.id,fecha:B,pacienteId:Y.pacienteId||"",pacienteNombre:ge,estado:De,motivo:Y.motivo||""}};x.useEffect(()=>{const K=Ve(ce(Q,"citas"),Ze("fecha",">=",D),Ze("fecha","<",O),pt("fecha","asc")),Y=Ve(ce(Q,"citas"),Ze("fecha","==",ye));let B=new Map,ge=!1,De=!1;const Be=()=>{const be=Array.from(B.values()).sort((Xe,xt)=>Xe.fecha.getTime()-xt.fecha.getTime()),rt=be.filter(Xe=>String(Xe.estado).toLowerCase().trim()==="en espera").length;k(be),w(Xe=>({...Xe,citasHoy:be.length,enEspera:rt})),ge&&De&&V(!1)},Le=ln(K,be=>{ge=!0;const rt=new Map(B);be.docs.forEach(Xe=>rt.set(Xe.id,X(Xe))),B=rt,Be()},be=>{console.error("Realtime citas hoy (TS):",be),ge=!0,Be()}),We=ln(Y,be=>{De=!0;const rt=new Map(B);be.docs.forEach(Xe=>rt.set(Xe.id,X(Xe))),B=rt,Be()},be=>{console.error("Realtime citas hoy (STR):",be),De=!0,Be()});return()=>{try{Le(),We()}catch{}}},[D,O,ye]),x.useEffect(()=>{(async()=>{try{const B=(await fF(ce(Q,"pacientes"))).data().count||0;let ge=0;try{const De=Ve(ce(Q,"facturas"),Ze("fecha",">=",D),Ze("fecha","<",O));(await Ne(De)).forEach(Le=>{const We=Le.data();typeof We.monto=="number"&&(ge+=We.monto)})}catch{ge=0}w(De=>({...De,pacientesHoy:B,facturacionHoy:ge}))}catch(Y){console.error("Error cargando mtricas:",Y),w(B=>({...B,pacientesHoy:0,facturacionHoy:0}))}finally{M(!1)}})()},[D,O]),x.useEffect(()=>{const K=new Date,Y=new Date(K.getFullYear(),K.getMonth(),K.getDate()-6),B=new Date(K.getFullYear(),K.getMonth(),K.getDate()+1),ge=new Map;for(let Le=0;Le<7;Le++){const We=new Date(K.getFullYear(),K.getMonth(),K.getDate()-(6-Le)),be=We.toISOString().slice(0,10),rt=We.toLocaleDateString(n==="es"?"es-ES":"en-US"),Xe=We.toLocaleDateString(n==="es"?"es-ES":"en-US",{weekday:"short",day:"2-digit"}).replace(".","");ge.set(be,{label:rt,shortLabel:Xe,value:0})}const De=Ve(ce(Q,"pacientes"),Ze("createdAt",">=",it.fromDate(Y)),Ze("createdAt","<",it.fromDate(B))),Be=ln(De,Le=>{const We=new Map(ge);Le.docs.forEach(be=>{var le;const rt=be.data()||{},Xe=(le=be.data().createdAt)!=null&&le.toDate?be.data().createdAt.toDate():rt.createdAt?new Date(rt.createdAt):null;if(!Xe||isNaN(Xe))return;const xt=Xe.toISOString().slice(0,10);if(!We.has(xt))return;const z=We.get(xt);z.value+=1,We.set(xt,z)}),v(Array.from(We.values()))},Le=>{console.error("Error realtime serie semanal (pacientes):",Le),v(Array.from(ge.values()))});return()=>{try{Be()}catch{}}},[n]);const[te,de]=x.useState([]),[ne,he]=x.useState(!0);x.useEffect(()=>{(async()=>{try{const Y=Ve(ce(Q,"actividad"),pt("fecha","desc"),Ra(5)),B=await Ne(Y);de(B.docs.map(ge=>({id:ge.id,title:ge.data().descripcion||ge.data().titulo||"Actividad",time:ge.data().resumenTiempo||""})))}catch(Y){console.error("Error cargando actividad:",Y),de([])}finally{he(!1)}})()},[]);const[Ce,Ue]=x.useState(null),[$e,Ke]=x.useState(!0);x.useEffect(()=>{(async()=>{try{const Y=Re(Q,"integraciones","n8n"),B=await No(Y);Ue(B.exists()?{connected:!!B.data().connected,flowsRunning:B.data().flowsRunning||0,lastError:B.data().lastError||null}:{connected:!1,flowsRunning:0,lastError:null})}catch(Y){console.error("Error cargando estado n8n:",Y),Ue({connected:!1,flowsRunning:0,lastError:"No se pudo leer el estado desde Firebase."})}finally{Ke(!1)}})()},[]);const mt=async()=>{try{localStorage.removeItem("odc_session")}catch{}try{await _2(Mh)}catch(K){console.error("Error al cerrar sesin:",K)}window.location.href="/"},[gt,Gt]=x.useState(!1),[H,me]=x.useState(null),_e=x.useRef(null);x.useRef(null);const J=()=>{var Y,B;const K=(B=(Y=_e.current)==null?void 0:Y.getBoundingClientRect)==null?void 0:B.call(Y);me(K),Gt(!0)};x.useEffect(()=>{const K=e.pathname.toLowerCase(),Y=/\/pacientes\/[^/]+\/planes(\/|$)/.test(K)||K.includes("/planes"),B=K.includes("/pacientes")&&!Y,ge=K.includes("/caja"),De=K.includes("/agenda"),Be=K.includes("/facturacion"),Le=K.includes("/inventario"),We=K.includes("/odontograma"),be=K.includes("/reportes"),rt=K.includes("/config");i(Y?"Planes":B?"Pacientes":ge?"Caja":De?"Agenda":Le?"Inventario":We?"Odontograma":be?"Reportes":rt?"Config":"Inicio"),Be&&(i("Facturacin"),K.includes("/pagos")?l("pagos"):K.includes("/facturas")?l("fv"):K.includes("/recibo")?l("recibo"):K.includes("/saldo")?l("saldo"):K.includes("/nc")?l("nc"):K.includes("/nd")?l("nd"):K.includes("/liq")?l("liq"):K.includes("/tras")?l("tras"):K.includes("/oc")?l("oc"):K.includes("/fc")?l("fc"):l("recibo"))},[e.pathname]);const Z=x.useMemo(()=>{const K=e.pathname.split("/").filter(Boolean),Y=K.findIndex(B=>B.startsWith("dashboard_"));return Y>=0?`/${K.slice(0,Y+1).join("/")}`:""},[e.pathname]),Ie=(K="")=>{const Y=String(K).replace(/^\/+|\/+$/g,""),B=Y?`${Z}/${Y}`:Z||"/",ge=e.pathname.toLowerCase()===B.toLowerCase();t(B,{replace:ge})},ve=()=>{switch(s){case"Agenda":return o.jsx(oU,{});case"Pacientes":return o.jsx(x.Suspense,{fallback:o.jsx("div",{style:{padding:16},children:"Cargando"}),children:o.jsx(yU,{})});case"Facturacin":return o.jsx(aU,{view:a});case"Inventario":return o.jsx(lU,{});case"Odontograma":return o.jsx(cU,{});case"Reportes":return o.jsx(xU,{});case"Caja":return o.jsx(s3,{});case"Config":case"Configuracin":case"Configuracion":return o.jsx(ZU,{});case"Planes":return o.jsx(m3,{});case"Inicio":default:return null}};return o.jsxs("div",{className:`oc-shell ${c?"oc-dark":""}`,children:[o.jsx("a",{href:"#oc-main",className:"oc-skip-link",children:"Saltar al contenido"}),o.jsxs("header",{className:"oc-header",role:"banner",children:[o.jsxs("div",{className:"oc-header-left",children:[o.jsx("img",{src:e1,alt:"OdontoCloud",className:"oc-logo"}),o.jsxs("div",{className:"oc-brand-text",children:[o.jsx("span",{className:"oc-brand-main",children:"OdontoCloud"}),o.jsx("span",{className:"oc-brand-sub",children:T?"...":_})]})]}),o.jsxs("nav",{className:"oc-nav",role:"navigation","aria-label":"Navegacin principal",children:[o.jsx(ra,{to:Z,end:!0,className:({isActive:K})=>K&&s==="Inicio"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_home"),children:r("nav_home")}),o.jsx(ra,{to:`${Z}/agenda`,className:({isActive:K})=>K||s==="Agenda"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_agenda"),children:r("nav_agenda")}),o.jsx(ra,{to:`${Z}/pacientes`,className:({isActive:K})=>K||s==="Pacientes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_patients"),children:r("nav_patients")}),o.jsx(ra,{to:`${Z}/caja`,className:({isActive:K})=>K||s==="Caja"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_cash"),children:r("nav_cash")}),o.jsx("button",{type:"button",ref:_e,className:"oc-nav-btn",title:r("nav_admin"),"aria-haspopup":"true","aria-expanded":gt,onClick:()=>gt?Gt(!1):J(),children:r("nav_admin")}),o.jsx(ra,{to:`${Z}/reportes`,className:({isActive:K})=>K||s==="Reportes"?"oc-nav-btn active":"oc-nav-btn",title:r("nav_reports"),children:r("nav_reports")})]}),o.jsxs("div",{className:"oc-header-right",children:[o.jsx(f3,{placeholder:r("searchPlaceholder"),onNavigate:K=>{K==="Inicio"?Ie(""):K==="Facturacin"?(l("recibo"),Ie("facturacion/recibo")):Ie(K.toLowerCase())},onAction:K=>{switch(K){case"new_appointment":case"agenda_today":case"export_agenda":Ie("agenda");break;case"new_patient":Ie("pacientes");break;case"new_invoice":l("fv"),Ie("facturacion/facturas");break;case"toggle_dark":d(Y=>!Y);break;case"logout":mt();break;case"show_shortcuts":alert("Atajos: Ctrl/Cmd + K para abrir bsqueda, / para moverse, Enter para ejecutar.");break;case"support":window.open("https://tu-soporte.odc","_blank");break}}}),o.jsx(bU,{basePath:Z,className:"ml-2"}),o.jsx("button",{className:"oc-icon-btn",type:"button",onClick:()=>d(K=>!K),"aria-pressed":c,title:c?"Activar modo claro":"Activar modo oscuro",children:c?"":""}),o.jsx("button",{className:"oc-icon-btn",type:"button",onClick:mt,title:am[n].logout,children:am[n].logout})]})]}),o.jsx(p3,{open:gt,anchorRect:H,dark:c,onClose:()=>Gt(!1),onSoon:()=>{alert("Prximamente"),Gt(!1)},onNavigatePath:K=>{Ie(K),Gt(!1)},onSetFactView:K=>l(K)}),o.jsxs("main",{id:"oc-main",className:"oc-main-wrapper",role:"main",children:[s!=="Inicio"&&ve(),s==="Inicio"&&o.jsx(g3,{t:r,companyName:_,userName:N,role:f,darkMode:c,weeklySeries:g,weekRangeLabel:He,todaysAppointments:b,todaysLoading:R,metrics:E,metricsLoading:S,n8nState:Ce,n8nLoading:$e,recent:te,recentLoading:ne,onGoAgenda:()=>Ie("agenda")})]})]})}const I1=()=>{try{const t=JSON.parse(localStorage.getItem("odc_session"));return t&&Date.now()-t.timestamp<1e3*60*60*24?t:null}catch{return null}},S1=t=>{const e=(t||"").toLowerCase();return e==="administrador"?"/dashboard_admin":e==="doctor"?"/dashboard_doctor":e==="recepcionista"?"/dashboard_recepcion":"/"};function cm({allowedRoles:t,children:e}){var s;const n=I1();if(!n)return o.jsx(ch,{to:"/",replace:!0});const r=(s=n.rol)==null?void 0:s.toLowerCase();return t.map(i=>i.toLowerCase()).includes(r)?e:o.jsx(ch,{to:S1(n.rol),replace:!0})}function y3(){const t=I1();return o.jsxs(iR,{children:[o.jsx(na,{path:"/",element:t?o.jsx(ch,{to:S1(t.rol),replace:!0}):o.jsx(L4,{})}),o.jsx(na,{path:"/dashboard_admin/*",element:o.jsx(cm,{allowedRoles:["administrador"],children:o.jsx(lm,{})})}),o.jsx(na,{path:"/dashboard_doctor/*",element:o.jsx(cm,{allowedRoles:["doctor"],children:o.jsx(lm,{})})}),o.jsx(na,{path:"/dashboard_recepcion/*",element:o.jsx(cm,{allowedRoles:["recepcionista"],children:o.jsx(lm,{})})}),o.jsx(na,{path:"*",element:o.jsx(ch,{to:"/",replace:!0})})]})}async function v3(){try{await g2(Mh,gT),await XM(Q),console.log(" Firebase listo con sesin persistente y modo offline.")}catch(t){console.warn(" Firebase offline/persistencia fall:",t.message)}}const _3="modulepreload",x3=function(t){return"/odontocloud-react/"+t},K0={},b3=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=x3(c),c in K0)return;K0[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":_3,d||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),d)return new Promise((m,_)=>{f.addEventListener("load",m),f.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})};function w3(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:s,onRegisteredSW:i,onRegisterError:a}=t;let l,c;const d=async(f=!0)=>{await c};async function h(){if("serviceWorker"in navigator){if(l=await b3(async()=>{const{Workbox:f}=await import("./workbox-window.prod.es5-vqzQaGvo.js");return{Workbox:f}},[]).then(({Workbox:f})=>new f("/odontocloud-react/sw.js",{scope:"/odontocloud-react/",type:"classic"})).catch(f=>{a==null||a(f)}),!l)return;l.addEventListener("activated",f=>{(f.isUpdate||f.isExternal)&&window.location.reload()}),l.addEventListener("installed",f=>{f.isUpdate||r==null||r()}),l.register({immediate:e}).then(f=>{i?i("/odontocloud-react/sw.js",f):s==null||s(f)}).catch(f=>{a==null||a(f)})}}return c=h(),d}const E3="empresa_logo_url",Q0="empresa_nombre",I3=x.createContext(null);function S3({children:t}){const[e,n]=x.useState(""),[r,s]=x.useState("OdontoCloud"),[i,a]=x.useState(!0);x.useEffect(()=>{var f;let d="";try{d=localStorage.getItem(E3)||""}catch{}d||(d="/assets/logo.png"),n(d);let h="OdontoCloud";try{h=localStorage.getItem(Q0)||((f=document.querySelector('meta[name="company-name"]'))==null?void 0:f.getAttribute("content"))||"OdontoCloud"}catch{}s(h),a(!1)},[]);const c={logoUrl:e,clinicName:r,loading:i,setLogoUrl:n,setClinicName:d=>{const h=d||"OdontoCloud";try{localStorage.setItem(Q0,h)}catch{}let f=document.querySelector('meta[name="company-name"]');f||(f=document.createElement("meta"),f.setAttribute("name","company-name"),document.head.appendChild(f)),f.setAttribute("content",h),s(h)}};return o.jsx(I3.Provider,{value:c,children:t})}const T3="/odontocloud-react/";v3();w3({immediate:!0});uS(document.getElementById("root")).render(o.jsx(Uh.StrictMode,{children:o.jsx(S3,{children:o.jsx(NR,{basename:T3,children:o.jsx(y3,{})})})}));
